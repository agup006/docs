<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?asciidoc-toc?>
<?asciidoc-numbered?>

<book lang="en">
<bookinfo>
    <title>Elasticsearch Reference</title>
</bookinfo>
<part id="getting-started">
<title>Getting Started <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>Elasticsearch is a highly scalable open-source full-text search and analytics engine. It allows you to store, search, and analyze big volumes of data quickly and in near real time. It is generally used as the underlying engine/technology that powers applications that have complex search features and requirements.</simpara>
<simpara>Here are a few sample use-cases that Elasticsearch could be used for:</simpara>
<itemizedlist>
<listitem>
<simpara>
You run an online web store where you allow your customers to search for products that you sell. In this case, you can use Elasticsearch to store your entire product catalog and inventory and provide search and autocomplete suggestions for them.
</simpara>
</listitem>
<listitem>
<simpara>
You want to collect log or transaction data and you want to analyze and mine this data to look for trends, statistics, summarizations, or anomalies. In this case, you can use Logstash (part of the Elasticsearch/Logstash/Kibana stack) to collect, aggregate, and parse your data, and then have Logstash feed this data into Elasticsearch. Once the data is in Elasticsearch, you can run searches and aggregations to mine any information that is of interest to you.
</simpara>
</listitem>
<listitem>
<simpara>
You run a price alerting platform which allows price-savvy customers to specify a rule like "I am interested in buying a specific electronic gadget and I want to be notified if the price of gadget falls below $X from any vendor within the next month". In this case you can scrape vendor prices, push them into Elasticsearch and use its reverse-search (Percolator) capability to match price movements against customer queries and eventually push the alerts out to the customer once matches are found.
</simpara>
</listitem>
<listitem>
<simpara>
You have analytics/business-intelligence needs and want to quickly investigate, analyze, visualize, and ask ad-hoc questions on a lot of data (think millions or billions of records). In this case, you can use Elasticsearch to store your data and then use Kibana (part of the Elasticsearch/Logstash/Kibana stack) to build custom dashboards that can visualize aspects of your data that are important to you. Additionally, you can use the Elasticsearch aggregations functionality to perform complex business intelligence queries against your data.
</simpara>
</listitem>
</itemizedlist>
<simpara>For the rest of this tutorial, I will guide you through the process of getting Elasticsearch up and running, taking a peek inside it, and performing basic operations like indexing, searching, and modifying your data. At the end of this tutorial, you should have a good idea of what Elasticsearch is, how it works, and hopefully be inspired to see how you can use it to either build sophisticated search applications or to mine intelligence from your data.</simpara>
</partintro>
<chapter id="_basic_concepts">
<title>Basic Concepts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>There are a few concepts that are core to Elasticsearch. Understanding these concepts from the outset will tremendously help ease the learning process.</simpara>
<bridgehead id="_near_realtime_nrt" renderas="sect2">Near Realtime (NRT)<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch is a near real time search platform. What this means is there is a slight latency (normally one second) from the time you index a document until the time it becomes searchable.</simpara>
<bridgehead id="_cluster" renderas="sect2">Cluster<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>A cluster is a collection of one or more nodes (servers) that together holds your entire data and provides federated indexing and search capabilities across all nodes. A cluster is identified by a unique name which by default is "elasticsearch". This name is important because a node can only be part of a cluster if the node is set up to join the cluster by its name.</simpara>
<simpara>Make sure that you don&#8217;t reuse the same cluster names in different
environments, otherwise you might end up with nodes joining the wrong cluster.
For instance you could use <literal>logging-dev</literal>, <literal>logging-stage</literal>, and <literal>logging-prod</literal>
for the development, staging, and production clusters.</simpara>
<simpara>Note that it is valid and perfectly fine to have a cluster with only a single node in it. Furthermore, you may also have multiple independent clusters each with its own unique cluster name.</simpara>
<bridgehead id="_node" renderas="sect2">Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>A node is a single server that is part of your cluster, stores your data, and participates in the cluster&#8217;s indexing and search capabilities. Just like a cluster, a node is identified by a name which by default is a random Marvel character name that is assigned to the node at startup. You can define any node name you want if you do not want the default.  This name is important for administration purposes where you want to identify which servers in your network correspond to which nodes in your Elasticsearch cluster.</simpara>
<simpara>A node can be configured to join a specific cluster by the cluster name. By default, each node is set up to join a cluster named <literal>elasticsearch</literal> which means that if you start up a number of nodes on your network and&#8212;assuming they can discover each other&#8212;they will all automatically form and join a single cluster named <literal>elasticsearch</literal>.</simpara>
<simpara>In a single cluster, you can have as many nodes as you want. Furthermore, if there are no other Elasticsearch nodes currently running on your network, starting a single node will by default form a new single-node cluster named <literal>elasticsearch</literal>.</simpara>
<bridgehead id="_index" renderas="sect2">Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>An index is a collection of documents that have somewhat similar characteristics. For example, you can have an index for customer data, another index for a product catalog, and yet another index for order data. An index is identified by a name (that must be all lowercase) and this name is used to refer to the index when performing indexing, search, update, and delete operations against the documents in it.</simpara>
<simpara>In a single cluster, you can define as many indexes as you want.</simpara>
<bridgehead id="_type" renderas="sect2">Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>Within an index, you can define one or more types. A type is a logical category/partition of your index whose semantics is completely up to you. In general, a type is defined for documents that have a set of common fields. For example, let&#8217;s assume you run a blogging platform and store all your data in a single index. In this index, you may define a type for user data, another type for blog data, and yet another type for comments data.</simpara>
<bridgehead id="_document" renderas="sect2">Document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>A document is a basic unit of information that can be indexed. For example, you can have a document for a single customer, another document for a single product, and yet another for a single order. This document is expressed in <ulink url="http://json.org/">JSON</ulink> (JavaScript Object Notation) which is an ubiquitous internet data interchange format.</simpara>
<simpara>Within an index/type, you can store as many documents as you want. Note that although a document physically resides in an index, a document actually must be indexed/assigned to a type inside an index.</simpara>
<bridgehead id="_shards_amp_replicas" renderas="sect2">Shards &amp; Replicas<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>An index can potentially store a large amount of data that can exceed the hardware limits of a single node. For example, a single index of a billion documents taking up 1TB of disk space may not fit on the disk of a single node or may be too slow to serve search requests from a single node alone.</simpara>
<simpara>To solve this problem, Elasticsearch provides the ability to subdivide your index into multiple pieces called shards. When you create an index, you can simply define the number of shards that you want. Each shard is in itself a fully-functional and independent "index" that can be hosted on any node in the cluster.</simpara>
<simpara>Sharding is important for two primary reasons:</simpara>
<itemizedlist>
<listitem>
<simpara>
It allows you to horizontally split/scale your content volume
</simpara>
</listitem>
<listitem>
<simpara>
It allows you to distribute and parallelize operations across shards (potentially on multiple nodes) thus increasing performance/throughput
</simpara>
</listitem>
</itemizedlist>
<simpara>The mechanics of how a shard is distributed and also how its documents are aggregated back into search requests are completely managed by Elasticsearch and is transparent to you as the user.</simpara>
<simpara>In a network/cloud environment where failures can be expected anytime, it is very useful and highly recommended to have a failover mechanism in case a shard/node somehow goes offline or disappears for whatever reason. To this end, Elasticsearch allows you to make one or more copies of your index&#8217;s shards into what are called replica shards, or replicas for short.</simpara>
<simpara>Replication is important for two primary reasons:</simpara>
<itemizedlist>
<listitem>
<simpara>
It provides high availability in case a shard/node fails. For this reason, it is important to note that a replica shard is never allocated on the same node as the original/primary shard that it was copied from.
</simpara>
</listitem>
<listitem>
<simpara>
It allows you to scale out your search volume/throughput since searches can be executed on all replicas in parallel.
</simpara>
</listitem>
</itemizedlist>
<simpara>To summarize, each index can be split into multiple shards. An index can also be replicated zero (meaning no replicas) or more times. Once replicated, each index will have primary shards (the original shards that were replicated from) and replica shards (the copies of the primary shards).
The number of shards and replicas can be defined per index at the time the index is created. After the index is created, you may change the number of replicas dynamically anytime but you cannot change the number shards after-the-fact.</simpara>
<simpara>By default, each index in Elasticsearch is allocated 5 primary shards and 1 replica which means that if you have at least two nodes in your cluster, your index will have 5 primary shards and another 5 replica shards (1 complete replica) for a total of 10 shards per index.</simpara>
<note><simpara>Each Elasticsearch shard is a Lucene index.  There is a maximum number of documents you can have in a single Lucene index.  As of <ulink url="https://issues.apache.org/jira/browse/LUCENE-5843"><literal>LUCENE-5843</literal></ulink>, the limit is <literal>2,147,483,519</literal> (= Integer.MAX_VALUE - 128) documents.
You can monitor shard sizes using the <link linkend="cat-shards"><literal>_cat/shards</literal></link> api.</simpara></note>
<simpara>With that out of the way, let&#8217;s get started with the fun part&#8230;</simpara>
</chapter>
<chapter id="_installation">
<title>Installation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch requires at least Java 7. Specifically as of this writing, it is recommended that you use the Oracle JDK version 1.8.0_73. Java installation varies from platform to platform so we won&#8217;t go into those details here. Oracle&#8217;s recommended installation documentation can be found on <ulink url="http://docs.oracle.com/javase/8/docs/technotes/guides/install/install_overview.html">Oracle&#8217;s website</ulink>. Suffice to say, before you install Elasticsearch, please check your Java version first by running (and then install/upgrade accordingly if needed):</simpara>
<programlisting language="sh" linenumbering="unnumbered">java -version
echo $JAVA_HOME</programlisting>
<simpara>Once we have Java set up, we can then download and run Elasticsearch. The binaries are available from <ulink url="http://www.elastic.co/downloads"><literal>www.elastic.co/downloads</literal></ulink> along with all the releases that have been made in the past. For each release, you have a choice among a <literal>zip</literal> or <literal>tar</literal> archive, or a <literal>DEB</literal> or <literal>RPM</literal> package. For simplicity, let&#8217;s use the tar file.</simpara>
<simpara>Let&#8217;s download the Elasticsearch 2.4.2 tar as follows (Windows users should download the zip package):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -L -O https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.4.2/elasticsearch-2.4.2.tar.gz</programlisting>
<simpara>Then extract it as follows (Windows users should unzip the zip package):</simpara>
<programlisting language="sh" linenumbering="unnumbered">tar -xvf elasticsearch-2.4.2.tar.gz</programlisting>
<simpara>It will then create a bunch of files and folders in your current directory. We then go into the bin directory as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">cd elasticsearch-2.4.2/bin</programlisting>
<simpara>And now we are ready to start our node and single cluster (Windows users should run the elasticsearch.bat file):</simpara>
<programlisting language="sh" linenumbering="unnumbered">./elasticsearch</programlisting>
<simpara>If everything goes well, you should see a bunch of messages that look like below:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./elasticsearch
[2014-03-13 13:42:17,218][INFO ][node           ] [New Goblin] version[2.4.2], pid[2085], build[5c03844/2014-02-25T15:52:53Z]
[2014-03-13 13:42:17,219][INFO ][node           ] [New Goblin] initializing ...
[2014-03-13 13:42:17,223][INFO ][plugins        ] [New Goblin] loaded [], sites []
[2014-03-13 13:42:19,831][INFO ][node           ] [New Goblin] initialized
[2014-03-13 13:42:19,832][INFO ][node           ] [New Goblin] starting ...
[2014-03-13 13:42:19,958][INFO ][transport      ] [New Goblin] bound_address {inet[/0:0:0:0:0:0:0:0:9300]}, publish_address {inet[/192.168.8.112:9300]}
[2014-03-13 13:42:23,030][INFO ][cluster.service] [New Goblin] new_master [New Goblin][rWMtGj3dQouz2r6ZFL9v4g][mwubuntu1][inet[/192.168.8.112:9300]], reason: zen-disco-join (elected_as_master)
[2014-03-13 13:42:23,100][INFO ][discovery      ] [New Goblin] elasticsearch/rWMtGj3dQouz2r6ZFL9v4g
[2014-03-13 13:42:23,125][INFO ][http           ] [New Goblin] bound_address {inet[/0:0:0:0:0:0:0:0:9200]}, publish_address {inet[/192.168.8.112:9200]}
[2014-03-13 13:42:23,629][INFO ][gateway        ] [New Goblin] recovered [1] indices into cluster_state
[2014-03-13 13:42:23,630][INFO ][node           ] [New Goblin] started</programlisting>
<simpara>Without going too much into detail, we can see that our node named "New Goblin" (which will be a different Marvel character in your case) has started and elected itself as a master in a single cluster. Don&#8217;t worry yet at the moment what master means. The main thing that is important here is that we have started one node within one cluster.</simpara>
<simpara>As mentioned previously, we can override either the cluster or node name. This can be done from the command line when starting Elasticsearch as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./elasticsearch --cluster.name my_cluster_name --node.name my_node_name</programlisting>
<simpara>Also note the line marked http with information about the HTTP address (<literal>192.168.8.112</literal>) and port (<literal>9200</literal>) that our node is reachable from. By default, Elasticsearch uses port <literal>9200</literal> to provide access to its REST API. This port is configurable if necessary.</simpara>
</chapter>
<chapter id="_exploring_your_cluster">
<title>Exploring Your Cluster<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<bridgehead id="_the_rest_api" renderas="sect2">The REST API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>Now that we have our node (and cluster) up and running, the next step is to understand how to communicate with it. Fortunately, Elasticsearch provides a very comprehensive and powerful REST API that you can use to interact with your cluster. Among the few things that can be done with the API are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
Check your cluster, node, and index health, status, and statistics
</simpara>
</listitem>
<listitem>
<simpara>
Administer your cluster, node, and index data and metadata
</simpara>
</listitem>
<listitem>
<simpara>
Perform CRUD (Create, Read, Update, and Delete) and search operations against your indexes
</simpara>
</listitem>
<listitem>
<simpara>
Execute advanced search operations such as paging, sorting, filtering, scripting, aggregations, and many others
</simpara>
</listitem>
</itemizedlist>
<section id="_cluster_health">
<title>Cluster Health<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Let&#8217;s start with a basic health check, which we can use to see how our cluster is doing. We&#8217;ll be using curl to do this but you can use any tool that allows you to make HTTP/REST calls. Let&#8217;s assume that we are still on the same node where we started Elasticsearch on and open another command shell window.</simpara>
<simpara>To check the cluster health, we will be using the <link linkend="cat"><literal>_cat</literal> API</link>. Remember previously that our node HTTP endpoint is available at port <literal>9200</literal>:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/health?v'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign
1394735289 14:28:09  elasticsearch green           1         1      0   0    0    0        0</programlisting>
<simpara>We can see that our cluster named "elasticsearch" is up with a green status.</simpara>
<simpara>Whenever we ask for the cluster health, we either get green, yellow, or red. Green means everything is good (cluster is fully functional), yellow means all data is available but some replicas are not yet allocated (cluster is fully functional), and red means some data is not available for whatever reason. Note that even if a cluster is red, it still is partially functional (i.e. it will continue to serve search requests from the available shards) but you will likely need to fix it ASAP since you have missing data.</simpara>
<simpara>Also from the above response, we can see a total of 1 node and that we have 0 shards since we have no data in it yet. Note that since we are using the default cluster name (elasticsearch) and since Elasticsearch uses unicast network discovery by default to find other nodes on the same machine, it is possible that you could accidentally start up more than one node on your computer and have them all join a single cluster. In this scenario, you may see more than 1 node in the above response.</simpara>
<simpara>We can also get a list of nodes in our cluster as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/nodes?v'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/nodes?v'
host         ip        heap.percent ram.percent load node.role master name
mwubuntu1    127.0.1.1            8           4 0.00 d         *      New Goblin</programlisting>
<simpara>Here, we can see our one node named "New Goblin", which is the single node that is currently in our cluster.</simpara>
</section>
<section id="_list_all_indices">
<title>List All Indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Now let&#8217;s take a peek at our indices:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/indices?v'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size</programlisting>
<simpara>Which simply means we have no indices yet in the cluster.</simpara>
</section>
<section id="_create_an_index">
<title>Create an Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Now let&#8217;s create an index named "customer" and then list all the indexes again:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer?pretty'
curl 'localhost:9200/_cat/indices?v'</programlisting>
<simpara>The first command creates the index named "customer" using the PUT verb. We simply append <literal>pretty</literal> to the end of the call to tell it to pretty-print the JSON response (if any).</simpara>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer?pretty'
{
  "acknowledged" : true
}

curl 'localhost:9200/_cat/indices?v'
health index    pri rep docs.count docs.deleted store.size pri.store.size
yellow customer   5   1          0            0       495b           495b</programlisting>
<simpara>The results of the second command tells us that we now have 1 index named customer and it has 5 primary shards and 1 replica (the defaults) and it contains 0 documents in it.</simpara>
<simpara>You might also notice that the customer index has a yellow health tagged to it. Recall from our previous discussion that yellow means that some replicas are not (yet) allocated. The reason this happens for this index is because Elasticsearch by default created one replica for this index. Since we only have one node running at the moment, that one replica cannot yet be allocated (for high availability) until a later point in time when another node joins the cluster. Once that replica gets allocated onto a second node, the health status for this index will turn to green.</simpara>
</section>
<section id="_index_and_query_a_document">
<title>Index and Query a Document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Let&#8217;s now put something into our customer index. Remember previously that in order to index a document, we must tell Elasticsearch which type in the index it should go to.</simpara>
<simpara>Let&#8217;s index a simple customer document into the customer index, "external" type, with an ID of 1 as follows:</simpara>
<simpara>Our JSON document: { "name": "John Doe" }</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'
{
  "_index" : "customer",
  "_type" : "external",
  "_id" : "1",
  "_version" : 1,
  "created" : true
}</programlisting>
<simpara>From the above, we can see that a new customer document was successfully created inside the customer index and the external type. The document also has an internal id of 1 which we specified at index time.</simpara>
<simpara>It is important to note that Elasticsearch does not require you to explicitly create an index first before you can index documents into it. In the previous example, Elasticsearch will automatically create the customer index if it didn&#8217;t already exist beforehand.</simpara>
<simpara>Let&#8217;s now retrieve that document that we just indexed:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET 'localhost:9200/customer/external/1?pretty'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET 'localhost:9200/customer/external/1?pretty'
{
  "_index" : "customer",
  "_type" : "external",
  "_id" : "1",
  "_version" : 1,
  "found" : true,
  "_source" : { "name": "John Doe" }
}</programlisting>
<simpara>Nothing out of the ordinary here other than a field, <literal>found</literal>, stating that we found a document with the requested ID 1 and another field, <literal>_source</literal>, which returns the full JSON document that we indexed from the previous step.</simpara>
</section>
<section id="_delete_an_index">
<title>Delete an Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Now let&#8217;s delete the index that we just created and then list all the indexes again:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XDELETE 'localhost:9200/customer?pretty'
curl 'localhost:9200/_cat/indices?v'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XDELETE 'localhost:9200/customer?pretty'
{
  "acknowledged" : true
}
curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size</programlisting>
<simpara>Which means that the index was deleted successfully and we are now back to where we started with nothing in our cluster.</simpara>
<simpara>Before we move on, let&#8217;s take a closer look again at some of the API commands that we have learned so far:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer'
curl -XPUT 'localhost:9200/customer/external/1' -d '
{
  "name": "John Doe"
}'
curl 'localhost:9200/customer/external/1'
curl -XDELETE 'localhost:9200/customer'</programlisting>
<simpara>If we study the above commands carefully, we can actually see a pattern of how we access data in Elasticsearch. That pattern can be summarized as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -X&lt;REST Verb&gt; &lt;Node&gt;:&lt;Port&gt;/&lt;Index&gt;/&lt;Type&gt;/&lt;ID&gt;</programlisting>
<simpara>This REST access pattern is pervasive throughout all the API commands that if you can simply remember it, you will have a good head start at mastering Elasticsearch.</simpara>
</section>
</chapter>
<chapter id="_modifying_your_data">
<title>Modifying Your Data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch provides data manipulation and search capabilities in near real time. By default, you can expect a one second delay (refresh interval) from the time you index/update/delete your data until the time that it appears in your search results. This is an important distinction from other platforms like SQL wherein data is immediately available after a transaction is completed.</simpara>
<bridgehead id="_indexing_replacing_documents" renderas="sect2">Indexing/Replacing Documents<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>We&#8217;ve previously seen how we can index a single document. Let&#8217;s recall that command again:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'</programlisting>
<simpara>Again, the above will index the specified document into the customer index, external type, with the ID of 1. If we then executed the above command again with a different (or same) document, Elasticsearch will replace (i.e. reindex) a new document on top of the existing one with the ID of 1:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "Jane Doe"
}'</programlisting>
<simpara>The above changes the name of the document with the ID of 1 from "John Doe" to "Jane Doe". If, on the other hand, we use a different ID, a new document will be indexed and the existing document(s) already in the index remains untouched.</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPUT 'localhost:9200/customer/external/2?pretty' -d '
{
  "name": "Jane Doe"
}'</programlisting>
<simpara>The above indexes a new document with an ID of 2.</simpara>
<simpara>When indexing, the ID part is optional. If not specified, Elasticsearch will generate a random ID and then use it to index the document. The actual ID Elasticsearch generates (or whatever we specified explicitly in the previous examples) is returned as part of the index API call.</simpara>
<simpara>This example shows how to index a document without an explicit ID:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external?pretty' -d '
{
  "name": "Jane Doe"
}'</programlisting>
<simpara>Note that in the above case, we are using the POST verb instead of PUT since we didn&#8217;t specify an ID.</simpara>
<section id="_updating_documents">
<title>Updating Documents<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>In addition to being able to index and replace documents, we can also update documents. Note though that Elasticsearch does not actually do in-place updates under the hood. Whenever we do an update, Elasticsearch deletes the old document and then indexes a new document with the update applied to it in one shot.</simpara>
<simpara>This example shows how to update our previous document (ID of 1) by changing the name field to "Jane Doe":</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "doc": { "name": "Jane Doe" }
}'</programlisting>
<simpara>This example shows how to update our previous document (ID of 1) by changing the name field to "Jane Doe" and at the same time add an age field to it:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "doc": { "name": "Jane Doe", "age": 20 }
}'</programlisting>
<simpara>Updates can also be performed by using simple scripts. Note that dynamic scripts like the following are disabled by default as of <literal>1.4.3</literal>, have a look at the <link linkend="modules-scripting">scripting docs</link> for more details. This example uses a script to increment the age by 5:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "script" : "ctx._source.age += 5"
}'</programlisting>
<simpara>In the above example, <literal>ctx._source</literal> refers to the current source document that is about to be updated.</simpara>
<simpara>Note that as of this writing, updates can only be performed on a single document at a time. In the future, Elasticsearch might provide the ability to update multiple documents given a query condition (like an <literal>SQL UPDATE-WHERE</literal> statement).</simpara>
</section>
<section id="_deleting_documents">
<title>Deleting Documents<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Deleting a document is fairly straightforward. This example shows how to delete our previous customer with the ID of 2:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XDELETE 'localhost:9200/customer/external/2?pretty'</programlisting>
<simpara>The <literal>delete-by-query</literal> plugin can delete all documents matching a specific query.</simpara>
</section>
<section id="_batch_processing">
<title>Batch Processing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>In addition to being able to index, update, and delete individual documents, Elasticsearch also provides the ability to perform any of the above operations in batches using the <link linkend="docs-bulk"><literal>_bulk</literal> API</link>. This functionality is important in that it provides a very efficient mechanism to do multiple operations as fast as possible with as little network roundtrips as possible.</simpara>
<simpara>As a quick example, the following call indexes two documents (ID 1 - John Doe and ID 2 - Jane Doe) in one bulk operation:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external/_bulk?pretty' -d '
{"index":{"_id":"1"}}
{"name": "John Doe" }
{"index":{"_id":"2"}}
{"name": "Jane Doe" }
'</programlisting>
<simpara>This example updates the first document (ID of 1) and then deletes the second document (ID of 2) in one bulk operation:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/customer/external/_bulk?pretty' -d '
{"update":{"_id":"1"}}
{"doc": { "name": "John Doe becomes Jane Doe" } }
{"delete":{"_id":"2"}}
'</programlisting>
<simpara>Note above that for the delete action, there is no corresponding source document after it since deletes only require the ID of the document to be deleted.</simpara>
<simpara>The bulk API executes all the actions sequentially and in order. If a single action fails for whatever reason, it will continue to process the remainder of the actions after it. When the bulk API returns, it will provide a status for each action (in the same order it was sent in) so that you can check if a specific action failed or not.</simpara>
</section>
</chapter>
<chapter id="_exploring_your_data">
<title>Exploring Your Data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<bridgehead id="_sample_dataset" renderas="sect2">Sample Dataset<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>Now that we&#8217;ve gotten a glimpse of the basics, let&#8217;s try to work on a more realistic dataset. I&#8217;ve prepared a sample of fictitious JSON documents of customer bank account information. Each document has the following schema:</simpara>
<programlisting language="sh" linenumbering="unnumbered">{
    "account_number": 0,
    "balance": 16623,
    "firstname": "Bradshaw",
    "lastname": "Mckenzie",
    "age": 29,
    "gender": "F",
    "address": "244 Columbus Place",
    "employer": "Euron",
    "email": "bradshawmckenzie@euron.com",
    "city": "Hobucken",
    "state": "CO"
}</programlisting>
<simpara>For the curious, I generated this data from <ulink url="http://www.json-generator.com/"><literal>www.json-generator.com/</literal></ulink> so please ignore the actual values and semantics of the data as these are all randomly generated.</simpara>
<bridgehead id="_loading_the_sample_dataset" renderas="sect2">Loading the Sample Dataset<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can download the sample dataset (accounts.json) from <ulink url="https://github.com/bly2k/files/blob/master/accounts.zip?raw=true">here</ulink>. Extract it to our current directory and let&#8217;s load it into our cluster as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/account/_bulk?pretty' --data-binary "@accounts.json"
curl 'localhost:9200/_cat/indices?v'</programlisting>
<simpara>And the response:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size
yellow bank    5   1       1000            0    424.4kb        424.4kb</programlisting>
<simpara>Which means that we just successfully bulk indexed 1000 documents into the bank index (under the account type).</simpara>
<section id="_the_search_api">
<title>The Search API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Now let&#8217;s start with some simple searches. There are two basic ways to run searches: one is by sending search parameters through the <link linkend="search-uri-request">REST request URI</link> and the other by sending them through the <link linkend="search-request-body">REST request body</link>. The request body method allows you to be more expressive and also to define your searches in a more readable JSON format. We&#8217;ll try one example of the request URI method but for the remainder of this tutorial, we will exclusively be using the request body method.</simpara>
<simpara>The REST API for search is accessible from the <literal>_search</literal> endpoint. This example returns all documents in the bank index:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/bank/_search?q=*&amp;pretty'</programlisting>
<simpara>Let&#8217;s first dissect the search call. We are searching (<literal>_search</literal> endpoint) in the bank index, and the <literal>q=*</literal> parameter instructs Elasticsearch to match all documents in the index. The <literal>pretty</literal> parameter, again, just tells Elasticsearch to return pretty-printed JSON results.</simpara>
<simpara>And the response (partially shown):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/bank/_search?q=*&amp;pretty'
{
  "took" : 63,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 1000,
    "max_score" : 1.0,
    "hits" : [ {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "1",
      "_score" : 1.0, "_source" : {"account_number":1,"balance":39225,"firstname":"Amber","lastname":"Duke","age":32,"gender":"M","address":"880 Holmes Lane","employer":"Pyrami","email":"amberduke@pyrami.com","city":"Brogan","state":"IL"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "6",
      "_score" : 1.0, "_source" : {"account_number":6,"balance":5686,"firstname":"Hattie","lastname":"Bond","age":36,"gender":"M","address":"671 Bristol Street","employer":"Netagy","email":"hattiebond@netagy.com","city":"Dante","state":"TN"}
    }, {
      "_index" : "bank",
      "_type" : "account",</programlisting>
<simpara>As for the response, we see the following parts:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>took</literal> – time in milliseconds for Elasticsearch to execute the search
</simpara>
</listitem>
<listitem>
<simpara>
<literal>timed_out</literal> – tells us if the search timed out or not
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_shards</literal> – tells us how many shards were searched, as well as a count of the successful/failed searched shards
</simpara>
</listitem>
<listitem>
<simpara>
<literal>hits</literal> – search results
</simpara>
</listitem>
<listitem>
<simpara>
<literal>hits.total</literal> – total number of documents matching our search criteria
</simpara>
</listitem>
<listitem>
<simpara>
<literal>hits.hits</literal> – actual array of search results (defaults to first 10 documents)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_score</literal> and <literal>max_score</literal> - ignore these fields for now
</simpara>
</listitem>
</itemizedlist>
<simpara>Here is the same exact search above using the alternative request body method:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} }
}'</programlisting>
<simpara>The difference here is that instead of passing <literal>q=*</literal> in the URI, we POST a JSON-style query request body to the <literal>_search</literal> API. We&#8217;ll discuss this JSON query in the next section.</simpara>
<simpara>And the response (partially shown):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} }
}'
{
  "took" : 26,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 1000,
    "max_score" : 1.0,
    "hits" : [ {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "1",
      "_score" : 1.0, "_source" : {"account_number":1,"balance":39225,"firstname":"Amber","lastname":"Duke","age":32,"gender":"M","address":"880 Holmes Lane","employer":"Pyrami","email":"amberduke@pyrami.com","city":"Brogan","state":"IL"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "6",
      "_score" : 1.0, "_source" : {"account_number":6,"balance":5686,"firstname":"Hattie","lastname":"Bond","age":36,"gender":"M","address":"671 Bristol Street","employer":"Netagy","email":"hattiebond@netagy.com","city":"Dante","state":"TN"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "13",</programlisting>
<simpara>It is important to understand that once you get your search results back, Elasticsearch is completely done with the request and does not maintain any kind of server-side resources or open cursors into your results. This is in stark contrast to many other platforms such as SQL wherein you may initially get a partial subset of your query results up-front and then you have to continuously go back to the server if you want to fetch (or page through) the rest of the results using some kind of stateful server-side cursor.</simpara>
</section>
<section id="_introducing_the_query_language">
<title>Introducing the Query Language<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch provides a JSON-style domain-specific language that you can use to execute queries. This is referred to as the <link linkend="query-dsl">Query DSL</link>. The query language is quite comprehensive and can be intimidating at first glance but the best way to actually learn it is to start with a few basic examples.</simpara>
<simpara>Going back to our last example, we executed this query:</simpara>
<programlisting language="sh" linenumbering="unnumbered">{
  "query": { "match_all": {} }
}</programlisting>
<simpara>Dissecting the above, the <literal>query</literal> part tells us what our query definition is and the <literal>match_all</literal> part is simply the type of query that we want to run. The <literal>match_all</literal> query is simply a search for all documents in the specified index.</simpara>
<simpara>In addition to the <literal>query</literal> parameter, we also can pass other parameters to influence the search results. For example, the following does a <literal>match_all</literal> and returns only the first document:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "size": 1
}'</programlisting>
<simpara>Note that if <literal>size</literal> is not specified, it defaults to 10.</simpara>
<simpara>This example does a <literal>match_all</literal> and returns documents 11 through 20:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "from": 10,
  "size": 10
}'</programlisting>
<simpara>The <literal>from</literal> parameter (0-based) specifies which document index to start from and the <literal>size</literal> parameter specifies how many documents to return starting at the from parameter. This feature is useful when implementing paging of search results. Note that if <literal>from</literal> is not specified, it defaults to 0.</simpara>
<simpara>This example does a <literal>match_all</literal> and sorts the results by account balance in descending order and returns the top 10 (default size) documents.</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "sort": { "balance": { "order": "desc" } }
}'</programlisting>
</section>
<section id="_executing_searches">
<title>Executing Searches<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Now that we have seen a few of the basic search parameters, let&#8217;s dig in some more into the Query DSL. Let&#8217;s first take a look at the returned document fields. By default, the full JSON document is returned as part of all searches. This is referred to as the source (<literal>_source</literal> field in the search hits). If we don&#8217;t want the entire source document returned, we have the ability to request only a few fields from within source to be returned.</simpara>
<simpara>This example shows how to return two fields, <literal>account_number</literal> and <literal>balance</literal> (inside of <literal>_source</literal>), from the search:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "_source": ["account_number", "balance"]
}'</programlisting>
<simpara>Note that the above example simply reduces the <literal>_source</literal> field. It will still only return one field named <literal>_source</literal> but within it, only the fields <literal>account_number</literal> and <literal>balance</literal> are included.</simpara>
<simpara>If you come from a SQL background, the above is somewhat similar in concept to the <literal>SQL SELECT FROM</literal> field list.</simpara>
<simpara>Now let&#8217;s move on to the query part. Previously, we&#8217;ve seen how the <literal>match_all</literal> query is used to match all documents. Let&#8217;s now introduce a new query called the <link linkend="query-dsl-match-query"><literal>match</literal> query</link>, which can be thought of as a basic fielded search query (i.e. a search done against a specific field or set of fields).</simpara>
<simpara>This example returns the account numbered 20:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "account_number": 20 } }
}'</programlisting>
<simpara>This example returns all accounts containing the term "mill" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "address": "mill" } }
}'</programlisting>
<simpara>This example returns all accounts containing the term "mill" or "lane" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "address": "mill lane" } }
}'</programlisting>
<simpara>This example is a variant of <literal>match</literal> (<literal>match_phrase</literal>) that returns all accounts containing the phrase "mill lane" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_phrase": { "address": "mill lane" } }
}'</programlisting>
<simpara>Let&#8217;s now introduce the <link linkend="query-dsl-bool-query"><literal>bool</literal>(ean) query</link>. The <literal>bool</literal> query allows us to compose smaller queries into bigger queries using boolean logic.</simpara>
<simpara>This example composes two <literal>match</literal> queries and returns all accounts containing "mill" and "lane" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</programlisting>
<simpara>In the above example, the <literal>bool must</literal> clause specifies all the queries that must be true for a document to be considered a match.</simpara>
<simpara>In contrast, this example composes two <literal>match</literal> queries and returns all accounts containing "mill" or "lane" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "should": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</programlisting>
<simpara>In the above example, the <literal>bool should</literal> clause specifies a list of queries either of which must be true for a document to be considered a match.</simpara>
<simpara>This example composes two <literal>match</literal> queries and returns all accounts that contain neither "mill" nor "lane" in the address:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must_not": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</programlisting>
<simpara>In the above example, the <literal>bool must_not</literal> clause specifies a list of queries none of which must be true for a document to be considered a match.</simpara>
<simpara>We can combine <literal>must</literal>, <literal>should</literal>, and <literal>must_not</literal> clauses simultaneously inside a <literal>bool</literal> query. Furthermore, we can compose <literal>bool</literal> queries inside any of these <literal>bool</literal> clauses to mimic any complex multi-level boolean logic.</simpara>
<simpara>This example returns all accounts of anybody who is 40 years old but don&#8217;t live in ID(aho):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must": [
        { "match": { "age": "40" } }
      ],
      "must_not": [
        { "match": { "state": "ID" } }
      ]
    }
  }
}'</programlisting>
</section>
<section id="_executing_filters">
<title>Executing Filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>In the previous section, we skipped over a little detail called the document score (<literal>_score</literal> field in the search results). The score is a numeric value that is a relative measure of how well the document matches the search query that we specified. The higher the score, the more relevant the document is, the lower the score, the less relevant the document is.</simpara>
<simpara>But queries do not always need to produce scores, in particular when they are only used for "filtering" the document set. Elasticsearch detects these situations and automatically optimizes query execution in order not to compute useless scores.</simpara>
<simpara>The <link linkend="query-dsl-bool-query"><literal>bool</literal> query</link> that we introduced in the previous section also supports <literal>filter</literal> clauses which allow to use a query to restrict the documents that will be matched by other clauses, without changing how scores are computed. As an example, let&#8217;s introduce the <link linkend="query-dsl-range-query"><literal>range</literal> query</link>, which allows us to filter documents by a range of values. This is generally used for numeric or date filtering.</simpara>
<simpara>This example uses a bool query to return all accounts with balances between 20000 and 30000, inclusive. In other words, we want to find accounts with a balance that is greater than or equal to 20000 and less than or equal to 30000.</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must": { "match_all": {} },
      "filter": {
        "range": {
          "balance": {
            "gte": 20000,
            "lte": 30000
          }
        }
      }
    }
  }
}'</programlisting>
<simpara>Dissecting the above, the bool query contains a <literal>match_all</literal> query (the query part) and a <literal>range</literal> query (the filter part). We can substitute any other queries into the query and the filter parts. In the above case, the range query makes perfect sense since documents falling into the range all match "equally", i.e., no document is more relevant than another.</simpara>
<simpara>In addition to the <literal>match_all</literal>, <literal>match</literal>, <literal>bool</literal>, and <literal>range</literal> queries, there are a lot of other query types that are available and we won&#8217;t go into them here. Since we already have a basic understanding of how they work, it shouldn&#8217;t be too difficult to apply this knowledge in learning and experimenting with the other query types.</simpara>
</section>
<section id="_executing_aggregations">
<title>Executing Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Aggregations provide the ability to group and extract statistics from your data. The easiest way to think about aggregations is by roughly equating it to the SQL GROUP BY and the SQL aggregate functions. In Elasticsearch, you have the ability to execute searches returning hits and at the same time return aggregated results separate from the hits all in one response. This is very powerful and efficient in the sense that you can run queries and multiple aggregations and get the results back of both (or either) operations in one shot avoiding network roundtrips using a concise and simplified API.</simpara>
<simpara>To start with, this example groups all the accounts by state, and then returns the top 10 (default) states sorted by count descending (also default):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state"
      }
    }
  }
}'</programlisting>
<simpara>In SQL, the above aggregation is similar in concept to:</simpara>
<programlisting language="sh" linenumbering="unnumbered">SELECT state, COUNT(*) FROM bank GROUP BY state ORDER BY COUNT(*) DESC</programlisting>
<simpara>And the response (partially shown):</simpara>
<programlisting language="sh" linenumbering="unnumbered">  "hits" : {
    "total" : 1000,
    "max_score" : 0.0,
    "hits" : [ ]
  },
  "aggregations" : {
    "group_by_state" : {
      "buckets" : [ {
        "key" : "al",
        "doc_count" : 21
      }, {
        "key" : "tx",
        "doc_count" : 17
      }, {
        "key" : "id",
        "doc_count" : 15
      }, {
        "key" : "ma",
        "doc_count" : 15
      }, {
        "key" : "md",
        "doc_count" : 15
      }, {
        "key" : "pa",
        "doc_count" : 15
      }, {
        "key" : "dc",
        "doc_count" : 14
      }, {
        "key" : "me",
        "doc_count" : 14
      }, {
        "key" : "mo",
        "doc_count" : 14
      }, {
        "key" : "nd",
        "doc_count" : 14
      } ]
    }
  }
}</programlisting>
<simpara>We can see that there are 21 accounts in AL(abama), followed by 17 accounts in TX, followed by 15 accounts in ID(aho), and so forth.</simpara>
<simpara>Note that we set <literal>size=0</literal> to not show search hits because we only want to see the aggregation results in the response.</simpara>
<simpara>Building on the previous aggregation, this example calculates the average account balance by state (again only for the top 10 states sorted by count in descending order):</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state"
      },
      "aggs": {
        "average_balance": {
          "avg": {
            "field": "balance"
          }
        }
      }
    }
  }
}'</programlisting>
<simpara>Notice how we nested the <literal>average_balance</literal> aggregation inside the <literal>group_by_state</literal> aggregation. This is a common pattern for all the aggregations. You can nest aggregations inside aggregations arbitrarily to extract pivoted summarizations that you require from your data.</simpara>
<simpara>Building on the previous aggregation, let&#8217;s now sort on the average balance in descending order:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state",
        "order": {
          "average_balance": "desc"
        }
      },
      "aggs": {
        "average_balance": {
          "avg": {
            "field": "balance"
          }
        }
      }
    }
  }
}'</programlisting>
<simpara>This example demonstrates how we can group by age brackets (ages 20-29, 30-39, and 40-49), then by gender, and then finally get the average account balance, per age bracket, per gender:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_age": {
      "range": {
        "field": "age",
        "ranges": [
          {
            "from": 20,
            "to": 30
          },
          {
            "from": 30,
            "to": 40
          },
          {
            "from": 40,
            "to": 50
          }
        ]
      },
      "aggs": {
        "group_by_gender": {
          "terms": {
            "field": "gender"
          },
          "aggs": {
            "average_balance": {
              "avg": {
                "field": "balance"
              }
            }
          }
        }
      }
    }
  }
}'</programlisting>
<simpara>There are a many other aggregations capabilities that we won&#8217;t go into detail here. The <link linkend="search-aggregations">aggregations reference guide</link> is a great starting point if you want to do further experimentation.</simpara>
</section>
</chapter>
<chapter id="_conclusion">
<title>Conclusion<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/getting-started.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch is both a simple and complex product. We&#8217;ve so far learned the basics of what it is, how to look inside of it, and how to work with it using some of the REST APIs. I hope that this tutorial has given you a better understanding of what Elasticsearch is and more importantly, inspired you to further experiment with the rest of its great features!</simpara>
</chapter>
</part>
<part id="setup">
<title>Setup <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section includes information on how to setup <emphasis role="strong">elasticsearch</emphasis> and
get it running. If you haven&#8217;t already, <ulink url="http://www.elastic.co/downloads">download</ulink> it, and
then check the <link linkend="setup-installation">installation</link> docs.</simpara>
<note><simpara>Elasticsearch can also be installed from our repositories using <literal>apt</literal> or <literal>yum</literal>.
See <xref linkend="setup-repositories"/>.</simpara></note>
<bridgehead id="supported-platforms" renderas="sect1">Supported platforms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></bridgehead>
<simpara>The matrix of officially supported operating systems and JVMs is available here:
<ulink url="/support/matrix">Support Matrix</ulink>.  Elasticsearch is tested on the listed
platforms, but it is possible that it will work on other platforms too.</simpara>
<bridgehead id="setup-installation" renderas="sect1">Installation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></bridgehead>
<simpara>After <ulink url="/downloads/elasticsearch">downloading</ulink> the latest release and extracting it,
<emphasis role="strong">elasticsearch</emphasis> can be started using:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ bin/elasticsearch</programlisting>
<simpara>On *nix systems, the command will start the process in the foreground.</simpara>
<bridgehead id="setup-installation-daemon" renderas="sect2">Running as a daemon<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></bridgehead>
<simpara>To run it in the background, add the <literal>-d</literal> switch to it:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ bin/elasticsearch -d</programlisting>
<bridgehead id="setup-installation-pid" renderas="sect2">PID<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></bridgehead>
<simpara>The Elasticsearch process can write its PID to a specified file on startup,
making it easy to shut down the process later on:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ bin/elasticsearch -d -p pid <co id="CO1-1"/>
$ kill `cat pid` <co id="CO1-2"/></programlisting>
<calloutlist>
<callout arearefs="CO1-1">
<para>
The PID is written to a file called <literal>pid</literal>.
</para>
</callout>
<callout arearefs="CO1-2">
<para>
The <literal>kill</literal> command sends a <literal>TERM</literal> signal to the PID stored in the <literal>pid</literal> file.
</para>
</callout>
</calloutlist>
<note><simpara>The startup scripts provided for <link linkend="setup-service">Linux</link> and <link linkend="setup-service-win">Windows</link>
take care of starting and stopping the Elasticsearch process for you.</simpara></note>
<sidebar>
<title>*NIX</title>
<simpara>There are added features when using the <literal>elasticsearch</literal> shell script.
The first, which was explained earlier, is the ability to easily run the
process either in the foreground or the background.</simpara>
<simpara>Another feature is the ability to pass <literal>-D</literal> or getopt long style
configuration parameters directly to the script. When set, all override
anything set using either <literal>JAVA_OPTS</literal> or <literal>ES_JAVA_OPTS</literal>. For example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ bin/elasticsearch -Des.index.refresh_interval=5s --node.name=my-node</programlisting>
</sidebar>
<bridgehead id="jvm-version" renderas="sect1">Java (JVM) version<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch is built using Java, and requires at least
<ulink url="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 7</ulink> in
order to run. Only Oracle&#8217;s Java and the OpenJDK are supported. The same JVM
version should be used on all Elasticsearch nodes and clients.</simpara>
<simpara>We recommend installing the <emphasis role="strong">Java 8 update 20 or later</emphasis>, or <emphasis role="strong">Java 7 update 55
or later</emphasis>.  Previous versions of Java 7 are known to have bugs that can cause
index corruption and data loss.  Elasticsearch will refuse to start if a
known-bad version of Java is used.</simpara>
<simpara>The version of Java to use can be configured by setting the <literal>JAVA_HOME</literal>
environment variable.</simpara>
</partintro>
<chapter id="setup-configuration">
<title>Configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></title>
<bridgehead id="_environment_variables" renderas="sect2">Environment Variables<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Within the scripts, Elasticsearch comes with built in <literal>JAVA_OPTS</literal> passed
to the JVM started. The most important setting for that is the <literal>-Xmx</literal> to
control the maximum allowed memory for the process, and <literal>-Xms</literal> to
control the minimum allocated memory for the process (<emphasis>in general, the
more memory allocated to the process, the better</emphasis>).</simpara>
<simpara>Most times it is better to leave the default <literal>JAVA_OPTS</literal> as they are,
and use the <literal>ES_JAVA_OPTS</literal> environment variable in order to set / change
JVM settings or arguments.</simpara>
<simpara>The <literal>ES_HEAP_SIZE</literal> environment variable allows to set the heap memory
that will be allocated to elasticsearch java process. It will allocate
the same value to both min and max values, though those can be set
explicitly (not recommended) by setting <literal>ES_MIN_MEM</literal> (defaults to
<literal>256m</literal>), and <literal>ES_MAX_MEM</literal> (defaults to <literal>1g</literal>).</simpara>
<simpara>It is recommended to set the min and max memory to the same value, and
enable <link linkend="setup-configuration-memory"><literal>mlockall</literal></link>.</simpara>
<bridgehead id="system" renderas="sect2">System Configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="file-descriptors" renderas="sect3">File Descriptors<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<note><simpara>This is only relevant for Linux and macOS and can be safely ignored if running
Elasticsearch on Windows. On Windows that JVM uses an
<ulink url="https://msdn.microsoft.com/en-us/library/windows/desktop/aa363858(v=vs.85).aspx">API</ulink>
limited only by available resources.</simpara></note>
<simpara>Make sure to increase the number of open files descriptors on the
machine (or for the user running elasticsearch). Setting it to 32k or
even 64k is recommended.</simpara>
<simpara>In order to test how many open files the process can open, start it with
<literal>-Des.max-open-files</literal> set to <literal>true</literal>. This will print the number of open
files the process can open on startup.</simpara>
<simpara>Alternatively, you can retrieve the <literal>max_file_descriptors</literal> for each node
using the <xref linkend="cluster-nodes-info"/> API, with:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl localhost:9200/_nodes/stats/process?pretty</programlisting>
<bridgehead id="vm-max-map-count" renderas="sect3">Virtual memory<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch uses a <link linkend="default_fs"><literal>hybrid mmapfs / niofs</literal></link> directory by default to store its indices.  The default
operating system limits on mmap counts is likely to be too low, which may
result in out of memory exceptions.  On Linux, you can increase the limits by
running the following command as <literal>root</literal>:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sysctl -w vm.max_map_count=262144</programlisting>
<simpara>To set this value permanently, update the <literal>vm.max_map_count</literal> setting in
<literal>/etc/sysctl.conf</literal>.</simpara>
<note><simpara>If you installed Elasticsearch using a package (.deb, .rpm) this setting will be changed automatically.  To verify, run <literal>sysctl vm.max_map_count</literal>.</simpara></note>
<bridgehead id="setup-configuration-memory" renderas="sect3">Memory Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most operating systems try to use as much memory as possible for file system
caches and eagerly swap out unused application memory, possibly resulting
in the elasticsearch process being swapped. Swapping is very bad for
performance and for node stability, so it should be avoided at all costs.</simpara>
<simpara>There are three options:</simpara>
<itemizedlist>
<listitem>
<simpara>
<emphasis role="strong">Disable swap</emphasis>
</simpara>
<simpara>The simplest option is to completely disable swap. Usually Elasticsearch
is the only service running on a box, and its memory usage is controlled
by the <literal>ES_HEAP_SIZE</literal> environment variable.  There should be no need
to have swap enabled.</simpara>
<simpara>On Linux systems, you can disable swap temporarily
by running: <literal>sudo swapoff -a</literal>. To disable it permanently, you will need
to edit the <literal>/etc/fstab</literal> file and comment out any lines that contain the
word <literal>swap</literal>.</simpara>
<simpara>On Windows, the equivalent can be achieved by disabling the paging file entirely
via <literal>System Properties → Advanced → Performance → Advanced → Virtual memory</literal>.</simpara>
</listitem>
<listitem>
<simpara>
<emphasis role="strong">Configure <literal>swappiness</literal></emphasis>
</simpara>
<simpara>The second option is to ensure that the sysctl value <literal>vm.swappiness</literal> is set
to <literal>0</literal>. This reduces the kernel&#8217;s tendency to swap and should not lead to
swapping under normal circumstances, while still allowing the whole system
to swap in emergency conditions.</simpara>
<note><simpara>From kernel version 3.5-rc1 and above, a <literal>swappiness</literal> of <literal>0</literal> will
cause the OOM killer to kill the process instead of allowing swapping.
You will need to set <literal>swappiness</literal> to <literal>1</literal> to still allow swapping in
emergencies.</simpara></note>
</listitem>
<listitem>
<simpara>
<emphasis role="strong"><literal>mlockall</literal></emphasis>
</simpara>
<simpara>The third option is to use
<ulink url="http://opengroup.org/onlinepubs/007908799/xsh/mlockall.html">mlockall</ulink> on Linux/Unix systems, or <ulink url="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366895%28v=vs.85%29.aspx">VirtualLock</ulink> on Windows, to
try to lock the process address space into RAM, preventing any Elasticsearch
memory from being swapped out.  This can be done, by adding this line
to the <literal>config/elasticsearch.yml</literal> file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">bootstrap.memory_lock: true</programlisting>
<simpara>After starting Elasticsearch, you can see whether this setting was applied
successfully by checking the value of <literal>mlockall</literal> in the output from this
request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl http://localhost:9200/_nodes/process?pretty</programlisting>
<simpara>If you see that <literal>mlockall</literal> is <literal>false</literal>, then it means that the <literal>mlockall</literal>
request has failed.  The most probable reason, on Linux/Unix systems, is that
the user running Elasticsearch doesn&#8217;t have permission to lock memory.  This can
be granted by running <literal>ulimit -l unlimited</literal> as <literal>root</literal> before starting Elasticsearch.</simpara>
<simpara>Another possible reason why <literal>mlockall</literal> can fail is that the temporary directory
(usually <literal>/tmp</literal>) is mounted with the <literal>noexec</literal> option. This can be solved by
specifying a new temp directory, by starting Elasticsearch with:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/elasticsearch -Djna.tmpdir=/path/to/new/dir</programlisting>
<warning><simpara><literal>mlockall</literal> might cause the JVM or shell session to exit if it tries
to allocate more memory than is available!</simpara></warning>
</listitem>
</itemizedlist>
<bridgehead id="settings" renderas="sect2">Elasticsearch Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara><emphasis role="strong">elasticsearch</emphasis> configuration files can be found under <literal>ES_HOME/config</literal>
folder. The folder comes with two files, the <literal>elasticsearch.yml</literal> for
configuring Elasticsearch different
<link linkend="modules">modules</link>, and <literal>logging.yml</literal> for
configuring the Elasticsearch logging.</simpara>
<simpara>The configuration format is <ulink url="http://www.yaml.org/">YAML</ulink>. Here is an
example of changing the address all network based modules will use to
bind and publish to:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">network :
    host : 10.0.0.4</programlisting>
<bridgehead id="paths" renderas="sect3">Paths<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>In production use, you will almost certainly want to change paths for
data and log files:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path:
  logs: /var/log/elasticsearch
  data: /var/data/elasticsearch</programlisting>
<bridgehead id="cluster-name" renderas="sect3">Cluster name<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Also, don&#8217;t forget to give your production cluster a name, which is used
to discover and auto-join other nodes:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">cluster:
  name: &lt;NAME OF YOUR CLUSTER&gt;</programlisting>
<simpara>Make sure that you don&#8217;t reuse the same cluster names in different
environments, otherwise you might end up with nodes joining the wrong cluster.
For instance you could use <literal>logging-dev</literal>, <literal>logging-stage</literal>, and <literal>logging-prod</literal>
for the development, staging, and production clusters.</simpara>
<bridgehead id="node-name" renderas="sect3">Node name<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>You may also want to change the default node name for each node to
something like the display hostname. By default Elasticsearch will
randomly pick a Marvel character name from a list of around 3000 names
when your node starts up.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node:
  name: &lt;NAME OF YOUR NODE&gt;</programlisting>
<simpara>The hostname of the machine is provided in the environment
variable <literal>HOSTNAME</literal>. If on your machine you only run a
single elasticsearch node for that cluster, you can set
the node name to the hostname using the <literal>${...}</literal> notation:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node:
  name: ${HOSTNAME}</programlisting>
<bridgehead id="styles" renderas="sect3">Configuration styles<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Internally, all settings are collapsed into "namespaced" settings. For
example, the above gets collapsed into <literal>node.name</literal>. This means that
its easy to support other configuration formats, for example,
<ulink url="http://www.json.org">JSON</ulink>. If JSON is a preferred configuration format,
simply rename the <literal>elasticsearch.yml</literal> file to <literal>elasticsearch.json</literal> and
add:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">{
    "network" : {
        "host" : "10.0.0.4"
    }
}</programlisting>
<simpara>It also means that its easy to provide the settings externally either
using the <literal>ES_JAVA_OPTS</literal> or as parameters to the <literal>elasticsearch</literal>
command, for example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ elasticsearch -Des.network.host=10.0.0.4</programlisting>
<simpara>Another option is to set <literal>es.default.</literal> prefix instead of <literal>es.</literal> prefix,
which means the default setting will be used only if not explicitly set
in the configuration file.</simpara>
<simpara>Another option is to use the <literal>${...}</literal> notation within the configuration
file which will resolve to an environment setting, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "network" : {
        "host" : "${ES_NET_HOST}"
    }
}</programlisting>
<simpara>Additionally, for settings that you do not wish to store in the configuration
file, you can use the value <literal>${prompt.text}</literal> or <literal>${prompt.secret}</literal> and start
Elasticsearch in the foreground. <literal>${prompt.secret}</literal> has echoing disabled so
that the value entered will not be shown in your terminal; <literal>${prompt.text}</literal>
will allow you to see the value as you type it in. For example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node:
  name: ${prompt.text}</programlisting>
<simpara>On execution of the <literal>elasticsearch</literal> command, you will be prompted to enter
the actual value like so:</simpara>
<programlisting language="sh" linenumbering="unnumbered">Enter value for [node.name]:</programlisting>
<note><simpara>Elasticsearch will not start if <literal>${prompt.text}</literal> or <literal>${prompt.secret}</literal>
is used in the settings and the process is run as a service or in the background.</simpara></note>
<bridgehead id="configuration-index-settings" renderas="sect2">Index Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Indices created within the cluster can provide their own settings. For
example, the following creates an index with a refresh interval of 5
seconds instead of the default refresh interval (the format can be either
YAML or JSON):</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ curl -XPUT http://localhost:9200/kimchy/ -d \
'
index:
    refresh_interval: 5s
'</programlisting>
<simpara>Index level settings can be set on the node level as well, for example,
within the <literal>elasticsearch.yml</literal> file, the following can be set:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index :
    refresh_interval: 5s</programlisting>
<simpara>This means that every index that gets created on the specific node
started with the mentioned configuration will use a refresh interval of
5 seconds <emphasis role="strong">unless the index explicitly sets it</emphasis>. In other words, any
index level settings override what is set in the node configuration. Of
course, the above can also be set as a "collapsed" setting, for example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ elasticsearch -Des.index.refresh_interval=5s</programlisting>
<simpara>All of the index level configuration can be found within each
<link linkend="index-modules">index module</link>.</simpara>
<bridgehead id="logging" renderas="sect2">Logging<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch uses an internal logging abstraction and comes, out of the
box, with <ulink url="http://logging.apache.org/log4j/1.2/">log4j</ulink>. It tries to simplify
log4j configuration by using <ulink url="http://www.yaml.org/">YAML</ulink> to configure it,
and the logging configuration file is <literal>config/logging.yml</literal>. The
<ulink url="http://en.wikipedia.org/wiki/JSON">JSON</ulink> and
<ulink url="http://en.wikipedia.org/wiki/.properties">properties</ulink> formats are also
supported. Multiple configuration files can be loaded, in which case they will
get merged, as long as they start with the <literal>logging.</literal> prefix and end with one
of the supported suffixes (either <literal>.yml</literal>, <literal>.yaml</literal>, <literal>.json</literal> or <literal>.properties</literal>).
The logger section contains the java packages and their corresponding log
level, where it is possible to omit the <literal>org.elasticsearch</literal> prefix. The
appender section contains the destinations for the logs. Extensive information
on how to customize logging and all the supported appenders can be found on
the <ulink url="http://logging.apache.org/log4j/1.2/manual.html">log4j documentation</ulink>.</simpara>
<simpara>Additional Appenders and other logging classes provided by
<ulink url="http://logging.apache.org/log4j/extras/">log4j-extras</ulink> are also available,
out of the box.</simpara>
<bridgehead id="deprecation-logging" renderas="sect3">Deprecation logging<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/configuration.asciidoc">Edit me</ulink></bridgehead>
<simpara>In addition to regular logging, Elasticsearch allows you to enable logging
of deprecated actions. For example this allows you to determine early, if
you need to migrate certain functionality in the future. By default,
deprecation logging is disabled. You can enable it in the <literal>config/logging.yml</literal>
file by setting the deprecation log level to <literal>DEBUG</literal>.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">deprecation: DEBUG, deprecation_log_file</programlisting>
<simpara>This will create a daily rolling deprecation log file in your log directory.
Check this file regularly, especially when you intend to upgrade to a new
major version.</simpara>
</chapter>
<chapter id="setup-service">
<title>Running as a Service on Linux<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></title>
<simpara>In order to run elasticsearch as a service on your operating system, the provided packages try to make it as easy as possible for you to start and stop elasticsearch during reboot and upgrades.</simpara>
<bridgehead id="_linux" renderas="sect2">Linux<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<simpara>Currently our build automatically creates a debian package and an RPM package, which is available on the download page. The package itself does not have any dependencies, but you have to make sure that you installed a JDK.</simpara>
<simpara>Each package features a configuration file, which allows you to set the following parameters</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>ES_USER</literal>
</simpara>
</entry>
<entry>
<simpara>
The user to run as, defaults to <literal>elasticsearch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_GROUP</literal>
</simpara>
</entry>
<entry>
<simpara>
The group to run as, defaults to <literal>elasticsearch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_HEAP_SIZE</literal>
</simpara>
</entry>
<entry>
<simpara>
The heap size to start with
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_HEAP_NEWSIZE</literal>
</simpara>
</entry>
<entry>
<simpara>
The size of the new generation heap
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_DIRECT_SIZE</literal>
</simpara>
</entry>
<entry>
<simpara>
The maximum size of the direct memory
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>MAX_OPEN_FILES</literal>
</simpara>
</entry>
<entry>
<simpara>
Maximum number of open files, defaults to <literal>65536</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>MAX_LOCKED_MEMORY</literal>
</simpara>
</entry>
<entry>
<simpara>
Maximum locked memory size. Set to "unlimited" if you use the bootstrap.memory_lock option in elasticsearch.yml. You must also set ES_HEAP_SIZE.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>MAX_MAP_COUNT</literal>
</simpara>
</entry>
<entry>
<simpara>
Maximum number of memory map areas a process may have. If you use <literal>mmapfs</literal> as index store type, make sure this is set to a high value. For more information, check the <ulink url="https://github.com/torvalds/linux/blob/master/Documentation/sysctl/vm.txt">linux kernel documentation</ulink> about <literal>max_map_count</literal>. This is set via <literal>sysctl</literal> before starting elasticsearch. Defaults to <literal>65535</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>LOG_DIR</literal>
</simpara>
</entry>
<entry>
<simpara>
Log directory, defaults to <literal>/var/log/elasticsearch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>DATA_DIR</literal>
</simpara>
</entry>
<entry>
<simpara>
Data directory, defaults to <literal>/var/lib/elasticsearch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>CONF_DIR</literal>
</simpara>
</entry>
<entry>
<simpara>
Configuration file directory (which needs to include <literal>elasticsearch.yml</literal> and <literal>logging.yml</literal> files), defaults to <literal>/etc/elasticsearch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_JAVA_OPTS</literal>
</simpara>
</entry>
<entry>
<simpara>
Any additional java options you may want to apply. This may be useful, if you need to set the <literal>node.name</literal> property, but do not want to change the <literal>elasticsearch.yml</literal> configuration file, because it is distributed via a provisioning system like puppet or chef. Example: <literal>ES_JAVA_OPTS="-Des.node.name=search-01"</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>RESTART_ON_UPGRADE</literal>
</simpara>
</entry>
<entry>
<simpara>
Configure restart on package upgrade, defaults to <literal>false</literal>. This means you will have to restart your elasticsearch instance after installing a package manually. The reason for this is to ensure, that upgrades in a cluster do not result in a continuous shard reallocation resulting in high network traffic and reducing the response times of your cluster.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ES_GC_LOG_FILE</literal> 
</simpara>
</entry>
<entry>
<simpara>
The absolute log file path for creating a garbage collection logfile, which is done by the JVM. Note that this logfile can grow pretty quick and thus is disabled by default.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_debian_ubuntu" renderas="sect3">Debian/Ubuntu<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<simpara>The debian package ships with everything you need as it uses standard debian tools like update <literal>update-rc.d</literal> to define the runlevels it runs on. The init script is placed at <literal>/etc/init.d/elasticsearch</literal> as you would expect it. The configuration file is placed at <literal>/etc/default/elasticsearch</literal>.</simpara>
<simpara>The debian package does not start up the service by default. The reason for this is to prevent the instance to accidentally join a cluster, without being configured appropriately. After installing using <literal>dpkg -i</literal> you can use the following commands to ensure, that elasticsearch starts when the system is booted and then start up elasticsearch:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo update-rc.d elasticsearch defaults 95 10
sudo /etc/init.d/elasticsearch start</programlisting>
<simpara>Users running Debian 8 or Ubuntu 14 or later may require configuration of systemd instead of <literal>update-rc.d</literal>. In those cases, please refer to the <xref linkend="using-systemd"/> section.</simpara>
<bridgehead id="_installing_the_oracle_jdk" renderas="sect4">Installing the oracle JDK<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<simpara>The usual recommendation is to run the Oracle JDK with elasticsearch. However Ubuntu and Debian only ship the OpenJDK due to license issues. You can easily install the oracle installer package though. In case you are missing the <literal>add-apt-repository</literal> command under Debian GNU/Linux, make sure have at least Debian Jessie and the package <literal>python-software-properties</literal> installed</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java8-installer
java -version</programlisting>
<simpara>The last command should verify a successful installation of the Oracle JDK.</simpara>
<bridgehead id="_rpm_based_distributions" renderas="sect3">RPM based distributions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_using_chkconfig" renderas="sect4">Using chkconfig<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<simpara>Some RPM based distributions are using <literal>chkconfig</literal> to enable and disable services. The init script is located at <literal>/etc/init.d/elasticsearch</literal>, where as the configuration file is placed at <literal>/etc/sysconfig/elasticsearch</literal>. Like the debian package the RPM package is not started by default after installation, you have to do this manually by entering the following commands</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo /sbin/chkconfig --add elasticsearch
sudo service elasticsearch start</programlisting>
<bridgehead id="using-systemd" renderas="sect3">Using systemd<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service.asciidoc">Edit me</ulink></bridgehead>
<simpara>Distributions like Debian Jessie, Ubuntu 14, and many of the SUSE derivatives do not use the <literal>chkconfig</literal> tool to register services, but rather <literal>systemd</literal> and its command <literal>/bin/systemctl</literal> to start and stop services (at least in newer versions, otherwise use the <literal>chkconfig</literal> commands above). The configuration file is also placed at <literal>/etc/sysconfig/elasticsearch</literal> if the system is rpm based and <literal>/etc/default/elasticsearch</literal> if it is deb. After installing the RPM, you have to change the systemd configuration and then start up elasticsearch</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service
sudo /bin/systemctl start elasticsearch.service</programlisting>
<simpara>Also note that changing the <literal>MAX_MAP_COUNT</literal> setting in <literal>/etc/sysconfig/elasticsearch</literal> does not have any effect, you will have to change it in <literal>/usr/lib/sysctl.d/elasticsearch.conf</literal> in order to have it applied at startup.</simpara>
</chapter>
<chapter id="setup-service-win">
<title>Running as a Service on Windows<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service-win.asciidoc">Edit me</ulink></title>
<simpara>Windows users can configure Elasticsearch to run as a service to run in the background or start automatically
at startup without any user interaction.
This can be achieved through <literal>service.bat</literal> script under <literal>bin/</literal> folder which allows one to install,
remove, manage or configure the service and potentially start and stop the service, all from the command-line.</simpara>
<programlisting language="sh" linenumbering="unnumbered">c:\elasticsearch-2.4.2\bin&gt;service

Usage: service.bat install|remove|start|stop|manager [SERVICE_ID]</programlisting>
<simpara>The script requires one parameter (the command to execute) followed by an optional one indicating the service
id (useful when installing multiple Elasticsearch services).</simpara>
<simpara>The commands available are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>install</literal>
</simpara>
</entry>
<entry>
<simpara>
Install Elasticsearch as a service
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>remove</literal>
</simpara>
</entry>
<entry>
<simpara>
Remove the installed Elasticsearch service (and stop the service if started)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>start</literal>
</simpara>
</entry>
<entry>
<simpara>
Start the Elasticsearch service (if installed)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stop</literal>
</simpara>
</entry>
<entry>
<simpara>
Stop the Elasticsearch service (if started)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>manager</literal>
</simpara>
</entry>
<entry>
<simpara>
Start a GUI for managing the installed service
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Note that the environment configuration options available during the installation are copied and will be used during
the service lifecycle. This means any changes made to them after the installation will not be picked up unless
the service is reinstalled.</simpara>
<simpara>Based on the architecture of the available JDK/JRE (set through <literal>JAVA_HOME</literal>), the appropriate 64-bit(x64) or 32-bit(x86)
service will be installed. This information is made available during install:</simpara>
<programlisting language="sh" linenumbering="unnumbered">c:\elasticsearch-{version}bin&gt;service install
Installing service      :  "elasticsearch-service-x64"
Using JAVA_HOME (64-bit):  "c:\jvm\jdk1.8"
The service 'elasticsearch-service-x64' has been installed.</programlisting>
<note><simpara>While a JRE can be used for the Elasticsearch service, due to its use of a client VM (as oppose to a server JVM which
offers better performance for long-running applications) its usage is discouraged and a warning will be issued.</simpara></note>
<bridgehead id="_customizing_service_settings" renderas="sect2">Customizing service settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/as-a-service-win.asciidoc">Edit me</ulink></bridgehead>
<simpara>There are two ways to customize the service settings:</simpara>
<variablelist>
<varlistentry>
<term>
Manager GUI
</term>
<listitem>
<simpara>
accessible through <literal>manager</literal> command, the GUI offers insight into the installed service including its status, startup type,
JVM, start and stop settings among other things. Simply invoking <literal>service.bat</literal> from the command-line with the aforementioned option
will open up the manager window:
</simpara>
</listitem>
</varlistentry>
</variablelist>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/service-manager-win.png" align="center"/>
  </imageobject>
  <textobject><phrase>Windows Service Manager GUI</phrase></textobject>
</mediaobject>
</informalfigure>
<variablelist>
<varlistentry>
<term>
Customizing <literal>service.bat</literal>
</term>
<listitem>
<simpara>
at its core, <literal>service.bat</literal> relies on <ulink url="http://commons.apache.org/proper/commons-daemon/">Apache Commons Daemon</ulink> project
to install the services. For full flexibility such as customizing the user under which the service runs, one can modify the installation
parameters to tweak all the parameters accordingly. Do note that this requires reinstalling the service for the new settings to be applied.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>There is also a community supported customizable MSI installer available: <ulink url="https://github.com/salyh/elasticsearch-msi-installer">https://github.com/salyh/elasticsearch-msi-installer</ulink> (by Hendrik Saly).</simpara></note>
</chapter>
<chapter id="setup-dir-layout">
<title>Directory Layout<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/dir-layout.asciidoc">Edit me</ulink></title>
<simpara>The directory layout of an installation is as follows:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top"> Type </entry>
<entry align="left" valign="top"> Description </entry>
<entry align="left" valign="top"> Default Location </entry>
<entry align="left" valign="top"> Setting</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">home</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Home of elasticsearch installation.</simpara></entry>
<entry align="left" valign="top"><simpara><literal></literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.home</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">bin</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Binary scripts including <literal>elasticsearch</literal> to start a node.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.home}/bin</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal></literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">conf</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Configuration files including <literal>elasticsearch.yml</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.home}/config</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.conf</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">data</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The location of the data files of each index / shard allocated
on the node. Can hold multiple locations.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.home}/data</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.data</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">logs</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log files location.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.home}/logs</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.logs</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">plugins</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Plugin files location. Each plugin will be contained in a subdirectory.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.home}/plugins</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.plugins</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">repo</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Shared file system repository locations. Can hold multiple locations. A file system repository can be placed in to any subdirectory of any directory specified here.</simpara></entry>
<entry align="left" valign="top"><simpara>Not configured</simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.repo</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">script</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Location of script files.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{path.conf}/scripts</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>path.scripts</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Multiple <literal>data</literal> paths may be specified, in order to spread data across
multiple disks or locations, but all of the files from a single shard will be
written to the same path. This can be configured as follows:</simpara>
<literallayout class="monospaced">---------------------------------
path.data: /mnt/first,/mnt/second
---------------------------------</literallayout>
<simpara>Or  in an array format:</simpara>
<literallayout class="monospaced">----------------------------------------
path.data: ["/mnt/first", "/mnt/second"]
----------------------------------------</literallayout>
<tip><simpara>To stripe shards across multiple disks, please use a RAID driver
instead.</simpara></tip>
<bridgehead id="default-paths" renderas="sect2">Default Paths<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/dir-layout.asciidoc">Edit me</ulink></bridgehead>
<simpara>Below are the default paths that elasticsearch will use, if not explicitly changed.</simpara>
<bridgehead id="_deb_and_rpm" renderas="sect3">deb and rpm<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/dir-layout.asciidoc">Edit me</ulink></bridgehead>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top"> Type </entry>
<entry align="left" valign="top"> Description </entry>
<entry align="left" valign="top"> Location Debian/Ubuntu </entry>
<entry align="left" valign="top"> Location RHEL/CentOS</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">home</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Home of elasticsearch installation.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">bin</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Binary scripts including <literal>elasticsearch</literal> to start a node.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch/bin</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch/bin</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">conf</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Configuration files <literal>elasticsearch.yml</literal> and <literal>logging.yml</literal>.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/elasticsearch</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/elasticsearch</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">conf</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Environment variables including heap size, file descriptors.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/default/elasticsearch</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/elasticsearch</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">data</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The location of the data files of each index / shard allocated
on the node.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/lib/elasticsearch/data</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/lib/elasticsearch</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">logs</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log files location</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/log/elasticsearch</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/var/log/elasticsearch</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">plugins</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Plugin files location. Each plugin will be contained in a subdirectory.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch/plugins</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/usr/share/elasticsearch/plugins</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">repo</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Shared file system repository locations.</simpara></entry>
<entry align="left" valign="top"><simpara>Not configured</simpara></entry>
<entry align="left" valign="top"><simpara>Not configured</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">script</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Location of script files.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/elasticsearch/scripts</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/elasticsearch/scripts</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_zip_and_tar_gz" renderas="sect3">zip and tar.gz<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/dir-layout.asciidoc">Edit me</ulink></bridgehead>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top"> Type </entry>
<entry align="left" valign="top"> Description </entry>
<entry align="left" valign="top"> Location</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">home</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Home of elasticsearch installation</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">bin</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Binary scripts including <literal>elasticsearch</literal> to start a node</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/bin</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">conf</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Configuration files <literal>elasticsearch.yml</literal> and <literal>logging.yml</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/config</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">data</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The location of the data files of each index / shard allocated
on the node</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/data</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">logs</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log files location</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/logs</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">plugins</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Plugin files location. Each plugin will be contained in a subdirectory</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/plugins</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">repo</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Shared file system repository locations.</simpara></entry>
<entry align="left" valign="top"><simpara>Not configured</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">script</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Location of script files.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>{extract.path}/config/scripts</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</chapter>
<chapter id="setup-repositories">
<title>Repositories<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/repositories.asciidoc">Edit me</ulink></title>
<simpara>We also have repositories available for APT and YUM based distributions. Note that we only provide
binary packages, but no source packages, as the packages are created as part of the Elasticsearch
build.</simpara>
<simpara>We have split the major versions in separate urls to avoid accidental upgrades across major version.
For all 2.x releases use 2.x as version number, for 3.x.y use 3.x etc&#8230;</simpara>
<simpara>We use the PGP key <ulink url="https://pgp.mit.edu/pks/lookup?op=vindex&amp;search=0xD27D666CD88E42B4">D88E42B4</ulink>,
Elasticsearch Signing Key, with fingerprint</simpara>
<literallayout class="monospaced">4609 5ACC 8548 582C 1A26 99A9 D27D 666C D88E 42B4</literallayout>
<simpara>to sign all our packages. It is available from <ulink url="https://pgp.mit.edu">https://pgp.mit.edu</ulink>.</simpara>
<bridgehead id="_apt" renderas="sect2">APT<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/repositories.asciidoc">Edit me</ulink></bridgehead>
<simpara>Download and install the Public Signing Key:</simpara>
<programlisting language="sh" linenumbering="unnumbered">wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</programlisting>
<simpara>Save the repository definition to  <literal>/etc/apt/sources.list.d/elasticsearch-2.x.list</literal>:</simpara>
<programlisting language="sh" linenumbering="unnumbered">echo "deb https://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list</programlisting>
<warning>
<simpara>Use the <literal>echo</literal> method described above to add the Elasticsearch repository.  Do not use <literal>add-apt-repository</literal>
as it will add a <literal>deb-src</literal> entry as well, but we do not provide a source package.
If you have added the <literal>deb-src</literal> entry, you will see an error like
the following:</simpara>
<literallayout class="monospaced">Unable to find expected entry 'main/source/Sources' in Release file (Wrong sources.list entry or malformed file)</literallayout>
<simpara>Just delete the <literal>deb-src</literal> entry from the <literal>/etc/apt/sources.list</literal> file and the installation should work as expected.</simpara>
</warning>
<simpara>Run apt-get update and the repository is ready for use. You can install it with:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo apt-get update &amp;&amp; sudo apt-get install elasticsearch</programlisting>
<warning>
<simpara>If two entries exist for the same Elasticsearch repository, you will see an error like this during <literal>apt-get update</literal>:</simpara>
<literallayout class="monospaced">Duplicate sources.list entry https://packages.elastic.co/elasticsearch/2.x/debian/ ...`</literallayout>
<simpara>Examine <literal>/etc/apt/sources.list.d/elasticsearch-2.x.list</literal> for the duplicate entry or locate the duplicate entry amongst the files in <literal>/etc/apt/sources.list.d/</literal> and the <literal>/etc/apt/sources.list</literal> file.</simpara>
</warning>
<simpara>Configure Elasticsearch to automatically start during bootup. If your
distribution is using SysV init, then you will need to run:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo update-rc.d elasticsearch defaults 95 10</programlisting>
<simpara>Otherwise if your distribution is using systemd:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service</programlisting>
<bridgehead id="_yum_dnf" renderas="sect2">YUM / DNF<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/repositories.asciidoc">Edit me</ulink></bridgehead>
<simpara>Download and install the public signing key:</simpara>
<programlisting language="sh" linenumbering="unnumbered">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</programlisting>
<simpara>Add the following in your <literal>/etc/yum.repos.d/</literal> directory
in a file with a <literal>.repo</literal> suffix, for example <literal>elasticsearch.repo</literal></simpara>
<programlisting language="sh" linenumbering="unnumbered">[elasticsearch-2.x]
name=Elasticsearch repository for 2.x packages
baseurl=https://packages.elastic.co/elasticsearch/2.x/centos
gpgcheck=1
gpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch
enabled=1</programlisting>
<simpara>And your repository is ready for use. You can install it with:</simpara>
<programlisting language="sh" linenumbering="unnumbered">yum install elasticsearch</programlisting>
<simpara>Or, for newer versions of Fedora and Redhat:</simpara>
<programlisting language="sh" linenumbering="unnumbered">dnf install elasticsearch</programlisting>
<simpara>Configure Elasticsearch to automatically start during bootup. If your
distribution is using SysV <literal>init</literal> (check with <literal>ps -p 1</literal>), then you will need to run:</simpara>
<warning><simpara>The repositories do not work with older rpm based distributions
         that still use RPM v3, like CentOS5.</simpara></warning>
<programlisting language="sh" linenumbering="unnumbered">chkconfig --add elasticsearch</programlisting>
<simpara>Otherwise if your distribution is using <literal>systemd</literal>:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service</programlisting>
</chapter>
<chapter id="setup-upgrade">
<title>Upgrading<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/upgrade.asciidoc">Edit me</ulink></title>
<important>
<simpara>Before upgrading Elasticsearch:</simpara>
<itemizedlist>
<listitem>
<simpara>
Consult the <link linkend="breaking-changes">breaking changes</link> docs.
</simpara>
</listitem>
<listitem>
<simpara>
Test upgrades in a dev environment before upgrading your production cluster.
</simpara>
</listitem>
<listitem>
<simpara>
Always back up your data before upgrading. You cannot roll back to an earlier
  version unless you have a <link linkend="backup">backup</link> of your data.
</simpara>
</listitem>
</itemizedlist>
</important>
<simpara>Elasticsearch can usually be upgraded using a rolling upgrade process,
resulting in no interruption of service.  This section details how to perform
both rolling upgrades and upgrades with full cluster restarts.</simpara>
<simpara>To determine whether a rolling upgrade is supported for your release, please
consult this table:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="60*"/>
<thead>
<row>
<entry align="left" valign="top">Upgrade From   </entry>
<entry align="left" valign="top">Upgrade To     </entry>
<entry align="left" valign="top">Supported Upgrade Type</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>0.90.x</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>2.x</literal></simpara></entry>
<entry align="left" valign="top"><simpara><link linkend="restart-upgrade">Full cluster restart</link></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>1.x</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>2.x</literal></simpara></entry>
<entry align="left" valign="top"><simpara><link linkend="restart-upgrade">Full cluster restart</link></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>2.x</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>2.y</literal></simpara></entry>
<entry align="left" valign="top"><simpara><link linkend="rolling-upgrades">Rolling upgrade</link> (where `y &gt; x `)</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<informalexample>
<simpara>Upgrading Elasticsearch with Plugins</simpara>
<simpara>Take plugins into consideration as well when upgrading. Plugins must be upgraded alongside Elasticsearch.</simpara>
<simpara>Check with your plugin&#8217;s provider to ensure that the plugin is compatible with
your targeted version of Elasticsearch. If doing a rolling upgrade, it may be
worth checking as well that the plugin works across a mixed-version cluster.
Most plugins will have to be upgraded alongside Elasticsearch, although some
plugins accessed primarily through the browser (<literal>_site</literal> plugins) may continue to
work given that API changes are compatible.</simpara>
<simpara>The process for both <link linkend="rolling-upgrades">Rolling upgrade</link> and
<link linkend="restart-upgrade">Full cluster restart</link> is generally as follows, per node.</simpara>
<itemizedlist>
<listitem>
<simpara>
Shut down Elasticsearch
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Elasticsearch
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Plugins
</simpara>
</listitem>
<listitem>
<simpara>
Start up Elasticsearch
</simpara>
</listitem>
</itemizedlist>
</informalexample>
<section id="backup">
<title>Back Up Your Data!<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>Always back up your data before performing an upgrade.  This will allow you to
roll back in the event of a problem.  The upgrades sometimes include upgrades
to the Lucene libraries used by Elasticsearch to access the index files, and
after an index file has been updated to work with a new version of Lucene, it
may not be accessible to the versions of Lucene present in earlier
Elasticsearch releases.</simpara>
<warning>
<title>Always back up your data before upgrading</title>
<simpara>You cannot roll back to an earlier version unless you have a backup of your data.</simpara>
</warning>
<section id="_backing_up_1_0_and_later">
<title>Backing up 1.0 and later<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>To back up a running 1.0 or later system, it is simplest to use the snapshot
feature.  See the complete instructions for
<link linkend="modules-snapshots">backup and restore with snapshots</link>.</simpara>
</section>
<section id="_backing_up_0_90_x_and_earlier">
<title>Backing up 0.90.x and earlier<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>To back up a running 0.90.x system:</simpara>
<section id="_step_1_disable_index_flushing">
<title>Step 1: Disable index flushing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>This will prevent indices from being flushed to disk while the backup is in
process:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_all/_settings
{
  "index": {
    "translog.disable_flush": "true"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_2_disable_reallocation">
<title>Step 2: Disable reallocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>This will prevent the cluster from moving data files from one node to another
while the backup is in process:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.enable": "none"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_3_backup_your_data">
<title>Step 3: Backup your data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>After reallocation and index flushing are disabled, initiate a backup of
Elasticsearch&#8217;s data path using your favorite backup method (tar, storage
array snapshots, backup software).</simpara>
</section>
<section id="_step_4_reenable_allocation_and_flushing">
<title>Step 4: Reenable allocation and flushing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/backup.asciidoc">Edit me</ulink></title>
<simpara>When the backup is complete and data no longer needs to be read from the
Elasticsearch data path, allocation and index flushing must be re-enabled:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_all/_settings
{
  "index": {
    "translog.disable_flush": "false"
  }
}

PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.enable": "all"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
</section>
</section>
<section id="rolling-upgrades">
<title>Rolling upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>A rolling upgrade allows the Elasticsearch cluster to be upgraded one node at
a time, with no downtime for end users.  Running multiple versions of
Elasticsearch in the same cluster for any length of time beyond that required
for an upgrade is not supported, as shards will not be replicated from the
more recent version to the older version.</simpara>
<simpara>Consult this <link linkend="setup-upgrade">table</link> to verify that rolling upgrades are
supported for your version of Elasticsearch.</simpara>
<simpara>To perform a rolling upgrade:</simpara>
<section id="_step_1_disable_shard_allocation">
<title>Step 1: Disable shard allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>When you shut down a node, the allocation process will immediately try to
replicate the shards that were on that node to other nodes in the cluster,
causing a lot of wasted I/O.  This can be avoided by disabling allocation
before shutting down a node:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.enable": "none"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_2_stop_non_essential_indexing_and_perform_a_synced_flush_optional">
<title>Step 2: Stop non-essential indexing and perform a synced flush (Optional)<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>You may happily continue indexing during the upgrade.  However, shard recovery
will be much faster if you temporarily stop non-essential indexing and issue a
<link linkend="indices-synced-flush">synced-flush</link> request:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_flush/synced</programlisting>
<remark> AUTOSENSE</remark>
<simpara>A synced flush request is a &#8220;best effort&#8221; operation. It will fail if there
are any pending indexing operations, but it is safe to reissue the request
multiple times if necessary.</simpara>
</section>
<section id="upgrade-node">
<title>Step 3: Stop and upgrade a single node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>Shut down one of the nodes in the cluster <emphasis role="strong">before</emphasis> starting the upgrade.</simpara>
<tip>
<simpara>When using the zip or tarball packages, the <literal>config</literal>, <literal>data</literal>, <literal>logs</literal> and
<literal>plugins</literal> directories are placed within the Elasticsearch home directory by
default.</simpara>
<simpara>It is a good idea to place these directories in a different location so that
there is no chance of deleting them when upgrading Elasticsearch.  These
custom paths can be <link linkend="paths">configured</link> with the <literal>path.conf</literal> and
<literal>path.data</literal> settings.</simpara>
<simpara>The Debian and RPM packages place these directories in the
<link linkend="setup-dir-layout">appropriate place</link> for each operating system.</simpara>
</tip>
<simpara>To upgrade using a <link linkend="setup-repositories">Debian or RPM</link> package:</simpara>
<itemizedlist>
<listitem>
<simpara>
Use <literal>rpm</literal> or <literal>dpkg</literal> to install the new package.  All files should be
    placed in their proper locations, and config files should not be
    overwritten.
</simpara>
</listitem>
</itemizedlist>
<simpara>To upgrade using a zip or compressed tarball:</simpara>
<itemizedlist>
<listitem>
<simpara>
Extract the zip or tarball to a new directory, to be sure that you don&#8217;t
    overwrite the <literal>config</literal> or <literal>data</literal> directories.
</simpara>
</listitem>
<listitem>
<simpara>
Either copy the files in the <literal>config</literal> directory from your old installation
    to your new installation, or use the <literal>--path.conf</literal> option on the command
    line to point to an external config directory.
</simpara>
</listitem>
<listitem>
<simpara>
Either copy the files in the <literal>data</literal> directory from your old installation
    to your new installation, or configure the location of the data directory
    in the <literal>config/elasticsearch.yml</literal> file, with the <literal>path.data</literal> setting.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_step_4_start_the_upgraded_node">
<title>Step 4: Start the upgraded node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>Start the now upgraded node and confirm that it joins the cluster by checking
the log file or by checking the output of this request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET _cat/nodes</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_5_reenable_shard_allocation">
<title>Step 5: Reenable shard allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>Once the node has joined the cluster, reenable shard allocation to start using
the node:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.enable": "all"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_6_wait_for_the_node_to_recover">
<title>Step 6: Wait for the node to recover<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>You should wait for the cluster to finish shard allocation before upgrading
the next node.  You can check on progress with the <link linkend="cat-health"><literal>_cat/health</literal></link>
request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET _cat/health</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Wait for the <literal>status</literal> column to move from <literal>yellow</literal> to <literal>green</literal>.  Status <literal>green</literal>
means that all primary and replica shards have been allocated.</simpara>
<important>
<simpara>During a rolling upgrade, primary shards assigned to a node with the higher
version will never have their replicas assigned to a node with the lower
version, because the newer version may have a different data format which is
not understood by the older version.</simpara>
<simpara>If it is not possible to assign the replica shards to another node with the
higher version&#8201;&#8212;&#8201;e.g. if there is only one node with the higher version in
the cluster&#8201;&#8212;&#8201;then the replica shards will remain unassigned and the
cluster health will remain status <literal>yellow</literal>.</simpara>
<simpara>In this case, check that there are no initializing or relocating shards (the
<literal>init</literal> and <literal>relo</literal> columns) before proceding.</simpara>
<simpara>As soon as another node is upgraded, the replicas should be assigned and the
cluster health will reach status <literal>green</literal>.</simpara>
</important>
<simpara>Shards that have not been <link linkend="indices-synced-flush">sync-flushed</link> may take some time to
recover.  The recovery status of individual shards can be monitored with the
<link linkend="cat-recovery"><literal>_cat/recovery</literal></link> request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET _cat/recovery</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If you stopped indexing, then it is safe to resume indexing as soon as
recovery has completed.</simpara>
</section>
<section id="_step_7_repeat">
<title>Step 7: Repeat<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/rolling_upgrade.asciidoc">Edit me</ulink></title>
<simpara>When the cluster is stable and the node has recovered, repeat the above steps
for all remaining nodes.</simpara>
</section>
</section>
<section id="restart-upgrade">
<title>Full cluster restart upgrade<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch requires a full cluster restart when upgrading across major
versions: from 0.x to 1.x or from 1.x to 2.x.  Rolling upgrades are not
supported across major versions.</simpara>
<simpara>The process to perform an upgrade with a full cluster restart is as follows:</simpara>
<section id="_step_1_disable_shard_allocation_2">
<title>Step 1: Disable shard allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>When you shut down a node, the allocation process will immediately try to
replicate the shards that were on that node to other nodes in the cluster,
causing a lot of wasted I/O.  This can be avoided by disabling allocation
before shutting down a node:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.enable": "none"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If upgrading from 0.90.x to 1.x, then use these settings instead:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.disable_allocation": true,
    "cluster.routing.allocation.enable": "none"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_step_2_perform_a_synced_flush">
<title>Step 2: Perform a synced flush<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>Shard recovery will be much faster if you stop indexing and issue a
<link linkend="indices-synced-flush">synced-flush</link> request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">POST /_flush/synced</programlisting>
<remark> AUTOSENSE</remark>
<simpara>A synced flush request is a &#8220;best effort&#8221; operation. It will fail if there
are any pending indexing operations, but it is safe to reissue the request
multiple times if necessary.</simpara>
</section>
<section id="_step_3_shutdown_and_upgrade_all_nodes">
<title>Step 3: Shutdown and upgrade all nodes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>Stop all Elasticsearch services on all nodes in the cluster. Each node can be
upgraded following the same procedure described in <xref linkend="upgrade-node"/>.</simpara>
</section>
<section id="_step_4_start_the_cluster">
<title>Step 4: Start the cluster<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>If you have dedicated master nodes&#8201;&#8212;&#8201;nodes with <literal>node.master</literal> set to
<literal>true</literal>(the default) and <literal>node.data</literal> set to <literal>false</literal>&#8201;&#8212;&#8201; then it is a good idea
to start them first.  Wait for them to form a cluster and to elect a master
before proceeding with the data nodes. You can check progress by looking at the
logs.</simpara>
<simpara>As soon as the <link linkend="master-election">minimum number of master-eligible nodes</link>
have discovered each other, they will form a cluster and elect a master.  From
that point on, the <link linkend="cat-health"><literal>_cat/health</literal></link> and <link linkend="cat-nodes"><literal>_cat/nodes</literal></link>
APIs can be used to monitor nodes joining the cluster:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET _cat/health

GET _cat/nodes</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Use these APIs to check that all nodes have successfully joined the cluster.</simpara>
</section>
<section id="_step_5_wait_for_yellow">
<title>Step 5: Wait for yellow<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>As soon as each node has joined the cluster, it will start to recover any
primary shards that are stored locally.  Initially, the
<link linkend="cat-health"><literal>_cat/health</literal></link> request will report a <literal>status</literal> of <literal>red</literal>, meaning
that not all primary shards have been allocated.</simpara>
<simpara>Once each node has recovered its local shards, the <literal>status</literal> will become
<literal>yellow</literal>, meaning all primary shards have been recovered, but not all replica
shards are allocated.  This is to be expected because allocation is still
disabled.</simpara>
</section>
<section id="_step_6_reenable_allocation">
<title>Step 6: Reenable allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/setup/cluster_restart.asciidoc">Edit me</ulink></title>
<simpara>Delaying the allocation of replicas until all nodes have joined the cluster
allows the master to allocate replicas to nodes which already have local shard
copies.   At this point, with all the nodes in the cluster, it is safe to
reenable shard allocation:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.enable": "all"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If upgrading from 0.90.x to 1.x, then use these settings instead:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.disable_allocation": false,
    "cluster.routing.allocation.enable": "all"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The cluster will now start allocating replica shards to all data nodes. At this
point it is safe to resume indexing and searching, but your cluster will
recover more quickly if you can delay indexing and searching until all shards
have recovered.</simpara>
<simpara>You can monitor progress with the <link linkend="cat-health"><literal>_cat/health</literal></link> and
<link linkend="cat-recovery"><literal>_cat/recovery</literal></link> APIs:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET _cat/health

GET _cat/recovery</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Once the <literal>status</literal> column in the <literal>_cat/health</literal> output has reached <literal>green</literal>, all
primary and replica shards have been successfully allocated.</simpara>
</section>
</section>
</chapter>
</part>
<part id="breaking-changes">
<title>Breaking changes <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/index.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section discusses the changes that you need to be aware of when migrating
your application from one version of Elasticsearch to another.</simpara>
<simpara>As a general rule:</simpara>
<itemizedlist>
<listitem>
<simpara>
Migration between major versions&#8201;&#8212;&#8201;e.g. <literal>1.x</literal> to <literal>2.x</literal>&#8201;&#8212;&#8201;  requires a <link linkend="restart-upgrade">full cluster restart</link>.
</simpara>
</listitem>
<listitem>
<simpara>
Migration between minor versions&#8201;&#8212;&#8201;e.g. <literal>1.x</literal> to <literal>1.y</literal>&#8201;&#8212;&#8201;can be
  performed by <link linkend="rolling-upgrades">upgrading one node at a time</link>.
</simpara>
</listitem>
</itemizedlist>
<simpara>See <xref linkend="setup-upgrade"/> for more info.</simpara>
</partintro>
<chapter id="breaking-changes-2.4">
<title>Breaking changes in 2.4<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_4.asciidoc">Edit me</ulink></title>
<bridgehead id="breaking_24_settings" renderas="sect2">Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_4.asciidoc">Edit me</ulink></bridgehead>
<simpara>The setting <literal>bootstrap.mlockall</literal> has been renamed to
<link linkend="bootstrap.memory_lock"><literal>bootstrap.memory_lock</literal></link>. Future versions of
Elasticsearch will refuse to start if <literal>bootstrap.mlockall</literal> is set. You
can switch to the new setting now.</simpara>
<section id="_query_dsl">
<title>Query DSL<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_4.asciidoc">Edit me</ulink></title>
<simpara>The <literal>optimize_bbox</literal> parameter for <literal>geo_distance</literal> and <literal>geo_distance_range</literal> queries
has been deprecated when querying indexes created after 2.1.</simpara>
</section>
<section id="_index_templates">
<title>Index Templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_4.asciidoc">Edit me</ulink></title>
<simpara>Prior to 2.4, validation was not performed upon creation of an index template.
Rather, the index template was validated upon index creation <emphasis role="strong">after</emphasis> all matching
templates were fully merged.</simpara>
<simpara>Each index template must now be independently valid prior to merging. This means,
for example, that you can no longer reference <literal>analyzers</literal>, <literal>filters</literal>, or
<literal>tokenizers</literal> from a shared template.</simpara>
<simpara>See <ulink url="https://github.com/elastic/elasticsearch/issues/21105">elastic/elasticsearch#21105</ulink>
and <ulink url="https://github.com/elastic/elasticsearch/issues/20479">elastic/elasticsearch#20479</ulink>
for discussion concerning the new behavior.</simpara>
</section>
</chapter>
<chapter id="breaking-changes-2.3">
<title>Breaking changes in 2.3<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></title>
<simpara>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 2.3.</simpara>
<bridgehead id="breaking_23_rest" renderas="sect2">REST API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_cors_support_broken_in_2_3_0_and_2_3_1" renderas="sect3">CORS support broken in 2.3.0 and 2.3.1<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<simpara>A change to the CORS implementation means that CORS support for pre-flight
<literal>OPTIONS</literal> requests is broken in 2.3.0 and 2.3.1.  This is fixed in 2.3.2.</simpara>
<bridgehead id="breaking_23_index_apis" renderas="sect2">Mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_limit_to_the_number_of_literal_nested_literal_fields" renderas="sect3">Limit to the number of <literal>nested</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<simpara>Indexing a document with 100 nested fields actually indexes 101 documents as each nested
document is indexed as a separate document. To safeguard against ill-defined mappings
the number of nested fields that can be defined per index has been limited to 50.
This default limit can be changed with the index setting <literal>index.mapping.nested_fields.limit</literal>.
Note that the limit is only checked when new indices are created or mappings are updated. It
will thus only affect existing pre-2.3 indices if their mapping is changed.</simpara>
<bridgehead id="breaking_23_scripting" renderas="sect2">Scripting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_groovy_dependencies" renderas="sect3">Groovy dependencies<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<simpara>In previous versions of Elasticsearch, the Groovy scripting capabilities
depended on the <literal>org.codehaus.groovy:groovy-all</literal> artifact.  In addition
to pulling in the Groovy language, this pulls in a very large set of
functionality, none of which is needed for scripting within
Elasticsearch. Aside from the inherent difficulties in managing such a
large set of dependencies, this also increases the surface area for
security issues. This dependency has been reduced to the core Groovy
language <literal>org.codehaus.groovy:groovy</literal> artifact.</simpara>
<bridgehead id="_analyze_api_changes" renderas="sect2">Analyze API changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_3.asciidoc">Edit me</ulink></bridgehead>
<simpara>The deprecated <literal>filters</literal>/<literal>token_filters</literal>/<literal>char_filters</literal> parameter has been
renamed <literal>filter</literal>/<literal>token_filter</literal>/<literal>char_filter</literal>.
And <literal>filters</literal>/<literal>token_filters</literal>/<literal>char_filters</literal> has been removed in 5.0.0</simpara>
</chapter>
<chapter id="breaking-changes-2.2">
<title>Breaking changes in 2.2<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></title>
<simpara>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 2.2.</simpara>
<section id="float">
<title>Mapping APIs<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></title>
<section id="_geo_point_type">
<title>Geo Point Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_point</literal> format has been changed to reduce index size and the time required to both index and query
geo point data. To make these performance improvements possible both <literal>doc_values</literal> and <literal>coerce</literal> are required
and therefore cannot be changed. For this reason the <literal>doc_values</literal> and <literal>coerce</literal> parameters have been removed
from the <link linkend="geo-point">geo_point</link> field mapping.</simpara>
<simpara>These new geo-points are not yet supported in the percolator, but see <xref linkend="geo-percolate"/> for a workaround.</simpara>
<bridgehead id="_scripting_and_security" renderas="sect2">Scripting and security<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>The Java Security Manager is being used to lock down the privileges available
to the scripting languages and to restrict the classes they are allowed to
load to a predefined whitelist.  These changes may cause scripts which worked
in earlier versions to fail.  See <xref linkend="modules-scripting-security"/> for more
details.</simpara>
<bridgehead id="_field_stats_api" renderas="sect2">Field stats API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>The field stats' response format has been changed for number based and date
fields. The <literal>min_value</literal> and <literal>max_value</literal> elements now return values as number
and the new <literal>min_value_as_string</literal> and <literal>max_value_as_string</literal> return the values
as string.</simpara>
<bridgehead id="_default_logging_using_systemd" renderas="sect2">Default logging using systemd<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>In previous versions of Elasticsearch using systemd, the default logging
configuration routed standard output to <literal>/dev/null</literal> and standard error to
the journal. However, there are often critical error messages at
startup that are logged to standard output rather than standard error
and these error messages would be lost to the ether. The default has
changed to now route standard output to the journal and standard error
to inherit this setting (these are the defaults for systemd). These
settings can be modified by editing the <literal>elasticsearch.service</literal> file.</simpara>
<bridgehead id="_java_client" renderas="sect2">Java Client<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>Previously it was possible to iterate over <literal>ClusterHealthResponse</literal> to get information about <literal>ClusterIndexHealth</literal>.
While this is still possible, it requires now iterating over the values returned from <literal>getIndices()</literal>:</simpara>
<programlisting language="java" linenumbering="unnumbered">ClusterHealthResponse clusterHealthResponse = client.admin().cluster().prepareHealth().get();
for (Map.Entry&lt;String, ClusterIndexHealth&gt; index : clusterHealthResponse.getIndices().entrySet()) {
    String indexName = index.getKey();
    ClusterIndexHealth health = index.getValue();
}</programlisting>
<simpara>Also <literal>ClusterHealthStatus</literal> has been moved from <literal>org.elasticsearch.action.admin.cluster.health</literal> to <literal>org.elasticsearch.cluster.health</literal>.</simpara>
<bridgehead id="_cloud_aws_plugin" renderas="sect2">Cloud AWS Plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>Proxy settings have been deprecated and renamed:</simpara>
<itemizedlist>
<listitem>
<simpara>
from <literal>cloud.aws.proxy_host</literal> to <literal>cloud.aws.proxy.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
from <literal>cloud.aws.ec2.proxy_host</literal> to <literal>cloud.aws.ec2.proxy.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
from <literal>cloud.aws.s3.proxy_host</literal> to <literal>cloud.aws.s3.proxy.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
from <literal>cloud.aws.proxy_port</literal> to <literal>cloud.aws.proxy.port</literal>
</simpara>
</listitem>
<listitem>
<simpara>
from <literal>cloud.aws.ec2.proxy_port</literal> to <literal>cloud.aws.ec2.proxy.port</literal>
</simpara>
</listitem>
<listitem>
<simpara>
from <literal>cloud.aws.s3.proxy_port</literal> to <literal>cloud.aws.s3.proxy.port</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>If you are using proxy settings, update your settings as deprecated ones will
be removed in next major version.</simpara>
<bridgehead id="_multicast_plugin_deprecated" renderas="sect2">Multicast plugin deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_2.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>discovery-multicast</literal> plugin has been deprecated in 2.2.0 and has
been removed in 5.0.</simpara>
</section>
</section>
</chapter>
<chapter id="breaking-changes-2.1">
<title>Breaking changes in 2.1<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 2.1.</simpara>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="breaking_21_search_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_21_update_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_21_index_apis"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_21_removed_features"/>
</simpara>
</listitem>
</itemizedlist>
<section id="breaking_21_search_changes">
<title>Search changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<section id="_literal_search_type_scan_literal_deprecated">
<title><literal>search_type=scan</literal> deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The <literal>scan</literal> search type has been deprecated. All benefits from this search
type can now be achieved by doing a scroll request that sorts documents in
<literal>_doc</literal> order, for instance:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /my_index/_search?scroll=2m
{
  "sort": [
    "_doc"
  ]
}</programlisting>
<simpara>Scroll requests sorted by <literal>_doc</literal> have been optimized to more efficiently resume
from where the previous request stopped, so this will have the same performance
characteristics as the former <literal>scan</literal> search type.</simpara>
</section>
<section id="_literal_search_type_count_literal_deprecated">
<title><literal>search_type=count</literal> deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The <literal>count</literal> search type has been deprecated. All benefits from this search
type can now be achieved by setting <literal>size</literal> to <literal>0</literal>, for instance:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /my_index/_search
{
  "aggs": {...},
  "size": 0
}</programlisting>
</section>
<section id="_from_size_limits">
<title>from + size limits<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch will now return an error message if a query&#8217;s <literal>from</literal> + <literal>size</literal> is
more than the <literal>index.max_result_window</literal> parameter. This parameter defaults to
10,000 which is safe for almost all clusters. Values higher than can consume
significant chunks of heap memory per search and per shard executing the
search. It&#8217;s safest to leave this value as it is and use the scroll api for any
deep scrolling but this setting is dynamic so it can raised or lowered as
needed.</simpara>
</section>
<section id="_nested_sorting">
<title>Nested sorting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>If sorting on field inside a nested object then the <literal>nested_path</literal> should be specified.
Before there was an attempt to resolve the nested path automatically, but that was sometimes incorrect.
To avoid confusion the <literal>nested_path</literal> should always be specified.</simpara>
</section>
<section id="_more_like_this">
<title>More Like This<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The MoreLikeThisQueryBuilder#ignoreLike methods have been deprecated in favor
of using the unlike methods.</simpara>
<simpara>MoreLikeThisBuilder#addItem has been deprecated in favor of using
MoreLikeThisBuilder#addLikeItem.</simpara>
</section>
</section>
<section id="breaking_21_update_changes">
<title>Update changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<section id="_updates_now_literal_detect_noop_literal_by_default">
<title>Updates now <literal>detect_noop</literal> by default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>We&#8217;ve switched the default value of the <literal>detect_noop</literal> option from <literal>false</literal> to
<literal>true</literal>. This means that Elasticsearch will ignore updates that don&#8217;t change
source unless you explicitly set <literal>"detect_noop": false</literal>. <literal>detect_noop</literal> was
always computationally cheap compared to the expense of the update which can be
thought of as a delete operation followed by an index operation.</simpara>
</section>
</section>
<section id="breaking_21_index_apis">
<title>Index APIs<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<section id="_optimize_api">
<title>Optimize API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The Optimize API has been deprecated, all new optimize actions should use the new Force Merge API.</simpara>
</section>
<section id="_queue_size_stats">
<title>Queue size stats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The value for the <literal>queue_size</literal> in nodes info/stats was sometimes shown as
<literal>"1k"</literal> instead of <literal>1000</literal>.  These values are always shown as an integer now.</simpara>
</section>
</section>
<section id="breaking_21_removed_features">
<title>Removed features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<section id="_literal_indices_fielddata_cache_expire_literal">
<title><literal>indices.fielddata.cache.expire</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>The experimental feature <literal>indices.fielddata.cache.expire</literal> has been removed.
For indices that have this setting configured, this config will be ignored.</simpara>
</section>
<section id="_forbid_changing_of_thread_pool_types">
<title>Forbid changing of thread pool types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_1.asciidoc">Edit me</ulink></title>
<simpara>Previously, <link linkend="modules-threadpool">thread pool types</link> could be dynamically adjusted. The thread pool type effectively
controls the backing queue for the thread pool and modifying this is an expert setting with minimal practical benefits
and high risk of being misused. The ability to change the thread pool type for any thread pool has been removed; do note
that it is still possible to adjust relevant thread pool parameters for each of the thread pools (e.g., depending on
the thread pool type, <literal>keep_alive</literal>, <literal>queue_size</literal>, etc.).</simpara>
</section>
</section>
</chapter>
<chapter id="breaking-changes-2.0">
<title>Breaking changes in 2.0<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0.asciidoc">Edit me</ulink></title>
<simpara>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 2.0.</simpara>
<bridgehead id="_indices_created_before_0_90" renderas="sect2">Indices created before 0.90<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch 2.0 can read indices created in version 0.90 and above.  If any
of your indices were created before 0.90 you will need to upgrade to the
latest 1.x version of Elasticsearch first, in order to upgrade your indices or
to delete the old indices. Elasticsearch will not start in the presence of old
indices.</simpara>
<bridgehead id="_elasticsearch_migration_plugin" renderas="sect2">Elasticsearch migration plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0.asciidoc">Edit me</ulink></bridgehead>
<simpara>We have provided the <ulink url="https://github.com/elastic/elasticsearch-migration">Elasticsearch migration plugin</ulink>
to help you detect any issues that you may have when upgrading to
Elasticsearch 2.0. Please install and run the plugin <emphasis role="strong">before</emphasis> upgrading.</simpara>
<bridgehead id="_also_see" renderas="sect2">Also see<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="breaking_20_removed_features"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_network_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_multiple_literal_data_path_literal_striping"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_mapping_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_crud_and_routing_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_query_dsl_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_search_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_aggregation_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_parent_child_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_scripting_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_index_api_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_snapshot_and_restore_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_plugin_and_packaging_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_setting_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_stats_info_and_literal_cat_literal_changes"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="breaking_20_java_api_changes"/>
</simpara>
</listitem>
</itemizedlist>
<section id="breaking_20_removed_features">
<title>Removed features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<section id="_rivers_have_been_removed">
<title>Rivers have been removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch does not support rivers anymore. While we had first planned to
keep them around to ease migration, keeping support for rivers proved to be
challenging as it conflicted with other important changes that we wanted to
bring to 2.0 like synchronous dynamic mappings updates, so we eventually
decided to remove them entirely. See
<ulink url="/blog/deprecating_rivers">Deprecating Rivers</ulink> for more background about
why we took this decision.</simpara>
</section>
<section id="_facets_have_been_removed">
<title>Facets have been removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>Facets, deprecated since 1.0, have now been removed.  Instead, use the much
more powerful and flexible <link linkend="search-aggregations">aggregations</link> framework.
This also means that Kibana 3 will not work with Elasticsearch 2.0.</simpara>
</section>
<section id="_mvel_has_been_removed">
<title>MVEL has been removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The MVEL scripting language has been removed.  The default scripting language
is now Groovy.</simpara>
</section>
<section id="_delete_by_query_is_now_a_plugin">
<title>Delete-by-query is now a plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The old delete-by-query functionality was fast but unsafe.  It could lead to
document differences between the primary and replica shards, and could even
produce out of memory exceptions and cause the cluster to crash.</simpara>
<simpara>This feature has been reimplemented using the <link linkend="search-request-scroll">scroll</link> and
<link linkend="docs-bulk"><literal>bulk</literal></link> APIs, which may be slower for queries which match
large numbers of documents, but is safe.</simpara>
<simpara>Currently, a long running delete-by-query job cannot be cancelled, which is
one of the reasons that this functionality is only available as a plugin.  You
can install the plugin with:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/plugin install delete-by-query</programlisting>
<simpara>See <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/plugins-delete-by-query.html">https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/plugins-delete-by-query.html</ulink> for more information.</simpara>
</section>
<section id="_multicast_discovery_is_now_a_plugin">
<title>Multicast Discovery is now a plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>Support for multicast is very patchy. Linux doesn’t allow multicast listening on localhost,
while OS/X sends multicast broadcasts across all interfaces regardless of the configured
bind address. On top of that, some networks have multicast disabled by default.</simpara>
<simpara>This feature has been moved to a plugin. The default discovery mechanism now uses
unicast, with a default setup which looks for the first 5 ports on localhost. If you
still need to use multicast discovery, you can install the plugin with:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/plugin install discovery-multicast</programlisting>
<simpara>See <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/discovery-multicast.html">https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/discovery-multicast.html</ulink> for more information.</simpara>
</section>
<section id="_literal__shutdown_literal_api">
<title><literal>_shutdown</literal> API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_shutdown</literal> API has been removed without a replacement. Nodes should be
managed via the operating system and the provided start/stop scripts.</simpara>
</section>
<section id="_literal_murmur3_literal_is_now_a_plugin">
<title><literal>murmur3</literal> is now a plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The <literal>murmur3</literal> field, which indexes hashes of the field values, has been moved
out of core and is available as a plugin. It can be installed as:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/plugin install mapper-murmur3</programlisting>
</section>
<section id="_literal__size_literal_is_now_a_plugin">
<title><literal>_size</literal> is now a plugin<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_size</literal> meta-data field, which indexes the size in bytes of the original
JSON document, has been moved out of core and is available as a plugin.  It
can be installed as:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/plugin install mapper-size</programlisting>
</section>
<section id="_thrift_and_memcached_transport">
<title>Thrift and memcached transport<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The thrift and memcached transport plugins are no longer supported.  Instead, use
either the HTTP transport (enabled by default) or the node or transport Java client.</simpara>
</section>
<section id="_bulk_udp">
<title>Bulk UDP<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The bulk UDP API has been removed.  Instead, use the standard
<link linkend="docs-bulk"><literal>bulk</literal></link> API, or use UDP to send documents to Logstash first.</simpara>
</section>
<section id="_mergescheduler_pluggability">
<title>MergeScheduler pluggability<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/removals.asciidoc">Edit me</ulink></title>
<simpara>The merge scheduler is no longer pluggable.</simpara>
</section>
</section>
<section id="breaking_20_network_changes">
<title>Network changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/network.asciidoc">Edit me</ulink></title>
<section id="_bind_to_localhost">
<title>Bind to localhost<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/network.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch 2.x will only bind to localhost by default. It will try to bind
to both 127.0.0.1 (IPv4) and [::1] (IPv6), but will work happily in
environments where only IPv4 or IPv6 is available. This change prevents
Elasticsearch from trying to connect to other nodes on your network unless you
specifically tell it to do so. When moving to production you should configure
the <literal>network.host</literal> parameter, either in the <literal>elasticsearch.yml</literal> config file or
on the command line:</simpara>
<programlisting language="sh" linenumbering="unnumbered">bin/elasticsearch --network.host 192.168.1.5
bin/elasticsearch --network.host _non_loopback_</programlisting>
<simpara>The full list of options that network.host accepts can be found in the <xref linkend="modules-network"/>.</simpara>
</section>
<section id="_multicast_removed">
<title>Multicast removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/network.asciidoc">Edit me</ulink></title>
<simpara>Multicast has been removed (although it is still
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/discovery-multicast.html">provided as a plugin</ulink> for now). Instead,
and only when bound to localhost, Elasticsearch will use unicast to contact
the first 5 ports in the <literal>transport.tcp.port</literal> range, which defaults to
<literal>9300-9400</literal>.</simpara>
<simpara>This preserves the zero-config auto-clustering experience for the developer,
but it means that you will have to provide a list of <link linkend="unicast">unicast hosts</link>
when moving to production, for instance:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">discovery.zen.ping.unicast.hosts: [ 192.168.1.2,  192.168.1.3 ]</programlisting>
<simpara>You don’t need to list all of the nodes in your cluster as unicast hosts, but
you should specify at least a quorum (majority) of master-eligible nodes. A
big cluster will typically have three dedicated master nodes, in which case we
recommend listing all three of them as unicast hosts.</simpara>
</section>
</section>
<section id="breaking_20_multiple_literal_data_path_literal_striping">
<title>Multiple <literal>path.data</literal> striping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/striping.asciidoc">Edit me</ulink></title>
<simpara>Previously, if the <literal>path.data</literal> setting listed multiple data paths, then a
shard would be &#8220;striped&#8221; across all paths by writing a whole file to each
path in turn (in accordance with the <literal>index.store.distributor</literal> setting).  The
result was that files from a single segment in a shard could be spread across
multiple disks, and the failure of any one disk could corrupt multiple shards.</simpara>
<simpara>This striping is no longer supported.  Instead, different shards may be
allocated to different paths, but all of the files in a single shard will be
written to the same path.</simpara>
<simpara>If striping is detected while starting Elasticsearch 2.0.0 or later, <emphasis role="strong">all of
the files belonging to the same shard will be migrated to the same path</emphasis>. If
there is not enough disk space to complete this migration, the upgrade will be
cancelled and can only be resumed once enough disk space is made available.</simpara>
<simpara>The <literal>index.store.distributor</literal> setting has also been removed.</simpara>
</section>
<section id="breaking_20_mapping_changes">
<title>Mapping changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>A number of changes have been made to mappings to remove ambiguity and to
ensure that conflicting mappings cannot be created.</simpara>
<simpara>One major change is that dynamically added fields must have their mapping
confirmed by the master node before indexing continues.  This is to avoid a
problem where different shards in the same index dynamically add different
mappings for the same field.  These conflicting mappings can silently return
incorrect results and can lead to index corruption.</simpara>
<simpara>This change can make indexing slower when frequently adding many new fields.
We are looking at ways of optimising this process but we chose safety over
performance for this extreme use case.</simpara>
<section id="_conflicting_field_mappings">
<title>Conflicting field mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Fields with the same name, in the same index, in different types, must have
the same mapping, with the exception of the <xref linkend="copy-to"/>, <xref linkend="dynamic"/>,
<xref linkend="enabled"/>, <xref linkend="ignore-above"/>, <xref linkend="include-in-all"/>, and <xref linkend="properties"/>
parameters, which may have different settings per field.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "type_one": {
      "properties": {
        "name": { <co id="CO2-1"/>
          "type": "string"
        }
      }
    },
    "type_two": {
      "properties": {
        "name": { <co id="CO2-2"/>
          "type":     "string",
          "analyzer": "english"
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO2-1 CO2-2">
<para>
The two <literal>name</literal> fields have conflicting mappings and will prevent Elasticsearch
    from starting.
</para>
</callout>
</calloutlist>
<simpara>Elasticsearch will not start in the presence of conflicting field mappings.
These indices must be deleted or reindexed using a new mapping.</simpara>
<simpara>The <literal>ignore_conflicts</literal> option of the put mappings API has been removed.
Conflicts can&#8217;t be ignored anymore.</simpara>
</section>
<section id="_fields_cannot_be_referenced_by_short_name">
<title>Fields cannot be referenced by short name<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>A field can no longer be referenced using its short name.  Instead, the full
path to the field is required.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "title":     { "type": "string" }, <co id="CO3-1"/>
        "name": {
          "properties": {
            "title": { "type": "string" }, <co id="CO3-2"/>
            "first": { "type": "string" },
            "last":  { "type": "string" }
          }
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO3-1">
<para>
This field is referred to as <literal>title</literal>.
</para>
</callout>
<callout arearefs="CO3-2">
<para>
This field is referred to as <literal>name.title</literal>.
</para>
</callout>
</calloutlist>
<simpara>Previously, the two <literal>title</literal> fields in the example above could have been
confused with each other when using the short name <literal>title</literal>.</simpara>
</section>
<section id="_type_name_prefix_removed">
<title>Type name prefix removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Previously, two fields with the same name in two different types could
sometimes be disambiguated by prepending the type name.  As a side effect, it
would add a filter on the type name to the relevant query.  This feature was
ambiguous&#8201;&#8212;&#8201;a type name could be confused with a field name&#8201;&#8212;&#8201;and didn&#8217;t
work everywhere e.g. aggregations.</simpara>
<simpara>Instead, fields should be specified with the full path, but without a type
name prefix.  If you wish to filter by the <literal>_type</literal> field, either specify the
type in the URL or add an explicit filter.</simpara>
<simpara>The following example query in 1.x:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "match": {
      "my_type.some_field": "quick brown fox"
    }
  }
}</programlisting>
<simpara>would be rewritten in 2.0 as:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/my_type/_search <co id="CO4-1"/>
{
  "query": {
    "match": {
      "some_field": "quick brown fox" <co id="CO4-2"/>
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO4-1">
<para>
The type name can be specified in the URL to act as a filter.
</para>
</callout>
<callout arearefs="CO4-2">
<para>
The field name should be specified without the type prefix.
</para>
</callout>
</calloutlist>
</section>
<section id="_field_names_may_not_contain_dots">
<title>Field names may not contain dots<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>In 1.x, it was possible to create fields with dots in their name, for
instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "foo.bar": { <co id="CO5-1"/>
          "type": "string"
        },
        "foo": {
          "properties": {
            "bar": { <co id="CO5-2"/>
              "type": "string"
            }
          }
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO5-1 CO5-2">
<para>
These two fields cannot be distinguished as both are referred to as <literal>foo.bar</literal>.
</para>
</callout>
</calloutlist>
<simpara>You can no longer create fields with dots in the name.</simpara>
</section>
<section id="_type_names_may_not_start_with_a_dot">
<title>Type names may not start with a dot<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>In 1.x, Elasticsearch would issue a warning if a type name included a dot,
e.g. <literal>my.type</literal>.  Now that type names are no longer used to distinguish between
fields in different types, this warning has been relaxed: type names may now
contain dots, but they may not <emphasis role="strong">begin</emphasis> with a dot.  The only exception to this
is the special <literal>.percolator</literal> type.</simpara>
</section>
<section id="_type_names_may_not_be_longer_than_255_characters">
<title>Type names may not be longer than 255 characters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Mapping type names may not be longer than 255 characters.  Long type names
will continue to function on indices created before upgrade, but it will not
be possible create types with long names in new indices.</simpara>
</section>
<section id="_types_may_no_longer_be_deleted">
<title>Types may no longer be deleted<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>In 1.x it was possible to delete a type mapping, along with all of the
documents of that type, using the delete mapping API.  This is no longer
supported, because remnants of the fields in the type could remain in the
index, causing corruption later on.</simpara>
<simpara>Instead, if you need to delete a type mapping, you should reindex to a new
index which does not contain the mapping.  If you just need to delete the
documents that belong to that type, then use the delete-by-query plugin
instead.</simpara>
</section>
<section id="migration-meta-fields">
<title>Type meta-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <link linkend="mapping-fields">meta-fields</link> associated with had configuration options
removed, to make them more reliable:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>_id</literal> configuration can no longer be changed.  If you need to sort, use the <link linkend="mapping-uid-field"><literal>_uid</literal></link> field instead.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_type</literal> configuration can no longer be changed.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_index</literal> configuration can no longer be changed.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_routing</literal> configuration is limited to marking routing as required.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_field_names</literal> configuration is limited to disabling the field.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_size</literal> configuration is limited to enabling the field.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_timestamp</literal> configuration is limited to enabling the field, setting format and default value.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_boost</literal> has been removed.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_analyzer</literal> has been removed.
</simpara>
</listitem>
</itemizedlist>
<simpara>Importantly, <emphasis role="strong">meta-fields can no longer be specified as part of the document
body.</emphasis>  Instead, they must be specified in the query string parameters.  For
instance, in 1.x, the <literal>routing</literal> could be specified as follows:</simpara>
<programlisting language="json" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_routing": {
        "path": "group" <co id="CO6-1"/>
      },
      "properties": {
        "group": { <co id="CO6-2"/>
          "type": "string"
        }
      }
    }
  }
}

PUT my_index/my_type/1 <co id="CO6-3"/>
{
  "group": "foo"
}</programlisting>
<calloutlist>
<callout arearefs="CO6-1 CO6-2">
<para>
This 1.x mapping tells Elasticsearch to extract the <literal>routing</literal> value from the <literal>group</literal> field in the document body.
</para>
</callout>
<callout arearefs="CO6-3">
<para>
This indexing request uses a <literal>routing</literal> value of <literal>foo</literal>.
</para>
</callout>
</calloutlist>
<simpara>In 2.0, the routing must be specified explicitly:</simpara>
<programlisting language="json" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_routing": {
        "required": true <co id="CO7-1"/>
      },
      "properties": {
        "group": {
          "type": "string"
        }
      }
    }
  }
}

PUT my_index/my_type/1?routing=bar <co id="CO7-2"/>
{
  "group": "foo"
}</programlisting>
<calloutlist>
<callout arearefs="CO7-1">
<para>
Routing can be marked as required to ensure it is not forgotten during indexing.
</para>
</callout>
<callout arearefs="CO7-2">
<para>
This indexing request uses a <literal>routing</literal> value of <literal>bar</literal>.
</para>
</callout>
</calloutlist>
</section>
<section id="_literal__timestamp_literal_and_literal__ttl_literal_deprecated">
<title><literal>_timestamp</literal> and <literal>_ttl</literal> deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_timestamp</literal> and <literal>_ttl</literal> fields are deprecated, but will remain functional
for the remainder of the 2.x series.</simpara>
<simpara>Instead of the <literal>_timestamp</literal> field, use a normal <link linkend="date"><literal>date</literal></link> field and set
the value explicitly.</simpara>
<simpara>The current <literal>_ttl</literal> functionality will be replaced in a future version with a
new implementation of TTL, possibly with different semantics, and will not
depend on the <literal>_timestamp</literal> field.</simpara>
</section>
<section id="_analyzer_mappings">
<title>Analyzer mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Previously, <literal>index_analyzer</literal> and <literal>search_analyzer</literal> could be set separately,
while the <literal>analyzer</literal> setting would set both.  The <literal>index_analyzer</literal> setting has
been removed in favour of just using the <literal>analyzer</literal> setting.</simpara>
<simpara>If just the <literal>analyzer</literal> is set, it will be used at index time and at search time.  To use a different analyzer at search time, specify both the <literal>analyzer</literal> and a <literal>search_analyzer</literal>.</simpara>
<simpara>The <literal>index_analyzer</literal>, <literal>search_analyzer</literal>,  and <literal>analyzer</literal> type-level settings
have also been removed, as it is no longer possible to select fields based on
the type name.</simpara>
<simpara>The <literal>_analyzer</literal> meta-field, which allowed setting an analyzer per document has
also been removed.  It will be ignored on older indices.</simpara>
</section>
<section id="_date_fields_and_unix_timestamps">
<title>Date fields and Unix timestamps<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Previously, <literal>date</literal> fields would first try to parse values as a Unix timestamp&#8201;&#8212;&#8201;milliseconds-since-the-epoch&#8201;&#8212;&#8201;before trying to use their defined date
<literal>format</literal>.  This meant that formats like <literal>yyyyMMdd</literal> could never work, as values
would be interpreted as timestamps.</simpara>
<simpara>In 2.0, we have added two formats: <literal>epoch_millis</literal> and <literal>epoch_second</literal>.  Only
date fields that use these formats will be able to parse timestamps.</simpara>
<simpara>These formats cannot be used in dynamic templates, because they are
indistinguishable from long values.</simpara>
</section>
<section id="_default_date_format">
<title>Default date format<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The default date format has changed from <literal>date_optional_time</literal> to
<literal>strict_date_optional_time</literal>, which expects a 4 digit year, and a 2 digit month
and day, (and optionally, 2 digit hour, minute, and second).</simpara>
<simpara>A dynamically added date field, by default, includes the <literal>epoch_millis</literal>
format to support timestamp parsing.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "date_one": "2015-01-01" <co id="CO8-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO8-1">
<para>
Has <literal>format</literal>: <literal>"strict_date_optional_time||epoch_millis"</literal>.
</para>
</callout>
</calloutlist>
</section>
<section id="_literal_mapping_date_round_ceil_literal_setting">
<title><literal>mapping.date.round_ceil</literal> setting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <literal>mapping.date.round_ceil</literal> setting for date math parsing has been removed.</simpara>
</section>
<section id="migration-bool-fields">
<title>Boolean fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Boolean fields used to have a string fielddata with <literal>F</literal> meaning <literal>false</literal> and <literal>T</literal>
meaning <literal>true</literal>. They have been refactored to use numeric fielddata, with <literal>0</literal>
for <literal>false</literal> and <literal>1</literal> for <literal>true</literal>. As a consequence, the format of the responses of
the following APIs changed when applied to boolean fields: <literal>0</literal>/<literal>1</literal> is returned
instead of <literal>F</literal>/<literal>T</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="search-request-fielddata-fields">fielddata fields</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-sort">sort values</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-aggregations-bucket-terms-aggregation">terms aggregations</link>
</simpara>
</listitem>
</itemizedlist>
<simpara>In addition, terms aggregations use a custom formatter for boolean (like for
dates and ip addresses, which are also backed by numbers) in order to return
the user-friendly representation of boolean fields: <literal>false</literal>/<literal>true</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">"buckets": [
  {
     "key": 0,
     "key_as_string": "false",
     "doc_count": 42
  },
  {
     "key": 1,
     "key_as_string": "true",
     "doc_count": 12
  }
]</programlisting>
</section>
<section id="_literal_index_name_literal_and_literal_path_literal_removed">
<title><literal>index_name</literal> and <literal>path</literal> removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <literal>index_name</literal> setting was used to change the name of the Lucene field,
and the <literal>path</literal> setting was used on <literal>object</literal> fields to determine whether the
Lucene field should use the full path (including parent object fields), or
just the final <literal>name</literal>.</simpara>
<simpara>These setting have been removed as their purpose is better served with the
<xref linkend="copy-to"/> parameter.</simpara>
</section>
<section id="_murmur3_fields">
<title>Murmur3 Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Fields of type <literal>murmur3</literal> can no longer change <literal>doc_values</literal> or <literal>index</literal> setting.
They are always mapped as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "type":       "murmur3",
  "index":      "no",
  "doc_values": true
}</programlisting>
</section>
<section id="_attachment_fields">
<title>Attachment Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Fields of type <literal>attachment</literal> used to index their content in the "main"
multi-field&#8201;&#8212;&#8201;a sub-field with the same name as the main field, e.g.
<literal>my_attachment.my_attachment</literal>.  This sub-field will be renamed to
<literal>my_attachment.content</literal>.   Any mapping settings (e.g. <literal>analyzer</literal>) on the old
<literal>my_attachment.my_attachment</literal> field will be lost. In this case, the index
needs to be reindexed in 2.x.</simpara>
<simpara>The <literal>attachment</literal> sub-fields do not support <literal>copy_to</literal>.</simpara>
</section>
<section id="_mappings_in_config_files_not_supported">
<title>Mappings in config files not supported<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The ability to specify mappings in configuration files has been removed. To
specify default mappings that apply to multiple indexes, use
<link linkend="indices-templates">index templates</link> instead.</simpara>
<simpara>Along with this change, the following settings have been removed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>index.mapper.default_mapping_location</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.mapper.default_percolator_mapping_location</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_fielddata_formats">
<title>Fielddata formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>Now that doc values are the default for fielddata, specialized in-memory
formats have become an esoteric option. These fielddata formats have been removed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>fst</literal> on string fields
</simpara>
</listitem>
<listitem>
<simpara>
<literal>compressed</literal> on geo points
</simpara>
</listitem>
</itemizedlist>
<simpara>The default fielddata format will be used instead.</simpara>
</section>
<section id="_posting_and_doc_values_codecs">
<title>Posting and doc-values codecs<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>It is no longer possible to specify per-field postings and doc values formats
in the mappings. This setting will be ignored on indices created before 2.0
and will cause mapping parsing to fail on indices created on or after 2.0. For
old indices, this means that new segments will be written with the default
postings and doc values formats of the current codec.</simpara>
<simpara>It is still possible to change the whole codec by using the <literal>index.codec</literal>
setting. Please however note that using a non-default codec is discouraged as
it could prevent future versions of Elasticsearch from being able to read the
index.</simpara>
</section>
<section id="_compress_and_compress_threshold">
<title>Compress and compress threshold<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <literal>compress</literal> and <literal>compress_threshold</literal> options have been removed from the
<literal>_source</literal> field and fields of type <literal>binary</literal>.  These fields are compressed by
default.  If you would like to increase compression levels, use the new
<link linkend="index-codec"><literal>index.codec: best_compression</literal></link> setting instead.</simpara>
</section>
<section id="_position_offset_gap">
<title>position_offset_gap<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>The <literal>position_offset_gap</literal> option is renamed to <emphasis>position_increment_gap</emphasis>. This was
done to clear away the confusion. Elasticsearch&#8217;s <emphasis>position_increment_gap</emphasis> now is
mapped directly to Lucene&#8217;s <emphasis>position_increment_gap</emphasis></simpara>
<simpara>The default <literal>position_increment_gap</literal> is now 100. Indexes created in Elasticsearch
2.0.0 will default to using 100 and indexes created before that will continue
to use the old default of 0. This was done to prevent phrase queries from
matching across different values of the same term unexpectedly. Specifically,
100 was chosen to cause phrase queries with slops up to 99 to match only within
a single value of a field.</simpara>
</section>
<section id="_copy_to_and_multi_fields">
<title>copy_to and multi fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/mapping.asciidoc">Edit me</ulink></title>
<simpara>A <link linkend="copy-to">copy_to</link> within a <link linkend="multi-fields">multi field</link> is ignored from version 2.0 on. With any version after
2.1 or 2.0.1 creating a mapping that has a copy_to within a multi field will result
in an exception.</simpara>
</section>
</section>
<section id="breaking_20_crud_and_routing_changes">
<title>CRUD and routing changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<section id="_explicit_custom_routing">
<title>Explicit custom routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>Custom <literal>routing</literal> values can no longer be extracted from the document body, but
must be specified explicitly as part of the query string, or in the metadata
line in the <link linkend="docs-bulk"><literal>bulk</literal></link> API.  See <xref linkend="migration-meta-fields"/> for an
example.</simpara>
</section>
<section id="_routing_hash_function">
<title>Routing hash function<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>The default hash function that is used for routing has been changed from
<literal>djb2</literal> to <literal>murmur3</literal>. This change should be transparent unless you relied on
very specific properties of <literal>djb2</literal>. This will help ensure a better balance of
the document counts between shards.</simpara>
<simpara>In addition, the following routing-related node settings have been deprecated:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.operation.hash.type</literal>
</term>
<listitem>
<simpara>
  This was an undocumented setting that allowed to configure which hash function
  to use for routing. <literal>murmur3</literal> is now enforced on new indices.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.operation.use_type</literal>
</term>
<listitem>
<simpara>
  This was an undocumented setting that allowed to take the <literal>_type</literal> of the
  document into account when computing its shard (default: <literal>false</literal>). <literal>false</literal> is
  now enforced on new indices.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_delete_api_with_custom_routing">
<title>Delete API with custom routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>The delete API used to be broadcast to all shards in the index which meant
that, when using custom routing, the <literal>routing</literal> parameter was optional. Now,
the delete request is forwarded only to the shard holding the document. If you
are using custom routing then you should specify the <literal>routing</literal> value when
deleting a document, just as is already required for the <literal>index</literal>, <literal>create</literal>,
and <literal>update</literal> APIs.</simpara>
<simpara>To make sure that you never forget a routing value, make routing required with
the following mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_routing": {
        "required": true
      }
    }
  }
}</programlisting>
</section>
<section id="_all_stored_meta_fields_returned_by_default">
<title>All stored meta-fields returned by default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>Previously, meta-fields like <literal>_routing</literal>, <literal>_timestamp</literal>, etc would only be
included in a GET request if specifically requested with the <literal>fields</literal>
parameter.  Now, all meta-fields which have stored values will be returned by
default.  Additionally, they are now returned at the top level (along with
<literal>_index</literal>, <literal>_type</literal>, and <literal>_id</literal>) instead of in the <literal>fields</literal> element.</simpara>
<simpara>For instance, the following request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /my_index/my_type/1</programlisting>
<simpara>might return:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "_index":     "my_index",
  "_type":      "my_type",
  "_id":        "1",
  "_timestamp": 10000000, <co id="CO9-1"/>
  "_source": {
    "foo" : [ "bar" ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO9-1">
<para>
The <literal>_timestamp</literal> is returned by default, and at the top level.
</para>
</callout>
</calloutlist>
</section>
<section id="_async_replication">
<title>Async replication<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>The <literal>replication</literal> parameter has been removed from all CRUD operations
(<literal>index</literal>, <literal>create</literal>,  <literal>update</literal>, <literal>delete</literal>, <literal>bulk</literal>) as it interfered with the
<link linkend="indices-synced-flush">synced flush</link> feature.  These operations are now
synchronous only and a request will only return once the changes have been
replicated to all active shards in the shard group.</simpara>
<simpara>Instead, use more client processes to send more requests in parallel.</simpara>
</section>
<section id="_documents_must_be_specified_without_a_type_wrapper">
<title>Documents must be specified without a type wrapper<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>Previously, the document body could be wrapped in another object with the name
of the <literal>type</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "my_type": { <co id="CO10-1"/>
    "text": "quick brown fox"
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO10-1">
<para>
This <literal>my_type</literal> wrapper is not part of the document itself, but represents the document type.
</para>
</callout>
</calloutlist>
<simpara>This feature was deprecated before but could be reenabled with the
<literal>mapping.allow_type_wrapper</literal> index setting.  This setting is no longer
supported.  The above document should be indexed as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "text": "quick brown fox"
}</programlisting>
</section>
<section id="_term_vectors_api">
<title>Term Vectors API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/crud.asciidoc">Edit me</ulink></title>
<simpara>Usage of <literal>/_termvector</literal> is deprecated in favor of <literal>/_termvectors</literal>.</simpara>
</section>
</section>
<section id="breaking_20_query_dsl_changes">
<title>Query DSL changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<section id="_queries_and_filters_merged">
<title>Queries and filters merged<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>Queries and filters have been merged&#8201;&#8212;&#8201;all filter clauses are now query
clauses. Instead, query clauses can now be used in <emphasis>query context</emphasis> or in
<emphasis>filter context</emphasis>:</simpara>
<variablelist>
<varlistentry>
<term>
Query context
</term>
<listitem>
<simpara>
A query used in query context will calculate relevance scores and will not be
cacheable.  Query context is used whenever filter context does not apply.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Filter context
</term>
<listitem>
<simpara>A query used in filter context will not calculate relevance scores, and will
be cacheable. Filter context is introduced by:</simpara>
<itemizedlist>
<listitem>
<simpara>
the <literal>constant_score</literal> query
</simpara>
</listitem>
<listitem>
<simpara>
the <literal>must_not</literal> and (newly added) <literal>filter</literal> parameter in the <literal>bool</literal> query
</simpara>
</listitem>
<listitem>
<simpara>
the <literal>filter</literal> and <literal>filters</literal> parameters in the <literal>function_score</literal> query
</simpara>
</listitem>
<listitem>
<simpara>
any API called <literal>filter</literal>, such as the <literal>post_filter</literal> search parameter, or in
  aggregations or index aliases
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_literal_terms_literal_query_and_filter">
<title><literal>terms</literal> query and filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>The <literal>execution</literal> option of the <literal>terms</literal> filter is now deprecated and is ignored
if provided. Similarly, the <literal>terms</literal> query no longer supports the
<literal>minimum_should_match</literal> parameter.</simpara>
</section>
<section id="_literal_or_literal_and_literal_and_literal_now_implemented_via_literal_bool_literal">
<title><literal>or</literal> and <literal>and</literal> now implemented via <literal>bool</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>The <literal>or</literal> and <literal>and</literal> filters previously had a different execution pattern to the
<literal>bool</literal> filter. It used to be important to use <literal>and</literal>/<literal>or</literal> with certain filter
clauses, and <literal>bool</literal> with others.</simpara>
<simpara>This distinction has been removed: the <literal>bool</literal> query is now smart enough to
handle both cases optimally.  As a result of this change, the <literal>or</literal> and <literal>and</literal>
filters are now sugar syntax which are executed internally as a <literal>bool</literal> query.
These filters may be removed in the future.</simpara>
</section>
<section id="_literal_filtered_literal_query_and_literal_query_literal_filter_deprecated">
<title><literal>filtered</literal> query and <literal>query</literal> filter deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>The <literal>query</literal> filter is deprecated as is it no longer needed&#8201;&#8212;&#8201;all queries can
be used in query or filter context.</simpara>
<simpara>The <literal>filtered</literal> query is deprecated in favour of the <literal>bool</literal> query. Instead of
the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "query": {
    "filtered": {
      "query": {
        "match": {
          "text": "quick brown fox"
        }
      },
      "filter": {
        "term": {
          "status": "published"
        }
      }
    }
  }
}</programlisting>
<simpara>move the query and filter to the <literal>must</literal> and <literal>filter</literal> parameters in the <literal>bool</literal>
query:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "text": "quick brown fox"
        }
      },
      "filter": {
        "term": {
          "status": "published"
        }
      }
    }
  }
}</programlisting>
</section>
<section id="_filter_auto_caching">
<title>Filter auto-caching<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>It used to be possible to control which filters were cached with the <literal>_cache</literal>
option and to provide a custom <literal>_cache_key</literal>.  These options are deprecated
and, if present, will be ignored.</simpara>
<simpara>Query clauses used in filter context are now auto-cached when it makes sense
to do so.  The algorithm takes into account the frequency of use, the cost of
query execution, and the cost of building the filter.</simpara>
<simpara>The <literal>terms</literal> filter lookup mechanism no longer caches the values of the
document containing the terms.  It relies on the filesystem cache instead. If
the lookup index is not too large, it is recommended to replicate it to all
nodes by setting <literal>index.auto_expand_replicas: 0-all</literal> in order to remove the
network overhead as well.</simpara>
</section>
<section id="_numeric_queries_use_idf_for_scoring">
<title>Numeric queries use IDF for scoring<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>Previously, term queries on numeric fields were deliberately prevented from
using the usual Lucene scoring logic and this behaviour was undocumented and,
to some, unexpected.</simpara>
<simpara>Single <literal>term</literal> queries on numeric fields now score in the same way as string
fields, using IDF and norms (if enabled).</simpara>
<simpara>To query numeric fields without scoring, the query clause should be used in
filter context, e.g. in the <literal>filter</literal> parameter of the <literal>bool</literal> query, or wrapped
in a <literal>constant_score</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": { <co id="CO11-1"/>
            "numeric_tag": 5
          }
        }
      ],
      "filter": [
        {
          "match": { <co id="CO11-2"/>
            "count": 5
          }
        }
      ]
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO11-1">
<para>
This clause would include IDF in the relevance score calculation.
</para>
</callout>
<callout arearefs="CO11-2">
<para>
This clause would have no effect on the relevance score.
</para>
</callout>
</calloutlist>
</section>
<section id="_fuzziness_and_fuzzy_like_this">
<title>Fuzziness and fuzzy-like-this<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>Fuzzy matching used to calculate the score for each fuzzy alternative, meaning
that rare misspellings would have a higher score than the more common correct
spellings. Now, fuzzy matching blends the scores of all the fuzzy alternatives
to use the IDF of the most frequently occurring alternative.</simpara>
<simpara>Fuzziness can no longer be specified using a percentage, but should instead
use the number of allowed edits:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>0</literal>, <literal>1</literal>, <literal>2</literal>, or
</simpara>
</listitem>
<listitem>
<simpara>
<literal>AUTO</literal> (which chooses <literal>0</literal>, <literal>1</literal>, or <literal>2</literal> based on the length of the term)
</simpara>
</listitem>
</itemizedlist>
<simpara>The <literal>fuzzy_like_this</literal> and <literal>fuzzy_like_this_field</literal> queries used a very
expensive approach to fuzzy matching and have been removed.</simpara>
</section>
<section id="_more_like_this_2">
<title>More Like This<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>The More Like This (<literal>mlt</literal>) API and the <literal>more_like_this_field</literal> (<literal>mlt_field</literal>)
query have been removed in favor of the
<link linkend="query-dsl-mlt-query"><literal>more_like_this</literal></link> query.</simpara>
<simpara>The parameter <literal>percent_terms_to_match</literal> has been removed in favor of
<literal>minimum_should_match</literal>.</simpara>
</section>
<section id="_literal_limit_literal_filter_deprecated">
<title><literal>limit</literal> filter deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>The <literal>limit</literal> filter is deprecated and becomes a no-op. You can achieve similar
behaviour using the <link linkend="search-request-body">terminate_after</link> parameter.</simpara>
</section>
<section id="_java_plugins_registering_custom_queries">
<title>Java plugins registering custom queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/query_dsl.asciidoc">Edit me</ulink></title>
<simpara>Java plugins that register custom queries can do so by using the
<literal>IndicesQueriesModule#addQuery(Class&lt;? extends QueryParser&gt;)</literal> method. Other
ways to register custom queries are not supported anymore.</simpara>
</section>
</section>
<section id="breaking_20_search_changes">
<title>Search changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<section id="_partial_fields">
<title>Partial fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>Partial fields have been removed in favor of <link linkend="search-request-source-filtering">source filtering</link>.</simpara>
</section>
<section id="_literal_search_type_count_literal_deprecated_2">
<title><literal>search_type=count</literal> deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>The <literal>count</literal> search type has been deprecated. All benefits from this search
type can now be achieved by using the (default) <literal>query_then_fetch</literal> search type
and setting <literal>size</literal> to <literal>0</literal>.</simpara>
</section>
<section id="_the_count_api_internally_uses_the_search_api">
<title>The count api internally uses the search api<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>The count api is now a shortcut to the search api with <literal>size</literal> set to 0. As a
result, a total failure will result in an exception being returned rather
than a normal response with <literal>count</literal> set to <literal>0</literal> and shard failures.</simpara>
</section>
<section id="_all_stored_meta_fields_returned_by_default_2">
<title>All stored meta-fields returned by default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>Previously, meta-fields like <literal>_routing</literal>, <literal>_timestamp</literal>, etc would only be
included in the search results if specifically requested with the <literal>fields</literal>
parameter.  Now, all meta-fields which have stored values will be returned by
default.  Additionally, they are now returned at the top level (along with
<literal>_index</literal>, <literal>_type</literal>, and <literal>_id</literal>) instead of in the <literal>fields</literal> element.</simpara>
<simpara>For instance, the following request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /my_index/_search?fields=foo</programlisting>
<simpara>might return:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   [...]
   "hits": {
      "total": 1,
      "max_score": 1,
      "hits": [
         {
            "_index":     "my_index",
            "_type":      "my_type",
            "_id":        "1",
            "_score":     1,
            "_timestamp": 10000000, <co id="CO12-1"/>
            "fields": {
              "foo" : [ "bar" ]
            }
         }
      ]
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO12-1">
<para>
The <literal>_timestamp</literal> is returned by default, and at the top level.
</para>
</callout>
</calloutlist>
</section>
<section id="_script_fields">
<title>Script fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>Script fields in 1.x were only returned as a single value. Even if the return
value of a script was a list, it would be returned as an array containing an
array:</simpara>
<programlisting language="js" linenumbering="unnumbered">"fields": {
  "my_field": [
    [
      "v1",
      "v2"
    ]
  ]
}</programlisting>
<simpara>In elasticsearch 2.0, scripts that return a list of values are treated as
multivalued fields. The same example would return the following response, with
values in a single array.</simpara>
<programlisting language="js" linenumbering="unnumbered">"fields": {
  "my_field": [
    "v1",
    "v2"
  ]
}</programlisting>
</section>
<section id="_timezone_for_date_field">
<title>Timezone for date field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>Specifying the <literal>time_zone</literal> parameter in queries or aggregations on fields of
type <literal>date</literal> must now be either an ISO 8601 UTC offset, or a timezone id. For
example, the value <literal>+1:00</literal> must now be written as <literal>+01:00</literal>.</simpara>
</section>
<section id="_only_highlight_queried_fields">
<title>Only highlight queried fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>The default value for the <literal>require_field_match</literal> option has changed from
<literal>false</literal> to <literal>true</literal>, meaning that the highlighters will, by default, only take
the fields that were queried into account.</simpara>
<simpara>This means that, when querying the <literal>_all</literal> field, trying to highlight on any
field other than <literal>_all</literal>  will produce no highlighted snippets. Querying the
same fields that need to be highlighted is the cleaner solution to get
highlighted snippets back. Otherwise <literal>require_field_match</literal> option can be set
to <literal>false</literal> to ignore field names completely when highlighting.</simpara>
<simpara>The postings highlighter doesn&#8217;t support the <literal>require_field_match</literal> option
anymore, it will only highlight fields that were queried.</simpara>
</section>
<section id="_postings_highlighter_doesn_8217_t_support_literal_match_phrase_prefix_literal">
<title>Postings highlighter doesn&#8217;t support <literal>match_phrase_prefix</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/search.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match</literal> query with type set to <literal>phrase_prefix</literal> (or the
<literal>match_phrase_prefix</literal> query) is not supported by the postings highlighter. No
highlighted snippets will be returned.</simpara>
</section>
</section>
<section id="breaking_20_aggregation_changes">
<title>Aggregation changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<section id="_min_doc_count_defaults_to_zero">
<title>Min doc count defaults to zero<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>Both the <literal>histogram</literal> and <literal>date_histogram</literal> aggregations now have a default
<literal>min_doc_count</literal> of <literal>0</literal> instead of <literal>1</literal>.</simpara>
</section>
<section id="_timezone_for_date_field_2">
<title>Timezone for date field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>Specifying the <literal>time_zone</literal> parameter in queries or aggregations on fields of
type <literal>date</literal> must now be either an ISO 8601 UTC offset, or a timezone id. For
example, the value <literal>+1:00</literal> must now be written as <literal>+01:00</literal>.</simpara>
</section>
<section id="_time_zones_and_offsets">
<title>Time zones and offsets<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>The <literal>histogram</literal> and the <literal>date_histogram</literal> aggregation now support a simplified
<literal>offset</literal> option that replaces the previous <literal>pre_offset</literal> and <literal>post_offset</literal>
rounding options. Instead of having to specify two separate offset shifts of
the underlying buckets, the <literal>offset</literal> option moves the bucket boundaries in
positive or negative direction depending on its argument.</simpara>
<simpara>The <literal>date_histogram</literal> options for <literal>pre_zone</literal> and <literal>post_zone</literal> are replaced by
the <literal>time_zone</literal> option. The behavior of <literal>time_zone</literal> is equivalent to the
former <literal>pre_zone</literal> option. Setting <literal>time_zone</literal> to a value like "+01:00" now
will lead to the bucket calculations being applied in the specified time zone.
The <literal>key</literal> is returned as the timestamp in UTC, but the <literal>key_as_string</literal> is
returned in the time zone specified.</simpara>
<simpara>In addition to this, the <literal>pre_zone_adjust_large_interval</literal> is removed because
we now always return dates and bucket keys in UTC.</simpara>
</section>
<section id="_including_excluding_terms">
<title>Including/excluding terms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara><literal>include</literal>/<literal>exclude</literal> filtering on the <literal>terms</literal> aggregation now uses the same
syntax as <link linkend="regexp-syntax">regexp queries</link> instead of the Java regular
expression syntax. While simple regexps should still work, more complex ones
might need some rewriting. Also, the <literal>flags</literal> parameter is no longer supported.</simpara>
</section>
<section id="_boolean_fields">
<title>Boolean fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>Aggregations on <literal>boolean</literal> fields will now return <literal>0</literal> and <literal>1</literal> as keys, and
<literal>"true"</literal> and <literal>"false"</literal> as string keys.  See <xref linkend="migration-bool-fields"/> for more
information.</simpara>
</section>
<section id="_java_aggregation_classes">
<title>Java aggregation classes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>The <literal>date_histogram</literal> aggregation now returns a <literal>Histogram</literal> object in the
response, and the <literal>DateHistogram</literal> class has been removed.  Similarly the
<literal>date_range</literal>, <literal>ipv4_range</literal>, and <literal>geo_distance</literal> aggregations all return a
<literal>Range</literal> object in the response, and the <literal>IPV4Range</literal>, <literal>DateRange</literal>, and
<literal>GeoDistance</literal> classes have been removed.</simpara>
<simpara>The motivation for this is to have a single response API for the Range and
Histogram aggregations regardless of the type of data being queried.  To
support this some changes were made in the <literal>MultiBucketAggregation</literal> interface
which applies to all bucket aggregations:</simpara>
<itemizedlist>
<listitem>
<simpara>
The <literal>getKey()</literal> method now returns <literal>Object</literal> instead of <literal>String</literal>. The actual
  object type returned depends on the type of aggregation requested (e.g. the
  <literal>date_histogram</literal> will return a <literal>DateTime</literal> object for this method whereas a
  <literal>histogram</literal> will return a <literal>Number</literal>).
</simpara>
</listitem>
<listitem>
<simpara>
A <literal>getKeyAsString()</literal> method has been added to return the String
  representation of the key.
</simpara>
</listitem>
<listitem>
<simpara>
All other <literal>getKeyAsX()</literal> methods have been removed.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>getBucketAsKey(String)</literal> methods have been removed on all aggregations
  except the <literal>filters</literal> and <literal>terms</literal> aggregations.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_literal_order_count_asc_literal_on_terms">
<title><literal>order: {"count": "asc"}</literal> on Terms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/aggs.asciidoc">Edit me</ulink></title>
<simpara>The ability to sort the terms aggregation by ascending count has been deprecated.
It is not recommended as it can return inaccurate doc counts and/or select the wrong buckets.</simpara>
</section>
</section>
<section id="breaking_20_parent_child_changes">
<title>Parent/Child changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/parent_child.asciidoc">Edit me</ulink></title>
<simpara>Parent/child has been rewritten completely to reduce memory usage and to
execute <literal>has_child</literal> and <literal>has_parent</literal> queries faster and more efficient. The
<literal>_parent</literal> field uses doc values by default. The refactored and improved
implementation is only active for indices created on or after version 2.0.</simpara>
<simpara>In order to benefit from all the performance and memory improvements, we
recommend reindexing all existing indices that use the <literal>_parent</literal> field.</simpara>
<section id="_parent_type_cannot_pre_exist">
<title>Parent type cannot pre-exist<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/parent_child.asciidoc">Edit me</ulink></title>
<simpara>A mapping type is declared as a child of another mapping type by specifying
the <literal>_parent</literal> meta field:</simpara>
<programlisting language="js" linenumbering="unnumbered">DELETE *

PUT my_index
{
  "mappings": {
    "my_parent": {},
    "my_child": {
      "_parent": {
        "type": "my_parent" <co id="CO13-1"/>
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO13-1">
<para>
The <literal>my_parent</literal> type is the parent of the <literal>my_child</literal> type.
</para>
</callout>
</calloutlist>
<simpara>The mapping for the parent type can be added at the same time as the mapping
for the child type, but cannot be added before the child type.</simpara>
</section>
<section id="_literal_top_children_literal_query_removed">
<title><literal>top_children</literal> query removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/parent_child.asciidoc">Edit me</ulink></title>
<simpara>The <literal>top_children</literal> query has been removed in favour of the <literal>has_child</literal> query.
It wasn&#8217;t always faster than the <literal>has_child</literal> query and the results were usually
inaccurate. The total hits and any aggregations in the same search request
would be incorrect if <literal>top_children</literal> was used.</simpara>
</section>
</section>
<section id="breaking_20_scripting_changes">
<title>Scripting changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/scripting.asciidoc">Edit me</ulink></title>
<section id="_scripting_syntax">
<title>Scripting syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/scripting.asciidoc">Edit me</ulink></title>
<simpara>The syntax for scripts has been made consistent across all APIs. The accepted
format is as follows:</simpara>
<variablelist>
<varlistentry>
<term>
Inline/Dynamic scripts
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"script": {
  "inline": "doc['foo'].value + val", <co id="CO14-1"/>
  "lang":   "groovy", <co id="CO14-2"/>
  "params": { "val": 3 } <co id="CO14-3"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO14-1">
<para>
The inline script to execute.
</para>
</callout>
<callout arearefs="CO14-2">
<para>
The optional language of the script.
</para>
</callout>
<callout arearefs="CO14-3">
<para>
Any named parameters.
</para>
</callout>
</calloutlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Indexed scripts
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"script": {
  "id":     "my_script_id", <co id="CO15-1"/>
  "lang":   "groovy", <co id="CO15-2"/>
  "params": { "val": 3 } <co id="CO15-3"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO15-1">
<para>
The ID of the indexed script.
</para>
</callout>
<callout arearefs="CO15-2">
<para>
The optional language of the script.
</para>
</callout>
<callout arearefs="CO15-3">
<para>
Any named parameters.
</para>
</callout>
</calloutlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
File scripts
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"script": {
  "file":   "my_file", <co id="CO16-1"/>
  "lang":   "groovy", <co id="CO16-2"/>
  "params": { "val": 3 } <co id="CO16-3"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO16-1">
<para>
The filename of the script, without the <literal>.lang</literal> suffix.
</para>
</callout>
<callout arearefs="CO16-2">
<para>
The optional language of the script.
</para>
</callout>
<callout arearefs="CO16-3">
<para>
Any named parameters.
</para>
</callout>
</calloutlist>
</listitem>
</varlistentry>
</variablelist>
<simpara>For example, an update request might look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST my_index/my_type/1/_update
{
  "script": {
    "inline": "ctx._source.count += val",
    "params": { "val": 3 }
  },
  "upsert": {
    "count": 0
  }
}</programlisting>
<simpara>A short syntax exists for running inline scripts in the default scripting
language without any parameters:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "script_fields": {
    "concat_fields": {
      "script": "doc['one'].value + ' ' + doc['two'].value"
    }
  }
}</programlisting>
</section>
<section id="_scripting_settings">
<title>Scripting settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/scripting.asciidoc">Edit me</ulink></title>
<simpara>The <literal>script.disable_dynamic</literal> node setting has been replaced by fine-grained
script settings described in <xref linkend="migration-script-settings"/>.</simpara>
</section>
<section id="_groovy_scripts_sandbox">
<title>Groovy scripts sandbox<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/scripting.asciidoc">Edit me</ulink></title>
<simpara>The Groovy sandbox and related settings have been removed. Groovy is now a
non-sandboxed scripting language, without any option to turn the sandbox on.</simpara>
</section>
<section id="_plugins_making_use_of_scripts">
<title>Plugins making use of scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/scripting.asciidoc">Edit me</ulink></title>
<simpara>Plugins that make use of scripts must register their own script context
through <literal>ScriptModule</literal>. Script contexts can be used as part of fine-grained
settings to enable/disable scripts selectively.</simpara>
</section>
</section>
<section id="breaking_20_index_api_changes">
<title>Index API changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/index_apis.asciidoc">Edit me</ulink></title>
<section id="_index_aliases">
<title>Index aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/index_apis.asciidoc">Edit me</ulink></title>
<simpara>Fields used in alias filters no longer have to exist in the mapping at alias
creation time. Previously, alias filters were parsed at alias creation time
and the parsed form was cached in memory. Now, alias filters are  parsed at
request time and the fields in filters are resolved from the current mapping.</simpara>
<simpara>This also means that index aliases now support <literal>has_parent</literal> and <literal>has_child</literal>
queries.</simpara>
<simpara>The <link linkend="alias-retrieving">GET alias api</link> will now throw an exception if no
matching aliases are found. This change brings the defaults for this API in
line with the other Indices APIs. The <xref linkend="multi-index"/> options can be used on a
request to change this behavior.</simpara>
</section>
<section id="_file_based_index_templates">
<title>File based index templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/index_apis.asciidoc">Edit me</ulink></title>
<simpara>Index templates can no longer be configured on disk. Use the
<link linkend="indices-templates"><literal>_template</literal></link> API instead.</simpara>
</section>
<section id="_analyze_api_changes_2">
<title>Analyze API changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/index_apis.asciidoc">Edit me</ulink></title>
<simpara>The Analyze API now returns the <literal>position</literal> of the first token as <literal>0</literal>
instead of <literal>1</literal>.</simpara>
<simpara>The <literal>prefer_local</literal> parameter has been removed. The <literal>_analyze</literal> API is a light
operation and the caller shouldn&#8217;t be concerned about whether it executes on
the node that receives the request or another node.</simpara>
<simpara>The <literal>text()</literal> method on <literal>AnalyzeRequest</literal> now returns <literal>String[]</literal> instead of
<literal>String</literal>.</simpara>
</section>
<section id="_removed_literal_id_cache_literal_from_clear_cache_api">
<title>Removed <literal>id_cache</literal> from clear cache api<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/index_apis.asciidoc">Edit me</ulink></title>
<simpara>The <link linkend="indices-clearcache">clear cache</link> API no longer supports the <literal>id_cache</literal>
option.  Instead, use the <literal>fielddata</literal> option to clear the cache for the
<literal>_parent</literal> field.</simpara>
</section>
</section>
<section id="breaking_20_snapshot_and_restore_changes">
<title>Snapshot and Restore changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/snapshot_restore.asciidoc">Edit me</ulink></title>
<section id="_file_system_repositories_must_be_whitelisted">
<title>File-system repositories must be whitelisted<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/snapshot_restore.asciidoc">Edit me</ulink></title>
<simpara>Locations of the shared file system repositories and the URL repositories with
<literal>file:</literal> URLs now have to be registered before starting Elasticsearch using the
<literal>path.repo</literal> setting. The <literal>path.repo</literal> setting can contain one or more
repository locations:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.repo: ["/mnt/daily", "/mnt/weekly"]</programlisting>
<simpara>If the repository location is specified as an absolute path it has to start
with one of the locations specified in <literal>path.repo</literal>. If the location is
specified as a relative path, it will be resolved against the first location
specified in the <literal>path.repo</literal> setting.</simpara>
</section>
<section id="_url_repositories_must_be_whitelisted">
<title>URL repositories must be whitelisted<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/snapshot_restore.asciidoc">Edit me</ulink></title>
<simpara>URL repositories with <literal>http:</literal>, <literal>https:</literal>, and <literal>ftp:</literal> URLs have to be
whitelisted before starting Elasticsearch with the
<literal>repositories.url.allowed_urls</literal> setting. This setting supports wildcards in
the place of host, path, query, and fragment. For example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">repositories.url.allowed_urls: ["http://www.example.org/root/*", "https://*.mydomain.com/*?*#*"]</programlisting>
</section>
<section id="_wildcard_expansion">
<title>Wildcard expansion<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/snapshot_restore.asciidoc">Edit me</ulink></title>
<simpara>The obsolete parameters <literal>expand_wildcards_open</literal> and <literal>expand_wildcards_close</literal>
are no longer supported by the snapshot and restore operations. These
parameters have been replaced by a single <literal>expand_wildcards</literal> parameter. See
<link linkend="multi-index">the multi-index docs</link> for more.</simpara>
</section>
</section>
<section id="breaking_20_plugin_and_packaging_changes">
<title>Plugin and packaging changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<section id="_symbolic_links_and_paths">
<title>Symbolic links and paths<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch 2.0 runs with the Java security manager enabled and is much more
restrictive about which paths it is allowed to access.  Various paths can be
configured, e.g. <literal>path.data</literal>, <literal>path.scripts</literal>, <literal>path.repo</literal>.  A configured path
may itself be a symbolic link, but no symlinks under that path will be
followed.</simpara>
</section>
<section id="_running_literal_bin_elasticsearch_literal">
<title>Running <literal>bin/elasticsearch</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>The command line parameter parsing has been rewritten to deal properly with
spaces in parameters. All config settings can still be specified on the
command line when starting Elasticsearch, but they must appear after the
built-in "static parameters", such as <literal>-d</literal> (to daemonize) and <literal>-p</literal> (the PID path).</simpara>
<simpara>For instance:</simpara>
<programlisting language="sh" linenumbering="unnumbered">bin/elasticsearch -d -p /tmp/foo.pid --http.cors.enabled=true --http.cors.allow-origin='*'</programlisting>
<simpara>For a list of static parameters, run <literal>bin/elasticsearch -h</literal></simpara>
</section>
<section id="_literal_f_literal_removed">
<title><literal>-f</literal> removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>The <literal>-f</literal> parameter, which used to indicate that Elasticsearch should be run in
the foreground, was deprecated in 1.0 and removed in 2.0.</simpara>
</section>
<section id="_literal_v_literal_for_version">
<title><literal>V</literal> for version<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>The <literal>-v</literal> parameter now means <literal>--verbose</literal> for both <literal>bin/plugin</literal> and
<literal>bin/elasticsearch</literal> (although it has no effect on the latter).  To output the
version, use <literal>-V</literal> or <literal>--version</literal> instead.</simpara>
</section>
<section id="_plugin_manager_should_run_as_root">
<title>Plugin manager should run as root<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>The permissions of the <literal>config</literal>, <literal>bin</literal>, and <literal>plugins</literal> directories in the RPM
and deb packages have been made more restrictive.  The plugin manager should
be run as root otherwise it will not be able to install plugins.</simpara>
</section>
<section id="_support_for_official_plugins">
<title>Support for official plugins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>Almost all of the official Elasticsearch plugins have been moved to the main
<literal>elasticsearch</literal> repository. They will be released at the same time as
Elasticsearch and have the same version number as Elasticsearch.</simpara>
<simpara>Official plugins can be installed as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">sudo bin/plugin install analysis-icu</programlisting>
<simpara>Community-provided plugins can be installed as before.</simpara>
</section>
<section id="_plugins_require_descriptor_file">
<title>Plugins require descriptor file<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>All plugins are now required to have a <ulink url="https://github.com/elastic/elasticsearch/blob/2.0/dev-tools/src/main/resources/plugin-metadata/plugin-descriptor.properties">plugin-descriptor.properties</ulink>  file.  If a node has a plugin installed which lacks this file, it will be unable to start.</simpara>
</section>
<section id="_repository_naming_structure_changes">
<title>Repository naming structure changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/packaging.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch 2.0 changes the way the repository URLs are referenced. Instead
of specific repositories for both major and minor versions, the repositories will
use a major version reference only.</simpara>
<simpara>The URL for apt packages now uses the following structure;</simpara>
<programlisting language="sh" linenumbering="unnumbered">deb https://packages.elastic.co/elasticsearch/2.x/debian stable main</programlisting>
<simpara>And for yum packages it is;</simpara>
<programlisting language="sh" linenumbering="unnumbered">baseurl=https://packages.elastic.co/elasticsearch/2.x/centos</programlisting>
<simpara>The <link linkend="setup-repositories">repositories</link> page details this change.</simpara>
</section>
</section>
<section id="breaking_20_setting_changes">
<title>Setting changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<section id="_command_line_flags">
<title>Command line flags<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>Command line flags using single dash notation must be now specified as the first arguments.
For example if previously using:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./elasticsearch --node.name=test_node -Des.path.conf=/opt/elasticsearch/conf/test_node</programlisting>
<simpara>This will now need to be changed to:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./elasticsearch -Des.path.conf=/opt/elasticsearch/conf/test_node --node.name=test_node</programlisting>
<simpara>for the flag to take effect.</simpara>
</section>
<section id="migration-script-settings">
<title>Scripting settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The <literal>script.disable_dynamic</literal> node setting has been replaced by fine-grained
script settings described in the <link linkend="enable-dynamic-scripting">scripting docs</link>.
The following setting previously used to enable dynamic or inline scripts:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.disable_dynamic: false</programlisting>
<simpara>It should be replaced with the following two settings in <literal>elasticsearch.yml</literal> that
achieve the same result:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.inline: true
script.indexed: true</programlisting>
</section>
<section id="_units_required_for_time_and_byte_sized_settings">
<title>Units required for time and byte-sized settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>Any settings which accept time or byte values must now be specified with
units.  For instance, it is too easy to set the <literal>refresh_interval</literal> to 1
<emphasis role="strong">millisecond</emphasis> instead of 1 second:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _settings
{
  "index.refresh_interval": 1
}</programlisting>
<simpara>In 2.0, the above request will throw an exception. Instead the refresh
interval should be set to <literal>"1s"</literal> for one second.</simpara>
</section>
<section id="_merge_and_merge_throttling_settings">
<title>Merge and merge throttling settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The tiered merge policy is now the only supported merge policy. These settings
have been removed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>index.merge.policy.type</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.min_merge_size</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.max_merge_size</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.merge_factor</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.max_merge_docs</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.calibrate_size_by_deletes</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.min_merge_docs</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.merge.policy.max_merge_docs</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>Merge throttling now uses a feedback loop to auto-throttle.  These settings
have been removed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>indices.store.throttle.type</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>indices.store.throttle.max_bytes_per_sec</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.store.throttle.type</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index.store.throttle.max_bytes_per_sec</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_shadow_replica_settings">
<title>Shadow replica settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The <literal>node.enable_custom_paths</literal> setting has been removed and replaced by the
<literal>path.shared_data</literal> setting to allow shadow replicas with custom paths to work
with the security manager. For example, if your previous configuration had:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.enable_custom_paths: true</programlisting>
<simpara>And you created an index using shadow replicas with <literal>index.data_path</literal> set to
<literal>/opt/data/my_index</literal> with the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "index": {
    "number_of_shards": 1,
    "number_of_replicas": 4,
    "data_path": "/opt/data/my_index",
    "shadow_replicas": true
  }
}</programlisting>
<simpara>For 2.0, you will need to set <literal>path.shared_data</literal> to a parent directory of the
index&#8217;s data_path, so:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.shared_data: /opt/data</programlisting>
</section>
<section id="_resource_watcher_settings_renamed">
<title>Resource watcher settings renamed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The setting names for configuring the resource watcher have been renamed
to prevent clashes with the watcher plugin</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>watcher.enabled</literal> is now <literal>resource.reload.enabled</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>watcher.interval</literal> is now <literal>resource.reload.interval</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>watcher.interval.low</literal> is now <literal>resource.reload.interval.low</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>watcher.interval.medium</literal> is now <literal>resource.reload.interval.medium</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>watcher.interval.high</literal> is now <literal>resource.reload.interval.high</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_index_gateway_setting_renamed">
<title>index.gateway setting renamed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<itemizedlist>
<listitem>
<simpara>
<literal>index.gateway.local.sync</literal> is now <literal>index.translog.sync_interval</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_hunspell_dictionary_configuration">
<title>Hunspell dictionary configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The parameter <literal>indices.analysis.hunspell.dictionary.location</literal> has been
removed, and <literal>&lt;path.conf&gt;/hunspell</literal> is always used.</simpara>
</section>
<section id="_cors_allowed_origins">
<title>CORS allowed origins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The CORS allowed origins setting, <literal>http.cors.allow-origin</literal>, no longer has a default value. Previously, the default value
was <literal>*</literal>, which would allow CORS requests from any origin and is considered insecure. The <literal>http.cors.allow-origin</literal> setting
should be specified with only the origins that should be allowed, like so:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">http.cors.allow-origin: /https?:\/\/localhost(:[0-9]+)?/</programlisting>
</section>
<section id="_jsonp_support">
<title>JSONP support<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>JSONP callback support has now been removed. CORS should be used to access Elasticsearch
over AJAX instead:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">http.cors.enabled: true
http.cors.allow-origin: /https?:\/\/localhost(:[0-9]+)?/</programlisting>
</section>
<section id="_in_memory_indices">
<title>In memory indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The <literal>memory</literal> / <literal>ram</literal> store (<literal>index.store.type</literal>) option was removed in
Elasticsearch.  In-memory indices are no longer supported.</simpara>
</section>
<section id="_log_messages_truncated">
<title>Log messages truncated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>Log messages are now truncated at 10,000 characters. This can be changed in
the <literal>logging.yml</literal> configuration file with the <literal>file.layout.conversionPattern</literal>
setting.</simpara>
</section>
<section id="_custom_config_file">
<title>Custom config file<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>It is no longer possible to specify a custom config file with the <literal>CONF_FILE</literal>
environment variable, or the <literal>-Des.config</literal>, <literal>-Des.default.config</literal>, or
<literal>-Delasticsearch.config</literal> parameters.</simpara>
<simpara>Instead, the config file must be named <literal>elasticsearch.yml</literal> and must be located
in the default <literal>config/</literal> directory, unless a custom config directory is specified.</simpara>
<simpara>The location of a custom config directory may be specified as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/elasticsearch --path.conf=/path/to/conf/dir
./bin/plugin -Des.path.conf=/path/to/conf/dir install analysis-icu</programlisting>
<simpara>When using the RPM or debian packages, the plugin script and the
init/service scripts will consult the <literal>CONF_DIR</literal> environment variable
to check for a custom config location.  The value of the <literal>CONF_DIR</literal>
variable can be set in the environment config file which is located either in
<literal>/etc/default/elasticsearch</literal> or <literal>/etc/sysconfig/elasticsearch</literal>.</simpara>
</section>
<section id="_custom_analysis_file_paths">
<title>Custom analysis file paths<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>It is no longer possible to set custom file path outside <literal>CONF_DIR</literal> for <literal>*_path</literal> settings
in <link linkend="analysis-charfilters">char</link> or <link linkend="analysis-tokenfilters">token</link> filters.
You must specify either relative path to <literal>CONF_DIR</literal> location or absolute path inside <literal>CONF_DIR</literal> location.</simpara>
</section>
<section id="_literal_es_classpath_removed_literal">
<title><literal>ES_CLASSPATH removed</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/settings.asciidoc">Edit me</ulink></title>
<simpara>The <literal>ES_CLASSPATH</literal> environment variable is no longer used to set the class
path. External libraries should preferably be loaded using the plugin
mechanism or, if you really must, be copied to the <literal>lib/</literal> directory.</simpara>
</section>
</section>
<section id="breaking_20_stats_info_and_literal_cat_literal_changes">
<title>Stats, info, and <literal>cat</literal> changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<section id="_sigar_removed">
<title>Sigar removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>We no longer ship the Sigar library for operating system dependent statistics,
as it no longer seems to be maintained.  Instead, we rely on the statistics
provided by the JVM.  This has resulted in a number of changes to the node
info, and node stats responses:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>network.*</literal> has been removed from nodes info and nodes stats.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>fs.*.dev</literal> and <literal>fs.*.disk*</literal> have been removed from nodes stats.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>os.*</literal> has been removed from nodes stats, except for <literal>os.timestamp</literal>,
  <literal>os.load_average</literal>, <literal>os.mem.*</literal>, and <literal>os.swap.*</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>os.mem.total</literal> and <literal>os.swap.total</literal> have been removed from nodes info.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>process.mem.resident</literal> and <literal>process.mem.share</literal> have been removed from node stats.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_removed_literal_id_cache_literal_from_stats_apis">
<title>Removed <literal>id_cache</literal> from stats apis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>Removed <literal>id_cache</literal> metric from nodes stats, indices stats and cluster stats
apis. This metric has also been removed from the shards cat, indices cat and
nodes cat apis. Parent/child memory is now reported under fielddata, because
it has internally been using fielddata for a while now.</simpara>
<simpara>To just see how much parent/child related field data is taking, the
<literal>fielddata_fields</literal> option can be used on the stats apis. Indices stats
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_stats/fielddata?fielddata_fields=_parent</programlisting>
</section>
<section id="_percolator_stats">
<title>Percolator stats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>The total time spent running percolator queries is now called <literal>percolate.time</literal>
instead of <literal>percolate.get_time</literal>.</simpara>
</section>
<section id="_cluster_state_rest_api">
<title>Cluster state REST API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>The cluster state API doesn&#8217;t return the <literal>routing_nodes</literal> section anymore when
<literal>routing_table</literal> is requested. The newly introduced <literal>routing_nodes</literal> flag can be
used separately to control whether <literal>routing_nodes</literal> should be returned.</simpara>
</section>
<section id="_index_status_api">
<title>Index status API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>The deprecated index status API has been removed.</simpara>
</section>
<section id="_nodes_stats_api">
<title>Nodes Stats API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/stats.asciidoc">Edit me</ulink></title>
<simpara>Queue lengths are now reported as basic numeric so they can easily processed by code. Before we used a human
readable format. For example, a queue with 1,000 items is now reported as <literal>1000</literal> instead of <literal>1k</literal>.</simpara>
</section>
</section>
<section id="breaking_20_java_api_changes">
<title>Java API changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<section id="_transport_api_construction">
<title>Transport API construction<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>The <literal>TransportClient</literal> construction code has changed, it now uses the builder
pattern. Instead of:</simpara>
<programlisting language="java" linenumbering="unnumbered">Settings settings = Settings.settingsBuilder()
        .put("cluster.name", "myClusterName").build();
Client client = new TransportClient(settings);</programlisting>
<simpara>Use the following:</simpara>
<programlisting language="java" linenumbering="unnumbered">Settings settings = Settings.settingsBuilder()
        .put("cluster.name", "myClusterName").build();
Client client = TransportClient.builder().settings(settings).build();</programlisting>
<simpara>The transport client also no longer supports loading settings from config files.
If you have a config file, you can load it into settings yourself before
constructing the transport client:</simpara>
<programlisting language="java" linenumbering="unnumbered">Settings settings = Settings.settingsBuilder()
        .loadFromPath(pathToYourSettingsFile).build();
Client client = TransportClient.builder().settings(settings).build();</programlisting>
</section>
<section id="_exception_are_only_thrown_on_total_failure">
<title>Exception are only thrown on total failure<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Previously, many APIs would throw an exception if any shard failed to execute
the request. Now the exception is only thrown if all shards fail the request.
The responses for these APIs will always have a <literal>getShardFailures</literal> method that
you can and should check for failures.</simpara>
</section>
<section id="_indexmissingexception_removed">
<title>IndexMissingException removed.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Use <literal>IndexNotFoundException</literal> instead.</simpara>
</section>
<section id="_automatically_thread_client_listeners">
<title>Automatically thread client listeners<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Previously, the user had to set request listener threads to <literal>true</literal> when on the
client side in order not to block IO threads on heavy operations. This proved
to be very trappy for users, and ended up creating problems that are very hard
to debug.</simpara>
<simpara>In 2.0, Elasticsearch automatically threads listeners that are used from the
client when the client is a node client or a transport client. Threading can
no longer be manually set.</simpara>
</section>
<section id="_query_filter_refactoring">
<title>Query/filter refactoring<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara><literal>org.elasticsearch.index.queries.FilterBuilders</literal> has been removed as part of the merge of
queries and filters. These filters are now available in <literal>QueryBuilders</literal> with the same name.
All methods that used to accept a <literal>FilterBuilder</literal> now accept a <literal>QueryBuilder</literal> instead.</simpara>
<simpara>In addition some query builders have been removed or renamed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>commonTerms(...)</literal> renamed with <literal>commonTermsQuery(...)</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>queryString(...)</literal> renamed with <literal>queryStringQuery(...)</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>simpleQueryString(...)</literal> renamed with <literal>simpleQueryStringQuery(...)</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>textPhrase(...)</literal> removed
</simpara>
</listitem>
<listitem>
<simpara>
<literal>textPhrasePrefix(...)</literal> removed
</simpara>
</listitem>
<listitem>
<simpara>
<literal>textPhrasePrefixQuery(...)</literal> removed
</simpara>
</listitem>
<listitem>
<simpara>
<literal>filtered(...)</literal> removed. Use <literal>filteredQuery(...)</literal> instead.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>inQuery(...)</literal> removed.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_getindexrequest">
<title>GetIndexRequest<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara><literal>GetIndexRequest.features()</literal> now returns an array of Feature Enums instead of an array of String values.</simpara>
<simpara>The following deprecated methods have been removed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>GetIndexRequest.addFeatures(String[])</literal> - Use
  <literal>GetIndexRequest.addFeatures(Feature[])</literal> instead
</simpara>
</listitem>
<listitem>
<simpara>
<literal>GetIndexRequest.features(String[])</literal> - Use
  <literal>GetIndexRequest.features(Feature[])</literal> instead.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>GetIndexRequestBuilder.addFeatures(String[])</literal> - Use
  <literal>GetIndexRequestBuilder.addFeatures(Feature[])</literal> instead.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>GetIndexRequestBuilder.setFeatures(String[])</literal> - Use
  <literal>GetIndexRequestBuilder.setFeatures(Feature[])</literal> instead.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_bytesquerybuilder_removed">
<title>BytesQueryBuilder removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>The redundant BytesQueryBuilder has been removed in favour of the
WrapperQueryBuilder internally.</simpara>
</section>
<section id="_termsquerybuilder_execution_removed">
<title>TermsQueryBuilder execution removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>The <literal>TermsQueryBuilder#execution</literal> method has been removed as it has no effect, it is ignored by the
 corresponding parser.</simpara>
</section>
<section id="_immutablesettings_removed">
<title>ImmutableSettings removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Use <literal>Settings.builder()</literal> instead of <literal>ImmutableSettings.builder()</literal>.</simpara>
</section>
<section id="_inetsockettransportaddress_removed">
<title>InetSocketTransportAddress removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Use <literal>InetSocketTransportAddress(InetSocketAddress address)</literal> instead of <literal>InetSocketTransportAddress(String, int)</literal>.
You can create an InetSocketAddress instance with <literal>InetSocketAddress(String, int)</literal>. For example:</simpara>
<programlisting language="java" linenumbering="unnumbered">new InetSocketTransportAddress(new InetSocketAddress("127.0.0.1", 0));</programlisting>
</section>
<section id="_request_builders_refactoring">
<title>Request Builders refactoring<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>An <literal>action</literal> parameter has been added to various request builders:</simpara>
<itemizedlist>
<listitem>
<simpara>
Instead of <literal>new SnapshotsStatusRequestBuilder(elasticSearchClient)</literal> use <literal>new SnapshotsStatusRequestBuilder(elasticSearchClient, SnapshotsStatusAction.INSTANCE)</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
Instead of <literal>new CreateSnapshotRequestBuilder(elasticSearchClient)</literal> use <literal>new CreateSnapshotRequestBuilder(elasticSearchClient, CreateSnapshotAction.INSTANCE)</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
Instead of <literal>new CreateIndexRequestBuilder(elasticSearchClient, index)</literal> use <literal>new CreateIndexRequestBuilder(elasticSearchClient, CreateIndexAction.INSTANCE, index)</literal>.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_shading_and_package_relocation_removed">
<title>Shading and package relocation removed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/migration/migrate_2_0/java.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch used to shade its dependencies and to relocate packages. We no longer use shading or relocation.
You might need to change your imports to the original package names:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>com.google.common</literal> was <literal>org.elasticsearch.common</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>com.carrotsearch.hppc</literal> was <literal>org.elasticsearch.common.hppc</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>jsr166e</literal> was <literal>org.elasticsearch.common.util.concurrent.jsr166e</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>com.fasterxml.jackson</literal> was <literal>org.elasticsearch.common.jackson</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>org.joda.time</literal> was <literal>org.elasticsearch.common.joda.time</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>org.joda.convert</literal> was <literal>org.elasticsearch.common.joda.convert</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>org.jboss.netty</literal> was <literal>org.elasticsearch.common.netty</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>com.ning.compress</literal> was <literal>org.elasticsearch.common.compress</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>com.github.mustachejava</literal> was <literal>org.elasticsearch.common.mustache</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>com.tdunning.math.stats</literal> was <literal>org.elasticsearch.common.stats</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>org.apache.commons.lang</literal> was <literal>org.elasticsearch.common.lang</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>org.apache.commons.cli</literal> was <literal>org.elasticsearch.common.cli.commons</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</chapter>
</part>
<part id="api-conventions">
<title>API Conventions <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>The <emphasis role="strong">elasticsearch</emphasis> REST APIs are exposed using <link linkend="modules-http">JSON over HTTP</link>.</simpara>
<simpara>The conventions listed in this chapter can be applied throughout the REST
API, unless otherwise specified.</simpara>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="multi-index"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="date-math-index-names"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="common-options"/>
</simpara>
</listitem>
</itemizedlist>
</partintro>
<chapter id="multi-index">
<title>Multiple Indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></title>
<simpara>Most APIs that refer to an <literal>index</literal> parameter support execution across multiple indices,
using simple <literal>test1,test2,test3</literal> notation (or <literal>_all</literal> for all indices). It also
support wildcards, for example: <literal>test*</literal> or <literal>*test</literal> or <literal>te*t</literal> or <literal>*test*</literal>, and the ability to "add" (<literal>+</literal>)
and "remove" (<literal>-</literal>), for example: <literal>+test*,-test3</literal>.</simpara>
<simpara>All multi indices API support the following url query string parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>ignore_unavailable</literal>
</term>
<listitem>
<simpara>
Controls whether to ignore if any specified indices are unavailable, this
includes indices that don&#8217;t exist or closed indices. Either <literal>true</literal> or <literal>false</literal>
can be specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>allow_no_indices</literal>
</term>
<listitem>
<simpara>
Controls whether to fail if a wildcard indices expressions results into no
concrete indices. Either <literal>true</literal> or <literal>false</literal> can be specified. For example if
the wildcard expression <literal>foo*</literal> is specified and no indices are available that
start with <literal>foo</literal> then depending on this setting the request will fail. This
setting is also applicable when <literal>_all</literal>, <literal>*</literal> or no index has been specified. This
settings also applies for aliases, in case an alias points to a closed index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>expand_wildcards</literal>
</term>
<listitem>
<simpara>
Controls to what kind of concrete indices wildcard indices expression expand
to. If <literal>open</literal> is specified then the wildcard expression is expanded to only
open indices and if <literal>closed</literal> is specified then the wildcard expression is
expanded only to closed indices. Also both values (<literal>open,closed</literal>) can be
specified to expand to all indices.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>If <literal>none</literal> is specified then wildcard expansion will be disabled and if <literal>all</literal>
is specified, wildcard expressions will expand to all indices (this is equivalent
to specifying <literal>open,closed</literal>).</simpara>
<simpara>The defaults settings for the above parameters depend on the api being used.</simpara>
<note><simpara>Single index APIs such as the <xref linkend="docs"/> and the
<link linkend="indices-aliases">single-index <literal>alias</literal> APIs</link> do not support multiple indices.</simpara></note>
</chapter>
<chapter id="date-math-index-names">
<title>Date math support in index names<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></title>
<simpara>Date math index name resolution enables you to search a range of time-series indices, rather
than searching all of your time-series indices and filtering the results or maintaining aliases.
Limiting the number of indices that are searched reduces the load on the cluster and improves
execution performance. For example, if you are searching for errors in your
daily logs, you can use a date math name template to restrict the search to the past
two days.</simpara>
<simpara>Almost all APIs that have an <literal>index</literal> parameter, support date math in the <literal>index</literal> parameter
value.</simpara>
<simpara>A date math index name takes the following form:</simpara>
<programlisting language="txt" linenumbering="unnumbered">&lt;static_name{date_math_expr{date_format|time_zone}}&gt;</programlisting>
<simpara>Where:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>static_name</literal>
</simpara>
</entry>
<entry>
<simpara>
is the static text part of the name
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>date_math_expr</literal>
</simpara>
</entry>
<entry>
<simpara>
is a dynamic date math expression that computes the date dynamically
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>date_format</literal>
</simpara>
</entry>
<entry>
<simpara>
is the optional format in which the computed date should be rendered. Defaults to <literal>YYYY.MM.dd</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>time_zone</literal>
</simpara>
</entry>
<entry>
<simpara>
is the optional time zone . Defaults to <literal>utc</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>You must enclose date math index name expressions within angle brackets. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/&lt;logstash-{now%2Fd-2d}&gt;/_search' {
  "query" : {
    ...
  }
}</programlisting>
<note><simpara>The <literal>/</literal> used for date rounding must be url encoded as <literal>%2F</literal> in any url.</simpara></note>
<simpara>The following example shows different forms of date math index names and the final index names
they resolve to given the current time is 22rd March 2024 noon utc.</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top"> Expression                                  </entry>
<entry align="left" valign="top">Resolves to</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>&lt;logstash-{now/d}&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>logstash-2024.03.22</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>&lt;logstash-{now/M}&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>logstash-2024.03.01</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>&lt;logstash-{now/M{YYYY.MM}}&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>logstash-2024.03</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>&lt;logstash-{now/M-1M{YYYY.MM}}&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>logstash-2024.02</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>&lt;logstash-{now/d{YYYY.MM.dd|+12:00}}&gt;</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>logstash-2024.03.23</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>To use the characters <literal>{</literal> and <literal>}</literal> in the static part of an index name template, escape them
with a backslash <literal>\</literal>, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>&lt;elastic\\{ON\\}-{now/M}&gt;</literal> resolves to <literal>elastic{ON}-2024.03.01</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>The following example shows a search request that searches the Logstash indices for the past
three days, assuming the indices use the default Logstash index name format,
<literal>logstash-YYYY.MM.dd</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/&lt;logstash-{now%2Fd-2d}&gt;,&lt;logstash-{now%2Fd-1d}&gt;,&lt;logstash-{now%2Fd}&gt;/_search' {
  "query" : {
    ...
  }
}</programlisting>
</chapter>
<chapter id="common-options">
<title>Common options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></title>
<simpara>The following options can be applied to all of the REST APIs.</simpara>
<bridgehead id="_pretty_results" renderas="sect2">Pretty Results<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>When appending <literal>?pretty=true</literal> to any request made, the JSON returned
will be pretty formatted (use it for debugging only!). Another option is
to set <literal>?format=yaml</literal> which will cause the result to be returned in the
(sometimes) more readable yaml format.</simpara>
<bridgehead id="_human_readable_output" renderas="sect2">Human readable output<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Statistics are returned in a format suitable for humans
(eg <literal>"exists_time": "1h"</literal> or <literal>"size": "1kb"</literal>) and for computers
(eg <literal>"exists_time_in_millis": 3600000</literal> or <literal>"size_in_bytes": 1024</literal>).
The human readable values can be turned off by adding <literal>?human=false</literal>
to the query string. This makes sense when the stats results are
being consumed by a monitoring tool, rather than intended for human
consumption.  The default for the <literal>human</literal> flag is
<literal>false</literal>.</simpara>
<bridgehead id="date-math" renderas="sect2">Date Math<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most parameters which accept a formatted date value&#8201;&#8212;&#8201;such as <literal>gt</literal> and <literal>lt</literal>
in <link linkend="query-dsl-range-query">range queries</link> <literal>range</literal> queries, or <literal>from</literal> and <literal>to</literal>
in <link linkend="search-aggregations-bucket-daterange-aggregation"><literal>daterange</literal> aggregations</link>&#8201;&#8212;&#8201;understand date maths.</simpara>
<simpara>The expression starts with an anchor date, which can either be <literal>now</literal>, or a
date string ending with <literal>||</literal>. This anchor date can optionally be followed by
one or more maths expressions:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>+1h</literal> - add one hour
</simpara>
</listitem>
<listitem>
<simpara>
<literal>-1d</literal> - subtract one day
</simpara>
</listitem>
<listitem>
<simpara>
<literal>/d</literal>  - round down to the nearest day
</simpara>
</listitem>
</itemizedlist>
<simpara>The supported <link linkend="time-units">time units</link> are: <literal>y</literal> (year), <literal>M</literal> (month), <literal>w</literal> (week),
<literal>d</literal> (day), <literal>h</literal> (hour), <literal>m</literal> (minute), and <literal>s</literal> (second).</simpara>
<simpara>Some examples are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>now+1h</literal>
</simpara>
</entry>
<entry>
<simpara>
The current time plus one hour, with ms resolution.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>now+1h+1m</literal>
</simpara>
</entry>
<entry>
<simpara>
The current time plus one hour plus one minute, with ms resolution.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>now+1h/d</literal>
</simpara>
</entry>
<entry>
<simpara>
The current time plus one hour, rounded down to the nearest day.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>2015-01-01||+1M/d</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>2015-01-01</literal> plus one month, rounded down to the nearest day.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_response_filtering" renderas="sect2">Response Filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>All REST APIs accept a <literal>filter_path</literal> parameter that can be used to reduce
the response returned by elasticsearch. This parameter takes a comma
separated list of filters expressed with the dot notation:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET 'localhost:9200/_search?pretty&amp;filter_path=took,hits.hits._id,hits.hits._score'
{
  "took" : 3,
  "hits" : {
    "hits" : [
      {
        "_id" : "3640",
        "_score" : 1.0
      },
      {
        "_id" : "3642",
        "_score" : 1.0
      }
    ]
  }
}</programlisting>
<simpara>It also supports the <literal>*</literal> wildcard character to match any field or part
of a field&#8217;s name:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET 'localhost:9200/_nodes/stats?filter_path=nodes.*.ho*'
{
  "nodes" : {
    "lvJHed8uQQu4brS-SXKsNA" : {
      "host" : "portable"
    }
  }
}</programlisting>
<simpara>And the <literal>**</literal> wildcard can be used to include fields without knowing the
exact path of the field. For example, we can return the Lucene version
of every segment with this request:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'localhost:9200/_segments?pretty&amp;filter_path=indices.**.version'
{
  "indices" : {
    "movies" : {
      "shards" : {
        "0" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ],
        "2" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ]
      }
    },
    "books" : {
      "shards" : {
        "0" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ]
      }
    }
  }
}</programlisting>
<simpara>Note that elasticsearch sometimes returns directly the raw value of a field,
like the <literal>_source</literal> field. If you want to filter <literal>_source</literal> fields, you should
consider combining the already existing <literal>_source</literal> parameter (see
<link linkend="get-source-filtering">Get API</link> for more details) with the <literal>filter_path</literal>
parameter like this:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET 'localhost:9200/_search?pretty&amp;filter_path=hits.hits._source&amp;_source=title'
{
  "hits" : {
    "hits" : [ {
      "_source":{"title":"Book #2"}
    }, {
      "_source":{"title":"Book #1"}
    }, {
      "_source":{"title":"Book #3"}
    } ]
  }
}</programlisting>
<bridgehead id="_flat_settings" renderas="sect2">Flat Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>flat_settings</literal> flag affects rendering of the lists of settings. When
<literal>flat_settings</literal> flag is <literal>true</literal> settings are returned in a flat format:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "persistent" : { },
  "transient" : {
    "discovery.zen.minimum_master_nodes" : "1"
  }
}</programlisting>
<simpara>When the <literal>flat_settings</literal> flag is <literal>false</literal> settings are returned in a more
human readable structured format:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "persistent" : { },
  "transient" : {
    "discovery" : {
      "zen" : {
        "minimum_master_nodes" : "1"
      }
    }
  }
}</programlisting>
<simpara>By default the <literal>flat_settings</literal> is set to <literal>false</literal>.</simpara>
<bridgehead id="_parameters" renderas="sect2">Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Rest parameters (when using HTTP, map to HTTP URL parameters) follow the
convention of using underscore casing.</simpara>
<bridgehead id="_boolean_values" renderas="sect2">Boolean Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>All REST APIs parameters (both request parameters and JSON body) support
providing boolean "false" as the values: <literal>false</literal>, <literal>0</literal>, <literal>no</literal> and <literal>off</literal>.
All other values are considered "true". Note, this is not related to
fields within a document indexed treated as boolean fields.</simpara>
<bridgehead id="_number_values" renderas="sect2">Number Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>All REST APIs support providing numbered parameters as <literal>string</literal> on top
of supporting the native JSON number types.</simpara>
<bridgehead id="time-units" renderas="sect2">Time units<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Whenever durations need to be specified, eg for a <literal>timeout</literal> parameter, the
duration must specify the unit, like <literal>2d</literal> for 2 days.  The supported units
are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>y</literal>
</simpara>
</entry>
<entry>
<simpara>
Year
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>M</literal>
</simpara>
</entry>
<entry>
<simpara>
Month
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>w</literal>
</simpara>
</entry>
<entry>
<simpara>
Week
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>d</literal>
</simpara>
</entry>
<entry>
<simpara>
Day
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>h</literal>
</simpara>
</entry>
<entry>
<simpara>
Hour
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>m</literal>
</simpara>
</entry>
<entry>
<simpara>
Minute
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>s</literal>
</simpara>
</entry>
<entry>
<simpara>
Second
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ms</literal>
</simpara>
</entry>
<entry>
<simpara>
Milli-second
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="size-units" renderas="sect2">Data size units<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Whenever the size of data needs to be specified, eg when setting a buffer size
parameter, the value must specify the unit, like <literal>10kb</literal> for 10 kilobytes.  The
supported units are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>b</literal>
</simpara>
</entry>
<entry>
<simpara>
Bytes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>kb</literal>
</simpara>
</entry>
<entry>
<simpara>
Kilobytes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>mb</literal>
</simpara>
</entry>
<entry>
<simpara>
Megabytes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>gb</literal>
</simpara>
</entry>
<entry>
<simpara>
Gigabytes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>tb</literal>
</simpara>
</entry>
<entry>
<simpara>
Terabytes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>pb</literal>
</simpara>
</entry>
<entry>
<simpara>
Petabytes
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="distance-units" renderas="sect2">Distance Units<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Wherever distances need to be specified, such as the <literal>distance</literal> parameter in
the <xref linkend="query-dsl-geo-distance-query"/>), the default unit if none is specified is
the meter. Distances can be specified in other units, such as <literal>"1km"</literal> or
<literal>"2mi"</literal> (2 miles).</simpara>
<simpara>The full list of units is listed below:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
Mile
</simpara>
</entry>
<entry>
<simpara>
<literal>mi</literal> or <literal>miles</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Yard
</simpara>
</entry>
<entry>
<simpara>
<literal>yd</literal> or <literal>yards</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Feet
</simpara>
</entry>
<entry>
<simpara>
<literal>ft</literal> or <literal>feet</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Inch
</simpara>
</entry>
<entry>
<simpara>
<literal>in</literal> or <literal>inch</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Kilometer
</simpara>
</entry>
<entry>
<simpara>
<literal>km</literal> or <literal>kilometers</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Meter
</simpara>
</entry>
<entry>
<simpara>
<literal>m</literal> or <literal>meters</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Centimeter
</simpara>
</entry>
<entry>
<simpara>
<literal>cm</literal> or <literal>centimeters</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Millimeter
</simpara>
</entry>
<entry>
<simpara>
<literal>mm</literal> or <literal>millimeters</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Nautical mile
</simpara>
</entry>
<entry>
<simpara>
<literal>NM</literal>, <literal>nmi</literal> or <literal>nauticalmiles</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The <literal>precision</literal> parameter in the <xref linkend="query-dsl-geohash-cell-query"/> accepts
distances with the above units, but if no unit is specified, then the
precision is interpreted as the length of the geohash.</simpara>
<bridgehead id="fuzziness" renderas="sect2">Fuzziness<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>Some queries and APIs support parameters to allow inexact <emphasis>fuzzy</emphasis> matching,
using the <literal>fuzziness</literal> parameter. The <literal>fuzziness</literal> parameter is context
sensitive which means that it depends on the type of the field being queried:</simpara>
<bridgehead id="_numeric_date_and_ipv4_fields" renderas="sect3">Numeric, date and IPv4 fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>When querying numeric, date and IPv4 fields, <literal>fuzziness</literal> is interpreted as a
<literal>+/-</literal> margin. It behaves like a <xref linkend="query-dsl-range-query"/> where:</simpara>
<literallayout class="monospaced">-fuzziness &lt;= field value &lt;= +fuzziness</literallayout>
<simpara>The <literal>fuzziness</literal> parameter should be set to a numeric value, eg <literal>2</literal> or <literal>2.0</literal>. A
<literal>date</literal> field interprets a long as milliseconds, but also accepts a string
containing a time value&#8201;&#8212;&#8201;<literal>"1h"</literal>&#8201;&#8212;&#8201;as explained in <xref linkend="time-units"/>. An <literal>ip</literal>
field accepts a long or another IPv4 address (which will be converted into a
long).</simpara>
<bridgehead id="_string_fields" renderas="sect3">String fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>When querying <literal>string</literal> fields, <literal>fuzziness</literal> is interpreted as a
<ulink url="http://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein Edit Distance</ulink>&#8201;&#8212;&#8201;the number of one character changes that need to be made to one string to
make it the same as another string.</simpara>
<simpara>The <literal>fuzziness</literal> parameter can be specified as:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>0</literal>, <literal>1</literal>, <literal>2</literal>
</term>
<listitem>
<simpara>
the maximum allowed Levenshtein Edit Distance (or number of edits)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>AUTO</literal>
</term>
<listitem>
<simpara>generates an edit distance based on the length of the term. For lengths:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>0..2</literal>
</term>
<listitem>
<simpara>
must match exactly
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>3..5</literal>
</term>
<listitem>
<simpara>
one edit allowed
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>&gt;5</literal>
</term>
<listitem>
<simpara>
two edits allowed
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><literal>AUTO</literal> should generally be the preferred value for <literal>fuzziness</literal>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_result_casing" renderas="sect2">Result Casing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>All REST APIs accept the <literal>case</literal> parameter. When set to <literal>camelCase</literal>, all
field names in the result will be returned in camel casing, otherwise,
underscore casing will be used. Note, this does not apply to the source
document indexed.</simpara>
<bridgehead id="_request_body_in_query_string" renderas="sect2">Request body in query string<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></bridgehead>
<simpara>For libraries that don&#8217;t accept a request body for non-POST requests,
you can pass the request body as the <literal>source</literal> query string parameter
instead.</simpara>
</chapter>
<chapter id="url-access-control">
<title>URL-based access control<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/api-conventions.asciidoc">Edit me</ulink></title>
<simpara>Many users use a proxy with URL-based access control to secure access to
Elasticsearch indices. For <link linkend="search-multi-search">multi-search</link>,
<link linkend="docs-multi-get">multi-get</link> and <link linkend="docs-bulk">bulk</link> requests, the user has
the choice of specifying an index in the URL and on each individual request
within the request body. This can make URL-based access control challenging.</simpara>
<simpara>To prevent the user from overriding the index which has been specified in the
URL, add this setting to the <literal>config.yml</literal> file:</simpara>
<literallayout class="monospaced">rest.action.multi.allow_explicit_index: false</literallayout>
<simpara>The default value is <literal>true</literal>, but when set to <literal>false</literal>, Elasticsearch will
reject requests that have an explicit index specified in the request body.</simpara>
</chapter>
</part>
<part id="docs">
<title>Document APIs <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section describes the following CRUD APIs:</simpara>
<itemizedlist><title>Single document APIs</title>
<listitem>
<simpara>
<xref linkend="docs-index_"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="docs-get"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="docs-delete"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="docs-update"/>
</simpara>
</listitem>
</itemizedlist>
<itemizedlist><title>Multi-document APIs</title>
<listitem>
<simpara>
<xref linkend="docs-multi-get"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="docs-bulk"/>
</simpara>
</listitem>
</itemizedlist>
<note><simpara>All CRUD APIs are single-index APIs. The <literal>index</literal> parameter accepts a single
index name, or an <literal>alias</literal> which points to a single index.</simpara></note>
</partintro>
<chapter id="docs-index_">
<title>Index API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></title>
<simpara>The index API adds or updates a typed JSON document in a specific index,
making it searchable. The following example inserts the JSON document
into the "twitter" index, under a type called "tweet" with an id of 1:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>The result of the above index operation is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_shards" : {
        "total" : 10,
        "failed" : 0,
        "successful" : 10
    },
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "created" : true
}</programlisting>
<simpara>The <literal>_shards</literal> header provides information about the replication process of the index operation.</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>total</literal> - Indicates to how many shard copies (primary and replica shards) the index operation should be executed on.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>successful</literal>- Indicates the number of shard copies the index operation succeeded on.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>failures</literal> - An array that contains replication related errors in the case an index operation failed on a replica shard.
</simpara>
</listitem>
</itemizedlist>
<simpara>The index operation is successful in the case <literal>successful</literal> is at least 1.</simpara>
<note><simpara>Replica shards may not all be started when an indexing operation successfully returns (by default, a  quorum is
        required). In that case, <literal>total</literal> will be equal to the total shards based on the index replica settings and
        <literal>successful</literal> will be equal to the number of shards started (primary plus replicas). As there were no failures,
        the <literal>failed</literal> will be 0.</simpara></note>
<bridgehead id="index-creation" renderas="sect2">Automatic Index Creation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>The index operation automatically creates an index if it has not been
created before (check out the
<link linkend="indices-create-index">create index API</link> for manually
creating an index), and also automatically creates a
dynamic type mapping for the specific type if one has not yet been
created (check out the <link linkend="indices-put-mapping">put mapping</link>
API for manually creating a type mapping).</simpara>
<simpara>The mapping itself is very flexible and is schema-free. New fields and
objects will automatically be added to the mapping definition of the
type specified. Check out the <link linkend="mapping">mapping</link>
section for more information on mapping definitions.</simpara>
<simpara>Automatic index creation can be disabled by setting
<literal>action.auto_create_index</literal> to <literal>false</literal> in the config file of all nodes.
Automatic mapping creation can be disabled by setting
<literal>index.mapper.dynamic</literal> to <literal>false</literal> per-index as an index setting.</simpara>
<simpara>Automatic index creation can include a pattern based white/black list,
for example, set <literal>action.auto_create_index</literal> to <literal>+aaa*,-bbb*,+ccc*,-*</literal> (+
meaning allowed, and - meaning disallowed).</simpara>
<bridgehead id="index-versioning" renderas="sect2">Versioning<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each indexed document is given a version number. The associated
<literal>version</literal> number is returned as part of the response to the index API
request. The index API optionally allows for
<ulink url="http://en.wikipedia.org/wiki/Optimistic_concurrency_control">optimistic
concurrency control</ulink> when the <literal>version</literal> parameter is specified. This
will control the version of the document the operation is intended to be
executed against. A good example of a use case for versioning is
performing a transactional read-then-update. Specifying a <literal>version</literal> from
the document initially read ensures no changes have happened in the
meantime (when reading in order to update, it is recommended to set
<literal>preference</literal> to <literal>_primary</literal>). For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/twitter/tweet/1?version=2' -d '{
    "message" : "elasticsearch now has versioning support, double cool!"
}'</programlisting>
<simpara><emphasis role="strong">NOTE:</emphasis> versioning is completely real time, and is not affected by the
near real time aspects of search operations. If no version is provided,
then the operation is executed without any version checks.</simpara>
<simpara>By default, internal versioning is used that starts at 1 and increments
with each update, deletes included. Optionally, the version number can be
supplemented with an external value (for example, if maintained in a
database). To enable this functionality, <literal>version_type</literal> should be set to
<literal>external</literal>. The value provided must be a numeric, long value greater or equal to 0,
and less than around 9.2e+18. When using the external version type, instead
of checking for a matching version number, the system checks to see if
the version number passed to the index request is greater than the
version of the currently stored document. If true, the document will be
indexed and the new version number used. If the value provided is less
than or equal to the stored document&#8217;s version number, a version
conflict will occur and the index operation will fail.</simpara>
<simpara>A nice side effect is that there is no need to maintain strict ordering
of async indexing operations executed as a result of changes to a source
database, as long as version numbers from the source database are used.
Even the simple case of updating the elasticsearch index using data from
a database is simplified if external versioning is used, as only the
latest version will be used if the index operations are out of order for
whatever reason.</simpara>
<bridgehead id="_version_types" renderas="sect3">Version types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>Next to the <literal>internal</literal> &amp; <literal>external</literal> version types explained above, Elasticsearch
also supports other types for specific use cases. Here is an overview of
the different version types and their semantics.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>internal</literal>
</term>
<listitem>
<simpara>
only index the document if the given version is identical to the version
of the stored document.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>external</literal> or <literal>external_gt</literal>
</term>
<listitem>
<simpara>
only index the document if the given version is strictly higher
than the version of the stored document <emphasis role="strong">or</emphasis> if there is no existing document. The given
version will be used as the new version and will be stored with the new document. The supplied
version must be a non-negative long number.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>external_gte</literal>
</term>
<listitem>
<simpara>
only index the document if the given version is <emphasis role="strong">equal</emphasis> or higher
than the version of the stored document. If there is no existing document
the operation will succeed as well. The given version will be used as the new version
and will be stored with the new document. The supplied version must be a non-negative long number.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><emphasis role="strong">NOTE</emphasis>: The <literal>external_gte</literal> version type is meant for special use cases and
should be used with care. If used incorrectly, it can result in loss of data.
There is another option, <literal>force</literal>, which is deprecated because it can cause
primary and replica shards to diverge.</simpara>
<bridgehead id="operation-type" renderas="sect2">Operation Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>The index operation also accepts an <literal>op_type</literal> that can be used to force
a <literal>create</literal> operation, allowing for "put-if-absent" behavior. When
<literal>create</literal> is used, the index operation will fail if a document by that id
already exists in the index.</simpara>
<simpara>Here is an example of using the <literal>op_type</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?op_type=create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>Another option to specify <literal>create</literal> is to use the following uri:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1/_create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<bridgehead id="_automatic_id_generation" renderas="sect2">Automatic ID Generation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>The index operation can be executed without specifying the id. In such a
case, an id will be generated automatically. In addition, the <literal>op_type</literal>
will automatically be set to <literal>create</literal>. Here is an example (note the
<emphasis role="strong">POST</emphasis> used instead of <emphasis role="strong">PUT</emphasis>):</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/tweet/' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>The result of the above index operation is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "6a8ca01c-7896-48e9-81cc-9f70661fcb32",
    "_version" : 1,
    "created" : true
}</programlisting>
<bridgehead id="index-routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, shard placement — or <literal>routing</literal> — is controlled by using a
hash of the document&#8217;s id value. For more explicit control, the value
fed into the hash function used by the router can be directly specified
on a per-operation basis using the <literal>routing</literal> parameter. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>In the example above, the "tweet" document is routed to a shard based on
the <literal>routing</literal> parameter provided: "kimchy".</simpara>
<simpara>When setting up explicit mapping, the <literal>_routing</literal> field can be optionally
used to direct the index operation to extract the routing value from the
document itself. This does come at the (very minimal) cost of an
additional document parsing pass. If the <literal>_routing</literal> mapping is defined
and set to be <literal>required</literal>, the index operation will fail if no routing
value is provided or extracted.</simpara>
<bridgehead id="parent-children" renderas="sect2">Parents &amp; Children<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>A child document can be indexed by specifying its parent when indexing.
For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT localhost:9200/blogs/blog_tag/1122?parent=1111 -d '{
    "tag" : "something"
}'</programlisting>
<simpara>When indexing a child document, the routing value is automatically set
to be the same as its parent, unless the routing value is explicitly
specified using the <literal>routing</literal> parameter.</simpara>
<bridgehead id="index-timestamp" renderas="sect2">Timestamp<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The <literal>_timestamp</literal> field is deprecated.  Instead, use a normal <link linkend="date"><literal>date</literal></link> field and set its value explicitly.</simpara></warning>
<simpara>A document can be indexed with a <literal>timestamp</literal> associated with it. The
<literal>timestamp</literal> value of a document can be set using the <literal>timestamp</literal>
parameter. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT localhost:9200/twitter/tweet/1?timestamp=2009-11-15T14%3A12%3A12 -d '{
    "user" : "kimchy",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>If the <literal>timestamp</literal> value is not provided externally or in the <literal>_source</literal>,
the <literal>timestamp</literal> will be automatically set to the date the document was
processed by the indexing chain. More information can be found on the
<link linkend="mapping-timestamp-field">_timestamp mapping page</link>.</simpara>
<bridgehead id="index-ttl" renderas="sect2">TTL<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The current <literal>_ttl</literal> implementation is deprecated and will be replaced with a different implementation in a future version.</simpara></warning>
<simpara>A document can be indexed with a <literal>ttl</literal> (time to live) associated with
it. Expired documents will be expunged automatically. The expiration
date that will be set for a document with a provided <literal>ttl</literal> is relative
to the <literal>timestamp</literal> of the document, meaning it can be based on the time
of indexing or on any time provided. The provided <literal>ttl</literal> must be strictly
positive and can be a number (in milliseconds) or any valid time value
as shown in the following examples:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=86400000' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</programlisting>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=1d' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</programlisting>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "_ttl": "1d",
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</programlisting>
<simpara>More information can be found on the
<link linkend="mapping-ttl-field">_ttl mapping page</link>.</simpara>
<bridgehead id="index-distributed" renderas="sect2">Distributed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>The index operation is directed to the primary shard based on its route
(see the Routing section above) and performed on the actual node
containing this shard. After the primary shard completes the operation,
if needed, the update is distributed to applicable replicas.</simpara>
<bridgehead id="index-consistency" renderas="sect2">Write Consistency<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>To prevent writes from taking place on the "wrong" side of a network
partition, by default, index operations only succeed if a quorum
(&gt;replicas/2+1) of active shards are available. This default can be
overridden on a node-by-node basis using the <literal>action.write_consistency</literal>
setting. To alter this behavior per-operation, the <literal>consistency</literal> request
parameter can be used.</simpara>
<simpara>Valid write consistency values are <literal>one</literal>, <literal>quorum</literal>, and <literal>all</literal>.</simpara>
<simpara>Note, for the case where the number of replicas is 1 (total of 2 copies
of the data), then the default behavior is to succeed if 1 copy (the primary)
can perform the write.</simpara>
<simpara>The index operation only returns after all <emphasis role="strong">active</emphasis> shards within the
replication group have indexed the document (sync replication).</simpara>
<bridgehead id="index-refresh" renderas="sect2">Refresh<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>To refresh the shard (not the whole index) immediately after the operation
occurs, so that the document appears in search results immediately, the
<literal>refresh</literal> parameter can be set to <literal>true</literal>. Setting this option to <literal>true</literal> should
<emphasis role="strong">ONLY</emphasis> be done after careful thought and verification that it does not lead to
poor performance, both from an indexing and a search standpoint. Note, getting
a document using the get API is completely realtime and doesn&#8217;t require a
refresh.</simpara>
<bridgehead id="index-noop" renderas="sect2">Noop Updates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>When updating a document using the index api a new version of the document is
always created even if the document hasn&#8217;t changed. If this isn&#8217;t acceptable
use the <literal>_update</literal> api with <literal>detect_noop</literal> set to true. This option isn&#8217;t
available on the index api because the index api doesn&#8217;t fetch the old source
and isn&#8217;t able to compare it against the new source.</simpara>
<simpara>There isn&#8217;t a hard and fast rule about when noop updates aren&#8217;t acceptable.
It&#8217;s a combination of lots of factors like how frequently your data source
sends updates that are actually noops and how many queries per second
elasticsearch runs on the shard with receiving the updates.</simpara>
<bridgehead id="timeout" renderas="sect2">Timeout<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/index_.asciidoc">Edit me</ulink></bridgehead>
<simpara>The primary shard assigned to perform the index operation might not be
available when the index operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the index operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <literal>timeout</literal> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?timeout=5m' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
</chapter>
<chapter id="docs-get">
<title>Get API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></title>
<simpara>The get API allows to get a typed JSON document from the index based on
its id. The following example gets a JSON document from an index called
twitter, under a type called tweet, with id valued 1:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1'</programlisting>
<simpara>The result of the above get operation is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "found": true,
    "_source" : {
        "user" : "kimchy",
        "postDate" : "2009-11-15T14:12:12",
        "message" : "trying out Elasticsearch"
    }
}</programlisting>
<simpara>The above result includes the <literal>_index</literal>, <literal>_type</literal>, <literal>_id</literal> and <literal>_version</literal>
of the document we wish to retrieve, including the actual <literal>_source</literal>
of the document if it could be found (as indicated by the <literal>found</literal>
field in the response).</simpara>
<simpara>The API also allows to check for the existence of a document using
<literal>HEAD</literal>, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1'</programlisting>
<bridgehead id="realtime" renderas="sect2">Realtime<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, the get API is realtime, and is not affected by the refresh
rate of the index (when data will become visible for search).</simpara>
<simpara>In order to disable realtime GET, one can either set <literal>realtime</literal>
parameter to <literal>false</literal>, or globally default it to by setting the
<literal>action.get.realtime</literal> to <literal>false</literal> in the node configuration.</simpara>
<simpara>When getting a document, one can specify <literal>fields</literal> to fetch from it. They
will, when possible, be fetched as stored fields (fields mapped as
stored in the mapping). When using realtime GET, there is no notion of
stored fields (at least for a period of time, basically, until the next
flush), so they will be extracted from the source itself (note, even if
source is not enabled). It is a good practice to assume that the fields
will be loaded from source when using realtime GET, even if the fields
are stored.</simpara>
<bridgehead id="type" renderas="sect2">Optional Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get API allows for <literal>_type</literal> to be optional. Set it to <literal>_all</literal> in order
to fetch the first document matching the id across all types.</simpara>
<bridgehead id="get-source-filtering" renderas="sect2">Source filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, the get operation returns the contents of the <literal>_source</literal> field unless
you have used the <literal>fields</literal> parameter or if the <literal>_source</literal> field is disabled.
You can turn off <literal>_source</literal> retrieval by using the <literal>_source</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=false'</programlisting>
<simpara>If you only need one or two fields from the complete <literal>_source</literal>, you can use the <literal>_source_include</literal>
&amp; <literal>_source_exclude</literal> parameters to include or filter out that parts you need. This can be especially helpful
with large documents where partial retrieval can save on network overhead. Both parameters take a comma separated list
of fields or wildcard expressions. Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source_include=*.id&amp;_source_exclude=entities'</programlisting>
<simpara>If you only want to specify includes, you can use a shorter notation:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=*.id,retweeted'</programlisting>
<bridgehead id="get-fields" renderas="sect2">Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get operation allows specifying a set of stored fields that will be
returned by passing the <literal>fields</literal> parameter. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1?fields=title,content'</programlisting>
<simpara>For backward compatibility, if the requested fields are not stored, they will be fetched
from the <literal>_source</literal> (parsed and extracted). This functionality has been replaced by the
<link linkend="get-source-filtering">source filtering</link> parameter.</simpara>
<simpara>Field values fetched from the document it self are always returned as an array. Metadata fields like <literal>_routing</literal> and
<literal>_parent</literal> fields are never returned as an array.</simpara>
<simpara>Also only leaf fields can be returned via the <literal>field</literal> option. So object fields can&#8217;t be returned and such requests
will fail.</simpara>
<bridgehead id="generated-fields" renderas="sect2">Generated fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>If no refresh occurred between indexing and refresh, GET will access the transaction log to fetch the document. However, some fields are generated only when indexing.
If you try to access a field that is only generated when indexing, you will get an exception (default). You can choose to ignore field that are generated if the transaction log is accessed by setting <literal>ignore_errors_on_generated_fields=true</literal>.</simpara>
<bridgehead id="_source" renderas="sect2">Getting the _source directly<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>Use the <literal>/{index}/{type}/{id}/_source</literal> endpoint to get
just the <literal>_source</literal> field of the document,
without any additional content around it. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source'</programlisting>
<simpara>You can also use the same source filtering parameters to control which parts of the <literal>_source</literal> will be returned:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source?_source_include=*.id&amp;_source_exclude=entities'</programlisting>
<simpara>Note, there is also a HEAD variant for the _source endpoint to efficiently test for document existence.
Curl example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1/_source'</programlisting>
<bridgehead id="get-routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>When indexing using the ability to control the routing, in order to get
a document, the routing value should also be provided. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</programlisting>
<simpara>The above will get a tweet with id 1, but will be routed based on the
user. Note, issuing a get without the correct routing, will cause the
document not to be fetched.</simpara>
<bridgehead id="preference" renderas="sect2">Preference<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>Controls a <literal>preference</literal> of which shard replicas to execute the get
request on. By default, the operation is randomized between the shard
replicas.</simpara>
<simpara>The <literal>preference</literal> can be set to:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>_primary</literal>
</term>
<listitem>
<simpara>
        The operation will go and be executed only on the primary
        shards.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_local</literal>
</term>
<listitem>
<simpara>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Custom (string) value
</term>
<listitem>
<simpara>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="get-refresh" renderas="sect2">Refresh<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>refresh</literal> parameter can be set to <literal>true</literal> in order to refresh the
relevant shard before the get operation and make it searchable. Setting
it to <literal>true</literal> should be done after careful thought and verification that
this does not cause a heavy load on the system (and slows down
indexing).</simpara>
<bridgehead id="get-distributed" renderas="sect2">Distributed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get operation gets hashed into a specific shard id. It then gets
redirected to one of the replicas within that shard id and returns the
result. The replicas are the primary shard and its replicas within that
shard id group. This means that the more replicas we will have, the
better GET scaling we will have.</simpara>
<bridgehead id="get-versioning" renderas="sect2">Versioning support<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/get.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can use the <literal>version</literal> parameter to retrieve the document only if
its current version is equal to the specified one. This behavior is the same
for all version types with the exception of version type <literal>FORCE</literal> which always
retrieves the document.</simpara>
<simpara>Internally, Elasticsearch has marked the old document as deleted and added an
entirely new document. The old version of the document doesn’t disappear
immediately, although you won’t be able to access it. Elasticsearch cleans up
deleted documents in the background as you continue to index more data.</simpara>
</chapter>
<chapter id="docs-delete">
<title>Delete API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></title>
<simpara>The delete API allows to delete a typed JSON document from a specific
index based on its id. The following example deletes the JSON document
from an index called twitter, under a type called tweet, with id valued
1:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1'</programlisting>
<simpara>The result of the above delete operation is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_shards" : {
        "total" : 10,
        "failed" : 0,
        "successful" : 10
    },
    "found" : true,
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 2
}</programlisting>
<bridgehead id="delete-versioning" renderas="sect2">Versioning<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each document indexed is versioned. When deleting a document, the
<literal>version</literal> can be specified to make sure the relevant document we are
trying to delete is actually being deleted and it has not changed in the
meantime. Every write operation executed on a document, deletes included,
causes its version to be incremented.</simpara>
<bridgehead id="delete-routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>When indexing using the ability to control the routing, in order to
delete a document, the routing value should also be provided. For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</programlisting>
<simpara>The above will delete a tweet with id 1, but will be routed based on the
user. Note, issuing a delete without the correct routing, will cause the
document to not be deleted.</simpara>
<simpara>When the <literal>_routing</literal> mapping is set as <literal>required</literal> and no routing value is
specified, the delete api will throw a <literal>RoutingMissingException</literal> and reject
the request.</simpara>
<bridgehead id="delete-parent" renderas="sect2">Parent<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>parent</literal> parameter can be set, which will basically be the same as
setting the routing parameter.</simpara>
<simpara>Note that deleting a parent document does not automatically delete its
children. One way of deleting all child documents given a parent&#8217;s id is
to use the <literal>delete-by-query</literal> plugin to perform a delete on the child
index with the automatically generated (and indexed)
field _parent, which is in the format parent_type#parent_id.</simpara>
<simpara>When deleting a child document its parent id must be specified, otherwise
the delete request will be rejected and a <literal>RoutingMissingException</literal> will be
thrown instead.</simpara>
<bridgehead id="delete-index-creation" renderas="sect2">Automatic index creation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>The delete operation automatically creates an index if it has not been
created before (check out the <link linkend="indices-create-index">create index API</link>
for manually creating an index), and also automatically creates a
dynamic type mapping for the specific type if it has not been created
before (check out the <link linkend="indices-put-mapping">put mapping</link>
API for manually creating type mapping).</simpara>
<bridgehead id="delete-distributed" renderas="sect2">Distributed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>The delete operation gets hashed into a specific shard id. It then gets
redirected into the primary shard within that id group, and replicated
(if needed) to shard replicas within that id group.</simpara>
<bridgehead id="delete-consistency" renderas="sect2">Write Consistency<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <literal>one</literal>, <literal>quorum</literal>, and <literal>all</literal>. The parameter to set it is
<literal>consistency</literal>, and it defaults to the node level setting of
<literal>action.write_consistency</literal> which in turn defaults to <literal>quorum</literal>.</simpara>
<simpara>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<literal>quorum</literal>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <literal>one</literal> and <literal>quorum</literal>
is the same).</simpara>
<bridgehead id="delete-refresh" renderas="sect2">Refresh<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>refresh</literal> parameter can be set to <literal>true</literal> in order to refresh the relevant
primary and replica shards after the delete operation has occurred and make it
searchable. Setting it to <literal>true</literal> should be done after careful thought and
verification that this does not cause a heavy load on the system (and slows
down indexing).</simpara>
<bridgehead id="delete-timeout" renderas="sect2">Timeout<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/delete.asciidoc">Edit me</ulink></bridgehead>
<simpara>The primary shard assigned to perform the delete operation might not be
available when the delete operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a store
or undergoing relocation. By default, the delete operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <literal>timeout</literal> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?timeout=5m'</programlisting>
</chapter>
<chapter id="docs-update">
<title>Update API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></title>
<simpara>The update API allows to update a document based on a script provided.
The operation gets the document (collocated with the shard) from the
index, runs the script (with optional script language and parameters),
and index back the result (also allows to delete, or ignore the
operation). It uses versioning to make sure no updates have happened
during the "get" and "reindex".</simpara>
<simpara>Note, this operation still means full reindex of the document, it just
removes some network roundtrips and reduces chances of version conflicts
between the get and the index. The <literal>_source</literal> field needs to be enabled
for this feature to work.</simpara>
<simpara>For example, lets index a simple doc:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/type1/1 -d '{
    "counter" : 1,
    "tags" : ["red"]
}'</programlisting>
<bridgehead id="_scripted_updates" renderas="sect2">Scripted updates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>Now, we can execute a script that would increment the counter:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : {
        "inline": "ctx._source.counter += count",
        "params" : {
            "count" : 4
        }
    }
}'</programlisting>
<simpara>We can add a tag to the list of tags (note, if the tag exists, it
will still add it, since its a list):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : {
        "inline": "ctx._source.tags += tag",
        "params" : {
            "tag" : "blue"
        }
    }
}'</programlisting>
<simpara>In addition to <literal>_source</literal>, the following variables are available through
the <literal>ctx</literal> map: <literal>_index</literal>, <literal>_type</literal>, <literal>_id</literal>, <literal>_version</literal>, <literal>_routing</literal>,
<literal>_parent</literal>, <literal>_timestamp</literal>, <literal>_ttl</literal>.</simpara>
<simpara>We can also add a new field to the document:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.name_of_new_field = \"value_of_new_field\""
}'</programlisting>
<simpara>Or remove a field from the document:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.remove(\"name_of_field\")"
}'</programlisting>
<simpara>And, we can even change the operation that is executed.  This example deletes
the doc if the <literal>tags</literal> field contain <literal>blue</literal>, otherwise it does nothing
(<literal>noop</literal>):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : {
        "inline": "ctx._source.tags.contains(tag) ? ctx.op = \"delete\" : ctx.op = \"none\"",
        "params" : {
            "tag" : "blue"
        }
    }
}'</programlisting>
<bridgehead id="_updates_with_a_partial_document" renderas="sect2">Updates with a partial document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>The update API also support passing a partial document,
which will be merged into the existing document (simple recursive merge,
inner merging of objects, replacing core "keys/values" and arrays). For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    }
}'</programlisting>
<simpara>If both <literal>doc</literal> and <literal>script</literal> are specified, then <literal>doc</literal> is ignored. Best is
to put your field pairs of the partial document in the script itself.</simpara>
<bridgehead id="_detecting_noop_updates" renderas="sect2">Detecting noop updates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>If <literal>doc</literal> is specified its value is merged with the existing <literal>_source</literal>. By
default the document is only reindexed if the new <literal>_source</literal> field differs from
the old. Setting <literal>detect_noop</literal> to <literal>false</literal> will cause Elasticsearch to always
update the document even if it hasn&#8217;t changed. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    },
    "detect_noop": false
}'</programlisting>
<simpara>If <literal>name</literal> was <literal>new_name</literal> before the request was sent then document is still
reindexed.</simpara>
<bridgehead id="upserts" renderas="sect2">Upserts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>If the document does not already exist, the contents of the <literal>upsert</literal> element
will be inserted as a new document.  If the document does exist, then the
<literal>script</literal> will be executed instead:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : {
        "inline": "ctx._source.counter += count",
        "params" : {
            "count" : 4
        }
    },
    "upsert" : {
        "counter" : 1
    }
}'</programlisting>
<bridgehead id="_literal_scripted_upsert_literal" renderas="sect3"><literal>scripted_upsert</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>If you would like your script to run regardless of whether the document exists
or not&#8201;&#8212;&#8201;i.e. the script handles initializing the document instead of the
<literal>upsert</literal> element&#8201;&#8212;&#8201;then set <literal>scripted_upsert</literal> to <literal>true</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/sessions/session/dh3sgudg8gsrgl/_update' -d '{
    "scripted_upsert":true,
    "script" : {
        "id": "my_web_session_summariser",
        "params" : {
            "pageViewEvent" : {
                "url":"foo.com/bar",
                "response":404,
                "time":"2014-01-01 12:32"
            }
        }
    },
    "upsert" : {}
}'</programlisting>
<bridgehead id="_literal_doc_as_upsert_literal" renderas="sect3"><literal>doc_as_upsert</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>Instead of sending a partial <literal>doc</literal> plus an <literal>upsert</literal> doc, setting
<literal>doc_as_upsert</literal> to <literal>true</literal> will use the contents of <literal>doc</literal> as the <literal>upsert</literal>
value:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    },
    "doc_as_upsert" : true
}'</programlisting>
<bridgehead id="_parameters_2" renderas="sect2">Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update.asciidoc">Edit me</ulink></bridgehead>
<simpara>The update operation supports the following query-string parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>retry_on_conflict</literal>
</simpara>
</entry>
<entry>
<simpara>
In between the get and indexing phases of the update, it is possible that
another process might have already updated the same document.  By default, the
update will fail with a version conflict exception.  The <literal>retry_on_conflict</literal>
parameter controls how many times to retry the update before finally throwing
an exception.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>routing</literal>
</simpara>
</entry>
<entry>
<simpara>
Routing is used to route the update request to the right shard and sets the
routing for the upsert request if the document being updated doesn&#8217;t exist.
Can&#8217;t be used to update the routing of an existing document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>parent</literal>
</simpara>
</entry>
<entry>
<simpara>
Parent is used to route the update request to the right shard and sets the
parent for the upsert request if the document being updated doesn&#8217;t exist.
Can&#8217;t be used to update the <literal>parent</literal> of an existing document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>timeout</literal>
</simpara>
</entry>
<entry>
<simpara>
Timeout waiting for a shard to become available.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>consistency</literal>
</simpara>
</entry>
<entry>
<simpara>
The write consistency of the index/delete operation.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>refresh</literal>
</simpara>
</entry>
<entry>
<simpara>
Refresh the relevant primary and replica shards (not the whole index)
immediately after the operation occurs, so that the updated document appears
in search results  immediately.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fields</literal>
</simpara>
</entry>
<entry>
<simpara>
Return the relevant fields from the updated document. Specify <literal>_source</literal> to
return the full updated source.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>version</literal> &amp; <literal>version_type</literal>
</simpara>
</entry>
<entry>
<simpara>
The update API uses the Elasticsearch&#8217;s versioning support internally to make
sure the document doesn&#8217;t change during the update. You can use the <literal>version</literal>
parameter to specify that the document should only be updated if its version
matches the one specified. By setting version type to <literal>force</literal> you can force
the new version of the document after update (use with care! with <literal>force</literal>
there is no guarantee the document didn&#8217;t change).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<note>
<title>The update API does not support external versioning</title>
<simpara>External versioning (version types <literal>external</literal> &amp; <literal>external_gte</literal>) is not
supported by the update API as it would result in Elasticsearch version
numbers being out of sync with the external system.  Use the
<link linkend="docs-index_"><literal>index</literal> API</link> instead.</simpara>
</note>
</chapter>
<chapter id="docs-update-by-query">
<title>Update By Query API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>The update-by-query API is new and should still be considered experimental.  The API may change in ways that are not backwards compatible.</simpara></warning>
<simpara>The simplest usage of <literal>_update_by_query</literal> just performs an update on every
document in the index without changing the source. This is useful to
<link linkend="picking-up-a-new-property">pick up a new property</link> or some other online
mapping change. Here is the API:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/_update_by_query?conflicts=proceed</programlisting>
<remark> AUTOSENSE</remark>
<simpara>That will return something like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "took" : 147,
  "timed_out": false,
  "updated": 120,
  "batches": 1,
  "version_conflicts": 0,
  "noops": 0,
  "retries": 0,
  "throttled_millis": 0,
  "requests_per_second": "unlimited",
  "throttled_until_millis": 0,
  "total": 120,
  "failures" : [ ]
}</programlisting>
<simpara><literal>_update_by_query</literal> gets a snapshot of the index when it starts and indexes what
it finds using <literal>internal</literal> versioning. That means that you&#8217;ll get a version
conflict if the document changes between the time when the snapshot was taken
and when the index request is processed. When the versions match the document
is updated and the version number is incremented.</simpara>
<simpara>All update and query failures cause the <literal>_update_by_query</literal> to abort and are
returned in the <literal>failures</literal> of the response. The updates that have been
performed still stick. In other words, the process is not rolled back, only
aborted. While the first failure causes the abort all failures that are
returned by the failing bulk request are returned in the <literal>failures</literal> element so
it&#8217;s possible for there to be quite a few.</simpara>
<simpara>If you want to simply count version conflicts not cause the <literal>_update_by_query</literal>
to abort you can set <literal>conflicts=proceed</literal> on the url or <literal>"conflicts": "proceed"</literal>
in the request body. The first example does this because it is just trying to
pick up an online mapping change and a version conflict simply means that the
conflicting document was updated between the start of the <literal>_update_by_query</literal>
and the time when it attempted to update the document. This is fine because
that update will have picked up the online mapping update.</simpara>
<simpara>Back to the API format, you can limit <literal>_update_by_query</literal> to a single type. This
will only update <literal>tweet`s from the `twitter</literal> index:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/tweet/_update_by_query?conflicts=proceed</programlisting>
<remark> AUTOSENSE</remark>
<simpara>You can also limit <literal>_update_by_query</literal> using the
<link linkend="query-dsl">Query DSL</link>. This will update all documents from the
<literal>twitter</literal> index for the user <literal>kimchy</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/_update_by_query?conflicts=proceed
{
  "query": { <co id="CO17-1"/>
    "term": {
      "user": "kimchy"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO17-1">
<para>
The query must be passed as a value to the <literal>query</literal> key, in the same
way as the <link linkend="search-search">Search API</link>. You can also use the <literal>q</literal>
parameter in the same way as the search api.
</para>
</callout>
</calloutlist>
<simpara>So far we&#8217;ve only been updating documents without changing their source. That
is genuinely useful for things like
<link linkend="picking-up-a-new-property">picking up new properties</link> but it&#8217;s only half the
fun. <literal>_update_by_query</literal> supports a <literal>script</literal> object to update the document. This
will increment the <literal>likes</literal> field on all of kimchy&#8217;s tweets:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/_update_by_query
{
  "script": {
    "inline": "ctx._source.likes++"
  },
  "query": {
    "term": {
      "user": "kimchy"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Just as in <link linkend="docs-update">Update API</link> you can set <literal>ctx.op = "noop"</literal> if
your script decides that it doesn&#8217;t have to make any changes. That will cause
<literal>_update_by_query</literal> to omit that document from its updates. Setting <literal>ctx.op</literal> to
anything else is an error. If you want to delete by a query you can use the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/plugins-delete-by-query.html">Delete by Query plugin</ulink> instead. Setting any
other field in <literal>ctx</literal> is an error.</simpara>
<simpara>Note that we stopped specifying <literal>conflicts=proceed</literal>. In this case we want a
version conflict to abort the process so we can handle the failure.</simpara>
<simpara>This API doesn&#8217;t allow you to move the documents it touches, just modify their
source. This is intentional! We&#8217;ve made no provisions for removing the document
from its original location.</simpara>
<simpara>It&#8217;s also possible to do this whole thing on multiple indexes and multiple
types at once, just like the search API:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter,blog/tweet,post/_update_by_query</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If you provide <literal>routing</literal> then the routing is copied to the scroll query,
limiting the process to the shards that match that routing value:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/_update_by_query?routing=1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>By default <literal>_update_by_query</literal> uses scroll batches of 1000. You can change the
batch size with the <literal>scroll_size</literal> URL parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST twitter/_update_by_query?scroll_size=100</programlisting>
<remark> AUTOSENSE</remark>
<bridgehead id="_url_parameters" renderas="sect2">URL Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>In addition to the standard parameters like <literal>pretty</literal>, the Update By Query API
also supports <literal>refresh</literal>, <literal>wait_for_completion</literal>, <literal>consistency</literal>, and <literal>timeout</literal>.</simpara>
<simpara>Sending the <literal>refresh</literal> will update all shards in the index being updated when
the request completes. This is different than the Index API&#8217;s <literal>refresh</literal>
parameter which causes just the shard that received the new data to be indexed.</simpara>
<simpara>If the request contains <literal>wait_for_completion=false</literal> then Elasticsearch will
perform some preflight checks, launch the request, and then return a <literal>task</literal>
which can be used with <link linkend="docs-update-by-query-task-api">Tasks APIs</link> to cancel
or get the status of the task. For now, once the request is finished the task
is gone and the only place to look for the ultimate result of the task is in
the Elasticsearch log file. This will be fixed soon.</simpara>
<simpara><literal>consistency</literal> controls how many copies of a shard must respond to each write
request. <literal>timeout</literal> controls how long each write request waits for unavailable
shards to become available. Both work exactly how they work in the
<link linkend="docs-bulk">Bulk API</link>.</simpara>
<simpara><literal>requests_per_second</literal> can be set to any decimal number (<literal>1.4</literal>, <literal>6</literal>, <literal>1000</literal>, etc)
and throttles the number of requests per second that the update by query issues.
The throttling is done waiting between bulk batches so that it can manipulate
the scroll timeout. The wait time is the difference between the time it took the
batch to complete and the time <literal>requests_per_second * requests_in_the_batch</literal>.
Since the batch isn&#8217;t broken into multiple bulk requests large batch sizes will
cause Elasticsearch to create many requests and then wait for a while before
starting the next set. This is "bursty" instead of "smooth". The default is
<literal>unlimited</literal> which is also the only non-number value that it accepts.</simpara>
<bridgehead id="_response_body" renderas="sect2">Response body<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The JSON response looks like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "took" : 639,
  "updated": 0,
  "batches": 1,
  "version_conflicts": 2,
  "retries": 0,
  "throttled_millis": 0,
  "failures" : [ ]
}</programlisting>
<variablelist>
<varlistentry>
<term>
<literal>took</literal>
</term>
<listitem>
<simpara>
The number of milliseconds from start to end of the whole operation.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>updated</literal>
</term>
<listitem>
<simpara>
The number of documents that were successfully updated.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>batches</literal>
</term>
<listitem>
<simpara>
The number of scroll responses pulled back by the the update by query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>version_conflicts</literal>
</term>
<listitem>
<simpara>
The number of version conflicts that the update by query hit.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>retries</literal>
</term>
<listitem>
<simpara>
The number of retries that the update by query did in response to a full queue.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>throttled_millis</literal>
</term>
<listitem>
<simpara>
Number of milliseconds the request slept to conform to <literal>requests_per_second</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>failures</literal>
</term>
<listitem>
<simpara>
Array of all indexing failures. If this is non-empty then the request aborted
because of those failures. See <literal>conflicts</literal> for how to prevent version conflicts
from aborting the operation.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="docs-update-by-query-task-api" renderas="sect2">Works with the Task API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>While Update By Query is running you can fetch their status using the
<link linkend="tasks">Task API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_tasks/?pretty&amp;detailed=true&amp;action=*byquery</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The responses looks like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "nodes" : {
    "r1A2WoRbTwKZ516z6NEs5A" : {
      "name" : "Tyrannus",
      "transport_address" : "127.0.0.1:9300",
      "host" : "127.0.0.1",
      "ip" : "127.0.0.1:9300",
      "attributes" : {
        "testattr" : "test",
        "portsfile" : "true"
      },
      "tasks" : {
        "r1A2WoRbTwKZ516z6NEs5A:36619" : {
          "node" : "r1A2WoRbTwKZ516z6NEs5A",
          "id" : 36619,
          "type" : "transport",
          "action" : "indices:data/write/update/byquery",
          "status" : {    <co id="CO18-1"/>
            "total" : 6154,
            "updated" : 3500,
            "created" : 0,
            "deleted" : 0,
            "batches" : 4,
            "version_conflicts" : 0,
            "noops" : 0,
            "retries": 0,
            "throttled_millis": 0
          },
          "description" : ""
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO18-1">
<para>
this object contains the actual status. It is just like the response json
with the important addition of the <literal>total</literal> field. <literal>total</literal> is the total number
of operations that the reindex expects to perform. You can estimate the
progress by adding the <literal>updated</literal>, <literal>created</literal>, and <literal>deleted</literal> fields. The request
will finish when their sum is equal to the <literal>total</literal> field.
</para>
</callout>
</calloutlist>
<bridgehead id="docs-update-by-query-cancel-task-api" renderas="sect2">Works with the Cancel Task API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Any Update By Query can be canceled using the <link linkend="tasks">Task Cancel API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_tasks/{task_id}/_cancel</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>task_id</literal> can be found using the tasks API above.</simpara>
<simpara>Cancelation should happen quickly but might take a few seconds. The task status
API above will continue to list the task until it is wakes to cancel itself.</simpara>
<bridgehead id="docs-update-by-query-rethrottle" renderas="sect2">Rethrottling<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The value of <literal>requests_per_second</literal> can be changed on a running update by query
using the <literal>_rethrottle</literal> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_update_by_query/{task_id}/_rethrottle?requests_per_second=unlimited</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>task_id</literal> can be found using the tasks API above.</simpara>
<simpara>Just like when setting it on the <literal>_update_by_query</literal> API <literal>requests_per_second</literal>
can be either <literal>unlimited</literal> to disable throttling or any decimal number like <literal>1.7</literal>
or <literal>12</literal> to throttle to that level. Rethrottling that speeds up the query takes
effect immediately but rethrotting that slows down the query will take effect
on after completing the current batch. This prevents scroll timeouts.</simpara>
<bridgehead id="picking-up-a-new-property" renderas="sect2">Pick up a new property<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/update-by-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Say you created an index without dynamic mapping, filled it with data, and then
added a mapping value to pick up more fields from the data:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT test
{
  "mappings": {
    "test": {
      "dynamic": false,   <co id="CO19-1"/>
      "properties": {
        "text": {"type": "string"}
      }
    }
  }
}

POST test/test?refresh
{
  "text": "words words",
  "flag": "bar"
}'
POST test/test?refresh
{
  "text": "words words",
  "flag": "foo"
}'
PUT test/_mapping/test   <co id="CO19-2"/>
{
  "properties": {
    "text": {"type": "string"},
    "flag": {"type": "string", "analyzer": "keyword"}
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO19-1">
<para>
This means that new fields won&#8217;t be indexed, just stored in <literal>_source</literal>.
</para>
</callout>
<callout arearefs="CO19-2">
<para>
This updates the mapping to add the new <literal>flag</literal> field. To pick up the new
field you have to reindex all documents with it.
</para>
</callout>
</calloutlist>
<simpara>Searching for the data won&#8217;t find anything:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST test/_search?filter_path=hits.total
{
  "query": {
    "match": {
      "flag": "foo"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<programlisting language="js" linenumbering="unnumbered">{
  "hits" : {
    "total" : 0
  }
}</programlisting>
<simpara>But you can issue an <literal>_update_by_query</literal> request to pick up the new mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST test/_update_by_query?refresh&amp;conflicts=proceed
POST test/_search?filter_path=hits.total
{
  "query": {
    "match": {
      "flag": "foo"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<programlisting language="js" linenumbering="unnumbered">{
  "hits" : {
    "total" : 1
  }
}</programlisting>
<simpara>You can do the exact same thing when adding a field to a multifield.</simpara>
</chapter>
<chapter id="docs-multi-get">
<title>Multi Get API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></title>
<simpara>Multi GET API allows to get multiple documents based on an index, type
(optional) and id (and possibly routing). The response includes a <literal>docs</literal>
array with all the fetched documents, each element similar in structure
to a document provided by the <link linkend="docs-get">get</link>
API. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</programlisting>
<simpara>The <literal>mget</literal> endpoint can also be used against an index (in which case it
is not required in the body):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/test/_mget' -d '{
    "docs" : [
        {
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</programlisting>
<simpara>And type:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/test/type/_mget' -d '{
    "docs" : [
        {
            "_id" : "1"
        },
        {
            "_id" : "2"
        }
    ]
}'</programlisting>
<simpara>In which case, the <literal>ids</literal> element can directly be used to simplify the
request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/test/type/_mget' -d '{
    "ids" : ["1", "2"]
}'</programlisting>
<bridgehead id="mget-type" renderas="sect2">Optional Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>The mget API allows for <literal>_type</literal> to be optional. Set it to <literal>_all</literal> or leave it empty in order
to fetch the first document matching the id across all types.</simpara>
<simpara>If you don&#8217;t set the type and have many documents sharing the same <literal>_id</literal>, you will end up
getting only the first matching document.</simpara>
<simpara>For example, if you have a document 1 within typeA and typeB then following request
will give you back only the same document twice:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/test/_mget' -d '{
    "ids" : ["1", "1"]
}'</programlisting>
<simpara>You need in that case to explicitly set the <literal>_type</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /test/_mget/
{
  "docs" : [
        {
            "_type":"typeA",
            "_id" : "1"
        },
        {
            "_type":"typeB",
            "_id" : "1"
        }
    ]
}</programlisting>
<bridgehead id="mget-source-filtering" renderas="sect2">Source filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, the <literal>_source</literal> field will be returned for every document (if stored).
Similar to the <link linkend="get-source-filtering">get</link> API, you can retrieve only parts of
the <literal>_source</literal> (or not at all) by using the <literal>_source</literal> parameter. You can also use
the url parameters <literal>_source</literal>,<literal>_source_include</literal> &amp; <literal>_source_exclude</literal> to specify defaults,
which will be used when there are no per-document instructions.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_source" : false
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "_source" : ["field3", "field4"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "3",
            "_source" : {
                "include": ["user"],
                "exclude": ["user.location"]
            }
        }
    ]
}'</programlisting>
<bridgehead id="mget-fields" renderas="sect2">Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>Specific stored fields can be specified to be retrieved per document to get, similar to the <link linkend="get-fields">fields</link> parameter of the Get API.
For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "fields" : ["field1", "field2"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "fields" : ["field3", "field4"]
        }
    ]
}'</programlisting>
<simpara>Alternatively, you can specify the <literal>fields</literal> parameter in the query string
as a default to be applied to all documents.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/test/type/_mget?fields=field1,field2' -d '{
    "docs" : [
        {
            "_id" : "1" <co id="CO20-1"/>
        },
        {
            "_id" : "2",
            "fields" : ["field3", "field4"] <co id="CO20-2"/>
        }
    ]
}'</programlisting>
<calloutlist>
<callout arearefs="CO20-1">
<para>
Returns <literal>field1</literal> and <literal>field2</literal>
</para>
</callout>
<callout arearefs="CO20-2">
<para>
Returns <literal>field3</literal> and <literal>field4</literal>
</para>
</callout>
</calloutlist>
<bridgehead id="_generated_fields" renderas="sect2">Generated fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>See <xref linkend="generated-fields"/> for fields are generated only when indexing.</simpara>
<bridgehead id="mget-routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can also specify routing value as a parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mget?routing=key1' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_routing" : "key2"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</programlisting>
<simpara>In this example, document <literal>test/type/2</literal> will be fetch from shard corresponding to routing key <literal>key1</literal> but
document <literal>test/type/1</literal> will be fetch from shard corresponding to routing key <literal>key2</literal>.</simpara>
<bridgehead id="mget-security" renderas="sect2">Security<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-get.asciidoc">Edit me</ulink></bridgehead>
<simpara>See <xref linkend="url-access-control"/></simpara>
</chapter>
<chapter id="docs-bulk">
<title>Bulk API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></title>
<simpara>The bulk API makes it possible to perform many index/delete operations
in a single API call. This can greatly increase the indexing speed.</simpara>
<sidebar>
<title>Client support for bulk requests</title>
<simpara>Some of the officially supported clients provide helpers to assist with
bulk requests and reindexing of documents from one index to another:</simpara>
<variablelist>
<varlistentry>
<term>
Perl
</term>
<listitem>
<simpara>
    See <ulink url="https://metacpan.org/pod/Search::Elasticsearch::Bulk">Search::Elasticsearch::Bulk</ulink>
    and <ulink url="https://metacpan.org/pod/Search::Elasticsearch::Scroll">Search::Elasticsearch::Scroll</ulink>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Python
</term>
<listitem>
<simpara>
    See <ulink url="http://elasticsearch-py.readthedocs.org/en/master/helpers.html">elasticsearch.helpers.*</ulink>
</simpara>
</listitem>
</varlistentry>
</variablelist>
</sidebar>
<simpara>The REST API endpoint is <literal>/_bulk</literal>, and it expects the following JSON
structure:</simpara>
<programlisting language="js" linenumbering="unnumbered">action_and_meta_data\n
optional_source\n
action_and_meta_data\n
optional_source\n
....
action_and_meta_data\n
optional_source\n</programlisting>
<simpara><emphasis role="strong">NOTE</emphasis>: the final line of data must end with a newline character <literal>\n</literal>.</simpara>
<simpara>The possible actions are <literal>index</literal>, <literal>create</literal>, <literal>delete</literal> and <literal>update</literal>.
<literal>index</literal> and <literal>create</literal> expect a source on the next
line, and have the same semantics as the <literal>op_type</literal> parameter to the
standard index API (i.e. create will fail if a document with the same
index and type exists already, whereas index will add or replace a
document as necessary). <literal>delete</literal> does not expect a source on the
following line, and has the same semantics as the standard delete API.
<literal>update</literal> expects that the partial doc, upsert and script and its options
are specified on the next line.</simpara>
<simpara>If you&#8217;re providing text file input to <literal>curl</literal>, you <emphasis role="strong">must</emphasis> use the
<literal>--data-binary</literal> flag instead of plain <literal>-d</literal>. The latter doesn&#8217;t preserve
newlines. Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ cat requests
{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
$ curl -s -XPOST localhost:9200/_bulk --data-binary "@requests"; echo
{"took":7,"items":[{"create":{"_index":"test","_type":"type1","_id":"1","_version":1}}]}</programlisting>
<simpara>Because this format uses literal <literal>\n</literal>'s as delimiters, please be sure
that the JSON actions and sources are not pretty printed. Here is an
example of a correct sequence of bulk commands:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_type" : "type1", "_id" : "2" } }
{ "create" : { "_index" : "test", "_type" : "type1", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1"} }
{ "doc" : {"field2" : "value2"} }</programlisting>
<simpara>In the above example <literal>doc</literal> for the <literal>update</literal> action is a partial
document, that will be merged with the already stored document.</simpara>
<simpara>The endpoints are <literal>/_bulk</literal>, <literal>/{index}/_bulk</literal>, and <literal>{index}/{type}/_bulk</literal>.
When the index or the index/type are provided, they will be used by
default on bulk items that don&#8217;t provide them explicitly.</simpara>
<simpara>A note on the format. The idea here is to make processing of this as
fast as possible. As some of the actions will be redirected to other
shards on other nodes, only <literal>action_meta_data</literal> is parsed on the
receiving node side.</simpara>
<simpara>Client libraries using this protocol should try and strive to do
something similar on the client side, and reduce buffering as much as
possible.</simpara>
<simpara>The response to a bulk action is a large JSON structure with the
individual results of each action that was performed. The failure of a
single action does not affect the remaining actions.</simpara>
<simpara>There is no "correct" number of actions to perform in a single bulk
call. You should experiment with different settings to find the optimum
size for your particular workload.</simpara>
<simpara>If using the HTTP API, make sure that the client does not send HTTP
chunks, as this will slow things down.</simpara>
<bridgehead id="bulk-versioning" renderas="sect2">Versioning<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each bulk item can include the version value using the
<literal>_version</literal>/<literal>version</literal> field. It automatically follows the behavior of the
index / delete operation based on the <literal>_version</literal> mapping. It also
support the <literal>version_type</literal>/<literal>_version_type</literal> (see <link linkend="index-versioning">versioning</link>)</simpara>
<bridgehead id="bulk-routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each bulk item can include the routing value using the
<literal>_routing</literal>/<literal>routing</literal> field. It automatically follows the behavior of the
index / delete operation based on the <literal>_routing</literal> mapping.</simpara>
<bridgehead id="bulk-parent" renderas="sect2">Parent<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each bulk item can include the parent value using the <literal>_parent</literal>/<literal>parent</literal>
field. It automatically follows the behavior of the index / delete
operation based on the <literal>_parent</literal> / <literal>_routing</literal> mapping.</simpara>
<bridgehead id="bulk-timestamp" renderas="sect2">Timestamp<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The <literal>_timestamp</literal> field is deprecated.  Instead, use a normal <link linkend="date"><literal>date</literal></link> field and set its value explicitly.</simpara></warning>
<simpara>Each bulk item can include the timestamp value using the
<literal>_timestamp</literal>/<literal>timestamp</literal> field. It automatically follows the behavior of
the index operation based on the <literal>_timestamp</literal> mapping.</simpara>
<bridgehead id="bulk-ttl" renderas="sect2">TTL<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The current <literal>_ttl</literal> implementation is deprecated and will be replaced with a different implementation in a future version.</simpara></warning>
<simpara>Each bulk item can include the ttl value using the <literal>_ttl</literal>/<literal>ttl</literal> field.
It automatically follows the behavior of the index operation based on
the <literal>_ttl</literal> mapping.</simpara>
<bridgehead id="bulk-consistency" renderas="sect2">Write Consistency<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>When making bulk calls, you can require a minimum number of active
shards in the partition through the <literal>consistency</literal> parameter. The values
allowed are <literal>one</literal>, <literal>quorum</literal>, and <literal>all</literal>. It defaults to the node level
setting of <literal>action.write_consistency</literal>, which in turn defaults to
<literal>quorum</literal>.</simpara>
<simpara>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<literal>quorum</literal>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <literal>one</literal> and <literal>quorum</literal>
are the same).</simpara>
<bridgehead id="bulk-refresh" renderas="sect2">Refresh<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>refresh</literal> parameter can be set to <literal>true</literal> in order to refresh the relevant
primary and replica shards immediately after the bulk operation has occurred
and make it searchable, instead of waiting for the normal refresh interval to
expire. Setting it to <literal>true</literal> can trigger additional load, and may slow down
indexing. Due to its costly nature, the <literal>refresh</literal> parameter is set on the bulk request level
and is not supported on each individual bulk item.</simpara>
<bridgehead id="bulk-update" renderas="sect2">Update<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>When using <literal>update</literal> action <literal>_retry_on_conflict</literal> can be used as field in
the action itself (not in the extra payload line), to specify how many
times an update should be retried in the case of a version conflict.</simpara>
<simpara>The <literal>update</literal> action payload, supports the following options: <literal>doc</literal>
(partial document), <literal>upsert</literal>, <literal>doc_as_upsert</literal>, <literal>script</literal>, <literal>params</literal> (for
script), <literal>lang</literal> (for script) and <literal>fields</literal>. See update documentation for details on
the options. Curl example with update actions:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"} }
{ "update" : { "_id" : "0", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "script" : { "inline": "ctx._source.counter += param1", "lang" : "js", "params" : {"param1" : 1}}, "upsert" : {"counter" : 1}}
{ "update" : {"_id" : "2", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"}, "doc_as_upsert" : true }
{ "update" : {"_id" : "3", "_type" : "type1", "_index" : "index1", "fields" : ["_source"]} }
{ "doc" : {"field" : "value"} }
{ "update" : {"_id" : "4", "_type" : "type1", "_index" : "index1"} }
{ "doc" : {"field" : "value"}, "fields": ["_source"]}</programlisting>
<bridgehead id="bulk-security" renderas="sect2">Security<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/bulk.asciidoc">Edit me</ulink></bridgehead>
<simpara>See <xref linkend="url-access-control"/></simpara>
</chapter>
<chapter id="docs-reindex">
<title>Reindex API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>The reindex API is new and should still be considered experimental.  The API may change in ways that are not backwards compatible.</simpara></warning>
<important><simpara>Reindex does not attempt to set up the destination index.  It does
not copy the settings of the source index.  You should set up the destination
index prior to running a <literal>_reindex</literal> action, including setting up mappings, shard
counts, replicas, etc.</simpara></important>
<simpara>The most basic form of <literal>_reindex</literal> just copies documents from one index to another.
This will copy documents from the <literal>twitter</literal> index into the <literal>new_twitter</literal> index:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>That will return something like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "took" : 147,
  "timed_out": false,
  "created": 120,
  "updated": 0,
  "batches": 1,
  "version_conflicts": 0,
  "failures" : [ ],
  "created": 12344
}</programlisting>
<simpara>Just like <link linkend="docs-update-by-query"><literal>_update_by_query</literal></link>, <literal>_reindex</literal> gets a
snapshot of the source index but its target must be a <emphasis role="strong">different</emphasis> index so
version conflicts are unlikely. The <literal>dest</literal> element can be configured like the
index API to control optimistic concurrency control. Just leaving out
<literal>version_type</literal> (as above) or setting it to <literal>internal</literal> will cause Elasticsearch
to blindly dump documents into the target, overwriting any that happen to have
the same type and id:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter",
    "version_type": "internal"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Setting <literal>version_type</literal> to <literal>external</literal> will cause Elasticsearch to preserve the
<literal>version</literal> from the source, create any documents that are missing, and update
any documents that have an older version in the destination index than they do
in the source index:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter",
    "version_type": "external"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Settings <literal>op_type</literal> to <literal>create</literal> will cause <literal>_reindex</literal> to only create missing
documents in the target index. All existing documents will cause a version
conflict:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter",
    "op_type": "create"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>By default version conflicts abort the <literal>_reindex</literal> process but you can just
count them by settings <literal>"conflicts": "proceed"</literal> in the request body:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "conflicts": "proceed",
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter",
    "op_type": "create"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>You can limit the documents by adding a type to the <literal>source</literal> or by adding a
query. This will only copy <literal>tweet</literal>&apos;s made by <literal>kimchy</literal> into <literal>new_twitter</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter",
    "type": "tweet",
    "query": {
      "term": {
        "user": "kimchy"
      }
    }
  },
  "dest": {
    "index": "new_twitter"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara><literal>index</literal> and <literal>type</literal> in <literal>source</literal> can both be lists, allowing you to copy from
lots of sources in one request. This will copy documents from the <literal>tweet</literal> and
<literal>post</literal> types in the <literal>twitter</literal> and <literal>blog</literal> index. It&#8217;d include the <literal>post</literal> type in
the <literal>twitter</literal> index and the <literal>tweet</literal> type in the <literal>blog</literal> index. If you want to be
more specific you&#8217;ll need to use the <literal>query</literal>. It also makes no effort to handle
ID collisions. The target index will remain valid but it&#8217;s not easy to predict
which document will survive because the iteration order isn&#8217;t well defined.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": ["twitter", "blog"],
    "type": ["tweet", "post"]
  },
  "dest": {
    "index": "all_together"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>It&#8217;s also possible to limit the number of processed documents by setting
<literal>size</literal>. This will only copy a single document from <literal>twitter</literal> to
<literal>new_twitter</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "size": 1,
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If you want a particular set of documents from the twitter index you&#8217;ll
need to sort. Sorting makes the scroll less efficient but in some contexts
it&#8217;s worth it. If possible, prefer a more selective query to <literal>size</literal> and <literal>sort</literal>.
This will copy 10000 documents from <literal>twitter</literal> into <literal>new_twitter</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "size": 10000,
  "source": {
    "index": "twitter",
    "sort": { "date": "desc" }
  },
  "dest": {
    "index": "new_twitter"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>source</literal> section supports all the elements that are supported in a
<link linkend="search-request-body">search request</link>. For instance only a subset of the
fields from the original documents can be reindexed using source filtering
as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST _reindex
{
  "source": {
    "index": "twitter",
    "_source": ["user", "tweet"]
  },
  "dest": {
    "index": "new_twitter"
  }
}</programlisting>
<remark> CONSOLE</remark>
<remark> TEST[setup:twitter]</remark>
<simpara>Like <literal>_update_by_query</literal>, <literal>_reindex</literal> supports a script that modifies the
document. Unlike <literal>_update_by_query</literal>, the script is allowed to modify the
document&#8217;s metadata. This example bumps the version of the source document:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "twitter"
  },
  "dest": {
    "index": "new_twitter",
    "version_type": "external"
  },
  "script": {
    "inline": "if (ctx._source.foo == 'bar') {ctx._version++; ctx._source.remove('foo')}"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Think of the possibilities! Just be careful! With great power&#8230;. You can
change:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>_id</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_type</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_index</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_version</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_routing</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_parent</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_timestamp</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_ttl</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>Setting <literal>_version</literal> to <literal>null</literal> or clearing it from the <literal>ctx</literal> map is just like not
sending the version in an indexing request. It will cause that document to be
overwritten in the target index regardless of the version on the target or the
version type you use in the <literal>_reindex</literal> request.</simpara>
<simpara>By default if <literal>_reindex</literal> sees a document with routing then the routing is
preserved unless it&#8217;s changed by the script. You can set <literal>routing</literal> on the
<literal>dest</literal> request to change this:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>keep</literal>
</term>
<listitem>
<simpara>
Sets the routing on the bulk request sent for each match to the routing on
the match. The default.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>discard</literal>
</term>
<listitem>
<simpara>
Sets the routing on the bulk request sent for each match to null.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>=&lt;some text&gt;</literal>
</term>
<listitem>
<simpara>
Sets the routing on the bulk request sent for each match to all text after
the <literal>=</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>For example, you can use the following request to copy all documents from
the <literal>source</literal> index with the company name <literal>cat</literal> into the <literal>dest</literal> index with
routing set to <literal>cat</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex
{
  "source": {
    "index": "source"
    "query": {
      "match": {
        "company": "cat"
      }
    }
  },
  "dest": {
    "index": "dest",
    "routing": "=cat"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<remark> TEST[s/^/PUT source\nGET _cluster\/health?wait_for_status=yellow\n/]</remark>
<simpara>By default <literal>_reindex</literal> uses scroll batches of 1000. You can change the
batch size with the <literal>size</literal> field in the <literal>source</literal> element:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST _reindex
{
  "source": {
    "index": "source",
    "size": 100
  },
  "dest": {
    "index": "dest",
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<bridgehead id="_url_parameters_2" renderas="sect2">URL Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara>In addition to the standard parameters like <literal>pretty</literal>, the Reindex API also
supports <literal>refresh</literal>, <literal>wait_for_completion</literal>, <literal>consistency</literal>, <literal>timeout</literal>, and
<literal>requests_per_second</literal>.</simpara>
<simpara>Sending the <literal>refresh</literal> url parameter will cause all indexes to which the request
wrote to be refreshed. This is different than the Index API&#8217;s <literal>refresh</literal>
parameter which causes just the shard that received the new data to be refreshed.</simpara>
<simpara>If the request contains <literal>wait_for_completion=false</literal> then Elasticsearch will
perform some preflight checks, launch the request, and then return a <literal>task</literal>
which can be used with <link linkend="docs-reindex-task-api">Tasks APIs</link> to cancel or get
the status of the task. For now, once the request is finished the task is gone
and the only place to look for the ultimate result of the task is in the
Elasticsearch log file. This will be fixed soon.</simpara>
<simpara><literal>consistency</literal> controls how many copies of a shard must respond to each write
request. <literal>timeout</literal> controls how long each write request waits for unavailable
shards to become available. Both work exactly how they work in the
<link linkend="docs-bulk">Bulk API</link>.</simpara>
<simpara><literal>requests_per_second</literal> can be set to any decimal number (<literal>1.4</literal>, <literal>6</literal>, <literal>1000</literal>, etc)
and throttles the number of requests per second that the reindex issues. The
throttling is done waiting between bulk batches so that it can manipulate the
scroll timeout. The wait time is the difference between the time it took the
batch to complete and the time <literal>requests_per_second * requests_in_the_batch</literal>.
Since the batch isn&#8217;t broken into multiple bulk requests large batch sizes will
cause Elasticsearch to create many requests and then wait for a while before
starting the next set. This is "bursty" instead of "smooth". The default is
<literal>unlimited</literal> which is also the only non-number value that it accepts.</simpara>
<bridgehead id="_response_body_2" renderas="sect2">Response body<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara>The JSON response looks like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "took" : 639,
  "updated": 0,
  "created": 123,
  "batches": 1,
  "version_conflicts": 2,
  "retries": 0,
  "throttled_millis": 0,
  "failures" : [ ]
}</programlisting>
<variablelist>
<varlistentry>
<term>
<literal>took</literal>
</term>
<listitem>
<simpara>
The number of milliseconds from start to end of the whole operation.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>updated</literal>
</term>
<listitem>
<simpara>
The number of documents that were successfully updated.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>created</literal>
</term>
<listitem>
<simpara>
The number of documents that were successfully created.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>batches</literal>
</term>
<listitem>
<simpara>
The number of scroll responses pulled back by the the reindex.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>version_conflicts</literal>
</term>
<listitem>
<simpara>
The number of version conflicts that reindex hit.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>retries</literal>
</term>
<listitem>
<simpara>
The number of retries that the reindex did in response to a full queue.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>throttled_millis</literal>
</term>
<listitem>
<simpara>
Number of milliseconds the request slept to conform to <literal>requests_per_second</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>failures</literal>
</term>
<listitem>
<simpara>
Array of all indexing failures. If this is non-empty then the request aborted
because of those failures. See <literal>conflicts</literal> for how to prevent version conflicts
from aborting the operation.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="docs-reindex-task-api" renderas="sect2">Works with the Task API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara>While Reindex is running you can fetch their status using the
<link linkend="tasks">Task API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_tasks/?pretty&amp;detailed=true&amp;actions=*reindex</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The responses looks like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "nodes" : {
    "r1A2WoRbTwKZ516z6NEs5A" : {
      "name" : "Tyrannus",
      "transport_address" : "127.0.0.1:9300",
      "host" : "127.0.0.1",
      "ip" : "127.0.0.1:9300",
      "attributes" : {
        "testattr" : "test",
        "portsfile" : "true"
      },
      "tasks" : {
        "r1A2WoRbTwKZ516z6NEs5A:36619" : {
          "node" : "r1A2WoRbTwKZ516z6NEs5A",
          "id" : 36619,
          "type" : "transport",
          "action" : "indices:data/write/reindex",
          "status" : {    <co id="CO21-1"/>
            "total" : 6154,
            "updated" : 3500,
            "created" : 0,
            "deleted" : 0,
            "batches" : 4,
            "version_conflicts" : 0,
            "noops" : 0,
            "retries": 0,
            "throttled_millis": 0
          },
          "description" : ""
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO21-1">
<para>
this object contains the actual status. It is just like the response json
with the important addition of the <literal>total</literal> field. <literal>total</literal> is the total number
of operations that the reindex expects to perform. You can estimate the
progress by adding the <literal>updated</literal>, <literal>created</literal>, and <literal>deleted</literal> fields. The request
will finish when their sum is equal to the <literal>total</literal> field.
</para>
</callout>
</calloutlist>
<bridgehead id="docs-reindex-cancel-task-api" renderas="sect2">Works with the Cancel Task API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara>Any Reindex can be canceled using the <link linkend="tasks">Task Cancel API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_tasks/{task_id}/_cancel</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>task_id</literal> can be found using the tasks API above.</simpara>
<simpara>Cancelation should happen quickly but might take a few seconds. The task status
API above will continue to list the task until it is wakes to cancel itself.</simpara>
<bridgehead id="docs-reindex-rethrottle" renderas="sect2">Rethrottling<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara>The value of <literal>requests_per_second</literal> can be changed on a running reindex using
the <literal>_rethrottle</literal> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_reindex/{task_id}/_rethrottle?requests_per_second=unlimited</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>task_id</literal> can be found using the tasks API above.</simpara>
<simpara>Just like when setting it on the <literal>_reindex</literal> API <literal>requests_per_second</literal> can be
either <literal>unlimited</literal> to disable throttling or any decimal number like <literal>1.7</literal> or
<literal>12</literal> to throttle to that level. Rethrottling that speeds up the query takes
effect immediately but rethrotting that slows down the query will take effect
on after completing the current batch. This prevents scroll timeouts.</simpara>
<bridgehead id="_reindex_to_change_the_name_of_a_field" renderas="sect2">Reindex to change the name of a field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/reindex.asciidoc">Edit me</ulink></bridgehead>
<simpara><literal>_reindex</literal> can be used to build a copy of an index with renamed fields. Say you
create an index containing documents that look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST test/test/1?refresh&amp;pretty
{
  "text": "words words",
  "flag": "foo"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>But you don&#8217;t like the name <literal>flag</literal> and want to replace it with <literal>tag</literal>.
<literal>_reindex</literal> can create the other index for you:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST _reindex?pretty
{
  "source": {
    "index": "test"
  },
  "dest": {
    "index": "test2"
  },
  "script": {
    "inline": "ctx._source.tag = ctx._source.remove(\"flag\")"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Now you can get the new document:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET test2/test/1?pretty</programlisting>
<remark> AUTOSENSE</remark>
<simpara>and it&#8217;ll look like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "text": "words words",
  "tag": "foo"
}</programlisting>
<simpara>Or you can search by <literal>tag</literal> or whatever you want.</simpara>
</chapter>
<chapter id="docs-termvectors">
<title>Term Vectors<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></title>
<simpara>Returns information and statistics on terms in the fields of a particular
document. The document could be stored in the index or artificially provided
by the user. Term vectors are <link linkend="realtime">realtime</link> by default, not near
realtime. This can be changed by setting <literal>realtime</literal> parameter to <literal>false</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvectors?pretty=true'</programlisting>
<simpara>Optionally, you can specify the fields for which the information is
retrieved either with a parameter in the url</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvectors?fields=text,...'</programlisting>
<simpara>or by adding the requested fields in the request body (see
example below). Fields can also be specified with wildcards
in similar way to the <link linkend="query-dsl-multi-match-query">multi match query</link></simpara>
<warning><simpara>Note that the usage of <literal>/_termvector</literal> is deprecated in 2.0, and replaced by <literal>/_termvectors</literal>.</simpara></warning>
<bridgehead id="_return_values" renderas="sect2">Return values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>Three types of values can be requested: <emphasis>term information</emphasis>, <emphasis>term statistics</emphasis>
and <emphasis>field statistics</emphasis>. By default, all term information and field
statistics are returned for all fields but no term statistics.</simpara>
<bridgehead id="_term_information" renderas="sect3">Term information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
term frequency in the field (always returned)
</simpara>
</listitem>
<listitem>
<simpara>
term positions (<literal>positions</literal> : true)
</simpara>
</listitem>
<listitem>
<simpara>
start and end offsets (<literal>offsets</literal> : true)
</simpara>
</listitem>
<listitem>
<simpara>
term payloads (<literal>payloads</literal> : true), as base64 encoded bytes
</simpara>
</listitem>
</itemizedlist>
<simpara>If the requested information wasn&#8217;t stored in the index, it will be
computed on the fly if possible. Additionally, term vectors could be computed
for documents not even existing in the index, but instead provided by the user.</simpara>
<warning>
<simpara>Start and end offsets assume UTF-16 encoding is being used. If you want to use
these offsets in order to get the original text that produced this token, you
should make sure that the string you are taking a sub-string of is also encoded
using UTF-16.</simpara>
</warning>
<bridgehead id="_term_statistics" renderas="sect3">Term statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>Setting <literal>term_statistics</literal> to <literal>true</literal> (default is <literal>false</literal>) will
return</simpara>
<itemizedlist>
<listitem>
<simpara>
total term frequency (how often a term occurs in all documents)<?asciidoc-br?>
</simpara>
</listitem>
<listitem>
<simpara>
document frequency (the number of documents containing the current
   term)
</simpara>
</listitem>
</itemizedlist>
<simpara>By default these values are not returned since term statistics can
have a serious performance impact.</simpara>
<bridgehead id="_field_statistics" renderas="sect3">Field statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>Setting <literal>field_statistics</literal> to <literal>false</literal> (default is <literal>true</literal>) will
omit :</simpara>
<itemizedlist>
<listitem>
<simpara>
document count (how many documents contain this field)
</simpara>
</listitem>
<listitem>
<simpara>
sum of document frequencies (the sum of document frequencies for all
   terms in this field)
</simpara>
</listitem>
<listitem>
<simpara>
sum of total term frequencies (the sum of total term frequencies of
   each term in this field)
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="_distributed_frequencies" renderas="sect3">Distributed frequencies<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>Setting <literal>dfs</literal> to <literal>true</literal> (default is <literal>false</literal>) will return the term statistics
or the field statistics of the entire index, and not just at the shard. Use it
with caution as distributed frequencies can have a serious performance impact.</simpara>
<bridgehead id="_terms_filtering" renderas="sect3">Terms Filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>With the parameter <literal>filter</literal>, the terms returned could also be filtered based
on their tf-idf scores. This could be useful in order find out a good
characteristic vector of a document. This feature works in a similar manner to
the <link linkend="mlt-query-term-selection">second phase</link> of the
<link linkend="query-dsl-mlt-query">More Like This Query</link>. See <link linkend="docs-termvectors-terms-filtering">example 5</link>
for usage.</simpara>
<simpara>The following sub-parameters are supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>max_num_terms</literal>
</simpara>
</entry>
<entry>
<simpara>
  Maximum number of terms that must be returned per field. Defaults to <literal>25</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
  Ignore words with less than this frequency in the source doc. Defaults to <literal>1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
  Ignore words with more than this frequency in the source doc. Defaults to unbounded.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
  Ignore terms which do not occur in at least this many docs. Defaults to <literal>1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
  Ignore words which occur in more than this many docs. Defaults to unbounded.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
  The minimum word length below which words will be ignored. Defaults to <literal>0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
  The maximum word length above which words will be ignored. Defaults to unbounded (<literal>0</literal>).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_behaviour" renderas="sect2">Behaviour<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/termvectors.asciidoc">Edit me</ulink></bridgehead>
<simpara>The term and field statistics are not accurate. Deleted documents
are not taken into account. The information is only retrieved for the
shard the requested document resides in, unless <literal>dfs</literal> is set to <literal>true</literal>.
The term and field statistics are therefore only useful as relative measures
whereas the absolute numbers have no meaning in this context. By default,
when requesting term vectors of artificial documents, a shard to get the statistics
from is randomly selected. Use <literal>routing</literal> only to hit a particular shard.</simpara>
<example>
<title>Returning stored term vectors</title>
<simpara>First, we create an index that stores term vectors, payloads etc. :</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPUT 'http://localhost:9200/twitter/' -d '{
  "mappings": {
    "tweet": {
      "properties": {
        "text": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "store" : true,
          "analyzer" : "fulltext_analyzer"
         },
         "fullname": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "analyzer" : "fulltext_analyzer"
        }
      }
    }
  },
  "settings" : {
    "index" : {
      "number_of_shards" : 1,
      "number_of_replicas" : 0
    },
    "analysis": {
      "analyzer": {
        "fulltext_analyzer": {
          "type": "custom",
          "tokenizer": "whitespace",
          "filter": [
            "lowercase",
            "type_as_payload"
          ]
        }
      }
    }
  }
}'</programlisting>
<simpara>Second, we add some documents:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/twitter/tweet/1?pretty=true' -d '{
  "fullname" : "John Doe",
  "text" : "twitter test test test "
}'

curl -XPUT 'http://localhost:9200/twitter/tweet/2?pretty=true' -d '{
  "fullname" : "Jane Doe",
  "text" : "Another twitter test ..."
}'</programlisting>
<simpara>The following request returns all information and statistics for field
<literal>text</literal> in document <literal>1</literal> (John Doe):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvectors?pretty=true' -d '{
  "fields" : ["text"],
  "offsets" : true,
  "payloads" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_id": "1",
    "_index": "twitter",
    "_type": "tweet",
    "_version": 1,
    "found": true,
    "term_vectors": {
        "text": {
            "field_statistics": {
                "doc_count": 2,
                "sum_doc_freq": 6,
                "sum_ttf": 8
            },
            "terms": {
                "test": {
                    "doc_freq": 2,
                    "term_freq": 3,
                    "tokens": [
                        {
                            "end_offset": 12,
                            "payload": "d29yZA==",
                            "position": 1,
                            "start_offset": 8
                        },
                        {
                            "end_offset": 17,
                            "payload": "d29yZA==",
                            "position": 2,
                            "start_offset": 13
                        },
                        {
                            "end_offset": 22,
                            "payload": "d29yZA==",
                            "position": 3,
                            "start_offset": 18
                        }
                    ],
                    "ttf": 4
                },
                "twitter": {
                    "doc_freq": 2,
                    "term_freq": 1,
                    "tokens": [
                        {
                            "end_offset": 7,
                            "payload": "d29yZA==",
                            "position": 0,
                            "start_offset": 0
                        }
                    ],
                    "ttf": 2
                }
            }
        }
    }
}</programlisting>
</example>
<example>
<title>Generating term vectors on the fly</title>
<simpara>Term vectors which are not explicitly stored in the index are automatically
computed on the fly. The following request returns all information and statistics for the
fields in document <literal>1</literal>, even though the terms haven&#8217;t been explicitly stored in the index.
Note that for the field <literal>text</literal>, the terms are not re-generated.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvectors?pretty=true' -d '{
  "fields" : ["text", "some_field_without_term_vectors"],
  "offsets" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}'</programlisting>
</example>
<example id="docs-termvectors-artificial-doc">
<title>Artificial documents</title>
<simpara>Term vectors can also be generated for artificial documents,
that is for documents not present in the index. The syntax is similar to the
<link linkend="search-percolate">percolator</link> API. For example, the following request would
return the same results as in example 1. The mapping used is determined by the
<literal>index</literal> and <literal>type</literal>.</simpara>
<simpara><emphasis role="strong">If dynamic mapping is turned on (default), the document fields not in the original
mapping will be dynamically created.</emphasis></simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/_termvectors' -d '{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "twitter test test test"
  }
}'</programlisting>
</example>
<example id="docs-termvectors-per-field-analyzer">
<title>Per-field analyzer</title>
<simpara>Additionally, a different analyzer than the one at the field may be provided
by using the <literal>per_field_analyzer</literal> parameter. This is useful in order to
generate term vectors in any fashion, especially when using artificial
documents. When providing an analyzer for a field that already stores term
vectors, the term vectors will be re-generated.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/_termvectors' -d '{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "twitter test test test"
  },
  "fields": ["fullname"],
  "per_field_analyzer" : {
    "fullname": "keyword"
  }
}'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "_index": "twitter",
  "_type": "tweet",
  "_version": 0,
  "found": true,
  "term_vectors": {
    "fullname": {
       "field_statistics": {
          "sum_doc_freq": 1,
          "doc_count": 1,
          "sum_ttf": 1
       },
       "terms": {
          "John Doe": {
             "term_freq": 1,
             "tokens": [
                {
                   "position": 0,
                   "start_offset": 0,
                   "end_offset": 8
                }
             ]
          }
       }
    }
  }
}</programlisting>
</example>
<example id="docs-termvectors-terms-filtering">
<title>Terms filtering</title>
<simpara>Finally, the terms returned could be filtered based on their tf-idf scores. In
the example below we obtain the three most "interesting" keywords from the
artificial document having the given "plot" field value. Additionally, we are
asking for distributed frequencies to obtain more accurate results. Notice
that the keyword "Tony" or any stop words are not part of the response, as
their tf-idf must be too low.</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /imdb/movies/_termvectors
{
    "doc": {
      "plot": "When wealthy industrialist Tony Stark is forced to build an armored suit after a life-threatening incident, he ultimately decides to use its technology to fight against evil."
    },
    "term_statistics" : true,
    "field_statistics" : true,
    "dfs": true,
    "positions": false,
    "offsets": false,
    "filter" : {
      "max_num_terms" : 3,
      "min_term_freq" : 1,
      "min_doc_freq" : 1
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_index": "imdb",
   "_type": "movies",
   "_version": 0,
   "found": true,
   "term_vectors": {
      "plot": {
         "field_statistics": {
            "sum_doc_freq": 3384269,
            "doc_count": 176214,
            "sum_ttf": 3753460
         },
         "terms": {
            "armored": {
               "doc_freq": 27,
               "ttf": 27,
               "term_freq": 1,
               "score": 9.74725
            },
            "industrialist": {
               "doc_freq": 88,
               "ttf": 88,
               "term_freq": 1,
               "score": 8.590818
            },
            "stark": {
               "doc_freq": 44,
               "ttf": 47,
               "term_freq": 1,
               "score": 9.272792
            }
         }
      }
   }
}</programlisting>
</example>
</chapter>
<chapter id="docs-multi-termvectors">
<title>Multi termvectors API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/docs/multi-termvectors.asciidoc">Edit me</ulink></title>
<simpara>Multi termvectors API allows to get multiple termvectors at once. The
documents from which to retrieve the term vectors are specified by an index,
type and id. But the documents could also be artificially provided
The response includes a <literal>docs</literal>
array with all the fetched termvectors, each element having the structure
provided by the <link linkend="docs-termvectors">termvectors</link>
API. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mtermvectors' -d '{
   "docs": [
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "2",
         "term_statistics": true
      },
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "1",
         "fields": [
            "text"
         ]
      }
   ]
}'</programlisting>
<simpara>See the <link linkend="docs-termvectors">termvectors</link> API for a description of possible parameters.</simpara>
<simpara>The <literal>_mtermvectors</literal> endpoint can also be used against an index (in which case it
is not required in the body):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/testidx/_mtermvectors' -d '{
   "docs": [
      {
         "_type": "test",
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_type": "test",
         "_id": "1"
      }
   ]
}'</programlisting>
<simpara>And type:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
   "docs": [
      {
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_id": "1"
      }
   ]
}'</programlisting>
<simpara>If all requested documents are on same index and have same type and also the parameters are the same, the request can be simplified:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
    "ids" : ["1", "2"],
    "parameters": {
        "fields": [
                "text"
        ],
        "term_statistics": true,
        …
    }
}'</programlisting>
<simpara>Additionally, just like for the <link linkend="docs-termvectors">termvectors</link>
API, term vectors could be generated for user provided documents. The syntax
is similar to the <link linkend="search-percolate">percolator</link> API. The mapping used is
determined by <literal>_index</literal> and <literal>_type</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_mtermvectors' -d '{
   "docs": [
      {
         "_index": "testidx",
         "_type": "test",
         "doc" : {
            "fullname" : "John Doe",
            "text" : "twitter test test test"
         }
      },
      {
         "_index": "testidx",
         "_type": "test",
         "doc" : {
           "fullname" : "Jane Doe",
           "text" : "Another twitter test ..."
         }
      }
   ]
}'</programlisting>
</chapter>
</part>
<part id="search">
<title>Search APIs <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>Most search APIs are <link linkend="search-multi-index-type">multi-index&#44; multi-type</link>, with the
exception of the <xref linkend="search-explain"/> endpoints.</simpara>
<bridgehead id="search-routing" renderas="sect1">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search.asciidoc">Edit me</ulink></bridgehead>
<simpara>When executing a search, it will be broadcast to all the index/indices
shards (round robin between replicas). Which shards will be searched on
can be controlled by providing the <literal>routing</literal> parameter. For example,
when indexing tweets, the routing value can be the user name:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "postDate" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}
'</programlisting>
<simpara>In such a case, if we want to search only on the tweets for a specific
user, we can specify it as the routing, resulting in the search hitting
only the relevant shard:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?routing=kimchy' -d '{
    "query": {
        "bool" : {
            "must" : {
                "query_string" : {
                    "query" : "some query string here"
                }
            },
            "filter" : {
                "term" : { "user" : "kimchy" }
            }
        }
    }
}
'</programlisting>
<simpara>The routing parameter can be multi valued represented as a comma
separated string. This will result in hitting the relevant shards where
the routing values match to.</simpara>
<bridgehead id="stats-groups" renderas="sect1">Stats Groups<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search.asciidoc">Edit me</ulink></bridgehead>
<simpara>A search can be associated with stats groups, which maintains a
statistics aggregation per group. It can later be retrieved using the
<link linkend="indices-stats">indices stats</link> API
specifically. For example, here is a search body request that associate
the request with two different groups:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match_all" : {}
    },
    "stats" : ["group1", "group2"]
}</programlisting>
<bridgehead id="global-search-timeout" renderas="sect1">Global Search Timeout<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search.asciidoc">Edit me</ulink></bridgehead>
<simpara>Individual searches can have a timeout as part of the
<xref linkend="search-request-body"/>. Since search requests can originate from many
sources, Elasticsearch has a dynamic cluster-level setting for a global
search timeout that applies to all search requests that do not set a
timeout in the <xref linkend="search-request-body"/>. The default value is no global
timeout. The setting key is <literal>search.default_search_timeout</literal> and can be
set using the <xref linkend="cluster-update-settings"/> endpoints. Setting this value
to <literal>-1</literal> resets the global search timeout to no timeout.</simpara>
</partintro>
<chapter id="search-search">
<title>Search<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search.asciidoc">Edit me</ulink></title>
<simpara>The search API allows you to execute a search query and get back search hits
that match the query. The query can either be provided using a simple
<link linkend="search-uri-request">query string as a parameter</link>, or using a
<link linkend="search-request-body">request body</link>.</simpara>
<bridgehead id="search-multi-index-type" renderas="sect2">Multi-Index, Multi-Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search.asciidoc">Edit me</ulink></bridgehead>
<simpara>All search APIs can be applied across multiple types within an index, and
across multiple indices with support for the
<link linkend="multi-index">multi index syntax</link>. For
example, we can search on all documents across all types within the
twitter index:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/_search?q=user:kimchy'</programlisting>
<simpara>We can also search within specific types:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet,user/_search?q=user:kimchy'</programlisting>
<simpara>We can also search all tweets with a certain tag across several indices
(for example, when each user has his own index):</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/kimchy,elasticsearch/tweet/_search?q=tag:wow'</programlisting>
<simpara>Or we can search all tweets across all available indices using <literal>_all</literal>
placeholder:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_all/tweet/_search?q=tag:wow'</programlisting>
<simpara>Or even search across all indices and all types:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_search?q=tag:wow'</programlisting>
</chapter>
<chapter id="search-uri-request">
<title>URI Search<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/uri-request.asciidoc">Edit me</ulink></title>
<simpara>A search request can be executed purely using a URI by providing request
parameters. Not all search options are exposed when executing a search
using this mode, but it can be handy for quick "curl tests". Here is an
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?q=user:kimchy'</programlisting>
<simpara>And here is a sample response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</programlisting>
<bridgehead id="_parameters_3" renderas="sect2">Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/uri-request.asciidoc">Edit me</ulink></bridgehead>
<simpara>The parameters allowed in the URI are:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>q</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The query string (maps to the <literal>query_string</literal> query, see
<link linkend="query-dsl-query-string-query"><emphasis>Query String Query</emphasis></link> for more details).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>df</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default field to use when no field prefix is defined within the
query.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer name to be used when analyzing the query string.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should terms be automatically lowercased or
not. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should wildcard and prefix queries be analyzed or
not. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator to be used, can be <literal>AND</literal> or
<literal>OR</literal>. Defaults to <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>explain</literal></simpara></entry>
<entry align="left" valign="top"><simpara>For each hit, contain an explanation of how scoring of the
hits was computed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>_source</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>false</literal> to disable retrieval of the <literal>_source</literal> field. You can also retrieve
part of the document by using <literal>_source_include</literal> &amp; <literal>_source_exclude</literal> (see the <link linkend="search-request-source-filtering">request body</link>
documentation for more details)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fields</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The selective stored fields of the document to return for each hit,
comma delimited. Not specifying any value will cause no fields to return.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sort</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Sorting to perform. Can either be in the form of <literal>fieldName</literal>, or
<literal>fieldName:asc</literal>/<literal>fieldName:desc</literal>. The fieldName can either be an actual
field within the document, or the special <literal>_score</literal> name to indicate
sorting based on scores. There can be several <literal>sort</literal> parameters (order
is important).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>track_scores</literal></simpara></entry>
<entry align="left" valign="top"><simpara>When sorting, set to <literal>true</literal> in order to still track
scores and return them as part of each hit.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>timeout</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A search timeout, bounding the search request to be executed
within the specified time value and bail with the hits accumulated up to
that point when expired. Defaults to no timeout.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>terminate_after</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum number of documents to collect for
each shard, upon reaching which the query execution will terminate early.
If set, the response will have a boolean field <literal>terminated_early</literal> to
indicate whether the query execution has actually terminated_early.
Defaults to no terminate_after.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>from</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The starting from index of the hits to return. Defaults to <literal>0</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of hits to return. Defaults to <literal>10</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search_type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The type of the search operation to perform. Can be
<literal>dfs_query_then_fetch</literal>, <literal>query_then_fetch</literal>, <literal>scan</literal>
<phrase revisionflag="deleted" revision="2.1.0">Deprecated in 2.1.0. Replaced by a regular <literal>scroll</literal> sorted by <literal>_doc</literal>.</phrase>
or <literal>count</literal>
<phrase revisionflag="deleted" revision="2.0.0-beta1">Deprecated in 2.0.0-beta1. Replaced by <literal>size: 0</literal>.</phrase>. Defaults to <literal>query_then_fetch</literal>. See
<link linkend="search-request-search-type"><emphasis>Search Type</emphasis></link> for
more details on the different types of search that can be performed.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</chapter>
<chapter id="search-request-body">
<title>Request Body Search<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request-body.asciidoc">Edit me</ulink></title>
<simpara>The search request can be executed with a search DSL, which includes the
<link linkend="query-dsl">Query DSL</link>, within its body. Here is an
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search' -d '{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
'</programlisting>
<simpara>And here is a sample response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</programlisting>
<bridgehead id="_parameters_4" renderas="sect2">Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request-body.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>timeout</literal>
</simpara>
</entry>
<entry>
<simpara>
    A search timeout, bounding the search request to be executed within the
    specified time value and bail with the hits accumulated up to that point
    when expired. Defaults to no timeout. See <xref linkend="time-units"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>from</literal>
</simpara>
</entry>
<entry>
<simpara>
    To retrieve hits from a certain offset. Defaults to <literal>0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>size</literal>
</simpara>
</entry>
<entry>
<simpara>
    The number of hits to return. Defaults to <literal>10</literal>. If you do not care about
    getting some hits back but only about the number of matches and/or
    aggregations, setting the value to <literal>0</literal> will help performance.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_type</literal>
</simpara>
</entry>
<entry>
<simpara>
    The type of the search operation to perform. Can be
    <literal>dfs_query_then_fetch</literal> or <literal>query_then_fetch</literal>.
    Defaults to <literal>query_then_fetch</literal>.
    See <link linkend="search-request-search-type"><emphasis>Search Type</emphasis></link> for more.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>request_cache</literal>
</simpara>
</entry>
<entry>
<simpara>
    Set to <literal>true</literal> or <literal>false</literal> to enable or disable the caching
    of search results for requests where <literal>size</literal> is 0, ie
    aggregations and suggestions (no top hits returned).
    See <xref linkend="shard-request-cache"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>terminate_after</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum number of documents to collect for each shard,
    upon reaching which the query execution will terminate early. If set, the
    response will have a boolean field <literal>terminated_early</literal> to indicate whether
    the query execution has actually terminated_early. Defaults to no
    terminate_after.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Out of the above, the <literal>search_type</literal> and the <literal>request_cache</literal> must be passed as
query-string parameters. The rest of the search request should be passed
within the body itself. The body content can also be passed as a REST
parameter named <literal>source</literal>.</simpara>
<simpara>Both HTTP GET and HTTP POST can be used to execute search with body. Since not
all clients support GET with body, POST is allowed as well.</simpara>
<section id="search-request-query">
<title>Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/query.asciidoc">Edit me</ulink></title>
<simpara>The query element within the search request body allows to define a
query using the <link linkend="query-dsl">Query DSL</link>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="search-request-from-size">
<title>From / Size<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/from-size.asciidoc">Edit me</ulink></title>
<simpara>Pagination of results can be done by using the <literal>from</literal> and <literal>size</literal>
parameters. The <literal>from</literal> parameter defines the offset from the first
result you want to fetch. The <literal>size</literal> parameter allows you to configure
the maximum amount of hits to be returned.</simpara>
<simpara>Though <literal>from</literal> and <literal>size</literal> can be set as request parameters, they can also
be set within the search body. <literal>from</literal> defaults to <literal>0</literal>, and <literal>size</literal>
defaults to <literal>10</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "from" : 0, "size" : 10,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>Note that <literal>from</literal> + <literal>size</literal> can not be more than the <literal>index.max_result_window</literal>
index setting which defaults to 10,000. See the <link linkend="search-request-scroll">Scroll</link>
API for more efficient ways to do deep scrolling.</simpara>
</section>
<section id="search-request-sort">
<title>Sort<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Allows to add one or more sort on specific fields. Each sort can be
reversed as well. The sort is defined on a per field level, with special
field name for <literal>_score</literal> to sort by score, and <literal>_doc</literal> to sort by index order.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        { "post_date" : {"order" : "asc"}},
        "user",
        { "name" : "desc" },
        { "age" : "desc" },
        "_score"
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<note><simpara><literal>_doc</literal> has no real use-case besides being the most efficient sort order.
So if you don&#8217;t care about the order in which documents are returned, then you
should sort by <literal>_doc</literal>. This especially helps when <link linkend="search-request-scroll">scrolling</link>.</simpara></note>
<section id="_sort_values">
<title>Sort Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>The sort values for each document returned are also returned as part of
the response.</simpara>
</section>
<section id="_sort_order">
<title>Sort Order<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>The <literal>order</literal> option can have the following values:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>asc</literal>
</simpara>
</entry>
<entry>
<simpara>
Sort in ascending order
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>desc</literal>
</simpara>
</entry>
<entry>
<simpara>
Sort in descending order
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The order defaults to <literal>desc</literal> when sorting on the <literal>_score</literal>, and defaults
to <literal>asc</literal> when sorting on anything else.</simpara>
</section>
<section id="_sort_mode_option">
<title>Sort mode option<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch supports sorting by array or multi-valued fields. The <literal>mode</literal> option
controls what array value is picked for sorting the document it belongs
to. The <literal>mode</literal> option can have the following values:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>min</literal>
</simpara>
</entry>
<entry>
<simpara>
Pick the lowest value.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max</literal>
</simpara>
</entry>
<entry>
<simpara>
Pick the highest value.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum</literal>
</simpara>
</entry>
<entry>
<simpara>
Use the sum of all values as sort value. Only applicable for
        number based array fields.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>avg</literal>
</simpara>
</entry>
<entry>
<simpara>
Use the average of all values as sort value. Only applicable
        for number based array fields.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>median</literal>
</simpara>
</entry>
<entry>
<simpara>
Use the median of all values as sort value.  Only applicable
           for number based array fields.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<section id="_sort_mode_example_usage">
<title>Sort mode example usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>In the example below the field price has multiple prices per document.
In this case the result hits will be sort by price ascending based on
the average price per document.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
      {"price" : {"order" : "asc", "mode" : "avg"}}
   ]
}'</programlisting>
</section>
</section>
<section id="nested-sorting">
<title>Sorting within nested objects.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch also supports sorting by
fields that are inside one or more nested objects. The sorting by nested
field support has the following parameters on top of the already
existing sort options:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>nested_path</literal>
</term>
<listitem>
<simpara>
    Defines on which nested object to sort. The actual
    sort field must be a direct field inside this nested object.
    When sorting by nested field, this field is mandatory.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>nested_filter</literal>
</term>
<listitem>
<simpara>
    A filter that the inner objects inside the nested path
    should match with in order for its field values to be taken into account
    by sorting. Common case is to repeat the query / filter inside the
    nested filter or query. By default no <literal>nested_filter</literal> is active.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="_nested_sorting_example">
<title>Nested sorting example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>In the below example <literal>offer</literal> is a field of type <literal>nested</literal>.
The <literal>nested_path</literal> needs to be specified; otherwise, elasticsearch doesn&#8217;t know on what nested level sort values need to be captured.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
       {
          "offer.price" : {
             "mode" :  "avg",
             "order" : "asc",
             "nested_path" : "offer",
             "nested_filter" : {
                "term" : { "offer.color" : "blue" }
             }
          }
       }
    ]
}'</programlisting>
<simpara>Nested sorting is also supported when sorting by
scripts and sorting by geo distance.</simpara>
</section>
</section>
<section id="_missing_values">
<title>Missing Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter specifies how docs which are missing
the field should be treated: The <literal>missing</literal> value can be
set to <literal>_last</literal>, <literal>_first</literal>, or a custom value (that
will be used for missing docs as the sort value). For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        { "price" : {"missing" : "_last"} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<note><simpara>If a nested inner object doesn&#8217;t match with
the <literal>nested_filter</literal> then a missing value is used.</simpara></note>
</section>
<section id="_ignoring_unmapped_fields">
<title>Ignoring Unmapped Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>By default, the search request will fail if there is no mapping
associated with a field. The <literal>unmapped_type</literal> option allows to ignore
fields that have no mapping and not sort by them. The value of this
parameter is used to determine what sort values to emit. Here is an
example of how it can be used:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        { "price" : {"unmapped_type" : "long"} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>If any of the indices that are queried doesn&#8217;t have a mapping for <literal>price</literal>
then Elasticsearch will handle it as if there was a mapping of type
<literal>long</literal>, with all documents in this index having no value for this field.</simpara>
</section>
<section id="geo-sorting">
<title>Geo Distance Sorting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Allow to sort by <literal>_geo_distance</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km",
                "mode" : "min",
                "distance_type" : "sloppy_arc"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<variablelist>
<varlistentry>
<term>
<literal>distance_type</literal>
</term>
<listitem>
<simpara>
    How to compute the distance. Can either be <literal>sloppy_arc</literal> (default), <literal>arc</literal> (slightly more precise but significantly slower) or <literal>plane</literal> (faster, but inaccurate on long distances and close to the poles).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Note: the geo distance sorting supports <literal>sort_mode</literal> options: <literal>min</literal>,
<literal>max</literal> and <literal>avg</literal>.</simpara>
<simpara>The following formats are supported in providing the coordinates:</simpara>
<section id="_lat_lon_as_properties">
<title>Lat Lon as Properties<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="_lat_lon_as_string">
<title>Lat Lon as String<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Format in <literal>lat,lon</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "40,-70",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="_geohash">
<title>Geohash<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="_lat_lon_as_array">
<title>Lat Lon as Array<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Format in <literal>[lon, lat]</literal>, note, the order of lon/lat here in order to
conform with <ulink url="http://geojson.org/">GeoJSON</ulink>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
</section>
<section id="_multiple_reference_points">
<title>Multiple reference points<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Multiple geo points can be passed as an array containing any <literal>geo_point</literal> format, for example</simpara>
<programlisting language="js" linenumbering="unnumbered">"pin.location" : [[-70, 40], [-71, 42]]
"pin.location" : [{"lat": 40, "lon": -70}, {"lat": 42, "lon": -71}]</programlisting>
<simpara>and so forth.</simpara>
<simpara>The final distance for a document will then be <literal>min</literal>/<literal>max</literal>/<literal>avg</literal> (defined via <literal>mode</literal>) distance of all points contained in the document to all points given in the sort request.</simpara>
</section>
<section id="_script_based_sorting">
<title>Script Based Sorting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>Allow to sort based on custom scripts, here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        ....
    },
    "sort" : {
        "_script" : {
            "type" : "number",
            "script" : {
                "inline": "doc['field_name'].value * factor",
                "params" : {
                    "factor" : 1.1
                }
            },
            "order" : "asc"
        }
    }
}</programlisting>
</section>
<section id="_track_scores">
<title>Track Scores<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>When sorting on a field, scores are not computed. By setting
<literal>track_scores</literal> to true, scores will still be computed and tracked.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "track_scores": true,
    "sort" : [
        { "post_date" : {"order" : "desc"} },
        { "name" : "desc" },
        { "age" : "desc" }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="_memory_considerations">
<title>Memory Considerations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/sort.asciidoc">Edit me</ulink></title>
<simpara>When sorting, the relevant sorted field values are loaded into memory.
This means that per shard, there should be enough memory to contain
them. For string based types, the field sorted on should not be analyzed
/ tokenized. For numeric types, if possible, it is recommended to
explicitly set the type to narrower types (like <literal>short</literal>, <literal>integer</literal> and
<literal>float</literal>).</simpara>
</section>
</section>
<section id="search-request-source-filtering">
<title>Source filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/source-filtering.asciidoc">Edit me</ulink></title>
<simpara>Allows to control how the <literal>_source</literal> field is returned with every hit.</simpara>
<simpara>By default operations return the contents of the <literal>_source</literal> field unless
you have used the <literal>fields</literal> parameter or if the <literal>_source</literal> field is disabled.</simpara>
<simpara>You can turn off <literal>_source</literal> retrieval by using the <literal>_source</literal> parameter:</simpara>
<simpara>To disable <literal>_source</literal> retrieval set to <literal>false</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_source": false,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>The <literal>_source</literal> also accepts one or more wildcard patterns to control what parts of the <literal>_source</literal> should be returned:</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_source": "obj.*",
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>Or</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_source": [ "obj1.*", "obj2.*" ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>Finally, for complete control, you can specify both include and exclude patterns:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "_source": {
        "include": [ "obj1.*", "obj2.*" ],
        "exclude": [ "*.description" ]
    },
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="search-request-fields">
<title>Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/fields.asciidoc">Edit me</ulink></title>
<warning><simpara>The <literal>fields</literal> parameter is about fields that are explicitly marked as
stored in the mapping, which is off by default and generally not recommended.
Use <link linkend="search-request-source-filtering">source filtering</link> instead to select
subsets of the original source document to be returned.</simpara></warning>
<simpara>Allows to selectively load specific stored fields for each document represented
by a search hit.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fields" : ["user", "postDate"],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara><literal>fields</literal> also accepts one or more wildcard patterns to control which fields of the document should be returned.
WARNING: Only <emphasis>stored</emphasis> fields can be retrieved with wildcard patterns.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fields": ["xxx*", "*xxx", "*xxx*", "xxx*yyy", "user", "postDate"],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara><literal>*</literal> can be used to load all stored fields from the document.</simpara>
<simpara>An empty array will cause only the <literal>_id</literal> and <literal>_type</literal> for each hit to be
returned, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fields" : [],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>For backwards compatibility, if the fields parameter specifies fields which are not stored (<literal>store</literal> mapping set to
<literal>false</literal>), it will load the <literal>_source</literal> and extract it from it. This functionality has been replaced by the
<link linkend="search-request-source-filtering">source filtering</link> parameter.</simpara>
<simpara>Field values fetched from the document it self are always returned as an array. Metadata fields like <literal>_routing</literal> and
<literal>_parent</literal> fields are never returned as an array.</simpara>
<simpara>Also only leaf fields can be returned via the <literal>field</literal> option. So object fields can&#8217;t be returned and such requests
will fail.</simpara>
<simpara>Script fields can also be automatically detected and used as fields, so
things like <literal>_source.obj1.field1</literal> can be used, though not recommended, as
<literal>obj1.field1</literal> will work as well.</simpara>
</section>
<section id="search-request-script-fields">
<title>Script Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/script-fields.asciidoc">Edit me</ulink></title>
<simpara>Allows to return a <link linkend="modules-scripting">script evaluation</link> (based on different fields) for each hit, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        ...
    },
    "script_fields" : {
        "test1" : {
            "script" : "doc['my_field_name'].value * 2"
        },
        "test2" : {
            "script" : {
                "inline": "doc['my_field_name'].value * factor",
                "params" : {
                    "factor"  : 2.0
                }
            }
        }
    }
}</programlisting>
<simpara>Script fields can work on fields that are not stored (<literal>my_field_name</literal> in
the above case), and allow to return custom values to be returned (the
evaluated value of the script).</simpara>
<simpara>Script fields can also access the actual <literal>_source</literal> document indexed and
extract specific elements to be returned from it (can be an "object"
type). Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">    {
        "query" : {
            ...
        },
        "script_fields" : {
            "test1" : {
                "script" : "_source.obj1.obj2"
            }
        }
    }</programlisting>
<simpara>Note the <literal>_source</literal> keyword here to navigate the json-like model.</simpara>
<simpara>It&#8217;s important to understand the difference between
<literal>doc['my_field'].value</literal> and <literal>_source.my_field</literal>. The first, using the doc
keyword, will cause the terms for that field to be loaded to memory
(cached), which will result in faster execution, but more memory
consumption. Also, the <literal>doc[...]</literal> notation only allows for simple valued
fields (can&#8217;t return a json object from it) and make sense only on
non-analyzed or single term based fields.</simpara>
<simpara>The <literal>_source</literal> on the other hand causes the source to be loaded, parsed,
and then only the relevant part of the json is returned.</simpara>
</section>
<section id="search-request-fielddata-fields">
<title>Field Data Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/fielddata-fields.asciidoc">Edit me</ulink></title>
<simpara>Allows to return the field data representation of a field for each hit, for
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        ...
    },
    "fielddata_fields" : ["test1", "test2"]
}</programlisting>
<simpara>Field data fields can work on fields that are not stored.</simpara>
<simpara>It&#8217;s important to understand that using the <literal>fielddata_fields</literal> parameter will
cause the terms for that field to be loaded to memory (cached), which will
result in more memory consumption.</simpara>
</section>
<section id="search-request-post-filter">
<title>Post filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/post-filter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>post_filter</literal> is applied to the search <literal>hits</literal> at the very end of a search
request,  after aggregations have already been calculated. Its purpose is
best explained by example:</simpara>
<simpara>Imagine that you are selling shirts, and the user has specified two filters:
<literal>color:red</literal> and <literal>brand:gucci</literal>.  You only want to show them red shirts made by
Gucci in the search results.  Normally you would do this with a
<link linkend="query-dsl-bool-query"><literal>bool</literal> query</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "bool": {
      "filter": [
        { "term": { "color": "red"   }},
        { "term": { "brand": "gucci" }}
      ]
    }
  }
}
'</programlisting>
<simpara>However, you would also like to use <emphasis>faceted navigation</emphasis> to display a list of
other options that the user could click on.  Perhaps you have a <literal>model</literal> field
that would allow the user to limit their search results to red Gucci
<literal>t-shirts</literal> or <literal>dress-shirts</literal>.</simpara>
<simpara>This can be done with a
<link linkend="search-aggregations-bucket-terms-aggregation"><literal>terms</literal> aggregation</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "bool": {
      "filter": [
        { "term": { "color": "red"   }},
        { "term": { "brand": "gucci" }}
      ]
    }
  },
  "aggs": {
    "models": {
      "terms": { "field": "model" } <co id="CO22-1"/>
    }
  }
}
'</programlisting>
<calloutlist>
<callout arearefs="CO22-1">
<para>
Returns the most popular models of red shirts by Gucci.
</para>
</callout>
</calloutlist>
<simpara>But perhaps you would also like to tell the user how many Gucci shirts are
available in <emphasis role="strong">other colors</emphasis>. If you just add a <literal>terms</literal> aggregation on the
<literal>color</literal> field, you will only get back the color <literal>red</literal>, because your query
returns only red shirts by Gucci.</simpara>
<simpara>Instead, you want to include shirts of all colors during aggregation, then
apply the <literal>colors</literal> filter only to the search results.  This is the purpose of
the <literal>post_filter</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "bool": {
      "filter": {
        "term": { "brand": "gucci" } <co id="CO23-1"/>
      }
    }
  },
  "aggs": {
    "colors": {
      "terms": { "field": "color" } <co id="CO23-2"/>
    },
    "color_red": {
      "filter": {
        "term": { "color": "red" } <co id="CO23-3"/>
      },
      "aggs": {
        "models": {
          "terms": { "field": "model" } <co id="CO23-4"/>
        }
      }
    }
  },
  "post_filter": { <co id="CO23-5"/>
    "term": { "color": "red" }
  }
}
'</programlisting>
<calloutlist>
<callout arearefs="CO23-1">
<para>
The main query now finds all shirts by Gucci, regardless of color.
</para>
</callout>
<callout arearefs="CO23-2">
<para>
The <literal>colors</literal> agg returns popular colors for shirts by Gucci.
</para>
</callout>
<callout arearefs="CO23-3 CO23-4">
<para>
The <literal>color_red</literal> agg limits the <literal>models</literal> sub-aggregation
    to <emphasis role="strong">red</emphasis> Gucci shirts.
</para>
</callout>
<callout arearefs="CO23-5">
<para>
Finally, the <literal>post_filter</literal> removes colors other than red
    from the search <literal>hits</literal>.
</para>
</callout>
</calloutlist>
</section>
<section id="search-request-highlighting">
<title>Highlighting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>Allows to highlight search results on one or more fields. The
implementation uses either the lucene <literal>highlighter</literal>, <literal>fast-vector-highlighter</literal>
or <literal>postings-highlighter</literal>. The following is an example of the  search request
body:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {}
        }
    }
}</programlisting>
<simpara>In the above case, the <literal>content</literal> field will be highlighted for each
search hit (there will be another element in each search hit, called
<literal>highlight</literal>, which includes the highlighted fields and the highlighted
fragments).</simpara>
<note>
<simpara>In order to perform highlighting, the actual content of the field is
required. If the field in question is stored (has <literal>store</literal> set to <literal>true</literal>
in the mapping) it will be used, otherwise, the actual <literal>_source</literal> will
be loaded and the relevant field will be extracted from it.</simpara>
<simpara>The <literal>_all</literal> field cannot be extracted from <literal>_source</literal>, so it can only
be used for highlighting if it mapped to have <literal>store</literal> set to <literal>true</literal>.</simpara>
</note>
<simpara>The field name supports wildcard notation. For example, using <literal>comment_*</literal>
will cause all <link linkend="string">string</link> fields that match the expression to be highlighted.
Note that all other fields will not be highlighted. If you use a custom mapper and want to
highlight on a field anyway, you have to provide the field name explicitly.</simpara>
<section id="plain-highlighter">
<title>Plain highlighter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>The default choice of highlighter is of type <literal>plain</literal> and uses the Lucene highlighter.
It tries hard to reflect the query matching logic in terms of understanding word importance and any word positioning criteria in phrase queries.</simpara>
<warning><simpara>If you want to highlight a lot of fields in a lot of documents with complex queries this highlighter will not be fast.
In its efforts to accurately reflect query logic it creates a tiny in-memory index and re-runs the original query criteria through
Lucene&#8217;s query execution planner to get access to low-level match information on the current document.
This is repeated for every field and every document that needs highlighting. If this presents a performance issue in your system consider using an alternative highlighter.</simpara></warning>
</section>
<section id="postings-highlighter">
<title>Postings highlighter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>If <literal>index_options</literal> is set to <literal>offsets</literal> in the mapping the postings highlighter
will be used instead of the plain highlighter. The postings highlighter:</simpara>
<itemizedlist>
<listitem>
<simpara>
Is faster since it doesn&#8217;t require to reanalyze the text to be highlighted:
the larger the documents the better the performance gain should be
</simpara>
</listitem>
<listitem>
<simpara>
Requires less disk space than term_vectors, needed for the fast vector
highlighter
</simpara>
</listitem>
<listitem>
<simpara>
Breaks the text into sentences and highlights them. Plays really well with
natural languages, not as well with fields containing for instance html markup
</simpara>
</listitem>
<listitem>
<simpara>
Treats the document as the whole corpus, and scores individual sentences as
if they were documents in this corpus, using the  BM25 algorithm
</simpara>
</listitem>
</itemizedlist>
<simpara>Here is an example of setting the <literal>content</literal> field to allow for
highlighting using the postings highlighter on it:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "type_name" : {
        "content" : {"index_options" : "offsets"}
    }
}</programlisting>
<note><simpara>Note that the postings highlighter is meant to perform simple query terms
highlighting, regardless of their positions. That means that when used for
instance in combination with a phrase query, it will highlight all the terms
that the query is composed of, regardless of whether they are actually part of
a query match, effectively ignoring their positions.</simpara></note>
<warning><simpara>The postings highlighter doesn&#8217;t support highlighting some complex queries,
like a <literal>match</literal> query with <literal>type</literal> set to <literal>match_phrase_prefix</literal>. No highlighted
snippets will be returned in that case.</simpara></warning>
</section>
<section id="fast-vector-highlighter">
<title>Fast vector highlighter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>If <literal>term_vector</literal> information is provided by setting <literal>term_vector</literal> to
<literal>with_positions_offsets</literal> in the mapping then the fast vector highlighter
will be used instead of the plain highlighter.  The fast vector highlighter:</simpara>
<itemizedlist>
<listitem>
<simpara>
Is faster especially for large fields (&gt; <literal>1MB</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
Can be customized with <literal>boundary_chars</literal>, <literal>boundary_max_scan</literal>, and
 <literal>fragment_offset</literal> (see <link linkend="boundary-characters">below</link>)
</simpara>
</listitem>
<listitem>
<simpara>
Requires setting <literal>term_vector</literal> to <literal>with_positions_offsets</literal> which
  increases the size of the index
</simpara>
</listitem>
<listitem>
<simpara>
Can combine matches from multiple fields into one result.  See
  <literal>matched_fields</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Can assign different weights to matches at different positions allowing
  for things like phrase matches being sorted above term matches when
  highlighting a Boosting Query that boosts phrase matches over term matches
</simpara>
</listitem>
</itemizedlist>
<simpara>Here is an example of setting the <literal>content</literal> field to allow for
highlighting using the fast vector highlighter on it (this will cause
the index to be bigger):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "type_name" : {
        "content" : {"term_vector" : "with_positions_offsets"}
    }
}</programlisting>
</section>
<section id="_force_highlighter_type">
<title>Force highlighter type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>The <literal>type</literal> field allows to force a specific highlighter type. This is useful
for instance when needing to use the plain highlighter on a field that has
<literal>term_vectors</literal> enabled. The allowed values are: <literal>plain</literal>, <literal>postings</literal> and <literal>fvh</literal>.
The following is an example that forces the use of the plain highlighter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"type" : "plain"}
        }
    }
}</programlisting>
</section>
<section id="_force_highlighting_on_source">
<title>Force highlighting on source<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>Forces the highlighting to highlight fields based on the source even if fields are
stored separately. Defaults to <literal>false</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"force_source" : true}
        }
    }
}</programlisting>
</section>
<section id="tags">
<title>Highlighting Tags<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>By default, the highlighting will wrap highlighted text in <literal>&lt;em&gt;</literal> and
<literal>&lt;/em&gt;</literal>. This can be controlled by setting <literal>pre_tags</literal> and <literal>post_tags</literal>,
for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;"],
        "post_tags" : ["&lt;/tag1&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</programlisting>
<simpara>Using the fast vector highlighter there can be more tags, and the "importance"
is ordered.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],
        "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</programlisting>
<simpara>There are also built in "tag" schemas, with currently a single schema
called <literal>styled</literal> with the following <literal>pre_tags</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">&lt;em class="hlt1"&gt;, &lt;em class="hlt2"&gt;, &lt;em class="hlt3"&gt;,
&lt;em class="hlt4"&gt;, &lt;em class="hlt5"&gt;, &lt;em class="hlt6"&gt;,
&lt;em class="hlt7"&gt;, &lt;em class="hlt8"&gt;, &lt;em class="hlt9"&gt;,
&lt;em class="hlt10"&gt;</programlisting>
<simpara>and <literal>&lt;/em&gt;</literal> as <literal>post_tags</literal>. If you think of more nice to have built in tag
schemas, just send an email to the mailing list or open an issue. Here
is an example of switching tag schemas:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "tags_schema" : "styled",
        "fields" : {
            "content" : {}
        }
    }
}</programlisting>
</section>
<section id="_encoder">
<title>Encoder<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>An <literal>encoder</literal> parameter can be used to define how highlighted text will
be encoded. It can be either <literal>default</literal> (no encoding) or <literal>html</literal> (will
escape html, if you use html highlighting tags).</simpara>
</section>
<section id="_highlighted_fragments">
<title>Highlighted Fragments<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>Each field highlighted can control the size of the highlighted fragment
in characters (defaults to <literal>100</literal>), and the maximum number of fragments
to return (defaults to <literal>5</literal>).
For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</programlisting>
<simpara>The <literal>fragment_size</literal> is ignored when using the postings highlighter, as it
outputs sentences regardless of their length.</simpara>
<simpara>On top of this it is possible to specify that highlighted fragments need
to be sorted by score:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</programlisting>
<simpara>If the <literal>number_of_fragments</literal> value is set to <literal>0</literal> then no fragments are
produced, instead the whole content of the field is returned, and of
course it is highlighted. This can be very handy if short texts (like
document title or address) need to be highlighted but no fragmentation
is required. Note that <literal>fragment_size</literal> is ignored in this case.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "_all" : {},
            "bio.title" : {"number_of_fragments" : 0}
        }
    }
}</programlisting>
<simpara>When using <literal>fast-vector-highlighter</literal> one can use <literal>fragment_offset</literal>
parameter to control the margin to start highlighting from.</simpara>
<simpara>In the case where there is no matching fragment to highlight, the default is
to not return anything. Instead, we can return a snippet of text from the
beginning of the field by setting <literal>no_match_size</literal> (default <literal>0</literal>) to the length
of the text that you want returned. The actual length may be shorter than
specified as it tries to break on a word boundary. When using the postings
highlighter it is not possible to control the actual size of the snippet,
therefore the first sentence gets returned whenever <literal>no_match_size</literal> is
greater than <literal>0</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "no_match_size": 150
            }
        }
    }
}</programlisting>
</section>
<section id="_highlight_query">
<title>Highlight query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>It is also possible to highlight against a query other than the search
query by setting <literal>highlight_query</literal>.  This is especially useful if you
use a rescore query because those are not taken into account by
highlighting by default.  Elasticsearch does not validate that
<literal>highlight_query</literal> contains the search query in any way so it is possible
to define it so legitimate query results aren&#8217;t highlighted at all.
Generally it is better to include the search query in the
<literal>highlight_query</literal>.  Here is an example of including both the search
query and the rescore query in <literal>highlight_query</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fields": [ "_id" ],
    "query" : {
        "match": {
            "content": {
                "query": "foo bar"
            }
        }
    },
    "rescore": {
        "window_size": 50,
        "query": {
            "rescore_query" : {
                "match_phrase": {
                    "content": {
                        "query": "foo bar",
                        "phrase_slop": 1
                    }
                }
            },
            "rescore_query_weight" : 10
        }
    },
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "highlight_query": {
                    "bool": {
                        "must": {
                            "match": {
                                "content": {
                                    "query": "foo bar"
                                }
                            }
                        },
                        "should": {
                            "match_phrase": {
                                "content": {
                                    "query": "foo bar",
                                    "phrase_slop": 1,
                                    "boost": 10.0
                                }
                            }
                        },
                        "minimum_should_match": 0
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>Note that the score of text fragment in this case is calculated by the Lucene
highlighting framework. For implementation details you can check the
<literal>ScoreOrderFragmentsBuilder.java</literal> class. On the other hand when using the
postings highlighter the fragments are scored using, as mentioned above,
the BM25 algorithm.</simpara>
</section>
<section id="highlighting-settings">
<title>Global Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>Highlighting settings can be set on a global level and then overridden
at the field level.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "number_of_fragments" : 3,
        "fragment_size" : 150,
        "tag_schema" : "styled",
        "fields" : {
            "_all" : { "pre_tags" : ["&lt;em&gt;"], "post_tags" : ["&lt;/em&gt;"] },
            "bio.title" : { "number_of_fragments" : 0 },
            "bio.author" : { "number_of_fragments" : 0 },
            "bio.content" : { "number_of_fragments" : 5, "order" : "score" }
        }
    }
}</programlisting>
</section>
<section id="field-match">
<title>Require Field Match<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara><literal>require_field_match</literal> can be set to <literal>false</literal> which will cause any field to
be highlighted regardless of whether the query matched specifically on them.
The default behaviour is <literal>true</literal>, meaning that only fields that hold a query
match will be highlighted.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {...},
    "highlight" : {
        "require_field_match": false
        "fields" : {...}
    }
}</programlisting>
</section>
<section id="boundary-characters">
<title>Boundary Characters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>When highlighting a field using the fast vector highlighter,
<literal>boundary_chars</literal> can be configured to define what constitutes a boundary
for highlighting. It&#8217;s a single string with each boundary character
defined in it. It defaults to <literal>.,!? \t\n</literal>.</simpara>
<simpara>The <literal>boundary_max_scan</literal> allows to control how far to look for boundary
characters, and defaults to <literal>20</literal>.</simpara>
</section>
<section id="matched-fields">
<title>Matched Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>The Fast Vector Highlighter can combine matches on multiple fields to
highlight a single field using <literal>matched_fields</literal>.  This is most
intuitive for multifields that analyze the same string in different
ways.  All <literal>matched_fields</literal> must have <literal>term_vector</literal> set to
<literal>with_positions_offsets</literal> but only the field to which the matches are
combined is loaded so only that field would benefit from having
<literal>store</literal> set to <literal>yes</literal>.</simpara>
<simpara>In the following examples <literal>content</literal> is analyzed by the <literal>english</literal>
analyzer and <literal>content.plain</literal> is analyzed by the <literal>standard</literal> analyzer.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "query_string": {
            "query": "content.plain:running scissors",
            "fields": ["content"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</programlisting>
<simpara>The above matches both "run with scissors" and "running with scissors"
and would highlight "running" and "scissors" but not "run". If both
phrases appear in a large document then "running with scissors" is
sorted above "run with scissors" in the fragments list because there
are more matches in that fragment.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</programlisting>
<simpara>The above highlights "run" as well as "running" and "scissors" but
still sorts "running with scissors" above "run with scissors" because
the plain match ("running") is boosted.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content.plain"],
                "type" : "fvh"
            }
        }
    }
}</programlisting>
<simpara>The above query wouldn&#8217;t highlight "run" or "scissor" but shows that
it is just fine not to list the field to which the matches are combined
(<literal>content</literal>) in the matched fields.</simpara>
<note><simpara>Technically it is also fine to add fields to <literal>matched_fields</literal> that
don&#8217;t share the same underlying string as the field to which the matches
are combined.  The results might not make much sense and if one of the
matches is off the end of the text then the whole query will fail.</simpara></note>
<note>
<simpara>There is a small amount of overhead involved with setting
<literal>matched_fields</literal> to a non-empty array so always prefer</simpara>
<programlisting language="js" linenumbering="unnumbered">    "highlight": {
        "fields": {
            "content": {}
        }
    }</programlisting>
<simpara>to</simpara>
<programlisting language="js" linenumbering="unnumbered">    "highlight": {
        "fields": {
            "content": {
                "matched_fields": ["content"],
                "type" : "fvh"
            }
        }
    }</programlisting>
</note>
</section>
<section id="phrase-limit">
<title>Phrase Limit<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></title>
<simpara>The <literal>fast-vector-highlighter</literal> has a <literal>phrase_limit</literal> parameter that prevents
it from analyzing too many phrases and eating tons of memory.  It defaults
to 256 so only the first 256 matching phrases in the document scored
considered.  You can raise the limit with the <literal>phrase_limit</literal> parameter but
keep in mind that scoring more phrases consumes more time and memory.</simpara>
<simpara>If using <literal>matched_fields</literal> keep in mind that <literal>phrase_limit</literal> phrases per
matched field are considered.</simpara>
<bridgehead id="explicit-field-order" renderas="sect2">Field Highlight Order<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/highlighting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch highlights the fields in the order that they are sent.  Per the
json spec objects are unordered but if you need to be explicit about the order
that fields are highlighted then you can use an array for <literal>fields</literal> like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">    "highlight": {
        "fields": [
            {"title":{ /*params*/ }},
            {"text":{ /*params*/ }}
        ]
    }</programlisting>
<simpara>None of the highlighters built into Elasticsearch care about the order that the
fields are highlighted but a plugin may.</simpara>
</section>
</section>
<section id="search-request-rescore">
<title>Rescoring<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/rescore.asciidoc">Edit me</ulink></title>
<simpara>Rescoring can help to improve precision by reordering just the top (eg
100 - 500) documents returned by the
<link linkend="search-request-query"><literal>query</literal></link> and
<link linkend="search-request-post-filter"><literal>post_filter</literal></link> phases, using a
secondary (usually more costly) algorithm, instead of applying the
costly algorithm to all documents in the index.</simpara>
<simpara>A <literal>rescore</literal> request is executed on each shard before it returns its
results to be sorted by the node handling the overall search request.</simpara>
<simpara>Currently the rescore API has only one implementation: the query
rescorer, which uses a query to tweak the scoring. In the future,
alternative rescorers may be made available, for example, a pair-wise rescorer.</simpara>
<note><simpara>the <literal>rescore</literal> phase is not executed when <link linkend="search-request-sort"><literal>sort</literal></link> is used or
<link linkend="search-request-search-type"><literal>search_type</literal></link> is set
to <literal>scan</literal> or <literal>count</literal>.</simpara></note>
<note><simpara>when exposing pagination to your users, you should not change
<literal>window_size</literal> as you step through each page (by passing different
<literal>from</literal> values) since that can alter the top hits causing results to
confusingly shift as the user steps through pages.</simpara></note>
<section id="_query_rescorer">
<title>Query rescorer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/rescore.asciidoc">Edit me</ulink></title>
<simpara>The query rescorer executes a second query only on the Top-K results
returned by the <link linkend="search-request-query"><literal>query</literal></link> and
<link linkend="search-request-post-filter"><literal>post_filter</literal></link> phases. The
number of docs which will be examined on each shard can be controlled by
the <literal>window_size</literal> parameter, which defaults to
<link linkend="search-request-from-size"><literal>from</literal> and <literal>size</literal></link>.</simpara>
<simpara>By default the scores from the original query and the rescore query are
combined linearly to produce the final <literal>_score</literal> for each document. The
relative importance of the original query and of the rescore query can
be controlled with the <literal>query_weight</literal> and <literal>rescore_query_weight</literal>
respectively. Both default to <literal>1</literal>.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : {
      "window_size" : 50,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }
}
'</programlisting>
<simpara>The way the scores are combined can be controlled with the <literal>score_mode</literal>:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Score Mode </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>total</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Add the original score and the rescore query score.  The default.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>multiply</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Multiply the original score by the rescore query score.  Useful
for <link linkend="query-dsl-function-score-query"><literal>function query</literal></link> rescores.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>avg</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Average the original score and the rescore query score.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Take the max of original score and the rescore query score.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>min</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Take the min of the original score and the rescore query score.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="_multiple_rescores">
<title>Multiple Rescores<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/rescore.asciidoc">Edit me</ulink></title>
<simpara>It is also possible to execute multiple rescores in sequence:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : [ {
      "window_size" : 100,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }, {
      "window_size" : 10,
      "query" : {
         "score_mode": "multiply",
         "rescore_query" : {
            "function_score" : {
               "script_score": {
                  "script": "log10(doc['numeric'].value + 2)"
               }
            }
         }
      }
   } ]
}
'</programlisting>
<simpara>The first one gets the results of the query then the second one gets the
results of the first, etc.  The second rescore will "see" the sorting done
by the first rescore so it is possible to use a large window on the first
rescore to pull documents into a smaller window for the second rescore.</simpara>
</section>
</section>
<section id="search-request-search-type">
<title>Search Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/search-type.asciidoc">Edit me</ulink></title>
<simpara>There are different execution paths that can be done when executing a
distributed search. The distributed search operation needs to be
scattered to all the relevant shards and then all the results are
gathered back. When doing scatter/gather type execution, there are
several ways to do that, specifically with search engines.</simpara>
<simpara>One of the questions when executing a distributed search is how much
results to retrieve from each shard. For example, if we have 10 shards,
the 1st shard might hold the most relevant results from 0 till 10, with
other shards results ranking below it. For this reason, when executing a
request, we will need to get results from 0 till 10 from all shards,
sort them, and then return the results if we want to ensure correct
results.</simpara>
<simpara>Another question, which relates to the search engine, is the fact that each
shard stands on its own. When a query is executed on a specific shard,
it does not take into account term frequencies and other search engine
information from the other shards. If we want to support accurate
ranking, we would need to first gather the term frequencies from all
shards to calculate global term frequencies, then execute the query on
each shard using these global frequencies.</simpara>
<simpara>Also, because of the need to sort the results, getting back a large
document set, or even scrolling it, while maintaining the correct sorting
behavior can be a very expensive operation. For large result set
scrolling, it is best to sort by <literal>_doc</literal> if the order in which documents
are returned is not important.</simpara>
<simpara>Elasticsearch is very flexible and allows to control the type of search
to execute on a <emphasis role="strong">per search request</emphasis> basis. The type can be configured
by setting the <emphasis role="strong">search_type</emphasis> parameter in the query string. The types
are:</simpara>
<section id="query-then-fetch">
<title>Query Then Fetch<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/search-type.asciidoc">Edit me</ulink></title>
<simpara>Parameter value: <emphasis role="strong">query_then_fetch</emphasis>.</simpara>
<simpara>The request is processed in two phases. In the first phase, the query
is forwarded to <emphasis role="strong">all involved shards</emphasis>. Each shard executes the search
and generates a sorted list of results, local to that shard. Each
shard returns <emphasis role="strong">just enough information</emphasis> to the coordinating node
to allow it merge and re-sort the shard level results into a globally
sorted set of results, of maximum length <literal>size</literal>.</simpara>
<simpara>During the second phase, the coordinating node requests the document
content (and highlighted snippets, if any) from <emphasis role="strong">only the relevant
shards</emphasis>.</simpara>
<note><simpara>This is the default setting, if you do not specify a <literal>search_type</literal>
      in your request.</simpara></note>
</section>
<section id="dfs-query-then-fetch">
<title>Dfs, Query Then Fetch<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/search-type.asciidoc">Edit me</ulink></title>
<simpara>Parameter value: <emphasis role="strong">dfs_query_then_fetch</emphasis>.</simpara>
<simpara>Same as "Query Then Fetch", except for an initial scatter phase which
goes and computes the distributed term frequencies for more accurate
scoring.</simpara>
</section>
<section id="count">
<title>Count<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/search-type.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta1"><title>Deprecated in 2.0.0-beta1.</title><simpara> <literal>count</literal> does not provide any benefits over <literal>query_then_fetch</literal> with a <literal>size</literal> of <literal>0</literal>.</simpara></warning>
<simpara>Parameter value: <emphasis role="strong">count</emphasis>.</simpara>
<simpara>A special search type that returns the count that matched the search
request without any docs (represented in <literal>total_hits</literal>), and possibly,
including aggregations as well. In general, this is preferable to the <literal>count</literal>
API as it provides more options.</simpara>
</section>
<section id="scan">
<title>Scan<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/search-type.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.1.0"><title>Deprecated in 2.1.0.</title><simpara> <literal>scan</literal> does not provide any benefits over a regular <literal>scroll</literal> request sorted by <literal>_doc</literal>.</simpara></warning>
<simpara>Parameter value: <emphasis role="strong">scan</emphasis>.</simpara>
<simpara>The <literal>scan</literal> search type disables sorting in order to allow very efficient
scrolling through large result sets.</simpara>
</section>
</section>
<section id="search-request-scroll">
<title>Scroll<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/scroll.asciidoc">Edit me</ulink></title>
<simpara>While a <literal>search</literal> request returns a single &#8220;page&#8221; of results, the <literal>scroll</literal>
API can be used to retrieve large numbers of results (or even all results)
from a single search request, in much the same way as you would use a cursor
on a traditional database.</simpara>
<simpara>Scrolling is not intended for real time user requests, but rather for
processing large amounts of data, e.g. in order to reindex the contents of one
index into a new index with a different configuration.</simpara>
<sidebar>
<title>Client support for scrolling and reindexing</title>
<simpara>Some of the officially supported clients provide helpers to assist with
scrolled searches and reindexing of documents from one index to another:</simpara>
<variablelist>
<varlistentry>
<term>
Perl
</term>
<listitem>
<simpara>
    See <ulink url="https://metacpan.org/pod/Search::Elasticsearch::Bulk">Search::Elasticsearch::Bulk</ulink>
    and <ulink url="https://metacpan.org/pod/Search::Elasticsearch::Scroll">Search::Elasticsearch::Scroll</ulink>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Python
</term>
<listitem>
<simpara>
    See <ulink url="http://elasticsearch-py.readthedocs.org/en/master/helpers.html">elasticsearch.helpers.*</ulink>
</simpara>
</listitem>
</varlistentry>
</variablelist>
</sidebar>
<note><simpara>The results that are returned from a scroll request reflect the state of
the index at the time that the initial <literal>search</literal> request was  made, like a
snapshot in time. Subsequent changes to documents (index, update or delete)
will only affect later search requests.</simpara></note>
<simpara>In order to use scrolling, the initial search request should specify the
<literal>scroll</literal> parameter in the query string, which tells Elasticsearch how long it
should keep the &#8220;search context&#8221; alive (see <xref linkend="scroll-search-context"/>), eg <literal>?scroll=1m</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/tweet/_search?scroll=1m' -d '
{
    "query": {
        "match" : {
            "title" : "elasticsearch"
        }
    }
}
'</programlisting>
<simpara>The result from the above request includes a <literal>_scroll_id</literal>, which should
be passed to the <literal>scroll</literal> API in order to retrieve the next batch of
results.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET <co id="CO24-1"/> 'localhost:9200/_search/scroll' <co id="CO24-2"/> -d'
{
    "scroll" : "1m", <co id="CO24-3"/>
    "scroll_id" : "c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1" <co id="CO24-4"/>
}
'</programlisting>
<calloutlist>
<callout arearefs="CO24-1">
<para>
<literal>GET</literal> or <literal>POST</literal> can be used.
</para>
</callout>
<callout arearefs="CO24-2">
<para>
The URL should not include the <literal>index</literal> or <literal>type</literal> name&#8201;&#8212;&#8201;these
    are specified in the original <literal>search</literal> request instead.
</para>
</callout>
<callout arearefs="CO24-3">
<para>
The <literal>scroll</literal> parameter tells Elasticsearch to keep the search context open
    for another <literal>1m</literal>.
</para>
</callout>
<callout arearefs="CO24-4">
<para>
The <literal>scroll_id</literal> parameter
</para>
</callout>
</calloutlist>
<simpara>Each call to the <literal>scroll</literal> API returns the next batch of results until there
are no more results left to return, ie the <literal>hits</literal> array is empty.</simpara>
<simpara>For backwards compatibility, <literal>scroll_id</literal> and <literal>scroll</literal> can be passed in the query string.
And the <literal>scroll_id</literal> can be passed in the request body</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_search/scroll?scroll=1m' -d 'c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1'</programlisting>
<important><simpara>The initial search request and each subsequent scroll request
returns a new <literal>_scroll_id</literal>&#8201;&#8212;&#8201;only the most recent <literal>_scroll_id</literal> should be
used.</simpara></important>
<note><simpara>If the request specifies aggregations, only the initial search response
will contain the aggregations results.</simpara></note>
<note><simpara>Scroll requests have optimizations that make them faster when the sort
order is <literal>_doc</literal>. If you want to iterate over all documents regardless of the
order, this is the most efficient option:</simpara></note>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_search?scroll=1m' -d '
{
  "sort": [
    "_doc"
  ]
}
'</programlisting>
<section id="scroll-search-context">
<title>Keeping the search context alive<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/scroll.asciidoc">Edit me</ulink></title>
<simpara>The <literal>scroll</literal> parameter (passed to the <literal>search</literal> request and to every <literal>scroll</literal>
request) tells Elasticsearch how long it should keep the search context alive.
Its value (e.g. <literal>1m</literal>, see <xref linkend="time-units"/>) does not need to be long enough to
process all data&#8201;&#8212;&#8201;it just needs to be long enough to process the previous
batch of results. Each <literal>scroll</literal> request (with the <literal>scroll</literal> parameter) sets a
new  expiry time.</simpara>
<simpara>Normally, the background merge process optimizes the
index by merging together smaller segments to create new bigger segments, at
which time the smaller segments are deleted. This process continues during
scrolling, but an open search context prevents the old segments from being
deleted while they are still in use.  This is how Elasticsearch is able to
return the results of the initial search request, regardless of subsequent
changes to documents.</simpara>
<tip><simpara>Keeping older segments alive means that more file handles are needed.
Ensure that you have configured your nodes to have ample free file handles.
See <xref linkend="file-descriptors"/>.</simpara></tip>
<simpara>You can check how many search contexts are open with the
<link linkend="cluster-nodes-stats">nodes stats API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_nodes/stats/indices/search?pretty</programlisting>
</section>
<section id="_clear_scroll_api">
<title>Clear scroll API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/scroll.asciidoc">Edit me</ulink></title>
<simpara>Search context are automatically removed when the <literal>scroll</literal> timeout has been
exceeded. However keeping scrolls open has a cost, as discussed in the
<link linkend="scroll-search-context">previous section</link> so scrolls should be explicitly
cleared as soon as the scroll is not being used anymore using the
<literal>clear-scroll</literal> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_search/scroll -d '
{
    "scroll_id" : ["c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1"]
}'</programlisting>
<simpara>Multiple scroll IDs can be passed as array:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_search/scroll -d '
{
    "scroll_id" : ["c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1", "aGVuRmV0Y2g7NTsxOnkxaDZ"]
}'</programlisting>
<simpara>All search contexts can be cleared with the <literal>_all</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_search/scroll/_all</programlisting>
<simpara>The <literal>scroll_id</literal> can also be passed as a query string parameter or in the request body.
Multiple scroll IDs can be passed as comma separated values:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_search/scroll \
     -d 'c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1,aGVuRmV0Y2g7NTsxOnkxaDZ'</programlisting>
</section>
</section>
<section id="search-request-preference">
<title>Preference<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/preference.asciidoc">Edit me</ulink></title>
<simpara>Controls a <literal>preference</literal> of which shard replicas to execute the search
request on. By default, the operation is randomized between the shard
replicas.</simpara>
<simpara>The <literal>preference</literal> is a query string parameter which can be set to:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_primary</literal>
</simpara>
</entry>
<entry>
<simpara>
        The operation will go and be executed only on the primary
        shards.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_primary_first</literal>
</simpara>
</entry>
<entry>
<simpara>
        The operation will go and be executed on the primary
        shard, and if not available (failover), will execute on other shards.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_replica</literal>
</simpara>
</entry>
<entry>
<simpara>
  The operation will go and be executed only on a replica shard.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_replica_first</literal>
</simpara>
</entry>
<entry>
<simpara>
  The operation will go and be executed only on a replica shard, and if
  not available (failover), will execute on other shards.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_local</literal>
</simpara>
</entry>
<entry>
<simpara>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_only_node:xyz</literal>
</simpara>
</entry>
<entry>
<simpara>
        Restricts the search to execute only on a node with
        the provided node id (<literal>xyz</literal> in this case).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_prefer_node:xyz</literal>
</simpara>
</entry>
<entry>
<simpara>
        Prefers execution on the node with the provided
        node id (<literal>xyz</literal> in this case) if applicable.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_shards:2,3</literal>
</simpara>
</entry>
<entry>
<simpara>
        Restricts the operation to the specified shards. (<literal>2</literal>
        and <literal>3</literal> in this case). This preference can be combined with other
        preferences but it has to appear first: <literal>_shards:2,3;_primary</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_only_nodes</literal>
</simpara>
</entry>
<entry>
<simpara>
    Restricts the operation to nodes specified in node specification
    <ulink url="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html</ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Custom (string) value
</simpara>
</entry>
<entry>
<simpara>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>For instance, use the user&#8217;s session ID to ensure consistent ordering of results
for the user:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl localhost:9200/_search?preference=xyzabc123 -d '
{
    "query": {
        "match": {
            "title": "elasticsearch"
        }
    }
}
'</programlisting>
</section>
<section id="search-request-explain">
<title>Explain<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/explain.asciidoc">Edit me</ulink></title>
<simpara>Enables explanation for each hit on how its score was computed.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "explain": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="search-request-version">
<title>Version<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/version.asciidoc">Edit me</ulink></title>
<simpara>Returns a version for each search hit.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "version": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
</section>
<section id="search-request-index-boost">
<title>Index Boost<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/index-boost.asciidoc">Edit me</ulink></title>
<simpara>Allows to configure different boost level per index when searching
across more than one indices. This is very handy when hits coming from
one index matter more than hits coming from another index (think social
graph where each user has an index).</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "indices_boost" : {
        "index1" : 1.4,
        "index2" : 1.3
    }
}</programlisting>
</section>
<section id="search-request-min-score">
<title>min_score<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/min-score.asciidoc">Edit me</ulink></title>
<simpara>Exclude documents which have a <literal>_score</literal> less than the minimum specified
in <literal>min_score</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "min_score": 0.5,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</programlisting>
<simpara>Note, most times, this does not make much sense, but is provided for
advanced use cases.</simpara>
</section>
<section id="search-request-named-queries-and-filters">
<title>Named Queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/named-queries-and-filters.asciidoc">Edit me</ulink></title>
<simpara>Each filter and query can accept a <literal>_name</literal> in its top level definition.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "should" : [
            {"match" : { "name.first" : {"query" : "shay", "_name" : "first"} }},
            {"match" : { "name.last" : {"query" : "banon", "_name" : "last"} }}
        ],
        "filter" : {
            "terms" : {
                "name.last" : ["banon", "kimchy"],
                "_name" : "test"
            }
        }
    }
}</programlisting>
<simpara>The search response will include for each hit the <literal>matched_queries</literal> it matched on. The tagging of queries and filters
only make sense for the <literal>bool</literal> query.</simpara>
</section>
<section id="search-request-inner-hits">
<title>Inner hits<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>The <link linkend="mapping-parent-field">parent/child</link> and <link linkend="nested">nested</link> features allow the return of documents that
have matches in a different scope. In the parent/child case, parent documents are returned based on matches in child
documents or child documents are returned based on matches in parent documents. In the nested case, documents are returned
based on matches in nested inner objects.</simpara>
<simpara>In both cases, the actual matches in the different scopes that caused a document to be returned is hidden. In many cases,
it&#8217;s very useful to know which inner nested objects (in the case of nested) or children/parent documents (in the case
of parent/child) caused certain information to be returned. The inner hits feature can be used for this. This feature
returns per search hit in the search response additional nested hits that caused a search hit to match in a different scope.</simpara>
<simpara>Inner hits can be used by defining an <literal>inner_hits</literal> definition on a <literal>nested</literal>, <literal>has_child</literal> or <literal>has_parent</literal> query and filter.
The structure looks like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">"&lt;query&gt;" : {
    "inner_hits" : {
        &lt;inner_hits_options&gt;
    }
}</programlisting>
<simpara>If <literal>inner_hits</literal> is defined on a query that supports it then each search hit will contain an <literal>inner_hits</literal> json object with the following structure:</simpara>
<programlisting language="js" linenumbering="unnumbered">"hits": [
     {
        "_index": ...,
        "_type": ...,
        "_id": ...,
        "inner_hits": {
           "&lt;inner_hits_name&gt;": {
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": ...,
                       "_id": ...,
                       ...
                    },
                    ...
                 ]
              }
           }
        },
        ...
     },
     ...
]</programlisting>
<section id="_options">
<title>Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>Inner hits support the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>from</literal>
</simpara>
</entry>
<entry>
<simpara>
The offset from where the first hit to fetch for each <literal>inner_hits</literal> in the returned regular search hits.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>size</literal>
</simpara>
</entry>
<entry>
<simpara>
The maximum number of hits to return per <literal>inner_hits</literal>. By default the top three matching hits are returned.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sort</literal>
</simpara>
</entry>
<entry>
<simpara>
How the inner hits should be sorted per <literal>inner_hits</literal>. By default the hits are sorted by the score.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>name</literal>
</simpara>
</entry>
<entry>
<simpara>
The name to be used for the particular inner hit definition in the response. Useful when multiple inner hits
         have been defined in a single search request. The default depends in which query the inner hit is defined.
         For <literal>has_child</literal> query and filter this is the child type, <literal>has_parent</literal> query and filter this is the parent type
         and the nested query and filter this is the nested path.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Inner hits also supports the following per document features:</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="search-request-highlighting">Highlighting</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-explain">Explain</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-source-filtering">Source filtering</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-script-fields">Script fields</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-fielddata-fields">Fielddata fields</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-version">Include versions</link>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="nested-inner-hits">
<title>Nested inner hits<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>The nested <literal>inner_hits</literal> can be used to include nested inner objects as inner hits to a search hit.</simpara>
<simpara>The example below assumes that there is a nested object field defined with the name <literal>comments</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "nested" : {
            "path" : "comments",
            "query" : {
                "match" : {"comments.message" : "[actual query]"}
            },
            "inner_hits" : {} <co id="CO25-1"/>
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO25-1">
<para>
The inner hit definition in the nested query. No other options need to be defined.
</para>
</callout>
</calloutlist>
<simpara>An example of a response snippet that could be generated from the above search request:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
"hits": {
  ...
  "hits": [
     {
        "_index": "my-index",
        "_type": "question",
        "_id": "1",
        "_source": ...,
        "inner_hits": {
           "comments": { <co id="CO26-1"/>
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": "question",
                       "_id": "1",
                       "_nested": {
                          "field": "comments",
                          "offset": 2
                       },
                       "_source": ...
                    },
                    ...
                 ]
              }
           }
        }
     },
     ...</programlisting>
<calloutlist>
<callout arearefs="CO26-1">
<para>
The name used in the inner hit definition in the search request. A custom key can be used via the <literal>name</literal> option.
</para>
</callout>
</calloutlist>
<simpara>The <literal>_nested</literal> metadata is crucial in the above example, because it defines from what inner nested object this inner hit
came from. The <literal>field</literal> defines the object array field the nested hit is from and the <literal>offset</literal> relative to its location
in the <literal>_source</literal>. Due to sorting and scoring the actual location of the hit objects in the <literal>inner_hits</literal> is usually
different than the location a nested inner object was defined.</simpara>
<simpara>By default the <literal>_source</literal> is returned also for the hit objects in <literal>inner_hits</literal>, but this can be changed. Either via
<literal>_source</literal> filtering feature part of the source can be returned or be disabled. If stored fields are defined on the
nested level these can also be returned via the <literal>fields</literal> feature.</simpara>
<simpara>An important default is that the <literal>_source</literal> returned in hits inside <literal>inner_hits</literal> is relative to the <literal>_nested</literal> metadata.
So in the above example only the comment part is returned per nested hit and not the entire source of the top level
document that contained the comment.</simpara>
<note><simpara>A bug in Elasticsearch 2.x means that if you explicitly specify fields to be returned as part of the _source for inner_hits, you need to define them using the relative path, so in the example above you must write:</simpara></note>
<screen>"inner_hits" : {
     "_source":["message"]
     }</screen>
<simpara>If you return field data using fielddata_fields, you need to specify the full path instead.</simpara>
</section>
<section id="hierarchical-nested-inner-hits">
<title>Hierarchical levels of nested object fields and inner hits.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>If a mapping has multiple levels of hierarchical nested object fields each level can be accessed using <link linkend="top-level-inner-hits">Top level inner hits</link> (see below).</simpara>
</section>
<section id="parent-child-inner-hits">
<title>Parent/child inner hits<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>The parent/child <literal>inner_hits</literal> can be used to include parent or child</simpara>
<simpara>The examples below assumes that there is a <literal>_parent</literal> field mapping in the <literal>comment</literal> type:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "has_child" : {
            "type" : "comment",
            "query" : {
                "match" : {"message" : "[actual query]"}
            },
            "inner_hits" : {} <co id="CO27-1"/>
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO27-1">
<para>
The inner hit definition like in the nested example.
</para>
</callout>
</calloutlist>
<simpara>An example of a response snippet that could be generated from the above search request:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
"hits": {
  ...
  "hits": [
     {
        "_index": "my-index",
        "_type": "question",
        "_id": "1",
        "_source": ...,
        "inner_hits": {
           "comment": {
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": "comment",
                       "_id": "5",
                       "_source": ...
                    },
                    ...
                 ]
              }
           }
        }
     },
     ...</programlisting>
</section>
<section id="top-level-inner-hits">
<title>Top level inner hits<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/request/inner-hits.asciidoc">Edit me</ulink></title>
<simpara>Besides defining inner hits on query and filters, inner hits can also be defined as a top level construct alongside the
<literal>query</literal> and <literal>aggregations</literal> definition. The main reason for using the top level inner hits definition is to let the
inner hits return documents that don&#8217;t match with the main query. Also inner hits definitions can be nested via the
top level notation. Other than that, the inner hit definition inside the query should be used because that is the most
compact way for defining inner hits.</simpara>
<simpara>The following snippet explains the basic structure of inner hits defined at the top level of the search request body:</simpara>
<programlisting language="js" linenumbering="unnumbered">"inner_hits" : {
    "&lt;inner_hits_name&gt;" : {
        "&lt;path|type&gt;" : {
            "&lt;path-to-nested-object-field|child-or-parent-type&gt;" : {
                &lt;inner_hits_body&gt;
                [,"inner_hits" : { [&lt;sub_inner_hits&gt;]+ } ]?
            }
        }
    }
    [,"&lt;inner_hits_name_2&gt;" : { ... } ]*
}</programlisting>
<simpara>Inside the <literal>inner_hits</literal> definition, first the name of the inner hit is defined then whether the inner_hit
is a nested by defining <literal>path</literal> or a parent/child based definition by defining <literal>type</literal>. The next object layer contains
the name of the nested object field if the inner_hits is nested or the parent or child type if the inner_hit definition
is parent/child based.</simpara>
<simpara>Multiple inner hit definitions can be defined in a single request. In the <literal>&lt;inner_hits_body&gt;</literal> any option for features
that <literal>inner_hits</literal> support can be defined. Optionally another <literal>inner_hits</literal> definition can be defined in the <literal>&lt;inner_hits_body&gt;</literal>.</simpara>
<simpara>An example that shows the use of nested inner hits via the top level notation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "nested" : {
            "path" : "comments",
            "query" : {
                "match" : {"comments.message" : "[actual query]"}
            }
        }
    },
    "inner_hits" : {
        "comment" : {
            "path" : { <co id="CO28-1"/>
                "comments" : { <co id="CO28-2"/>
                    "query" : {
                        "match" : {"comments.message" : "[different query]"} <co id="CO28-3"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO28-1">
<para>
The inner hit definition is nested and requires the <literal>path</literal> option.
</para>
</callout>
<callout arearefs="CO28-2">
<para>
The path option refers to the nested object field <literal>comments</literal>
</para>
</callout>
<callout arearefs="CO28-3">
<para>
A query that runs to collect the nested inner documents for each search hit returned. If no query is defined all nested
    inner documents will be included belonging to a search hit. This shows that it only make sense to the top level
    inner hit definition if no query or a different query is specified.
</para>
</callout>
</calloutlist>
<simpara>Additional options that are only available when using the top level inner hits notation:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>path</literal>
</simpara>
</entry>
<entry>
<simpara>
Defines the nested scope where hits will be collected from.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>type</literal>
</simpara>
</entry>
<entry>
<simpara>
Defines the parent or child type score where hits will be collected from.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>query</literal>
</simpara>
</entry>
<entry>
<simpara>
Defines the query that will run in the defined nested, parent or child scope to collect and score hits. By default all document in the scope will be matched.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Either <literal>path</literal> or <literal>type</literal> must be defined. The <literal>path</literal> or <literal>type</literal> defines the scope from where hits are fetched and
used as inner hits.</simpara>
</section>
</section>
</chapter>
<chapter id="search-template">
<title>Search Template<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></title>
<simpara>The <literal>/_search/template</literal> endpoint allows to use the mustache language to pre render search requests,
before they are executed and fill existing templates with template parameters.</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
    "inline" : {
      "query": { "match" : { "{{my_field}}" : "{{my_value}}" } },
      "size" : "{{my_size}}"
    },
    "params" : {
        "my_field" : "foo",
        "my_value" : "bar",
        "my_size" : 5
    }
}</programlisting>
<simpara>For more information on how Mustache templating and what kind of templating you
can do with it check out the <ulink url="http://mustache.github.io/mustache.5.html">online
documentation of the mustache project</ulink>.</simpara>
<note><simpara>The mustache language is implemented in elasticsearch as a sandboxed
scripting language, hence it obeys settings that may be used to enable or
disable scripts per language, source and operation as described in
<link linkend="enable-dynamic-scripting">scripting docs</link></simpara></note>
<bridgehead id="_more_template_examples" renderas="sect3">More template examples<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_filling_in_a_query_string_with_a_single_value" renderas="sect4">Filling in a query string with a single value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
    "inline": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    },
    "params": {
        "query_string": "search for these words"
    }
}</programlisting>
<bridgehead id="_passing_an_array_of_strings" renderas="sect4">Passing an array of strings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
  "inline": {
    "query": {
      "terms": {
        "status": [
          "{{#status}}",
          "{{.}}",
          "{{/status}}"
        ]
      }
    }
  },
  "params": {
    "status": [ "pending", "published" ]
  }
}</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
"query": {
  "terms": {
    "status": [ "", "pending", "", published", "" ] <co id="CO29-1"/>
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO29-1">
<para>
The empty <literal>""</literal> will be ignored as long as <literal>""</literal> is not a valid value for the <literal>status</literal> field.
</para>
</callout>
</calloutlist>
<simpara>Alternatively, you can flatten the <literal>status</literal> parameter into a string which is
passed in unescaped (using <literal>{{{ }}}</literal>) as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
  "inline": "{\"query\": {\"terms\": {\"status\": [ {{{status}}} ]}}}",
  "params": {
    "status": "\"pending\", \"published\""
  }
}</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "query": {
    "terms": {
      "status": [
        "pending",
        "published"
      ]
    }
  }
}</programlisting>
<bridgehead id="_concatenating_array_of_values" renderas="sect4">Concatenating array of values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>{{#join}}array{{/join}}</literal> function can be used to concatenate the
values of an array as a comma delimited string:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
  "inline": {
    "query": {
      "match": {
        "emails": "{{#join}}emails{{/join}}"
      }
    }
  },
  "params": {
    "emails": [ "username@email.com", "lastname@email.com" ]
  }
}</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : {
            "emails" : "username@email.com,lastname@email.com"
        }
    }
}</programlisting>
<simpara>The function also accepts a custom delimiter:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
  "inline": {
    "query": {
      "range": {
        "born": {
            "gte"   : "{{date.min}}",
            "lte"   : "{{date.max}}",
            "format": "{{#join delimiter='||'}}date.formats{{/join delimiter='||'}}"
            }
      }
    }
  },
  "params": {
    "date": {
        "min": "2016",
        "max": "31/12/2017",
        "formats": ["dd/MM/yyyy", "yyyy"]
    }
  }
}</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
      "range" : {
        "born" : {
          "gte" : "2016",
          "lte" : "31/12/2017",
          "format" : "dd/MM/yyyy||yyyy"
        }
      }
    }
}</programlisting>
<bridgehead id="_default_values" renderas="sect4">Default values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>A default value is written as <literal>{{var}}{{^var}}default{{/var}}</literal> for instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "inline": {
    "query": {
      "range": {
        "line_no": {
          "gte": "{{start}}",
          "lte": "{{end}}{{^end}}20{{/end}}"
        }
      }
    }
  },
  "params": { ... }
}</programlisting>
<simpara>When <literal>params</literal> is <literal>{ "start": 10, "end": 15 }</literal> this query would be rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "15"
        }
  }
}</programlisting>
<simpara>But when <literal>params</literal> is <literal>{ "start": 10 }</literal> this query would use the default value
for <literal>end</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "20"
        }
    }
}</programlisting>
<bridgehead id="_converting_parameters_to_json" renderas="sect4">Converting parameters to JSON<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>{{#toJson}}parameter{{/toJson}}</literal> function can be used to convert parameters
like maps and array to their JSON representation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "inline": "{\"query\":{\"bool\":{\"must\": {{#toJson}}clauses{{/toJson}} }}}",
    "params": {
        "clauses": [
            { "term": "foo" },
            { "term": "bar" }
        ]
   }
}</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
      "bool" : {
        "must" : [
          {
            "term" : "foo"
          },
          {
            "term" : "bar"
          }
        ]
      }
    }
}</programlisting>
<bridgehead id="_conditional_clauses" renderas="sect4">Conditional clauses<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>Conditional clauses cannot be expressed using the JSON form of the template.
Instead, the template <emphasis role="strong">must</emphasis> be passed as a string.  For instance, let&#8217;s say
we wanted to run a <literal>match</literal> query on the <literal>line</literal> field, and optionally wanted
to filter by line numbers, where <literal>start</literal> and <literal>end</literal> are optional.</simpara>
<simpara>The <literal>params</literal> would look like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "params": {
        "text":      "words to search for",
        "line_no": { <co id="CO30-1"/>
            "start": 10, <co id="CO30-2"/>
            "end":   20  <co id="CO30-3"/>
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO30-1 CO30-2 CO30-3">
<para>
All three of these elements are optional.
</para>
</callout>
</calloutlist>
<simpara>We could write the query as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "query": {
    "bool": {
      "must": {
        "match": {
          "line": "{{text}}" <co id="CO31-1"/>
        }
      },
      "filter": {
        {{#line_no}} <co id="CO31-2"/>
          "range": {
            "line_no": {
              {{#start}} <co id="CO31-3"/>
                "gte": "{{start}}" <co id="CO31-4"/>
                {{#end}},{{/end}} <co id="CO31-5"/>
              {{/start}} <co id="CO31-6"/>
              {{#end}} <co id="CO31-7"/>
                "lte": "{{end}}" <co id="CO31-8"/>
              {{/end}} <co id="CO31-9"/>
            }
          }
        {{/line_no}} <co id="CO31-10"/>
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO31-1">
<para>
Fill in the value of param <literal>text</literal>
</para>
</callout>
<callout arearefs="CO31-2 CO31-10">
<para>
Include the <literal>range</literal> filter only if <literal>line_no</literal> is specified
</para>
</callout>
<callout arearefs="CO31-3 CO31-6">
<para>
Include the <literal>gte</literal> clause only if <literal>line_no.start</literal> is specified
</para>
</callout>
<callout arearefs="CO31-4">
<para>
Fill in the value of param <literal>line_no.start</literal>
</para>
</callout>
<callout arearefs="CO31-5">
<para>
Add a comma after the <literal>gte</literal> clause only if <literal>line_no.start</literal>
    AND <literal>line_no.end</literal> are specified
</para>
</callout>
<callout arearefs="CO31-7 CO31-9">
<para>
Include the <literal>lte</literal> clause only if <literal>line_no.end</literal> is specified
</para>
</callout>
<callout arearefs="CO31-8">
<para>
Fill in the value of param <literal>line_no.end</literal>
</para>
</callout>
</calloutlist>
<note>
<simpara>As written above, this template is not valid JSON because it includes the
<emphasis>section</emphasis> markers like <literal>{{#line_no}}</literal>.  For this reason, the template should
either be stored in a file (see <xref linkend="pre-registered-templates"/>) or, when used
via the REST API, should be written as a string:</simpara>
<programlisting language="js" linenumbering="unnumbered">"inline": "{\"query\":{\"bool\":{\"must\":{\"match\":{\"line\":\"{{text}}\"}},\"filter\":{{{#line_no}}\"range\":{\"line_no\":{{{#start}}\"gte\":\"{{start}}\"{{#end}},{{/end}}{{/start}}{{#end}}\"lte\":\"{{end}}\"{{/end}}}}{{/line_no}}}}}}"</programlisting>
</note>
<bridgehead id="pre-registered-templates" renderas="sect4">Pre-registered template<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can register search templates by storing it in the <literal>config/scripts</literal> directory, in a file using the <literal>.mustache</literal> extension.
In order to execute the stored template, reference it by it&#8217;s name under the <literal>template</literal> key:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
    "file": "storedTemplate", <co id="CO32-1"/>
    "params": {
        "query_string": "search for these words"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO32-1">
<para>
Name of the query template in <literal>config/scripts/</literal>, i.e., <literal>storedTemplate.mustache</literal>.
</para>
</callout>
</calloutlist>
<simpara>You can also register search templates by storing it in the elasticsearch cluster in a special index named <literal>.scripts</literal>.
There are REST APIs to manage these indexed templates.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_search/template/&lt;templatename&gt;
{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    }
}</programlisting>
<simpara>This template can be retrieved by</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template/&lt;templatename&gt;</programlisting>
<simpara>which is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    }
}</programlisting>
<simpara>This template can be deleted by</simpara>
<programlisting language="js" linenumbering="unnumbered">DELETE /_search/template/&lt;templatename&gt;</programlisting>
<simpara>To use an indexed template at search time use:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search/template
{
    "id": "templateName", <co id="CO33-1"/>
    "params": {
        "query_string": "search for these words"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO33-1">
<para>
Name of the query template stored in the <literal>.scripts</literal> index.
</para>
</callout>
</calloutlist>
<bridgehead id="_validating_templates" renderas="sect3">Validating templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-template.asciidoc">Edit me</ulink></bridgehead>
<simpara>A template can be rendered in a response with given parameters using</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_render/template
{
  "inline": {
    "query": {
      "terms": {
        "status": [
          "{{#status}}",
          "{{.}}",
          "{{/status}}"
        ]
      }
    }
  },
  "params": {
    "status": [ "pending", "published" ]
  }
}</programlisting>
<simpara>This call will return the rendered template:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "template_output": {
    "query": {
      "terms": {
        "status": [ <co id="CO34-1"/>
          "pending",
          "published"
        ]
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO34-1">
<para>
<literal>status</literal> array has been populated with values from the <literal>params</literal> object.
</para>
</callout>
</calloutlist>
<simpara>File and indexed templates can also be rendered by replacing <literal>inline</literal> with
<literal>file</literal> or <literal>id</literal> respectively. For example, to render a file template</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_render/template
{
  "file": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  }
}</programlisting>
<simpara>Pre-registered templates can also be rendered using</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_render/template/&lt;template_name&gt;
{
  "params": {
    "..."
  }
}</programlisting>
</chapter>
<chapter id="search-shards">
<title>Search Shards API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-shards.asciidoc">Edit me</ulink></title>
<simpara>The search shards api returns the indices and shards that a search request would
be executed against. This can give useful feedback for working out issues or
planning optimizations with routing and shard preferences.</simpara>
<simpara>The <literal>index</literal> and <literal>type</literal> parameters may be single values, or comma-separated.</simpara>
<bridgehead id="_usage" renderas="sect2">Usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-shards.asciidoc">Edit me</ulink></bridgehead>
<simpara>Full example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/_search_shards'</programlisting>
<simpara>This will yield the following result:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "nodes": {
    "JklnKbD7Tyqi9TP3_Q_tBg": {
      "name": "Rl'nnd",
      "transport_address": "inet[/192.168.1.113:9300]"
    }
  },
  "shards": [
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 3,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 4,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 0,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 2,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 1,
        "state": "STARTED"
      }
    ]
  ]
}</programlisting>
<simpara>And specifying the same request, this time with a routing value:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/_search_shards?routing=foo,baz'</programlisting>
<simpara>This will yield the following result:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "nodes": {
    "JklnKbD7Tyqi9TP3_Q_tBg": {
      "name": "Rl'nnd",
      "transport_address": "inet[/192.168.1.113:9300]"
    }
  },
  "shards": [
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 2,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 4,
        "state": "STARTED"
      }
    ]
  ]
}</programlisting>
<simpara>This time the search will only be executed against two of the shards, because
routing values have been specified.</simpara>
<bridgehead id="_all_parameters" renderas="sect2">All parameters:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/search-shards.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>routing</literal>
</simpara>
</entry>
<entry>
<simpara>
    A comma-separated list of routing values to take into account when
    determining which shards a request would be executed against.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>preference</literal>
</simpara>
</entry>
<entry>
<simpara>
    Controls a <literal>preference</literal> of which shard replicas to execute the search
    request on. By default, the operation is randomized between the shard
    replicas. See the <ulink url="search-request-preference.html">preference</ulink>
    documentation for a list of all acceptable values.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>local</literal>
</simpara>
</entry>
<entry>
<simpara>
    A boolean value whether to read the cluster state locally in order to
    determine where shards are allocated instead of using the Master node&#8217;s
    cluster state.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
<chapter id="search-suggesters">
<title>Suggesters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters.asciidoc">Edit me</ulink></title>
<simpara>The suggest feature suggests similar looking terms based on a provided
text by using a suggester. Parts of the suggest feature are still under
development.</simpara>
<simpara>The suggest request part is either defined alongside the query part in a
<literal>_search</literal> request or via the REST <literal>_suggest</literal> endpoint.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPOST 'localhost:9200/_search' -d '{
  "query" : {
    ...
  },
  "suggest" : {
    ...
  }
}'</programlisting>
<simpara>Suggest requests executed against the <literal>_suggest</literal> endpoint should omit
the surrounding <literal>suggest</literal> element which is only used if the suggest
request is part of a search.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_suggest' -d '{
  "my-suggestion" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  }
}'</programlisting>
<simpara>Several suggestions can be specified per request. Each suggestion is
identified with an arbitrary name. In the example below two suggestions
are requested. Both <literal>my-suggest-1</literal> and <literal>my-suggest-2</literal> suggestions use
the <literal>term</literal> suggester, but have a different <literal>text</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">"suggest" : {
  "my-suggest-1" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  },
  "my-suggest-2" : {
    "text" : "the rottredam meetpu",
    "term" : {
      "field" : "title"
    }
  }
}</programlisting>
<simpara>The below suggest response example includes the suggestion response for
<literal>my-suggest-1</literal> and <literal>my-suggest-2</literal>. Each suggestion part contains
entries. Each entry is effectively a token from the suggest text and
contains the suggestion entry text, the original start offset and length
in the suggest text and if found an arbitrary number of options.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  ...
  "suggest": {
    "my-suggest-1": [
      {
        "text" : "amsterdma",
        "offset": 4,
        "length": 9,
        "options": [
           ...
        ]
      },
      ...
    ],
    "my-suggest-2" : [
      ...
    ]
  }
  ...
}</programlisting>
<simpara>Each options array contains an option object that includes the
suggested text, its document frequency and score compared to the suggest
entry text. The meaning of the score depends on the used suggester. The
term suggester&#8217;s score is based on the edit distance.</simpara>
<programlisting language="js" linenumbering="unnumbered">"options": [
  {
    "text": "amsterdam",
    "freq": 77,
    "score": 0.8888889
  },
  ...
]</programlisting>
<bridgehead id="global-suggest" renderas="sect2">Global suggest text<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters.asciidoc">Edit me</ulink></bridgehead>
<simpara>To avoid repetition of the suggest text, it is possible to define a
global text. In the example below the suggest text is defined globally
and applies to the <literal>my-suggest-1</literal> and <literal>my-suggest-2</literal> suggestions.</simpara>
<programlisting language="js" linenumbering="unnumbered">"suggest" : {
  "text" : "the amsterdma meetpu",
  "my-suggest-1" : {
    "term" : {
      "field" : "title"
    }
  },
  "my-suggest-2" : {
    "term" : {
      "field" : "body"
    }
  }
}</programlisting>
<simpara>The suggest text can in the above example also be specified as
suggestion specific option. The suggest text specified on suggestion
level override the suggest text on the global level.</simpara>
<bridgehead id="_other_suggest_example" renderas="sect2">Other suggest example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters.asciidoc">Edit me</ulink></bridgehead>
<simpara>In the below example we request suggestions for the following suggest
text: <literal>devloping distibutd saerch engies</literal> on the <literal>title</literal> field with a
maximum of 3 suggestions per term inside the suggest text. Note that in
this example we set <literal>size</literal> to <literal>0</literal>. This isn&#8217;t required, but a
nice optimization. The suggestions are gathered in the <literal>query</literal> phase and
in the case that we only care about suggestions (so no hits) we don&#8217;t
need to execute the <literal>fetch</literal> phase.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPOST 'localhost:9200/_search' -d '{
  "size": 0,
  "suggest" : {
    "my-title-suggestions-1" : {
      "text" : "devloping distibutd saerch engies",
      "term" : {
        "size" : 3,
        "field" : "title"
      }
    }
  }
}'</programlisting>
<simpara>The above request could yield the response as stated in the code example
below. As you can see if we take the first suggested options of each
suggestion entry we get <literal>developing distributed search engines</literal> as
result.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  ...
  "suggest": {
    "my-title-suggestions-1": [
      {
        "text": "devloping",
        "offset": 0,
        "length": 9,
        "options": [
          {
            "text": "developing",
            "freq": 77,
            "score": 0.8888889
          },
          {
            "text": "deloping",
            "freq": 1,
            "score": 0.875
          },
          {
            "text": "deploying",
            "freq": 2,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "distibutd",
        "offset": 10,
        "length": 9,
        "options": [
          {
            "text": "distributed",
            "freq": 217,
            "score": 0.7777778
          },
          {
            "text": "disributed",
            "freq": 1,
            "score": 0.7777778
          },
          {
            "text": "distribute",
            "freq": 1,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "saerch",
        "offset": 20,
        "length": 6,
        "options": [
          {
            "text": "search",
            "freq": 1038,
            "score": 0.8333333
          },
          {
            "text": "smerch",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "serch",
            "freq": 2,
            "score": 0.8
          }
        ]
      },
      {
        "text": "engies",
        "offset": 27,
        "length": 6,
        "options": [
          {
            "text": "engines",
            "freq": 568,
            "score": 0.8333333
          },
          {
            "text": "engles",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "eggies",
            "freq": 1,
            "score": 0.8333333
          }
        ]
      }
    ]
  }
  ...
}</programlisting>
<section id="search-suggesters-term">
<title>Term suggester<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/term-suggest.asciidoc">Edit me</ulink></title>
<note><simpara>In order to understand the format of suggestions, please
read the <xref linkend="search-suggesters"/> page first.</simpara></note>
<simpara>The <literal>term</literal> suggester suggests terms based on edit distance. The provided
suggest text is analyzed before terms are suggested. The suggested terms
are provided per analyzed suggest text token. The <literal>term</literal> suggester
doesn&#8217;t take the query into account that is part of request.</simpara>
<section id="_common_suggest_options">
<title>Common suggest options:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/term-suggest.asciidoc">Edit me</ulink></title>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>text</literal>
</simpara>
</entry>
<entry>
<simpara>
    The suggest text. The suggest text is a required option that
    needs to be set globally or per suggestion.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>field</literal>
</simpara>
</entry>
<entry>
<simpara>
    The field to fetch the candidate suggestions from. This is
    an required option that either needs to be set globally or per
    suggestion.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyzer</literal>
</simpara>
</entry>
<entry>
<simpara>
    The analyzer to analyse the suggest text with. Defaults
    to the search analyzer of the suggest field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>size</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum corrections to be returned per suggest text
    token.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sort</literal>
</simpara>
</entry>
<entry>
<simpara>
    Defines how suggestions should be sorted per suggest text
    term. Two possible values:
</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>score</literal>:     Sort by score first, then document frequency and
                    then the term itself.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>frequency</literal>: Sort by document frequency first, then similarity
                    score and then the term itself.
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>suggest_mode</literal>
</simpara>
</entry>
<entry>
<simpara>
    The suggest mode controls what suggestions are
    included or controls for what suggest text terms, suggestions should be
    suggested. Three possible values can be specified:
</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>missing</literal>:  Only provide suggestions for suggest text terms that are
                    not in the index. This is the default.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>popular</literal>:  Only suggest suggestions that occur in more docs then
                    the original suggest text term.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>always</literal>:   Suggest any matching suggestions based on terms in the
                    suggest text.
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_other_term_suggest_options">
<title>Other term suggest options:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/term-suggest.asciidoc">Edit me</ulink></title>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>lowercase_terms</literal>
</simpara>
</entry>
<entry>
<simpara>
    Lower cases the suggest text terms after text analysis.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_edits</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum edit distance candidate suggestions can
    have in order to be considered as a suggestion. Can only be a value
    between 1 and 2. Any other value result in an bad request error being
    thrown. Defaults to 2.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>prefix_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings don&#8217;t
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>shard_size</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets the maximum number of suggestions to be retrieved
    from each individual shard. During the reduce phase only the top N
    suggestions are returned based on the <literal>size</literal> option. Defaults to the
    <literal>size</literal> option. Setting this to a value higher than the <literal>size</literal> can be
    useful in order to get a more accurate document frequency for spelling
    corrections at the cost of performance. Due to the fact that terms are
    partitioned amongst shards, the shard level document frequencies of
    spelling corrections may not be precise. Increasing this will make these
    document frequencies more precise.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_inspections</literal>
</simpara>
</entry>
<entry>
<simpara>
    A factor that is used to multiply with the
    <literal>shards_size</literal> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>string_distance</literal>
</simpara>
</entry>
<entry>
<simpara>
    Which string distance implementation to use for comparing how similar
    suggested terms are. Five possible values can be specified:
    <literal>internal</literal> - The default based on damerau_levenshtein but highly optimized
    for comparing string distance for terms inside the index.
    <literal>damerau_levenshtein</literal> - String distance algorithm based on
    Damerau-Levenshtein algorithm.
    <literal>levenstein</literal> - String distance algorithm based on Levenstein edit distance
    algorithm.
    <literal>jarowinkler</literal> - String distance algorithm based on Jaro-Winkler algorithm.
    <literal>ngram</literal> - String distance algorithm based on character n-grams.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="search-suggesters-phrase">
<title>Phrase Suggester<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<note><simpara>In order to understand the format of suggestions, please
read the <xref linkend="search-suggesters"/> page first.</simpara></note>
<simpara>The <literal>term</literal> suggester provides a very convenient API to access word
alternatives on a per token basis within a certain string distance. The API
allows accessing each token in the stream individually while
suggest-selection is left to the API consumer. Yet, often pre-selected
suggestions are required in order to present to the end-user. The
<literal>phrase</literal> suggester adds additional logic on top of the <literal>term</literal> suggester
to select entire corrected phrases instead of individual tokens weighted
based on <literal>ngram-language</literal> models. In practice this suggester will be
able to make better decisions about which tokens to pick based on
co-occurrence and frequencies.</simpara>
<section id="_api_example">
<title>API Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<simpara>The <literal>phrase</literal> request is defined along side the query part in the json
request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_search' -d '{
  "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 1,
        "real_word_error_likelihood" : 0.95,
        "max_errors" : 0.5,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        } ],
        "highlight": {
          "pre_tag": "&lt;em&gt;",
          "post_tag": "&lt;/em&gt;"
        }
      }
    }
  }
}'</programlisting>
<simpara>The response contains suggestions scored by the most likely spell
correction first. In this case we received the expected correction
<literal>xorr the god jewel</literal> first while the second correction is less
conservative where only one of the errors is corrected. Note, the
request is executed with <literal>max_errors</literal> set to <literal>0.5</literal> so 50% of the terms
can contain misspellings (See parameter descriptions below).</simpara>
<programlisting language="js" linenumbering="unnumbered">  {
  "took" : 5,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 2938,
    "max_score" : 0.0,
    "hits" : [ ]
  },
  "suggest" : {
    "simple_phrase" : [ {
      "text" : "Xor the Got-Jewel",
      "offset" : 0,
      "length" : 17,
      "options" : [ {
        "text" : "xorr the god jewel",
        "highlighted": "&lt;em&gt;xorr&lt;/em&gt; the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.17877324
      }, {
        "text" : "xor the god jewel",
        "highlighted": "xor the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.14231323
      } ]
    } ]
  }
}</programlisting>
</section>
<section id="_basic_phrase_suggest_api_parameters">
<title>Basic Phrase suggest API parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>field</literal>
</simpara>
</entry>
<entry>
<simpara>
    the name of the field used to do n-gram lookups for the
    language model, the suggester will use this field to gain statistics to
    score corrections. This field is mandatory.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>gram_size</literal>
</simpara>
</entry>
<entry>
<simpara>
    sets max size of the n-grams (shingles) in the <literal>field</literal>.
    If the field doesn&#8217;t contain n-grams (shingles) this should be omitted
    or set to <literal>1</literal>. Note that Elasticsearch tries to detect the gram size
    based on the specified <literal>field</literal>. If the field uses a <literal>shingle</literal> filter the
    <literal>gram_size</literal> is set to the <literal>max_shingle_size</literal> if not explicitly set.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>real_word_error_likelihood</literal>
</simpara>
</entry>
<entry>
<simpara>
    the likelihood of a term being a
    misspelled even if the term exists in the dictionary. The default is
    <literal>0.95</literal> corresponding to 5% of the real words are misspelled.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>confidence</literal>
</simpara>
</entry>
<entry>
<simpara>
    The confidence level defines a factor applied to the
    input phrases score which is used as a threshold for other suggest
    candidates. Only candidates that score higher than the threshold will be
    included in the result. For instance a confidence level of <literal>1.0</literal> will
    only return suggestions that score higher than the input phrase. If set
    to <literal>0.0</literal> the top N candidates are returned. The default is <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_errors</literal>
</simpara>
</entry>
<entry>
<simpara>
    the maximum percentage of the terms that at most
    considered to be misspellings in order to form a correction. This method
    accepts a float value in the range <literal>[0..1)</literal> as a fraction of the actual
    query terms or a number <literal>&gt;=1</literal> as an absolute number of query terms. The
    default is set to <literal>1.0</literal> which corresponds to that only corrections with
    at most 1 misspelled term are returned.  Note that setting this too high
    can negatively impact performance. Low values like <literal>1</literal> or <literal>2</literal> are recommended
    otherwise the time spend in suggest calls might exceed the time spend in
    query execution.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>separator</literal>
</simpara>
</entry>
<entry>
<simpara>
    the separator that is used to separate terms in the
    bigram field. If not set the whitespace character is used as a
    separator.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>size</literal>
</simpara>
</entry>
<entry>
<simpara>
    the number of candidates that are generated for each
    individual query term Low numbers like <literal>3</literal> or <literal>5</literal> typically produce good
    results. Raising this can bring up terms with higher edit distances. The
    default is <literal>5</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyzer</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets the analyzer to analyse to suggest text with.
    Defaults to the search analyzer of the suggest field passed via <literal>field</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>shard_size</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets the maximum number of suggested term to be
    retrieved from each individual shard. During the reduce phase, only the
    top N suggestions are returned based on the <literal>size</literal> option. Defaults to
    <literal>5</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>text</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets the text / query to provide suggestions for.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>highlight</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets up suggestion highlighting.  If not provided then
    no <literal>highlighted</literal> field is returned.  If provided must
    contain exactly <literal>pre_tag</literal> and <literal>post_tag</literal> which are
    wrapped around the changed tokens.  If multiple tokens
    in a row are changed the entire phrase of changed tokens
    is wrapped rather than each token.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>collate</literal>
</simpara>
</entry>
<entry>
<simpara>
    Checks each suggestion against the specified <literal>query</literal> to prune suggestions
    for which no matching docs exist in the index. The collate query for a
    suggestion is run only on the local shard from which the suggestion has
    been generated from. The <literal>query</literal> must be specified, and it is run as
    a <link linkend="query-dsl-template-query"><literal>template</literal> query</link>.
    The current suggestion is automatically made available as the <literal>{{suggestion}}</literal>
    variable, which should be used in your query.  You can still specify
    your own template <literal>params</literal>&#8201;&#8212;&#8201;the <literal>suggestion</literal> value will be added to the
    variables you specify. Additionally, you can specify a <literal>prune</literal> to control
    if all phrase suggestions will be returned, when set to <literal>true</literal> the suggestions
    will have an additional option <literal>collate_match</literal>, which will be <literal>true</literal> if
    matching documents for the phrase was found, <literal>false</literal> otherwise.
    The default value for <literal>prune</literal> is <literal>false</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_search' -d {
   "suggest" : {
     "text" : "Xor the Got-Jewel",
     "simple_phrase" : {
       "phrase" : {
         "field" :  "bigram",
         "size" :   1,
         "direct_generator" : [ {
           "field" :            "body",
           "suggest_mode" :     "always",
           "min_word_length" :  1
         } ],
         "collate": {
           "query": { <co id="CO35-1"/>
             "inline" : {
               "match": {
                   "{{field_name}}" : "{{suggestion}}" <co id="CO35-2"/>
               }
             }
           },
           "params": {"field_name" : "title"}, <co id="CO35-3"/>
           "prune": true <co id="CO35-4"/>
         }
       }
     }
   }
 }</programlisting>
<calloutlist>
<callout arearefs="CO35-1">
<para>
This query will be run once for every suggestion.
</para>
</callout>
<callout arearefs="CO35-2">
<para>
The <literal>{{suggestion}}</literal> variable will be replaced by the text
    of each suggestion.
</para>
</callout>
<callout arearefs="CO35-3">
<para>
An additional <literal>field_name</literal> variable has been specified in
    <literal>params</literal> and is used by the <literal>match</literal> query.
</para>
</callout>
<callout arearefs="CO35-4">
<para>
All suggestions will be returned with an extra <literal>collate_match</literal>
    option indicating whether the generated phrase matched any
    document.
</para>
</callout>
</calloutlist>
</section>
<section id="_smoothing_models">
<title>Smoothing Models<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<simpara>The <literal>phrase</literal> suggester supports multiple smoothing models to balance
weight between infrequent grams (grams (shingles) are not existing in
the index) and frequent grams (appear at least once in the index).</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>stupid_backoff</literal>
</simpara>
</entry>
<entry>
<simpara>
    a simple backoff model that backs off to lower
    order n-gram models if the higher order count is <literal>0</literal> and discounts the
    lower order n-gram model by a constant factor. The default <literal>discount</literal> is
    <literal>0.4</literal>. Stupid Backoff is the default model.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>laplace</literal>
</simpara>
</entry>
<entry>
<simpara>
    a smoothing model that uses an additive smoothing where a
    constant (typically <literal>1.0</literal> or smaller) is added to all counts to balance
    weights, The default <literal>alpha</literal> is <literal>0.5</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>linear_interpolation</literal>
</simpara>
</entry>
<entry>
<simpara>
    a smoothing model that takes the weighted
    mean of the unigrams, bigrams and trigrams based on user supplied
    weights (lambdas). Linear Interpolation doesn&#8217;t have any default values.
    All parameters (<literal>trigram_lambda</literal>, <literal>bigram_lambda</literal>, <literal>unigram_lambda</literal>)
    must be supplied.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_candidate_generators">
<title>Candidate Generators<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<simpara>The <literal>phrase</literal> suggester uses candidate generators to produce a list of
possible terms per term in the given text. A single candidate generator
is similar to a <literal>term</literal> suggester called for each individual term in the
text. The output of the generators is subsequently scored in combination
with the candidates from the other terms to for suggestion candidates.</simpara>
<simpara>Currently only one type of candidate generator is supported, the
<literal>direct_generator</literal>. The Phrase suggest API accepts a list of generators
under the key <literal>direct_generator</literal> each of the generators in the list are
called per term in the original text.</simpara>
</section>
<section id="_direct_generators">
<title>Direct Generators<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/phrase-suggest.asciidoc">Edit me</ulink></title>
<simpara>The direct generators support the following parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>field</literal>
</simpara>
</entry>
<entry>
<simpara>
    The field to fetch the candidate suggestions from. This is
    a required option that either needs to be set globally or per
    suggestion.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>size</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum corrections to be returned per suggest text token.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>suggest_mode</literal>
</simpara>
</entry>
<entry>
<simpara>
    The suggest mode controls what suggestions are included on the suggestions
    generated on each shard. All values other than <literal>always</literal> can be thought of
    as an optimization to generate fewer suggestions to test on each shard and
    are not rechecked when combining the suggestions generated on each
    shard. Thus <literal>missing</literal> will generate suggestions for terms on shards that do
    not contain them even other shards do contain them. Those should be
    filtered out using <literal>confidence</literal>. Three possible values can be specified:
</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>missing</literal>: Only generate suggestions for terms that are not in the
                 shard. This is the default.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>popular</literal>: Only suggest terms that occur in more docs on the shard then
                 the original term.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>always</literal>: Suggest any matching suggestions based on terms in the
                 suggest text.
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_edits</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum edit distance candidate suggestions can have
    in order to be considered as a suggestion. Can only be a value between 1
    and 2. Any other value result in an bad request error being thrown.
    Defaults to 2.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>prefix_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings don&#8217;t
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_inspections</literal>
</simpara>
</entry>
<entry>
<simpara>
    A factor that is used to multiply with the
    <literal>shards_size</literal> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>pre_filter</literal>
</simpara>
</entry>
<entry>
<simpara>
    a filter (analyzer) that is applied to each of the
    tokens passed to this candidate generator. This filter is applied to the
    original token before candidates are generated.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>post_filter</literal>
</simpara>
</entry>
<entry>
<simpara>
    a filter (analyzer) that is applied to each of the
    generated tokens before they are passed to the actual phrase scorer.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The following example shows a <literal>phrase</literal> suggest call with two generators,
the first one is using a field containing ordinary indexed terms and the
second one uses a field that uses terms indexed with a <literal>reverse</literal> filter
(tokens are index in reverse order). This is used to overcome the limitation
of the direct generators to require a constant prefix to provide
high-performance suggestions. The <literal>pre_filter</literal> and <literal>post_filter</literal> options
accept ordinary analyzer names.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPOST 'localhost:9200/_search' -d {
 "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 4,
        "real_word_error_likelihood" : 0.95,
        "confidence" : 2.0,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        }, {
          "field" : "reverse",
          "suggest_mode" : "always",
          "min_word_length" : 1,
          "pre_filter" : "reverse",
          "post_filter" : "reverse"
        } ]
      }
    }
  }
}</programlisting>
<simpara><literal>pre_filter</literal> and <literal>post_filter</literal> can also be used to inject synonyms after
candidates are generated. For instance for the query <literal>captain usq</literal> we
might generate a candidate <literal>usa</literal> for term <literal>usq</literal> which is a synonym for
<literal>america</literal> which allows to present <literal>captain america</literal> to the user if this
phrase scores high enough.</simpara>
</section>
</section>
<section id="search-suggesters-completion">
<title>Completion Suggester<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<note><simpara>In order to understand the format of suggestions, please
read the <xref linkend="search-suggesters"/> page first.</simpara></note>
<simpara>The <literal>completion</literal> suggester is a so-called prefix suggester. It does not
do spell correction like the <literal>term</literal> or <literal>phrase</literal> suggesters but allows
basic <literal>auto-complete</literal> functionality.</simpara>
<section id="_why_another_suggester_why_not_prefix_queries">
<title>Why another suggester? Why not prefix queries?<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<simpara>The first question which comes to mind when reading about a prefix
suggestion is, why you should use it at all, if you have prefix queries
already. The answer is simple: Prefix suggestions are fast.</simpara>
<simpara>The data structures are internally backed by Lucenes
<literal>AnalyzingSuggester</literal>, which uses FSTs (finite state transducers) to
execute suggestions. Usually these data structures are costly to
create, stored in-memory and need to be rebuilt every now and then to
reflect changes in your indexed documents. The <literal>completion</literal> suggester
circumvents this by storing the FST (finite state transducer) as part
of your index during index time. This allows for really fast
loads and executions.</simpara>
</section>
<section id="completion-suggester-mapping">
<title>Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<simpara>In order to use this feature, you have to specify a special mapping for
this field, which enables the special storage of the field.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -X PUT localhost:9200/music
curl -X PUT localhost:9200/music/song/_mapping -d '{
  "song" : {
        "properties" : {
            "name" : { "type" : "string" },
            "suggest" : { "type" : "completion",
                          "analyzer" : "simple",
                          "search_analyzer" : "simple",
                          "payloads" : true
            }
        }
    }
}'</programlisting>
<simpara>Mapping supports the following parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>analyzer</literal>
</term>
<listitem>
<simpara>
    The index analyzer to use, defaults to <literal>simple</literal>.
    In case you are wondering why we did not opt for the <literal>standard</literal>
    analyzer: We try to have easy to understand behaviour here, and if you
    index the field content <literal>At the Drive-in</literal>, you will not get any
    suggestions for <literal>a</literal>, nor for <literal>d</literal> (the first non stopword).
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>search_analyzer</literal>
</term>
<listitem>
<simpara>
    The search analyzer to use, defaults to value of <literal>analyzer</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>payloads</literal>
</term>
<listitem>
<simpara>
    Enables the storing of payloads, defaults to <literal>false</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>preserve_separators</literal>
</term>
<listitem>
<simpara>
    Preserves the separators, defaults to <literal>true</literal>.
    If disabled, you could find a field starting with <literal>Foo Fighters</literal>, if you
    suggest for <literal>foof</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>preserve_position_increments</literal>
</term>
<listitem>
<simpara>
    Enables position increments, defaults
    to <literal>true</literal>. If disabled and using stopwords analyzer, you could get a
    field starting with <literal>The Beatles</literal>, if you suggest for <literal>b</literal>. <emphasis role="strong">Note</emphasis>: You
    could also achieve this by indexing two inputs, <literal>Beatles</literal> and
    <literal>The Beatles</literal>, no need to change a simple analyzer, if you are able to
    enrich your data.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>max_input_length</literal>
</term>
<listitem>
<simpara>
    Limits the length of a single input, defaults to <literal>50</literal> UTF-16 code points.
    This limit is only used at index time to reduce the total number of
    characters per input string in order to prevent massive inputs from
    bloating the underlying datastructure. The most usecases won&#8217;t be influenced
    by the default value since prefix completions hardly grow beyond prefixes longer
    than a handful of characters. (Old name "max_input_len" is deprecated)
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="indexing">
<title>Indexing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">curl -X PUT 'localhost:9200/music/song/1?refresh=true' -d '{
    "name" : "Nevermind",
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "output": "Nirvana - Nevermind",
        "payload" : { "artistId" : 2321 },
        "weight" : 34
    }
}'</programlisting>
<simpara>The following parameters are supported:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>input</literal>
</term>
<listitem>
<simpara>
    The input to store, this can be an array of strings or just
    a string. This field is mandatory.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>output</literal>
</term>
<listitem>
<simpara>
    The string to return, if a suggestion matches. This is very
    useful to normalize outputs (i.e. have them always in the format
    <literal>artist - songname</literal>). This is optional.
    <emphasis role="strong">Note</emphasis>: The result is de-duplicated if several documents
    have the same output, i.e. only one is returned as part of the
    suggest result.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>payload</literal>
</term>
<listitem>
<simpara>
    An arbitrary JSON object, which is simply returned in the
    suggest option. You could store data like the id of a document, in order
    to load it from elasticsearch without executing another search (which
    might not yield any results, if <literal>input</literal> and <literal>output</literal> differ strongly).
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>weight</literal>
</term>
<listitem>
<simpara>
    A positive integer or a string containing a positive integer,
    which defines a weight and allows you to rank your suggestions.
    This field is optional.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>Even though you will lose most of the features of the
completion suggest, you can choose to use the following shorthand form.
Keep in mind that you will not be able to use several inputs, an output,
payloads or weights. This form does still work inside of multi fields.</simpara></note>
<programlisting language="js" linenumbering="unnumbered">{
  "suggest" : "Nirvana"
}</programlisting>
<note><simpara>The suggest data structure might not reflect deletes on
documents immediately. You may need to do an <xref linkend="indices-optimize"/> for that.
You can call optimize with the <literal>only_expunge_deletes=true</literal> to only target
deletions for merging. By default <literal>only_expunge_deletes=true</literal> will only select
segments for merge where the percentage of deleted documents is greater than <literal>10%</literal> of
the number of document in that segment. To adjust this <literal>index.merge.policy.expunge_deletes_allowed</literal> can
be updated to a value between <literal>[0..100]</literal>. Please remember even with this option set, optimize
is considered a extremely heavy operation and should be called rarely.</simpara></note>
</section>
<section id="querying">
<title>Querying<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<simpara>Suggesting works as usual, except that you have to specify the suggest
type as <literal>completion</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest"
        }
    }
}'

{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "n",
    "offset" : 0,
    "length" : 1,
    "options" : [ {
      "text" : "Nirvana - Nevermind",
      "score" : 34.0, "payload" : {"artistId":2321}
    } ]
  } ]
}</programlisting>
<simpara>As you can see, the payload is included in the response, if configured
appropriately. If you configured a weight for a suggestion, this weight
is used as <literal>score</literal>. Also the <literal>text</literal> field uses the <literal>output</literal> of your
indexed suggestion, if configured, otherwise the matched part of the
<literal>input</literal> field.</simpara>
<simpara>The basic completion suggester query supports the following two parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>field</literal>
</term>
<listitem>
<simpara>
The name of the field on which to run the query (required).
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>size</literal>
</term>
<listitem>
<simpara>
The number of suggestions to return (defaults to <literal>5</literal>).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>The completion suggester considers all documents in the index.
See <xref linkend="suggester-context"/> for an explanation of how to query a subset of
documents instead.</simpara></note>
</section>
<section id="fuzzy">
<title>Fuzzy queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/completion-suggest.asciidoc">Edit me</ulink></title>
<simpara>The completion suggester also supports fuzzy queries - this means,
you can actually have a typo in your search and still get results back.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest",
            "fuzzy" : {
                "fuzziness" : 2
            }
        }
    }
}'</programlisting>
<simpara>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>fuzziness</literal>
</simpara>
</entry>
<entry>
<simpara>
    The fuzziness factor, defaults to <literal>AUTO</literal>.
    See  <xref linkend="fuzziness"/> for allowed settings.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>transpositions</literal>
</simpara>
</entry>
<entry>
<simpara>
    if set to <literal>true</literal>, transpositions are counted
    as one change instead of two, defaults to <literal>true</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    Minimum length of the input before fuzzy
    suggestions are returned, defaults <literal>3</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>prefix_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    Minimum length of the input, which is not
    checked for fuzzy alternatives, defaults to <literal>1</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>unicode_aware</literal>
</simpara>
</entry>
<entry>
<simpara>
    Sets all are measurements (like edit distance,
    transpositions and lengths) in unicode code points
    (actual letters) instead of bytes.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<note><simpara>If you want to stick with the default values, but
      still use fuzzy, you can either use <literal>fuzzy: {}</literal>
      or <literal>fuzzy: true</literal>.</simpara></note>
</section>
</section>
<section id="suggester-context">
<title>Context Suggester<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></title>
<simpara>The context suggester is an extension to the suggest API of Elasticsearch. Namely the
suggester system provides a very fast way of searching documents by handling these
entirely in memory. But this special treatment does not allow the handling of
traditional queries and filters, because those would have notable impact on the
performance. So the context extension is designed to take so-called context information
into account to specify a more accurate way of searching within the suggester system.
Instead of using the traditional query and filter system a predefined ``context`` is
configured to limit suggestions to a particular subset of suggestions.
Such a context is defined by a set of context mappings which can either be a simple
<emphasis role="strong">category</emphasis> or a <emphasis role="strong">geo location</emphasis>. The information used by the context suggester is
configured in the type mapping with the <literal>context</literal> parameter, which lists all of the
contexts that need to be specified in each document and in each suggestion request.
For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT services/_mapping/service
{
    "service": {
        "properties": {
            "name": {
                "type" : "string"
            },
            "tag": {
                "type" : "string"
            },
            "suggest_field": {
                "type": "completion",
                "context": {
                    "color": { <co id="CO36-1"/>
                        "type": "category",
                        "path": "color_field",
                        "default": ["red", "green", "blue"]
                    },
                    "location": { <co id="CO36-2"/>
                        "type": "geo",
                        "precision": "5m",
                        "neighbors": true,
                        "default": "u33"
                    }
            }
        }
    }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO36-1">
<para>
See <xref linkend="suggester-context-category"/>
</para>
</callout>
<callout arearefs="CO36-2">
<para>
See <xref linkend="suggester-context-geo"/>
</para>
</callout>
</calloutlist>
<simpara>However contexts are specified (as type <literal>category</literal> or <literal>geo</literal>, which are discussed below), each
context value generates a new sub-set of documents which can be queried by the completion
suggester. Both types accept a <literal>default</literal> parameter which provides a default value to use
if the corresponding context value is absent.</simpara>
<simpara>The basic structure of this element is that each field forms a new context and the fieldname
is used to reference this context information later on during indexing or querying. All context
mappings have the <literal>default</literal> and the <literal>type</literal> option in common. The value of the <literal>default</literal> field
is used, when ever no specific is provided for the certain context. Note that a context is
defined by at least one value. The <literal>type</literal> option defines the kind of information hold by this
context. These type will be explained further in the following sections.</simpara>
<bridgehead id="suggester-context-category" renderas="sect3">Category Context<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>category</literal> context allows you to specify one or more categories in the document at index time.
The document will be assigned to each named category, which can then be queried later. The category
type also allows to specify a field to extract the categories from. The <literal>path</literal> parameter is used to
specify this field of the documents that should be used. If the referenced field contains multiple
values, all these values will be used as alternative categories.</simpara>
<bridgehead id="_category_mapping" renderas="sect4">Category Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>The mapping for a category is simply defined by its <literal>default</literal> values. These can either be
defined as list of <emphasis role="strong">default</emphasis> categories:</simpara>
<programlisting language="js" linenumbering="unnumbered">"context": {
    "color": {
        "type": "category",
        "default": ["red", "orange"]
    }
}</programlisting>
<simpara>or as a single value</simpara>
<programlisting language="js" linenumbering="unnumbered">"context": {
    "color": {
        "type": "category",
        "default": "red"
    }
}</programlisting>
<simpara>or as reference to another field within the documents indexed:</simpara>
<programlisting language="js" linenumbering="unnumbered">"context": {
    "color": {
        "type": "category",
        "default": "red",
        "path": "color_field"
    }
}</programlisting>
<simpara>in this case the <emphasis role="strong">default</emphasis> categories will only be used, if the given field does not
exist within the document. In the example above the categories are received from a
field named <literal>color_field</literal>. If this field does not exist a category <emphasis role="strong">red</emphasis> is assumed for
the context <emphasis role="strong">color</emphasis>.</simpara>
<bridgehead id="_indexing_category_contexts" renderas="sect4">Indexing category contexts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>Within a document the category is specified either as an <literal>array</literal> of values, a
single value or <literal>null</literal>. A list of values is interpreted as alternative categories. So
a document belongs to all the categories defined. If the category is <literal>null</literal> or remains
unset the categories will be retrieved from the documents field addressed by the <literal>path</literal>
parameter. If this value is not set or the field is missing, the default values of the
mapping will be assigned to the context.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT services/service/1
{
    "name": "knapsack",
    "suggest_field": {
        "input": ["knacksack", "backpack", "daypack"],
        "context": {
            "color": ["red", "yellow"]
            }
        }
}</programlisting>
<bridgehead id="_category_query" renderas="sect4">Category Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>A query within a category works similar to the configuration. If the value is <literal>null</literal>
the mappings default categories will be used. Otherwise the suggestion takes place
for all documents that have at least one category in common with the query.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST services/_suggest?pretty'
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "color": "red"
            }
        }
    }
}</programlisting>
<bridgehead id="suggester-context-geo" renderas="sect3">Geo location Context<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>A <literal>geo</literal> context allows you to limit results to those that lie within a certain distance
of a specified geolocation. At index time, a lat/long geo point is converted into a
geohash of a certain precision, which provides the context.</simpara>
<bridgehead id="_geo_location_mapping" renderas="sect4">Geo location Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>The mapping for a geo context accepts four settings, only of which <literal>precision</literal> is required:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>precision</literal>
</simpara>
</entry>
<entry>
<simpara>
This defines the precision of the geohash and can be specified as <literal>5m</literal>, <literal>10km</literal>,
               or as a raw geohash precision: <literal>1</literal>..<literal>12</literal>. It&#8217;s also possible to setup multiple
               precisions by defining a list of precisions: <literal>["5m", "10km"]</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>neighbors</literal>
</simpara>
</entry>
<entry>
<simpara>
Geohashes are rectangles, so a geolocation, which in reality is only 1 metre
               away from the specified point, may fall into the neighbouring rectangle. Set
               <literal>neighbours</literal> to <literal>true</literal> to include the neighbouring geohashes in the context.
               (default is <emphasis role="strong">on</emphasis>)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>path</literal>
</simpara>
</entry>
<entry>
<simpara>
Optionally specify a field to use to look up the geopoint.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>default</literal>
</simpara>
</entry>
<entry>
<simpara>
The geopoint to use if no geopoint has been specified.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Since all locations of this mapping are translated into geohashes, each location matches
a geohash cell. So some results that lie within the specified range but not in the same
cell as the query location will not match. To avoid this the <literal>neighbors</literal> option allows a
matching of cells that join the bordering regions of the documents location. This option
is turned on by default.
If a document or a query doesn&#8217;t define a location a value to use instead can defined by
the <literal>default</literal> option. The value of this option supports all the ways a <literal>geo_point</literal> can be
defined. The <literal>path</literal> refers to another field within the document to retrieve the
location. If this field contains multiple values, the document will be linked to all these
locations.</simpara>
<programlisting language="js" linenumbering="unnumbered">"context": {
    "location": {
        "type": "geo",
        "precision": ["1km", "5m"],
        "neighbors": true,
        "path": "pin",
        "default": {
            "lat": 0.0,
            "lon": 0.0
    }
    }
}</programlisting>
<bridgehead id="_geo_location_config" renderas="sect4">Geo location Config<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>Within a document a geo location retrieved from the mapping definition can be overridden
by another location. In this case the context mapped to a geo location supports all
variants of defining a <literal>geo_point</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT services/service/1
{
    "name": "some hotel 1",
    "suggest_field": {
        "input": ["my hotel", "this hotel"],
        "context": {
            "location": {
                    "lat": 0,
                    "lon": 0
        "contexts": [
            "location": [
                {
                    "lat": 43.6624803,
                    "lon": -79.3863353
                },
                {
                    "lat": 43.6624718,
                    "lon": -79.3873227
                }
        }
    }
}</programlisting>
<bridgehead id="_geo_location_query" renderas="sect4">Geo location Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/suggesters/context-suggest.asciidoc">Edit me</ulink></bridgehead>
<simpara>Like in the configuration, querying with a geo location in context, the geo location
query supports all representations of a <literal>geo_point</literal> to define the location. In this
simple case all precision values defined in the mapping will be applied to the given
location.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "contexts": {
                "location": {
                    "lat": 0,
                    "lon": 0
                }
            }
        }
    }
}</programlisting>
<simpara>But it also possible to set a subset of the precisions set in the mapping, by using the
<literal>precision</literal> parameter. Like in the mapping, this parameter is allowed to be set to a
single precision value or a list of these.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
                        "context": {
                "location": {
                    "value": {
                        "lat": 0,
                        "lon": 0
                        },
                    "precision": "1km"
                    }
            }
        }
    }
}</programlisting>
<simpara>A special form of the query is defined by an extension of the object representation of
the <literal>geo_point</literal>. Using this representation allows to set the <literal>precision</literal> parameter within
the location itself:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                        "lat": 0,
                        "lon": 0,
                        "precision": "1km"
                }
            }
        }
    }
}</programlisting>
</section>
</chapter>
<chapter id="search-multi-search">
<title>Multi Search API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/multi-search.asciidoc">Edit me</ulink></title>
<simpara>The multi search API allows to execute several search requests within
the same API. The endpoint for it is <literal>_msearch</literal>.</simpara>
<simpara>The format of the request is similar to the bulk API format, and the
structure is as follows (the structure is specifically optimized to
reduce parsing if a specific search ends up redirected to another node):</simpara>
<programlisting language="js" linenumbering="unnumbered">header\n
body\n
header\n
body\n</programlisting>
<simpara>The header part includes which index / indices to search on, optional
(mapping) types to search on, the <literal>search_type</literal>, <literal>preference</literal>, and
<literal>routing</literal>. The body includes the typical search body request (including
the <literal>query</literal>, <literal>aggregations</literal>, <literal>from</literal>, <literal>size</literal>, and so on). Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "dfs_query_then_fetch"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/_msearch --data-binary "@requests"; echo</programlisting>
<simpara>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</simpara>
<simpara>The response returns a <literal>responses</literal> array, which includes the search
response for each search request matching its order in the original
multi search request. If there was a complete failure for that specific
search request, an object with <literal>error</literal> message will be returned in place
of the actual search response.</simpara>
<simpara>The endpoint allows to also search against an index/indices and
type/types in the URI itself, in which case it will be used as the
default unless explicitly defined otherwise in the header. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ cat requests
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "test2"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/test/_msearch --data-binary @requests; echo</programlisting>
<simpara>The above will execute the search against the <literal>test</literal> index for all the
requests that don&#8217;t define an index, and the last one will be executed
against the <literal>test2</literal> index.</simpara>
<simpara>The <literal>search_type</literal> can be set in a similar manner to globally apply to
all search requests.</simpara>
<bridgehead id="msearch-security" renderas="sect2">Security<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/multi-search.asciidoc">Edit me</ulink></bridgehead>
<simpara>See <xref linkend="url-access-control"/></simpara>
</chapter>
<chapter id="search-count">
<title>Count API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></title>
<simpara>The count API allows to easily execute a query and get the number of
matches for that query. It can be executed across one or more indices
and across one or more types. The query can either be provided using a
simple query string as a parameter, or using the
<link linkend="query-dsl">Query DSL</link> defined within the request
body. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=user:kimchy'

$ curl -XGET 'http://localhost:9200/twitter/tweet/_count' -d '
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}'</programlisting>
<note><simpara>The query being sent in the body must be nested in a <literal>query</literal> key, same as
the <link linkend="search-search">search api</link> works</simpara></note>
<simpara>Both examples above do the same thing, which is count the number of
tweets from the twitter index for a certain user. The result is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "count" : 1,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    }
}</programlisting>
<simpara>The query is optional, and when not provided, it will use <literal>match_all</literal> to
count all the docs.</simpara>
<bridgehead id="_multi_index_multi_type" renderas="sect2">Multi index, Multi type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></bridgehead>
<simpara>The count API can be applied to <link linkend="search-multi-index-type">multiple types in multiple indices</link>.</simpara>
<bridgehead id="_request_parameters" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></bridgehead>
<simpara>When executing count using the query parameter <literal>q</literal>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>df</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default field to use when no field prefix is defined within the
query.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer name to be used when analyzing the query string.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator to be used, can be <literal>AND</literal> or
<literal>OR</literal>. Defaults to <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should terms be automatically lowercased or
not. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should wildcard and prefix queries be analyzed or
not. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>terminate_after</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum count for each shard, upon
reaching which the query execution will terminate early.
If set, the response will have a boolean field <literal>terminated_early</literal> to
indicate whether the query execution has actually terminated_early.
Defaults to no terminate_after.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_request_body" renderas="sect2">Request Body<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></bridgehead>
<simpara>The count can use the <link linkend="query-dsl">Query DSL</link> within
its body in order to express the query that should be executed. The body
content can also be passed as a REST parameter named <literal>source</literal>.</simpara>
<simpara>Both HTTP GET and HTTP POST can be used to execute count with body.
Since not all clients support GET with body, POST is allowed as well.</simpara>
<bridgehead id="_distributed" renderas="sect2">Distributed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></bridgehead>
<simpara>The count operation is broadcast across all shards. For each shard id
group, a replica is chosen and executed against it. This means that
replicas increase the scalability of count.</simpara>
<bridgehead id="_routing" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/count.asciidoc">Edit me</ulink></bridgehead>
<simpara>The routing value (a comma separated list of the routing values) can be
specified to control which shards the count request will be executed on.</simpara>
</chapter>
<chapter id="search-exists">
<title>Search Exists API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.1.0"><title>Deprecated in 2.1.0.</title><simpara> use regular <literal>_search</literal> with <literal>size</literal> set to <literal>0</literal> and <literal>terminate_after</literal> set to <literal>1</literal> instead.</simpara></warning>
<simpara>The exists API allows to easily determine if any
matching documents exist for a provided query. It can be executed across one or more indices
and across one or more types. The query can either be provided using a
simple query string as a parameter, or using the
<link linkend="query-dsl">Query DSL</link> defined within the request
body. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search/exists?q=user:kimchy'

$ curl -XGET 'http://localhost:9200/twitter/tweet/_search/exists' -d '
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}'</programlisting>
<note><simpara>The query being sent in the body must be nested in a <literal>query</literal> key, same as
how the <link linkend="search-search">search api</link> works.</simpara></note>
<simpara>Both the examples above do the same thing, which is determine the existence of
tweets from the twitter index for a certain user. The response body will be of
the following format:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "exists" : true
}</programlisting>
<bridgehead id="_multi_index_multi_type_2" renderas="sect2">Multi index, Multi type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></bridgehead>
<simpara>The exists API can be applied to <link linkend="search-multi-index-type">multiple types in multiple indices</link>.</simpara>
<bridgehead id="_request_parameters_2" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></bridgehead>
<simpara>When executing exists using the query parameter <literal>q</literal>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>df</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default field to use when no field prefix is defined within the
query.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer name to be used when analyzing the query string.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator to be used, can be <literal>AND</literal> or
<literal>OR</literal>. Defaults to <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should terms be automatically lowercased or
not. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should wildcard and prefix queries be analyzed or
not. Defaults to <literal>false</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_request_body_2" renderas="sect2">Request Body<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></bridgehead>
<simpara>The exists API can use the <link linkend="query-dsl">Query DSL</link> within
its body in order to express the query that should be executed. The body
content can also be passed as a REST parameter named <literal>source</literal>.</simpara>
<simpara>HTTP GET and HTTP POST can be used to execute exists with body.
Since not all clients support GET with body, POST is allowed as well.</simpara>
<bridgehead id="_distributed_2" renderas="sect2">Distributed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></bridgehead>
<simpara>The exists operation is broadcast across all shards. For each shard id
group, a replica is chosen and executed against it. This means that
replicas increase the scalability of exists. The exists operation also
early terminates shard requests once the first shard reports matched
document existence.</simpara>
<bridgehead id="_routing_2" renderas="sect2">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/exists.asciidoc">Edit me</ulink></bridgehead>
<simpara>The routing value (a comma separated list of the routing values) can be
specified to control which shards the exists request will be executed on.</simpara>
</chapter>
<chapter id="search-validate">
<title>Validate API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/validate.asciidoc">Edit me</ulink></title>
<simpara>The validate API allows a user to validate a potentially expensive query
without executing it. The following example shows how it can be used:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</programlisting>
<simpara>When the query is valid, the response contains <literal>valid:true</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/_validate/query?q=user:foo'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</programlisting>
<bridgehead id="_request_parameters_3" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/validate.asciidoc">Edit me</ulink></bridgehead>
<simpara>When executing exists using the query parameter <literal>q</literal>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>df</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default field to use when no field prefix is defined within the
query.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer name to be used when analyzing the query string.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator to be used, can be <literal>AND</literal> or
<literal>OR</literal>. Defaults to <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should terms be automatically lowercased or
not. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should wildcard and prefix queries be analyzed or
not. Defaults to <literal>false</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Or, with a request body:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query' -d '{
  "query" : {
    "bool" : {
      "must" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user" : "kimchy" }
      }
    }
  }
}'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</programlisting>
<note><simpara>The query being sent in the body must be nested in a <literal>query</literal> key, same as
the <link linkend="search-search">search api</link> works</simpara></note>
<simpara>If the query is invalid, <literal>valid</literal> will be <literal>false</literal>. Here the query is
invalid because Elasticsearch knows the post_date field should be a date
due to dynamic mapping, and <emphasis>foo</emphasis> does not correctly parse into a date:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo'
{"valid":false,"_shards":{"total":1,"successful":1,"failed":0}}</programlisting>
<simpara>An <literal>explain</literal> parameter can be specified to get more detailed information
about why a query failed:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo&amp;pretty=true&amp;explain=true'
{
  "valid" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "failed" : 0
  },
  "explanations" : [ {
    "index" : "twitter",
    "valid" : false,
    "error" : "[twitter] QueryParsingException[Failed to parse]; nested: IllegalArgumentException[Invalid format: \"foo\"];; java.lang.IllegalArgumentException: Invalid format: \"foo\""
  } ]
}</programlisting>
<simpara>When the query is valid, the explanation defaults to the string
representation of that query. With <literal>rewrite</literal> set to <literal>true</literal>, the explanation
is more detailed showing the actual Lucene query that will be executed.</simpara>
<simpara>For Fuzzy Queries:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/imdb/movies/_validate/query?rewrite=true' -d '
{
  "query": {
    "fuzzy": {
      "actors": "kyle"
    }
  }
}'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "imdb",
         "valid": true,
         "explanation": "plot:kyle plot:kylie^0.75 plot:kyne^0.75 plot:lyle^0.75 plot:pyle^0.75 #_type:movies"
      }
   ]
}</programlisting>
<simpara>For More Like This:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/imdb/movies/_validate/query?rewrite=true'
{
  "query": {
    "more_like_this": {
      "like": {
        "_id": "88247"
      },
      "boost_terms": 1
    }
  }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "imdb",
         "valid": true,
         "explanation": "((title:terminator^3.71334 plot:future^2.763601 plot:human^2.8415773 plot:sarah^3.4193945 plot:kyle^3.8244398 plot:cyborg^3.9177752 plot:connor^4.040236 plot:reese^4.7133346 ... )~6) -ConstantScore(_uid:movies#88247) #_type:movies"
      }
   ]
}</programlisting>
<caution><simpara>The request is executed on a single shard only, which is randomly
selected. The detailed explanation of the query may depend on which shard is
being hit, and therefore may vary from one request to another.</simpara></caution>
</chapter>
<chapter id="search-explain">
<title>Explain API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/explain.asciidoc">Edit me</ulink></title>
<simpara>The explain api computes a score explanation for a query and a specific
document. This can give useful feedback whether a document matches or
didn&#8217;t match a specific query.</simpara>
<simpara>The <literal>index</literal> and <literal>type</literal> parameters expect a single index and a single
type respectively.</simpara>
<bridgehead id="_usage_2" renderas="sect2">Usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/explain.asciidoc">Edit me</ulink></bridgehead>
<simpara>Full query example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/tweet/1/_explain' -d '{
      "query" : {
        "term" : { "message" : "search" }
      }
}'</programlisting>
<simpara>This will yield the following result:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "matches" : true,
  "explanation" : {
    "value" : 0.15342641,
    "description" : "fieldWeight(message:search in 0), product of:",
    "details" : [ {
      "value" : 1.0,
      "description" : "tf(termFreq(message:search)=1)"
    }, {
      "value" : 0.30685282,
      "description" : "idf(docFreq=1, maxDocs=1)"
    }, {
      "value" : 0.5,
      "description" : "fieldNorm(field=message, doc=0)"
    } ]
  }
}</programlisting>
<simpara>There is also a simpler way of specifying the query via the <literal>q</literal>
parameter. The specified <literal>q</literal> parameter value is then parsed as if the
<literal>query_string</literal> query was used. Example usage of the <literal>q</literal> parameter in the
explain api:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/tweet/1/_explain?q=message:search'</programlisting>
<simpara>This will yield the same result as the previous request.</simpara>
<bridgehead id="_all_parameters_2" renderas="sect2">All parameters:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/explain.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_source</literal>
</simpara>
</entry>
<entry>
<simpara>
    Set to <literal>true</literal> to retrieve the <literal>_source</literal> of the document explained. You can also
    retrieve part of the document by using <literal>_source_include</literal> &amp; <literal>_source_exclude</literal> (see <link linkend="get-source-filtering">Get API</link> for more details)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fields</literal>
</simpara>
</entry>
<entry>
<simpara>
    Allows to control which stored fields to return as part of the
    document explained.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>routing</literal>
</simpara>
</entry>
<entry>
<simpara>
    Controls the routing in the case the routing was used
    during indexing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>parent</literal>
</simpara>
</entry>
<entry>
<simpara>
    Same effect as setting the routing parameter.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>preference</literal>
</simpara>
</entry>
<entry>
<simpara>
    Controls on which shard the explain is executed.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>source</literal>
</simpara>
</entry>
<entry>
<simpara>
    Allows the data of the request to be put in the query
    string of the url.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>q</literal>
</simpara>
</entry>
<entry>
<simpara>
    The query string (maps to the query_string query).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>df</literal>
</simpara>
</entry>
<entry>
<simpara>
    The default field to use when no field prefix is defined within
    the query. Defaults to _all field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyzer</literal>
</simpara>
</entry>
<entry>
<simpara>
    The analyzer name to be used when analyzing the query
    string. Defaults to the analyzer of the _all field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyze_wildcard</literal>
</simpara>
</entry>
<entry>
<simpara>
    Should wildcard and prefix queries be analyzed or
    not. Defaults to false.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lowercase_expanded_terms</literal>
</simpara>
</entry>
<entry>
<simpara>
    Should terms be automatically lowercased
    or not. Defaults to true.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lenient</literal>
</simpara>
</entry>
<entry>
<simpara>
    If set to true will cause format based failures (like
    providing text to a numeric field) to be ignored. Defaults to false.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>default_operator</literal>
</simpara>
</entry>
<entry>
<simpara>
    The default operator to be used, can be AND or
    OR. Defaults to OR.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
<chapter id="search-profile">
<title>Profile API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>The Profile API provides detailed timing information about the execution of individual components
in a query.  It gives the user insight into how queries are executed at a low level so that
the user can understand why certain queries are slow, and take steps to improve their slow queries.</simpara>
<simpara>The output from the Profile API is <emphasis role="strong">very</emphasis> verbose, especially for complicated queries executed across
many shards. Pretty-printing the response is recommended to help understand the output</simpara>
<note>
<simpara>The details provided by the Profile API directly expose Lucene class names and concepts, which means
that complete interpretation of the results require fairly advanced knowledge of Lucene.  This
page attempts to give a crash-course in how Lucene executes queries so that you can use the Profile API to successfully
diagnose and debug queries, but it is only an overview.  For complete understanding, please refer
to Lucene&#8217;s documentation and, in places, the code.</simpara>
<simpara>With that said, a complete understanding is often not required to fix a slow query.  It is usually
sufficient to see that a particular component of a query is slow, and not necessarily understand why
the <literal>advance</literal> phase of that query is the cause, for example.</simpara>
</note>
<bridgehead id="_usage_3" renderas="sect2">Usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></bridgehead>
<simpara>Any <literal>_search</literal> request can be profiled by adding a top-level <literal>profile</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_search' -d '{
  "profile": true,<co id="CO37-1"/>
  "query" : {
    "match" : { "message" : "search test" }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO37-1">
<para>
Setting the top-level <literal>profile</literal> parameter to <literal>true</literal> will enable profiling
for the search
</para>
</callout>
</calloutlist>
<simpara>This will yield the following result:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "took": 25,
   "timed_out": false,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "hits": {
      "total": 1,
      "max_score": 1,
      "hits": [ ... ] <co id="CO38-1"/>
   },
   "profile": {
     "shards": [
        {
           "id": "[htuC6YnSSSmKFq5UBt0YMA][test][0]",
           "searches": [
              {
                 "query": [
                    {
                       "query_type": "BooleanQuery",
                       "lucene": "message:search message:test",
                       "time": "15.52889800ms",
                       "breakdown": {
                          "score": 0,
                          "next_doc": 24495,
                          "match": 0,
                          "create_weight": 8488388,
                          "build_scorer": 7016015,
                          "advance": 0
                       },
                       "children": [
                          {
                             "query_type": "TermQuery",
                             "lucene": "message:search",
                             "time": "4.938855000ms",
                             "breakdown": {
                                "score": 0,
                                "next_doc": 18332,
                                "match": 0,
                                "create_weight": 2945570,
                                "build_scorer": 1974953,
                                "advance": 0
                             }
                          },
                          {
                             "query_type": "TermQuery",
                             "lucene": "message:test",
                             "time": "0.5016660000ms",
                             "breakdown": {
                                "score": 0,
                                "next_doc": 0,
                                "match": 0,
                                "create_weight": 170534,
                                "build_scorer": 331132,
                                "advance": 0
                             }
                          }
                       ]
                    }
                 ],
                 "rewrite_time": 185002,
                 "collector": [
                    {
                       "name": "SimpleTopScoreDocCollector",
                       "reason": "search_top_hits",
                       "time": "2.206529000ms"
                    }
                 ]
              }
           ]
        }
     ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO38-1">
<para>
Search results are returned, but were omitted here for brevity
</para>
</callout>
</calloutlist>
<simpara>Even for a simple query, the response is relatively complicated.  Let&#8217;s break it down piece-by-piece before moving
to more complex examples.</simpara>
<simpara>First, the overall structure of the profile response is as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "profile": {
        "shards": [
           {
              "id": "[htuC6YnSSSmKFq5UBt0YMA][test][0]",  <co id="CO39-1"/>
              "searches": [
                 {
                    "query": [...],             <co id="CO39-2"/>
                    "rewrite_time": 185002,     <co id="CO39-3"/>
                    "collector": [...]          <co id="CO39-4"/>
                 }
              ]
           }
        ]
     }
}</programlisting>
<calloutlist>
<callout arearefs="CO39-1">
<para>
A profile is returned for each shard that participated in the response, and is identified
by a unique ID
</para>
</callout>
<callout arearefs="CO39-2">
<para>
Each profile contains a section which holds details about the query execution
</para>
</callout>
<callout arearefs="CO39-3">
<para>
Each profile has a single time representing the cumulative rewrite time
</para>
</callout>
<callout arearefs="CO39-4">
<para>
Each profile also contains a section about the Lucene Collectors which run the search
</para>
</callout>
</calloutlist>
<simpara>Because a search request may be executed against one or more shards in an index, and a search may cover
one or more indices, the top level element in the profile response is an array of <literal>shard</literal> objects.
Each shard object lists it&#8217;s <literal>id</literal> which uniquely identifies the shard.  The ID&#8217;s format is
<literal>[nodeID][indexName][shardID]</literal>.</simpara>
<simpara>The profile itself may consist of one or more "searches", where a search is a query executed against the underlying
Lucene index.  Most Search Requests submitted by the user will only execute a single <literal>search</literal> against the Lucene index.
But occasionally multiple searches will be executed, such as including a global aggregation (which needs to execute
a secondary "match_all" query for the global context).</simpara>
<simpara>Inside each <literal>search</literal> object there will be two arrays of profiled information:
a <literal>query</literal> array and a <literal>collector</literal> array.  In the future, more sections may be added, such as <literal>suggest</literal>, <literal>highlight</literal>,
<literal>aggregations</literal>, etc</simpara>
<simpara>There will also be a <literal>rewrite</literal> metric showing the total time spent rewriting the query (in nanoseconds).</simpara>
<section id="_literal_query_literal_section">
<title><literal>query</literal> Section<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>The <literal>query</literal> section contains detailed timing of the query tree executed by Lucene on a particular shard.
The overall structure of this query tree will resemble your original Elasticsearch query, but may be slightly
(or sometimes very) different.  It will also use similar but not always identical naming.  Using our previous
<literal>term</literal> query example, let&#8217;s analyze the <literal>query</literal> section:</simpara>
<programlisting language="js" linenumbering="unnumbered">"query": [
    {
       "query_type": "BooleanQuery",
       "lucene": "message:search message:test",
       "time": "15.52889800ms",
       "breakdown": {...},               <co id="CO40-1"/>
       "children": [
          {
             "query_type": "TermQuery",
             "lucene": "message:search",
             "time": "4.938855000ms",
             "breakdown": {...}
          },
          {
             "query_type": "TermQuery",
             "lucene": "message:test",
             "time": "0.5016660000ms",
             "breakdown": {...}
          }
       ]
    }
]</programlisting>
<calloutlist>
<callout arearefs="CO40-1">
<para>
The breakdown timings are omitted for simplicity
</para>
</callout>
</calloutlist>
<simpara>Based on the profile structure, we can see that our <literal>match</literal> query was rewritten by Lucene into a BooleanQuery with two
clauses (both holding a TermQuery).  The <literal>"query_type"</literal> field displays the Lucene class name, and often aligns with
the equivalent name in Elasticsearch.  The <literal>"lucene"</literal> field displays the Lucene explanation text for the query, and
is made available to help differentiating between parts of your query (e.g. both <literal>"message:search"</literal> and <literal>"message:test"</literal>
are TermQuery&#8217;s and would appear identical otherwise.</simpara>
<simpara>The <literal>"time"</literal> field shows that this query took ~15ms for the entire BooleanQuery to execute.  The recorded time is inclusive
of all children.</simpara>
<simpara>The <literal>"breakdown"</literal> field will give detailed stats about how the time was spent, we&#8217;ll look at
that in a moment.  Finally, the <literal>"children"</literal> array lists any sub-queries that may be present.  Because we searched for two
values ("search test"), our BooleanQuery holds two children TermQueries.  They have identical information (query_type, time,
breakdown, etc).  Children are allowed to have their own children.</simpara>
<section id="_timing_breakdown">
<title>Timing Breakdown<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>The <literal>breakdown</literal> component lists detailed timing statistics about low-level Lucene execution:</simpara>
<programlisting language="js" linenumbering="unnumbered">"breakdown": {
  "score": 0,
  "next_doc": 24495,
  "match": 0,
  "create_weight": 8488388,
  "build_scorer": 7016015,
  "advance": 0

}</programlisting>
<simpara>Timings are listed in wall-clock nanoseconds and are not normalized at all.  All caveats about the overall
<literal>time</literal> apply here.  The intention of the breakdown is to give you a feel for A) what machinery in Lucene is
actually eating time, and B) the magnitude of differences in times between the various components.  Like the overall time,
the breakdown is inclusive of all children times.</simpara>
<simpara>The meaning of the stats are as follows:</simpara>
<bridgehead id="_all_parameters_3" renderas="sect2">All parameters:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>create_weight</literal>
</simpara>
</entry>
<entry>
<simpara>
    A Query in Lucene must be capable of reuse across multiple IndexSearchers (think of it as the engine that
    executes a search against a specific Lucene Index).  This puts Lucene in a tricky spot, since many queries
    need to accumulate temporary state/statistics associated with the index it is being used against, but the
    Query contract mandates that it must be immutable.
    <?asciidoc-br?>
    <?asciidoc-br?>
    To get around this, Lucene asks each query to generate a Weight object which acts as a temporary context
    object to hold state associated with this particular (IndexSearcher, Query) tuple.  The <literal>weight</literal> metric
    shows how long this process takes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>build_scorer</literal>
</simpara>
</entry>
<entry>
<simpara>
    This parameter shows how long it takes to build a Scorer for the query.  A Scorer is the mechanism that
    iterates over matching documents generates a score per-document (e.g. how well does "foo" match the document?).
    Note, this records the time required to generate the Scorer object, not actually score the documents.  Some
    queries have faster or slower initialization of the Scorer, depending on optimizations, complexity, etc.
    <?asciidoc-br?>
    <?asciidoc-br?>
    This may also showing timing associated with caching, if enabled and/or applicable for the query
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>next_doc</literal>
</simpara>
</entry>
<entry>
<simpara>
    The Lucene method <literal>next_doc</literal> returns Doc ID of the next document matching the query.  This statistic shows
    the time it takes to determine which document is the next match, a process that varies considerably depending
    on the nature of the query.   Next_doc is a specialized form of advance() which is more convenient for many
    queries in Lucene.  It is equivalent to advance(docId() + 1)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>advance</literal>
</simpara>
</entry>
<entry>
<simpara>
    <literal>advance</literal> is the "lower level" version of next_doc: it serves the same purpose of finding the next matching
    doc, but requires the calling query to perform extra tasks such as identifying and moving past skips, etc.
    However,  not all queries can use next_doc, so <literal>advance</literal> is also timed for those queries.
    <?asciidoc-br?>
    <?asciidoc-br?>
    Conjunctions (e.g. <literal>must</literal> clauses in a boolean) are typical consumers of <literal>advance</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>matches</literal>
</simpara>
</entry>
<entry>
<simpara>
    Some queries, such as phrase queries, match documents using a "Two Phase" process.  First, the document is
    "approximately" matched, and if it matches approximately, it is checked a second time with a more rigorous
    (and expensive) process.  The second phase verification is what the <literal>matches</literal> statistic measures.
    <?asciidoc-br?>
    <?asciidoc-br?>
    For example, a phrase query first checks a document approximately by ensuring all terms in the phrase are
    present in the doc.  If all the terms are present, it then executes the second phase verification to ensure
    the terms are in-order to form the phrase, which is relatively more expensive than just checking for presence
    of the terms.
    <?asciidoc-br?>
    <?asciidoc-br?>
    Because this two-phase process is only used by a handful of queries, the <literal>metric</literal> statistic will often be zero
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>score</literal>
</simpara>
</entry>
<entry>
<simpara>
    This records the time taken to score a particular document via it&#8217;s Scorer
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="_literal_collectors_literal_section">
<title><literal>collectors</literal> Section<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>The Collectors portion of the response shows high-level execution details. Lucene works by defining a "Collector"
which is responsible for coordinating the traversal, scoring and collection of matching documents.  Collectors
are also how a single query can record aggregation results, execute unscoped "global" queries, execute post-query
filters, etc.</simpara>
<simpara>Looking at the previous example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"collector": [
    {
       "name": "SimpleTopScoreDocCollector",
       "reason": "search_top_hits",
       "time": "2.206529000ms"
    }
]</programlisting>
<simpara>We see a single collector named <literal>SimpleTopScoreDocCollector</literal>.  This is the default "scoring and sorting" Collector
used by Elasticsearch.  The <literal>"reason"</literal> field attempts to give a plain english description of the class name.  The
<literal>"time"</literal> is similar to the time in the Query tree: a wall-clock time inclusive of all children.  Similarly, <literal>children</literal> lists
all sub-collectors.</simpara>
<simpara>It should be noted that Collector times are <emphasis role="strong">independent</emphasis> from the Query times.  They are calculated, combined
and normalized independently!  Due to the nature of Lucene&#8217;s execution, it is impossible to "merge" the times
from the Collectors into the Query section, so they are displayed in separate portions.</simpara>
<simpara>For reference, the various collector reason&#8217;s are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>search_sorted</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that scores and sorts documents.  This is the most common collector and will be seen in most
    simple searches
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_count</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that only counts the number of documents that match the query, but does not fetch the source.
    This is seen when <literal>size: 0</literal> or <literal>search_type=count</literal> is specified
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_terminate_after_count</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that terminates search execution after <literal>n</literal> matching documents have been found.  This is seen
    when the <literal>terminate_after_count</literal> query parameter has been specified
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_min_score</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that only returns matching documents that have a score greater than <literal>n</literal>.  This is seen when
    the top-level parameter <literal>min_score</literal> has been specified.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_multi</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that wraps several other collectors.  This is seen when combinations of search, aggregations,
    global aggs and post_filters are combined in a single search.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search_timeout</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that halts execution after a specified period of time.  This is seen when a <literal>timeout</literal> top-level
    parameter has been specified.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>aggregation</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that Elasticsearch uses to run aggregations against the query scope.  A single <literal>aggregation</literal>
    collector is used to collect documents for <emphasis role="strong">all</emphasis> aggregations, so you will see a list of aggregations
    in the name rather.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>global_aggregation</literal>
</simpara>
</entry>
<entry>
<simpara>
    A collector that executes an aggregation against the global query scope, rather than the specified query.
    Because the global scope is necessarily different from the executed query, it must execute it&#8217;s own
    match_all query (which you will see added to the Query section) to collect your entire dataset
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_literal_rewrite_literal_section">
<title><literal>rewrite</literal> Section<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>All queries in Lucene undergo a "rewriting" process.  A query (and its sub-queries) may be rewritten one or
more times, and the process continues until the query stops changing.  This process allows Lucene to perform
optimizations, such as removing redundant clauses, replacing one query for a more efficient execution path,
etc.  For example a Boolean &#8594; Boolean &#8594; TermQuery can be rewritten to a TermQuery, because all the Booleans
are unnecessary in this case.</simpara>
<simpara>The rewriting process is complex and difficult to display, since queries can change drastically.  Rather than
showing the intermediate results, the total rewrite time is simply displayed as a value (in nanoseconds).  This
value is cumulative and contains the total time for all queries being rewritten.</simpara>
</section>
<section id="_a_more_complex_example">
<title>A more complex example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>To demonstrate a slightly more complex query and the associated results, we can profile the following query:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /test/_search
{
  "profile": true,
  "query": {
    "term": {
      "message": {
        "value": "search"
      }
    }
  },
  "aggs": {
    "non_global_term": {
      "terms": {
        "field": "agg"
      },
      "aggs": {
        "second_term": {
          "terms": {
            "field": "sub_agg"
          }
        }
      }
    },
    "another_agg": {
      "cardinality": {
        "field": "aggB"
      }
    },
    "global_agg": {
      "global": {},
      "aggs": {
        "my_agg2": {
          "terms": {
            "field": "globalAgg"
          }
        }
      }
    }
  },
  "post_filter": {
    "term": {
      "my_field": "foo"
    }
  }
}</programlisting>
<simpara>This example has:</simpara>
<itemizedlist>
<listitem>
<simpara>
A query
</simpara>
</listitem>
<listitem>
<simpara>
A scoped aggregation
</simpara>
</listitem>
<listitem>
<simpara>
A global aggregation
</simpara>
</listitem>
<listitem>
<simpara>
A post_filter
</simpara>
</listitem>
</itemizedlist>
<simpara>And the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "profile": {
         "shards": [
            {
               "id": "[P6-vulHtQRWuD4YnubWb7A][test][0]",
               "searches": [
                  {
                     "query": [
                        {
                           "query_type": "TermQuery",
                           "lucene": "my_field:foo",
                           "time": "0.4094560000ms",
                           "breakdown": {
                              "score": 0,
                              "next_doc": 0,
                              "match": 0,
                              "create_weight": 31584,
                              "build_scorer": 377872,
                              "advance": 0
                           }
                        },
                        {
                           "query_type": "TermQuery",
                           "lucene": "message:search",
                           "time": "0.3037020000ms",
                           "breakdown": {
                              "score": 0,
                              "next_doc": 5936,
                              "match": 0,
                              "create_weight": 185215,
                              "build_scorer": 112551,
                              "advance": 0
                           }
                        }
                     ],
                     "rewrite_time": 7208,
                     "collector": [
                        {
                           "name": "MultiCollector",
                           "reason": "search_multi",
                           "time": "1.378943000ms",
                           "children": [
                              {
                                 "name": "FilteredCollector",
                                 "reason": "search_post_filter",
                                 "time": "0.4036590000ms",
                                 "children": [
                                    {
                                       "name": "SimpleTopScoreDocCollector",
                                       "reason": "search_top_hits",
                                       "time": "0.006391000000ms"
                                    }
                                 ]
                              },
                              {
                                 "name": "BucketCollector: [[non_global_term, another_agg]]",
                                 "reason": "aggregation",
                                 "time": "0.9546020000ms"
                              }
                           ]
                        }
                     ]
                  },
                  {
                     "query": [
                        {
                           "query_type": "MatchAllDocsQuery",
                           "lucene": "*:*",
                           "time": "0.04829300000ms",
                           "breakdown": {
                              "score": 0,
                              "next_doc": 3672,
                              "match": 0,
                              "create_weight": 6311,
                              "build_scorer": 38310,
                              "advance": 0
                           }
                        }
                     ],
                     "rewrite_time": 1067,
                     "collector": [
                        {
                           "name": "GlobalAggregator: [global_agg]",
                           "reason": "aggregation_global",
                           "time": "0.1226310000ms"
                        }
                     ]
                  }
               ]
            }
         ]
      }
}</programlisting>
<simpara>As you can see, the output is significantly verbose from before.  All the major portions of the query are
represented:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
The first <literal>TermQuery</literal> (message:search) represents the main <literal>term</literal> query
</simpara>
</listitem>
<listitem>
<simpara>
The second <literal>TermQuery</literal> (my_field:foo) represents the <literal>post_filter</literal> query
</simpara>
</listitem>
<listitem>
<simpara>
There is a  <literal>MatchAllDocsQuery</literal> (*:*) query which is being executed as a second, distinct search.  This was
not part of the query specified by the user, but is auto-generated by the global aggregation to provide a global query scope
</simpara>
</listitem>
</orderedlist>
<simpara>The Collector tree is fairly straightforward, showing how a single MultiCollector wraps a FilteredCollector
to execute the post_filter (and in turn wraps the normal scoring SimpleCollector), a BucketCollector to run
all scoped aggregations.  In the MatchAll search, there is a single GlobalAggregator to run the global aggregation.</simpara>
</section>
<section id="_performance_notes">
<title>Performance Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>Like any profiler, the Profile API introduce a non-negligible overhead to query execution.  The act of instrumenting
low-level method calls such as <literal>advance</literal> and <literal>next_doc</literal> can be fairly expensive, since these methods are called
in tight loops.  Therefore, profiling should not be enabled in production settings by default, and should not
be compared against non-profiled query times.  Profiling is just a diagnostic tool.</simpara>
<simpara>There are also cases where special Lucene optimizations are disabled, since they are not amenable to profiling.  This
could cause some queries to report larger relative times than their non-profiled counterparts, but in general should
not have a drastic effect compared to other components in the profiled query.</simpara>
</section>
<section id="_limitations">
<title>Limitations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<itemizedlist>
<listitem>
<simpara>
Profiling statistics are currently not available for suggestions, highlighting, <literal>dfs_query_then_fetch</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Detailed breakdown for aggregations is not currently available past the high-level overview provided
from the Collectors
</simpara>
</listitem>
<listitem>
<simpara>
The Profiler is still highly experimental. The Profiler is instrumenting parts of Lucene that were
never designed to be exposed in this manner, and so all results should be viewed as a best effort to provide detailed
diagnostics.  We hope to improve this over time. If you find obviously wrong numbers, strange query structures or
other bugs, please report them!
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_understanding_multitermquery_output">
<title>Understanding MultiTermQuery output<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/profile.asciidoc">Edit me</ulink></title>
<simpara>A special note needs to be made about the <literal>MultiTermQuery</literal> class of queries.  This includes wildcards, regex and fuzzy
queries.  These queries emit very verbose responses, and are not overly structured.</simpara>
<simpara>Essentially, these queries rewrite themselves on a per-segment basis.  If you imagine the wildcard query <literal>b*</literal>, it technically
can match any token that begins with the letter "b".  It would be impossible to enumerate all possible combinations,
so Lucene rewrites the query in context of the segment being evaluated.  E.g. one segment may contain the tokens
<literal>[bar, baz]</literal>, so the query rewrites to a BooleanQuery combination of "bar" and "baz".  Another segment may only have the
token <literal>[bakery]</literal>, so query rewrites to a single TermQuery for "bakery".</simpara>
<simpara>Due to this dynamic, per-segment rewriting, the clean tree structure becomes distorted and no longer follows a clean
"lineage" showing how one query rewrites into the next.  At present time, all we can do is apologize, and suggest you
collapse the details for that query&#8217;s children if it is too confusing.  Luckily, all the timing statistics are correct,
just not the physical layout in the response, so it is sufficient to just analyze the top-level MultiTermQuery and
ignore it&#8217;s children if you find the details too tricky to interpret.</simpara>
<simpara>Hopefully this will be fixed in future iterations, but it is a tricky problem to solve and still in-progress :)</simpara>
</section>
</chapter>
<chapter id="search-percolate">
<title>Percolator<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></title>
<important>
<title>Percolating geo-queries in Elasticsearch 2.2.0 or later</title>
<simpara>The new <link linkend="geo-point"><literal>geo_point</literal> fields</link> added in Elasticsearch 2.2.0 and
above require that <link linkend="doc-values"><literal>doc_values</literal></link> are enabled in order to
function. Unfortunately, the in-memory index used by the percolator does not
yet have support for <literal>doc_values</literal>, meaning that <link linkend="geo-queries">geo-queries</link>
will not work in a percolator index created in Elasticsearch 2.2.0 or later.</simpara>
<simpara>See <xref linkend="geo-percolate"/> for a workaround.</simpara>
</important>
<simpara>Traditionally you design documents based on your data, store them into an index, and then define queries via the search API
in order to retrieve these documents. The percolator works in the opposite direction. First you store queries into an
index and then, via the percolate API, you define documents in order to retrieve these queries.</simpara>
<simpara>The reason that queries can be stored comes from the fact that in Elasticsearch both documents and queries are defined in
JSON. This allows you to embed queries into documents via the index API. Elasticsearch can extract the query from a
document and make it available to the percolate API. Since documents are also defined as JSON, you can define a document
in a request to the percolate API.</simpara>
<simpara>The percolator and most of its features work in realtime, so once a percolate query is indexed it can immediately be used
in the percolate API.</simpara>
<important>
<simpara>Fields referred to in a percolator query must <emphasis role="strong">already</emphasis> exist in the mapping
associated with the index used for percolation.
There are two ways to make sure that a field mapping exist:</simpara>
<itemizedlist>
<listitem>
<simpara>
Add or update a mapping via the <link linkend="indices-create-index">create index</link> or
  <link linkend="indices-put-mapping">put mapping</link> APIs.
</simpara>
</listitem>
<listitem>
<simpara>
Percolate a document before registering a query. Percolating a document can
  add field mappings dynamically, in the same way as happens when indexing a
  document.
</simpara>
</listitem>
</itemizedlist>
</important>
<bridgehead id="_sample_usage" renderas="sect2">Sample Usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Create an index with a mapping for the field <literal>message</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/my-index' -d '{
  "mappings": {
    "my-type": {
      "properties": {
        "message": {
          "type": "string"
        }
      }
    }
  }
}'</programlisting>
<simpara>Register a query in the percolator:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/my-index/.percolator/1' -d '{
    "query" : {
        "match" : {
            "message" : "bonsai tree"
        }
    }
}'</programlisting>
<simpara>Match a document to the registered percolator queries:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/my-index/my-type/_percolate' -d '{
    "doc" : {
        "message" : "A new bonsai tree in the office"
    }
}'</programlisting>
<simpara>The above request will yield the following response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "took" : 19,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "total" : 1,
    "matches" : [ <co id="CO41-1"/>
        {
          "_index" : "my-index",
          "_id" : "1"
        }
    ]
}</programlisting>
<calloutlist>
<callout arearefs="CO41-1">
<para>
The percolate query with id <literal>1</literal> matches our document.
</para>
</callout>
</calloutlist>
<bridgehead id="_indexing_percolator_queries" renderas="sect2">Indexing Percolator Queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Percolate queries are stored as documents in a specific format and in an arbitrary index under a reserved type with the
name <literal>.percolator</literal>. The query itself is placed as is in a JSON object under the top level field <literal>query</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
                "match" : {
                        "field" : "value"
                }
        }
}</programlisting>
<simpara>Since this is just an ordinary document, any field can be added to this document. This can be useful later on to only
percolate documents by specific queries.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
        "query" : {
                "match" : {
                        "field" : "value"
                }
        },
        "priority" : "high"
}</programlisting>
<simpara>On top of this, also a mapping type can be associated with this query. This allows to control how certain queries
like range queries, shape filters, and other query &amp; filters that rely on mapping settings get constructed. This is
important since the percolate queries are indexed into the <literal>.percolator</literal> type, and the queries / filters that rely on
mapping settings would yield unexpected behaviour. Note: By default, field names do get resolved in a smart manner,
but in certain cases with multiple types this can lead to unexpected behavior, so being explicit about it will help.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
        "query" : {
                "range" : {
                        "created_at" : {
                                "gte" : "2010-01-01T00:00:00",
                                "lte" : "2011-01-01T00:00:00"
                        }
                }
        },
        "type" : "tweet",
        "priority" : "high"
}</programlisting>
<simpara>In the above example the range query really gets parsed into a Lucene numeric range query, based on the settings for
the field <literal>created_at</literal> in the type <literal>tweet</literal>.</simpara>
<simpara>Just as with any other type, the <literal>.percolator</literal> type has a mapping, which you can configure via the mappings APIs.
The default percolate mapping doesn&#8217;t index the query field, only stores it.</simpara>
<simpara>Because <literal>.percolate</literal> is a type it also has a mapping. By default the following mapping is active:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
        ".percolator" : {
                "properties" : {
                        "query" : {
                                "type" : "object",
                                "enabled" : false
                        }
                }
        }
}</programlisting>
<simpara>If needed, this mapping can be modified with the update mapping API.</simpara>
<simpara>In order to un-register a percolate query the delete API can be used. So if the previous added query needs to be deleted
the following delete requests needs to be executed:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/my-index/.percolator/1</programlisting>
<bridgehead id="_percolate_api" renderas="sect2">Percolate API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>The percolate API executes in a distributed manner, meaning it executes on all shards an index points to.</simpara>
<itemizedlist><title>Required options</title>
<listitem>
<simpara>
<literal>index</literal> - The index that contains the <literal>.percolator</literal> type. This can also be an alias.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>type</literal> - The type of the document to be percolated. The mapping of that type is used to parse document.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>doc</literal> - The actual document to percolate. Unlike the other two options this needs to be specified in the request body. Note: This isn&#8217;t required when percolating an existing document.
</simpara>
</listitem>
</itemizedlist>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/tweet/_percolate' -d '{
        "doc" : {
                "created_at" : "2010-10-10T00:00:00",
                "message" : "some text"
        }
}'</programlisting>
<itemizedlist><title>Additional supported query string options</title>
<listitem>
<simpara>
<literal>routing</literal> - In case the percolate queries are partitioned by a custom routing value, that routing option makes sure
that the percolate request only gets executed on the shard where the routing value is partitioned to. This means that
the percolate request only gets executed on one shard instead of all shards. Multiple values can be specified as a
comma separated string, in that case the request can be be executed on more than one shard.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>preference</literal> - Controls which shard replicas are preferred to execute the request on. Works the same as in the search API.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>ignore_unavailable</literal> - Controls if missing concrete indices should silently be ignored. Same as is in the search API.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>percolate_format</literal> - If <literal>ids</literal> is specified then the matches array in the percolate response will contain a string
array of the matching ids instead of an array of objects. This can be useful to reduce the amount of data being send
back to the client. Obviously if there are two percolator queries with same id from different indices there is no way
to find out which percolator query belongs to what index. Any other value to <literal>percolate_format</literal> will be ignored.
</simpara>
</listitem>
</itemizedlist>
<itemizedlist><title>Additional request body options</title>
<listitem>
<simpara>
<literal>filter</literal> - Reduces the number queries to execute during percolating. Only the percolator queries that match with the
filter will be included in the percolate execution. The filter option works in near realtime, so a refresh needs to have
occurred for the filter to included the latest percolate queries.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>query</literal> - Same as the <literal>filter</literal> option, but also the score is computed. The computed scores can then be used by the
<literal>track_scores</literal> and <literal>sort</literal> option.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>size</literal> - Defines to maximum number of matches (percolate queries) to be returned. Defaults to unlimited.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>track_scores</literal> - Whether the <literal>_score</literal> is included for each match. The <literal>_score</literal> is based on the query and represents
how the query matched the <emphasis role="strong">percolate query&#8217;s metadata</emphasis>, <emphasis role="strong">not</emphasis> how the document (that is being percolated) matched
the query. The <literal>query</literal> option is required for this option. Defaults to <literal>false</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>sort</literal> - Define a sort specification like in the search API. Currently only sorting <literal>_score</literal> reverse (default relevancy)
is supported. Other sort fields will throw an exception. The <literal>size</literal> and <literal>query</literal> option are required for this setting. Like
<literal>track_score</literal> the score is based on the query and represents how the query matched to the percolate query&#8217;s metadata
and <emphasis role="strong">not</emphasis> how the document being percolated matched to the query.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>aggs</literal> - Allows aggregation definitions to be included. The aggregations are based on the matching percolator queries,
look at the aggregation documentation on how to define aggregations.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>highlight</literal> - Allows highlight definitions to be included. The document being percolated is being highlight for each
matching query. This allows you to see how each match is highlighting the document being percolated. See highlight
documentation on how to define highlights. The <literal>size</literal> option is required for highlighting, the performance of highlighting
 in the percolate API depends of how many matches are being highlighted.
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="dedicated-percolator" renderas="sect2">Dedicated Percolator Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Percolate queries can be added to any index. Instead of adding percolate queries to the index the data resides in,
these queries can also be added to a dedicated index. The advantage of this is that this dedicated percolator index
can have its own index settings (For example the number of primary and replica shards). If you choose to have a dedicated
percolate index, you need to make sure that the mappings from the normal index are also available on the percolate index.
Otherwise percolate queries can be parsed incorrectly.</simpara>
<bridgehead id="_filtering_executed_queries" renderas="sect2">Filtering Executed Queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Filtering allows to reduce the number of queries, any filter that the search API supports, (except the ones mentioned in important notes)
can also be used in the percolate API. The filter only works on the metadata fields. The <literal>query</literal> field isn&#8217;t indexed by
default. Based on the query we indexed before, the following filter can be defined:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/test/type1/_percolate -d '{
    "doc" : {
        "field" : "value"
    },
    "filter" : {
        "term" : {
            "priority" : "high"
        }
    }
}'</programlisting>
<bridgehead id="_percolator_count_api" renderas="sect2">Percolator Count API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>The count percolate API, only keeps track of the number of matches and doesn&#8217;t keep track of the actual matches
Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/my-index/my-type/_percolate/count' -d '{
   "doc" : {
       "message" : "some message"
   }
}'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   ... // header
   "total" : 3
}</programlisting>
<bridgehead id="_percolating_an_existing_document" renderas="sect2">Percolating an Existing Document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>In order to percolate a newly indexed document, the percolate existing document can be used. Based on the response
from an index request, the <literal>_id</literal> and other meta information can be used to immediately percolate the newly added
document.</simpara>
<itemizedlist><title>Supported options for percolating an existing document on top of existing percolator options:</title>
<listitem>
<simpara>
<literal>id</literal> - The id of the document to retrieve the source for.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>percolate_index</literal> - The index containing the percolate queries. Defaults to the <literal>index</literal> defined in the url.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>percolate_type</literal> - The percolate type (used for parsing the document). Default to <literal>type</literal> defined in the url.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>routing</literal> - The routing value to use when retrieving the document to percolate.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>preference</literal> - Which shard to prefer when retrieving the existing document.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>percolate_routing</literal> - The routing value to use when percolating the existing document.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>percolate_preference</literal> - Which shard to prefer when executing the percolate request.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>version</literal> - Enables a version check. If the fetched document&#8217;s version isn&#8217;t equal to the specified version then the request fails with a version conflict and the percolation request is aborted.
</simpara>
</listitem>
</itemizedlist>
<simpara>Internally the percolate API will issue a GET request for fetching the <literal>_source</literal> of the document to percolate.
For this feature to work, the <literal>_source</literal> for documents to be percolated needs to be stored.</simpara>
<bridgehead id="_example" renderas="sect3">Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Index response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
        "_index" : "my-index",
        "_type" : "message",
        "_id" : "1",
        "_version" : 1,
        "created" : true
}</programlisting>
<simpara>Percolating an Existing Document:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/my-index1/message/1/_percolate'</programlisting>
<simpara>The response is the same as with the regular percolate API.</simpara>
<bridgehead id="_multi_percolate_api" renderas="sect2">Multi Percolate API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>The multi percolate API allows to bundle multiple percolate requests into a single request, similar to what the multi
search API does to search requests. The request body format is line based. Each percolate request item takes two lines,
the first line is the header and the second line is the body.</simpara>
<simpara>The header can contain any parameter that normally would be set via the request path or query string parameters.
There are several percolate actions, because there are multiple types of percolate requests.</simpara>
<itemizedlist><title>Supported actions:</title>
<listitem>
<simpara>
<literal>percolate</literal> - Action for defining a regular percolate request.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>count</literal> - Action for defining a count percolate request.
</simpara>
</listitem>
</itemizedlist>
<simpara>Depending on the percolate action different parameters can be specified. For example the percolate and percolate existing
document actions support different parameters.</simpara>
<itemizedlist><title>The following endpoints are supported</title>
<listitem>
<simpara>
<literal>GET|POST /[index]/[type]/_mpercolate</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>GET|POST /[index]/_mpercolate</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>GET|POST /_mpercolate</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>The <literal>index</literal> and <literal>type</literal> defined in the url path are the default index and type.</simpara>
<bridgehead id="_example_2" renderas="sect3">Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/twitter/tweet/_mpercolate' --data-binary "@requests.txt"; echo</programlisting>
<simpara>The index <literal>twitter</literal> is the default index, and the type <literal>tweet</literal> is the default type and will be used in the case a header
doesn&#8217;t specify an index or type.</simpara>
<simpara>requests.txt:</simpara>
<programlisting language="js" linenumbering="unnumbered">{"percolate" : {"index" : "twitter", "type" : "tweet"}}
{"doc" : {"message" : "some text"}}
{"percolate" : {"index" : "twitter", "type" : "tweet", "id" : "1"}}
{}
{"percolate" : {"index" : "users", "type" : "user", "id" : "3", "percolate_index" : "users_2012" }}
{"size" : 10}
{"count" : {"index" : "twitter", "type" : "tweet"}}
{"doc" : {"message" : "some other text"}}
{"count" : {"index" : "twitter", "type" : "tweet", "id" : "1"}}
{}</programlisting>
<simpara>For a percolate existing document item (headers with the <literal>id</literal> field), the response can be an empty JSON object.
All the required options are set in the header.</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "responses" : [
        {
            "took" : 24,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : [
                {
                    "_index": "twitter",
                    "_id": "1"
                },
                {
                    "_index": "twitter",
                    "_id": "2"
                },
                {
                    "_index": "twitter",
                    "_id": "3"
                }
            ]
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : [
                {
                    "_index": "twitter",
                    "_id": "4"
                },
                {
                    "_index": "twitter",
                    "_id": "5"
                },
                {
                    "_index": "twitter",
                    "_id": "6"
                }
             ]
        },
        {
            "error" : "DocumentMissingException[[_na][_na] [user][3]: document missing]"
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        },
        {
            "took" : 14,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        }
    ]
}</programlisting>
<simpara>Each item represents a percolate response, the order of the items maps to the order in which the percolate requests
were specified. In case a percolate request failed, the item response is substituted with an error message.</simpara>
<bridgehead id="_how_it_works_under_the_hood" renderas="sect2">How it Works Under the Hood<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>When indexing a document that contains a query in an index and the <literal>.percolator</literal> type, the query part of the documents gets
parsed into a Lucene query and is kept in memory until that percolator document is removed or the index containing the
<literal>.percolator</literal> type gets removed. So, all the active percolator queries are kept in memory.</simpara>
<simpara>At percolate time, the document specified in the request gets parsed into a Lucene document and is stored in a in-memory
Lucene index. This in-memory index can just hold this one document and it is optimized for that. Then all the queries
that are registered to the index that the percolate request is targeted for, are going to be executed on this single document
in-memory index. This happens on each shard the percolate request needs to execute.</simpara>
<simpara>By using <literal>routing</literal>, <literal>filter</literal> or <literal>query</literal> features the amount of queries that need to be executed can be reduced and thus
the time the percolate API needs to run can be decreased.</simpara>
<bridgehead id="_limitations_2" renderas="sect2">Limitations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>Because the percolator API is processing one document at a time, it doesn&#8217;t support queries and filters that run
against child documents such as <literal>has_child</literal> and <literal>has_parent</literal>.</simpara>
<simpara>The <literal>inner_hits</literal> feature on the <literal>nested</literal> query isn&#8217;t supported in the percolate api.</simpara>
<simpara>The <literal>wildcard</literal> and <literal>regexp</literal> query natively use a lot of memory and because the percolator keeps the queries into memory
this can easily take up the available memory in the heap space. If possible try to use a <literal>prefix</literal> query or ngramming to
achieve the same result (with way less memory being used).</simpara>
<simpara>The <literal>delete-by-query</literal> plugin doesn&#8217;t work to unregister a query, it only deletes the percolate documents from disk. In order
to update the registered queries in memory the index needs be closed and opened.</simpara>
<simpara>There are a number of queries that fetch data via a get call during query parsing. For example the <literal>terms</literal> query when
using terms lookup, <literal>template</literal> query when using indexed scripts and <literal>geo_shape</literal> when using pre-indexed shapes. Each time
the percolator evaluates these queries, it fetches terms, shapes etc. The data gets fetched separately on the primary,
replica shards and when a shard is being recovered (e.g. due to relocation or node startup). This makes it likely that
over time these percolator queries have different terms between primary and replica shards, resulting in inconsistent
results when percolating. There is no workaround to prevent this from happening. The only alternative is to not use these
queries and do the fetching of terms on the client side prior to indexing.</simpara>
<bridgehead id="_forcing_unmapped_fields_to_be_handled_as_strings" renderas="sect2">Forcing Unmapped Fields to be Handled as Strings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>In certain cases it is unknown what kind of percolator queries do get registered, and if no field mapping exists for fields
that are referred by percolator queries then adding a percolator query fails. This means the mapping needs to be updated
to have the field with the appropriate settings, and then the percolator query can be added. But sometimes it is sufficient
if all unmapped fields are handled as if these were default string fields. In those cases one can configure the
<literal>index.percolator.map_unmapped_fields_as_string</literal> setting to <literal>true</literal> (default to <literal>false</literal>) and then if a field referred in
a percolator query does not exist, it will be handled as a default string field so that adding the percolator query doesn&#8217;t
fail.</simpara>
<bridgehead id="geo-percolate" renderas="sect2">Percolating geo-queries in Elasticsearch 2.2.0 and later<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/percolate.asciidoc">Edit me</ulink></bridgehead>
<simpara>The new <link linkend="geo-point"><literal>geo_point</literal> fields</link> added in Elasticsearch 2.2.0 and
above require that <link linkend="doc-values"><literal>doc_values</literal></link> are enabled in order to
function. Unfortunately, the in-memory index used by the percolator does not
yet have support for <literal>doc_values</literal>, meaning that <link linkend="geo-queries">geo-queries</link>
will not work in a percolator index created in Elasticsearch 2.2.0 or later.</simpara>
<simpara>A workaround exists which allows you to both benefit from the new <literal>geo_point</literal>
field format when searching or aggregating, and to use geo-queries in the
percolator.</simpara>
<simpara>Documents with `geo_point`fields should be indexed into a new index created in
Elasticsearch 2.2.0 or later for searching or aggregations:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "location": {
    "lat": 0,
    "lon": 0
  }
}</programlisting>
<simpara>Percolator queries should be created in a separate
<link linkend="dedicated-percolator">dedicated percolator index</link>, which claims to have been
created in Elasticsearch 2.1.0:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_percolator_index
{
  "settings": {
    "index.version.created": 2010299 <co id="CO42-1"/>
  },
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point"
        }
      }
    }
  }
}

PUT my_percolator_index/.percolator/my_geo_query
{
  "query": {
    "geo_distance": {
      "distance": "5km",
      "location": {
        "lat": 0,
        "lon": 0
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO42-1">
<para>
Marks the index as having been created in Elasticsearch 2.1.0
</para>
</callout>
</calloutlist>
<simpara>With this setup, you can percolate an inline document as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_percolator_index/my_type/_percolate
{
  "doc": {
    "location": {
      "lat": 0,
      "lon": 0
    }
  }
}</programlisting>
<simpara>or percolate a document already indexed in <literal>my_index</literal> as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/my_type/1/_percolate?percolate_index=my_percolator_index</programlisting>
</chapter>
<chapter id="search-field-stats">
<title>Field stats API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/field-stats.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>The field stats api allows one to find statistical properties of a field
without executing a search, but looking up measurements that are natively
available in the Lucene index. This can be useful to explore a dataset which
you don&#8217;t know much about. For example, this allows creating a histogram
aggregation with meaningful intervals based on the min/max range of values.</simpara>
<simpara>The field stats api by defaults executes on all indices, but can execute on
specific indices too.</simpara>
<simpara>All indices:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET "http://localhost:9200/_field_stats?fields=rating"</programlisting>
<simpara>Specific indices:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET "http://localhost:9200/index1,index2/_field_stats?fields=rating"</programlisting>
<simpara>Supported request options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>fields</literal>
</simpara>
</entry>
<entry>
<simpara>
A list of fields to compute stats for.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>level</literal>
</simpara>
</entry>
<entry>
<simpara>
Defines if field stats should be returned on a per index level or on a
            cluster wide level. Valid values are <literal>indices</literal> and <literal>cluster</literal> (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Alternatively the <literal>fields</literal> option can also be defined in the request body:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST "http://localhost:9200/_field_stats?level=indices" -d '{
   "fields" : ["rating"]
}'</programlisting>
<simpara>This is equivalent to the previous request.</simpara>
<bridgehead id="_field_statistics_2" renderas="sect2">Field statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/field-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>The field stats api is supported on string based, number based and date based fields and can return the following statistics per field:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>max_doc</literal>
</simpara>
</entry>
<entry>
<simpara>
The total number of documents.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>doc_count</literal>
</simpara>
</entry>
<entry>
<simpara>
The number of documents that have at least one term for this field, or -1 if
this measurement isn&#8217;t available on one or more shards.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>density</literal>
</simpara>
</entry>
<entry>
<simpara>
The percentage of documents that have at least one value for this field. This
is a derived statistic and is based on the <literal>max_doc</literal> and <literal>doc_count</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
The sum of each term&#8217;s document frequency in this field, or -1 if this
measurement isn&#8217;t available on one or more shards.
Document frequency is the number of documents containing a particular term.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum_total_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
The sum of the term frequencies of all terms in this field across all
documents, or -1 if this measurement isn&#8217;t available on one or more shards.
Term frequency is the total number of occurrences of a term in a particular
document and field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_value</literal>
</simpara>
</entry>
<entry>
<simpara>
The lowest value in the field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_value_as_string</literal>
</simpara>
</entry>
<entry>
<simpara>
The lowest value in the field represented in a displayable form. All fields,
but string fields returns this. (since string fields, represent values already as strings)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_value</literal>
</simpara>
</entry>
<entry>
<simpara>
The highest value in the field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_value_as_string</literal>
</simpara>
</entry>
<entry>
<simpara>
The highest value in the field represented in a displayable form. All fields,
but string fields returns this. (since string fields, represent values already as strings)
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<note><simpara>Documents marked as deleted (but not yet removed by the merge process)
still affect all the mentioned statistics.</simpara></note>
<bridgehead id="_cluster_level_field_statistics_example" renderas="sect2">Cluster level field statistics example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/field-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>Request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET "http://localhost:9200/_field_stats?fields=rating,answer_count,creation_date,display_name"</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "indices": {
      "_all": { <co id="CO43-1"/>
         "fields": {
            "creation_date": {
               "max_doc": 1326564,
               "doc_count": 564633,
               "density": 42,
               "sum_doc_freq": 2258532,
               "sum_total_term_freq": -1,
               "min_value": "2008-08-01T16:37:51.513Z",
               "max_value": "2013-06-02T03:23:11.593Z"
            },
            "display_name": {
               "max_doc": 1326564,
               "doc_count": 126741,
               "density": 9,
               "sum_doc_freq": 166535,
               "sum_total_term_freq": 166616,
               "min_value": "0",
               "max_value": "정혜선"
            },
            "answer_count": {
               "max_doc": 1326564,
               "doc_count": 139885,
               "density": 10,
               "sum_doc_freq": 559540,
               "sum_total_term_freq": -1,
               "min_value": 0,
               "max_value": 160
            },
            "rating": {
               "max_doc": 1326564,
               "doc_count": 437892,
               "density": 33,
               "sum_doc_freq": 1751568,
               "sum_total_term_freq": -1,
               "min_value": -14,
               "max_value": 1277
            }
         }
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO43-1">
<para>
The <literal>_all</literal> key indicates that it contains the field stats of all indices in the cluster.
</para>
</callout>
</calloutlist>
<bridgehead id="_indices_level_field_statistics_example" renderas="sect3">Indices level field statistics example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/field-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>Request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET "http://localhost:9200/_field_stats?fields=rating,answer_count,creation_date,display_name&amp;level=indices"</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "indices": {
      "stack": { <co id="CO44-1"/>
         "fields": {
            "creation_date": {
               "max_doc": 1326564,
               "doc_count": 564633,
               "density": 42,
               "sum_doc_freq": 2258532,
               "sum_total_term_freq": -1,
               "min_value": "2008-08-01T16:37:51.513Z",
               "max_value": "2013-06-02T03:23:11.593Z"
            },
            "display_name": {
               "max_doc": 1326564,
               "doc_count": 126741,
               "density": 9,
               "sum_doc_freq": 166535,
               "sum_total_term_freq": 166616,
               "min_value": "0",
               "max_value": "정혜선"
            },
            "answer_count": {
               "max_doc": 1326564,
               "doc_count": 139885,
               "density": 10,
               "sum_doc_freq": 559540,
               "sum_total_term_freq": -1,
               "min_value": 0,
               "max_value": 160
            },
            "rating": {
               "max_doc": 1326564,
               "doc_count": 437892,
               "density": 33,
               "sum_doc_freq": 1751568,
               "sum_total_term_freq": -1,
               "min_value": -14,
               "max_value": 1277
            }
         }
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO44-1">
<para>
The <literal>stack</literal> key means it contains all field stats for the <literal>stack</literal> index.
</para>
</callout>
</calloutlist>
<bridgehead id="_field_stats_index_constraints" renderas="sect2">Field stats index constraints<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/search/field-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>Field stats index constraints allows to omit all field stats for indices that don&#8217;t match with the constraint. An index
constraint can exclude indices' field stats based on the <literal>min_value</literal> and <literal>max_value</literal> statistic. This option is only
useful if the <literal>level</literal> option is set to <literal>indices</literal>.</simpara>
<simpara>For example index constraints can be useful to find out the min and max value of a particular property of your data in
a time based scenario. The following request only returns field stats for the <literal>answer_count</literal> property for indices
holding questions created in the year 2014:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST "http://localhost:9200/_field_stats?level=indices" -d '{
   "fields" : ["answer_count"] <co id="CO45-1"/>
   "index_constraints" : { <co id="CO45-2"/>
      "creation_date" : { <co id="CO45-3"/>
         "max_value" : { <co id="CO45-4"/>
            "gte" : "2014-01-01T00:00:00.000Z"
         },
         "min_value" : { <co id="CO45-5"/>
            "lt" : "2015-01-01T00:00:00.000Z"
         }
      }
   }
}'</programlisting>
<calloutlist>
<callout arearefs="CO45-1">
<para>
The fields to compute and return field stats for.
</para>
</callout>
<callout arearefs="CO45-2">
<para>
The set index constraints. Note that index constrains can be defined for fields that aren&#8217;t defined in the <literal>fields</literal> option.
</para>
</callout>
<callout arearefs="CO45-3">
<para>
Index constraints for the field <literal>creation_date</literal>.
</para>
</callout>
<callout arearefs="CO45-4 CO45-5">
<para>
Index constraints on the <literal>max_value</literal> and <literal>min_value</literal> property of a field statistic.
</para>
</callout>
</calloutlist>
<simpara>For a field, index constraints can be defined on the <literal>min_value</literal> statistic, <literal>max_value</literal> statistic or both.
Each index constraint support the following comparisons:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>gte</literal>
</simpara>
</entry>
<entry>
<simpara>
Greater-than or equal to
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>gt</literal>
</simpara>
</entry>
<entry>
<simpara>
Greater-than
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lte</literal>
</simpara>
</entry>
<entry>
<simpara>
Less-than or equal to
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lt</literal>
</simpara>
</entry>
<entry>
<simpara>
Less-than
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Field stats index constraints on date fields optionally accept a <literal>format</literal> option, used to parse the constraint&#8217;s value.
If missing, the format configured in the field&#8217;s mapping is used.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST "http://localhost:9200/_field_stats?level=indices" -d '{
   "fields" : ["answer_count"]
   "index_constraints" : {
      "creation_date" : {
         "max_value" : {
            "gte" : "2014-01-01",
            "format" : "date_optional_time" <co id="CO46-1"/>
         },
         "min_value" : {
            "lt" : "2015-01-01",
            "format" : "date_optional_time"
         }
      }
   }
}'</programlisting>
<calloutlist>
<callout arearefs="CO46-1">
<para>
Custom date format
</para>
</callout>
</calloutlist>
</chapter>
</part>
<part id="search-aggregations">
<title>Aggregations <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>The aggregations framework helps provide aggregated data based on a search query. It is based on simple building blocks
called aggregations, that can be composed in order to build complex summaries of the data.</simpara>
<simpara>An aggregation can be seen as a <emphasis>unit-of-work</emphasis> that builds analytic information over a set of documents. The context of
the execution defines what this document set is (e.g. a top-level aggregation executes within the context of the executed
query/filters of the search request).</simpara>
<simpara>There are many different types of aggregations, each with its own purpose and output. To better understand these types,
it is often easier to break them into three main families:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="search-aggregations-bucket"><emphasis>Bucketing</emphasis></link>
</term>
<listitem>
<simpara>
                                A family of aggregations that build buckets, where each bucket is associated with a <emphasis>key</emphasis> and a document
                                criterion. When the aggregation is executed, all the buckets criteria are evaluated on every document in
                                the context and when a criterion matches, the document is considered to "fall in" the relevant bucket.
                                By the end of the aggregation process, we&#8217;ll end up with a list of buckets - each one with a set of
                                documents that "belong" to it.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="search-aggregations-metrics"><emphasis>Metric</emphasis></link>
</term>
<listitem>
<simpara>
                                Aggregations that keep track and compute metrics over a set of documents.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="search-aggregations-pipeline"><emphasis>Pipeline</emphasis></link>
</term>
<listitem>
<simpara>
                                Aggregations that aggregate the output of other aggregations and their associated metrics
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The interesting part comes next. Since each bucket effectively defines a document set (all documents belonging to
the bucket), one can potentially associate aggregations on the bucket level, and those will execute within the context
of that bucket. This is where the real power of aggregations kicks in: <emphasis role="strong">aggregations can be nested!</emphasis></simpara>
<note><simpara>Bucketing aggregations can have sub-aggregations (bucketing or metric). The sub-aggregations will be computed for
                the buckets which their parent aggregation generates. There is no hard limit on the level/depth of nested
                aggregations (one can nest an aggregation under a "parent" aggregation, which is itself a sub-aggregation of
                another higher-level aggregation).</simpara></note>
<bridgehead id="_structuring_aggregations" renderas="sect1">Structuring Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following snippet captures the basic structure of aggregations:</simpara>
<programlisting language="js" linenumbering="unnumbered">"aggregations" : {
    "&lt;aggregation_name&gt;" : {
        "&lt;aggregation_type&gt;" : {
            &lt;aggregation_body&gt;
        }
        [,"meta" : {  [&lt;meta_data_body&gt;] } ]?
        [,"aggregations" : { [&lt;sub_aggregation&gt;]+ } ]?
    }
    [,"&lt;aggregation_name_2&gt;" : { ... } ]*
}</programlisting>
<simpara>The <literal>aggregations</literal> object (the key <literal>aggs</literal> can also be used) in the JSON holds the aggregations to be computed. Each aggregation
is associated with a logical name that the user defines (e.g. if the aggregation computes the average price, then it would
make sense to name it <literal>avg_price</literal>). These logical names will also be used to uniquely identify the aggregations in the
response. Each aggregation has a specific type (<literal>&lt;aggregation_type&gt;</literal> in the above snippet) and is typically the first
key within the named aggregation body. Each type of aggregation defines its own body, depending on the nature of the
aggregation (e.g. an <literal>avg</literal> aggregation on a specific field will define the field on which the average will be calculated).
At the same level of the aggregation type definition, one can optionally define a set of additional aggregations,
though this only makes sense if the aggregation you defined is of a bucketing nature. In this scenario, the
sub-aggregations you define on the bucketing aggregation level will be computed for all the buckets built by the
bucketing aggregation. For example, if you define a set of aggregations under the <literal>range</literal> aggregation, the
sub-aggregations will be computed for the range buckets that are defined.</simpara>
<bridgehead id="_values_source" renderas="sect2">Values Source<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations.asciidoc">Edit me</ulink></bridgehead>
<simpara>Some aggregations work on values extracted from the aggregated documents. Typically, the values will be extracted from
a specific document field which is set using the <literal>field</literal> key for the aggregations. It is also possible to define a
<link linkend="modules-scripting"><literal>script</literal></link> which will generate the values (per document).</simpara>
<simpara>When both <literal>field</literal> and <literal>script</literal> settings are configured for the aggregation, the script will be treated as a
<literal>value script</literal>.  While normal scripts are evaluated on a document level (i.e. the script has access to all the data
associated with the document), value scripts are evaluated on the <emphasis role="strong">value</emphasis> level. In this mode, the values are extracted
from the configured <literal>field</literal> and the <literal>script</literal> is used to apply a "transformation" over these value/s.</simpara>
<note id="aggs-script-note">
<simpara>When working with scripts, the <literal>lang</literal> and <literal>params</literal> settings can also be defined. The former defines the scripting
language which is used (assuming the proper language is available in Elasticsearch, either by default or as a plugin). The latter
enables defining all the "dynamic" expressions in the script as parameters, which enables the script to keep itself static
between calls (this will ensure the use of the cached compiled scripts in Elasticsearch).</simpara>
</note>
<simpara>Scripts can generate a single value or multiple values per document. When generating multiple values, one can use the
<literal>script_values_sorted</literal> settings to indicate whether these values are sorted or not. Internally, Elasticsearch can
perform optimizations when dealing with sorted values (for example, with the <literal>min</literal> aggregations, knowing the values are
sorted, Elasticsearch will skip the iterations over all the values and rely on the first value in the list to be the
minimum value among all other values associated with the same document).</simpara>
</partintro>
<chapter id="search-aggregations-metrics">
<title>Metrics Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics.asciidoc">Edit me</ulink></title>
<simpara>The aggregations in this family compute metrics based on values extracted in one way or another from the documents that
are being aggregated. The values are typically extracted from the fields of the document (using the field data), but
can also be generated using scripts.</simpara>
<simpara>Numeric metrics aggregations are a special type of metrics aggregation which output numeric values. Some aggregations output
a single numeric metric (e.g. <literal>avg</literal>) and are called <literal>single-value numeric metrics aggregation</literal>, others generate multiple
metrics (e.g. <literal>stats</literal>) and are called <literal>multi-value numeric metrics aggregation</literal>. The distinction between single-value and
multi-value numeric metrics aggregations plays a role when these aggregations serve as direct sub-aggregations of some
bucket aggregations (some bucket aggregations enable you to sort the returned buckets based on the numeric metrics in each bucket).</simpara>
<section id="search-aggregations-metrics-avg-aggregation">
<title>Avg Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/avg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that computes the average of numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "avg_grade" : { "avg" : { "field" : "grade" } }
    }
}</programlisting>
<simpara>The above aggregation computes the average grade over all documents. The aggregation type is <literal>avg</literal> and the <literal>field</literal> setting defines the numeric field of the documents the average will be computed on. The above will return the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "avg_grade": {
            "value": 75
        }
    }
}</programlisting>
<simpara>The name of the aggregation (<literal>avg_grade</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_script">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/avg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the average grade based on a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "avg_grade" : { "avg" : { "script" : "doc['grade'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "avg_grade" : {
            "avg" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "grade"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
<section id="_value_script">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/avg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new average:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        ...

        "aggs" : {
            "avg_corrected_grade" : {
                "avg" : {
                    "field" : "grade",
                    "script" : {
                        "inline": "_value * correction",
                        "params" : {
                            "correction" : 1.2
                        }
                    }
                }
            }
        }
    }
}</programlisting>
</section>
</section>
<section id="_missing_value">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/avg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grade_avg" : {
            "avg" : {
                "field" : "grade",
                "missing": 10 <co id="CO47-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO47-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>10</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-cardinality-aggregation">
<title>Cardinality Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that calculates an approximate count of
distinct values. Values can be extracted either from specific fields in the
document or generated by a script.</simpara>
<simpara>Assume you are indexing books and would like to count the unique authors that
match a query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author"
            }
        }
    }
}</programlisting>
<section id="_precision_control">
<title>Precision control<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>This aggregation also supports the <literal>precision_threshold</literal> option:</simpara>
<warning role="experimental"><simpara>The <literal>precision_threshold</literal> option is specific to the current internal implementation of the <literal>cardinality</literal> agg, which may change in the future.</simpara></warning>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author_hash",
                "precision_threshold": 100 <co id="CO48-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO48-1">
<para>
The <literal>precision_threshold</literal> options allows to trade memory for accuracy, and
defines a unique count below which counts are expected to be close to
accurate. Above this value, counts might become a bit more fuzzy. The maximum
supported value is 40000, thresholds above this number will have the same
effect as a threshold of 40000.
Default value depends on the number of parent aggregations that multiple
create buckets (such as terms or histograms).
</para>
</callout>
</calloutlist>
</section>
<section id="_counts_are_approximate">
<title>Counts are approximate<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing exact counts requires loading values into a hash set and returning its
size. This doesn&#8217;t scale when working on high-cardinality sets and/or large
values as the required memory usage and the need to communicate those
per-shard sets between nodes would utilize too many resources of the cluster.</simpara>
<simpara>This <literal>cardinality</literal> aggregation is based on the
<ulink url="http://static.googleusercontent.com/media/research.google.com/fr//pubs/archive/40671.pdf">HyperLogLog++</ulink>
algorithm, which counts based on the hashes of the values with some interesting
properties:</simpara>
<itemizedlist>
<listitem>
<simpara>
configurable precision, which decides on how to trade memory for accuracy,
</simpara>
</listitem>
<listitem>
<simpara>
excellent accuracy on low-cardinality sets,
</simpara>
</listitem>
<listitem>
<simpara>
fixed memory usage: no matter if there are tens or billions of unique values,
   memory usage only depends on the configured precision.
</simpara>
</listitem>
</itemizedlist>
<simpara>For a precision threshold of <literal>c</literal>, the implementation that we are using requires
about <literal>c * 8</literal> bytes.</simpara>
<simpara>The following chart shows how the error varies before and after the threshold:</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/cardinality_error.png"/>
  </imageobject>
  <textobject><phrase>images/cardinality_error.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>For all 3 thresholds, counts have been accurate up to the configured threshold
(although not guaranteed, this is likely to be the case). Please also note that
even with a threshold as low as 100, the error remains very low, even when
counting millions of items.</simpara>
</section>
<section id="_pre_computed_hashes">
<title>Pre-computed hashes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>On string fields that have a high cardinality, it might be faster to store the
hash of your field values in your index and then run the cardinality aggregation
on this field. This can either be done by providing hash values from client-side
or by letting elasticsearch compute hash values for you by using the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/mapper-murmur3.html"><literal>mapper-murmur3</literal></ulink> plugin.</simpara>
<note><simpara>Pre-computing hashes is usually only useful on very large and/or
high-cardinality fields as it saves CPU and memory. However, on numeric
fields, hashing is very fast and storing the original values requires as much
or less memory than storing the hashes. This is also true on low-cardinality
string fields, especially given that those have an optimization in order to
make sure that hashes are computed at most once per unique value per segment.</simpara></note>
</section>
<section id="_script_2">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cardinality</literal> metric supports scripting, with a noticeable performance hit
however since hashes need to be computed on the fly.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "script": "doc['author.first_name'].value + ' ' + doc['author.last_name'].value"
            }
        }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "first_name_field": "author.first_name",
                        "last_name_field": "author.last_name"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_missing_value_2">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/cardinality-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tag_cardinality" : {
            "cardinality" : {
                "field" : "tag",
                "missing": "N/A" <co id="CO49-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO49-1">
<para>
Documents without a value in the <literal>tag</literal> field will fall into the same bucket as documents that have the value <literal>N/A</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-extendedstats-aggregation">
<title>Extended Stats Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/extendedstats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>multi-value</literal> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>The <literal>extended_stats</literal> aggregations is an extended version of the <link linkend="search-aggregations-metrics-stats-aggregation"><literal>stats</literal></link> aggregation, where additional metrics are added such as <literal>sum_of_squares</literal>, <literal>variance</literal>, <literal>std_deviation</literal> and <literal>std_deviation_bounds</literal>.</simpara>
<simpara>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_stats" : { "extended_stats" : { "field" : "grade" } }
    }
}</programlisting>
<simpara>The above aggregation computes the grades statistics over all documents. The aggregation type is <literal>extended_stats</literal> and the <literal>field</literal> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "grade_stats": {
           "count": 9,
           "min": 72,
           "max": 99,
           "avg": 86,
           "sum": 774,
           "sum_of_squares": 67028,
           "variance": 51.55555555555556,
           "std_deviation": 7.180219742846005,
           "std_deviation_bounds": {
            "upper": 100.36043948569201,
            "lower": 71.63956051430799
           }
        }
    }
}</programlisting>
<simpara>The name of the aggregation (<literal>grades_stats</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_standard_deviation_bounds">
<title>Standard Deviation Bounds<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/extendedstats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>By default, the <literal>extended_stats</literal> metric will return an object called <literal>std_deviation_bounds</literal>, which provides an interval of plus/minus two standard
deviations from the mean.  This can be a useful way to visualize variance of your data.  If you want a different boundary, for example
three standard deviations, you can set <literal>sigma</literal> in the request:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_stats" : {
            "extended_stats" : {
                "field" : "grade",
                "sigma" : 3 <co id="CO50-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO50-1">
<para>
<literal>sigma</literal> controls how many standard deviations +/- from the mean should be displayed
</para>
</callout>
</calloutlist>
<simpara><literal>sigma</literal> can be any non-negative double, meaning you can request non-integer values such as <literal>1.5</literal>.  A value of <literal>0</literal> is valid, but will simply
return the average for both <literal>upper</literal> and <literal>lower</literal> bounds.</simpara>
<note>
<title>Standard Deviation and Bounds require normality</title>
<simpara>The standard deviation and its bounds are displayed by default, but they are not always applicable to all data-sets.  Your data must
be normally distributed for the metrics to make sense.  The statistics behind standard deviations assumes normally distributed data, so
if your data is skewed heavily left or right, the value returned will be misleading.</simpara>
</note>
</section>
<section id="_script_3">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/extendedstats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the grades stats based on a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_stats" : { "extended_stats" : { "script" : "doc['grade'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_stats" : {
            "extended_stats" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "grade"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
<section id="_value_script_2">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/extendedstats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new stats:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "extended_stats" : {
                    "field" : "grade",
                    "script" : {
                        "inline": "_value * correction",
                        "params" : {
                            "correction" : 1.2
                        }
                    }
                }
            }
        }
    }
}</programlisting>
</section>
</section>
<section id="_missing_value_3">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/extendedstats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_stats" : {
            "extended_stats" : {
                "field" : "grade",
                "missing": 0 <co id="CO51-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO51-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>0</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-geobounds-aggregation">
<title>Geo Bounds Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/geobounds-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A metric aggregation that computes the bounding box containing all geo_point values for a field.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : { "business_type" : "shop" }
    },
    "aggs" : {
        "viewport" : {
            "geo_bounds" : {
                "field" : "location", <co id="CO52-1"/>
                "wrap_longitude" : true <co id="CO52-2"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO52-1">
<para>
The <literal>geo_bounds</literal> aggregation specifies the field to use to obtain the bounds
</para>
</callout>
<callout arearefs="CO52-2">
<para>
<literal>wrap_longitude</literal> is an optional parameter which specifies whether the bounding box should be allowed to overlap the international date line. The default value is <literal>true</literal>
</para>
</callout>
</calloutlist>
<simpara>The above aggregation demonstrates how one would compute the bounding box of the location field for all documents with a business type of shop</simpara>
<simpara>The response for the above aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "viewport": {
            "bounds": {
                "top_left": {
                    "lat": 80.45,
                    "lon": -160.22
                },
                "bottom_right": {
                    "lat": 40.65,
                    "lon": 42.57
                }
            }
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-metrics-geocentroid-aggregation">
<title>Geo Centroid Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/geocentroid-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A metric aggregation that computes the weighted centroid from all coordinate values for a <xref linkend="geo-point"/> field.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : { "crime" : "burglary" }
    },
    "aggs" : {
        "centroid" : {
            "geo_centroid" : {
                "field" : "location" <co id="CO53-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO53-1">
<para>
The <literal>geo_centroid</literal> aggregation specifies the field to use for computing the centroid. (NOTE: field must be a <xref linkend="geo-point"/> type)
</para>
</callout>
</calloutlist>
<simpara>The above aggregation demonstrates how one would compute the centroid of the location field for all documents with a crime type of burglary</simpara>
<simpara>The response for the above aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "centroid": {
            "location": {
                "lat": 80.45,
                "lon": -160.22
            }
        }
    }
}</programlisting>
<simpara>The <literal>geo_centroid</literal> aggregation is more interesting when combined as a sub-aggregation to other bucket aggregations.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : { "crime" : "burglary" }
    },
    "aggs" : {
        "towns" : {
            "terms" : { "field" : "town" },
            "aggs" : {
                "centroid" : {
                    "geo_centroid" : { "field" : "location" }
                }
            }
        }
    }
}</programlisting>
<simpara>The above example uses <literal>geo_centroid</literal> as a sub-aggregation to a <link linkend="search-aggregations-bucket-terms-aggregation">terms</link> bucket aggregation
for finding the central location for all crimes of type burglary in each town.</simpara>
<simpara>The response for the above aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "buckets": [
       {
           "key": "Los Altos",
           "doc_count": 113,
           "centroid": {
              "location": {
                 "lat": 37.3924582824111,
                 "lon": -122.12104808539152
              }
           }
       },
       {
           "key": "Mountain View",
           "doc_count": 92,
           "centroid": {
              "location": {
                 "lat": 37.382152481004596,
                 "lon": -122.08116559311748
              }
           }
        }
    ]
}</programlisting>
</section>
<section id="search-aggregations-metrics-max-aggregation">
<title>Max Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/max-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that keeps track and returns the maximum value among the numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>Computing the max price value across all documents</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "max_price" : { "max" : { "field" : "price" } }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "max_price": {
            "value": 35
        }
    }
}</programlisting>
<simpara>As can be seen, the name of the aggregation (<literal>max_price</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_script_4">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/max-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the max price value across all document, this time using a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "max_price" : { "max" : { "script" : "doc['price'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "max_price" : {
            "max" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "price"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_value_script_3">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/max-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Let&#8217;s say that the prices of the documents in our index are in USD, but we would like to compute the max in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "max_price_in_euros" : {
            "max" : {
                "field" : "price",
                "script" : {
                    "inline": "_value * conversion_rate",
                    "params" : {
                        "conversion_rate" : 1.2
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_missing_value_4">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/max-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grade_max" : {
            "max" : {
                "field" : "grade",
                "missing": 10 <co id="CO54-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO54-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>10</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-min-aggregation">
<title>Min Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/min-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that keeps track and returns the minimum value among numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>Computing the min price value across all documents:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "min_price" : { "min" : { "field" : "price" } }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "min_price": {
            "value": 10
        }
    }
}</programlisting>
<simpara>As can be seen, the name of the aggregation (<literal>min_price</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_script_5">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/min-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the min price value across all document, this time using a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "min_price" : { "min" : { "script" : "doc['price'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "min_price" : {
            "min" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "price"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_value_script_4">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/min-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Let&#8217;s say that the prices of the documents in our index are in USD, but we would like to compute the min in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "min_price_in_euros" : {
            "min" : {
                "field" : "price",
                "script" :
                    "inline": "_value * conversion_rate",
                    "params" : {
                        "conversion_rate" : 1.2
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_missing_value_5">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/min-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grade_min" : {
            "min" : {
                "field" : "grade",
                "missing": 10 <co id="CO55-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO55-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>10</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-percentile-aggregation">
<title>Percentiles Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>multi-value</literal> metrics aggregation that calculates one or more percentiles
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</simpara>
<simpara>Percentiles show the point at which a certain percentage of observed values
occur.  For example, the 95th percentile is the value which is greater than 95%
of the observed values.</simpara>
<simpara>Percentiles are often used to find outliers.  In normal distributions, the
0.13th and 99.87th percentiles represents three standard deviations from the
mean.  Any data which falls outside three standard deviations is often considered
an anomaly.</simpara>
<simpara>When a range of percentiles are retrieved, they can be used to estimate the
data distribution and determine if the data is skewed, bimodal, etc.</simpara>
<simpara>Assume your data consists of website load times.  The average and median
load times are not overly useful to an administrator.  The max may be interesting,
but it can be easily skewed by a single slow response.</simpara>
<simpara>Let&#8217;s look at a range of percentiles representing load time:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time" <co id="CO56-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO56-1">
<para>
The field <literal>load_time</literal> must be a numeric field
</para>
</callout>
</calloutlist>
<simpara>By default, the <literal>percentile</literal> metric will generate a range of
percentiles: <literal>[ 1, 5, 25, 50, 75, 95, 99 ]</literal>.  The response will look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "values" : {
            "1.0": 15,
            "5.0": 20,
            "25.0": 23,
            "50.0": 25,
            "75.0": 29,
            "95.0": 60,
            "99.0": 150
         }
      }
   }
}</programlisting>
<simpara>As you can see, the aggregation will return a calculated value for each percentile
in the default range.  If we assume response times are in milliseconds, it is
immediately obvious that the webpage normally loads in 15-30ms, but occasionally
spikes to 60-150ms.</simpara>
<simpara>Often, administrators are only interested in outliers&#8201;&#8212;&#8201;the extreme percentiles.
We can specify just the percents we are interested in (requested percentiles
must be a value between 0-100 inclusive):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "percents" : [95, 99, 99.9] <co id="CO57-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO57-1">
<para>
Use the <literal>percents</literal> parameter to specify particular percentiles to calculate
</para>
</callout>
</calloutlist>
<section id="_script_6">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The percentile metric supports scripting.  For example, if our load times
are in milliseconds but we want percentiles calculated in seconds, we could use
a script to convert them on-the-fly:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "script" : {
                    "inline": "doc['load_time'].value / timeUnit", <co id="CO58-1"/>
                    "params" : {
                        "timeUnit" : 1000   <co id="CO58-2"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO58-1">
<para>
The <literal>field</literal> parameter is replaced with a <literal>script</literal> parameter, which uses the
script to generate values which percentiles are calculated on
</para>
</callout>
<callout arearefs="CO58-2">
<para>
Scripting supports parameterized input just like any other script
</para>
</callout>
</calloutlist>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "script" : {
                    "file": "my_script",
                    "params" : {
                        "timeUnit" : 1000
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="search-aggregations-metrics-percentile-aggregation-approximation">
<title>Percentiles are (usually) approximate<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<simpara>There are many different algorithms to calculate percentiles.  The naive
implementation simply stores all the values in a sorted array.  To find the 50th
percentile, you simply find the value that is at <literal>my_array[count(my_array) * 0.5]</literal>.</simpara>
<simpara>Clearly, the naive implementation does not scale&#8201;&#8212;&#8201;the sorted array grows
linearly with the number of values in your dataset.  To calculate percentiles
across potentially billions of values in an Elasticsearch cluster, <emphasis>approximate</emphasis>
percentiles are calculated.</simpara>
<simpara>The algorithm used by the <literal>percentile</literal> metric is called TDigest (introduced by
Ted Dunning in
<ulink url="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf">Computing Accurate Quantiles using T-Digests</ulink>).</simpara>
<simpara>When using this metric, there are a few guidelines to keep in mind:</simpara>
<itemizedlist>
<listitem>
<simpara>
Accuracy is proportional to <literal>q(1-q)</literal>.  This means that extreme percentiles (e.g. 99%)
are more accurate than less extreme percentiles, such as the median
</simpara>
</listitem>
<listitem>
<simpara>
For small sets of values, percentiles are highly accurate (and potentially
100% accurate if the data is small enough).
</simpara>
</listitem>
<listitem>
<simpara>
As the quantity of values in a bucket grows, the algorithm begins to approximate
the percentiles.  It is effectively trading accuracy for memory savings.  The
exact level of inaccuracy is difficult to generalize, since it depends on your
data distribution and volume of data being aggregated
</simpara>
</listitem>
</itemizedlist>
<simpara>The following chart shows the relative error on a uniform distribution depending
on the number of collected values and the requested percentile:</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/percentiles_error.png"/>
  </imageobject>
  <textobject><phrase>images/percentiles_error.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>It shows how precision is better for extreme percentiles. The reason why error diminishes
for large number of values is that the law of large numbers makes the distribution of
values more and more uniform and the t-digest tree can do a better job at summarizing
it. It would not be the case on more skewed distributions.</simpara>
</section>
<section id="search-aggregations-metrics-percentile-aggregation-compression">
<title>Compression<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>The <literal>compression</literal> parameter is specific to the current internal implementation of percentiles, and may change in the future.</simpara></warning>
<simpara>Approximate algorithms must balance memory utilization with estimation accuracy.
This balance can be controlled using a <literal>compression</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "tdigest": {
                  "compression" : 200 <co id="CO59-1"/>
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO59-1">
<para>
Compression controls memory usage and approximation error
</para>
</callout>
</calloutlist>
<simpara>The TDigest algorithm uses a number of "nodes" to approximate percentiles&#8201;&#8212;&#8201;the
more nodes available, the higher the accuracy (and large memory footprint) proportional
to the volume of data.  The <literal>compression</literal> parameter limits the maximum number of
nodes to <literal>20 * compression</literal>.</simpara>
<simpara>Therefore, by increasing the compression value, you can increase the accuracy of
your percentiles at the cost of more memory.  Larger compression values also
make the algorithm slower since the underlying tree data structure grows in size,
resulting in more expensive operations.  The default compression value is
<literal>100</literal>.</simpara>
<simpara>A "node" uses roughly 32 bytes of memory, so under worst-case scenarios (large amount
of data which arrives sorted and in-order) the default settings will produce a
TDigest roughly 64KB in size.  In practice data tends to be more random and
the TDigest will use less memory.</simpara>
</section>
<section id="_hdr_histogram">
<title>HDR Histogram<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara><ulink url="https://github.com/HdrHistogram/HdrHistogram">HDR Histogram</ulink> (High Dynamic Range Histogram) is an alternative implementation
that can be useful when calculating percentiles for latency measurements as it can be faster than the t-digest implementation
with the trade-off of a larger memory footprint. This implementation maintains a fixed worse-case percentage error (specified
as a number of significant digits). This means that if data is recorded with values from 1 microsecond up to 1 hour
(3,600,000,000 microseconds) in a histogram set to 3 significant digits, it will maintain a value resolution of 1 microsecond
for values up to 1 millisecond and 3.6 seconds (or better) for the maximum tracked value (1 hour).</simpara>
<simpara>The HDR Histogram can be used by specifying the <literal>method</literal> parameter in the request:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "percents" : [95, 99, 99.9],
                "hdr": { <co id="CO60-1"/>
                  "number_of_significant_value_digits" : 3 <co id="CO60-2"/>
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO60-1">
<para>
<literal>hdr</literal> object indicates that HDR Histogram should be used to calculate the percentiles and specific settings for this algorithm can be specified inside the object
</para>
</callout>
<callout arearefs="CO60-2">
<para>
<literal>number_of_significant_value_digits</literal> specifies the resolution of values for the histogram in number of significant digits
</para>
</callout>
</calloutlist>
<simpara>The HDRHistogram only supports positive values and will error if it is passed a negative value. It is also not a good idea to use
the HDRHistogram if the range of values is unknown as this could lead to high memory usage.</simpara>
</section>
<section id="_missing_value_6">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grade_percentiles" : {
            "percentiles" : {
                "field" : "grade",
                "missing": 10 <co id="CO61-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO61-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>10</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-percentile-rank-aggregation">
<title>Percentile Ranks Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-rank-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>multi-value</literal> metrics aggregation that calculates one or more percentile ranks
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</simpara>
<note>
<simpara>Please see <xref linkend="search-aggregations-metrics-percentile-aggregation-approximation"/>
and <xref linkend="search-aggregations-metrics-percentile-aggregation-compression"/> for advice
regarding approximation and memory use of the percentile ranks aggregation</simpara>
</note>
<simpara>Percentile rank show the percentage of observed values which are below certain
value.  For example, if a value is greater than or equal to 95% of the observed values
it is said to be at the 95th percentile rank.</simpara>
<simpara>Assume your data consists of website load times.  You may have a service agreement that
95% of page loads completely within 15ms and 99% of page loads complete within 30ms.</simpara>
<simpara>Let&#8217;s look at a range of percentiles representing load time:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "field" : "load_time", <co id="CO62-1"/>
                "values" : [15, 30]
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO62-1">
<para>
The field <literal>load_time</literal> must be a numeric field
</para>
</callout>
</calloutlist>
<simpara>The response will look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "values" : {
            "15": 92,
            "30": 100
         }
      }
   }
}</programlisting>
<simpara>From this information you can determine you are hitting the 99% load time target but not quite
hitting the 95% load time target</simpara>
<section id="_script_7">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-rank-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The percentile rank metric supports scripting.  For example, if our load times
are in milliseconds but we want to specify values in seconds, we could use
a script to convert them on-the-fly:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "values" : [3, 5],
                "script" : {
                    "inline": "doc['load_time'].value / timeUnit", <co id="CO63-1"/>
                    "params" : {
                        "timeUnit" : 1000   <co id="CO63-2"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO63-1">
<para>
The <literal>field</literal> parameter is replaced with a <literal>script</literal> parameter, which uses the
script to generate values which percentile ranks are calculated on
</para>
</callout>
<callout arearefs="CO63-2">
<para>
Scripting supports parameterized input just like any other script
</para>
</callout>
</calloutlist>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "values" : [3, 5],
                "script" : {
                    "file": "my_script",
                    "params" : {
                        "timeUnit" : 1000
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_hdr_histogram_2">
<title>HDR Histogram<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-rank-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara><ulink url="https://github.com/HdrHistogram/HdrHistogram">HDR Histogram</ulink> (High Dynamic Range Histogram) is an alternative implementation
that can be useful when calculating percentile ranks for latency measurements as it can be faster than the t-digest implementation
with the trade-off of a larger memory footprint. This implementation maintains a fixed worse-case percentage error (specified as a
number of significant digits). This means that if data is recorded with values from 1 microsecond up to 1 hour (3,600,000,000
microseconds) in a histogram set to 3 significant digits, it will maintain a value resolution of 1 microsecond for values up to
1 millisecond and 3.6 seconds (or better) for the maximum tracked value (1 hour).</simpara>
<simpara>The HDR Histogram can be used by specifying the <literal>method</literal> parameter in the request:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "field" : "load_time",
                "values" : [15, 30],
                "hdr": { <co id="CO64-1"/>
                  "number_of_significant_value_digits" : 3 <co id="CO64-2"/>
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO64-1">
<para>
<literal>hdr</literal> object indicates that HDR Histogram should be used to calculate the percentiles and specific settings for this algorithm can be specified inside the object
</para>
</callout>
<callout arearefs="CO64-2">
<para>
<literal>number_of_significant_value_digits</literal> specifies the resolution of values for the histogram in number of significant digits
</para>
</callout>
</calloutlist>
<simpara>The HDRHistogram only supports positive values and will error if it is passed a negative value. It is also not a good idea to use
the HDRHistogram if the range of values is unknown as this could lead to high memory usage.</simpara>
</section>
<section id="_missing_value_7">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/percentile-rank-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grade_ranks" : {
            "percentile_ranks" : {
                "field" : "grade",
                "missing": 10 <co id="CO65-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO65-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>10</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-scripted-metric-aggregation">
<title>Scripted Metric Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A metric aggregation that executes using scripts to provide a metric output.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match_all" : {}
    },
    "aggs": {
        "profit": {
            "scripted_metric": {
                "init_script" : "_agg['transactions'] = []",
                "map_script" : "if (doc['type'].value == \"sale\") { _agg.transactions.add(doc['amount'].value) } else { _agg.transactions.add(-1 * doc['amount'].value) }", <co id="CO66-1"/>
                "combine_script" : "profit = 0; for (t in _agg.transactions) { profit += t }; return profit",
                "reduce_script" : "profit = 0; for (a in _aggs) { profit += a }; return profit"
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO66-1">
<para>
<literal>map_script</literal> is the only required  parameter
</para>
</callout>
</calloutlist>
<simpara>The above aggregation demonstrates how one would use the script aggregation compute the total profit from sale and cost transactions.</simpara>
<simpara>The response for the above aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</programlisting>
<simpara>The above example can also be specified using file scripts as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match_all" : {}
    },
    "aggs": {
        "profit": {
            "scripted_metric": {
                "init_script" : {
                    "file": "my_init_script"
                },
                "map_script" : {
                    "file": "my_map_script"
                },
                "combine_script" : {
                    "file": "my_combine_script"
                },
                "params": {
                    "field": "amount" <co id="CO67-1"/>
                },
                "reduce_script" : {
                    "file": "my_reduce_script"
                },
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO67-1">
<para>
script parameters for init, map and combine scripts must be specified in a global <literal>params</literal> object so that it can be share between the scripts
</para>
</callout>
</calloutlist>
<simpara>For more details on specifying scripts see <link linkend="modules-scripting">script documentation</link>.</simpara>
<section id="_allowed_return_types">
<title>Allowed return types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Whilst and valid script object can be used within a single script. the scripts must return or store in the <literal>_agg</literal> object only the following types:</simpara>
<itemizedlist>
<listitem>
<simpara>
primitive types
</simpara>
</listitem>
<listitem>
<simpara>
String
</simpara>
</listitem>
<listitem>
<simpara>
Map (containing only keys and values of the types listed here)
</simpara>
</listitem>
<listitem>
<simpara>
Array (containing elements of only the types listed here)
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_scope_of_scripts">
<title>Scope of scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The scripted metric aggregation uses scripts at 4 stages of its execution:</simpara>
<variablelist>
<varlistentry>
<term>
init_script
</term>
<listitem>
<simpara>
Executed prior to any collection of documents. Allows the aggregation to set up any initial state.
</simpara>
<simpara>In the above example, the <literal>init_script</literal> creates an array <literal>transactions</literal> in the <literal>_agg</literal> object.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
map_script
</term>
<listitem>
<simpara>
Executed once per document collected. This is the only required script. If no combine_script is specified, the resulting state
                    needs to be stored in an object named <literal>_agg</literal>.
</simpara>
<simpara>In the above example, the <literal>map_script</literal> checks the value of the type field. If the value if <emphasis>sale</emphasis> the value of the amount field
is added to the transactions array. If the value of the type field is not <emphasis>sale</emphasis> the negated value of the amount field is added
to transactions.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
combine_script
</term>
<listitem>
<simpara>
Executed once on each shard after document collection is complete. Allows the aggregation to consolidate the state returned from
                    each shard. If a combine_script is not provided the combine phase will return the aggregation variable.
</simpara>
<simpara>In the above example, the <literal>combine_script</literal> iterates through all the stored transactions, summing the values in the <literal>profit</literal> variable
and finally returns <literal>profit</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
reduce_script
</term>
<listitem>
<simpara>
Executed once on the coordinating node after all shards have returned their results. The script is provided with access to a
                    variable <literal>_aggs</literal> which is an array of the result of the combine_script on each shard. If a reduce_script is not provided
                    the reduce phase will return the <literal>_aggs</literal> variable.
</simpara>
<simpara>In the above example, the <literal>reduce_script</literal> iterates through the <literal>profit</literal> returned by each shard summing the values before returning the
final combined profit which will be returned in the response of the aggregation.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_worked_example">
<title>Worked Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Imagine a situation where you index the following documents into and index with 2 shards:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/transactions/stock/1' -d '
{
    "type": "sale",
    "amount": 80
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/2' -d '
{
    "type": "cost",
    "amount": 10
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/3' -d '
{
    "type": "cost",
    "amount": 30
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/4' -d '
{
    "type": "sale",
    "amount": 130
}
'</programlisting>
<simpara>Lets say that documents 1 and 3 end up on shard A and documents 2 and 4 end up on shard B. The following is a breakdown of what the aggregation result is
at each stage of the example above.</simpara>
<section id="_before_init_script">
<title>Before init_script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>No params object was specified so the default params object is used:</simpara>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {}
}</programlisting>
</section>
<section id="_after_init_script">
<title>After init_script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>This is run once on each shard before any document collection is performed, and so we will have a copy on each shard:</simpara>
<variablelist>
<varlistentry>
<term>
Shard A
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</programlisting>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shard B
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</programlisting>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_after_map_script">
<title>After map_script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Each shard collects its documents and runs the map_script on each document that is collected:</simpara>
<variablelist>
<varlistentry>
<term>
Shard A
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {
        "transactions" : [ 80, -30 ]
    }
}</programlisting>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shard B
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {
        "transactions" : [ -10, 130 ]
    }
}</programlisting>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_after_combine_script">
<title>After combine_script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The combine_script is executed on each shard after document collection is complete and reduces all the transactions down to a single profit figure for each
shard (by summing the values in the transactions array) which is passed back to the coordinating node:</simpara>
<variablelist>
<varlistentry>
<term>
Shard A
</term>
<listitem>
<simpara>
50
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shard B
</term>
<listitem>
<simpara>
120
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_after_reduce_script">
<title>After reduce_script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The reduce_script receives an <literal>_aggs</literal> array containing the result of the combine script for each shard:</simpara>
<programlisting language="js" linenumbering="unnumbered">"_aggs" : [
    50,
    120
]</programlisting>
<simpara>It reduces the responses for the shards down to a final overall profit figure (by summing the values) and returns this as the result of the aggregation to
produce the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</programlisting>
</section>
</section>
<section id="_other_parameters">
<title>Other Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/scripted-metric-aggregation.asciidoc">Edit me</ulink></title>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
params
</simpara>
</entry>
<entry>
<simpara>
Optional. An object whose contents will be passed as variables to the  <literal>init_script</literal>, <literal>map_script</literal> and <literal>combine_script</literal>. This can be
                   useful to allow the user to control the behavior of the aggregation and for storing state between the scripts. If this is not specified,
                   the default is the equivalent of providing:
</simpara>
<programlisting language="js" linenumbering="unnumbered">"params" : {
    "_agg" : {}
}</programlisting>
</entry>
</row>
<row>
<entry>
<simpara>
reduce_params
</simpara>
</entry>
<entry>
<simpara>
Optional. An object whose contents will be passed as variables to the <literal>reduce_script</literal>. This can be useful to allow the user to control
                   the behavior of the reduce phase. If this is not specified the variable will be undefined in the reduce_script execution.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="search-aggregations-metrics-stats-aggregation">
<title>Stats Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/stats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>multi-value</literal> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>The stats that are returned consist of: <literal>min</literal>, <literal>max</literal>, <literal>sum</literal>, <literal>count</literal> and <literal>avg</literal>.</simpara>
<simpara>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_stats" : { "stats" : { "field" : "grade" } }
    }
}</programlisting>
<simpara>The above aggregation computes the grades statistics over all documents. The aggregation type is <literal>stats</literal> and the <literal>field</literal> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "grades_stats": {
            "count": 6,
            "min": 60,
            "max": 98,
            "avg": 78.5,
            "sum": 471
        }
    }
}</programlisting>
<simpara>The name of the aggregation (<literal>grades_stats</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_script_8">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/stats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the grades stats based on a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_stats" : { "stats" : { "script" : "doc['grade'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_stats" : {
            "stats" : {
                "script" : {
                    "file": "my_script",
                    "params" : {
                        "field" : "grade"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
<section id="_value_script_5">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/stats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use a value script to get the new stats:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "stats" : {
                    "field" : "grade",
                    "script" :
                        "inline": "_value * correction",
                        "params" : {
                            "correction" : 1.2
                        }
                    }
                }
            }
        }
    }
}</programlisting>
</section>
</section>
<section id="_missing_value_8">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/stats-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_stats" : {
            "stats" : {
                "field" : "grade",
                "missing": 0 <co id="CO68-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO68-1">
<para>
Documents without a value in the <literal>grade</literal> field will fall into the same bucket as documents that have the value <literal>0</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-sum-aggregation">
<title>Sum Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/sum-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that sums up numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</simpara>
<simpara>Assuming the data consists of documents representing stock ticks, where each tick holds the change in the stock price from the previous tick.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "constant_score" : {
            "filter" : {
                "range" : { "timestamp" : { "from" : "now/1d+9.5h", "to" : "now/1d+16h" }}
            }
        }
    },
    "aggs" : {
        "intraday_return" : { "sum" : { "field" : "change" } }
    }
}</programlisting>
<simpara>The above aggregation sums up all changes in the today&#8217;s trading stock ticks which accounts for the intraday return. The aggregation type is <literal>sum</literal> and the <literal>field</literal> setting defines the numeric field of the documents of which values will be summed up. The above will return the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "intraday_return": {
           "value": 2.18
        }
    }
}</programlisting>
<simpara>The name of the aggregation (<literal>intraday_return</literal> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</simpara>
<section id="_script_9">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/sum-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the intraday return based on a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "intraday_return" : { "sum" : { "script" : "doc['change'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "intraday_return" : {
            "sum" : {
                "script" : {
                    "file": "my_script",
                    "params" : {
                        "field" : "change"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
<section id="_value_script_6">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/sum-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Computing the sum of squares over all stock tick changes:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        ...

        "aggs" : {
            "daytime_return" : {
                "sum" : {
                    "field" : "change",
                    "script" : "_value * _value"
                }
            }
        }
    }
}</programlisting>
</section>
</section>
<section id="_missing_value_9">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/sum-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "total_time" : {
            "sum" : {
                "field" : "took",
                "missing": 100 <co id="CO69-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO69-1">
<para>
Documents without a value in the <literal>took</literal> field will fall into the same bucket as documents that have the value <literal>100</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-metrics-top-hits-aggregation">
<title>Top hits Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>top_hits</literal> metric aggregator keeps track of the most relevant document being aggregated. This aggregator is intended
to be used as a sub aggregator, so that the top matching documents can be aggregated per bucket.</simpara>
<simpara>The <literal>top_hits</literal> aggregator can effectively be used to group result sets by certain fields via a bucket aggregator.
One or more bucket aggregators determines by which properties a result set get sliced into.</simpara>
<section id="_options_2">
<title>Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<itemizedlist>
<listitem>
<simpara>
<literal>from</literal> - The offset from the first result you want to fetch.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>size</literal> - The maximum number of top matching hits to return per bucket. By default the top three matching hits are returned.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>sort</literal> - How the top matching hits should be sorted. By default the hits are sorted by the score of the main query.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_supported_per_hit_features">
<title>Supported per hit features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The top_hits aggregation returns regular search hits, because of this many per hit features can be supported:</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="search-request-highlighting">Highlighting</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-explain">Explain</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-named-queries-and-filters">Named filters and queries</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-source-filtering">Source filtering</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-script-fields">Script fields</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-fielddata-fields">Fielddata fields</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-request-version">Include versions</link>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_example_3">
<title>Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<simpara>In the following example we group the questions by tag and per tag we show the last active question. For each question
only the title field is being included in the source.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs": {
        "top-tags": {
            "terms": {
                "field": "tags",
                "size": 3
            },
            "aggs": {
                "top_tag_hits": {
                    "top_hits": {
                        "sort": [
                            {
                                "last_activity_date": {
                                    "order": "desc"
                                }
                            }
                        ],
                        "_source": {
                            "include": [
                                "title"
                            ]
                        },
                        "size" : 1
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>Possible response snippet:</simpara>
<programlisting language="js" linenumbering="unnumbered">"aggregations": {
  "top-tags": {
     "buckets": [
        {
           "key": "windows-7",
           "doc_count": 25365,
           "top_tags_hits": {
              "hits": {
                 "total": 25365,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602679",
                       "_score": 1,
                       "_source": {
                          "title": "Windows port opening"
                       },
                       "sort": [
                          1370143231177
                       ]
                    }
                 ]
              }
           }
        },
        {
           "key": "linux",
           "doc_count": 18342,
           "top_tags_hits": {
              "hits": {
                 "total": 18342,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602672",
                       "_score": 1,
                       "_source": {
                          "title": "Ubuntu RFID Screensaver lock-unlock"
                       },
                       "sort": [
                          1370143379747
                       ]
                    }
                 ]
              }
           }
        },
        {
           "key": "windows",
           "doc_count": 18119,
           "top_tags_hits": {
              "hits": {
                 "total": 18119,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602678",
                       "_score": 1,
                       "_source": {
                          "title": "If I change my computers date / time, what could be affected?"
                       },
                       "sort": [
                          1370142868283
                       ]
                    }
                 ]
              }
           }
        }
     ]
  }
}</programlisting>
</section>
<section id="_field_collapse_example">
<title>Field collapse example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Field collapsing or result grouping is a feature that logically groups a result set into groups and per group returns
top documents. The ordering of the groups is determined by the relevancy of the first document in a group. In
Elasticsearch this can be implemented via a bucket aggregator that wraps a <literal>top_hits</literal> aggregator as sub-aggregator.</simpara>
<simpara>In the example below we search across crawled webpages. For each webpage we store the body and the domain the webpage
belong to. By defining a <literal>terms</literal> aggregator on the <literal>domain</literal> field we group the result set of webpages by domain. The
<literal>top_hits</literal> aggregator is then defined as sub-aggregator, so that the top matching hits are collected per bucket.</simpara>
<simpara>Also a <literal>max</literal> aggregator is defined which is used by the <literal>terms</literal> aggregator&#8217;s order feature the return the buckets by
relevancy order of the most relevant document in a bucket.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "query": {
    "match": {
      "body": "elections"
    }
  },
  "aggs": {
    "top-sites": {
      "terms": {
        "field": "domain",
        "order": {
          "top_hit": "desc"
        }
      },
      "aggs": {
        "top_tags_hits": {
          "top_hits": {}
        },
        "top_hit" : {
          "max": {
            "script": "_score"
          }
        }
      }
    }
  }
}</programlisting>
<simpara>At the moment the <literal>max</literal> (or <literal>min</literal>) aggregator is needed to make sure the buckets from the <literal>terms</literal> aggregator are
ordered according to the score of the most relevant webpage per domain. Unfortunately the <literal>top_hits</literal> aggregator
can&#8217;t be used in the <literal>order</literal> option of the <literal>terms</literal> aggregator yet.</simpara>
</section>
<section id="_top_hits_support_in_a_nested_or_reverse_nested_aggregator">
<title>top_hits support in a nested or reverse_nested aggregator<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/tophits-aggregation.asciidoc">Edit me</ulink></title>
<simpara>If the <literal>top_hits</literal> aggregator is wrapped in a <literal>nested</literal> or <literal>reverse_nested</literal> aggregator then nested hits are being returned.
Nested hits are in a sense hidden mini documents that are part of regular document where in the mapping a nested field type
has been configured. The <literal>top_hits</literal> aggregator has the ability to un-hide these documents if it is wrapped in a <literal>nested</literal>
or <literal>reverse_nested</literal> aggregator. Read more about nested in the <link linkend="nested">nested type mapping</link>.</simpara>
<simpara>If nested type has been configured a single document is actually indexed as multiple Lucene documents and they share
the same id. In order to determine the identity of a nested hit there is more needed than just the id, so that is why
nested hits also include their nested identity. The nested identity is kept under the <literal>_nested</literal> field in the search hit
and includes the array field and the offset in the array field the nested hit belongs to. The offset is zero based.</simpara>
<simpara>Top hits response snippet with a nested hit, which resides in the third slot of array field <literal>nested_field1</literal> in document with id <literal>1</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
"hits": {
 "total": 25365,
 "max_score": 1,
 "hits": [
   {
     "_index": "a",
     "_type": "b",
     "_id": "1",
     "_score": 1,
     "_nested" : {
       "field" : "nested_field1",
       "offset" : 2
     }
     "_source": ...
   },
   ...
 ]
}
...</programlisting>
<simpara>If <literal>_source</literal> is requested then just the part of the source of the nested object is returned, not the entire source of the document.
Also stored fields on the <emphasis role="strong">nested</emphasis> inner object level are accessible via <literal>top_hits</literal> aggregator residing in a <literal>nested</literal> or <literal>reverse_nested</literal> aggregator.</simpara>
<simpara>Only nested hits will have a <literal>_nested</literal> field in the hit, non nested (regular) hits will not have a <literal>_nested</literal> field.</simpara>
<simpara>The information in <literal>_nested</literal> can also be used to parse the original source somewhere else if <literal>_source</literal> isn&#8217;t enabled.</simpara>
<simpara>If there are multiple levels of nested object types defined in mappings then the <literal>_nested</literal> information can also be hierarchical
in order to express the identity of nested hits that are two layers deep or more.</simpara>
<simpara>In the example below a nested hit resides in the first slot of the field <literal>nested_grand_child_field</literal> which then resides in
the second slow of the <literal>nested_child_field</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
"hits": {
 "total": 2565,
 "max_score": 1,
 "hits": [
   {
     "_index": "a",
     "_type": "b",
     "_id": "1",
     "_score": 1,
     "_nested" : {
       "field" : "nested_child_field",
       "offset" : 1,
       "_nested" : {
         "field" : "nested_grand_child_field",
         "offset" : 0
       }
     }
     "_source": ...
   },
   ...
 ]
}
...</programlisting>
</section>
</section>
<section id="search-aggregations-metrics-valuecount-aggregation">
<title>Value Count Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/valuecount-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>single-value</literal> metrics aggregation that counts the number of values that are extracted from the aggregated documents.
These values can be extracted either from specific fields in the documents, or be generated by a provided script. Typically,
this aggregator will be used in conjunction with other single-value aggregations. For example, when computing the <literal>avg</literal>
one might be interested in the number of values the average is computed over.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "grades_count" : { "value_count" : { "field" : "grade" } }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "grades_count": {
            "value": 10
        }
    }
}</programlisting>
<simpara>The name of the aggregation (<literal>grades_count</literal> above) also serves as the key by which the aggregation result can be
retrieved from the returned response.</simpara>
<section id="_script_10">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/metrics/valuecount-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Counting the values generated by a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_count" : { "value_count" : { "script" : "doc['grade'].value" } }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...,

    "aggs" : {
        "grades_count" : {
            "value_count" : {
                "script" : {
                    "file": "my_script",
                    "params" : {
                        "field" : "grade"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
</section>
</chapter>
<chapter id="search-aggregations-bucket">
<title>Bucket Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket.asciidoc">Edit me</ulink></title>
<simpara>Bucket aggregations don&#8217;t calculate metrics over fields like the metrics aggregations do, but instead, they create
buckets of documents. Each bucket is associated with a criterion (depending on the aggregation type) which determines
whether or not a document in the current context "falls" into it. In other words, the buckets effectively define document
sets. In addition to the buckets themselves, the <literal>bucket</literal> aggregations also compute and return the number of documents
that "fell into" each bucket.</simpara>
<simpara>Bucket aggregations, as opposed to <literal>metrics</literal> aggregations, can hold sub-aggregations. These sub-aggregations will be
aggregated for the buckets created by their "parent" bucket aggregation.</simpara>
<simpara>There are different bucket aggregators, each with a different "bucketing" strategy. Some define a single bucket, some
define fixed number of multiple buckets, and others dynamically create the buckets during the aggregation process.</simpara>
<section id="search-aggregations-bucket-children-aggregation">
<title>Children Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/children-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A special single bucket aggregation that enables aggregating from buckets on parent document types to buckets on child documents.</simpara>
<simpara>This aggregation relies on the <link linkend="mapping-parent-field">_parent field</link> in the mapping. This aggregation has a single option:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>type</literal> - The what child type the buckets in the parent space should be mapped to.
</simpara>
</listitem>
</itemizedlist>
<simpara>For example, let&#8217;s say we have an index of questions and answers. The answer type has the following <literal>_parent</literal> field in the mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "answer" : {
        "_parent" : {
            "type" : "question"
        }
    }
}</programlisting>
<simpara>The question typed document contain a tag field and the answer typed documents contain an owner field. With the <literal>children</literal>
aggregation the tag buckets can be mapped to the owner buckets in a single request even though the two fields exist in
two different kinds of documents.</simpara>
<simpara>An example of a question typed document:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "body": "&lt;p&gt;I have Windows 2003 server and i bought a new Windows 2008 server...",
    "title": "Whats the best way to file transfer my site from server to a newer one?",
    "tags": [
        "windows-server-2003",
        "windows-server-2008",
        "file-transfer"
    ],
}</programlisting>
<simpara>An example of an answer typed document:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "owner": {
        "location": "Norfolk, United Kingdom",
        "display_name": "Sam",
        "id": 48
    },
    "body": "&lt;p&gt;Unfortunately your pretty much limited to FTP...",
    "creation_date": "2009-05-04T13:45:37.030"
}</programlisting>
<simpara>The following request can be built that connects the two together:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggs": {
    "top-tags": {
      "terms": {
        "field": "tags",
        "size": 10
      },
      "aggs": {
        "to-answers": {
          "children": {
            "type" : "answer" <co id="CO70-1"/>
          },
          "aggs": {
            "top-names": {
              "terms": {
                "field": "owner.display_name",
                "size": 10
              }
            }
          }
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO70-1">
<para>
The <literal>type</literal> points to type / mapping with the name <literal>answer</literal>.
</para>
</callout>
</calloutlist>
<simpara>The above example returns the top question tags and per tag the top answer owners.</simpara>
<simpara>Possible response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggregations": {
    "top-tags": {
      "buckets": [
        {
          "key": "windows-server-2003",
          "doc_count": 25365, <co id="CO71-1"/>
          "to-answers": {
            "doc_count": 36004, <co id="CO71-2"/>
            "top-names": {
              "buckets": [
                {
                  "key": "Sam",
                  "doc_count": 274
                },
                {
                  "key": "chris",
                  "doc_count": 19
                },
                {
                  "key": "david",
                  "doc_count": 14
                },
                ...
              ]
            }
          }
        },
        {
          "key": "linux",
          "doc_count": 18342,
          "to-answers": {
            "doc_count": 6655,
            "top-names": {
              "buckets": [
                {
                  "key": "abrams",
                  "doc_count": 25
                },
                {
                  "key": "ignacio",
                  "doc_count": 25
                },
                {
                  "key": "vazquez",
                  "doc_count": 25
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows",
          "doc_count": 18119,
          "to-answers": {
            "doc_count": 24051,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 265
                },
                {
                  "key": "david",
                  "doc_count": 27
                },
                {
                  "key": "chris",
                  "doc_count": 26
                },
                ...
              ]
            }
          }
        },
        {
          "key": "osx",
          "doc_count": 10971,
          "to-answers": {
            "doc_count": 5902,
            "top-names": {
              "buckets": [
                {
                  "key": "diago",
                  "doc_count": 4
                },
                {
                  "key": "albert",
                  "doc_count": 3
                },
                {
                  "key": "asmus",
                  "doc_count": 3
                },
                ...
              ]
            }
          }
        },
        {
          "key": "ubuntu",
          "doc_count": 8743,
          "to-answers": {
            "doc_count": 8784,
            "top-names": {
              "buckets": [
                {
                  "key": "ignacio",
                  "doc_count": 9
                },
                {
                  "key": "abrams",
                  "doc_count": 8
                },
                {
                  "key": "molly7244",
                  "doc_count": 8
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows-xp",
          "doc_count": 7517,
          "to-answers": {
            "doc_count": 13610,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 232
                },
                {
                  "key": "chris",
                  "doc_count": 9
                },
                {
                  "key": "john",
                  "doc_count": 9
                },
                ...
              ]
            }
          }
        },
        {
          "key": "networking",
          "doc_count": 6739,
          "to-answers": {
            "doc_count": 2076,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 6
                },
                {
                  "key": "alnitak",
                  "doc_count": 5
                },
                {
                  "key": "chris",
                  "doc_count": 3
                },
                ...
              ]
            }
          }
        },
        {
          "key": "mac",
          "doc_count": 5590,
          "to-answers": {
            "doc_count": 999,
            "top-names": {
              "buckets": [
                {
                  "key": "abrams",
                  "doc_count": 2
                },
                {
                  "key": "ignacio",
                  "doc_count": 2
                },
                {
                  "key": "vazquez",
                  "doc_count": 2
                },
                ...
              ]
            }
          }
        },
        {
          "key": "wireless-networking",
          "doc_count": 4409,
          "to-answers": {
            "doc_count": 6497,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 61
                },
                {
                  "key": "chris",
                  "doc_count": 5
                },
                {
                  "key": "mike",
                  "doc_count": 5
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows-8",
          "doc_count": 3601,
          "to-answers": {
            "doc_count": 4263,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 3
                },
                {
                  "key": "msft",
                  "doc_count": 2
                },
                {
                  "key": "user172132",
                  "doc_count": 2
                },
                ...
              ]
            }
          }
        }
      ]
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO71-1">
<para>
The number of question documents with the tag <literal>windows-server-2003</literal>.
</para>
</callout>
<callout arearefs="CO71-2">
<para>
The number of answer documents that are related to question documents with the tag <literal>windows-server-2003</literal>.
</para>
</callout>
</calloutlist>
</section>
<section id="search-aggregations-bucket-datehistogram-aggregation">
<title>Date Histogram Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket aggregation similar to the <link linkend="search-aggregations-bucket-histogram-aggregation">histogram</link> except it can
only be applied on date values. Since dates are represented in elasticsearch internally as long values, it is possible
to use the normal <literal>histogram</literal> on dates as well, though accuracy will be compromised. The reason for this is in the fact
that time based intervals are not fixed (think of leap years and on the number of days in a month). For this reason,
we need special support for time based data. From a functionality perspective, this histogram supports the same features
as the normal <link linkend="search-aggregations-bucket-histogram-aggregation">histogram</link>. The main difference is that the interval can be specified by date/time expressions.</simpara>
<simpara>Requesting bucket intervals of a month.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            }
        }
    }
}</programlisting>
<simpara>Available expressions for interval: <literal>year</literal>, <literal>quarter</literal>, <literal>month</literal>, <literal>week</literal>, <literal>day</literal>, <literal>hour</literal>, <literal>minute</literal>, <literal>second</literal></simpara>
<simpara>Fractional values are allowed for seconds, minutes, hours, days and weeks. For example 1.5 hours:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1.5h"
            }
        }
    }
}</programlisting>
<simpara>See <xref linkend="time-units"/> for accepted abbreviations.</simpara>
<section id="_keys">
<title>Keys<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Internally, a date is represented as a 64 bit number representing a timestamp
in milliseconds-since-the-epoch. These timestamps are returned as the bucket
<literal>key</literal>s. The <literal>key_as_string</literal> is the same timestamp converted to a formatted
date string using the format specified with the <literal>format</literal> parameter:</simpara>
<tip><simpara>If no <literal>format</literal> is specified, then it will use the first date
<link linkend="mapping-date-format">format</link> specified in the field mapping.</simpara></tip>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1M",
                "format" : "yyyy-MM-dd" <co id="CO72-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO72-1">
<para>
Supports expressive date <link linkend="date-format-pattern">format pattern</link>
</para>
</callout>
</calloutlist>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "articles_over_time": {
            "buckets": [
                {
                    "key_as_string": "2013-02-02",
                    "key": 1328140800000,
                    "doc_count": 1
                },
                {
                    "key_as_string": "2013-03-02",
                    "key": 1330646400000,
                    "doc_count": 2
                },
                ...
            ]
        }
    }
}</programlisting>
</section>
<section id="_time_zone">
<title>Time Zone<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Date-times are stored in Elasticsearch in UTC.  By default, all bucketing and
rounding is also done in UTC. The <literal>time_zone</literal> parameter can be used to indicate
that bucketing should use a different time zone.</simpara>
<simpara>Time zones may either be specified as an ISO 8601 UTC offset (e.g. <literal>+01:00</literal> or
<literal>-08:00</literal>)  or as a timezone id, an identifier used in the TZ database like
<literal>America/Los_Angeles</literal>.</simpara>
<simpara>Consider the following example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/log/1
{
  "date": "2015-10-01T00:30:00Z"
}

PUT my_index/log/2
{
  "date": "2015-10-01T01:30:00Z"
}

GET my_index/_search?size=0
{
  "aggs": {
    "by_day": {
      "date_histogram": {
        "field":     "date",
        "interval":  "day"
      }
    }
  }
}</programlisting>
<simpara>UTC is used if no time zone is specified, which would result in both of these
documents being placed into the same day bucket, which starts at midnight UTC
on 1 October 2015:</simpara>
<programlisting language="js" linenumbering="unnumbered">"aggregations": {
  "by_day": {
    "buckets": [
      {
        "key_as_string": "2015-10-01T00:00:00.000Z",
        "key":           1443657600000,
        "doc_count":     2
      }
    ]
  }
}</programlisting>
<simpara>If a <literal>time_zone</literal> of <literal>-01:00</literal> is specified, then midnight starts at one hour before
midnight UTC:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search?size=0
{
  "aggs": {
    "by_day": {
      "date_histogram": {
        "field":     "date",
        "interval":  "day",
        "time_zone": "-01:00"
      }
    }
  }
}</programlisting>
<simpara>Now the first document falls into the bucket for 30 September 2015, while the
second document falls into the bucket for 1 October 2015:</simpara>
<programlisting language="js" linenumbering="unnumbered">"aggregations": {
  "by_day": {
    "buckets": [
      {
        "key_as_string": "2015-09-30T00:00:00.000-01:00", <co id="CO73-1"/>
        "key": 1443571200000,
        "doc_count": 1
      },
      {
        "key_as_string": "2015-10-01T00:00:00.000-01:00", <co id="CO73-2"/>
        "key": 1443657600000,
        "doc_count": 1
      }
    ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO73-1 CO73-2">
<para>
The <literal>key_as_string</literal> value represents midnight on each day
    in the specified time zone.
</para>
</callout>
</calloutlist>
</section>
<section id="_offset">
<title>Offset<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>offset</literal> parameter is used to change the start value of each bucket by the
specified positive (<literal>+</literal>) or negative offset (<literal>-</literal>) duration, such as <literal>1h</literal> for
an hour, or <literal>1M</literal> for a month. See <xref linkend="time-units"/> for more possible time
duration options.</simpara>
<simpara>For instance, when using an interval of <literal>day</literal>, each bucket runs from midnight
to midnight.  Setting the <literal>offset</literal> parameter to <literal>+6h</literal> would change each bucket
to run from 6am to 6am:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/log/1
{
  "date": "2015-10-01T05:30:00Z"
}

PUT my_index/log/2
{
  "date": "2015-10-01T06:30:00Z"
}

GET my_index/_search?size=0
{
  "aggs": {
    "by_day": {
      "date_histogram": {
        "field":     "date",
        "interval":  "day",
        "offset":    "+6h"
      }
    }
  }
}</programlisting>
<simpara>Instead of a single bucket starting at midnight, the above request groups the
documents into buckets starting at 6am:</simpara>
<programlisting language="js" linenumbering="unnumbered">"aggregations": {
  "by_day": {
    "buckets": [
      {
        "key_as_string": "2015-09-30T06:00:00.000Z",
        "key": 1443592800000,
        "doc_count": 1
      },
      {
        "key_as_string": "2015-10-01T06:00:00.000Z",
        "key": 1443679200000,
        "doc_count": 1
      }
    ]
  }
}</programlisting>
<note><simpara>The start <literal>offset</literal> of each bucket is calculated after the <literal>time_zone</literal>
adjustments have been made.</simpara></note>
</section>
<section id="_scripts">
<title>Scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Like with the normal <link linkend="search-aggregations-bucket-histogram-aggregation">histogram</link>, both document level scripts and
value level scripts are supported. It is also possible to control the order of the returned buckets using the <literal>order</literal>
settings and filter the returned buckets based on a <literal>min_doc_count</literal> setting (by default all buckets between the first
bucket that matches documents and the last one are returned). This histogram also supports the <literal>extended_bounds</literal>
setting, which enables extending the bounds of the histogram beyond the data itself (to read more on why you&#8217;d want to
do that please refer to the explanation <link linkend="search-aggregations-bucket-histogram-aggregation-extended-bounds">here</link>).</simpara>
</section>
<section id="_missing_value_10">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/datehistogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "publish_date" : {
             "date_histogram" : {
                 "field" : "publish_date",
                 "interval": "year",
                 "missing": "2000-01-01" <co id="CO74-1"/>
             }
         }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO74-1">
<para>
Documents without a value in the <literal>publish_date</literal> field will fall into the same bucket as documents that have the value <literal>2000-01-01</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-bucket-daterange-aggregation">
<title>Date Range Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/daterange-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A range aggregation that is dedicated for date values. The main difference between this aggregation and the normal <link linkend="search-aggregations-bucket-range-aggregation">range</link> aggregation is that the <literal>from</literal> and <literal>to</literal> values can be expressed in <link linkend="date-math">Date Math</link> expressions, and it is also possible to specify a date format by which the <literal>from</literal> and <literal>to</literal> response fields will be returned.
Note that this aggregation includes the <literal>from</literal> value and excludes the <literal>to</literal> value for each range.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs": {
        "range": {
            "date_range": {
                "field": "date",
                "format": "MM-yyy",
                "ranges": [
                    { "to": "now-10M/M" }, <co id="CO75-1"/>
                    { "from": "now-10M/M" } <co id="CO75-2"/>
                ]
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO75-1">
<para>
&lt; now minus 10 months, rounded down to the start of the month.
</para>
</callout>
<callout arearefs="CO75-2">
<para>
&gt;= now minus 10 months, rounded down to the start of the month.
</para>
</callout>
</calloutlist>
<simpara>In the example above, we created two range buckets, the first will "bucket" all documents dated prior to 10 months ago and
the second will "bucket" all documents dated since 10 months ago</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "range": {
            "buckets": [
                {
                    "to": 1.3437792E+12,
                    "to_as_string": "08-2012",
                    "doc_count": 7
                },
                {
                    "from": 1.3437792E+12,
                    "from_as_string": "08-2012",
                    "doc_count": 2
                }
            ]
        }
    }
}</programlisting>
<section id="date-format-pattern">
<title>Date Format/Pattern<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/daterange-aggregation.asciidoc">Edit me</ulink></title>
<note><simpara>this information was copied from <ulink url="http://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html">JodaDate</ulink></simpara></note>
<simpara>All ASCII letters are reserved as format pattern letters, which are defined as follows:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Symbol </entry>
<entry align="left" valign="top">Meaning                </entry>
<entry align="left" valign="top">Presentation       </entry>
<entry align="left" valign="top">Examples</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>G</simpara></entry>
<entry align="left" valign="top"><simpara>era</simpara></entry>
<entry align="left" valign="top"><simpara>text</simpara></entry>
<entry align="left" valign="top"><simpara>AD</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>C</simpara></entry>
<entry align="left" valign="top"><simpara>century of era (&gt;=0)</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>20</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Y</simpara></entry>
<entry align="left" valign="top"><simpara>year of era (&gt;=0)</simpara></entry>
<entry align="left" valign="top"><simpara>year</simpara></entry>
<entry align="left" valign="top"><simpara>1996</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>x</simpara></entry>
<entry align="left" valign="top"><simpara>weekyear</simpara></entry>
<entry align="left" valign="top"><simpara>year</simpara></entry>
<entry align="left" valign="top"><simpara>1996</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>w</simpara></entry>
<entry align="left" valign="top"><simpara>week of weekyear</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>27</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>e</simpara></entry>
<entry align="left" valign="top"><simpara>day of week</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>E</simpara></entry>
<entry align="left" valign="top"><simpara>day of week</simpara></entry>
<entry align="left" valign="top"><simpara>text</simpara></entry>
<entry align="left" valign="top"><simpara>Tuesday; Tue</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>year</simpara></entry>
<entry align="left" valign="top"><simpara>year</simpara></entry>
<entry align="left" valign="top"><simpara>1996</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>D</simpara></entry>
<entry align="left" valign="top"><simpara>day of year</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>189</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>M</simpara></entry>
<entry align="left" valign="top"><simpara>month of year</simpara></entry>
<entry align="left" valign="top"><simpara>month</simpara></entry>
<entry align="left" valign="top"><simpara>July; Jul; 07</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>d</simpara></entry>
<entry align="left" valign="top"><simpara>day of month</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>10</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>a</simpara></entry>
<entry align="left" valign="top"><simpara>halfday of day</simpara></entry>
<entry align="left" valign="top"><simpara>text</simpara></entry>
<entry align="left" valign="top"><simpara>PM</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>K</simpara></entry>
<entry align="left" valign="top"><simpara>hour of halfday (0~11)</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>h</simpara></entry>
<entry align="left" valign="top"><simpara>clockhour of halfday (1~12)</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>12</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>H</simpara></entry>
<entry align="left" valign="top"><simpara>hour of day (0~23)</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>k</simpara></entry>
<entry align="left" valign="top"><simpara>clockhour of day (1~24)</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>24</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>m</simpara></entry>
<entry align="left" valign="top"><simpara>minute of hour</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>s</simpara></entry>
<entry align="left" valign="top"><simpara>second of minute</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>55</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>S</simpara></entry>
<entry align="left" valign="top"><simpara>fraction of second</simpara></entry>
<entry align="left" valign="top"><simpara>number</simpara></entry>
<entry align="left" valign="top"><simpara>978</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>z</simpara></entry>
<entry align="left" valign="top"><simpara>time zone</simpara></entry>
<entry align="left" valign="top"><simpara>text</simpara></entry>
<entry align="left" valign="top"><simpara>Pacific Standard Time; PST</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Z</simpara></entry>
<entry align="left" valign="top"><simpara>time zone offset/id</simpara></entry>
<entry align="left" valign="top"><simpara>zone</simpara></entry>
<entry align="left" valign="top"><simpara>-0800; -08:00; America/Los_Angeles</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>'</simpara></entry>
<entry align="left" valign="top"><simpara>escape for text</simpara></entry>
<entry align="left" valign="top"><simpara>delimiter</simpara></entry>
<entry align="left" valign="top"><simpara>''</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The count of pattern letters determine the format.</simpara>
<variablelist>
<varlistentry>
<term>
Text
</term>
<listitem>
<simpara>
If the number of pattern letters is 4 or more, the full form is used; otherwise a short or abbreviated form is used if available.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Number
</term>
<listitem>
<simpara>
The minimum number of digits. Shorter numbers are zero-padded to this amount.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Year
</term>
<listitem>
<simpara>
Numeric presentation for year and weekyear fields are handled specially. For example, if the count of <emphasis>y</emphasis> is 2, the year will be displayed as the zero-based year of the century, which is two digits.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Month
</term>
<listitem>
<simpara>
3 or over, use text, otherwise use number.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Zone
</term>
<listitem>
<simpara>
<emphasis>Z</emphasis> outputs offset without a colon, <emphasis>ZZ</emphasis> outputs the offset with a colon, <emphasis>ZZZ</emphasis> or more outputs the zone id.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Zone names
</term>
<listitem>
<simpara>
Time zone names (<emphasis>z</emphasis>) cannot be parsed.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Any characters in the pattern that are not in the ranges of [<emphasis>a</emphasis>..<emphasis>z</emphasis>] and [<emphasis>A</emphasis>..<emphasis>Z</emphasis>] will be treated as quoted text. For instance, characters like <emphasis>:</emphasis>, <emphasis>.</emphasis>, ' <emphasis>, '#</emphasis> and <emphasis>?</emphasis> will appear in the resulting time text even they are not embraced within single quotes.</simpara>
</section>
</section>
<section id="search-aggregations-bucket-filter-aggregation">
<title>Filter Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/filter-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Defines a single bucket of all the documents in the current document set context that match a specified filter. Often this will be used to narrow down the current aggregation context to a specific set of documents.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "red_products" : {
            "filter" : { "term": { "color": "red" } },
            "aggs" : {
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</programlisting>
<simpara>In the above example, we calculate the average price of all the products that are red.</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggs" : {
        "red_products" : {
            "doc_count" : 100,
            "avg_price" : { "value" : 56.3 }
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-bucket-filters-aggregation">
<title>Filters Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/filters-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Defines a multi bucket aggregation where each bucket is associated with a
filter. Each bucket will collect all documents that match its associated
filter.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggs" : {
    "messages" : {
      "filters" : {
        "filters" : {
          "errors" :   { "term" : { "body" : "error"   }},
          "warnings" : { "term" : { "body" : "warning" }}
        }
      },
      "aggs" : {
        "monthly" : {
          "histogram" : {
            "field" : "timestamp",
            "interval" : "1M"
          }
        }
      }
    }
  }
}</programlisting>
<simpara>In the above example, we analyze log messages. The aggregation will build two
collection (buckets) of log messages - one for all those containing an error,
and another for all those containing a warning. And for each of these buckets
it will break them down by month.</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
  "aggs" : {
    "messages" : {
      "buckets" : {
        "errors" : {
          "doc_count" : 34,
          "monthly" : {
            "buckets" : [
              ... // the histogram monthly breakdown
            ]
          }
        },
        "warnings" : {
          "doc_count" : 439,
          "monthly" : {
            "buckets" : [
               ... // the histogram monthly breakdown
            ]
          }
        }
      }
    }
  }
...</programlisting>
<section id="_anonymous_filters">
<title>Anonymous filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/filters-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The filters field can also be provided as an array of filters, as in the
following request:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggs" : {
    "messages" : {
      "filters" : {
        "filters" : [
          { "term" : { "body" : "error"   }},
          { "term" : { "body" : "warning" }}
        ]
      },
      "aggs" : {
        "monthly" : {
          "histogram" : {
            "field" : "timestamp",
            "interval" : "1M"
          }
        }
      }
    }
  }
}</programlisting>
<simpara>The filtered buckets are returned in the same order as provided in the
request.  The response for this example would be:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
  "aggs" : {
    "messages" : {
      "buckets" : [
        {
          "doc_count" : 34,
          "monthly" : {
            "buckets : [
              ... // the histogram monthly breakdown
            ]
          }
        },
        {
          "doc_count" : 439,
          "monthly" : {
            "buckets : [
              ... // the histogram monthly breakdown
            ]
          }
        }
      ]
    }
  }
...</programlisting>
</section>
<section id="_literal_other_literal_bucket">
<title><literal>Other</literal> Bucket<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/filters-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>other_bucket</literal> parameter can be set to add a bucket to the response which will contain all documents that do
not match any of the given filters. The value of this parameter can be as follows:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>false</literal>
</term>
<listitem>
<simpara>
Does not compute the <literal>other</literal> bucket
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>true</literal>
</term>
<listitem>
<simpara>
Returns the <literal>other</literal> bucket bucket either in a bucket (named <literal>_other_</literal> by default) if named filters are being used,
                  or as the last bucket if anonymous filters are being used
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The <literal>other_bucket_key</literal> parameter can be used to set the key for the <literal>other</literal> bucket to a value other than the default <literal>_other_</literal>. Setting
this parameter will implicitly set the <literal>other_bucket</literal> parameter to <literal>true</literal>.</simpara>
<simpara>The following snippet shows a response where the <literal>other</literal> bucket is requested to be named <literal>other_messages</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggs" : {
    "messages" : {
      "filters" : {
        "other_bucket_key": "other_messages",
        "filters" : {
          "errors" :   { "term" : { "body" : "error"   }},
          "warnings" : { "term" : { "body" : "warning" }}
        }
      },
      "aggs" : {
        "monthly" : {
          "histogram" : {
            "field" : "timestamp",
            "interval" : "1M"
          }
        }
      }
    }
  }
}</programlisting>
<simpara>The response would be something like the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">...
  "aggs" : {
    "messages" : {
      "buckets" : {
        "errors" : {
          "doc_count" : 34,
            "monthly" : {
              "buckets" : [
                ... // the histogram monthly breakdown
              ]
            }
          },
          "warnings" : {
            "doc_count" : 439,
            "monthly" : {
              "buckets" : [
                 ... // the histogram monthly breakdown
              ]
            }
          },
          "other_messages" : {
            "doc_count" : 237,
            "monthly" : {
              "buckets" : [
                 ... // the histogram monthly breakdown
              ]
            }
          }
        }
      }
    }
  }
...</programlisting>
</section>
</section>
<section id="search-aggregations-bucket-geodistance-aggregation">
<title>Geo Distance Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geodistance-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket aggregation that works on <literal>geo_point</literal> fields and conceptually works very similar to the <link linkend="search-aggregations-bucket-range-aggregation">range</link> aggregation. The user can define a point of origin and a set of distance range buckets. The aggregation evaluate the distance of each document value from the origin point and determines the buckets it belongs to based on the ranges (a document belongs to a bucket if the distance between the document and the origin falls within the distance range of the bucket).</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "rings_around_amsterdam" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "rings" : {
            "buckets": [
                {
                    "key": "*-100.0",
                    "from": 0,
                    "to": 100.0,
                    "doc_count": 3
                },
                {
                    "key": "100.0-300.0",
                    "from": 100.0,
                    "to": 300.0,
                    "doc_count": 1
                },
                {
                    "key": "300.0-*",
                    "from": 300.0,
                    "doc_count": 7
                }
            ]
        }
    }
}</programlisting>
<simpara>The specified field must be of type <literal>geo_point</literal> (which can only be set explicitly in the mappings). And it can also hold an array of <literal>geo_point</literal> fields, in which case all will be taken into account during aggregation. The origin point can accept all formats supported by the <link linkend="geo-point"><literal>geo_point</literal> type</link>:</simpara>
<itemizedlist>
<listitem>
<simpara>
Object format: <literal>{ "lat" : 52.3760, "lon" : 4.894 }</literal> - this is the safest format as it is the most explicit about the <literal>lat</literal> &amp; <literal>lon</literal> values
</simpara>
</listitem>
<listitem>
<simpara>
String format: <literal>"52.3760, 4.894"</literal> - where the first number is the <literal>lat</literal> and the second is the <literal>lon</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Array format: <literal>[4.894, 52.3760]</literal> - which is based on the <literal>GeoJson</literal> standard and where the first number is the <literal>lon</literal> and the second one is the <literal>lat</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>By default, the distance unit is <literal>m</literal> (metres) but it can also accept: <literal>mi</literal> (miles), <literal>in</literal> (inches), <literal>yd</literal> (yards), <literal>km</literal> (kilometers), <literal>cm</literal> (centimeters), <literal>mm</literal> (millimeters).</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "unit" : "mi", <co id="CO76-1"/>
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO76-1">
<para>
The distances will be computed as miles
</para>
</callout>
</calloutlist>
<simpara>There are three distance calculation modes: <literal>sloppy_arc</literal> (the default), <literal>arc</literal> (most accurate) and <literal>plane</literal> (fastest). The <literal>arc</literal> calculation is the most accurate one but also the more expensive one in terms of performance. The <literal>sloppy_arc</literal> is faster but less accurate. The <literal>plane</literal> is the fastest but least accurate distance function. Consider using <literal>plane</literal> when your search context is "narrow" and spans smaller geographical areas (like cities or even countries). <literal>plane</literal> may return higher error mergins for searches across very large areas (e.g. cross continent search). The distance calculation type can be set using the <literal>distance_type</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "distance_type" : "plane",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-bucket-geohashgrid-aggregation">
<title>GeoHash grid Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geohashgrid-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket aggregation that works on <literal>geo_point</literal> fields and groups points into buckets that represent cells in a grid.
The resulting grid can be sparse and only contains cells that have matching data. Each cell is labeled using a <ulink url="http://en.wikipedia.org/wiki/Geohash">geohash</ulink> which is of user-definable precision.</simpara>
<itemizedlist>
<listitem>
<simpara>
High precision geohashes have a long string length and represent cells that cover only a small area.
</simpara>
</listitem>
<listitem>
<simpara>
Low precision geohashes have a short string length and represent cells that each cover a large area.
</simpara>
</listitem>
</itemizedlist>
<simpara>Geohashes used in this aggregation can have a choice of precision between 1 and 12.</simpara>
<warning><simpara>The highest-precision geohash of length 12 produces cells that cover less than a square metre of land and so high-precision requests can be very costly in terms of RAM and result sizes.
Please see the example below on how to first filter the aggregation to a smaller geographic area before requesting high-levels of detail.</simpara></warning>
<simpara>The specified field must be of type <literal>geo_point</literal> (which can only be set explicitly in the mappings) and it can also hold an array of <literal>geo_point</literal> fields, in which case all points will be taken into account during aggregation.</simpara>
<section id="_simple_low_precision_request">
<title>Simple low-precision request<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geohashgrid-aggregation.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations" : {
        "myLarge-GrainGeoHashGrid" : {
            "geohash_grid" : {
                "field" : "location",
                "precision" : 3
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "myLarge-GrainGeoHashGrid": {
            "buckets": [
                {
                    "key": "svz",
                    "doc_count": 10964
                },
                {
                    "key": "sv8",
                    "doc_count": 3198
                }
            ]
        }
    }
}</programlisting>
</section>
<section id="_high_precision_requests">
<title>High-precision requests<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geohashgrid-aggregation.asciidoc">Edit me</ulink></title>
<simpara>When requesting detailed buckets (typically for displaying a "zoomed in" map) a filter like <link linkend="query-dsl-geo-bounding-box-query">geo_bounding_box</link> should be applied to narrow the subject area otherwise potentially millions of buckets will be created and returned.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations" : {
        "zoomedInView" : {
            "filter" : {
                "geo_bounding_box" : {
                    "location" : {
                        "top_left" : "51.73, 0.9",
                        "bottom_right" : "51.55, 1.1"
                    }
                }
            },
            "aggregations":{
                "zoom1":{
                    "geohash_grid" : {
                        "field":"location",
                        "precision":8
                    }
                }
            }
        }
    }
 }</programlisting>
</section>
<section id="_cell_dimensions_at_the_equator">
<title>Cell dimensions at the equator<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geohashgrid-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The table below shows the metric dimensions for cells covered by various string lengths of geohash.
Cell dimensions vary with latitude and so the table is for the worst-case scenario at the equator.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<emphasis role="strong">GeoHash length</emphasis>
</simpara>
</entry>
<entry>
<simpara>
<emphasis role="strong">Area width x height</emphasis>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
1
</simpara>
</entry>
<entry>
<simpara>
5,009.4km x 4,992.6km
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
2
</simpara>
</entry>
<entry>
<simpara>
1,252.3km x 624.1km
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
3
</simpara>
</entry>
<entry>
<simpara>
156.5km x 156km
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
4
</simpara>
</entry>
<entry>
<simpara>
39.1km x 19.5km
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
5
</simpara>
</entry>
<entry>
<simpara>
4.9km x 4.9km
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
6
</simpara>
</entry>
<entry>
<simpara>
1.2km x 609.4m
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
7
</simpara>
</entry>
<entry>
<simpara>
152.9m x 152.4m
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
8
</simpara>
</entry>
<entry>
<simpara>
38.2m x 19m
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
9
</simpara>
</entry>
<entry>
<simpara>
4.8m x 4.8m
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
10
</simpara>
</entry>
<entry>
<simpara>
1.2m x 59.5cm
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
11
</simpara>
</entry>
<entry>
<simpara>
14.9cm x 14.9cm
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
12
</simpara>
</entry>
<entry>
<simpara>
3.7cm x 1.9cm
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_options_3">
<title>Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/geohashgrid-aggregation.asciidoc">Edit me</ulink></title>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
field
</simpara>
</entry>
<entry>
<simpara>
Mandatory. The name of the field indexed with GeoPoints.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
precision
</simpara>
</entry>
<entry>
<simpara>
Optional. The string length of the geohashes used to define
                cells/buckets in the results. Defaults to 5.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
size
</simpara>
</entry>
<entry>
<simpara>
Optional. The maximum number of geohash buckets to return
                (defaults to 10,000). When results are trimmed, buckets are
                prioritised based on the volumes of documents they contain.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
shard_size
</simpara>
</entry>
<entry>
<simpara>
Optional. To allow for more accurate counting of the top cells
                returned in the final result the aggregation defaults to
                returning <literal>max(10,(size x number-of-shards))</literal> buckets from each
                shard. If this heuristic is undesirable, the number considered
                from each shard can be over-ridden using this parameter.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="search-aggregations-bucket-global-aggregation">
<title>Global Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/global-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Defines a single bucket of all the documents within the search execution context. This context is defined by the indices and the document types you&#8217;re searching on, but is <emphasis role="strong">not</emphasis> influenced by the search query itself.</simpara>
<note><simpara>Global aggregators can only be placed as top level aggregators (it makes no sense to embed a global aggregator
        within another bucket aggregator)</simpara></note>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : { "title" : "shirt" }
    },
    "aggs" : {
        "all_products" : {
            "global" : {}, <co id="CO77-1"/>
            "aggs" : { <co id="CO77-2"/>
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO77-1">
<para>
The <literal>global</literal> aggregation has an empty body
</para>
</callout>
<callout arearefs="CO77-2">
<para>
The sub-aggregations that are registered for this <literal>global</literal> aggregation
</para>
</callout>
</calloutlist>
<simpara>The above aggregation demonstrates how one would compute aggregations (<literal>avg_price</literal> in this example) on all the documents in the search context, regardless of the query (in our example, it will compute the average price over all products in our catalog, not just on the "shirts").</simpara>
<simpara>The response for the above aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations" : {
        "all_products" : {
            "doc_count" : 100, <co id="CO78-1"/>
            "avg_price" : {
                "value" : 56.3
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO78-1">
<para>
The number of documents that were aggregated (in our case, all documents within the search context)
</para>
</callout>
</calloutlist>
</section>
<section id="search-aggregations-bucket-histogram-aggregation">
<title>Histogram Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket values source based aggregation that can be applied on numeric values extracted from the documents.
It dynamically builds fixed size (a.k.a. interval) buckets over the values. For example, if the documents have a field
that holds a price (numeric), we can configure this aggregation to dynamically build buckets with interval <literal>5</literal>
(in case of price it may represent $5). When the aggregation executes, the price field of every document will be
evaluated and will be rounded down to its closest bucket - for example, if the price is <literal>32</literal> and the bucket size is <literal>5</literal>
then the rounding will yield <literal>30</literal> and thus the document will "fall" into the bucket that is associated with the key <literal>30</literal>.
To make this more formal, here is the rounding function that is used:</simpara>
<programlisting language="java" linenumbering="unnumbered">rem = value % interval
if (rem &lt; 0) {
    rem += interval
}
bucket_key = value - rem</programlisting>
<simpara>From the rounding function above it can be seen that the intervals themselves <emphasis role="strong">must</emphasis> be integers.</simpara>
<warning><simpara>Currently, values are cast to integers before being bucketed, which
might cause negative floating-point values to fall into the wrong bucket. For
instance, <literal>-4.5</literal> with an interval of <literal>2</literal> would be cast to <literal>-4</literal>, and so would
end up in the <literal>-4 &lt;= val &lt; -2</literal> bucket instead of the <literal>-6 &lt;= val &lt; -4</literal> bucket.</simpara></warning>
<simpara>The following snippet "buckets" the products based on their <literal>price</literal> by interval of <literal>50</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50
            }
        }
    }
}</programlisting>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key": 100,
                    "doc_count": 0
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</programlisting>
<section id="_minimum_document_count">
<title>Minimum document count<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The response above show that no documents has a price that falls within the range of <literal>[100 - 150)</literal>. By default the
response will fill gaps in the histogram with empty buckets. It is possible change that and request buckets with
a higher minimum count thanks to the <literal>min_doc_count</literal> setting:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count" : 1
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</programlisting>
<simpara id="search-aggregations-bucket-histogram-aggregation-extended-bounds">By default the <literal>histogram</literal> returns all the buckets within the range of the data itself, that is, the documents with
the smallest values (on which with histogram) will determine the min bucket (the bucket with the smallest key) and the
documents with the highest values will determine the max bucket (the bucket with the highest key). Often, when
requesting empty buckets, this causes a confusion, specifically, when the data is also filtered.</simpara>
<simpara>To understand why, let&#8217;s look at an example:</simpara>
<simpara>Lets say the you&#8217;re filtering your request to get all docs with values between <literal>0</literal> and <literal>500</literal>, in addition you&#8217;d like
to slice the data per price using a histogram with an interval of <literal>50</literal>. You also specify <literal>"min_doc_count" : 0</literal> as you&#8217;d
like to get all buckets even the empty ones. If it happens that all products (documents) have prices higher than <literal>100</literal>,
the first bucket you&#8217;ll get will be the one with <literal>100</literal> as its key. This is confusing, as many times, you&#8217;d also like
to get those buckets between <literal>0 - 100</literal>.</simpara>
<simpara>With <literal>extended_bounds</literal> setting, you now can "force" the histogram aggregation to start building buckets on a specific
<literal>min</literal> values and also keep on building buckets up to a <literal>max</literal> value (even if there are no documents anymore). Using
<literal>extended_bounds</literal> only makes sense when <literal>min_doc_count</literal> is 0 (the empty buckets will never be returned if <literal>min_doc_count</literal>
is greater than 0).</simpara>
<simpara>Note that (as the name suggest) <literal>extended_bounds</literal> is <emphasis role="strong">not</emphasis> filtering buckets. Meaning, if the <literal>extended_bounds.min</literal> is higher
than the values extracted from the documents, the documents will still dictate what the first bucket will be (and the
same goes for the <literal>extended_bounds.max</literal> and the last bucket). For filtering buckets, one should nest the histogram aggregation
under a range <literal>filter</literal> aggregation with the appropriate <literal>from</literal>/<literal>to</literal> settings.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "constant_score" : { "filter": { "range" : { "price" : { "to" : "500" } } } }
    },
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "extended_bounds" : {
                    "min" : 0,
                    "max" : 500
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_order">
<title>Order<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>By default the returned buckets are sorted by their <literal>key</literal> ascending, though the order behaviour can be controlled
using the <literal>order</literal> setting.</simpara>
<simpara>Ordering the buckets by their key - descending:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_key" : "desc" }
            }
        }
    }
}</programlisting>
<simpara>Ordering the buckets by their <literal>doc_count</literal> - ascending:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_count" : "asc" }
            }
        }
    }
}</programlisting>
<simpara>If the histogram aggregation has a direct metrics sub-aggregation, the latter can determine the order of the buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "price_stats.min" : "asc" } <co id="CO79-1"/>
            },
            "aggs" : {
                "price_stats" : { "stats" : {} } <co id="CO79-2"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO79-1">
<para>
The <literal>{ "price_stats.min" : asc" }</literal> will sort the buckets based on <literal>min</literal> value of their <literal>price_stats</literal> sub-aggregation.
</para>
</callout>
<callout arearefs="CO79-2">
<para>
There is no need to configure the <literal>price</literal> field for the <literal>price_stats</literal> aggregation as it will inherit it by default from its parent histogram aggregation.
</para>
</callout>
</calloutlist>
<simpara>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either by a single-bucket
one or a metrics one. If it&#8217;s a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <literal>doc_count</literal>),
in case it&#8217;s a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</simpara>
<simpara>The path must be defined in the following form:</simpara>
<screen>AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</screen>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "promoted_products&gt;rating_stats.avg" : "desc" } <co id="CO80-1"/>
            },
            "aggs" : {
                "promoted_products" : {
                    "filter" : { "term" : { "promoted" : true }},
                    "aggs" : {
                        "rating_stats" : { "stats" : { "field" : "rating" }}
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>The above will sort the buckets based on the avg rating among the promoted products</simpara>
</section>
<section id="_offset_2">
<title>Offset<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>By default the bucket keys start with 0 and then continue in even spaced steps of <literal>interval</literal>, e.g. if the interval is 10 the first buckets
(assuming there is data inside them) will be [0 - 9], [10-19], [20-29]. The bucket boundaries can be shifted by using the <literal>offset</literal> option.</simpara>
<simpara>This can be best illustrated with an example. If there are 10 documents with values ranging from 5 to 14, using interval <literal>10</literal> will result in
two buckets with 5 documents each. If an additional offset <literal>5</literal> is used, there will be only one single bucket [5-14] containing all the 10
documents.</simpara>
</section>
<section id="_response_format">
<title>Response Format<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>By default, the buckets are returned as an ordered array. It is also possible to request the response as a hash
instead keyed by the buckets keys:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "keyed" : true
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "prices": {
            "buckets": {
                "0": {
                    "key": 0,
                    "doc_count": 2
                },
                "50": {
                    "key": 50,
                    "doc_count": 4
                },
                "150": {
                    "key": 150,
                    "doc_count": 3
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_missing_value_11">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/histogram-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "quantity" : {
             "histogram" : {
                 "field" : "quantity",
                 "interval": 10,
                 "missing": 0 <co id="CO80-2"/>
             }
         }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO80-1 CO80-2">
<para>
Documents without a value in the <literal>quantity</literal> field will fall into the same bucket as documents that have the value <literal>0</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-bucket-iprange-aggregation">
<title>IPv4 Range Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/iprange-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Just like the dedicated <link linkend="search-aggregations-bucket-daterange-aggregation">date</link> range aggregation, there is also a dedicated range aggregation for IPv4 typed fields:</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "to" : "10.0.0.5" },
                    { "from" : "10.0.0.5" }
                ]
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "ip_ranges": {
            "buckets" : [
                {
                    "to": 167772165,
                    "to_as_string": "10.0.0.5",
                    "doc_count": 4
                },
                {
                    "from": 167772165,
                    "from_as_string": "10.0.0.5",
                    "doc_count": 6
                }
            ]
        }
    }
}</programlisting>
<simpara>IP ranges can also be defined as CIDR masks:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "mask" : "10.0.0.0/25" },
                    { "mask" : "10.0.0.127/25" }
                ]
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "ip_ranges": {
            "buckets": [
                {
                    "key": "10.0.0.0/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                },
                {
                    "key": "10.0.0.127/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                }
            ]
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-bucket-missing-aggregation">
<title>Missing Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/missing-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A field data based single bucket aggregation, that creates a bucket of all documents in the current document set context that are missing a field value (effectively, missing a field or having the configured NULL value set). This aggregator will often be used in conjunction with other field data bucket aggregators (such as ranges) to return information for all the documents that could not be placed in any of the other buckets due to missing field data values.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "products_without_a_price" : {
            "missing" : { "field" : "price" }
        }
    }
}</programlisting>
<simpara>In the above example, we get the total number of products that do not have a price.</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggs" : {
        "products_without_a_price" : {
            "doc_count" : 10
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-bucket-nested-aggregation">
<title>Nested Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/nested-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A special single bucket aggregation that enables aggregating nested documents.</simpara>
<simpara>For example, lets say we have a index of products, and each product holds the list of resellers - each having its own
price for the product. The mapping could look like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "product" : {
        "properties" : {
            "resellers" : { <co id="CO81-1"/>
                "type" : "nested",
                "properties" : {
                    "name" : { "type" : "string" },
                    "price" : { "type" : "double" }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO81-1">
<para>
The <literal>resellers</literal> is an array that holds nested documents under the <literal>product</literal> object.
</para>
</callout>
</calloutlist>
<simpara>The following aggregations will return the minimum price products can be purchased in:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : { "name" : "led tv" }
    },
    "aggs" : {
        "resellers" : {
            "nested" : {
                "path" : "resellers"
            },
            "aggs" : {
                "min_price" : { "min" : { "field" : "resellers.price" } }
            }
        }
    }
}</programlisting>
<simpara>As you can see above, the nested aggregation requires the <literal>path</literal> of the nested documents within the top level documents.
Then one can define any type of aggregation over these nested documents.</simpara>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "resellers": {
            "min_price": {
                "value" : 350
            }
        }
    }
}</programlisting>
</section>
<section id="search-aggregations-bucket-range-aggregation">
<title>Range Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/range-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket value source based aggregation that enables the user to define a set of ranges - each representing a bucket. During the aggregation process, the values extracted from each document will be checked against each bucket range and "bucket" the relevant/matching document.
Note that this aggregation includes the <literal>from</literal> value and excludes the <literal>to</literal> value for each range.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                {
                    "from": 100,
                    "doc_count": 4
                }
            ]
        }
    }
}</programlisting>
<section id="_keyed_response">
<title>Keyed Response<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/range-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Setting the <literal>keyed</literal> flag to <literal>true</literal> will associate a unique string key with each bucket and return the ranges as a hash rather than an array:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": {
                "*-50.0": {
                    "to": 50,
                    "doc_count": 2
                },
                "50.0-100.0": {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                "100.0-*": {
                    "from": 100,
                    "doc_count": 4
                }
            }
        }
    }
}</programlisting>
<simpara>It is also possible to customize the key for each range:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "key" : "cheap", "to" : 50 },
                    { "key" : "average", "from" : 50, "to" : 100 },
                    { "key" : "expensive", "from" : 100 }
                ]
            }
        }
    }
}</programlisting>
</section>
<section id="_script_11">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/range-aggregation.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "script" : "doc['price'].value",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "price"
                    }
                },
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_value_script_7">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/range-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Lets say the product prices are in USD but we would like to get the price ranges in EURO. We can use value script to convert the prices prior the aggregation (assuming conversion rate of 0.8)</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 0.8
                },
                "ranges" : [
                    { "to" : 35 },
                    { "from" : 35, "to" : 70 },
                    { "from" : 70 }
                ]
            }
        }
    }
}</programlisting>
</section>
<section id="_sub_aggregations">
<title>Sub Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/range-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The following example, not only "bucket" the documents to the different buckets but also computes statistics over the prices in each price range</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : { "field" : "price" }
                }
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2,
                    "price_stats": {
                        "count": 2,
                        "min": 20,
                        "max": 47,
                        "avg": 33.5,
                        "sum": 67
                    }
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 60,
                        "max": 98,
                        "avg": 82.5,
                        "sum": 330
                    }
                },
                {
                    "from": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 134,
                        "max": 367,
                        "avg": 216,
                        "sum": 864
                    }
                }
            ]
        }
    }
}</programlisting>
<simpara>If a sub aggregation is also based on the same value source as the range aggregation (like the <literal>stats</literal> aggregation in the example above) it is possible to leave out the value source definition for it. The following will return the same response as above:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : {} <co id="CO82-1"/>
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO82-1">
<para>
We don&#8217;t need to specify the <literal>price</literal> as we "inherit" it by default from the parent <literal>range</literal> aggregation
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-bucket-reverse-nested-aggregation">
<title>Reverse nested Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/reverse-nested-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A special single bucket aggregation that enables aggregating on parent docs from nested documents. Effectively this
aggregation can break out of the nested block structure and link to other nested structures or the root document,
which allows nesting other aggregations that aren&#8217;t part of the nested object in a nested aggregation.</simpara>
<simpara>The <literal>reverse_nested</literal> aggregation must be defined inside a <literal>nested</literal> aggregation.</simpara>
<itemizedlist><title>Options:</title>
<listitem>
<simpara>
<literal>path</literal> - Which defines to what nested object field should be joined back. The default is empty,
which means that it joins back to the root / main document level. The path cannot contain a reference to
a nested object field that falls outside the <literal>nested</literal> aggregation&#8217;s nested structure a <literal>reverse_nested</literal> is in.
</simpara>
</listitem>
</itemizedlist>
<simpara>For example, lets say we have an index for a ticket system with issues and comments. The comments are inlined into
the issue documents as nested documents. The mapping could look like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "issue" : {
        "properties" : {
            "tags" : { "type" : "string" }
            "comments" : { <co id="CO83-1"/>
                "type" : "nested"
                "properties" : {
                    "username" : { "type" : "string", "index" : "not_analyzed" },
                    "comment" : { "type" : "string" }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO83-1">
<para>
The <literal>comments</literal> is an array that holds nested documents under the <literal>issue</literal> object.
</para>
</callout>
</calloutlist>
<simpara>The following aggregations will return the top commenters' username that have commented and per top commenter the top
tags of the issues the user has commented on:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "query": {
    "match": {
      "name": "led tv"
    }
  },
  "aggs": {
    "comments": {
      "nested": {
        "path": "comments"
      },
      "aggs": {
        "top_usernames": {
          "terms": {
            "field": "comments.username"
          },
          "aggs": {
            "comment_to_issue": {
              "reverse_nested": {}, <co id="CO84-1"/>
              "aggs": {
                "top_tags_per_comment": {
                  "terms": {
                    "field": "tags"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}</programlisting>
<simpara>As you can see above, the <literal>reverse_nested</literal> aggregation is put in to a <literal>nested</literal> aggregation as this is the only place
in the dsl where the <literal>reversed_nested</literal> aggregation can be used. Its sole purpose is to join back to a parent doc higher
up in the nested structure.</simpara>
<calloutlist>
<callout arearefs="CO84-1">
<para>
A <literal>reverse_nested</literal> aggregation that joins back to the root / main document level, because no <literal>path</literal> has been defined.
Via the <literal>path</literal> option the <literal>reverse_nested</literal> aggregation can join back to a different level, if multiple layered nested
object types have been defined in the mapping
</para>
</callout>
</calloutlist>
<simpara>Possible response snippet:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "aggregations": {
    "comments": {
      "top_usernames": {
        "buckets": [
          {
            "key": "username_1",
            "doc_count": 12,
            "comment_to_issue": {
              "top_tags_per_comment": {
                "buckets": [
                  {
                    "key": "tag1",
                    "doc_count": 9
                  },
                  ...
                ]
              }
            }
          },
          ...
        ]
      }
    }
  }
}</programlisting>
</section>
<section id="search-aggregations-bucket-sampler-aggregation">
<title>Sampler Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A filtering aggregation used to limit any sub aggregations' processing to a sample of the top-scoring documents.
Optionally, diversity settings can be used to limit the number of matches that share a common value such as an "author".</simpara>
<itemizedlist><title>Example use cases:</title>
<listitem>
<simpara>
Tightening the focus of analytics to high-relevance matches rather than the potentially very long tail of low-quality matches
</simpara>
</listitem>
<listitem>
<simpara>
Removing bias from analytics by ensuring fair representation of content from different sources
</simpara>
</listitem>
<listitem>
<simpara>
Reducing the running cost of aggregations that can produce useful results using only samples e.g. <literal>significant_terms</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "match": {
            "text": "iphone"
        }
    },
    "aggs": {
        "sample": {
            "sampler": {
                "shard_size": 200,
                "field" : "user.id"
            },
            "aggs": {
                "keywords": {
                    "significant_terms": {
                        "field": "text"
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
        "aggregations": {
        "sample": {
            "doc_count": 1000,<co id="CO85-1"/>
            "keywords": {<co id="CO85-2"/>
                "doc_count": 1000,
                "buckets": [
                    ...
                    {
                        "key": "bend",
                        "doc_count": 58,
                        "score": 37.982536582524276,
                        "bg_count": 103
                    },
                    ....
}</programlisting>
<calloutlist>
<callout arearefs="CO85-1">
<para>
1000 documents were sampled in total becase we asked for a maximum of 200 from an index with 5 shards. The cost of performing the nested significant_terms aggregation was therefore limited rather than unbounded.
</para>
</callout>
<callout arearefs="CO85-2">
<para>
The results of the significant_terms aggregation are not skewed by any single over-active Twitter user because we asked for a maximum of one tweet from any one user in our sample.
</para>
</callout>
</calloutlist>
<section id="_shard_size">
<title>shard_size<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>shard_size</literal> parameter limits how many top-scoring documents are collected in the sample processed on each shard.
The default value is 100.</simpara>
</section>
<section id="_controlling_diversity">
<title>Controlling diversity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Optionally, you can use the <literal>field</literal> or <literal>script</literal> and <literal>max_docs_per_value</literal> settings to control the maximum number of documents collected on any one shard which share a common value.
The choice of value (e.g. <literal>author</literal>) is loaded from a regular <literal>field</literal> or derived dynamically by a <literal>script</literal>.</simpara>
<simpara>The aggregation will throw an error if the choice of field or script produces multiple values for a document.
It is currently not possible to offer this form of de-duplication using many values, primarily due to concerns over efficiency.</simpara>
<note><simpara>Any good market researcher will tell you that when working with samples of data it is important
that the sample represents a healthy variety of opinions rather than being skewed by any single voice.
The same is true with aggregations and sampling with these diversify settings can offer a way to remove the bias in your content (an over-populated geography, a large spike in a timeline or an over-active forum spammer).</simpara></note>
</section>
<section id="_field">
<title>Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Controlling diversity using a field:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sample" : {
            "sampler" : {
                "field" : "author",
                "max_docs_per_value" : 3
            }
        }
    }
}</programlisting>
<simpara>Note that the <literal>max_docs_per_value</literal> setting applies on a per-shard basis only for the purposes of shard-local sampling.
It is not intended as a way of providing a global de-duplication feature on search results.</simpara>
</section>
<section id="_script_12">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Controlling diversity using a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sample" : {
            "sampler" : {
                "script" : "doc['author'].value + '/' + doc['genre'].value"
            }
        }
    }
}</programlisting>
<simpara>Note in the above example we chose to use the default <literal>max_docs_per_value</literal> setting of 1 and combine author and genre fields to ensure
each shard sample has, at most, one match for an author/genre pair.</simpara>
</section>
<section id="_execution_hint">
<title>execution_hint<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>When using the settings to control diversity, the optional <literal>execution_hint</literal> setting can influence the management of the values used for de-duplication.
Each option will hold up to <literal>shard_size</literal> values in memory while performing de-duplication but the type of value held can be controlled as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
hold field values directly (<literal>map</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
hold ordinals of the field as determined by the Lucene index (<literal>global_ordinals</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
hold hashes of the field values - with potential for hash collisions (<literal>bytes_hash</literal>)
</simpara>
</listitem>
</itemizedlist>
<simpara>The default setting is to use <literal>global_ordinals</literal> if this information is available from the Lucene index and reverting to <literal>map</literal> if not.
The <literal>bytes_hash</literal> setting may prove faster in some cases but introduces the possibility of false positives in de-duplication logic due to the possibility of hash collisions.
Please note that Elasticsearch will ignore the choice of execution hint if it is not applicable and that there is no backward compatibility guarantee on these hints.</simpara>
</section>
<section id="_limitations_3">
<title>Limitations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<section id="_cannot_be_nested_under_literal_breadth_first_literal_aggregations">
<title>Cannot be nested under <literal>breadth_first</literal> aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Being a quality-based filter the sampler aggregation needs access to the relevance score produced for each document.
It therefore cannot be nested under a <literal>terms</literal> aggregation which has the <literal>collect_mode</literal> switched from the default <literal>depth_first</literal> mode to <literal>breadth_first</literal> as this discards scores.
In this situation an error will be thrown.</simpara>
</section>
<section id="_limited_de_dup_logic">
<title>Limited de-dup logic.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The de-duplication logic in the diversify settings applies only at a shard level so will not apply across shards.</simpara>
</section>
<section id="_no_specialized_syntax_for_geo_date_fields">
<title>No specialized syntax for geo/date fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/sampler-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Currently the syntax for defining the diversifying values is defined by a choice of <literal>field</literal> or <literal>script</literal> - there is no added syntactical sugar for expressing geo or date units such as "1w" (1 week).
This support may be added in a later release and users will currently have to create these sorts of values using a script.</simpara>
</section>
</section>
</section>
<section id="search-aggregations-bucket-significantterms-aggregation">
<title>Significant Terms Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>An aggregation that returns interesting or unusual occurrences of terms in a set.</simpara>
<warning role="experimental"><simpara>The <literal>significant_terms</literal> aggregation can be very heavy when run on large indices.  Work is in progress to provide more lightweight sampling techniques.  As a result, the API for this feature may change in non-backwards compatible ways.</simpara></warning>
<itemizedlist><title>Example use cases:</title>
<listitem>
<simpara>
Suggesting "H5N1" when users search for "bird flu" in text
</simpara>
</listitem>
<listitem>
<simpara>
Identifying the merchant that is the "common point of compromise" from the transaction history of credit card owners reporting loss
</simpara>
</listitem>
<listitem>
<simpara>
Suggesting keywords relating to stock symbol $ATI for an automated news classifier
</simpara>
</listitem>
<listitem>
<simpara>
Spotting the fraudulent doctor who is diagnosing more than his fair share of whiplash injuries
</simpara>
</listitem>
<listitem>
<simpara>
Spotting the tire manufacturer who has a disproportionate number of blow-outs
</simpara>
</listitem>
</itemizedlist>
<simpara>In all these cases the terms being selected are not simply the most popular terms in a set.
They are the terms that have undergone a significant change in popularity measured between a <emphasis>foreground</emphasis> and <emphasis>background</emphasis> set.
If the term "H5N1" only exists in 5 documents in a 10 million document index and yet is found in 4 of the 100 documents that make up a user&#8217;s search results
that is significant and probably very relevant to their search. 5/10,000,000 vs 4/100 is a big swing in frequency.</simpara>
<section id="_single_set_analysis">
<title>Single-set analysis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>In the simplest case, the <emphasis>foreground</emphasis> set of interest is the search results matched by a query and the <emphasis>background</emphasis>
set used for statistical comparisons is the index or indices from which the results were gathered.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "terms" : {"force" : [ "British Transport Police" ]}
    },
    "aggregations" : {
        "significantCrimeTypes" : {
            "significant_terms" : { "field" : "crime_type" }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations" : {
        "significantCrimeTypes" : {
            "doc_count": 47347,
            "buckets" : [
                {
                    "key": "Bicycle theft",
                    "doc_count": 3640,
                    "score": 0.371235374214817,
                    "bg_count": 66799
                }
                ...
            ]
        }
    }
}</programlisting>
<simpara>When querying an index of all crimes from all police forces, what these results show is that the British Transport Police force
stand out as a force dealing with a disproportionately large number of bicycle thefts. Ordinarily, bicycle thefts represent only 1% of crimes (66799/5064554)
but for the British Transport Police, who handle crime on railways and stations, 7% of crimes (3640/47347) is
a bike theft. This is a significant seven-fold increase in frequency and so this anomaly was highlighted as the top crime type.</simpara>
<simpara>The problem with using a query to spot anomalies is it only gives us one subset to use for comparisons.
To discover all the other police forces' anomalies we would have to repeat the query for each of the different forces.</simpara>
<simpara>This can be a tedious way to look for unusual patterns in an index</simpara>
</section>
<section id="_multi_set_analysis">
<title>Multi-set analysis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A simpler way to perform analysis across multiple categories is to use a parent-level aggregation to segment the data ready for analysis.</simpara>
<simpara>Example using a parent aggregation for segmentation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggregations": {
        "forces": {
            "terms": {"field": "force"},
            "aggregations": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
 ...

 "aggregations": {
    "forces": {
        "buckets": [
            {
                "key": "Metropolitan Police Service",
                "doc_count": 894038,
                "significantCrimeTypes": {
                    "doc_count": 894038,
                    "buckets": [
                        {
                            "key": "Robbery",
                            "doc_count": 27617,
                            "score": 0.0599,
                            "bg_count": 53182
                        },
                        ...
                    ]
                }
            },
            {
                "key": "British Transport Police",
                "doc_count": 47347,
                "significantCrimeTypes": {
                    "doc_count": 47347,
                    "buckets": [
                        {
                            "key": "Bicycle theft",
                            "doc_count": 3640,
                            "score": 0.371,
                            "bg_count": 66799
                        },
                        ...
                    ]
                }
            }
        ]
    }
}</programlisting>
<simpara>Now we have anomaly detection for each of the police forces using a single request.</simpara>
<simpara>We can use other forms of top-level aggregations to segment our data, for example segmenting by geographic
area to identify unusual hot-spots of a particular crime type:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs": {
        "hotspots": {
            "geohash_grid" : {
                "field":"location",
                "precision":5,
            },
            "aggs": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</programlisting>
<simpara>This example uses the <literal>geohash_grid</literal> aggregation to create result buckets that represent geographic areas, and inside each
bucket we can identify anomalous levels of a crime type in these tightly-focused areas e.g.</simpara>
<itemizedlist>
<listitem>
<simpara>
Airports exhibit unusual numbers of weapon confiscations
</simpara>
</listitem>
<listitem>
<simpara>
Universities show uplifts of bicycle thefts
</simpara>
</listitem>
</itemizedlist>
<simpara>At a higher geohash_grid zoom-level with larger coverage areas we would start to see where an entire police-force may be
tackling an unusual volume of a particular crime type.</simpara>
<simpara>Obviously a time-based top-level segmentation would help identify current trends for each point in time
where a simple <literal>terms</literal> aggregation would typically show the very popular "constants" that persist across all time slots.</simpara>
<sidebar>
<title>How are the scores calculated?</title>
<simpara>The numbers returned for scores are primarily intended for ranking different suggestions sensibly rather than something easily understood by end users. The scores are derived from the doc frequencies in <emphasis>foreground</emphasis> and <emphasis>background</emphasis> sets. In brief, a term is considered significant if there is a noticeable difference in the frequency in which a term appears in the subset and in the background. The way the terms are ranked can be configured, see "Parameters" section.</simpara>
</sidebar>
</section>
<section id="_use_on_free_text_fields">
<title>Use on free-text fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The significant_terms aggregation can be used effectively on tokenized free-text fields to suggest:</simpara>
<itemizedlist>
<listitem>
<simpara>
keywords for refining end-user searches
</simpara>
</listitem>
<listitem>
<simpara>
keywords for use in percolator queries
</simpara>
</listitem>
</itemizedlist>
<warning><simpara>Picking a free-text field as the subject of a significant terms analysis can be expensive! It will attempt
to load every unique word into RAM. It is recommended to only use this on smaller indices.</simpara></warning>
<sidebar>
<title>Use the <emphasis>"like this but not this"</emphasis> pattern</title>
<simpara>You can spot mis-categorized content by first searching a structured field e.g. <literal>category:adultMovie</literal> and use significant_terms on the
free-text "movie_description" field. Take the suggested words (I&#8217;ll leave them to your imagination) and then search for all movies NOT marked as category:adultMovie but containing these keywords.
You now have a ranked list of badly-categorized movies that you should reclassify or at least remove from the "familyFriendly" category.</simpara>
<simpara>The significance score from each term can also provide a useful <literal>boost</literal> setting to sort matches.
Using the <literal>minimum_should_match</literal> setting of the <literal>terms</literal> query with the keywords will help control the balance of precision/recall in the result set i.e
a high setting would have a small number of relevant results packed full of keywords and a setting of "1" would produce a more exhaustive results set with all documents containing <emphasis>any</emphasis> keyword.</simpara>
</sidebar>
<tip>
<formalpara><title>Show significant_terms in context</title><para>Free-text significant_terms are much more easily understood when viewed in context. Take the results of <literal>significant_terms</literal> suggestions from a
free-text field and use them in a <literal>terms</literal> query on the same field with a <literal>highlight</literal> clause to present users with example snippets of documents. When the terms
are presented unstemmed, highlighted, with the right case, in the right order and with some context, their significance/meaning is more readily apparent.</para></formalpara>
</tip>
</section>
<section id="_custom_background_sets">
<title>Custom background sets<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Ordinarily, the foreground set of documents is "diffed" against a background set of all the documents in your index.
However, sometimes it may prove useful to use a narrower background set as the basis for comparisons.
For example, a query on documents relating to "Madrid" in an index with content from all over the world might reveal that "Spanish"
was a significant term. This may be true but if you want some more focused terms you could use a <literal>background_filter</literal>
on the term <emphasis>spain</emphasis> to establish a narrower set of documents as context. With this as a background "Spanish" would now
be seen as commonplace and therefore not as significant as words like "capital" that relate more strongly with Madrid.
Note that using a background filter will slow things down - each term&#8217;s background frequency must now be derived on-the-fly from filtering posting lists rather than reading the index&#8217;s pre-computed count for a term.</simpara>
</section>
<section id="_limitations_4">
<title>Limitations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<section id="_significant_terms_must_be_indexed_values">
<title>Significant terms must be indexed values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Unlike the terms aggregation it is currently not possible to use script-generated terms for counting purposes.
Because of the way the significant_terms aggregation must consider both <emphasis>foreground</emphasis> and <emphasis>background</emphasis> frequencies
it would be prohibitively expensive to use a script on the entire index to obtain background frequencies for comparisons.
Also DocValues are not supported as sources of term data for similar reasons.</simpara>
</section>
<section id="_no_analysis_of_floating_point_fields">
<title>No analysis of floating point fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Floating point fields are currently not supported as the subject of significant_terms analysis.
While integer or long fields can be used to represent concepts like bank account numbers or category numbers which
can be interesting to track, floating point fields are usually used to represent quantities of something.
As such, individual floating point terms are not useful for this form of frequency analysis.</simpara>
</section>
<section id="_use_as_a_parent_aggregation">
<title>Use as a parent aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>If there is the equivalent of a <literal>match_all</literal> query or no query criteria providing a subset of the index the significant_terms aggregation should not be used as the
top-most aggregation - in this scenario the <emphasis>foreground</emphasis> set is exactly the same as the <emphasis>background</emphasis> set and
so there is no difference in document frequencies to observe and from which to make sensible suggestions.</simpara>
<simpara>Another consideration is that  the significant_terms aggregation produces many candidate results at shard level
that are only later pruned on the reducing node once all statistics from all shards are merged. As a result,
it can be inefficient and costly in terms of RAM to embed large child aggregations under a significant_terms
aggregation that later discards many candidate terms. It is advisable in these cases to perform two searches - the first to provide a rationalized list of
significant_terms and then add this shortlist of terms to a second query to go back and fetch the required child aggregations.</simpara>
</section>
<section id="_approximate_counts">
<title>Approximate counts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The counts of how many documents contain a term provided in results are based on summing the samples returned from each shard and
as such may be:</simpara>
<itemizedlist>
<listitem>
<simpara>
low if certain shards did not provide figures for a given term in their top sample
</simpara>
</listitem>
<listitem>
<simpara>
high when considering the background frequency as it may count occurrences found in deleted documents
</simpara>
</listitem>
</itemizedlist>
<simpara>Like most design decisions, this is the basis of a trade-off in which we have chosen to provide fast performance at the cost of some (typically small) inaccuracies.
However, the <literal>size</literal> and <literal>shard size</literal> settings covered in the next section provide tools to help control the accuracy levels.</simpara>
</section>
</section>
<section id="_parameters_5">
<title>Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<section id="_jlh_score">
<title>JLH score<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The scores are derived from the doc frequencies in <emphasis>foreground</emphasis> and <emphasis>background</emphasis> sets. The <emphasis>absolute</emphasis> change in popularity (foregroundPercent - backgroundPercent) would favor common terms whereas the <emphasis>relative</emphasis> change in popularity (foregroundPercent/ backgroundPercent) would favor rare terms. Rare vs common is essentially a precision vs recall balance and so the absolute and relative changes are multiplied to provide a sweet spot between precision and recall.</simpara>
</section>
<section id="_mutual_information">
<title>mutual information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Mutual information as described in "Information Retrieval", Manning et al., Chapter 13.5.1 can be used as significance score by adding the parameter</simpara>
<programlisting language="js" linenumbering="unnumbered">         "mutual_information": {
              "include_negatives": true
         }</programlisting>
<simpara>Mutual information does not differentiate between terms that are descriptive for the subset or for documents outside the subset. The significant terms therefore can contain terms that appear more or less frequent in the subset than outside the subset. To filter out the terms that appear less often in the subset than in documents outside the subset, <literal>include_negatives</literal> can be set to <literal>false</literal>.</simpara>
<simpara>Per default, the assumption is that the documents in the bucket are also contained in the background. If instead you defined a custom background filter that represents a different set of documents that you want to compare to, set</simpara>
<programlisting language="js" linenumbering="unnumbered">"background_is_superset": false</programlisting>
</section>
<section id="_chi_square">
<title>Chi square<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Chi square as described in "Information Retrieval", Manning et al., Chapter 13.5.2 can be used as significance score by adding the parameter</simpara>
<programlisting language="js" linenumbering="unnumbered">         "chi_square": {
         }</programlisting>
<simpara>Chi square behaves like mutual information and can be configured with the same parameters <literal>include_negatives</literal> and <literal>background_is_superset</literal>.</simpara>
</section>
<section id="_google_normalized_distance">
<title>google normalized distance<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Google normalized distance  as described in "The Google Similarity Distance", Cilibrasi and Vitanyi, 2007 (<ulink url="http://arxiv.org/pdf/cs/0412098v3.pdf">http://arxiv.org/pdf/cs/0412098v3.pdf</ulink>) can be used as significance score by adding the parameter</simpara>
<programlisting language="js" linenumbering="unnumbered">         "gnd": {
         }</programlisting>
<simpara><literal>gnd</literal> also accepts the <literal>background_is_superset</literal> parameter.</simpara>
</section>
<section id="_percentage">
<title>Percentage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A simple calculation of the number of documents in the foreground sample with a term divided by the number of documents in the background with the term.
By default this produces a score greater than zero and less than one.</simpara>
<simpara>The benefit of this heuristic is that the scoring logic is simple to explain to anyone familiar with a "per capita" statistic. However, for fields with high cardinality there is a tendency for this heuristic to select the rarest terms such as typos that occur only once because they score 1/1 = 100%.</simpara>
<simpara>It would be hard for a seasoned boxer to win a championship if the prize was awarded purely on the basis of percentage of fights won - by these rules a newcomer with only one fight under his belt would be impossible to beat.
Multiple observations are typically required to reinforce a view so it is recommended in these cases to set both <literal>min_doc_count</literal> and <literal>shard_min_doc_count</literal> to a higher value such as 10 in order to filter out the low-frequency terms that otherwise take precedence.</simpara>
<programlisting language="js" linenumbering="unnumbered">         "percentage": {
         }</programlisting>
</section>
<section id="_which_one_is_best">
<title>Which one is best?<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Roughly, <literal>mutual_information</literal> prefers high frequent terms even if they occur also frequently in the background. For example, in an analysis of natural language text this might lead to selection of stop words. <literal>mutual_information</literal> is unlikely to select very rare terms like misspellings. <literal>gnd</literal> prefers terms with a high co-occurrence and avoids selection of stopwords. It might be better suited for synonym detection. However, <literal>gnd</literal> has a tendency to select very rare terms that are, for example, a result of misspelling. <literal>chi_square</literal> and <literal>jlh</literal> are somewhat in-between.</simpara>
<simpara>It is hard to say which one of the different heuristics will be the best choice as it depends on what the significant terms are used for (see for example [Yang and Pedersen, "A Comparative Study on Feature Selection in Text Categorization", 1997](<ulink url="http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf">http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf</ulink>) for a study on using significant terms for feature selection for text classification).</simpara>
<simpara>If none of the above measures suits your usecase than another option is to implement a custom significance measure:</simpara>
</section>
<section id="_scripted">
<title>scripted<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Customized scores can be implemented via a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">            "script_heuristic": {
              "script": "_subset_freq/(_superset_freq - _subset_freq + 1)"
            }</programlisting>
<simpara>Scripts can be inline (as in above example), indexed or stored on disk. For details on the options, see <link linkend="modules-scripting">script documentation</link>.</simpara>
<simpara>Available parameters in the script are</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_subset_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
Number of documents the term appears in in the subset.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_superset_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
Number of documents the term appears in in the superset.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_subset_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Number of documents in the subset.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_superset_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Number of documents in the superset.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_size_amp_shard_size">
<title>Size &amp; Shard Size<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>size</literal> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
If the number of unique terms is greater than <literal>size</literal>, the returned list can be slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</simpara>
<simpara>To ensure better accuracy a multiple of the final <literal>size</literal> is used as the number of terms to request from each shard
using a heuristic based on the number of shards. To take manual control of this setting the <literal>shard_size</literal> parameter
can be  used to control the volumes of candidate terms produced by each shard.</simpara>
<simpara>Low-frequency terms can turn out to be the most interesting ones once all results are combined so the
significant_terms aggregation can produce higher-quality results when the <literal>shard_size</literal> parameter is set to
values significantly higher than the <literal>size</literal> setting. This ensures that a bigger volume of promising candidate terms are given
a consolidated review by the reducing node before the final selection. Obviously large candidate term lists
will cause extra network traffic and RAM usage so this is  quality/cost trade off that needs to be balanced.  If <literal>shard_size</literal> is set to -1 (the default) then <literal>shard_size</literal> will be automatically estimated based on the number of shards and the <literal>size</literal> parameter.</simpara>
<note><simpara><literal>shard_size</literal> cannot be smaller than <literal>size</literal> (as it doesn&#8217;t make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <literal>size</literal>.</simpara></note>
</section>
<section id="_minimum_document_count_2">
<title>Minimum document count<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It is possible to only return terms that match more than a configured number of hits using the <literal>min_doc_count</literal> option:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "min_doc_count": 10
            }
        }
    }
}</programlisting>
<simpara>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <literal>3</literal>.</simpara>
<simpara>Terms that score highly will be collected on a shard level and merged with the terms collected from other shards in a second step. However, the shard does not have the information about the global term frequencies available. The decision if a term is added to a candidate list depends only on the score computed on the shard using local shard frequencies, not the global frequencies of the word. The <literal>min_doc_count</literal> criterion is only applied after merging local terms statistics of all shards. In a way the decision to add the term as a candidate is made without being very <emphasis>certain</emphasis> about if the term will actually reach the required <literal>min_doc_count</literal>. This might cause many (globally) high frequent terms to be missing in the final result if low frequent but high scoring terms populated the candidate lists. To avoid this, the <literal>shard_size</literal> parameter can be increased to allow more candidate terms on the shards. However, this increases memory consumption and network traffic.</simpara>
<simpara><literal>shard_min_doc_count</literal> parameter</simpara>
<simpara>The parameter <literal>shard_min_doc_count</literal> regulates the <emphasis>certainty</emphasis> a shard has if the term should actually be added to the candidate list or not with respect to the <literal>min_doc_count</literal>. Terms will only be considered if their local shard frequency within the set is higher than the <literal>shard_min_doc_count</literal>. If your dictionary contains many low frequent words and you are not interested in these (for example misspellings), then you can set the <literal>shard_min_doc_count</literal> parameter to filter out candidate terms on a shard level that will with a reasonable certainty not reach the required <literal>min_doc_count</literal> even after merging the local frequencies. <literal>shard_min_doc_count</literal> is set to <literal>1</literal> per default and has no effect unless you explicitly set it.</simpara>
<warning><simpara>Setting <literal>min_doc_count</literal> to <literal>1</literal> is generally not advised as it tends to return terms that
         are typos or other bizarre curiosities. Finding more than one instance of a term helps
         reinforce that, while still rare, the term was not the result of a one-off accident. The
         default value of 3 is used to provide a minimum weight-of-evidence.
         Setting <literal>shard_min_doc_count</literal> too high will cause significant candidate terms to be filtered out on a shard level. This value should be set much lower than <literal>min_doc_count/#shards</literal>.</simpara></warning>
</section>
<section id="_custom_background_context">
<title>Custom background context<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The default source of statistical information for background term frequencies is the entire index and this
scope can be narrowed through the use of a <literal>background_filter</literal> to focus in on significant terms within a narrower
context:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query" : {
        "match" : "madrid"
    },
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "background_filter": {
                        "term" : { "text" : "spain"}
                }
            }
        }
    }
}</programlisting>
<simpara>The above filter would help focus in on terms that were peculiar to the city of Madrid rather than revealing
terms like "Spanish" that are unusual in the full index&#8217;s worldwide context but commonplace in the subset of documents containing the
word "Spain".</simpara>
<warning><simpara>Use of background filters will slow the query as each term&#8217;s postings must be filtered to determine a frequency</simpara></warning>
</section>
<section id="_filtering_values">
<title>Filtering Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It is possible (although rarely required) to filter the values for which buckets will be created. This can be done using the <literal>include</literal> and
<literal>exclude</literal> parameters which are based on a regular expression string or arrays of exact terms. This functionality mirrors the features
described in the <link linkend="search-aggregations-bucket-terms-aggregation">terms aggregation</link> documentation.</simpara>
</section>
<section id="_execution_hint_2">
<title>Execution hint<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/significantterms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>There are different mechanisms by which terms aggregations can be executed:</simpara>
<itemizedlist>
<listitem>
<simpara>
by using field values directly in order to aggregate data per-bucket (<literal>map</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
by using ordinals of the field and preemptively allocating one bucket per ordinal value (<literal>global_ordinals</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
by using ordinals of the field and dynamically allocating one bucket per ordinal value (<literal>global_ordinals_hash</literal>)
</simpara>
</listitem>
</itemizedlist>
<simpara>Elasticsearch tries to have sensible defaults so this is something that generally doesn&#8217;t need to be configured.</simpara>
<simpara><literal>map</literal> should only be considered when very few documents match a query. Otherwise the ordinals-based execution modes
are significantly faster. By default, <literal>map</literal> is only used when running an aggregation on scripts, since they don&#8217;t have
ordinals.</simpara>
<simpara><literal>global_ordinals</literal> is the second fastest option, but the fact that it preemptively allocates buckets can be memory-intensive,
especially if you have one or more sub aggregations. It is used by default on top-level terms aggregations.</simpara>
<simpara><literal>global_ordinals_hash</literal> on the contrary to <literal>global_ordinals</literal> and <literal>global_ordinals_low_cardinality</literal> allocates buckets dynamically
so memory usage is linear to the number of values of the documents that are part of the aggregation scope. It is used by default
in inner aggregations.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
             "significant_terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <co id="CO86-1"/>
             }
         }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO86-1">
<para>
the possible values are <literal>map</literal>, <literal>global_ordinals</literal> and <literal>global_ordinals_hash</literal>
</para>
</callout>
</calloutlist>
<simpara>Please note that Elasticsearch will ignore this execution hint if it is not applicable.</simpara>
</section>
</section>
</section>
<section id="search-aggregations-bucket-terms-aggregation">
<title>Terms Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A multi-bucket value source based aggregation where buckets are dynamically built - one per unique value.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : { "field" : "genre" }
        }
    }
}</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations" : {
        "genres" : {
            "doc_count_error_upper_bound": 0, <co id="CO87-1"/>
            "sum_other_doc_count": 0, <co id="CO87-2"/>
            "buckets" : [ <co id="CO87-3"/>
                {
                    "key" : "jazz",
                    "doc_count" : 10
                },
                {
                    "key" : "rock",
                    "doc_count" : 10
                },
                {
                    "key" : "electronic",
                    "doc_count" : 10
                },
            ]
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO87-1">
<para>
an upper bound of the error on the document counts for each term, see <link linkend="search-aggregations-bucket-terms-aggregation-approximate-counts">below</link>
</para>
</callout>
<callout arearefs="CO87-2">
<para>
when there are lots of unique terms, elasticsearch only returns the top terms; this number is the sum of the document counts for all buckets that are not part of the response
</para>
</callout>
<callout arearefs="CO87-3">
<para>
the list of the top buckets, the meaning of <literal>top</literal> being defined by the <link linkend="search-aggregations-bucket-terms-aggregation-order">order</link>
</para>
</callout>
</calloutlist>
<simpara>By default, the <literal>terms</literal> aggregation will return the buckets for the top ten terms ordered by the <literal>doc_count</literal>. One can
change this default behaviour by setting the <literal>size</literal> parameter.</simpara>
<section id="_size">
<title>Size<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>size</literal> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top <literal>size</literal> term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
This means that if the number of unique terms is greater than <literal>size</literal>, the returned list is slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</simpara>
<warning revisionflag="deleted" revision="2.4.0"><title>Deprecated in 2.4.0.</title><simpara> The ability to set size to 0, resulting in the size being set to Integer.MAX_VALUE, is deprecated, and will be removed in the next major release..</simpara></warning>
</section>
<section id="search-aggregations-bucket-terms-aggregation-approximate-counts">
<title>Document counts are approximate<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>As described above, the document counts (and the results of any sub aggregations) in the terms aggregation are not always
accurate.  This is because each shard provides its own view of what the ordered list of terms should be and these are
combined to give a final view. Consider the following scenario:</simpara>
<simpara>A request is made to obtain the top 5 terms in the field product, ordered by descending document count from an index with
3 shards. In this case each shard is asked to give its top 5 terms.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "products" : {
            "terms" : {
                "field" : "product",
                "size" : 5
            }
        }
    }
}</programlisting>
<simpara>The terms for each of the three shards are shown below with their
respective document counts in brackets:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<?dbhtml table-width="100%"?>
<?dbfo table-width="100%"?>
<?dblatex table-width="100%"?>
<tgroup cols="4">
<colspec colname="col_1" colwidth="106*"/>
<colspec colname="col_2" colwidth="106*"/>
<colspec colname="col_3" colwidth="106*"/>
<colspec colname="col_4" colwidth="106*"/>
<thead>
<row>
<entry align="center" valign="top">    </entry>
<entry align="center" valign="top"> Shard A        </entry>
<entry align="center" valign="top"> Shard B        </entry>
<entry align="center" valign="top"> Shard C</entry>
</row>
</thead>
<tbody>
<row>
<entry align="center" valign="top"><simpara>1</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (25)</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (30)</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (45)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>2</simpara></entry>
<entry align="center" valign="top"><simpara>Product B (18)</simpara></entry>
<entry align="center" valign="top"><simpara>Product B (25)</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (44)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>3</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (6)</simpara></entry>
<entry align="center" valign="top"><simpara>Product F (17)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Z (36)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>4</simpara></entry>
<entry align="center" valign="top"><simpara>Product D (3)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Z (16)</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (30)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>5</simpara></entry>
<entry align="center" valign="top"><simpara>Product E (2)</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (15)</simpara></entry>
<entry align="center" valign="top"><simpara>Product E (29)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>6</simpara></entry>
<entry align="center" valign="top"><simpara>Product F (2)</simpara></entry>
<entry align="center" valign="top"><simpara>Product H (14)</simpara></entry>
<entry align="center" valign="top"><simpara>Product H (28)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>7</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (2)</simpara></entry>
<entry align="center" valign="top"><simpara>Product I (10)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Q (2)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>8</simpara></entry>
<entry align="center" valign="top"><simpara>Product H (2)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Q (6)</simpara></entry>
<entry align="center" valign="top"><simpara>Product D (1)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>9</simpara></entry>
<entry align="center" valign="top"><simpara>Product I (1)</simpara></entry>
<entry align="center" valign="top"><simpara>Product J (8)</simpara></entry>
<entry align="center" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>10</simpara></entry>
<entry align="center" valign="top"><simpara>Product J (1)</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (4)</simpara></entry>
<entry align="center" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The shards will return their top 5 terms so the results from the shards will be:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<?dbhtml table-width="100%"?>
<?dbfo table-width="100%"?>
<?dblatex table-width="100%"?>
<tgroup cols="4">
<colspec colname="col_1" colwidth="106*"/>
<colspec colname="col_2" colwidth="106*"/>
<colspec colname="col_3" colwidth="106*"/>
<colspec colname="col_4" colwidth="106*"/>
<thead>
<row>
<entry align="center" valign="top">    </entry>
<entry align="center" valign="top"> Shard A        </entry>
<entry align="center" valign="top"> Shard B        </entry>
<entry align="center" valign="top"> Shard C</entry>
</row>
</thead>
<tbody>
<row>
<entry align="center" valign="top"><simpara>1</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (25)</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (30)</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (45)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>2</simpara></entry>
<entry align="center" valign="top"><simpara>Product B (18)</simpara></entry>
<entry align="center" valign="top"><simpara>Product B (25)</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (44)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>3</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (6)</simpara></entry>
<entry align="center" valign="top"><simpara>Product F (17)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Z (36)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>4</simpara></entry>
<entry align="center" valign="top"><simpara>Product D (3)</simpara></entry>
<entry align="center" valign="top"><simpara>Product Z (16)</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (30)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>5</simpara></entry>
<entry align="center" valign="top"><simpara>Product E (2)</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (15)</simpara></entry>
<entry align="center" valign="top"><simpara>Product E (29)</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Taking the top 5 results from each of the shards (as requested) and combining them to make a final top 5 list produces
the following:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<?dbhtml table-width="40%"?>
<?dbfo table-width="40%"?>
<?dblatex table-width="40%"?>
<tgroup cols="2">
<colspec colname="col_1" colwidth="85*"/>
<colspec colname="col_2" colwidth="85*"/>
<tbody>
<row>
<entry align="center" valign="top"><simpara>1</simpara></entry>
<entry align="center" valign="top"><simpara>Product A (100)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>2</simpara></entry>
<entry align="center" valign="top"><simpara>Product Z (52)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>3</simpara></entry>
<entry align="center" valign="top"><simpara>Product C (50)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>4</simpara></entry>
<entry align="center" valign="top"><simpara>Product G (45)</simpara></entry>
</row>
<row>
<entry align="center" valign="top"><simpara>5</simpara></entry>
<entry align="center" valign="top"><simpara>Product B (43)</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Because Product A was returned from all shards we know that its document count value is accurate. Product C was only
returned by shards A and C so its document count is shown as 50 but this is not an accurate count. Product C exists on
shard B, but its count of 4 was not high enough to put Product C into the top 5 list for that shard. Product Z was also
returned only by 2 shards but the third shard does not contain the term. There is no way of knowing, at the point of
combining the results to produce the final list of terms, that there is an error in the document count for Product C and
not for Product Z. Product H has a document count of 44 across all 3 shards but was not included in the final list of
terms because it did not make it into the top five terms on any of the shards.</simpara>
</section>
<section id="_shard_size_2">
<title>Shard Size<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The higher the requested <literal>size</literal> is, the more accurate the results will be, but also, the more expensive it will be to
compute the final results (both due to bigger priority queues that are managed on a shard level and due to bigger data
transfers between the nodes and the client).</simpara>
<simpara>The <literal>shard_size</literal> parameter can be  used to minimize the extra work that comes with bigger requested <literal>size</literal>. When defined,
it will determine how many terms the coordinating node will request from each shard. Once all the shards responded, the
coordinating node will then reduce them to a final result which will be based on the <literal>size</literal> parameter - this way,
one can increase the accuracy of the returned terms and avoid the overhead of streaming a big list of buckets back to
the client.</simpara>
<note><simpara><literal>shard_size</literal> cannot be smaller than <literal>size</literal> (as it doesn&#8217;t make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <literal>size</literal>.</simpara></note>
<simpara>The default <literal>shard_size</literal> is a multiple of the <literal>size</literal> parameter which is dependant on the number of shards.</simpara>
</section>
<section id="_calculating_document_count_error">
<title>Calculating Document Count Error<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>There are two error values which can be shown on the terms aggregation.  The first gives a value for the aggregation as
a whole which represents the maximum potential document count for a term which did not make it into the final list of
terms. This is calculated as the sum of the document count from the last term returned from each shard .For the example
given above the value would be 46 (2 + 15 + 29). This means that in the worst case scenario a term which was not returned
could have the 4th highest document count.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations" : {
        "products" : {
            "doc_count_error_upper_bound" : 46,
            "buckets" : [
                {
                    "key" : "Product A",
                    "doc_count" : 100
                },
                {
                    "key" : "Product Z",
                    "doc_count" : 52
                },
                ...
            ]
        }
    }
}</programlisting>
</section>
<section id="_per_bucket_document_count_error">
<title>Per bucket document count error<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>The second error value can be enabled by setting the <literal>show_term_doc_count_error</literal> parameter to true. This shows an error value
for each term returned by the aggregation which represents the <emphasis>worst case</emphasis> error in the document count and can be useful when
deciding on a value for the <literal>shard_size</literal> parameter. This is calculated by summing the document counts for the last term returned
by all shards which did not return the term. In the example above the error in the document count for Product C would be 15 as
Shard B was the only shard not to return the term and the document count of the last term it did return was 15. The actual document
count of Product C was 54 so the document count was only actually off by 4 even though the worst case was that it would be off by
15.  Product A, however has an error of 0 for its document count, since every shard returned it we can be confident that the count
returned is accurate.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...

    "aggregations" : {
        "products" : {
            "doc_count_error_upper_bound" : 46,
            "buckets" : [
                {
                    "key" : "Product A",
                    "doc_count" : 100,
                    "doc_count_error_upper_bound" : 0
                },
                {
                    "key" : "Product Z",
                    "doc_count" : 52,
                    "doc_count_error_upper_bound" : 2
                },
                ...
            ]
        }
    }
}</programlisting>
<simpara>These errors can only be calculated in this way when the terms are ordered by descending document count. When the aggregation is
ordered by the terms values themselves (either ascending or descending) there is no error in the document count since if a shard
does not return a particular term which appears in the results from another shard, it must not have that term in its index. When the
aggregation is either sorted by a sub aggregation or in order of ascending document count, the error in the document counts cannot be
determined and is given a value of -1 to indicate this.</simpara>
</section>
<section id="search-aggregations-bucket-terms-aggregation-order">
<title>Order<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The order of the buckets can be customized by setting the <literal>order</literal> parameter. By default, the buckets are ordered by
their <literal>doc_count</literal> descending.  It is possible to change this behaviour as documented below:</simpara>
<warning><simpara>Sorting by ascending <literal>_count</literal> or by sub aggregation is discouraged as it increases the
<link linkend="search-aggregations-bucket-terms-aggregation-approximate-counts">error</link> on document counts.
It is fine when a single shard is queried, or when the field that is being aggregated was used
as a routing key at index time: in these cases results will be accurate since shards have disjoint
values. However otherwise, errors are unbounded. One particular case that could still be useful
is sorting by <link linkend="search-aggregations-metrics-min-aggregation"><literal>min</literal></link> or
<link linkend="search-aggregations-metrics-max-aggregation"><literal>max</literal></link> aggregation: counts will not be accurate
but at least the top buckets will be correctly picked.</simpara></warning>
<simpara>Ordering the buckets by their doc <literal>_count</literal> in an ascending manner:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "field" : "genre",
                "order" : { "_count" : "asc" }
            }
        }
    }
}</programlisting>
<simpara>Ordering the buckets alphabetically by their terms in an ascending manner:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "field" : "genre",
                "order" : { "_term" : "asc" }
            }
        }
    }
}</programlisting>
<simpara>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "field" : "genre",
                "order" : { "avg_play_count" : "desc" }
            },
            "aggs" : {
                "avg_play_count" : { "avg" : { "field" : "play_count" } }
            }
        }
    }
}</programlisting>
<simpara>Ordering the buckets by multi value metrics sub-aggregation (identified by the aggregation name):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "field" : "genre",
                "order" : { "playback_stats.avg" : "desc" }
            },
            "aggs" : {
                "playback_stats" : { "stats" : { "field" : "play_count" } }
            }
        }
    }
}</programlisting>
<note>
<title>Pipeline aggs cannot be used for sorting</title>
<simpara><link linkend="search-aggregations-pipeline">Pipeline aggregations</link> are run during the
reduce phase after all other aggregations have already completed.  For this
reason, they cannot be used for ordering.</simpara>
</note>
<simpara>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either be a single-bucket
one or a metrics one. If it&#8217;s a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <literal>doc_count</literal>),
in case it&#8217;s a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</simpara>
<simpara>The path must be defined in the following form:</simpara>
<screen>AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</screen>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "countries" : {
            "terms" : {
                "field" : "artist.country",
                "order" : { "rock&gt;playback_stats.avg" : "desc" }
            },
            "aggs" : {
                "rock" : {
                    "filter" : { "term" : { "genre" :  "rock" }},
                    "aggs" : {
                        "playback_stats" : { "stats" : { "field" : "play_count" }}
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>The above will sort the artist&#8217;s countries buckets based on the average play count among the rock songs.</simpara>
<simpara>Multiple criteria can be used to order the buckets by providing an array of order criteria such as the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "countries" : {
            "terms" : {
                "field" : "artist.country",
                "order" : [ { "rock&gt;playback_stats.avg" : "desc" }, { "_count" : "desc" } ]
            },
            "aggs" : {
                "rock" : {
                    "filter" : { "term" : { "genre" : { "rock" }}},
                    "aggs" : {
                        "playback_stats" : { "stats" : { "field" : "play_count" }}
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>The above will sort the artist&#8217;s countries buckets based on the average play count among the rock songs and then by
their <literal>doc_count</literal> in descending order.</simpara>
<note><simpara>In the event that two buckets share the same values for all order criteria the bucket&#8217;s term value is used as a
tie-breaker in ascending alphabetical order to prevent non-deterministic ordering of buckets.</simpara></note>
</section>
<section id="_minimum_document_count_3">
<title>Minimum document count<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It is possible to only return terms that match more than a configured number of hits using the <literal>min_doc_count</literal> option:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tags",
                "min_doc_count": 10
            }
        }
    }
}</programlisting>
<simpara>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <literal>1</literal>.</simpara>
<simpara>Terms are collected and ordered on a shard level and merged with the terms collected from other shards in a second step. However, the shard does not have the information about the global document count available. The decision if a term is added to a candidate list depends only on the order computed on the shard using local shard frequencies. The <literal>min_doc_count</literal> criterion is only applied after merging local terms statistics of all shards. In a way the decision to add the term as a candidate is made without being very <emphasis>certain</emphasis> about if the term will actually reach the required <literal>min_doc_count</literal>. This might cause many (globally) high frequent terms to be missing in the final result if low frequent terms populated the candidate lists. To avoid this, the <literal>shard_size</literal> parameter can be increased to allow more candidate terms on the shards. However, this increases memory consumption and network traffic.</simpara>
<simpara><literal>shard_min_doc_count</literal> parameter</simpara>
<simpara>The parameter <literal>shard_min_doc_count</literal> regulates the <emphasis>certainty</emphasis> a shard has if the term should actually be added to the candidate list or not with respect to the <literal>min_doc_count</literal>. Terms will only be considered if their local shard frequency within the set is higher than the <literal>shard_min_doc_count</literal>. If your dictionary contains many low frequent terms and you are not interested in those (for example misspellings), then you can set the <literal>shard_min_doc_count</literal> parameter to filter out candidate terms on a shard level that will with a reasonable certainty not reach the required <literal>min_doc_count</literal> even after merging the local counts. <literal>shard_min_doc_count</literal> is set to <literal>0</literal> per default and has no effect unless you explicitly set it.</simpara>
<note><simpara>Setting <literal>min_doc_count</literal>=<literal>0</literal> will also return buckets for terms that didn&#8217;t match any hit. However, some of
         the returned terms which have a document count of zero might only belong to deleted documents or documents
         from other types, so there is no warranty that a <literal>match_all</literal> query would find a positive document count for
         those terms.</simpara></note>
<warning><simpara>When NOT sorting on <literal>doc_count</literal> descending, high values of <literal>min_doc_count</literal> may return a number of buckets
         which is less than <literal>size</literal> because not enough data was gathered from the shards. Missing buckets can be
         back by increasing <literal>shard_size</literal>.
         Setting <literal>shard_min_doc_count</literal> too high will cause terms to be filtered out on a shard level. This value should be set much lower than <literal>min_doc_count/#shards</literal>.</simpara></warning>
</section>
<section id="search-aggregations-bucket-terms-aggregation-script">
<title>Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Generating the terms using a script:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "script" : "doc['genre'].value"
            }
        }
    }
}</programlisting>
<simpara>This will interpret the <literal>script</literal> parameter as an <literal>inline</literal> script with the default script language and no script parameters. To use a file script use the following syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "script" : {
                    "file": "my_script",
                    "params": {
                        "field": "genre"
                    }
                }
            }
        }
    }
}</programlisting>
<tip><simpara>for indexed scripts replace the <literal>file</literal> parameter with an <literal>id</literal> parameter.</simpara></tip>
</section>
<section id="_value_script_8">
<title>Value Script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "genres" : {
            "terms" : {
                "field" : "genre",
                "script" : "'Genre: ' +_value"
            }
        }
    }
}</programlisting>
</section>
<section id="_filtering_values_2">
<title>Filtering Values<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>It is possible to filter the values for which buckets will be created. This can be done using the <literal>include</literal> and
<literal>exclude</literal> parameters which are based on regular expression strings or arrays of exact values.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tags",
                "include" : ".*sport.*",
                "exclude" : "water_.*"
            }
        }
    }
}</programlisting>
<simpara>In the above example, buckets will be created for all the tags that has the word <literal>sport</literal> in them, except those starting
with <literal>water_</literal> (so the tag <literal>water_sports</literal> will no be aggregated). The <literal>include</literal> regular expression will determine what
values are "allowed" to be aggregated, while the <literal>exclude</literal> determines the values that should not be aggregated. When
both are defined, the <literal>exclude</literal> has precedence, meaning, the <literal>include</literal> is evaluated first and only then the <literal>exclude</literal>.</simpara>
<simpara>The syntax is the same as <link linkend="regexp-syntax">regexp queries</link>.</simpara>
<simpara>For matching based on exact values the <literal>include</literal> and <literal>exclude</literal> parameters can simply take an array of
strings that represent the terms as they are found in the index:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "JapaneseCars" : {
             "terms" : {
                 "field" : "make",
                 "include" : ["mazda", "honda"]
             }
         },
        "ActiveCarManufacturers" : {
             "terms" : {
                 "field" : "make",
                 "exclude" : ["rover", "jensen"]
             }
         }
    }
}</programlisting>
</section>
<section id="_multi_field_terms_aggregation">
<title>Multi-field terms aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>terms</literal> aggregation does not support collecting terms from multiple fields
in the same document.  The reason is that the <literal>terms</literal> agg doesn&#8217;t collect the
string term values themselves, but rather uses
<link linkend="search-aggregations-bucket-terms-aggregation-execution-hint">global ordinals</link>
to produce a list of all of the unique values in the field.  Global ordinals
results in an important performance boost which would not be possible across
multiple fields.</simpara>
<simpara>There are two approaches that you can use to perform a <literal>terms</literal> agg across
multiple fields:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="search-aggregations-bucket-terms-aggregation-script">Script</link>
</term>
<listitem>
<simpara>
Use a script to retrieve terms from multiple fields.  This disables the global
ordinals optimization and will be slower than collecting terms from a single
field, but it gives you the flexibility to implement this option at search
time.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="copy-to"><literal>copy_to</literal> field</link>
</term>
<listitem>
<simpara>
If you know ahead of time that you want to collect the terms from two or more
fields, then use <literal>copy_to</literal> in your mapping to create a new dedicated field at
index time which contains the values from both fields.  You can aggregate on
this single field, which will benefit from the global ordinals optimization.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_collect_mode">
<title>Collect mode<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Deferring calculation of child aggregations</simpara>
<simpara>For fields with many unique terms and a small number of required results it can be more efficient to delay the calculation
of child aggregations until the top parent-level aggs have been pruned. Ordinarily, all branches of the aggregation tree
are expanded in one depth-first pass and only then any pruning occurs. In some rare scenarios this can be very wasteful and can hit memory constraints.
An example problem scenario is querying a movie database for the 10 most popular actors and their 5 most common co-stars:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "actors" : {
             "terms" : {
                 "field" : "actors",
                 "size" : 10
             },
            "aggs" : {
                "costars" : {
                     "terms" : {
                         "field" : "actors",
                         "size" : 5
                     }
                 }
            }
         }
    }
}</programlisting>
<simpara>Even though the number of movies may be comparatively small and we want only 50 result buckets there is a combinatorial explosion of buckets
during calculation - a single movie will produce n² buckets where n is the number of actors. The sane option would be to first determine
the 10 most popular actors and only then examine the top co-stars for these 10 actors. This alternative strategy is what we call the <literal>breadth_first</literal> collection
mode as opposed to the default <literal>depth_first</literal> mode:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "actors" : {
             "terms" : {
                 "field" : "actors",
                 "size" : 10,
                 "collect_mode" : "breadth_first"
             },
            "aggs" : {
                "costars" : {
                     "terms" : {
                         "field" : "actors",
                         "size" : 5
                     }
                 }
            }
         }
    }
}</programlisting>
<simpara>When using <literal>breadth_first</literal> mode the set of documents that fall into the uppermost buckets are
cached for subsequent replay so there is a memory overhead in doing this which is linear with the number of matching documents.
In most requests the volume of buckets generated is smaller than the number of documents that fall into them so the default <literal>depth_first</literal>
collection mode is normally the best bet but occasionally the <literal>breadth_first</literal> strategy can be significantly more efficient. Currently
elasticsearch will always use the <literal>depth_first</literal> collect_mode unless explicitly instructed to use <literal>breadth_first</literal> as in the above example.
Note that the <literal>order</literal> parameter can still be used to refer to data from a child aggregation when using the <literal>breadth_first</literal> setting - the parent
aggregation understands that this child aggregation will need to be called first before any of the other child aggregations.</simpara>
<warning><simpara>It is not possible to nest aggregations such as <literal>top_hits</literal> which require access to match score information under an aggregation that uses
the <literal>breadth_first</literal> collection mode. This is because this would require a RAM buffer to hold the float score value for every document and
this would typically be too costly in terms of RAM.</simpara></warning>
</section>
<section id="search-aggregations-bucket-terms-aggregation-execution-hint">
<title>Execution hint<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>The automated execution optimization is experimental, so this parameter is provided temporarily as a way to override the default behaviour.</simpara></warning>
<simpara>There are different mechanisms by which terms aggregations can be executed:</simpara>
<itemizedlist>
<listitem>
<simpara>
by using field values directly in order to aggregate data per-bucket (<literal>map</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
by using ordinals of the field and preemptively allocating one bucket per ordinal value (<literal>global_ordinals</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
by using ordinals of the field and dynamically allocating one bucket per ordinal value (<literal>global_ordinals_hash</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
by using per-segment ordinals to compute counts and remap these counts to global counts using global ordinals (<literal>global_ordinals_low_cardinality</literal>)
</simpara>
</listitem>
</itemizedlist>
<simpara>Elasticsearch tries to have sensible defaults so this is something that generally doesn&#8217;t need to be configured.</simpara>
<simpara><literal>map</literal> should only be considered when very few documents match a query. Otherwise the ordinals-based execution modes
are significantly faster. By default, <literal>map</literal> is only used when running an aggregation on scripts, since they don&#8217;t have
ordinals.</simpara>
<simpara><literal>global_ordinals_low_cardinality</literal> only works for leaf terms aggregations but is usually the fastest execution mode. Memory
usage is linear with the number of unique values in the field, so it is only enabled by default on low-cardinality fields.</simpara>
<simpara><literal>global_ordinals</literal> is the second fastest option, but the fact that it preemptively allocates buckets can be memory-intensive,
especially if you have one or more sub aggregations. It is used by default on top-level terms aggregations.</simpara>
<simpara><literal>global_ordinals_hash</literal> on the contrary to <literal>global_ordinals</literal> and <literal>global_ordinals_low_cardinality</literal> allocates buckets dynamically
so memory usage is linear to the number of values of the documents that are part of the aggregation scope. It is used by default
in inner aggregations.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <co id="CO88-1"/>
             }
         }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO88-1">
<para>
<phrase role="experimental">This functionality is experimental and may be changed or removed completely in a future release.</phrase> the possible values are <literal>map</literal>, <literal>global_ordinals</literal>, <literal>global_ordinals_hash</literal> and <literal>global_ordinals_low_cardinality</literal>
</para>
</callout>
</calloutlist>
<simpara>Please note that Elasticsearch will ignore this execution hint if it is not applicable and that there is no backward compatibility guarantee on these hints.</simpara>
</section>
<section id="_missing_value_12">
<title>Missing value<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/bucket/terms-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> parameter defines how documents that are missing a value should be treated.
By default they will be ignored but it is also possible to treat them as if they
had a value.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "missing": "N/A" <co id="CO89-1"/>
             }
         }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO89-1">
<para>
Documents without a value in the <literal>tags</literal> field will fall into the same bucket as documents that have the value <literal>N/A</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
</chapter>
<chapter id="search-aggregations-pipeline">
<title>Pipeline Aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>Pipeline aggregations work on the outputs produced from other aggregations rather than from document sets, adding
information to the output tree. There are many different types of pipeline aggregation, each computing different information from
other aggregations, but these types can be broken down into two families:</simpara>
<variablelist>
<varlistentry>
<term>
<emphasis>Parent</emphasis>
</term>
<listitem>
<simpara>
                A family of pipeline aggregations that is provided with the output of its parent aggregation and is able
                to compute new buckets or new aggregations to add to existing buckets.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis>Sibling</emphasis>
</term>
<listitem>
<simpara>
                Pipeline aggregations that are provided with the output of a sibling aggregation and are able to compute a
                new aggregation which will be at the same level as the sibling aggregation.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Pipeline aggregations can reference the aggregations they need to perform their computation by using the <literal>buckets_path</literal>
parameter to indicate the paths to the required metrics. The syntax for defining these paths can be found in the
<link linkend="buckets-path-syntax"><literal>buckets_path</literal> Syntax</link> section below.</simpara>
<simpara>Pipeline aggregations cannot have sub-aggregations but depending on the type it can reference another pipeline in the <literal>buckets_path</literal>
allowing pipeline aggregations to be chained.  For example, you can chain together two derivatives to calculate the second derivative
(i.e. a derivative of a derivative).</simpara>
<note><simpara>Because pipeline aggregations only add to the output, when chaining pipeline aggregations the output of each pipeline aggregation
will be included in the final output.</simpara></note>
<bridgehead id="buckets-path-syntax" renderas="sect2"><literal>buckets_path</literal> Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most pipeline aggregations require another aggregation as their input.  The input aggregation is defined via the <literal>buckets_path</literal>
parameter, which follows a specific format:</simpara>
<screen>AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</screen>
<simpara>For example, the path <literal>"my_bucket&gt;my_stats.avg"</literal> will path to the <literal>avg</literal> value in the <literal>"my_stats"</literal> metric, which is
contained in the <literal>"my_bucket"</literal> bucket aggregation.</simpara>
<simpara>Paths are relative from the position of the pipeline aggregation; they are not absolute paths, and the path cannot go back "up" the
aggregation tree. For example, this moving average is embedded inside a date_histogram and refers to a "sibling"
metric <literal>"the_sum"</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "my_date_histo":{
        "date_histogram":{
            "field":"timestamp",
            "interval":"day"
        },
        "aggs":{
            "the_sum":{
                "sum":{ "field": "lemmings" } <co id="CO90-1"/>
            },
            "the_movavg":{
                "moving_avg":{ "buckets_path": "the_sum" } <co id="CO90-2"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO90-1">
<para>
The metric is called <literal>"the_sum"</literal>
</para>
</callout>
<callout arearefs="CO90-2">
<para>
The <literal>buckets_path</literal> refers to the metric via a relative path <literal>"the_sum"</literal>
</para>
</callout>
</calloutlist>
<simpara><literal>buckets_path</literal> is also used for Sibling pipeline aggregations, where the aggregation is "next" to a series of buckets
instead of embedded "inside" them.  For example, the <literal>max_bucket</literal> aggregation uses the <literal>buckets_path</literal> to specify
a metric embedded inside a sibling aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "max_monthly_sales": {
            "max_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO91-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO91-1">
<para>
<literal>buckets_path</literal> instructs this max_bucket aggregation that we want the maximum value of the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<bridgehead id="_special_paths" renderas="sect2">Special Paths<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline.asciidoc">Edit me</ulink></bridgehead>
<simpara>Instead of pathing to a metric, <literal>buckets_path</literal> can use a special <literal>"_count"</literal> path.  This instructs
the pipeline aggregation to use the document count as it&#8217;s input.  For example, a moving average can be calculated on the document
count of each bucket, instead of a specific metric:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "my_date_histo":{
        "date_histogram":{
            "field":"timestamp",
            "interval":"day"
        },
        "aggs":{
            "the_movavg":{
                "moving_avg":{ "buckets_path": "_count" } <co id="CO92-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO92-1">
<para>
By using <literal>_count</literal> instead of a metric name, we can calculate the moving average of document counts in the histogram
</para>
</callout>
</calloutlist>
<bridgehead id="dots-in-agg-names" renderas="sect2">Dealing with dots in agg names<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline.asciidoc">Edit me</ulink></bridgehead>
<simpara>An alternate syntax is supported to cope with aggregations or metrics which
have dots in the name, such as the <literal>99.9</literal>th
<link linkend="search-aggregations-metrics-percentile-aggregation">percentile</link>. This metric
may be referred to as:</simpara>
<programlisting language="js" linenumbering="unnumbered">"buckets_path": "my_percentile[99.9]"</programlisting>
<bridgehead id="gap-policy" renderas="sect2">Dealing with gaps in the data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline.asciidoc">Edit me</ulink></bridgehead>
<simpara>Data in the real world is often noisy and sometimes contains <emphasis role="strong">gaps</emphasis>&#8201;&#8212;&#8201;places where data simply doesn&#8217;t exist.  This can
occur for a variety of reasons, the most common being:</simpara>
<itemizedlist>
<listitem>
<simpara>
Documents falling into a bucket do not contain a required field
</simpara>
</listitem>
<listitem>
<simpara>
There are no documents matching the query for one or more buckets
</simpara>
</listitem>
<listitem>
<simpara>
The metric being calculated is unable to generate a value, likely because another dependent bucket is missing a value.
Some pipeline aggregations have specific requirements that must be met (e.g. a derivative cannot calculate a metric for the
first value because there is no previous value, HoltWinters moving average need "warmup" data to begin calculating, etc)
</simpara>
</listitem>
</itemizedlist>
<simpara>Gap policies are a mechanism to inform the pipeline aggregation about the desired behavior when "gappy" or missing
data is encountered.  All pipeline aggregations accept the <literal>gap_policy</literal> parameter.  There are currently two gap policies
to choose from:</simpara>
<variablelist>
<varlistentry>
<term>
<emphasis>skip</emphasis>
</term>
<listitem>
<simpara>
                This option treats missing data as if the bucket does not exist.  It will skip the bucket and continue
                calculating using the next available value.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis>insert_zeros</emphasis>
</term>
<listitem>
<simpara>
                This option will replace missing values with a zero (<literal>0</literal>) and pipeline aggregation computation will
                proceed as normal.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="search-aggregations-pipeline-avg-bucket-aggregation">
<title>Avg Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/avg-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which calculates the (mean) average value of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</simpara>
<section id="_syntax">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/avg-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>An <literal>avg_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "avg_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>avg_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the average for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara></simpara></entry>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the average of the total monthly <literal>sales</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "avg_monthly_sales": {
            "avg_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO93-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO93-1">
<para>
<literal>buckets_path</literal> instructs this avg_bucket aggregation that we want the (mean) average value of the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "avg_monthly_sales": {
          "value": 328.33333333333333
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-derivative-aggregation">
<title>Derivative Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/derivative-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A parent pipeline aggregation which calculates the derivative of a specified metric in a parent histogram (or date_histogram)
aggregation. The specified metric must be numeric and the enclosing histogram must have <literal>min_doc_count</literal> set to <literal>0</literal> (default
for <literal>histogram</literal> aggregations).</simpara>
<section id="_syntax_2">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/derivative-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>derivative</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "derivative": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>derivative</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the derivative for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section id="_first_order_derivative">
<title>First Order Derivative<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/derivative-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The following snippet calculates the derivative of the total monthly <literal>sales</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "sales_deriv": {
                    "derivative": {
                        "buckets_path": "sales" <co id="CO94-1"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO94-1">
<para>
<literal>buckets_path</literal> instructs this derivative aggregation to use the output of the <literal>sales</literal> aggregation for the derivative
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               } <co id="CO95-1"/>
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               },
               "sales_deriv": {
                  "value": -490 <co id="CO95-2"/>
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2, <co id="CO95-3"/>
               "sales": {
                  "value": 375
               },
               "sales_deriv": {
                  "value": 315
               }
            }
         ]
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO95-1">
<para>
No derivative for the first bucket since we need at least 2 data points to calculate the derivative
</para>
</callout>
<callout arearefs="CO95-2">
<para>
Derivative value units are implicitly defined by the <literal>sales</literal> aggregation and the parent histogram so in this case the units
would be $/month assuming the <literal>price</literal> field has units of $.
</para>
</callout>
<callout arearefs="CO95-3">
<para>
The number of documents in the bucket are represented by the <literal>doc_count</literal> f
</para>
</callout>
</calloutlist>
</section>
<section id="_second_order_derivative">
<title>Second Order Derivative<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/derivative-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A second order derivative can be calculated by chaining the derivative pipeline aggregation onto the result of another derivative
pipeline aggregation as in the following example which will calculate both the first and the second order derivative of the total
monthly sales:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "sales_deriv": {
                    "derivative": {
                        "buckets_path": "sales"
                    }
                },
                "sales_2nd_deriv": {
                    "derivative": {
                        "buckets_path": "sales_deriv" <co id="CO96-1"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO96-1">
<para>
<literal>buckets_path</literal> for the second derivative points to the name of the first derivative
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               } <co id="CO97-1"/>
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               },
               "sales_deriv": {
                  "value": -490
               } <co id="CO97-2"/>
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               },
               "sales_deriv": {
                  "value": 315
               },
               "sales_2nd_deriv": {
                  "value": 805
               }
            }
         ]
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO97-1 CO97-2">
<para>
No second derivative for the first two buckets since we need at least 2 data points from the first derivative to calculate the
second derivative
</para>
</callout>
</calloutlist>
</section>
<section id="_units">
<title>Units<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/derivative-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The derivative aggregation allows the units of the derivative values to be specified. This returns an extra field in the response
<literal>normalized_value</literal> which reports the derivative value in the desired x-axis units.  In the below example we calculate the derivative
of the total sales per month but ask for the derivative of the sales as in the units of sales per day:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "sales_deriv": {
                    "derivative": {
                        "buckets_path": "sales",
                        "unit": "day" <co id="CO98-1"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO98-1">
<para>
<literal>unit</literal> specifies what unit to use for the x-axis of the derivative calculation
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               } <co id="CO99-1"/>
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               },
               "sales_deriv": {
                  "value": -490, <co id="CO99-2"/>
                  "normalized_value": -17.5 <co id="CO99-3"/>
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               },
               "sales_deriv": {
                  "value": 315,
                  "normalized_value": 10.16129032258065
               }
            }
         ]
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO99-1 CO99-2">
<para>
<literal>value</literal> is reported in the original units of <emphasis>per month</emphasis>
</para>
</callout>
<callout arearefs="CO99-3">
<para>
<literal>normalized_value</literal> is reported in the desired units of <emphasis>per day</emphasis>
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-pipeline-max-bucket-aggregation">
<title>Max Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/max-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which identifies the bucket(s) with the maximum value of a specified metric in a sibling aggregation
and outputs both the value and the key(s) of the bucket(s). The specified metric must be numeric and the sibling aggregation must
be a multi-bucket aggregation.</simpara>
<section id="_syntax_3">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/max-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>max_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "max_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>max_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the maximum for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the maximum of the total monthly <literal>sales</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "max_monthly_sales": {
            "max_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO100-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO100-1">
<para>
<literal>buckets_path</literal> instructs this max_bucket aggregation that we want the maximum value of the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "max_monthly_sales": {
          "keys": ["2015/01/01 00:00:00"], <co id="CO101-1"/>
          "value": 550
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO101-1">
<para>
<literal>keys</literal> is an array of strings since the maximum value may be present in multiple buckets
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-pipeline-min-bucket-aggregation">
<title>Min Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/min-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which identifies the bucket(s) with the minimum value of a specified metric in a sibling aggregation
and outputs both the value and the key(s) of the bucket(s). The specified metric must be numeric and the sibling aggregation must
be a multi-bucket aggregation.</simpara>
<section id="_syntax_4">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/min-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>max_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "min_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>min_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the minimum for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the minimum of the total monthly <literal>sales</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "min_monthly_sales": {
            "min_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO102-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO102-1">
<para>
<literal>buckets_path</literal> instructs this max_bucket aggregation that we want the minimum value of the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "min_monthly_sales": {
          "keys": ["2015/02/01 00:00:00"], <co id="CO103-1"/>
          "value": 60
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO103-1">
<para>
<literal>keys</literal> is an array of strings since the minimum value may be present in multiple buckets
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-pipeline-sum-bucket-aggregation">
<title>Sum Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/sum-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which calculates the sum across all bucket of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</simpara>
<section id="_syntax_5">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/sum-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>sum_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "sum_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>sum_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the sum for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara></simpara></entry>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the sum of all the total monthly <literal>sales</literal> buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "sum_monthly_sales": {
            "sum_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO104-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO104-1">
<para>
<literal>buckets_path</literal> instructs this sum_bucket aggregation that we want the sum of the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "sum_monthly_sales": {
          "value": 985
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-stats-bucket-aggregation">
<title>Stats Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/stats-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which calculates a variety of stats across all bucket of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</simpara>
<section id="_syntax_6">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/stats-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>stats_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "stats_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>stats_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to calculate stats for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>skip</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>null</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the sum of all the total monthly <literal>sales</literal> buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "stats_monthly_sales": {
            "stats_bucket": {
                "buckets_path": "sales_per_month&gt;sales" <co id="CO105-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO105-1">
<para>
<literal>bucket_paths</literal> instructs this <literal>stats_bucket</literal> aggregation that we want the calculate stats for the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "stats_monthly_sales": {
         "count": 3,
         "min": 60,
         "max": 550,
         "avg": 328.333333333,
         "sum": 985
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-extended-stats-bucket-aggregation">
<title>Extended Stats Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/extended-stats-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which calculates a variety of stats across all bucket of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</simpara>
<simpara>This aggregation provides a few more statistics (sum of squares, standard deviation, etc) compared to the <literal>stats_bucket</literal> aggregation.</simpara>
<section id="_syntax_7">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/extended-stats-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>extended_stats_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "extended_stats_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>extended_stats_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to calculate stats for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>skip</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>null</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sigma</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of standard deviations above/below the mean to display</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the sum of all the total monthly <literal>sales</literal> buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "stats_monthly_sales": {
            "extended_stats_bucket": {
                "buckets_paths": "sales_per_month&gt;sales" <co id="CO106-1"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO106-1">
<para>
<literal>bucket_paths</literal> instructs this <literal>extended_stats_bucket</literal> aggregation that we want the calculate stats for the <literal>sales</literal> aggregation in the
<literal>sales_per_month</literal> date histogram.
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "stats_monthly_sales": {
         "count": 3,
         "min": 60,
         "max": 550,
         "avg": 328.333333333,
         "sum": 985,
         "sum_of_squares": 446725,
         "variance": 41105.5555556,
         "std_deviation": 117.054909559,
         "std_deviation_bounds": {
           "upper": 562.443152451,
           "lower": 94.2235142151
         }
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-percentiles-bucket-aggregation">
<title>Percentiles Bucket Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A sibling pipeline aggregation which calculates percentiles across all bucket of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</simpara>
<section id="_syntax_8">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>percentiles_bucket</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "percentiles_bucket": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>sum_bucket</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the sum for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>skip</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>null</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percents</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The list of percentiles to calculate</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ 1, 5, 25, 50, 75, 95, 99 ]</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the sum of all the total monthly <literal>sales</literal> buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "sum_monthly_sales": {
            "percentiles_bucket": {
                "buckets_path": "sales_per_month&gt;sales", <co id="CO107-1"/>
                "percents": [ 25.0, 50.0, 75.0 ] <co id="CO107-2"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO107-1">
<para>
<literal>buckets_path</literal> instructs this percentiles_bucket aggregation that we want to calculate percentiles for
the <literal>sales</literal> aggregation in the <literal>sales_per_month</literal> date histogram.
</para>
</callout>
<callout arearefs="CO107-2">
<para>
<literal>percents</literal> specifies which percentiles we wish to calculate, in this case, the 25th, 50th and 75th percentil
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               }
            }
         ]
      },
      "percentiles_monthly_sales": {
        "values" : {
            "25.0": 60,
            "50.0": 375",
            "75.0": 550
         }
      }
   }
}</programlisting>
</section>
<section id="_percentiles_bucket_implementation">
<title>Percentiles_bucket implementation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The Percentile Bucket returns the nearest input data point that is not greater than the requested percentile; it does not
interpolate between data points.</simpara>
<simpara>The percentiles are calculated exactly and is not an approximation (unlike the Percentiles Metric). This means
the implementation maintains an in-memory, sorted list of your data to compute the percentiles, before discarding the
data.  You may run into memory pressure issues if you attempt to calculate percentiles over many millions of
data-points in a single <literal>percentiles_bucket</literal>.</simpara>
</section>
</section>
<section id="search-aggregations-pipeline-movavg-aggregation">
<title>Moving Average Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>Given an ordered series of data, the Moving Average aggregation will slide a window across the data and emit the average
value of that window.  For example, given the data <literal>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</literal>, we can calculate a simple moving
average with windows size of <literal>5</literal> as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
(1 + 2 + 3 + 4 + 5) / 5  = 3
</simpara>
</listitem>
<listitem>
<simpara>
(2 + 3 + 4 + 5 + 6) / 5  = 4
</simpara>
</listitem>
<listitem>
<simpara>
(3 + 4 + 5 + 6 + 7) / 5 = 5
</simpara>
</listitem>
<listitem>
<simpara>
etc
</simpara>
</listitem>
</itemizedlist>
<simpara>Moving averages are a simple method to smooth sequential data.  Moving averages are typically applied to time-based data,
such as stock prices or server metrics.  The smoothing can be used to eliminate high frequency fluctuations or random noise,
which allows the lower frequency trends to be more easily visualized, such as seasonality.</simpara>
<section id="_syntax_9">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>moving_avg</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "moving_avg": {
        "buckets_path": "the_sum",
        "model": "holt",
        "window": 5,
        "gap_policy": "insert_zero",
        "settings": {
            "alpha": 0.8
        }
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>moving_avg</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Path to the metric of interest (see <link linkend="buckets-path-syntax"><literal>buckets_path</literal> Syntax</link> for more details</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>model</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The moving average weighting model that we wish to use</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>simple</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Determines what should happen when a gap in the data is encountered.</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>insert_zero</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>window</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The size of window to "slide" across the histogram.</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>5</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>minimize</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If the model should be algorithmically minimized.  See <link linkend="movavg-minimizer">Minimization</link> for more
 details</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>false</literal> for most models</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>settings</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Model-specific settings, contents which differ depending on the model specified.</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><literal>moving_avg</literal> aggregations must be embedded inside of a <literal>histogram</literal> or <literal>date_histogram</literal> aggregation.  They can be
embedded like any other metric aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "my_date_histo":{                <co id="CO108-1"/>
        "date_histogram":{
            "field":"timestamp",
            "interval":"day"
        },
        "aggs":{
            "the_sum":{
                "sum":{ "field": "lemmings" } <co id="CO108-2"/>
            },
            "the_movavg":{
                "moving_avg":{ "buckets_path": "the_sum" } <co id="CO108-3"/>
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO108-1">
<para>
A <literal>date_histogram</literal> named "my_date_histo" is constructed on the "timestamp" field, with one-day intervals
</para>
</callout>
<callout arearefs="CO108-2">
<para>
A <literal>sum</literal> metric is used to calculate the sum of a field.  This could be any metric (sum, min, max, etc)
</para>
</callout>
<callout arearefs="CO108-3">
<para>
Finally, we specify a <literal>moving_avg</literal> aggregation which uses "the_sum" metric as its input.
</para>
</callout>
</calloutlist>
<simpara>Moving averages are built by first specifying a <literal>histogram</literal> or <literal>date_histogram</literal> over a field.  You can then optionally
add normal metrics, such as a <literal>sum</literal>, inside of that histogram.  Finally, the <literal>moving_avg</literal> is embedded inside the histogram.
The <literal>buckets_path</literal> parameter is then used to "point" at one of the sibling metrics inside of the histogram (see
<xref linkend="buckets-path-syntax"/> for a description of the syntax for <literal>buckets_path</literal>.</simpara>
</section>
<section id="_models">
<title>Models<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>moving_avg</literal> aggregation includes four different moving average "models".  The main difference is how the values in the
window are weighted.  As data-points become "older" in the window, they may be weighted differently.  This will
affect the final average for that window.</simpara>
<simpara>Models are specified using the <literal>model</literal> parameter.  Some models may have optional configurations which are specified inside
the <literal>settings</literal> parameter.</simpara>
<section id="_simple">
<title>Simple<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>simple</literal> model calculates the sum of all values in the window, then divides by the size of the window.  It is effectively
a simple arithmetic mean of the window.  The simple model does not perform any time-dependent weighting, which means
the values from a <literal>simple</literal> moving average tend to "lag" behind the real data.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "simple"
        }
    }
}</programlisting>
<simpara>A <literal>simple</literal> model has no special settings to configure</simpara>
<simpara>The window size can change the behavior of the moving average.  For example, a small window (<literal>"window": 10</literal>) will closely
track the data and only smooth out small scale fluctuations:</simpara>
<figure id="movavg_10window"><title>Moving average with window of size 10</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/movavg_10window.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/movavg_10window.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>In contrast, a <literal>simple</literal> moving average with larger window (<literal>"window": 100</literal>) will smooth out all higher-frequency fluctuations,
leaving only low-frequency, long term trends.  It also tends to "lag" behind the actual data by a substantial amount:</simpara>
<figure id="movavg_100window"><title>Moving average with window of size 100</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/movavg_100window.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/movavg_100window.png</phrase></textobject>
</mediaobject>
</figure>
</section>
</section>
<section id="_linear">
<title>Linear<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>linear</literal> model assigns a linear weighting to points in the series, such that "older" datapoints (e.g. those at
the beginning of the window) contribute a linearly less amount to the total average.  The linear weighting helps reduce
the "lag" behind the data&#8217;s mean, since older points have less influence.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "linear"
        }
}</programlisting>
<simpara>A <literal>linear</literal> model has no special settings to configure</simpara>
<simpara>Like the <literal>simple</literal> model, window size can change the behavior of the moving average.  For example, a small window (<literal>"window": 10</literal>)
will closely track the data and only smooth out small scale fluctuations:</simpara>
<figure id="linear_10window"><title>Linear moving average with window of size 10</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/linear_10window.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/linear_10window.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>In contrast, a <literal>linear</literal> moving average with larger window (<literal>"window": 100</literal>) will smooth out all higher-frequency fluctuations,
leaving only low-frequency, long term trends.  It also tends to "lag" behind the actual data by a substantial amount,
although typically less than the <literal>simple</literal> model:</simpara>
<figure id="linear_100window"><title>Linear moving average with window of size 100</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/linear_100window.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/linear_100window.png</phrase></textobject>
</mediaobject>
</figure>
</section>
<section id="_ewma_exponentially_weighted">
<title>EWMA (Exponentially Weighted)<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>ewma</literal> model (aka "single-exponential") is similar to the <literal>linear</literal> model, except older data-points become exponentially less important,
rather than linearly less important.  The speed at which the importance decays can be controlled with an <literal>alpha</literal>
setting.  Small values make the weight decay slowly, which provides greater smoothing and takes into account a larger
portion of the window.  Larger valuers make the weight decay quickly, which reduces the impact of older values on the
moving average.  This tends to make the moving average track the data more closely but with less smoothing.</simpara>
<simpara>The default value of <literal>alpha</literal> is <literal>0.3</literal>, and the setting accepts any float from 0-1 inclusive.</simpara>
<simpara>The EWMA model can be <link linkend="movavg-minimizer">Minimized</link></simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "ewma",
            "settings" : {
                "alpha" : 0.5
            }
        }
}</programlisting>
<figure id="single_0.2alpha"><title>EWMA with window of size 10, alpha = 0.2</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/single_0.2alpha.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/single_0.2alpha.png</phrase></textobject>
</mediaobject>
</figure>
<figure id="single_0.7alpha"><title>EWMA with window of size 10, alpha = 0.7</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/single_0.7alpha.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/single_0.7alpha.png</phrase></textobject>
</mediaobject>
</figure>
</section>
<section id="_holt_linear">
<title>Holt-Linear<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>holt</literal> model (aka "double exponential") incorporates a second exponential term which
tracks the data&#8217;s trend.  Single exponential does not perform well when the data has an underlying linear trend.  The
double exponential model calculates two values internally: a "level" and a "trend".</simpara>
<simpara>The level calculation is similar to <literal>ewma</literal>, and is an exponentially weighted view of the data.  The difference is
that the previously smoothed value is used instead of the raw value, which allows it to stay close to the original series.
The trend calculation looks at the difference between the current and last value (e.g. the slope, or trend, of the
smoothed data).  The trend value is also exponentially weighted.</simpara>
<simpara>Values are produced by multiplying the level and trend components.</simpara>
<simpara>The default value of <literal>alpha</literal> is <literal>0.3</literal> and <literal>beta</literal> is <literal>0.1</literal>. The settings accept any float from 0-1 inclusive.</simpara>
<simpara>The Holt-Linear model can be <link linkend="movavg-minimizer">Minimized</link></simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "holt",
            "settings" : {
                "alpha" : 0.5,
                "beta" : 0.5
            }
        }
}</programlisting>
<simpara>In practice, the <literal>alpha</literal> value behaves very similarly in <literal>holt</literal> as <literal>ewma</literal>: small values produce more smoothing
and more lag, while larger values produce closer tracking and less lag.  The value of <literal>beta</literal> is often difficult
to see.  Small values emphasize long-term trends (such as a constant linear trend in the whole series), while larger
values emphasize short-term trends.  This will become more apparently when you are predicting values.</simpara>
<figure id="double_0.2beta"><title>Holt-Linear moving average with window of size 100, alpha = 0.5, beta = 0.2</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/double_0.2beta.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/double_0.2beta.png</phrase></textobject>
</mediaobject>
</figure>
<figure id="double_0.7beta"><title>Holt-Linear moving average with window of size 100, alpha = 0.5, beta = 0.7</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/double_0.7beta.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/double_0.7beta.png</phrase></textobject>
</mediaobject>
</figure>
</section>
<section id="_holt_winters">
<title>Holt-Winters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>The <literal>holt_winters</literal> model (aka "triple exponential") incorporates a third exponential term which
tracks the seasonal aspect of your data.  This aggregation therefore smooths based on three components: "level", "trend"
and "seasonality".</simpara>
<simpara>The level and trend calculation is identical to <literal>holt</literal> The seasonal calculation looks at the difference between
the current point, and the point one period earlier.</simpara>
<simpara>Holt-Winters requires a little more handholding than the other moving averages.  You need to specify the "periodicity"
of your data: e.g. if your data has cyclic trends every 7 days, you would set <literal>period: 7</literal>.  Similarly if there was
a monthly trend, you would set it to <literal>30</literal>.  There is currently no periodicity detection, although that is planned
for future enhancements.</simpara>
<simpara>There are two varieties of Holt-Winters: additive and multiplicative.</simpara>
<section id="_cold_start">
<title>"Cold Start"<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Unfortunately, due to the nature of Holt-Winters, it requires two periods of data to "bootstrap" the algorithm.  This
means that your <literal>window</literal> must always be <emphasis role="strong">at least</emphasis> twice the size of your period.  An exception will be thrown if it
isn&#8217;t.  It also means that Holt-Winters will not emit a value for the first <literal>2 * period</literal> buckets; the current algorithm
does not backcast.</simpara>
<figure id="holt_winters_cold_start"><title>Holt-Winters showing a "cold" start where no values are emitted</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/triple_untruncated.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/triple_untruncated.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>Because the "cold start" obscures what the moving average looks like, the rest of the Holt-Winters images are truncated
to not show the "cold start".  Just be aware this will always be present at the beginning of your moving averages!</simpara>
</section>
<section id="_additive_holt_winters">
<title>Additive Holt-Winters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Additive seasonality is the default; it can also be specified by setting <literal>"type": "add"</literal>.  This variety is preferred
when the seasonal affect is additive to your data. E.g. you could simply subtract the seasonal effect to "de-seasonalize"
your data into a flat trend.</simpara>
<simpara>The default values of <literal>alpha</literal> and <literal>gamma</literal> are <literal>0.3</literal> while <literal>beta</literal> is <literal>0.1</literal>.  The settings accept any float from 0-1 inclusive.
The default value of <literal>period</literal> is <literal>1</literal>.</simpara>
<simpara>The additive Holt-Winters model can be <link linkend="movavg-minimizer">Minimized</link></simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "holt_winters",
            "settings" : {
                "type" : "add",
                "alpha" : 0.5,
                "beta" : 0.5,
                "gamma" : 0.5,
                "period" : 7
            }
        }
}</programlisting>
<figure id="holt_winters_add"><title>Holt-Winters moving average with window of size 120, alpha = 0.5, beta = 0.7, gamma = 0.3, period = 30</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/triple.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/triple.png</phrase></textobject>
</mediaobject>
</figure>
</section>
<section id="_multiplicative_holt_winters">
<title>Multiplicative Holt-Winters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Multiplicative is specified by setting <literal>"type": "mult"</literal>.  This variety is preferred when the seasonal affect is
multiplied against your data. E.g. if the seasonal affect is x5 the data, rather than simply adding to it.</simpara>
<simpara>The default values of <literal>alpha</literal> and <literal>gamma</literal> are <literal>0.3</literal> while <literal>beta</literal> is <literal>0.1</literal>.  The settings accept any float from 0-1 inclusive.
The default value of <literal>period</literal> is <literal>1</literal>.</simpara>
<simpara>The multiplicative Holt-Winters model can be <link linkend="movavg-minimizer">Minimized</link></simpara>
<warning>
<simpara>Multiplicative Holt-Winters works by dividing each data point by the seasonal value.  This is problematic if any of
your data is zero, or if there are gaps in the data (since this results in a divid-by-zero).  To combat this, the
<literal>mult</literal> Holt-Winters pads all values by a very small amount (1*10<superscript>-10</superscript>) so that all values are non-zero.  This affects
the result, but only minimally.  If your data is non-zero, or you prefer to see <literal>NaN</literal> when zero&#8217;s are encountered,
you can disable this behavior with <literal>pad: false</literal></simpara>
</warning>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "holt_winters",
            "settings" : {
                "type" : "mult",
                "alpha" : 0.5,
                "beta" : 0.5,
                "gamma" : 0.5,
                "period" : 7,
                "pad" : true
            }
        }
}</programlisting>
</section>
</section>
<section id="_prediction">
<title>Prediction<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>All the moving average model support a "prediction" mode, which will attempt to extrapolate into the future given the
current smoothed, moving average.  Depending on the model and parameter, these predictions may or may not be accurate.</simpara>
<simpara>Predictions are enabled by adding a <literal>predict</literal> parameter to any moving average aggregation, specifying the number of
predictions you would like appended to the end of the series.  These predictions will be spaced out at the same interval
as your buckets:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "window" : 30,
            "model" : "simple",
            "predict" : 10
        }
}</programlisting>
<simpara>The <literal>simple</literal>, <literal>linear</literal> and <literal>ewma</literal> models all produce "flat" predictions: they essentially converge on the mean
of the last value in the series, producing a flat:</simpara>
<figure id="simple_prediction"><title>Simple moving average with window of size 10, predict = 50</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/simple_prediction.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/simple_prediction.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>In contrast, the <literal>holt</literal> model can extrapolate based on local or global constant trends.  If we set a high <literal>beta</literal>
value, we can extrapolate based on local constant trends (in this case the predictions head down, because the data at the end
of the series was heading in a downward direction):</simpara>
<figure id="double_prediction_local"><title>Holt-Linear moving average with window of size 100, predict = 20, alpha = 0.5, beta = 0.8</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/double_prediction_local.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/double_prediction_local.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>In contrast, if we choose a small <literal>beta</literal>, the predictions are based on the global constant trend.  In this series, the
global trend is slightly positive, so the prediction makes a sharp u-turn and begins a positive slope:</simpara>
<figure id="double_prediction_global"><title>Double Exponential moving average with window of size 100, predict = 20, alpha = 0.5, beta = 0.1</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/double_prediction_global.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/double_prediction_global.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>The <literal>holt_winters</literal> model has the potential to deliver the best predictions, since it also incorporates seasonal
fluctuations into the model:</simpara>
<figure id="holt_winters_prediction_global"><title>Holt-Winters moving average with window of size 120, predict = 25, alpha = 0.8, beta = 0.2, gamma = 0.7, period = 30</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_movavg/triple_prediction.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_movavg/triple_prediction.png</phrase></textobject>
</mediaobject>
</figure>
</section>
<section id="movavg-minimizer">
<title>Minimization<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/movavg-aggregation.asciidoc">Edit me</ulink></title>
<simpara>Some of the models (EWMA, Holt-Linear, Holt-Winters) require one or more parameters to be configured.  Parameter choice
can be tricky and sometimes non-intuitive.  Furthermore, small deviations in these parameters can sometimes have a drastic
effect on the output moving average.</simpara>
<simpara>For that reason, the three "tunable" models can be algorithmically <emphasis role="strong">minimized</emphasis>.  Minimization is a process where parameters
are tweaked until the predictions generated by the model closely match the output data.  Minimization is not fullproof
and can be susceptible to overfitting, but it often gives better results than hand-tuning.</simpara>
<simpara>Minimization is disabled by default for <literal>ewma</literal> and <literal>holt_linear</literal>, while it is enabled by default for <literal>holt_winters</literal>.
Minimization is most useful with Holt-Winters, since it helps improve the accuracy of the predictions.  EWMA and
Holt-Linear are not great predictors, and mostly used for smoothing data, so minimization is less useful on those
models.</simpara>
<simpara>Minimization is enabled/disabled via the <literal>minimize</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "the_movavg":{
        "moving_avg":{
            "buckets_path": "the_sum",
            "model" : "holt_winters",
            "window" : 30,
            "minimize" : true,  <co id="CO109-1"/>
            "settings" : {
                "period" : 7
            }
        }
}</programlisting>
<calloutlist>
<callout arearefs="CO109-1">
<para>
Minimization is enabled with the <literal>minimize</literal> parameter
</para>
</callout>
</calloutlist>
<simpara>When enabled, minimization will find the optimal values for <literal>alpha</literal>, <literal>beta</literal> and <literal>gamma</literal>.  The user should still provide
appropriate values for <literal>window</literal>, <literal>period</literal> and <literal>type</literal>.</simpara>
<warning>
<simpara>Minimization works by running a stochastic process called <emphasis role="strong">simulated annealing</emphasis>.  This process will usually generate
a good solution, but is not guaranteed to find the global optimum.  It also requires some amount of additional
computational power, since the model needs to be re-run multiple times as the values are tweaked.  The run-time of
minimization is linear to the size of the window being processed: excessively large windows may cause latency.</simpara>
<simpara>Finally, minimization fits the model to the last <literal>n</literal> values, where <literal>n = window</literal>.  This generally produces
better forecasts into the future, since the parameters are tuned around the end of the series.  It can, however, generate
poorer fitting moving averages at the beginning of the series.</simpara>
</warning>
</section>
</section>
<section id="search-aggregations-pipeline-cumulative-sum-aggregation">
<title>Cumulative Sum Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/cumulative-sum-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A parent pipeline aggregation which calculates the cumulative sum of a specified metric in a parent histogram (or date_histogram)
aggregation. The specified metric must be numeric and the enclosing histogram must have <literal>min_doc_count</literal> set to <literal>0</literal> (default
for <literal>histogram</literal> aggregations).</simpara>
<section id="_syntax_10">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/cumulative-sum-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>cumulative_sum</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "cumulative_sum": {
        "buckets_path": "the_sum"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>cumulative_sum</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The path to the buckets we wish to find the cumulative sum for (see <xref linkend="buckets-path-syntax"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the cumulative sum of the total monthly <literal>sales</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "cumulative_sales": {
                    "cumulative_sum": {
                        "buckets_path": "sales" <co id="CO110-1"/>
                    }
                }
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO110-1">
<para>
<literal>buckets_path</literal> instructs this cumulative sum aggregation to use the output of the <literal>sales</literal> aggregation for the cumulative sum
</para>
</callout>
</calloutlist>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550
               },
               "cumulative_sales": {
                  "value": 550
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60
               },
               "cumulative_sales": {
                  "value": 610
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375
               },
               "cumulative_sales": {
                  "value": 985
               }
            }
         ]
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-bucket-script-aggregation">
<title>Bucket Script Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/bucket-script-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A parent pipeline aggregation which executes a script which can perform per bucket computations on specified metrics
in the parent multi-bucket aggregation. The specified metric must be numeric and the script must return a numeric value.</simpara>
<section id="_syntax_11">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/bucket-script-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>bucket_script</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bucket_script": {
        "buckets_path": {
            "my_var1": "the_sum", <co id="CO111-1"/>
            "my_var2": "the_value_count"
        },
        "script": "my_var1 / my_var2"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO111-1">
<para>
Here, <literal>my_var1</literal> is the name of the variable for this buckets path to use in the script, <literal>the_sum</literal> is the path to
the metrics to use for that variable.
</para>
</callout>
</calloutlist>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>bucket_script</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>script</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The script to run for this aggregation. The script can be inline, file or indexed. (see <xref linkend="modules-scripting"/>
for more details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A map of script variables and their associated path to the buckets we wish to use for the variable
(see <xref linkend="buckets-path-syntax"/> for more details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>null</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet calculates the ratio percentage of t-shirt sales compared to total sales each month:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "total_sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "t-shirts": {
                  "filter": {
                    "term": {
                      "type": "t-shirt"
                    }
                  },
                  "aggs": {
                    "sales": {
                      "sum": {
                        "field": "price"
                      }
                    }
                  }
                },
                "t-shirt-percentage": {
                    "bucket_script": {
                        "buckets_path": {
                          "tShirtSales": "t-shirts&gt;sales",
                          "totalSales": "total_sales"
                        },
                        "script": "tShirtSales / totalSales * 100"
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "total_sales": {
                   "value": 50
               },
               "t-shirts": {
                   "doc_count": 2,
                   "sales": {
                       "value": 10
                   }
               },
               "t-shirt-percentage": {
                   "value": 20
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2
               "total_sales": {
                   "value": 60
               },
               "t-shirts": {
                   "doc_count": 1,
                   "sales": {
                       "value": 15
                   }
               },
               "t-shirt-percentage": {
                   "value": 25
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "total_sales": {
                   "value": 40
               },
               "t-shirts": {
                   "doc_count": 1,
                   "sales": {
                       "value": 20
                   }
               },
               "t-shirt-percentage": {
                   "value": 50
               }
            }
         ]
      }
   }
}</programlisting>
</section>
</section>
<section id="search-aggregations-pipeline-bucket-selector-aggregation">
<title>Bucket Selector Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/bucket-selector-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>A parent pipeline aggregation which executes a script which determines whether the current bucket will be retained
in the parent multi-bucket aggregation. The specified metric must be numeric and the script must return a boolean value.
If the script language is <literal>expression</literal> then a numeric return value is permitted. In this case 0.0 will be evaluated as <literal>false</literal>
and all other values will evaluate to true.</simpara>
<simpara>Note: The bucket_selector aggregation, like all pipeline aggregations, executions after all other sibling aggregations. This means that
using the bucket_selector aggregation to filter the returned buckets in the response does not save on execution time running the aggregations.</simpara>
<section id="_syntax_12">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/bucket-selector-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>bucket_selector</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bucket_selector": {
        "buckets_path": {
            "my_var1": "the_sum", <co id="CO112-1"/>
            "my_var2": "the_value_count"
        },
        "script": "my_var1 &gt; my_var2"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO112-1">
<para>
Here, <literal>my_var1</literal> is the name of the variable for this buckets path to use in the script, <literal>the_sum</literal> is the path to
the metrics to use for that variable.
</para>
</callout>
</calloutlist>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>bucket_selector</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>script</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The script to run for this aggregation. The script can be inline, file or indexed. (see <xref linkend="modules-scripting"/>
for more details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A map of script variables and their associated path to the buckets we wish to use for the variable
(see <xref linkend="buckets-path-syntax"/> for more details)</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The policy to apply when gaps are found in the data (see <xref linkend="gap-policy"/> for more
 details)</simpara></entry>
<entry align="left" valign="top"><simpara>Optional, defaults to <literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following snippet only retains buckets where the total sales for the month is less than or equal to 50:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "total_sales": {
                    "sum": {
                        "field": "price"
                    }
                },
                "sales_bucket_filter": {
                    "bucket_selector": {
                        "buckets_path": {
                          "totalSales": "total_sales"
                        },
                        "script": "totalSales &lt;= 50"
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>And the following may be the response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "total_sales": {
                   "value": 50
               }
            },<co id="CO113-1"/>
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "total_sales": {
                   "value": 40
               },
            }
         ]
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO113-1">
<para>
Bucket for <literal>2015/02/01 00:00:00</literal> has been removed as its total sales exceeded 50
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="search-aggregations-pipeline-serialdiff-aggregation">
<title>Serial Differencing Aggregation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/serial-diff-aggregation.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>Serial differencing is a technique where values in a time series are subtracted from itself at
different time lags or periods. For example, the datapoint f(x) = f(x<subscript>t</subscript>) - f(x<subscript>t-n</subscript>), where n is the period being used.</simpara>
<simpara>A period of 1 is equivalent to a derivative with no time normalization: it is simply the change from one point to the
next. Single periods are useful for removing constant, linear trends.</simpara>
<simpara>Single periods are also useful for transforming data into a stationary series. In this example, the Dow Jones is
plotted over ~250 days. The raw data is not stationary, which would make it difficult to use with some techniques.</simpara>
<simpara>By calculating the first-difference, we de-trend the data (e.g. remove a constant, linear trend).  We can see that the
data becomes a stationary series (e.g. the first difference is randomly distributed around zero, and doesn&#8217;t seem to
exhibit any pattern/behavior). The transformation reveals that the dataset is following a random-walk; the value is the
previous value +/- a random amount.  This insight allows selection of further tools for analysis.</simpara>
<figure id="serialdiff_dow"><title>Dow Jones plotted and made stationary with first-differencing</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_serialdiff/dow.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_serialdiff/dow.png</phrase></textobject>
</mediaobject>
</figure>
<simpara>Larger periods can be used to remove seasonal / cyclic behavior. In this example, a population of lemmings was
synthetically generated with a sine wave + constant linear trend + random noise. The sine wave has a period of 30 days.</simpara>
<simpara>The first-difference removes the constant trend, leaving just a sine wave. The 30th-difference is then applied to the
first-difference to remove the cyclic behavior, leaving a stationary series which is amenable to other analysis.</simpara>
<figure id="serialdiff_lemmings"><title>Lemmings data plotted made stationary with 1st and 30th difference</title>
<mediaobject>
  <imageobject>
  <imagedata fileref="images/pipeline_serialdiff/lemmings.png"/>
  </imageobject>
  <textobject><phrase>images/pipeline_serialdiff/lemmings.png</phrase></textobject>
</mediaobject>
</figure>
<section id="_syntax_13">
<title>Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/pipeline/serial-diff-aggregation.asciidoc">Edit me</ulink></title>
<simpara>A <literal>serial_diff</literal> aggregation looks like this in isolation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "serial_diff": {
        "buckets_path": "the_sum",
        "lag": "7"
    }
}</programlisting>
<table
frame="all"
rowsep="1" colsep="1"
>
<title><literal>serial_diff</literal> Parameters</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Parameter Name</simpara></entry>
<entry align="left" valign="top"><simpara>Description</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara>Default Value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buckets_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Path to the metric of interest (see <link linkend="buckets-path-syntax"><literal>buckets_path</literal> Syntax</link> for more details</simpara></entry>
<entry align="left" valign="top"><simpara>Required</simpara></entry>
<entry align="left" valign="top"><simpara></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lag</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The historical bucket to subtract from the current value. E.g. a lag of 7 will subtract the current value from
 the value 7 buckets ago. Must be a positive, non-zero integer</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>1</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>gap_policy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Determines what should happen when a gap in the data is encountered.</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>insert_zero</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Format to apply to the output value of this aggregation</simpara></entry>
<entry align="left" valign="top"><simpara>Optional</simpara></entry>
<entry align="left" valign="top"><simpara><literal>null</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><literal>serial_diff</literal> aggregations must be embedded inside of a <literal>histogram</literal> or <literal>date_histogram</literal> aggregation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "aggs": {
      "my_date_histo": {                  <co id="CO114-1"/>
         "date_histogram": {
            "field": "timestamp",
            "interval": "day"
         },
         "aggs": {
            "the_sum": {
               "sum": {
                  "field": "lemmings"     <co id="CO114-2"/>
               }
            },
            "thirtieth_difference": {
               "serial_diff": {                <co id="CO114-3"/>
                  "buckets_path": "the_sum",
                  "lag" : 30
               }
            }
         }
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO114-1">
<para>
A <literal>date_histogram</literal> named "my_date_histo" is constructed on the "timestamp" field, with one-day intervals
</para>
</callout>
<callout arearefs="CO114-2">
<para>
A <literal>sum</literal> metric is used to calculate the sum of a field.  This could be any metric (sum, min, max, etc)
</para>
</callout>
<callout arearefs="CO114-3">
<para>
Finally, we specify a <literal>serial_diff</literal> aggregation which uses "the_sum" metric as its input.
</para>
</callout>
</calloutlist>
<simpara>Serial differences are built by first specifying a <literal>histogram</literal> or <literal>date_histogram</literal> over a field.  You can then optionally
add normal metrics, such as a <literal>sum</literal>, inside of that histogram.  Finally, the <literal>serial_diff</literal> is embedded inside the histogram.
The <literal>buckets_path</literal> parameter is then used to "point" at one of the sibling metrics inside of the histogram (see
<xref linkend="buckets-path-syntax"/> for a description of the syntax for <literal>buckets_path</literal>.</simpara>
</section>
</section>
</chapter>
<chapter id="caching-heavy-aggregations">
<title>Caching heavy aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/misc.asciidoc">Edit me</ulink></title>
<simpara>Frequently used aggregations (e.g. for display on the home page of a website)
can be cached for faster responses. These cached results are the same results
that would be returned by an uncached aggregation&#8201;&#8212;&#8201;you will never get stale
results.</simpara>
<simpara>See <xref linkend="shard-request-cache"/> for more details.</simpara>
</chapter>
<chapter id="returning-only-agg-results">
<title>Returning only aggregation results<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/misc.asciidoc">Edit me</ulink></title>
<simpara>There are many occasions when aggregations are required but search hits are not.  For these cases the hits can be ignored by
setting <literal>size=0</literal>. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search' -d '{
  "size": 0,
  "aggregations": {
    "my_agg": {
      "terms": {
        "field": "text"
      }
    }
  }
}
'</programlisting>
<simpara>Setting <literal>size</literal> to <literal>0</literal> avoids executing the fetch phase of the search making the request more efficient.</simpara>
</chapter>
<chapter id="agg-metadata">
<title>Aggregation Metadata<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/aggregations/misc.asciidoc">Edit me</ulink></title>
<simpara>You can associate a piece of metadata with individual aggregations at request time that will be returned in place
at response time.</simpara>
<simpara>Consider this example where we want to associate the color blue with our <literal>terms</literal> aggregation.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
    "aggs": {
        "titles": {
            "terms": {
                "field": "title"
            },
            "meta": {
                "color": "blue"
            },
        }
    }
}</programlisting>
<simpara>Then that piece of metadata will be returned in place for our <literal>titles</literal> terms aggregation</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
    "aggregations": {
        "titles": {
            "meta": {
                "color" : "blue"
            },
            "buckets": [
            ]
        }
    }
}</programlisting>
</chapter>
</part>
<part id="indices">
<title>Indices APIs <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>The indices APIs are used to manage individual indices,
index settings, aliases, mappings, index templates
and warmers.</simpara>
<bridgehead id="index-management" renderas="sect1">Index management:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-create-index"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-delete-index"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-get-index"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-exists"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-open-close"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="mapping-management" renderas="sect1">Mapping management:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-put-mapping"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-get-mapping"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-get-field-mapping"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-types-exists"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="alias-management" renderas="sect1">Alias management:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-aliases"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="index-settings" renderas="sect1">Index settings:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-update-settings"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-get-settings"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-analyze"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-templates"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-warmers"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="shadow-replicas" renderas="sect1">Replica configurations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-shadow-replicas"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="monitoring" renderas="sect1">Monitoring:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-stats"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-segments"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-recovery"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-shards-stores"/>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="status-management" renderas="sect1">Status management:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-clearcache"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-refresh"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-flush"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-forcemerge"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-upgrade"/>
</simpara>
</listitem>
</itemizedlist>
</partintro>
<chapter id="indices-create-index">
<title>Create Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></title>
<simpara>The create index API allows to instantiate an index. Elasticsearch
provides support for multiple indices, including executing operations
across several indices.</simpara>
<bridgehead id="create-index-settings" renderas="sect2">Index Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each index created can have specific settings
associated with it.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "number_of_shards" : 3, <co id="CO115-1"/>
            "number_of_replicas" : 2 <co id="CO115-2"/>
        }
    }
}'</programlisting>
<calloutlist>
<callout arearefs="CO115-1">
<para>
Default for <literal>number_of_shards</literal> is 5
</para>
</callout>
<callout arearefs="CO115-2">
<para>
Default for <literal>number_of_replicas</literal> is 1 (ie one replica for each primary shard)
</para>
</callout>
</calloutlist>
<simpara>The above second curl example shows how an index called <literal>twitter</literal> can be
created with specific settings for it using <ulink url="http://www.yaml.org">YAML</ulink>.
In this case, creating an index with 3 shards, each with 2 replicas. The
index settings can also be defined with <ulink url="http://www.json.org">JSON</ulink>:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "number_of_shards" : 3,
            "number_of_replicas" : 2
        }
    }
}'</programlisting>
<simpara>or more simplified</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "number_of_shards" : 3,
        "number_of_replicas" : 2
    }
}'</programlisting>
<note><simpara>You do not have to explicitly specify <literal>index</literal> section inside the
<literal>settings</literal> section.</simpara></note>
<simpara>For more information regarding all the different index level settings
that can be set when creating an index, please check the
<link linkend="index-modules">index modules</link> section.</simpara>
<bridgehead id="mappings" renderas="sect2">Mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>The create index API allows to provide a set of one or more mappings:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST localhost:9200/test -d '{
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "properties" : {
                "field1" : { "type" : "string", "index" : "not_analyzed" }
            }
        }
    }
}'</programlisting>
<bridgehead id="warmers" renderas="sect2">Warmers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>The create index API allows also to provide a set of <link linkend="indices-warmers">warmers</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "source" : {
                "query" : {
                    ...
                }
            }
        }
    }
}'</programlisting>
<bridgehead id="create-index-aliases" renderas="sect2">Aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>The create index API allows also to provide a set of <link linkend="indices-aliases">aliases</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test -d '{
    "aliases" : {
        "alias_1" : {},
        "alias_2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        }
    }
}'</programlisting>
<bridgehead id="_creation_date" renderas="sect2">Creation Date<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/create-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>When an index is created, a timestamp is stored in the index metadata for the creation date.  By
default this is automatically generated but it can also be specified using the
<literal>creation_date</literal> parameter on the create index API:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test -d '{
    "creation_date" : 1407751337000 <co id="CO116-1"/>
}'</programlisting>
<calloutlist>
<callout arearefs="CO116-1">
<para>
<literal>creation_date</literal> is set using epoch time in milliseconds.
</para>
</callout>
</calloutlist>
</chapter>
<chapter id="indices-delete-index">
<title>Delete Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/delete-index.asciidoc">Edit me</ulink></title>
<simpara>The delete index API allows to delete an existing index.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XDELETE 'http://localhost:9200/twitter/'</programlisting>
<simpara>The above example deletes an index called <literal>twitter</literal>. Specifying an index,
alias or wildcard expression is required.</simpara>
<simpara>The delete index API can also be applied to more than one index, by either using a comma separated list, or on all indices (be careful!) by using <literal>_all</literal> or <literal>*</literal> as index.</simpara>
<simpara>In order to disable allowing to delete indices via wildcards or <literal>_all</literal>,
set <literal>action.destructive_requires_name</literal> setting in the config to <literal>true</literal>.
This setting can also be changed via the cluster update settings api.</simpara>
</chapter>
<chapter id="indices-get-index">
<title>Get Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-index.asciidoc">Edit me</ulink></title>
<simpara>The get index API allows to retrieve information about one or more indexes.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/'</programlisting>
<simpara>The above example gets the information for an index called <literal>twitter</literal>. Specifying an index,
alias or wildcard expression is required.</simpara>
<simpara>The get index API can also be applied to more than one index, or on
all indices by using <literal>_all</literal> or <literal>*</literal> as index.</simpara>
<bridgehead id="_filtering_index_information" renderas="sect2">Filtering index information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-index.asciidoc">Edit me</ulink></bridgehead>
<simpara>The information returned by the get API can be filtered to include only specific features
by specifying a comma delimited list of features in the URL:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/_settings,_mappings'</programlisting>
<simpara>The above command will only return the settings and mappings for the index called <literal>twitter</literal>.</simpara>
<simpara>The available features are <literal>_settings</literal>, <literal>_mappings</literal>, <literal>_warmers</literal> and <literal>_aliases</literal>.</simpara>
</chapter>
<chapter id="indices-exists">
<title>Indices Exists<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/indices-exists.asciidoc">Edit me</ulink></title>
<simpara>Used to check if the index (indices) exists or not. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i 'http://localhost:9200/twitter'</programlisting>
<simpara>The HTTP status code indicates if the index exists or not. A <literal>404</literal> means
it does not exist, and <literal>200</literal> means it does.</simpara>
</chapter>
<chapter id="indices-open-close">
<title>Open / Close Index API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/open-close.asciidoc">Edit me</ulink></title>
<simpara>The open and close index APIs allow to close an index, and later on
opening it. A closed index has almost no overhead on the cluster (except
for maintaining its metadata), and is blocked for read/write operations.
A closed index can be opened which will then go through the normal
recovery process.</simpara>
<simpara>The REST endpoint is <literal>/{index}/_close</literal> and <literal>/{index}/_open</literal>. For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/my_index/_close'

curl -XPOST 'localhost:9200/my_index/_open'</programlisting>
<simpara>It is possible to open and close multiple indices. An error will be thrown
if the request explicitly refers to a missing index. This behaviour can be
disabled using the <literal>ignore_unavailable=true</literal> parameter.</simpara>
<simpara>All indices can be opened or closed at once using <literal>_all</literal> as the index name
or specifying patterns that identify them all (e.g. <literal>*</literal>).</simpara>
<simpara>Identifying indices via wildcards or <literal>_all</literal> can be disabled by setting the
<literal>action.destructive_requires_name</literal> flag in the config file to <literal>true</literal>.
This setting can also be changed via the cluster update settings api.</simpara>
<simpara>Closed indices consume a significant amount of disk-space which can cause problems
issues in managed environments. Closing indices can be disabled via the cluster settings
API by setting <literal>cluster.indices.close.enable</literal> to <literal>false</literal>. The default is <literal>true</literal>.</simpara>
</chapter>
<chapter id="indices-put-mapping">
<title>Put Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/put-mapping.asciidoc">Edit me</ulink></title>
<simpara>The PUT mapping API allows you to provide type mappings while creating a new index, add a new type to an existing index, or add new
fields to an existing type:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT twitter <co id="CO117-1"/>
{
  "mappings": {
    "tweet": {
      "properties": {
        "message": {
          "type": "string"
        }
      }
    }
  }
}

PUT twitter/_mapping/user <co id="CO117-2"/>
{
  "properties": {
    "name": {
      "type": "string"
    }
  }
}

PUT twitter/_mapping/tweet <co id="CO117-3"/>
{
  "properties": {
    "user_name": {
      "type": "string"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO117-1">
<para>
<link linkend="indices-create-index">Creates an index</link> called <literal>twitter</literal> with the <literal>message</literal> field in the <literal>tweet</literal> <link linkend="mapping-type">mapping type</link>.
</para>
</callout>
<callout arearefs="CO117-2">
<para>
Uses the PUT mapping API to add a new mapping type called <literal>user</literal>.
</para>
</callout>
<callout arearefs="CO117-3">
<para>
Uses the PUT mapping API to add a new field called <literal>user_name</literal> to the <literal>tweet</literal> mapping type.
</para>
</callout>
</calloutlist>
<simpara>More information on how to define type mappings can be found in the
<link linkend="mapping">mapping</link> section.</simpara>
<bridgehead id="_multi_index" renderas="sect2">Multi-index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/put-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>The PUT mapping API can be applied to multiple indices with a single request.
It has the following format:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /{index}/_mapping/{type}
{ body }</programlisting>
<itemizedlist>
<listitem>
<simpara>
<literal>{index}</literal> accepts <link linkend="multi-index">multiple index names</link> and wildcards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>{type}</literal> is the name of the type to update.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>{body}</literal> contains the mapping changes that should be applied.
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="updating-field-mappings" renderas="sect2">Updating field mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/put-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>In general, the mapping for existing fields cannot be updated.  There are some
exceptions to this rule. For instance:</simpara>
<itemizedlist>
<listitem>
<simpara>
new <xref linkend="properties"/> can be added to <xref linkend="object"/> fields.
</simpara>
</listitem>
<listitem>
<simpara>
new <link linkend="multi-fields">multi-fields</link> can be added to existing fields.
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="doc-values"/> can be disabled, but not enabled.
</simpara>
</listitem>
<listitem>
<simpara>
the <xref linkend="ignore-above"/> parameter can be updated.
</simpara>
</listitem>
</itemizedlist>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index <co id="CO118-1"/>
{
  "mappings": {
    "user": {
      "properties": {
        "name": {
          "properties": {
            "first": {
              "type": "string"
            }
          }
        },
        "user_id": {
          "type": "string",
          "index": "not_analyzed"
        }
      }
    }
  }
}

PUT my_index/_mapping/user
{
  "properties": {
    "name": {
      "properties": {
        "last": { <co id="CO118-2"/>
          "type": "string"
        }
      }
    },
    "user_id": {
      "type": "string",
      "index": "not_analyzed",
      "ignore_above": 100 <co id="CO118-3"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO118-1">
<para>
Create an index with a <literal>first</literal> field under the <literal>name</literal> <xref linkend="object"/> field, and a <literal>user_id</literal> field.
</para>
</callout>
<callout arearefs="CO118-2">
<para>
Add a <literal>last</literal> field under the <literal>name</literal> object field.
</para>
</callout>
<callout arearefs="CO118-3">
<para>
Update the <literal>ignore_above</literal> setting from its default of 0.
</para>
</callout>
</calloutlist>
<simpara>Each <link linkend="mapping-params">mapping parameter</link> specifies whether or not its setting
can be updated on an existing field.</simpara>
<bridgehead id="merging-conflicts" renderas="sect2">Conflicts between fields in different types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/put-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Fields in the same index with the same name in two different types must have
the same mapping, as they are backed by the same field internally.  Trying to
<link linkend="updating-field-mappings">update a mapping parameter</link> for a field which
exists in more than one type will throw an exception, unless you specify the
<literal>update_all_types</literal> parameter, in which case it will update that parameter
across all fields with the same name in the same index.</simpara>
<tip><simpara>The only parameters which are exempt from this rule&#8201;&#8212;&#8201;they can be set to
different values on each field&#8201;&#8212;&#8201;can be found in  <xref linkend="field-conflicts"/>.</simpara></tip>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "type_one": {
      "properties": {
        "text": { <co id="CO119-1"/>
          "type": "string",
          "analyzer": "standard"
        }
      }
    },
    "type_two": {
      "properties": {
        "text": { <co id="CO119-2"/>
          "type": "string",
          "analyzer": "standard"
        }
      }
    }
  }
}

PUT my_index/_mapping/type_one <co id="CO119-3"/>
{
  "properties": {
    "text": {
      "type": "string",
      "analyzer": "standard",
      "search_analyzer": "whitespace"
    }
  }
}

PUT my_index/_mapping/type_one?update_all_types <co id="CO119-4"/>
{
  "properties": {
    "text": {
      "type": "string",
      "analyzer": "standard",
      "search_analyzer": "whitespace"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO119-1 CO119-2">
<para>
Create an index with two types, both of which contain a <literal>text</literal> field which have the same mapping.
</para>
</callout>
<callout arearefs="CO119-3">
<para>
Trying to update the <literal>search_analyzer</literal> just for <literal>type_one</literal> throws an exception like <literal>"Merge failed with failures..."</literal>.
</para>
</callout>
<callout arearefs="CO119-4">
<para>
Adding the <literal>update_all_types</literal> parameter updates the <literal>text</literal> field in <literal>type_one</literal> and <literal>type_two</literal>.
</para>
</callout>
</calloutlist>
</chapter>
<chapter id="indices-get-mapping">
<title>Get Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-mapping.asciidoc">Edit me</ulink></title>
<simpara>The get mapping API allows to retrieve mapping definitions for an index or
index/type.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/_mapping/tweet'</programlisting>
<bridgehead id="_multiple_indices_and_types" renderas="sect2">Multiple Indices and Types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get mapping API can be used to get more than one index or type
mapping with a single call. General usage of the API follows the
following syntax: <literal>host:port/{index}/_mapping/{type}</literal> where both
<literal>{index}</literal> and <literal>{type}</literal> can accept a comma-separated list of names. To
get mappings for all indices you can use <literal>_all</literal> for <literal>{index}</literal>. The
following are some examples:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_mapping/twitter,kimchy'

curl -XGET 'http://localhost:9200/_all/_mapping/tweet,book'</programlisting>
<simpara>If you want to get mappings of all indices and types then the following
two examples are equivalent:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_all/_mapping'

curl -XGET 'http://localhost:9200/_mapping'</programlisting>
</chapter>
<chapter id="indices-get-field-mapping">
<title>Get Field Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-field-mapping.asciidoc">Edit me</ulink></title>
<simpara>The get field mapping API allows you to retrieve mapping definitions for one or more fields.
This is useful when you do not need the complete type mapping returned by
the <xref linkend="indices-get-mapping"/> API.</simpara>
<simpara>The following returns the mapping of the field <literal>text</literal> only:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter/_mapping/tweet/field/text'</programlisting>
<simpara>For which the response is (assuming <literal>text</literal> is a default string field):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "twitter": {
      "tweet": {
         "text": {
            "full_name": "text",
            "mapping": {
               "text": { "type": "string" }
            }
         }
      }
   }
}</programlisting>
<bridgehead id="_multiple_indices_types_and_fields" renderas="sect2">Multiple Indices, Types and Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-field-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get field mapping API can be used to get the mapping of multiple fields from more than one index or type
with a single call. General usage of the API follows the
following syntax: <literal>host:port/{index}/{type}/_mapping/field/{field}</literal> where
<literal>{index}</literal>, <literal>{type}</literal> and <literal>{field}</literal> can stand for comma-separated list of names or wild cards. To
get mappings for all indices you can use <literal>_all</literal> for <literal>{index}</literal>. The
following are some examples:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter,kimchy/_mapping/field/message'

curl -XGET 'http://localhost:9200/_all/_mapping/tweet,book/field/message,user.id'

curl -XGET 'http://localhost:9200/_all/_mapping/tw*/field/*.id'</programlisting>
<bridgehead id="_specifying_fields" renderas="sect2">Specifying fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-field-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get mapping api allows you to specify one or more fields separated with by a comma.
You can also use wildcards. The field names can be any of the following:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
Full names
</simpara>
</entry>
<entry>
<simpara>
the full path, including any parent object name the field is
   part of (ex. <literal>user.id</literal>).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Field names
</simpara>
</entry>
<entry>
<simpara>
the name of the field without the path to it (ex. <literal>id</literal> for <literal>{ "user" : { "id" : 1 } }</literal>).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The above options are specified in the order the <literal>field</literal> parameter is resolved.
The first field found which matches is returned. This is especially important
if index names or field names are used as those can be ambiguous.</simpara>
<simpara>For example, consider the following mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered"> {
     "article": {
         "properties": {
             "id": { "type": "string" },
             "title":  { "type": "string"},
             "abstract": { "type": "string"},
             "author": {
                 "properties": {
                     "id": { "type": "string" },
                     "name": { "type": "string" }
                 }
             }
         }
     }
 }</programlisting>
<simpara>To select the <literal>id</literal> of the <literal>author</literal> field, you can use its full name <literal>author.id</literal>. <literal>name</literal> will return
the field <literal>author.name</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET "http://localhost:9200/publications/_mapping/article/field/author.id,abstract,name"</programlisting>
<simpara>returns:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "publications": {
      "article": {
         "abstract": {
            "full_name": "abstract",
            "mapping": {
               "abstract": { "type": "string" }
            }
         },
         "author.id": {
            "full_name": "author.id",
            "mapping": {
               "id": { "type": "string" }
            }
         },
         "name": {
            "full_name": "author.name",
            "mapping": {
               "name": { "type": "string" }
            }
         }
      }
   }
}</programlisting>
<simpara>Note how the response always use the same fields specified in the request as keys.
The <literal>full_name</literal> in every entry contains the full name of the field whose mapping were returned.
This is useful when the request can refer to to multiple fields.</simpara>
<bridgehead id="_other_options" renderas="sect2">Other options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-field-mapping.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>include_defaults</literal>
</simpara>
</entry>
<entry>
<simpara>
    adding <literal>include_defaults=true</literal> to the query string will cause the response
    to include default values, which are normally suppressed.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
<chapter id="indices-types-exists">
<title>Types Exists<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/types-exists.asciidoc">Edit me</ulink></title>
<simpara>Used to check if a type/types exists in an index/indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i 'http://localhost:9200/twitter/tweet'</programlisting>
<simpara>The HTTP status code indicates if the type exists or not. A <literal>404</literal> means
it does not exist, and <literal>200</literal> means it does.</simpara>
</chapter>
<chapter id="indices-aliases">
<title>Index Aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></title>
<simpara>APIs in elasticsearch accept an index name when working against a
specific index, and several indices when applicable. The index aliases
API allow to alias an index with a name, with all APIs automatically
converting the alias name to the actual index name. An alias can also be
mapped to more than one index, and when specifying it, the alias will
automatically expand to the aliases indices. An alias can also be
associated with a filter that will automatically be applied when
searching, and routing values. An alias cannot have the same name as an index.</simpara>
<simpara>Here is a sample of associating the alias <literal>alias1</literal> with index <literal>test1</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</programlisting>
<simpara>An alias can also be removed, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</programlisting>
<simpara>Renaming an alias is a simple <literal>remove</literal> then <literal>add</literal> operation within the
same API. This operation is atomic, no need to worry about a short
period of time where the alias does not point to an index:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test2", "alias" : "alias1" } }
    ]
}'</programlisting>
<simpara>Associating an alias with more than one index are simply several <literal>add</literal>
actions:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test2", "alias" : "alias1" } }
    ]
}'</programlisting>
<simpara>Multiple indices can be specified for an action with the <literal>indices</literal> array syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "indices" : ["test1", "test2"], "alias" : "alias1" } }
    ]
}'</programlisting>
<simpara>To specify multiple aliases in one action, the corresponding <literal>aliases</literal> array
syntax exists as well.</simpara>
<simpara>For the example above, a glob pattern can also be used to associate an alias to
more than one index that share a common name:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test*", "alias" : "all_test_indices" } }
    ]
}'</programlisting>
<simpara>In this case, the alias is a point-in-time alias that will group all
current indices that match, it will not automatically update as new
indices that match this pattern are added/removed.</simpara>
<simpara>It is an error to index to an alias which points to more than one index.</simpara>
<bridgehead id="filtered" renderas="sect2">Filtered Aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>Aliases with filters provide an easy way to create different "views" of
the same index. The filter can be defined using Query DSL and is applied
to all Search, Count, Delete By Query and More Like This operations with
this alias.</simpara>
<simpara>To create a filtered alias, first we need to ensure that the fields already
exist in the mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'http://localhost:9200/test1' -d '{
  "mappings": {
    "type1": {
      "properties": {
        "user" : {
          "type": "string",
          "index": "not_analyzed"
        }
      }
    }
  }
}</programlisting>
<simpara>Now we can create an alias that uses a filter on field <literal>user</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '{
    "actions" : [
        {
            "add" : {
                 "index" : "test1",
                 "alias" : "alias2",
                 "filter" : { "term" : { "user" : "kimchy" } }
            }
        }
    ]
}'</programlisting>
<bridgehead id="aliases-routing" renderas="sect3">Routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>It is possible to associate routing values with aliases. This feature
can be used together with filtering aliases in order to avoid
unnecessary shard operations.</simpara>
<simpara>The following command creates a new alias <literal>alias1</literal> that points to index
<literal>test</literal>. After <literal>alias1</literal> is created, all operations with this alias are
automatically modified to use value <literal>1</literal> for routing:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias1",
                 "routing" : "1"
            }
        }
    ]
}'</programlisting>
<simpara>It&#8217;s also possible to specify different routing values for searching
and indexing operations:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias2",
                 "search_routing" : "1,2",
                 "index_routing" : "2"
            }
        }
    ]
}'</programlisting>
<simpara>As shown in the example above, search routing may contain several values
separated by comma. Index routing can contain only a single value.</simpara>
<simpara>If an operation that uses routing alias also has a routing parameter, an
intersection of both alias routing and routing specified in the
parameter is used. For example the following command will use "2" as a
routing value:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/alias2/_search?q=user:kimchy&amp;routing=2,3'</programlisting>
<bridgehead id="alias-adding" renderas="sect2">Add a single alias<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>An alias can also be added with the endpoint</simpara>
<simpara><literal>PUT /{index}/_alias/{name}</literal></simpara>
<simpara>where</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>index</literal>
</simpara>
</entry>
<entry>
<simpara>
The index the alias refers to. Can be any of <literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>name</literal>
</simpara>
</entry>
<entry>
<simpara>
The name of the alias. This is a required option.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>routing</literal>
</simpara>
</entry>
<entry>
<simpara>
An optional routing that can be associated with an alias.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>filter</literal>
</simpara>
</entry>
<entry>
<simpara>
An optional filter that can be associated with an alias.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>You can also use the plural <literal>_aliases</literal>.</simpara>
<bridgehead id="_examples" renderas="sect3">Examples:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Adding time based alias
</term>
<listitem>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/logs_201305/_alias/2013'</programlisting>
</listitem>
</varlistentry>
<varlistentry>
<term>
Adding a user alias
</term>
<listitem>
<simpara>First create the index and add a mapping for the <literal>user_id</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/users' -d '{
    "mappings" : {
        "user" : {
            "properties" : {
                "user_id" : {"type" : "integer"}
            }
        }
    }
}'</programlisting>
<simpara>Then add the alias for a specific user:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/users/_alias/user_12' -d '{
    "routing" : "12",
    "filter" : {
        "term" : {
            "user_id" : 12
        }
    }
}'</programlisting>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="alias-index-creation" renderas="sect2">Aliases during index creation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>Aliases can also be specified during <link linkend="create-index-aliases">index creation</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/logs_20142801 -d '{
    "mappings" : {
        "type" : {
            "properties" : {
                "year" : {"type" : "integer"}
            }
        }
    },
    "aliases" : {
        "current_day" : {},
        "2014" : {
            "filter" : {
                "term" : {"year" : 2014 }
            }
        }
    }
}'</programlisting>
<bridgehead id="deleting" renderas="sect2">Delete aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>The rest endpoint is: <literal>/{index}/_alias/{name}</literal></simpara>
<simpara>where</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>index</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>name</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Alternatively you can use the plural <literal>_aliases</literal>. Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE 'localhost:9200/users/_alias/user_12'</programlisting>
<bridgehead id="alias-retrieving" renderas="sect2">Retrieving existing aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get index alias api allows to filter by
alias name and index name. This api redirects to the master and fetches
the requested index aliases, if available. This api only serialises the
found index aliases.</simpara>
<simpara>Possible options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>index</literal>
</simpara>
</entry>
<entry>
<simpara>
    The index name to get aliases for. Partially names are
    supported via wildcards, also multiple index names can be specified
    separated with a comma. Also the alias name for an index can be used.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>alias</literal>
</simpara>
</entry>
<entry>
<simpara>
    The name of alias to return in the response. Like the index
    option, this option supports wildcards and the option the specify
    multiple alias names separated by a comma.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ignore_unavailable</literal>
</simpara>
</entry>
<entry>
<simpara>
    What to do if an specified index name doesn&#8217;t
    exist. If set to <literal>true</literal> then those indices are ignored.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The rest endpoint is: <literal>/{index}/_alias/{alias}</literal>.</simpara>
<bridgehead id="_examples_2" renderas="sect3">Examples:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/aliases.asciidoc">Edit me</ulink></bridgehead>
<simpara>All aliases for the index users:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/users/_alias/*'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered"> {
  "users" : {
    "aliases" : {
      "user_13" : {
        "filter" : {
          "term" : {
            "user_id" : 13
          }
        },
        "index_routing" : "13",
        "search_routing" : "13"
      },
      "user_14" : {
        "filter" : {
          "term" : {
            "user_id" : 14
          }
        },
        "index_routing" : "14",
        "search_routing" : "14"
      },
      "user_12" : {
        "filter" : {
          "term" : {
            "user_id" : 12
          }
        },
        "index_routing" : "12",
        "search_routing" : "12"
      }
    }
  }
}</programlisting>
<simpara>All aliases with the name 2013 in any index:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_alias/2013'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "logs_201304" : {
    "aliases" : {
      "2013" : { }
    }
  },
  "logs_201305" : {
    "aliases" : {
      "2013" : { }
    }
  }
}</programlisting>
<simpara>All aliases that start with 2013_01 in any index:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_alias/2013_01*'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "logs_20130101" : {
    "aliases" : {
      "2013_01" : { }
    }
  }
}</programlisting>
<simpara>There is also a HEAD variant of the get indices aliases api to check if
index aliases exist. The indices aliases exists api supports the same
option as the get indices aliases api. Examples:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i 'localhost:9200/_alias/2013'
curl -XHEAD -i 'localhost:9200/_alias/2013_01*'
curl -XHEAD -i 'localhost:9200/users/_alias/*'</programlisting>
</chapter>
<chapter id="indices-update-settings">
<title>Update Indices Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/update-settings.asciidoc">Edit me</ulink></title>
<simpara>Change specific index level settings in real time.</simpara>
<simpara>The REST endpoint is <literal>/_settings</literal> (to update all indices) or
<literal>{index}/_settings</literal> to update one (or more) indices settings. The body
of the request includes the updated settings, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "number_of_replicas" : 4
    }
}</programlisting>
<simpara>The above will change the number of replicas to 4 from the current
number of replicas. Here is a curl example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/my_index/_settings' -d '
{
    "index" : {
        "number_of_replicas" : 4
    }
}'</programlisting>
<simpara>The list of per-index settings which can be updated dynamically on live
indices can be found in <xref linkend="index-modules"/>.</simpara>
<bridgehead id="bulk" renderas="sect2">Bulk Indexing Usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/update-settings.asciidoc">Edit me</ulink></bridgehead>
<simpara>For example, the update settings API can be used to dynamically change
the index from being more performant for bulk indexing, and then move it
to more real time indexing state. Before the bulk indexing is started,
use:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "-1"
    } }'</programlisting>
<simpara>(Another optimization option is to start the index without any replicas,
and only later adding them, but that really depends on the use case).</simpara>
<simpara>Then, once bulk indexing is done, the settings can be updated (back to
the defaults for example):</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "1s"
    } }'</programlisting>
<simpara>And, a force merge should be called:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'http://localhost:9200/test/_forcemerge?max_num_segments=5'</programlisting>
<bridgehead id="update-settings-analysis" renderas="sect2">Updating Index Analysis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/update-settings.asciidoc">Edit me</ulink></bridgehead>
<simpara>It is also possible to define new <link linkend="analysis">analyzers</link> for the index.
But it is required to <link linkend="indices-open-close">close</link> the index
first and <link linkend="indices-open-close">open</link> it after the changes are made.</simpara>
<simpara>For example if <literal>content</literal> analyzer hasn&#8217;t been defined on <literal>myindex</literal> yet
you can use the following commands to add it:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/myindex/_close'

curl -XPUT 'localhost:9200/myindex/_settings' -d '{
  "analysis" : {
    "analyzer":{
      "content":{
        "type":"custom",
        "tokenizer":"whitespace"
      }
    }
  }
}'

curl -XPOST 'localhost:9200/myindex/_open'</programlisting>
</chapter>
<chapter id="indices-get-settings">
<title>Get Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-settings.asciidoc">Edit me</ulink></title>
<simpara>The get settings API allows to retrieve settings of index/indices:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/twitter/_settings'</programlisting>
<bridgehead id="_multiple_indices_and_types_2" renderas="sect2">Multiple Indices and Types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-settings.asciidoc">Edit me</ulink></bridgehead>
<simpara>The get settings API can be used to get settings for more than one index
with a single call. General usage of the API follows the
following syntax: <literal>host:port/{index}/_settings</literal> where
<literal>{index}</literal> can stand for comma-separated list of index names and aliases. To
get settings for all indices you can use <literal>_all</literal> for <literal>{index}</literal>.
Wildcard expressions are also supported. The following are some examples:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/twitter,kimchy/_settings'

curl -XGET 'http://localhost:9200/_all/_settings'

curl -XGET 'http://localhost:9200/2013-*/_settings'</programlisting>
<bridgehead id="_filtering_settings_by_name" renderas="sect2">Filtering settings by name<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/get-settings.asciidoc">Edit me</ulink></bridgehead>
<simpara>The settings that are returned can be filtered with wildcard matching
as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/2013-*/_settings/name=index.number_*'</programlisting>
</chapter>
<chapter id="indices-analyze">
<title>Analyze<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/analyze.asciidoc">Edit me</ulink></title>
<simpara>Performs the analysis process on a text and return the tokens breakdown
of the text.</simpara>
<simpara>Can be used without specifying an index against one of the many built in
analyzers:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_analyze' -d '
{
  "analyzer" : "standard",
  "text" : "this is a test"
}'</programlisting>
<simpara>If text parameter is provided as array of strings, it is analyzed as a multi-valued field.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_analyze' -d '
{
  "analyzer" : "standard",
  "text" : ["this is a test", "the second text"]
}'</programlisting>
<simpara>Or by building a custom transient analyzer out of tokenizers,
token filters and char filters. Token filters can use the shorter <emphasis>filter</emphasis>
parameter name:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_analyze' -d '
{
  "tokenizer" : "keyword",
  "filter" : ["lowercase"],
  "text" : "this is a test"
}'

curl -XGET 'localhost:9200/_analyze' -d '
{
  "tokenizer" : "keyword",
  "token_filter" : ["lowercase"],
  "char_filter" : ["html_strip"],
  "text" : "this is a &lt;b&gt;test&lt;/b&gt;"
}'</programlisting>
<warning revisionflag="deleted" revision="2.4.0"><title>Deprecated in 2.4.0.</title><simpara> <literal>filters</literal>/<literal>token_filters</literal>/<literal>char_filters</literal> will be removed in 5.0.0. Use <literal>filter</literal>/<literal>token_filter</literal>/<literal>char_filter</literal>.</simpara></warning>
<simpara>It can also run against a specific index:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/test/_analyze' -d '
{
  "text" : "this is a test"
}'</programlisting>
<simpara>The above will run an analysis on the "this is a test" text, using the
default index analyzer associated with the <literal>test</literal> index. An <literal>analyzer</literal>
can also be provided to use a different analyzer:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/test/_analyze' -d '
{
  "analyzer" : "whitespace",
  "text : "this is a test"
}'</programlisting>
<simpara>Also, the analyzer can be derived based on a field mapping, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/test/_analyze' -d '
{
  "field" : "obj1.field1",
  "text" : "this is a test"
}'</programlisting>
<simpara>Will cause the analysis to happen based on the analyzer configured in the
mapping for <literal>obj1.field1</literal> (and if not, the default index analyzer).</simpara>
<simpara>All parameters can also supplied as request parameters. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;filter=lowercase&amp;text=this+is+a+test'</programlisting>
<simpara>For backwards compatibility, we also accept the text parameter as the body of the request,
provided it doesn&#8217;t start with <literal>{</literal> :</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;token_filter=lowercase&amp;char_filter=html_strip' -d 'this is a &lt;b&gt;test&lt;/b&gt;'</programlisting>
<section id="_explain_analyze">
<title>Explain Analyze<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/analyze.asciidoc">Edit me</ulink></title>
<simpara>If you want to get more advanced details, set <literal>explain</literal> to <literal>true</literal> (defaults to <literal>false</literal>). It will output all token attributes for each token.
You can filter token attributes you want to output by setting <literal>attributes</literal> option.</simpara>
<warning role="experimental"><simpara>The format of the additional detail information is experimental and can change at any time.</simpara></warning>
<programlisting language="js" linenumbering="unnumbered">GET test/_analyze
{
  "tokenizer" : "standard",
  "token_filter" : ["snowball"],
  "text" : "detailed output",
  "explain" : true,
  "attributes" : ["keyword"] <co id="CO120-1"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO120-1">
<para>
Set "keyword" to output "keyword" attribute only
</para>
</callout>
</calloutlist>
<simpara>The request returns the following result:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "detail" : {
    "custom_analyzer" : true,
    "charfilters" : [ ],
    "tokenizer" : {
      "name" : "standard",
      "tokens" : [ {
        "token" : "detailed",
        "start_offset" : 0,
        "end_offset" : 8,
        "type" : "&lt;ALPHANUM&gt;",
        "position" : 0
      }, {
        "token" : "output",
        "start_offset" : 9,
        "end_offset" : 15,
        "type" : "&lt;ALPHANUM&gt;",
        "position" : 1
      } ]
    },
    "tokenfilters" : [ {
      "name" : "snowball",
      "tokens" : [ {
        "token" : "detail",
        "start_offset" : 0,
        "end_offset" : 8,
        "type" : "&lt;ALPHANUM&gt;",
        "position" : 0,
        "keyword" : false <co id="CO121-1"/>
      }, {
        "token" : "output",
        "start_offset" : 9,
        "end_offset" : 15,
        "type" : "&lt;ALPHANUM&gt;",
        "position" : 1,
        "keyword" : false <co id="CO121-2"/>
      } ]
    } ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO121-1 CO121-2">
<para>
Output only "keyword" attribute, since specify "attributes" in the request.
</para>
</callout>
</calloutlist>
</section>
</chapter>
<chapter id="indices-templates">
<title>Index Templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/templates.asciidoc">Edit me</ulink></title>
<simpara>Index templates allow you to define templates that will automatically be
applied when new indices are created. The templates include both settings and
mappings, and a simple pattern template that controls whether the template
should be applied to the new index.</simpara>
<note><simpara>Templates are only applied at index creation time.  Changing a template
will have no impact on existing indices.</simpara></note>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_template/template_1
{
  "template": "te*",
  "settings": {
    "number_of_shards": 1
  },
  "mappings": {
    "type1": {
      "_source": {
        "enabled": false
      },
      "properties": {
        "host_name": {
          "type": "string",
          "index": "not_analyzed"
        },
        "created_at": {
          "type": "date",
          "format": "EEE MMM dd HH:mm:ss Z YYYY"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Defines a template named template_1, with a template pattern of <literal>te*</literal>.
The settings and mappings will be applied to any index name that matches
the <literal>te*</literal> template.</simpara>
<simpara>It is also possible to include aliases in an index template as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "settings" : {
        "number_of_shards" : 1
    },
    "aliases" : {
        "alias1" : {},
        "alias2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        },
        "{index}-alias" : {} <co id="CO122-1"/>
    }
}
'</programlisting>
<calloutlist>
<callout arearefs="CO122-1">
<para>
the <literal>{index}</literal> placeholder within the alias name will be replaced with the
actual index name that the template gets applied to during index creation.
</para>
</callout>
</calloutlist>
<bridgehead id="delete" renderas="sect2">Deleting a Template<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/templates.asciidoc">Edit me</ulink></bridgehead>
<simpara>Index templates are identified by a name (in the above case
<literal>template_1</literal>) and can be deleted as well:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_template/template_1</programlisting>
<bridgehead id="getting" renderas="sect2">Getting templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/templates.asciidoc">Edit me</ulink></bridgehead>
<simpara>Index templates are identified by a name (in the above case
<literal>template_1</literal>) and can be retrieved using the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_template/template_1</programlisting>
<simpara>You can also match several templates by using wildcards like:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_template/temp*
curl -XGET localhost:9200/_template/template_1,template_2</programlisting>
<simpara>To get list of all index templates you can run:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_template/</programlisting>
<bridgehead id="indices-templates-exists" renderas="sect2">Templates exists<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/templates.asciidoc">Edit me</ulink></bridgehead>
<simpara>Used to check if the template exists or not. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XHEAD -i localhost:9200/_template/template_1</programlisting>
<simpara>The HTTP status code indicates if the template with the given name
exists or not. A status code <literal>200</literal> means it exists, a <literal>404</literal> it does not.</simpara>
<bridgehead id="multiple-templates" renderas="sect2">Multiple Template Matching<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/templates.asciidoc">Edit me</ulink></bridgehead>
<simpara>Multiple index templates can potentially match an index, in this case,
both the settings and mappings are merged into the final configuration
of the index. The order of the merging can be controlled using the
<literal>order</literal> parameter, with lower order being applied first, and higher
orders overriding them. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "*",
    "order" : 0,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false }
        }
    }
}
'

curl -XPUT localhost:9200/_template/template_2 -d '
{
    "template" : "te*",
    "order" : 1,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : true }
        }
    }
}
'</programlisting>
<simpara>The above will disable storing the <literal>_source</literal> on all <literal>type1</literal> types, but
for indices of that start with <literal>te*</literal>, source will still be enabled.
Note, for mappings, the merging is "deep", meaning that specific
object/property based mappings can easily be added/overridden on higher
order templates, with lower order templates providing the basis.</simpara>
</chapter>
<chapter id="indices-warmers">
<title>Warmers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/warmers.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.3.0"><title>Deprecated in 2.3.0.</title><simpara>Thanks to disk-based norms and doc values, warmers don&#8217;t have use-cases anymore.</simpara></warning>
<simpara>Index warming allows to run registered search requests to warm up the index
before it is available for search. With the near real time aspect of search,
cold data (segments) will be warmed up before they become available for search.
This includes things such as the filter cache, filesystem cache, and loading
field data for fields.</simpara>
<simpara>Warmup searches typically include requests that require heavy loading of
data, such as aggregations or sorting on specific fields. The warmup APIs
allows to register warmup (search) under specific names, remove them,
and get them.</simpara>
<simpara>Index warmup can be disabled by setting <literal>index.warmer.enabled</literal> to
<literal>false</literal>. It is supported as a realtime setting using update settings
API. This can be handy when doing initial bulk indexing: disable pre
registered warmers to make indexing faster and less expensive and then
enable it.</simpara>
<bridgehead id="creation" renderas="sect2">Index Creation / Templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/warmers.asciidoc">Edit me</ulink></bridgehead>
<simpara>Warmers can be registered when an index gets created, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "aggs" : {
                    ...
                }
            }
        }
    }
}'</programlisting>
<simpara>Or, in an index template:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "aggs" : {
                    ...
                }
            }
        }
    }
}'</programlisting>
<simpara>On the same level as <literal>types</literal> and <literal>source</literal>, the <literal>request_cache</literal> flag is supported
to enable request caching for the warmed search request. If not specified, it will
use the index level configuration of query caching.</simpara>
<bridgehead id="warmer-adding" renderas="sect2">Put Warmer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/warmers.asciidoc">Edit me</ulink></bridgehead>
<simpara>Allows to put a warmup search request on a specific index (or indices),
with the body composing of a regular search request. Types can be
provided as part of the URI if the search request is designed to be run
only against the specific types.</simpara>
<simpara>Here is an example that registers a warmup called <literal>warmer_1</literal> against
index <literal>test</literal> (can be alias or several indices), for a search request
that runs against all types:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "aggs" : {
        "aggs_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</programlisting>
<simpara>And an example that registers a warmup against specific types:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/type1/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "aggs" : {
        "aggs_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</programlisting>
<simpara>All options:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _warmer/{warmer_name}

PUT /{index}/_warmer/{warmer_name}

PUT /{index}/{type}/_warmer/{warmer_name}</programlisting>
<simpara>where</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>{index}</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>{type}</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Instead of <literal>_warmer</literal> you can also use the plural <literal>_warmers</literal>.</simpara>
<simpara>The <literal>request_cache</literal> parameter can be used to enable request caching for
the search request. If not specified, it will use the index level configuration
of query caching.</simpara>
<bridgehead id="removing" renderas="sect2">Delete Warmers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/warmers.asciidoc">Edit me</ulink></bridgehead>
<simpara>Warmers can be deleted using the following endpoint:</simpara>
<programlisting language="js" linenumbering="unnumbered">[DELETE] /{index}/_warmer/{name}</programlisting>
<simpara>where</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>{index}</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>{name}</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>* | _all | glob pattern | name1, name2, …</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Instead of <literal>_warmer</literal> you can also use the plural <literal>_warmers</literal>.</simpara>
<bridgehead id="warmer-retrieving" renderas="sect2">GETting Warmer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/warmers.asciidoc">Edit me</ulink></bridgehead>
<simpara>Getting a warmer for specific index (or alias, or several indices) based
on its name. The provided name can be a simple wildcard expression or
omitted to get all warmers.</simpara>
<simpara>Some examples:</simpara>
<programlisting language="js" linenumbering="unnumbered"># get warmer named warmer_1 on test index
curl -XGET localhost:9200/test/_warmer/warmer_1

# get all warmers that start with warm on test index
curl -XGET localhost:9200/test/_warmer/warm*

# get all warmers for test index
curl -XGET localhost:9200/test/_warmer/</programlisting>
</chapter>
<chapter id="indices-shadow-replicas">
<title>Shadow replica indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/shadow-replicas.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>This functionality is experimental and may be changed or removed completely in a future release.</simpara></warning>
<simpara>If you would like to use a shared filesystem, you can use the shadow replicas
settings to choose where on disk the data for an index should be kept, as well
as how Elasticsearch should replay operations on all the replica shards of an
index.</simpara>
<simpara>In order to fully utilize the <literal>index.data_path</literal> and <literal>index.shadow_replicas</literal>
settings, you need to allow Elasticsearch to use the same data directory for
multiple instances by setting <literal>node.add_id_to_custom_path</literal> to false in
elasticsearch.yml:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.add_id_to_custom_path: false</programlisting>
<simpara>You will also need to indicate to the security manager where the custom indices
will be, so that the correct permissions can be applied. You can do this by
setting the <literal>path.shared_data</literal> setting in elasticsearch.yml:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.shared_data: /opt/data</programlisting>
<simpara>This means that Elasticsearch can read and write to files in any subdirectory of
the <literal>path.shared_data</literal> setting.</simpara>
<simpara>You can then create an index with a custom data path, where each node will use
this path for the data:</simpara>
<warning>
<simpara>Because shadow replicas do not index the document on replica shards, it&#8217;s
possible for the replica&#8217;s known mapping to be behind the index&#8217;s known mapping
if the latest cluster state has not yet been processed on the node containing
the replica. Because of this, it is highly recommended to use pre-defined
mappings when using shadow replicas.</simpara>
</warning>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT 'localhost:9200/my_index' -d '
{
    "index" : {
        "number_of_shards" : 1,
        "number_of_replicas" : 4,
        "data_path": "/opt/data/my_index",
        "shadow_replicas": true
    }
}'</programlisting>
<warning>
<simpara>In the above example, the "/opt/data/my_index" path is a shared filesystem that
must be available on every node in the Elasticsearch cluster. You must also
ensure that the Elasticsearch process has the correct permissions to read from
and write to the directory used in the <literal>index.data_path</literal> setting.</simpara>
</warning>
<simpara>The <literal>data_path</literal> does not have to contain the index name, in this case,
"my_index" was used but it could easily also have been "/opt/data/"</simpara>
<simpara>An index that has been created with the <literal>index.shadow_replicas</literal> setting set to
"true" will not replicate document operations to any of the replica shards,
instead, it will only continually refresh. Once segments are available on the
filesystem where the shadow replica resides (after an Elasticsearch "flush"), a
regular refresh (governed by the <literal>index.refresh_interval</literal>) can be used to make
the new data searchable.</simpara>
<note><simpara>Since documents are only indexed on the primary shard, realtime GET
requests could fail to return a document if executed on the replica shard,
therefore, GET API requests automatically have the <literal>?preference=_primary</literal> flag
set if there is no preference flag already set.</simpara></note>
<simpara>In order to ensure the data is being synchronized in a fast enough manner, you
may need to tune the flush threshold for the index to a desired number. A flush
is needed to fsync segment files to disk, so they will be visible to all other
replica nodes. Users should test what flush threshold levels they are
comfortable with, as increased flushing can impact indexing performance.</simpara>
<simpara>The Elasticsearch cluster will still detect the loss of a primary shard, and
transform the replica into a primary in this situation. This transformation will
take slightly longer, since no <literal>IndexWriter</literal> is maintained for each shadow
replica.</simpara>
<simpara>Below is the list of settings that can be changed using the update
settings API:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.data_path</literal> (string)
</term>
<listitem>
<simpara>
    Path to use for the index&#8217;s data. Note that by default Elasticsearch will
    append the node ordinal by default to the path to ensure multiple instances
    of Elasticsearch on the same machine do not share a data directory.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.shadow_replicas</literal>
</term>
<listitem>
<simpara>
    Boolean value indicating this index should use shadow replicas. Defaults to
    <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.shared_filesystem</literal>
</term>
<listitem>
<simpara>
    Boolean value indicating this index uses a shared filesystem. Defaults to
    the <literal>true</literal> if <literal>index.shadow_replicas</literal> is set to true, <literal>false</literal> otherwise.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.shared_filesystem.recover_on_any_node</literal>
</term>
<listitem>
<simpara>
    Boolean value indicating whether the primary shards for the index should be
    allowed to recover on any node in the cluster, regardless of the number of
    replicas or whether the node has previously had the shard allocated to it
    before. Defaults to <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="_node_level_settings_related_to_shadow_replicas">
<title>Node level settings related to shadow replicas<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/shadow-replicas.asciidoc">Edit me</ulink></title>
<simpara>These are non-dynamic settings that need to be configured in <literal>elasticsearch.yml</literal></simpara>
<variablelist>
<varlistentry>
<term>
<literal>node.add_id_to_custom_path</literal>
</term>
<listitem>
<simpara>
    Boolean setting indicating whether Elasticsearch should append the node&#8217;s
    ordinal to the custom data path. For example, if this is enabled and a path
    of "/tmp/foo" is used, the first locally-running node will use "/tmp/foo/0",
    the second will use "/tmp/foo/1", the third "/tmp/foo/2", etc. Defaults to
    <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</chapter>
<chapter id="indices-stats">
<title>Indices Stats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/stats.asciidoc">Edit me</ulink></title>
<simpara>Indices level stats provide statistics on different operations happening
on an index. The API provides statistics on the index level scope
(though most stats can also be retrieved using node level scope).</simpara>
<simpara>The following returns high level aggregation and index level stats for
all indices:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl localhost:9200/_stats</programlisting>
<simpara>Specific index stats can be retrieved using:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl localhost:9200/index1,index2/_stats</programlisting>
<simpara>By default, all stats are returned, returning only specific stats can be
specified as well in the URI. Those stats can be any of:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>docs</literal>
</simpara>
</entry>
<entry>
<simpara>
The number of docs / deleted docs (docs not yet merged out).
                                Note, affected by refreshing the index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>store</literal>
</simpara>
</entry>
<entry>
<simpara>
The size of the index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>indexing</literal>
</simpara>
</entry>
<entry>
<simpara>
Indexing statistics, can be combined with a comma
                                separated list of <literal>types</literal> to provide document type level stats.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>get</literal>
</simpara>
</entry>
<entry>
<simpara>
Get statistics, including missing stats.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>search</literal>
</simpara>
</entry>
<entry>
<simpara>
Search statistics. You can include statistics for custom groups by adding
                an extra <literal>groups</literal> parameter (search operations can be associated with one or more
                groups). The <literal>groups</literal> parameter accepts a comma separated list of group names.
                Use <literal>_all</literal> to return statistics for all groups.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>completion</literal>
</simpara>
</entry>
<entry>
<simpara>
Completion suggest statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fielddata</literal>
</simpara>
</entry>
<entry>
<simpara>
Fielddata statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flush</literal>
</simpara>
</entry>
<entry>
<simpara>
Flush statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>merge</literal>
</simpara>
</entry>
<entry>
<simpara>
Merge statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>request_cache</literal>
</simpara>
</entry>
<entry>
<simpara>
<link linkend="shard-request-cache">Shard request cache</link> statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>refresh</literal>
</simpara>
</entry>
<entry>
<simpara>
Refresh statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>suggest</literal>
</simpara>
</entry>
<entry>
<simpara>
Suggest statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>warmer</literal>
</simpara>
</entry>
<entry>
<simpara>
Warmer statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>translog</literal>
</simpara>
</entry>
<entry>
<simpara>
Translog statistics.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Some statistics allow per field granularity which accepts a list
comma-separated list of included fields. By default all fields are included:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>fields</literal>
</simpara>
</entry>
<entry>
<simpara>
    List of fields to be included in the statistics. This is used as the
    default list unless a more specific field list is provided (see below).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>completion_fields</literal>
</simpara>
</entry>
<entry>
<simpara>
    List of fields to be included in the Completion Suggest statistics.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fielddata_fields</literal>
</simpara>
</entry>
<entry>
<simpara>
    List of fields to be included in the Fielddata statistics.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Here are some samples:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Get back stats for merge and refresh only for all indices
curl 'localhost:9200/_stats/merge,refresh'
# Get back stats for type1 and type2 documents for the my_index index
curl 'localhost:9200/my_index/_stats/indexing?types=type1,type2
# Get back just search stats for group1 and group2
curl 'localhost:9200/_stats/search?groups=group1,group2</programlisting>
<simpara>The stats returned are aggregated on the index level, with
<literal>primaries</literal> and <literal>total</literal> aggregations, where <literal>primaries</literal> are the values for only the
primary shards, and <literal>total</literal> are the cumulated values for both primary and replica shards.</simpara>
<simpara>In order to get back shard level stats, set the <literal>level</literal> parameter to <literal>shards</literal>.</simpara>
<simpara>Note, as shards move around the cluster, their stats will be cleared as
they are created on other nodes. On the other hand, even though a shard
"left" a node, that node will still retain the stats that shard
contributed to.</simpara>
</chapter>
<chapter id="indices-segments">
<title>Indices Segments<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/segments.asciidoc">Edit me</ulink></title>
<simpara>Provide low level segments information that a Lucene index (shard level)
is built with. Allows to be used to provide more information on the
state of a shard and an index, possibly optimization information, data
"wasted" on deletes, and so on.</simpara>
<simpara>Endpoints include segments for a specific index, several indices, or
all:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/test/_segments'
curl -XGET 'http://localhost:9200/test1,test2/_segments'
curl -XGET 'http://localhost:9200/_segments'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
        "_3": {
            "generation": 3,
            "num_docs": 1121,
            "deleted_docs": 53,
            "size_in_bytes": 228288,
            "memory_in_bytes": 3211,
            "committed": true,
            "search": true,
            "version": "4.6",
            "compound": true
        }
    ...
}</programlisting>
<variablelist>
<varlistentry>
<term>
_0
</term>
<listitem>
<simpara>
The key of the JSON document is the name of the segment. This name
             is used to generate file names: all files starting with this
             segment name in the directory of the shard belong to this segment.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
generation
</term>
<listitem>
<simpara>
A generation number that is basically incremented when needing to
             write a new segment. The segment name is derived from this
             generation number.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
num_docs
</term>
<listitem>
<simpara>
The number of non-deleted documents that are stored in this segment.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
deleted_docs
</term>
<listitem>
<simpara>
The number of deleted documents that are stored in this segment.
             It is perfectly fine if this number is greater than 0, space is
             going to be reclaimed when this segment gets merged.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
size_in_bytes
</term>
<listitem>
<simpara>
The amount of disk space that this segment uses, in bytes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
memory_in_bytes
</term>
<listitem>
<simpara>
Segments need to store some data into memory in order to be
             searchable efficiently. This number returns the number of bytes
             that are used for that purpose. A value of -1 indicates that
             Elasticsearch was not able to compute this number.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
committed
</term>
<listitem>
<simpara>
Whether the segment has been sync&#8217;ed on disk. Segments that are
             committed would survive a hard reboot. No need to worry in case
             of false, the data from uncommitted segments is also stored in
             the transaction log so that Elasticsearch is able to replay
             changes on the next start.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
search
</term>
<listitem>
<simpara>
Whether the segment is searchable. A value of false would most
             likely mean that the segment has been written to disk but no
             refresh occurred since then to make it searchable.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
version
</term>
<listitem>
<simpara>
The version of Lucene that has been used to write this segment.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
compound
</term>
<listitem>
<simpara>
Whether the segment is stored in a compound file. When true, this
             means that Lucene merged all files from the segment in a single
             one in order to save file descriptors.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_verbose_mode" renderas="sect2">Verbose mode<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/segments.asciidoc">Edit me</ulink></bridgehead>
<simpara>To add additional information that can be used for debugging, use the <literal>verbose</literal> flag.</simpara>
<warning role="experimental"><simpara>The format of the additional verbose information is experimental and can change at any time.</simpara></warning>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/test/_segments?verbose=true'</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
        "_3": {
            ...
            "ram_tree": [
                {
                    "description": "postings [PerFieldPostings(format=1)]",
                    "size_in_bytes": 2696,
                    "children": [
                        {
                            "description": "format 'Lucene50_0' ...",
                            "size_in_bytes": 2608,
                            "children" :[ ... ]
                        },
                        ...
                    ]
                },
                ...
                ]

        }
    ...
}</programlisting>
</chapter>
<chapter id="indices-recovery">
<title>Indices Recovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/recovery.asciidoc">Edit me</ulink></title>
<simpara>The indices recovery API provides insight into on-going index shard recoveries.
Recovery status may be reported for specific indices, or cluster-wide.</simpara>
<simpara>For example, the following command would show recovery information for the indices "index1" and "index2".</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET http://localhost:9200/index1,index2/_recovery</programlisting>
<simpara>To see cluster-wide recovery status simply leave out the index names.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET http://localhost:9200/_recovery?pretty&amp;human</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "SNAPSHOT",
      "stage" : "INDEX",
      "primary" : true,
      "start_time" : "2014-02-24T12:15:59.716",
      "start_time_in_millis": 1393244159716,
      "total_time" : "2.9m"
      "total_time_in_millis" : 175576,
      "source" : {
        "repository" : "my_repository",
        "snapshot" : "my_snapshot",
        "index" : "index1"
      },
      "target" : {
        "id" : "ryqJ5lO5S4-lSFbGntkEkg",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "size" : {
          "total" : "75.4mb"
          "total_in_bytes" : 79063092,
          "reused" : "0b",
          "reused_in_bytes" : 0,
          "recovered" : "65.7mb",
          "recovered_in_bytes" : 68891939,
          "percent" : "87.1%"
        },
        "files" : {
          "total" : 73,
          "reused" : 0,
          "recovered" : 69,
          "percent" : "94.5%"
        },
        "total_time" : "0s",
        "total_time_in_millis" : 0
      },
      "translog" : {
        "recovered" : 0,
        "total" : 0,
        "percent" : "100.0%",
        "total_on_start" : 0,
        "total_time" : "0s",
        "total_time_in_millis" : 0
      },
      "start" : {
        "check_index_time" : "0s",
        "check_index_time_in_millis" : 0,
        "total_time" : "0s",
        "total_time_in_millis" : 0
      }
    } ]
  }
}</programlisting>
<simpara>The above response shows a single index recovering a single shard. In this case, the source of the recovery is a snapshot repository
and the target of the recovery is the node with name "my_es_node".</simpara>
<simpara>Additionally, the output shows the number and percent of files recovered, as well as the number and percent of bytes recovered.</simpara>
<simpara>In some cases a higher level of detail may be preferable. Setting "detailed=true" will present a list of physical files in recovery.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET http://localhost:9200/_recovery?pretty&amp;human&amp;detailed=true</programlisting>
<simpara>Response:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "STORE",
      "stage" : "DONE",
      "primary" : true,
      "start_time" : "2014-02-24T12:38:06.349",
      "start_time_in_millis" : "1393245486349",
      "stop_time" : "2014-02-24T12:38:08.464",
      "stop_time_in_millis" : "1393245488464",
      "total_time" : "2.1s",
      "total_time_in_millis" : 2115,
      "source" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "target" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "size" : {
          "total" : "24.7mb",
          "total_in_bytes" : 26001617,
          "reused" : "24.7mb",
          "reused_in_bytes" : 26001617,
          "recovered" : "0b",
          "recovered_in_bytes" : 0,
          "percent" : "100.0%"
        },
        "files" : {
          "total" : 26,
          "reused" : 26,
          "recovered" : 0,
          "percent" : "100.0%",
          "details" : [ {
            "name" : "segments.gen",
            "length" : 20,
            "recovered" : 20
          }, {
            "name" : "_0.cfs",
            "length" : 135306,
            "recovered" : 135306
          }, {
            "name" : "segments_2",
            "length" : 251,
            "recovered" : 251
          },
           ...
          ]
        },
        "total_time" : "2ms",
        "total_time_in_millis" : 2
      },
      "translog" : {
        "recovered" : 71,
        "total_time" : "2.0s",
        "total_time_in_millis" : 2025
      },
      "start" : {
        "check_index_time" : 0,
        "total_time" : "88ms",
        "total_time_in_millis" : 88
      }
    } ]
  }
}</programlisting>
<simpara>This response shows a detailed listing (truncated for brevity) of the actual files recovered and their sizes.</simpara>
<simpara>Also shown are the timings in milliseconds of the various stages of recovery: index retrieval, translog replay, and index start time.</simpara>
<simpara>Note that the above listing indicates that the recovery is in stage "done". All recoveries, whether on-going or complete, are kept in
cluster state and may be reported on at any time. Setting "active_only=true" will cause only on-going recoveries to be reported.</simpara>
<simpara>Here is a complete list of options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>detailed</literal>
</simpara>
</entry>
<entry>
<simpara>
Display a detailed view. This is primarily useful for viewing the recovery of physical index files. Default: false.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>active_only</literal>
</simpara>
</entry>
<entry>
<simpara>
Display only those recoveries that are currently on-going. Default: false.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Description of output fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>id</literal>
</simpara>
</entry>
<entry>
<simpara>
Shard ID
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>type</literal>
</simpara>
</entry>
<entry>
<simpara>
Recovery type:
</simpara>
<itemizedlist>
<listitem>
<simpara>
store
</simpara>
</listitem>
<listitem>
<simpara>
snapshot
</simpara>
</listitem>
<listitem>
<simpara>
replica
</simpara>
</listitem>
<listitem>
<simpara>
relocating
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stage</literal>
</simpara>
</entry>
<entry>
<simpara>
Recovery stage:
</simpara>
<itemizedlist>
<listitem>
<simpara>
init:     Recovery has not started
</simpara>
</listitem>
<listitem>
<simpara>
index:    Reading index meta-data and copying bytes from source to destination
</simpara>
</listitem>
<listitem>
<simpara>
start:    Starting the engine; opening the index for use
</simpara>
</listitem>
<listitem>
<simpara>
translog: Replaying transaction log
</simpara>
</listitem>
<listitem>
<simpara>
finalize: Cleanup
</simpara>
</listitem>
<listitem>
<simpara>
done:     Complete
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>primary</literal>
</simpara>
</entry>
<entry>
<simpara>
True if shard is primary, false otherwise
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>start_time</literal>
</simpara>
</entry>
<entry>
<simpara>
Timestamp of recovery start
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stop_time</literal>
</simpara>
</entry>
<entry>
<simpara>
Timestamp of recovery finish
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>total_time_in_millis</literal>
</simpara>
</entry>
<entry>
<simpara>
Total time to recover shard in milliseconds
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>source</literal>
</simpara>
</entry>
<entry>
<simpara>
Recovery source:
</simpara>
<itemizedlist>
<listitem>
<simpara>
repository description if recovery is from a snapshot
</simpara>
</listitem>
<listitem>
<simpara>
description of source node otherwise
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>target</literal>
</simpara>
</entry>
<entry>
<simpara>
Destination node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>index</literal>
</simpara>
</entry>
<entry>
<simpara>
Statistics about physical index recovery
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>translog</literal>
</simpara>
</entry>
<entry>
<simpara>
Statistics about translog recovery
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>start</literal>
</simpara>
</entry>
<entry>
<simpara>
Statistics about time to open and start the index
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
<chapter id="indices-shards-stores">
<title>Indices Shard Stores<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/shard-stores.asciidoc">Edit me</ulink></title>
<simpara>Provides store information for shard copies of indices.
Store information reports on which nodes shard copies exist, the shard
copy version, indicating how recent they are, and any exceptions
encountered while opening the shard index or from earlier engine failure.</simpara>
<simpara>By default, only lists store information for shards that have at least one
unallocated copy. When the cluster health status is yellow, this will list
store information for shards that have at least one unassigned replica.
When the cluster health status is red, this will list store information
for shards, which has unassigned primaries.</simpara>
<simpara>Endpoints include shard stores information for a specific index, several
indices, or all:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/test/_shard_stores'
curl -XGET 'http://localhost:9200/test1,test2/_shard_stores'
curl -XGET 'http://localhost:9200/_shard_stores'</programlisting>
<simpara>The scope of shards to list store information can be changed through
<literal>status</literal> param. Defaults to <emphasis>yellow</emphasis> and <emphasis>red</emphasis>. <emphasis>yellow</emphasis> lists store information of
shards with at least one unassigned replica and <emphasis>red</emphasis> for shards with unassigned
primary shard.
Use <emphasis>green</emphasis> to list store information for shards with all assigned copies.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_shard_stores?status=green'</programlisting>
<simpara>Response:</simpara>
<simpara>The shard stores information is grouped by indices and shard ids.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    ...
   "0": { <co id="CO123-1"/>
        "stores": [ <co id="CO123-2"/>
            {
                "sPa3OgxLSYGvQ4oPs-Tajw": { <co id="CO123-3"/>
                    "name": "node_t0",
                    "transport_address": "local[1]",
                    "attributes": {
                        "mode": "local"
                    }
                },
                "version": 4, <co id="CO123-4"/>
                "allocation" : "primary" | "replica" | "unused", <co id="CO123-5"/>
                "store_exception": ... <co id="CO123-6"/>
            },
            ...
        ]
   },
    ...
}</programlisting>
<calloutlist>
<callout arearefs="CO123-1">
<para>
The key is the corresponding shard id for the store information
</para>
</callout>
<callout arearefs="CO123-2">
<para>
A list of store information for all copies of the shard
</para>
</callout>
<callout arearefs="CO123-3">
<para>
The node information that hosts a copy of the store, the key
    is the unique node id.
</para>
</callout>
<callout arearefs="CO123-4">
<para>
The version of the store copy
</para>
</callout>
<callout arearefs="CO123-6">
<para>
The status of the store copy, whether it is used as a
    primary, replica or not used at all
</para>
</callout>
<callout arearefs="CO123-5">
<para>
Any exception encountered while opening the shard index or
    from earlier engine failure
</para>
</callout>
</calloutlist>
</chapter>
<chapter id="indices-clearcache">
<title>Clear Cache<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/clearcache.asciidoc">Edit me</ulink></title>
<simpara>The clear cache API allows to clear either all caches or specific cached
associated with one or more indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/_cache/clear'</programlisting>
<simpara>The API, by default, will clear all caches. Specific caches can be cleaned
explicitly by setting <literal>query</literal>, <literal>fielddata</literal> or <literal>request</literal>.</simpara>
<simpara>All caches relating to a specific field(s) can also be cleared by
specifying <literal>fields</literal> parameter with a comma delimited list of the
relevant fields.</simpara>
<bridgehead id="_multi_index_2" renderas="sect2">Multi Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/clearcache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The clear cache API can be applied to more than one index with a single
call, or even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_cache/clear'

$ curl -XPOST 'http://localhost:9200/_cache/clear'</programlisting>
</chapter>
<chapter id="indices-flush">
<title>Flush<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/flush.asciidoc">Edit me</ulink></title>
<simpara>The flush API allows to flush one or more indices through an API. The
flush process of an index basically frees memory from the index by
flushing data to the index storage and clearing the internal
<link linkend="index-modules-translog">transaction log</link>. By
default, Elasticsearch uses memory heuristics in order to automatically
trigger flush operations as required in order to clear memory.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /twitter/_flush</programlisting>
<remark> AUTOSENSE</remark>
<bridgehead id="flush-parameters" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/flush.asciidoc">Edit me</ulink></bridgehead>
<simpara>The flush API accepts the following request parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>wait_if_ongoing</literal>
</simpara>
</entry>
<entry>
<simpara>
If set to <literal>true</literal> the flush operation will block until the
flush can be executed if another flush operation is already executing.
The default is <literal>false</literal> and will cause an exception to be thrown on
the shard level if another flush operation is already running.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>force</literal>
</simpara>
</entry>
<entry>
<simpara>
Whether a flush should be forced even if it is not necessarily needed ie.
if no changes will be committed to the index. This is useful if transaction log IDs
should be incremented even if no uncommitted changes are present.
(This setting can be considered as internal)
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="flush-multi-index" renderas="sect2">Multi Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/flush.asciidoc">Edit me</ulink></bridgehead>
<simpara>The flush API can be applied to more than one index with a single call,
or even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /kimchy,elasticsearch/_flush

POST /_flush</programlisting>
<remark> AUTOSENSE</remark>
<section id="indices-synced-flush">
<title>Synced Flush<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/flush.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch tracks the indexing activity of each shard. Shards that have not
received any indexing operations for 5 minutes are automatically marked as inactive. This presents
an opportunity for Elasticsearch to reduce shard resources and also perform
a special kind of flush, called <literal>synced flush</literal>. A synced flush performs a normal flush, then adds
a generated unique marker (sync_id) to all shards.</simpara>
<simpara>Since the sync id marker was added when there were no ongoing indexing operations, it can
be used as a quick way to check if the two shards' lucene indices are identical. This quick sync id
comparison (if present) is used during recovery or restarts to skip the first and
most costly phase of the process. In that case, no segment files need to be copied and
the transaction log replay phase of the recovery can start immediately. Note that since the sync id
marker was applied together with a flush, it is very likely that the transaction log will be empty,
speeding up recoveries even more.</simpara>
<simpara>This is particularly useful for use cases having lots of indices which are
never or very rarely updated, such as time based data. This use case typically generates lots of indices whose
recovery without the synced flush marker would take a long time.</simpara>
<simpara>To check whether a shard has a marker or not, look for the <literal>commit</literal> section of shard stats returned by
the <link linkend="indices-stats">indices stats</link> API:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /twitter/_stats/commit?level=shards</programlisting>
<remark> AUTOSENSE</remark>
<simpara>which returns something similar to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   ...
   "indices": {
      "twitter": {
         "primaries": {},
         "total": {},
         "shards": {
            "0": [
               {
                  "routing": {
                     ...
                  },
                  "commit": {
                     "id": "te7zF7C4UsirqvL6jp/vUg==",
                     "generation": 2,
                     "user_data": {
                        "sync_id": "AU2VU0meX-VX2aNbEUsD" <co id="CO124-1"/>,
                        ...
                     },
                     "num_docs": 0
                  }
               }
               ...
            ],
            ...
         }
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO124-1">
<para>
the <literal>sync id</literal> marker
</para>
</callout>
</calloutlist>
<bridgehead id="_synced_flush_api" renderas="sect2">Synced Flush API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/flush.asciidoc">Edit me</ulink></bridgehead>
<simpara>The Synced Flush API allows an administrator to initiate a synced flush manually. This can be particularly useful for
a planned (rolling) cluster restart where you can stop indexing and don&#8217;t want to wait the default 5 minutes for
idle indices to be sync-flushed automatically.</simpara>
<simpara>While handy, there are a couple of caveats for this API:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
Synced flush is a best effort operation. Any ongoing indexing operations will cause
the synced flush to fail on that shard. This means that some shards may be synced flushed while others aren&#8217;t. See below for more.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>sync_id</literal> marker is removed as soon as the shard is flushed again. That is because a flush replaces the low level
lucene commit point where the marker is stored. Uncommitted operations in the transaction log do not remove the marker.
In practice, one should consider any indexing operation on an index as removing the marker as a flush can be triggered by Elasticsearch
at any time.
</simpara>
</listitem>
</orderedlist>
<note><simpara>It is harmless to request a synced flush while there is ongoing indexing. Shards that are idle will succeed and shards
 that are not will fail. Any shards that succeeded will have faster recovery times.</simpara></note>
<programlisting language="sh" linenumbering="unnumbered">POST /twitter/_flush/synced</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The response contains details about how many shards were successfully sync-flushed and information about any failure.</simpara>
<simpara>Here is what it looks like when all shards of a two shards and one replica index successfully
sync-flushed:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_shards": {
      "total": 4,
      "successful": 4,
      "failed": 0
   },
   "twitter": {
      "total": 4,
      "successful": 4,
      "failed": 0
   }
}</programlisting>
<simpara>Here is what it looks like when one shard group failed due to pending operations:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_shards": {
      "total": 4,
      "successful": 2,
      "failed": 2
   },
   "twitter": {
      "total": 4,
      "successful": 2,
      "failed": 2,
      "failures": [
         {
            "shard": 1,
            "reason": "[2] ongoing operations on primary"
         }
      ]
   }
}</programlisting>
<note><simpara>The above error is shown when the synced flush fails due to concurrent indexing operations. The HTTP
status code in that case will be <literal>409 CONFLICT</literal>.</simpara></note>
<simpara>Sometimes the failures are specific to a shard copy. The copies that failed will not be eligible for
fast recovery but those that succeeded still will be. This case is reported as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "_shards": {
      "total": 4,
      "successful": 1,
      "failed": 1
   },
   "twitter": {
      "total": 4,
      "successful": 3,
      "failed": 1,
      "failures": [
         {
            "shard": 1,
            "reason": "unexpected error",
            "routing": {
               "state": "STARTED",
               "primary": false,
               "node": "SZNr2J_ORxKTLUCydGX4zA",
               "relocating_node": null,
               "shard": 1,
               "index": "twitter"
            }
         }
      ]
   }
}</programlisting>
<note><simpara>When a shard copy fails to sync-flush, the HTTP status code returned will be <literal>409 CONFLICT</literal>.</simpara></note>
<simpara>The synced flush API can be applied to more than one index with a single call,
or even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /kimchy,elasticsearch/_flush/synced

POST /_flush/synced</programlisting>
<remark> AUTOSENSE</remark>
</section>
</chapter>
<chapter id="indices-refresh">
<title>Refresh<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/refresh.asciidoc">Edit me</ulink></title>
<simpara>The refresh API allows to explicitly refresh one or more index, making
all operations performed since the last refresh available for search.
The (near) real-time capabilities depend on the index engine used. For
example, the internal one requires refresh to be called, but by default a
refresh is scheduled periodically.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/_refresh'</programlisting>
<bridgehead id="_multi_index_3" renderas="sect2">Multi Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/refresh.asciidoc">Edit me</ulink></bridgehead>
<simpara>The refresh API can be applied to more than one index with a single
call, or even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_refresh'

$ curl -XPOST 'http://localhost:9200/_refresh'</programlisting>
</chapter>
<chapter id="indices-forcemerge">
<title>Force Merge<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/forcemerge.asciidoc">Edit me</ulink></title>
<simpara>The force merge API allows to force merging of one or more indices through an
API. The merge relates to the number of segments a Lucene index holds within
each shard. The force merge operation allows to reduce the number of segments by
merging them.</simpara>
<simpara>This call will block until the merge is complete. If the http connection is
lost, the request will continue in the background, and any new requests will
block until the previous force merge is complete.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/_forcemerge'</programlisting>
<bridgehead id="forcemerge-parameters" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/forcemerge.asciidoc">Edit me</ulink></bridgehead>
<simpara>The force merge API accepts the following request parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>max_num_segments</literal>
</simpara>
</entry>
<entry>
<simpara>
The number of segments to merge to. To fully
merge the index, set it to <literal>1</literal>. Defaults to simply checking if a
merge needs to execute, and if so, executes it.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>only_expunge_deletes</literal>
</simpara>
</entry>
<entry>
<simpara>
Should the merge process only expunge segments with
deletes in it. In Lucene, a document is not deleted from a segment, just marked
as deleted. During a merge process of segments, a new segment is created that
does not have those deletes. This flag allows to only merge segments that have
deletes. Defaults to <literal>false</literal>.  Note that this won&#8217;t override the
<literal>index.merge.policy.expunge_deletes_allowed</literal> threshold.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flush</literal>
</simpara>
</entry>
<entry>
<simpara>
Should a flush be performed after the forced merge. Defaults to
<literal>true</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="forcemerge-multi-index" renderas="sect2">Multi Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/forcemerge.asciidoc">Edit me</ulink></bridgehead>
<simpara>The force merge API can be applied to more than one index with a single call, or
even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_forcemerge'

$ curl -XPOST 'http://localhost:9200/_forcemerge'</programlisting>
</chapter>
<chapter id="indices-optimize">
<title>Optimize<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/optimize.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.1.0"><title>Deprecated in 2.1.0.</title><simpara>Optimize API has been renamed to the force merge API.</simpara></warning>
<simpara>The optimize API allows to optimize one or more indices through an API.
The optimize process basically optimizes the index for faster search
operations (and relates to the number of segments a Lucene index holds
within each shard). The optimize operation allows to reduce the number
of segments by merging them.</simpara>
<simpara>This call will block until the optimize is complete. If the http connection
is lost, the request will continue in the background, and
any new requests will block until the previous optimize is complete.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/_optimize'</programlisting>
<bridgehead id="optimize-parameters" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/optimize.asciidoc">Edit me</ulink></bridgehead>
<simpara>The optimize API accepts the following request parameters as query arguments:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>max_num_segments</literal>
</simpara>
</entry>
<entry>
<simpara>
The number of segments to optimize to. To fully
optimize the index, set it to <literal>1</literal>. Defaults to simply checking if a
merge needs to execute, and if so, executes it.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>only_expunge_deletes</literal>
</simpara>
</entry>
<entry>
<simpara>
Should the optimize process only expunge segments with
deletes in it. In Lucene, a document is not deleted from a segment, just marked
as deleted. During a merge process of segments, a new segment is created that
does not have those deletes. This flag allows to only merge segments that have
deletes. Defaults to <literal>false</literal>.  Note that this won&#8217;t override the
<literal>index.merge.policy.expunge_deletes_allowed</literal> threshold.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flush</literal>
</simpara>
</entry>
<entry>
<simpara>
Should a flush be performed after the optimize. Defaults to
<literal>true</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="optimize-multi-index" renderas="sect2">Multi Index<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/optimize.asciidoc">Edit me</ulink></bridgehead>
<simpara>The optimize API can be applied to more than one index with a single
call, or even on <literal>_all</literal> the indices.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_optimize'

$ curl -XPOST 'http://localhost:9200/_optimize?only_expunge_deletes=true'</programlisting>
</chapter>
<chapter id="indices-upgrade">
<title>Upgrade<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/upgrade.asciidoc">Edit me</ulink></title>
<simpara>The upgrade API allows to upgrade one or more indices to the latest Lucene
format through an API. The upgrade process converts any segments written with
older formats.</simpara>
<important>
<simpara><emphasis role="strong">The upgrade API in its current form will not help you to migrate indices
created in Elasticsearch 1.x to 5.x.</emphasis></simpara>
<simpara>The upgrade API rewrites an index in the latest Lucene format, but it still
retains the original data structures that were used when the index was first
created.  For instance:</simpara>
<itemizedlist>
<listitem>
<simpara>
Doc-values on numeric fields used to use BinaryDocValues, but now use dedicated NumericDocValues.
</simpara>
</listitem>
<listitem>
<simpara>
The parent-child feature has been completely rewritten to use a new data structure.
</simpara>
</listitem>
<listitem>
<simpara>
Geo-point fields now require doc values and the Lucene index where, previously, they relied on in-memory calculations.
</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Migrating 1.x indices to 5.x</emphasis></simpara>
<simpara>There are two ways to migrate 1.x indices to 5.x:</simpara>
<itemizedlist>
<listitem>
<simpara>
Reindex them in an Elasticsearch 2.4.x cluster, or
</simpara>
</listitem>
<listitem>
<simpara>
Use reindex-from-remote to import indices from a 1.x cluster into a 5.x cluster directly.
</simpara>
</listitem>
</itemizedlist>
<simpara>See the <ulink url="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/reindex-upgrade.html">Reindex to Upgrade</ulink> docs in 5.0 for more information.</simpara>
</important>
<bridgehead id="_start_an_upgrade" renderas="sect2">Start an upgrade<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/upgrade.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="sh" linenumbering="unnumbered">$ curl -XPOST 'http://localhost:9200/twitter/_upgrade'</programlisting>
<note><simpara>Upgrading is an I/O intensive operation, and is limited to processing a
single shard per node at a time.  It also is not allowed to run at the same
time as an optimize/force-merge.</simpara></note>
<simpara>This call will block until the upgrade is complete. If the http connection
is lost, the request will continue in the background, and
any new requests will block until the previous upgrade is complete.</simpara>
<bridgehead id="upgrade-parameters" renderas="sect3">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/upgrade.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>upgrade</literal> API accepts the following request parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>only_ancient_segments</literal>
</simpara>
</entry>
<entry>
<simpara>
If true, only very old segments (from a
previous Lucene major release) will be upgraded.  While this will do
the minimal work to ensure the next major release of Elasticsearch can
read the segments, it&#8217;s dangerous because it can leave other very old
segments in sub-optimal formats.  Defaults to <literal>false</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_check_upgrade_status" renderas="sect2">Check upgrade status<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/indices/upgrade.asciidoc">Edit me</ulink></bridgehead>
<simpara>Use a <literal>GET</literal> request to monitor how much of an index is upgraded.  This
can also be used prior to starting an upgrade to identify which
indices you want to upgrade at the same time.</simpara>
<simpara>The <literal>ancient</literal> byte values that are returned indicate total bytes of
segments whose version is extremely old (Lucene major version is
different from the current version), showing how much upgrading is
necessary when you run with <literal>only_ancient_segments=true</literal>.</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl 'http://localhost:9200/twitter/_upgrade?pretty&amp;human'</programlisting>
<programlisting language="js" linenumbering="unnumbered">{
  "size": "21gb",
  "size_in_bytes": "21000000000",
  "size_to_upgrade": "10gb",
  "size_to_upgrade_in_bytes": "10000000000"
  "size_to_upgrade_ancient": "1gb",
  "size_to_upgrade_ancient_in_bytes": "1000000000"
  "indices": {
    "twitter": {
      "size": "21gb",
      "size_in_bytes": "21000000000",
      "size_to_upgrade": "10gb",
      "size_to_upgrade_in_bytes": "10000000000"
      "size_to_upgrade_ancient": "1gb",
      "size_to_upgrade_ancient_in_bytes": "1000000000"
    }
  }
}</programlisting>
<simpara>The level of details in the upgrade status command can be controlled by
setting <literal>level</literal> parameter to <literal>cluster</literal>, <literal>index</literal> (default) or <literal>shard</literal> levels.
For example, you can run the upgrade status command with <literal>level=shard</literal> to
get detailed upgrade information of each individual shard.</simpara>
</chapter>
</part>
<part id="cat">
<title>cat APIs <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></title>
<partintro>
<bridgehead id="intro" renderas="sect1">Introduction<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<simpara>JSON is great&#8230; for computers.  Even if it&#8217;s pretty-printed, trying
to find relationships in the data is tedious.  Human eyes, especially
when looking at an ssh terminal, need compact and aligned text.  The
cat API aims to meet this need.</simpara>
<simpara>All the cat commands accept a query string parameter <literal>help</literal> to see all
the headers and info they provide, and the <literal>/_cat</literal> command alone lists all
the available commands.</simpara>
<bridgehead id="common-parameters" renderas="sect1">Common parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="verbose" renderas="sect2">Verbose<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each of the commands accepts a query string parameter <literal>v</literal> to turn on
verbose output.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/master?v'
id                     ip        node
EGtKWZlWQYWDmX29fUnp3Q 127.0.0.1 Grey, Sara</programlisting>
<bridgehead id="help" renderas="sect2">Help<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each of the commands accepts a query string parameter <literal>help</literal> which will
output its available columns.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/master?help'
id   | node id
ip   | node transport ip address
node | node name</programlisting>
<bridgehead id="headers" renderas="sect2">Headers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each of the commands accepts a query string parameter <literal>h</literal> which forces
only those columns to appear.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'n1:9200/_cat/nodes?h=ip,port,heapPercent,name'
192.168.56.40 9300 40.3 Captain Universe
192.168.56.20 9300 15.3 Kaluu
192.168.56.50 9300 17.0 Yellowjacket
192.168.56.10 9300 12.3 Remy LeBeau
192.168.56.30 9300 43.9 Ramsey, Doug</programlisting>
<simpara>You can also request multiple columns using simple wildcards like
<literal>/_cat/thread_pool?h=ip,bulk.*</literal> to get all headers (or aliases) starting
with <literal>bulk.</literal>.</simpara>
<bridgehead id="numeric-formats" renderas="sect2">Numeric formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat.asciidoc">Edit me</ulink></bridgehead>
<simpara>Many commands provide a few types of numeric output, either a byte
value or a time value.  By default, these types are human-formatted,
for example, <literal>3.5mb</literal> instead of <literal>3763212</literal>.  The human values are not
sortable numerically, so in order to operate on these values where
order is important, you can change it.</simpara>
<simpara>Say you want to find the largest index in your cluster (storage used
by all the shards, not number of documents).  The <literal>/_cat/indices</literal> API
is ideal.  We only need to tweak two things.  First, we want to turn
off human mode.  We&#8217;ll use a byte-level resolution.  Then we&#8217;ll pipe
our output into <literal>sort</literal> using the appropriate column, which in this
case is the eight one.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl '192.168.56.10:9200/_cat/indices?bytes=b' | sort -rnk8
green wiki2 3 0 10000   0 105274918 105274918
green wiki1 3 0 10000 413 103776272 103776272
green foo   1 0   227   0   2065131   2065131</programlisting>
</partintro>
<chapter id="cat-alias">
<title>cat aliases<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/alias.asciidoc">Edit me</ulink></title>
<simpara><literal>aliases</literal> shows information about currently configured aliases to indices
including filter and routing infos.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl '192.168.56.10:9200/_cat/aliases?v'
alias  index filter routing.index routing.search
alias2 test1 *      -            -
alias4 test1 -      2            1,2
alias1 test1 -      -            -
alias3 test1 -      1            1</programlisting>
<simpara>The output shows that <literal>alias</literal> has configured a filter, and specific routing
configurations in <literal>alias3</literal> and <literal>alias4</literal>.</simpara>
<simpara>If you only want to get information about a single alias, you can specify
the alias in the URL, for example <literal>/_cat/aliases/alias1</literal>.</simpara>
</chapter>
<chapter id="cat-allocation">
<title>cat allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/allocation.asciidoc">Edit me</ulink></title>
<simpara><literal>allocation</literal> provides a snapshot of how many shards are allocated to each data node
and how much disk space they are using.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl '192.168.56.10:9200/_cat/allocation?v'
shards diskUsed diskAvail diskRatio ip            node
     1    5.6gb    72.2gb      7.8% 192.168.56.10 Jarella
     1    5.6gb    72.2gb      7.8% 192.168.56.30 Solarr
     1    5.5gb    72.3gb      7.6% 192.168.56.20 Adam II</programlisting>
<simpara>Here we can see that each node has been allocated a single shard and
that they&#8217;re all using about the same amount of space.</simpara>
</chapter>
<chapter id="cat-count">
<title>cat count<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/count.asciidoc">Edit me</ulink></title>
<simpara><literal>count</literal> provides quick access to the document count of the entire
cluster, or individual indices.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/indices
green wiki1 3 0 10000 331 168.5mb 168.5mb
green wiki2 3 0   428   0     8mb     8mb

% curl 192.168.56.10:9200/_cat/count
1384314124582 19:42:04 10428

% curl 192.168.56.10:9200/_cat/count/wiki2
1384314139815 19:42:19 428</programlisting>
<note><simpara>The document count indicates the number of live documents and does not include deleted documents which have not yet been cleaned up by the merge process.</simpara></note>
</chapter>
<chapter id="cat-fielddata">
<title>cat fielddata<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/fielddata.asciidoc">Edit me</ulink></title>
<simpara><literal>fielddata</literal> shows how much heap memory is currently being used by fielddata
on every data node in the cluster.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl '192.168.56.10:9200/_cat/fielddata?v'
id                     host    ip            node          total   body    text
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb 225.7kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb 275.3kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb 175.3kb</programlisting>
<simpara>Fields can be specified either as a query parameter, or in the URL path:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl '192.168.56.10:9200/_cat/fielddata?v&amp;fields=body'
id                     host    ip            node          total   body
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb

% curl '192.168.56.10:9200/_cat/fielddata/body,text?v'
id                     host    ip            node          total   body    text
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb 225.7kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb 275.3kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb 175.3kb</programlisting>
<simpara>The output shows the total fielddata and then the individual fielddata for the
<literal>body</literal> and <literal>text</literal> fields.</simpara>
</chapter>
<chapter id="cat-health">
<title>cat health<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/health.asciidoc">Edit me</ulink></title>
<simpara><literal>health</literal> is a terse, one-line representation of the same information
from <literal>/_cluster/health</literal>. It has one option <literal>ts</literal> to disable the
timestamping.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl localhost:9200/_cat/health
1384308967 18:16:07 foo green 3 3 3 3 0 0 0
% curl 'localhost:9200/_cat/health?v&amp;ts=0'
cluster status nodeTotal nodeData shards pri relo init unassign tasks
foo     green          3        3      3   3    0    0        0     0</programlisting>
<simpara>A common use of this command is to verify the health is consistent
across nodes:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/health
[1] 20:20:52 [SUCCESS] es3.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0
[2] 20:20:52 [SUCCESS] es1.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0
[3] 20:20:52 [SUCCESS] es2.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0</programlisting>
<simpara>A less obvious use is to track recovery of a large cluster over
time. With enough shards, starting a cluster, or even recovering after
losing a node, can take time (depending on your network &amp; disk). A way
to track its progress is by using this command in a delayed loop:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% while true; do curl localhost:9200/_cat/health; sleep 120; done
1384309446 18:24:06 foo red 3 3 20 20 0 0 1812 0
1384309566 18:26:06 foo yellow 3 3 950 916 0 12 870 0
1384309686 18:28:06 foo yellow 3 3 1328 916 0 12 492 0
1384309806 18:30:06 foo green 3 3 1832 916 4 0 0
^C</programlisting>
<simpara>In this scenario, we can tell that recovery took roughly four minutes.
If this were going on for hours, we would be able to watch the
<literal>UNASSIGNED</literal> shards drop precipitously.  If that number remained
static, we would have an idea that there is a problem.</simpara>
<bridgehead id="timestamp" renderas="sect2">Why the timestamp?<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/health.asciidoc">Edit me</ulink></bridgehead>
<simpara>You typically are using the <literal>health</literal> command when a cluster is
malfunctioning.  During this period, it&#8217;s extremely important to
correlate activities across log files, alerting systems, etc.</simpara>
<simpara>There are two outputs.  The <literal>HH:MM:SS</literal> output is simply for quick
human consumption.  The epoch time retains more information, including
date, and is machine sortable if your recovery spans days.</simpara>
</chapter>
<chapter id="cat-indices">
<title>cat indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/indices.asciidoc">Edit me</ulink></title>
<simpara>The <literal>indices</literal> command provides a cross-section of each index.  This
information <emphasis role="strong">spans nodes</emphasis>.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/indices/twi*?v'
health status index    pri rep docs.count docs.deleted store.size pri.store.size
green  open   twitter    5   1      11434            0       64mb           32mb
green  open   twitter2   2   0       2030            0      5.8mb          5.8mb</programlisting>
<simpara>We can tell quickly how many shards make up an index, the number of
docs at the Lucene level, including hidden docs (e.g., from nested types),
deleted docs, primary store size, and total store size (all shards including replicas).
All these exposed metrics come directly from Lucene APIs.</simpara>
<bridgehead id="pri-flag" renderas="sect2">Primaries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/indices.asciidoc">Edit me</ulink></bridgehead>
<simpara>The index stats by default will show them for all of an index&#8217;s
shards, including replicas.  A <literal>pri</literal> flag can be supplied to enable
the view of relevant stats in the context of only the primaries.</simpara>
<bridgehead id="examples" renderas="sect2">Examples<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/indices.asciidoc">Edit me</ulink></bridgehead>
<simpara>Which indices are yellow?</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl localhost:9200/_cat/indices | grep ^yell
yellow open  wiki     2 1  6401 1115 151.4mb 151.4mb
yellow open  twitter  5 1 11434    0    32mb    32mb</programlisting>
<simpara>What&#8217;s my largest index by disk usage not including replicas?</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/indices?bytes=b' | sort -rnk8
green open  wiki     2 0  6401 1115 158843725 158843725
green open  twitter  5 1 11434    0  67155614  33577857
green open  twitter2 2 0  2030    0   6125085   6125085</programlisting>
<simpara>How many merge operations have the shards for the <literal>wiki</literal> completed?</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/indices/wiki?pri&amp;v&amp;h=health,index,prirep,docs.count,mt'
health index docs.count mt pri.mt
green  wiki        9646 16     16</programlisting>
<simpara>How much memory is used per index?</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/indices?v&amp;h=i,tm'
i     tm
wiki  8.1gb
test  30.5kb
user  1.9mb</programlisting>
</chapter>
<chapter id="cat-master">
<title>cat master<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/master.asciidoc">Edit me</ulink></title>
<simpara><literal>master</literal> doesn&#8217;t have any extra options. It simply displays the
master&#8217;s node ID, bound IP address, and node name.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/master?v'
id                     ip            node
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</programlisting>
<simpara>This information is also available via the <literal>nodes</literal> command, but this
is slightly shorter when all you want to do, for example, is verify
all nodes agree on the master:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/master
[1] 19:16:37 [SUCCESS] es3.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[2] 19:16:37 [SUCCESS] es2.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[3] 19:16:37 [SUCCESS] es1.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</programlisting>
</chapter>
<chapter id="cat-nodeattrs">
<title>cat nodeattrs<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/nodeattrs.asciidoc">Edit me</ulink></title>
<simpara>The <literal>nodeattrs</literal> command shows custom node attributes.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/nodeattrs
node       host    ip          attr  value
Black Bolt epsilon 192.168.1.8 rack  rack314
Black Bolt epsilon 192.168.1.8 azone us-east-1</programlisting>
<simpara>The first few columns give you basic info per node.</simpara>
<programlisting language="sh" linenumbering="unnumbered">node       host    ip
Black Bolt epsilon 192.168.1.8
Black Bolt epsilon 192.168.1.8</programlisting>
<simpara>The attr and value columns can give you a picture of custom node attributes.</simpara>
<programlisting language="sh" linenumbering="unnumbered">attr  value
rack  rack314
azone us-east-1</programlisting>
<bridgehead id="_columns" renderas="sect2">Columns<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/nodeattrs.asciidoc">Edit me</ulink></bridgehead>
<simpara>Below is an exhaustive list of the existing headers that can be
passed to <literal>nodes?h=</literal> to retrieve the relevant details in ordered
columns.  If no headers are specified, then those marked to Appear
by Default will appear. If any header is specified, then the defaults
are not used.</simpara>
<simpara>Aliases can be used in place of the full header name for brevity.
Columns appear in the order that they are listed below unless a
different order is specified (e.g., <literal>h=attr,value</literal> versus <literal>h=value,attr</literal>).</simpara>
<simpara>When specifying headers, the headers are not placed in the output
by default.  To have the headers appear in the output, use verbose
mode (<literal>v</literal>). The header name will match the supplied value (e.g.,
<literal>pid</literal> versus <literal>p</literal>).  For example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/nodeattrs?v&amp;h=name,pid,attr,value
name       pid   attr  value
Black Bolt 28000 rack  rack314
Black Bolt 28000 azone us-east-1</programlisting>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Header </entry>
<entry align="left" valign="top">Alias </entry>
<entry align="left" valign="top">Appear by Default </entry>
<entry align="left" valign="top">Description </entry>
<entry align="left" valign="top">Example</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>node</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Name of the node</simpara></entry>
<entry align="left" valign="top"><simpara>Black Bolt</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>id</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>nodeId</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Unique node ID</simpara></entry>
<entry align="left" valign="top"><simpara>k0zy</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pid</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Process ID</simpara></entry>
<entry align="left" valign="top"><simpara>13061</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>h</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Host name</simpara></entry>
<entry align="left" valign="top"><simpara>n1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ip</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>i</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>IP address</simpara></entry>
<entry align="left" valign="top"><simpara>127.0.1.1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>port</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>po</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Bound transport port</simpara></entry>
<entry align="left" valign="top"><simpara>9300</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>attr</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>attr.name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Attribute name</simpara></entry>
<entry align="left" valign="top"><simpara>rack</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>value</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>attr.value</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Attribute value</simpara></entry>
<entry align="left" valign="top"><simpara>rack123</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</chapter>
<chapter id="cat-nodes">
<title>cat nodes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/nodes.asciidoc">Edit me</ulink></title>
<simpara>The <literal>nodes</literal> command shows the cluster topology.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/nodes
SP4H 4727 192.168.56.30 9300 2.4.2 1.8.0_73 72.1gb 35.4 93.9mb 79 239.1mb 0.45 3.4h d m Boneyard
_uhJ 5134 192.168.56.10 9300 2.4.2 1.8.0_73 72.1gb 33.3 93.9mb 85 239.1mb 0.06 3.4h d * Athena
HfDp 4562 192.168.56.20 9300 2.4.2 1.8.0_73 72.2gb 74.5 93.9mb 83 239.1mb 0.12 3.4h d m Zarek</programlisting>
<simpara>The first few columns tell you where your nodes live.  For sanity it
also tells you what version of ES and the JVM each one runs.</simpara>
<programlisting language="sh" linenumbering="unnumbered">nodeId pid  ip            port version jdk
u2PZ   4234 192.168.56.30 9300 2.4.2   1.8.0_73
URzf   5443 192.168.56.10 9300 2.4.2   1.8.0_73
ActN   3806 192.168.56.20 9300 2.4.2   1.8.0_73</programlisting>
<simpara>The next few give a picture of your heap, memory, and load.</simpara>
<programlisting language="sh" linenumbering="unnumbered">diskAvail heapPercent heapMax ramPercent  ramMax load
   72.1gb        31.3  93.9mb         81 239.1mb 0.24
   72.1gb        19.6  93.9mb         82 239.1mb 0.05
   72.2gb        64.9  93.9mb         84 239.1mb 0.12</programlisting>
<simpara>The last columns provide ancillary information that can often be
useful when looking at the cluster as a whole, particularly large
ones.  How many master-eligible nodes do I have?  How many client
nodes?  It looks like someone restarted a node recently; which one was
it?</simpara>
<programlisting language="sh" linenumbering="unnumbered">uptime data/client master name
  3.5h d           m      Boneyard
  3.5h d           *      Athena
  3.5h d           m      Zarek</programlisting>
<bridgehead id="_columns_2" renderas="sect2">Columns<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/nodes.asciidoc">Edit me</ulink></bridgehead>
<simpara>Below is an exhaustive list of the existing headers that can be
passed to <literal>nodes?h=</literal> to retrieve the relevant details in ordered
columns.  If no headers are specified, then those marked to Appear
by Default will appear. If any header is specified, then the defaults
are not used.</simpara>
<simpara>Aliases can be used in place of the full header name for brevity.
Columns appear in the order that they are listed below unless a
different order is specified (e.g., <literal>h=pid,id</literal> versus <literal>h=id,pid</literal>).</simpara>
<simpara>When specifying headers, the headers are not placed in the output
by default.  To have the headers appear in the output, use verbose
mode (<literal>v</literal>). The header name will match the supplied value (e.g.,
<literal>pid</literal> versus <literal>p</literal>).  For example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/nodes?v&amp;h=id,ip,port,v,m
id   ip            port version m
pLSN 192.168.56.30 9300 2.4.2   m
k0zy 192.168.56.10 9300 2.4.2   m
6Tyi 192.168.56.20 9300 2.4.2   *
% curl 192.168.56.10:9200/_cat/nodes?h=id,ip,port,v,m
pLSN 192.168.56.30 9300 2.4.2 m
k0zy 192.168.56.10 9300 2.4.2 m
6Tyi 192.168.56.20 9300 2.4.2 *</programlisting>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Header </entry>
<entry align="left" valign="top">Alias </entry>
<entry align="left" valign="top">Appear by Default </entry>
<entry align="left" valign="top">Description </entry>
<entry align="left" valign="top">Example</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>id</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>nodeId</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Unique node ID</simpara></entry>
<entry align="left" valign="top"><simpara>k0zy</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pid</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Process ID</simpara></entry>
<entry align="left" valign="top"><simpara>13061</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>h</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Host name</simpara></entry>
<entry align="left" valign="top"><simpara>n1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ip</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>i</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>IP address</simpara></entry>
<entry align="left" valign="top"><simpara>127.0.1.1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>port</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>po</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Bound transport port</simpara></entry>
<entry align="left" valign="top"><simpara>9300</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>version</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>v</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Elasticsearch version</simpara></entry>
<entry align="left" valign="top"><simpara>2.4.2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>build</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>b</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Elasticsearch Build hash</simpara></entry>
<entry align="left" valign="top"><simpara>5c03844</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>jdk</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>j</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Running Java version</simpara></entry>
<entry align="left" valign="top"><simpara>1.8.0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>disk.avail</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>d</literal>, <literal>disk</literal>, <literal>diskAvail</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Available disk space</simpara></entry>
<entry align="left" valign="top"><simpara>1.8gb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>heap.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>hc</literal>, <literal>heapCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used heap</simpara></entry>
<entry align="left" valign="top"><simpara>311.2mb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>heap.percent</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>hp</literal>, <literal>heapPercent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Used heap percentage</simpara></entry>
<entry align="left" valign="top"><simpara>7</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>heap.max</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>hm</literal>, <literal>heapMax</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Maximum configured heap</simpara></entry>
<entry align="left" valign="top"><simpara>1015.6mb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ram.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rc</literal>, <literal>ramCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used total memory</simpara></entry>
<entry align="left" valign="top"><simpara>513.4mb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ram.percent</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rp</literal>, <literal>ramPercent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Used total memory percentage</simpara></entry>
<entry align="left" valign="top"><simpara>47</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ram.max</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rm</literal>, <literal>ramMax</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Total memory</simpara></entry>
<entry align="left" valign="top"><simpara>2.9gb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>file_desc.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fdc</literal>, <literal>fileDescriptorCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used file
descriptors</simpara></entry>
<entry align="left" valign="top"><simpara>123</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>file_desc.percent</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fdp</literal>, <literal>fileDescriptorPercent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Used file
descriptors percentage</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>file_desc.max</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fdm</literal>, <literal>fileDescriptorMax</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Maximum number of file
descriptors</simpara></entry>
<entry align="left" valign="top"><simpara>1024</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>load</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>l</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Most recent load average</simpara></entry>
<entry align="left" valign="top"><simpara>0.22</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>uptime</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>u</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Node uptime</simpara></entry>
<entry align="left" valign="top"><simpara>17.3m</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>node.role</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>r</literal>, <literal>role</literal>, <literal>dc</literal>, <literal>nodeRole</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Data node (d); Client
node (c)</simpara></entry>
<entry align="left" valign="top"><simpara>d</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>master</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>m</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Current master (*); master eligible (m)</simpara></entry>
<entry align="left" valign="top"><simpara>m</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>n</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
<entry align="left" valign="top"><simpara>Node name</simpara></entry>
<entry align="left" valign="top"><simpara>Venom</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>completion.size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>cs</literal>, <literal>completionSize</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Size of completion</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fielddata.memory_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fm</literal>, <literal>fielddataMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used fielddata
cache memory</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fielddata.evictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fe</literal>, <literal>fielddataEvictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Fielddata cache
evictions</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>query_cache.memory_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>qcm</literal>, <literal>queryCacheMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used query
cache memory</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>query_cache.evictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>qce</literal>, <literal>queryCacheEvictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Query
cache evictions</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>request_cache.memory_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rcm</literal>, <literal>requestCacheMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Used request
cache memory</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>request_cache.evictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rce</literal>, <literal>requestCacheEvictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Request
cache evictions</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>request_cache.hit_count</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rchc</literal>, <literal>requestCacheHitCount</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Request
cache hit count</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>request_cache.miss_count</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rcmc</literal>, <literal>requestCacheMissCount</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Request
cache miss count</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>flush.total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>ft</literal>, <literal>flushTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of flushes</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>flush.total_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>ftt</literal>, <literal>flushTotalTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in flush</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>gc</literal>, <literal>getCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of current get
operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>gti</literal>, <literal>getTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in get</simpara></entry>
<entry align="left" valign="top"><simpara>14ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>gto</literal>, <literal>getTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of get operations</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.exists_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>geti</literal>, <literal>getExistsTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in
successful gets</simpara></entry>
<entry align="left" valign="top"><simpara>14ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.exists_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>geto</literal>, <literal>getExistsTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of successful
get operations</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.missing_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>gmti</literal>, <literal>getMissingTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in failed
gets</simpara></entry>
<entry align="left" valign="top"><simpara>0s</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get.missing_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>gmto</literal>, <literal>getMissingTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of failed
get operations</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.delete_current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>idc</literal>, <literal>indexingDeleteCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number
of current deletion operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.delete_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>idti</literal>, <literal>indexingDeleteTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in
deletions</simpara></entry>
<entry align="left" valign="top"><simpara>2ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.delete_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>idto</literal>, <literal>indexingDeleteTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of
deletion operations</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.index_current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>iic</literal>, <literal>indexingIndexCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number
of current indexing operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.index_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>iiti</literal>, <literal>indexingIndexTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in
indexing</simpara></entry>
<entry align="left" valign="top"><simpara>134ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>indexing.index_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>iito</literal>, <literal>indexingIndexTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of
indexing operations</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mc</literal>, <literal>mergesCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of current
merge operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.current_docs</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mcd</literal>, <literal>mergesCurrentDocs</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of
current merging documents</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.current_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mcs</literal>, <literal>mergesCurrentSize</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Size of current
merges</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mt</literal>, <literal>mergesTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of completed merge
operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.total_docs</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mtd</literal>, <literal>mergesTotalDocs</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of merged
documents</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.total_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mts</literal>, <literal>mergesTotalSize</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Size of current
merges</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>merges.total_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mtt</literal>, <literal>mergesTotalTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent merging
documents</simpara></entry>
<entry align="left" valign="top"><simpara>0s</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate.current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>pc</literal>, <literal>percolateCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of current
percolations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate.memory_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>pm</literal>, <literal>percolateMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Memory used by
current percolations</simpara></entry>
<entry align="left" valign="top"><simpara>0b</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate.queries</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>pq</literal>, <literal>percolateQueries</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of
registered percolation queries</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate.time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>pti</literal>, <literal>percolateTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent
percolating</simpara></entry>
<entry align="left" valign="top"><simpara>0s</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate.total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>pto</literal>, <literal>percolateTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Total percolations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>refresh.total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rto</literal>, <literal>refreshTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of refreshes</simpara></entry>
<entry align="left" valign="top"><simpara>16</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>refresh.time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>rti</literal>, <literal>refreshTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in refreshes</simpara></entry>
<entry align="left" valign="top"><simpara>91ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>script.compilations</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>scrcc</literal>, <literal>scriptCompilations</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Total script compilations</simpara></entry>
<entry align="left" valign="top"><simpara>17</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>script.cache_evictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>scrce</literal>, <literal>scriptCacheEvictions</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Total compiled scripts evicted from cache</simpara></entry>
<entry align="left" valign="top"><simpara>6</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.fetch_current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sfc</literal>, <literal>searchFetchCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Current fetch
phase operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.fetch_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sfti</literal>, <literal>searchFetchTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in fetch
phase</simpara></entry>
<entry align="left" valign="top"><simpara>37ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.fetch_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sfto</literal>, <literal>searchFetchTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of fetch
operations</simpara></entry>
<entry align="left" valign="top"><simpara>7</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.open_contexts</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>so</literal>, <literal>searchOpenContexts</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Open search
contexts</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.query_current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sqc</literal>, <literal>searchFetchCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Current query
phase operations</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.query_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sqti</literal>, <literal>searchFetchTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time spent in query
phase</simpara></entry>
<entry align="left" valign="top"><simpara>43ms</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.query_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sqto</literal>, <literal>searchFetchTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of query
operations</simpara></entry>
<entry align="left" valign="top"><simpara>9</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.scroll_current</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>scc</literal>, <literal>searchScrollCurrent</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Open scroll contexts</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.scroll_time</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>scti</literal>, <literal>searchScrollTime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Time scroll contexts held open</simpara></entry>
<entry align="left" valign="top"><simpara>2m</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search.scroll_total</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>scto</literal>, <literal>searchScrollTotal</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Completed scroll contexts</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>segments.count</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sc</literal>, <literal>segmentsCount</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Number of segments</simpara></entry>
<entry align="left" valign="top"><simpara>4</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>segments.memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sm</literal>, <literal>segmentsMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Memory used by
segments</simpara></entry>
<entry align="left" valign="top"><simpara>1.4kb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>segments.index_writer_memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>siwm</literal>, <literal>segmentsIndexWriterMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Memory used by index writer</simpara></entry>
<entry align="left" valign="top"><simpara>18mb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>segments.index_writer_max_memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>siwmx</literal>, <literal>segmentsIndexWriterMaxMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Maximum memory index writer may use before it must write buffered documents to a new segment</simpara></entry>
<entry align="left" valign="top"><simpara>32mb</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>segments.version_map_memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>svmm</literal>, <literal>segmentsVersionMapMemory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>No</simpara></entry>
<entry align="left" valign="top"><simpara>Memory used by version map</simpara></entry>
<entry align="left" valign="top"><simpara>1.0kb</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</chapter>
<chapter id="cat-pending-tasks">
<title>cat pending tasks<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/pending_tasks.asciidoc">Edit me</ulink></title>
<simpara><literal>pending_tasks</literal> provides the same information as the
<link linkend="cluster-pending"><literal>/_cluster/pending_tasks</literal></link> API in a
convenient tabular format.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/pending_tasks?v'
insertOrder timeInQueue priority source
       1685       855ms HIGH     update-mapping [foo][t]
       1686       843ms HIGH     update-mapping [foo][t]
       1693       753ms HIGH     refresh-mapping [foo][[t]]
       1688       816ms HIGH     update-mapping [foo][t]
       1689       802ms HIGH     update-mapping [foo][t]
       1690       787ms HIGH     update-mapping [foo][t]
       1691       773ms HIGH     update-mapping [foo][t]</programlisting>
</chapter>
<chapter id="cat-plugins">
<title>cat plugins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/plugins.asciidoc">Edit me</ulink></title>
<simpara>The <literal>plugins</literal> command provides a view per node of running plugins. This information <emphasis role="strong">spans nodes</emphasis>.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/plugins?v'
name    component       version        type isolation url
Abraxas cloud-azure     2.2.0-SNAPSHOT j    x
Abraxas lang-groovy     2.2.0          j    x
Abraxas lang-javascript 2.2.0-SNAPSHOT j    x
Abraxas marvel          NA             j/s  x         /_plugin/marvel/
Abraxas lang-python     2.2.0-SNAPSHOT j    x
Abraxas inquisitor      NA             s              /_plugin/inquisitor/
Abraxas kopf            0.5.2          s              /_plugin/kopf/
Abraxas segmentspy      NA             s              /_plugin/segmentspy/</programlisting>
<simpara>We can tell quickly how many plugins per node we have and which versions.</simpara>
</chapter>
<chapter id="cat-recovery">
<title>cat recovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/recovery.asciidoc">Edit me</ulink></title>
<simpara>The <literal>recovery</literal> command is a view of index shard recoveries, both on-going and previously
completed. It is a more compact view of the JSON <link linkend="indices-recovery">recovery</link> API.</simpara>
<simpara>A recovery event occurs anytime an index shard moves to a different node in the cluster.
This can happen during a snapshot recovery, a change in replication level, node failure, or
on node startup. This last type is called a local store recovery and is the normal
way for shards to be loaded from disk when a node starts up.</simpara>
<simpara>As an example, here is what the recovery state of a cluster may look like when there
are no shards in transit from one node to another:</simpara>
<programlisting language="sh" linenumbering="unnumbered">&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type    stage source target files percent bytes     percent
wiki  0     73   store done  hostA  hostA  36    100.0%  24982806 100.0%
wiki  1     245  store done  hostA  hostA  33    100.0%  24501912 100.0%
wiki  2     230  store done  hostA  hostA  36    100.0%  30267222 100.0%</programlisting>
<simpara>In the above case, the source and target nodes are the same because the recovery
type was store, i.e. they were read from local storage on node start.</simpara>
<simpara>Now let&#8217;s see what a live recovery looks like. By increasing the replica count
of our index and bringing another node online to host the replicas, we can see
what a live shard recovery looks like.</simpara>
<programlisting language="sh" linenumbering="unnumbered">&gt; curl -XPUT 'localhost:9200/wiki/_settings' -d'{"number_of_replicas":1}'
{"acknowledged":true}

&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type    stage source target files percent bytes    percent
wiki  0     1252 store done  hostA  hostA  4     100.0%  23638870 100.0%
wiki  0     1672 replica index hostA  hostB  4     75.0%   23638870 48.8%
wiki  1     1698 replica index hostA  hostB  4     75.0%   23348540 49.4%
wiki  1     4812 store done  hostA  hostA  33    100.0%  24501912 100.0%
wiki  2     1689 replica index hostA  hostB  4     75.0%   28681851 40.2%
wiki  2     5317 store done  hostA  hostA  36    100.0%  30267222 100.0%</programlisting>
<simpara>We can see in the above listing that our 3 initial shards are in various stages
of being replicated from one node to another. Notice that the recovery type is
shown as <literal>replica</literal>. The files and bytes copied are real-time measurements.</simpara>
<simpara>Finally, let&#8217;s see what a snapshot recovery looks like. Assuming I have previously
made a backup of my index, I can restore it using the <link linkend="modules-snapshots">snapshot and restore</link>
API.</simpara>
<programlisting language="sh" linenumbering="unnumbered">&gt; curl -XPOST 'localhost:9200/_snapshot/imdb/snapshot_2/_restore'
{"acknowledged":true}
&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type     stage repository snapshot files percent bytes percent
imdb  0     1978 snapshot done  imdb       snap_1   79    8.0%    12086 9.0%
imdb  1     2790 snapshot index imdb       snap_1   88    7.7%    11025 8.1%
imdb  2     2790 snapshot index imdb       snap_1   85    0.0%    12072 0.0%
imdb  3     2796 snapshot index imdb       snap_1   85    2.4%    12048 7.2%
imdb  4     819  snapshot init  imdb       snap_1   0     0.0%    0     0.0%</programlisting>
</chapter>
<chapter id="cat-repositories">
<title>cat repositories<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/repositories.asciidoc">Edit me</ulink></title>
<simpara>The <literal>repositories</literal> command shows the snapshot repositories registered in the cluster.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/repositories?v'
id    type
repo1   fs
repo2   s3</programlisting>
<simpara>We can quickly see which repositories are registered and their type.</simpara>
</chapter>
<chapter id="cat-thread-pool">
<title>cat thread pool<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/thread_pool.asciidoc">Edit me</ulink></title>
<simpara>The <literal>thread_pool</literal> command shows cluster wide thread pool statistics per node. By default the active, queue and rejected
statistics are returned for the bulk, index and search thread pools.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/thread_pool
host1 192.168.1.35 0 0 0 0 0 0 0 0 0
host2 192.168.1.36 0 0 0 0 0 0 0 0 0</programlisting>
<simpara>The first two columns contain the host and ip of a node.</simpara>
<programlisting language="sh" linenumbering="unnumbered">host      ip
host1 192.168.1.35
host2 192.168.1.36</programlisting>
<simpara>The next three columns show the active queue and rejected statistics for the bulk thread pool.</simpara>
<programlisting language="sh" linenumbering="unnumbered">bulk.active bulk.queue bulk.rejected
          0          0             0</programlisting>
<simpara>The remaining columns show the active queue and rejected statistics of the index and search thread pool respectively.</simpara>
<simpara>Also other statistics of different thread pools can be retrieved by using the <literal>h</literal> (header) parameter.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/thread_pool?v&amp;h=id,host,suggest.active,suggest.rejected,suggest.completed'
host      suggest.active suggest.rejected suggest.completed
host1                  0                0                 0
host2                  0                0                 0</programlisting>
<simpara>Here the host columns and the active, rejected and completed suggest thread pool statistic are displayed. The suggest
thread pool won&#8217;t be displayed by default, so you always need to be specific about what statistic you want to display.</simpara>
<bridgehead id="_available_thread_pools" renderas="sect2">Available Thread Pools<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/thread_pool.asciidoc">Edit me</ulink></bridgehead>
<simpara>Currently available <link linkend="modules-threadpool">thread pools</link>:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Thread Pool </entry>
<entry align="left" valign="top">Alias </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>bulk</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>b</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="docs-bulk">bulk</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>flush</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>f</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="indices-flush">flush</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>generic</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>ge</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for generic operations (e.g. background node discovery)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>get</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>g</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="docs-get">get</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>index</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>i</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="docs-index_">index</link>/<link linkend="docs-delete">delete</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>management</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>ma</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for management of Elasticsearch (e.g. cluster management)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>force_merge</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>fm</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="indices-forcemerge">force merge</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>percolate</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="search-percolate">percolator</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>refresh</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>r</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="indices-refresh">refresh</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>s</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="search-search">search</link>/<link linkend="search-count">count</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>snapshot</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>sn</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="modules-snapshots">snapshot</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>suggest</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>su</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="search-suggesters">suggester</link> operations</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>warmer</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>w</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Thread pool used for <link linkend="indices-warmers">index warm-up</link> operations</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The thread pool name (or alias) must be combined with a thread pool field below
to retrieve the requested information.</simpara>
<bridgehead id="_thread_pool_fields" renderas="sect3">Thread Pool Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/thread_pool.asciidoc">Edit me</ulink></bridgehead>
<simpara>For each thread pool, you can load details about it by using the field names
in the table below, either using the full field name (e.g. <literal>bulk.active</literal>) or
its alias (e.g. <literal>sa</literal> is equivalent to <literal>search.active</literal>).</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name </entry>
<entry align="left" valign="top">Alias </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>t</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The current (*) type of thread pool (<literal>cached</literal>, <literal>fixed</literal> or <literal>scaling</literal>)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>active</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>a</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of active threads in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>size</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>s</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of threads in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>queue</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>q</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of tasks in the queue for the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>queueSize</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>qs</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum number of tasks in the queue for the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>rejected</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>r</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of rejected threads in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>largest</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>l</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The highest number of active threads in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>completed</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>c</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The number of completed threads in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>min</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>mi</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The configured minimum number of active threads allowed in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>ma</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The configured maximum number of active threads allowed in the current thread pool</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>keepAlive</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>k</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The configured keep alive time for threads</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_other_fields" renderas="sect2">Other Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/thread_pool.asciidoc">Edit me</ulink></bridgehead>
<simpara>In addition to details about each thread pool, it is also convenient to get an
understanding of where those thread pools reside.  As such, you can request
other details like the <literal>ip</literal> of the responding node(s).</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name </entry>
<entry align="left" valign="top">Alias </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>id</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>nodeId</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The unique node ID</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pid</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The process ID of the running node</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>host</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>h</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The hostname for the current node</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ip</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>i</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The IP address for the current node</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>port</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>po</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The bound transport port for the current node</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</chapter>
<chapter id="cat-shards">
<title>cat shards<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/shards.asciidoc">Edit me</ulink></title>
<simpara>The <literal>shards</literal> command is the detailed view of what nodes contain which
shards.  It will tell you if it&#8217;s a primary or replica, the number of
docs, the bytes it takes on disk, and the node where it&#8217;s located.</simpara>
<simpara>Here we see a single index, with three primary shards and no replicas:</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED 3014 31.1mb 192.168.56.10 Stiletto
wiki1 1 p STARTED 3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED 3973 38.1mb 192.168.56.20 Commander Kraken</programlisting>
<bridgehead id="index-pattern" renderas="sect2">Index pattern<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/shards.asciidoc">Edit me</ulink></bridgehead>
<simpara>If you have many shards, you may wish to limit which indices show up
in the output.  You can always do this with <literal>grep</literal>, but you can save
some bandwidth by supplying an index pattern to the end.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.20:9200/_cat/shards/wiki2
wiki2 0 p STARTED 197 3.2mb 192.168.56.10 Stiletto
wiki2 1 p STARTED 205 5.9mb 192.168.56.30 Frankie Raye
wiki2 2 p STARTED 275 7.8mb 192.168.56.20 Commander Kraken</programlisting>
<bridgehead id="relocation" renderas="sect2">Relocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/shards.asciidoc">Edit me</ulink></bridgehead>
<simpara>Let&#8217;s say you&#8217;ve checked your health and you see two relocating
shards.  Where are they from and where are they going?</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 192.168.56.10:9200/_cat/health
1384315316 20:01:56 foo green 3 3 12 6 2 0 0
% curl 192.168.56.10:9200/_cat/shards | fgrep RELO
wiki1 0 r RELOCATING 3014 31.1mb 192.168.56.20 Commander Kraken -&gt; 192.168.56.30 Frankie Raye
wiki1 1 r RELOCATING 3013 29.6mb 192.168.56.10 Stiletto -&gt; 192.168.56.30 Frankie Raye</programlisting>
<bridgehead id="states" renderas="sect2">Shard states<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/shards.asciidoc">Edit me</ulink></bridgehead>
<simpara>Before a shard can be used, it goes through an <literal>INITIALIZING</literal> state.
<literal>shards</literal> can show you which ones.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":1}'
{"acknowledged":true}
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED      3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r INITIALIZING    0 14.3mb 192.168.56.30 Frankie Raye
wiki1 1 p STARTED      3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r INITIALIZING    0 13.1mb 192.168.56.20 Commander Kraken
wiki1 2 r INITIALIZING    0   14mb 192.168.56.10 Stiletto
wiki1 2 p STARTED      3973 38.1mb 192.168.56.20 Commander Kraken</programlisting>
<simpara>If a shard cannot be assigned, for example you&#8217;ve overallocated the
number of replicas for the number of nodes in the cluster, the shard
will remain <literal>UNASSIGNED</literal> with the <link linkend="reason-unassigned">reason code</link> <literal>ALLOCATION_FAILED</literal>.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":3}'
% curl 192.168.56.20:9200/_cat/health
1384316325 20:18:45 foo yellow 3 3 9 3 0 0 3
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED    3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r STARTED    3014 31.1mb 192.168.56.30 Frankie Raye
wiki1 0 r STARTED    3014 31.1mb 192.168.56.20 Commander Kraken
wiki1 0 r UNASSIGNED ALLOCATION_FAILED
wiki1 1 r STARTED    3013 29.6mb 192.168.56.10 Stiletto
wiki1 1 p STARTED    3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r STARTED    3013 29.6mb 192.168.56.20 Commander Kraken
wiki1 1 r UNASSIGNED ALLOCATION_FAILED
wiki1 2 r STARTED    3973 38.1mb 192.168.56.10 Stiletto
wiki1 2 r STARTED    3973 38.1mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED    3973 38.1mb 192.168.56.20 Commander Kraken
wiki1 2 r UNASSIGNED ALLOCATION_FAILED</programlisting>
<bridgehead id="reason-unassigned" renderas="sect2">Reasons for unassigned shard<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/shards.asciidoc">Edit me</ulink></bridgehead>
<simpara>These are the possible reasons for a shard be in a unassigned state:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>INDEX_CREATED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of an API creation of an index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>CLUSTER_RECOVERED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of a full cluster recovery.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>INDEX_REOPENED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of opening a closed index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>DANGLING_INDEX_IMPORTED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of importing a dangling index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>NEW_INDEX_RESTORED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of restoring into a new index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>EXISTING_INDEX_RESTORED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of restoring into a closed index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>REPLICA_ADDED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of explicit addition of a replica.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ALLOCATION_FAILED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of a failed allocation of the shard.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>NODE_LEFT</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of the node hosting it leaving the cluster.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>REROUTE_CANCELLED</literal>
</simpara>
</entry>
<entry>
<simpara>
Unassigned as a result of explicit cancel reroute command.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>REINITIALIZED</literal>
</simpara>
</entry>
<entry>
<simpara>
When a shard moves from started back to initializing, for example, with shadow replicas.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>REALLOCATED_REPLICA</literal>
</simpara>
</entry>
<entry>
<simpara>
A better replica location is identified and causes the existing replica allocation to be cancelled.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
<chapter id="cat-segments">
<title>cat segments<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/segments.asciidoc">Edit me</ulink></title>
<simpara>The <literal>segments</literal> command provides low level information about the segments
in the shards of an index. It provides information similar to the
<ulink url="indices-segments.html">_segments</ulink> endpoint.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'http://localhost:9200/_cat/segments?v'
index shard prirep ip            segment generation docs.count [...]
test  4     p      192.168.2.105 _0               0          1
test1 2     p      192.168.2.105 _0               0          1
test1 3     p      192.168.2.105 _2               2          1</programlisting>
<programlisting language="sh" linenumbering="unnumbered">[...] docs.deleted  size size.memory committed searchable version compound
                 0 2.9kb        7818 false     true       4.10.2  true
                 0 2.9kb        7818 false     true       4.10.2  true
                 0 2.9kb        7818 false     true       4.10.2  true</programlisting>
<simpara>The output shows information about index names and shard numbers in the first
two columns.</simpara>
<simpara>If you only want to get information about segments in one particular index,
you can add the index name in the URL, for example <literal>/_cat/segments/test</literal>. Also,
several indexes can be queried like <literal>/_cat/segments/test,test1</literal></simpara>
<simpara>The following columns provide additional monitoring information:</simpara>
<variablelist>
<varlistentry>
<term>
prirep
</term>
<listitem>
<simpara>
Whether this segment belongs to a primary or replica shard.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
ip
</term>
<listitem>
<simpara>
The ip address of the segments shard.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
segment
</term>
<listitem>
<simpara>
A segment name, derived from the segment generation. The name
                is internally used to generate the file names in the directory
                of the shard this segment belongs to.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
generation
</term>
<listitem>
<simpara>
The generation number is incremented with each segment that is written.
                The name of the segment is derived from this generation number.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
docs.count
</term>
<listitem>
<simpara>
The number of non-deleted documents that are stored in this segment.
                Note that these are Lucene documents, so the count will include hidden
                                documents (e.g. from nested types).
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
docs.deleted
</term>
<listitem>
<simpara>
The number of deleted documents that are stored in this segment.
                It is perfectly fine if this number is greater than 0, space is
                going to be reclaimed when this segment gets merged.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
size
</term>
<listitem>
<simpara>
The amount of disk space that this segment uses.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
size.memory
</term>
<listitem>
<simpara>
Segments store some data into memory in order to be searchable efficiently.
                This column shows the number of bytes in memory that are used.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
committed
</term>
<listitem>
<simpara>
Whether the segment has been sync&#8217;ed on disk. Segments that are
                committed would survive a hard reboot. No need to worry in case
                of false, the data from uncommitted segments is also stored in
                the transaction log so that Elasticsearch is able to replay
                changes on the next start.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
searchable
</term>
<listitem>
<simpara>
True if the segment is searchable. A value of false would most
                likely mean that the segment has been written to disk but no
                refresh occurred since then to make it searchable.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
version
</term>
<listitem>
<simpara>
The version of Lucene that has been used to write this segment.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
compound
</term>
<listitem>
<simpara>
Whether the segment is stored in a compound file. When true, this
                means that Lucene merged all files from the segment in a single
                one in order to save file descriptors.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="cat-snapshots">
<title>cat snapshots<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cat/snapshots.asciidoc">Edit me</ulink></title>
<simpara>The <literal>snapshots</literal> command shows all snapshots that belong to a specific repository.
To find a list of available repositories to query, the command <literal>/_cat/repositories</literal> can be used.
Querying the snapshots of a repository named <literal>repo1</literal> then looks as follows.</simpara>
<programlisting language="sh" linenumbering="unnumbered">% curl 'localhost:9200/_cat/snapshots/repo1?v'
id     status start_epoch start_time end_epoch  end_time duration indices successful_shards failed_shards total_shards
snap1  FAILED 1445616705  18:11:45   1445616978 18:16:18     4.6m       1                 4             1            5
snap2 SUCCESS 1445634298  23:04:58   1445634672 23:11:12     6.2m       2                10             0           10</programlisting>
<simpara>Each snapshot contains information about when it was started and stopped.
Start and stop timestamps are available in two formats.
The <literal>HH:MM:SS</literal> output is simply for quick human consumption.
The epoch time retains more information, including date, and is machine sortable if the snapshot process spans days.</simpara>
</chapter>
</part>
<part id="cluster">
<title>Cluster APIs <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster.asciidoc">Edit me</ulink></title>
<partintro>
<bridgehead id="cluster-nodes" renderas="sect1">Node specification<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most cluster level APIs allow to specify which nodes to execute on (for
example, getting the node stats for a node). Nodes can be identified in
the APIs either using their internal node id, the node name, address,
custom attributes, or just the <literal>_local</literal> node receiving the request. For
example, here are some sample executions of nodes info:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Local
curl localhost:9200/_nodes/_local
# Address
curl localhost:9200/_nodes/10.0.0.3,10.0.0.4
curl localhost:9200/_nodes/10.0.0.*
# Names
curl localhost:9200/_nodes/node_name_goes_here
curl localhost:9200/_nodes/node_name_goes_*
# Attributes (set something like node.rack: 2 in the config)
curl localhost:9200/_nodes/rack:2
curl localhost:9200/_nodes/ra*:2
curl localhost:9200/_nodes/ra*:2*</programlisting>
</partintro>
<chapter id="cluster-health">
<title>Cluster Health<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/health.asciidoc">Edit me</ulink></title>
<simpara>The cluster health API allows to get a very simple status on the health
of the cluster.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/health?pretty=true'
{
  "cluster_name" : "testcluster",
  "status" : "green",
  "timed_out" : false,
  "number_of_nodes" : 2,
  "number_of_data_nodes" : 2,
  "active_primary_shards" : 5,
  "active_shards" : 10,
  "relocating_shards" : 0,
  "initializing_shards" : 0,
  "unassigned_shards" : 0,
  "delayed_unassigned_shards": 0,
  "number_of_pending_tasks" : 0,
  "number_of_in_flight_fetch": 0,
  "task_max_waiting_in_queue_millis": 0,
  "active_shards_percent_as_number": 100
}</programlisting>
<simpara>The API can also be executed against one or more indices to get just the
specified indices health:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/health/test1,test2'</programlisting>
<simpara>The cluster health status is: <literal>green</literal>, <literal>yellow</literal> or <literal>red</literal>. On the shard
level, a <literal>red</literal> status indicates that the specific shard is not allocated
in the cluster, <literal>yellow</literal> means that the primary shard is allocated but
replicas are not, and <literal>green</literal> means that all shards are allocated. The
index level status is controlled by the worst shard status. The cluster
status is controlled by the worst index status.</simpara>
<simpara>One of the main benefits of the API is the ability to wait until the
cluster reaches a certain high water-mark health level. For example, the
following will wait for 50 seconds for the cluster to reach the <literal>yellow</literal>
level (if it reaches the <literal>green</literal> or <literal>yellow</literal> status before 50 seconds elapse,
it will return at that point):</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/health?wait_for_status=yellow&amp;timeout=50s'</programlisting>
<bridgehead id="request-params" renderas="sect2">Request Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/health.asciidoc">Edit me</ulink></bridgehead>
<simpara>The cluster health API accepts the following request parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>level</literal>
</term>
<listitem>
<simpara>
    Can be one of <literal>cluster</literal>, <literal>indices</literal> or <literal>shards</literal>. Controls the
    details level of the health information returned. Defaults to <literal>cluster</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>wait_for_status</literal>
</term>
<listitem>
<simpara>
    One of <literal>green</literal>, <literal>yellow</literal> or <literal>red</literal>. Will wait (until
    the timeout provided) until the status of the cluster changes to the one
    provided or better, i.e. <literal>green</literal> &gt; <literal>yellow</literal> &gt; <literal>red</literal>. By default, will not
    wait for any status.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>wait_for_relocating_shards</literal>
</term>
<listitem>
<simpara>
    A number controlling to how many relocating
    shards to wait for. Usually will be <literal>0</literal> to indicate to wait till all
    relocations have happened. Defaults to not wait.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>wait_for_active_shards</literal>
</term>
<listitem>
<simpara>
    A number controlling to how many active
    shards to wait for. Defaults to not wait.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>wait_for_nodes</literal>
</term>
<listitem>
<simpara>
    The request waits until the specified number <literal>N</literal> of
    nodes is available. It also accepts <literal>&gt;=N</literal>, <literal>&lt;=N</literal>, <literal>&gt;N</literal> and <literal>&lt;N</literal>.
    Alternatively, it is possible to use <literal>ge(N)</literal>, <literal>le(N)</literal>, <literal>gt(N)</literal> and
    <literal>lt(N)</literal> notation.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>timeout</literal>
</term>
<listitem>
<simpara>
    A time based parameter controlling how long to wait if one of
    the wait_for_XXX are provided. Defaults to <literal>30s</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>local</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> returns the local node information and does not provide
    the state from master node. Default: <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The following is an example of getting the cluster health at the
<literal>shards</literal> level:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/health/twitter?level=shards'</programlisting>
</chapter>
<chapter id="cluster-state">
<title>Cluster State<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/state.asciidoc">Edit me</ulink></title>
<simpara>The cluster state API allows to get a comprehensive state information of
the whole cluster.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/state'</programlisting>
<simpara>By default, the cluster state request is routed to the master node, to
ensure that the latest cluster state is returned.
For debugging purposes, you can retrieve the cluster state local to a
particular node by adding <literal>local=true</literal> to the  query string.</simpara>
<bridgehead id="_response_filters" renderas="sect2">Response Filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/state.asciidoc">Edit me</ulink></bridgehead>
<simpara>As the cluster state can grow (depending on the number of shards and indices, your mapping, templates),
it is possible to filter the cluster state response specifying the parts in the URL.</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/state/{metrics}/{indices}'</programlisting>
<simpara><literal>metrics</literal> can be a comma-separated list of</simpara>
<variablelist>
<varlistentry>
<term>
<literal>version</literal>
</term>
<listitem>
<simpara>
    Shows the cluster state version.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>master_node</literal>
</term>
<listitem>
<simpara>
    Shows the elected <literal>master_node</literal> part of the response
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>nodes</literal>
</term>
<listitem>
<simpara>
    Shows the <literal>nodes</literal> part of the response
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>routing_table</literal>
</term>
<listitem>
<simpara>
    Shows the <literal>routing_table</literal> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>metadata</literal>
</term>
<listitem>
<simpara>
    Shows the <literal>metadata</literal> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>blocks</literal>
</term>
<listitem>
<simpara>
    Shows the <literal>blocks</literal> part of the response
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>A couple of example calls:</simpara>
<programlisting language="js" linenumbering="unnumbered"># return only metadata and routing_table data for specified indices
$ curl -XGET 'http://localhost:9200/_cluster/state/metadata,routing_table/foo,bar'

# return everything for these two indices
$ curl -XGET 'http://localhost:9200/_cluster/state/_all/foo,bar'

# Return only blocks data
$ curl -XGET 'http://localhost:9200/_cluster/state/blocks'</programlisting>
</chapter>
<chapter id="cluster-stats">
<title>Cluster Stats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/stats.asciidoc">Edit me</ulink></title>
<simpara>The Cluster Stats API allows to retrieve statistics from a cluster wide perspective.
The API returns basic index metrics (shard numbers, store size, memory usage) and
information about the current nodes that form the cluster (number, roles, os, jvm
versions, memory usage, cpu and installed plugins).</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_cluster/stats?human&amp;pretty'</programlisting>
<simpara>Will return, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "timestamp": 1439326129256,
   "cluster_name": "elasticsearch",
   "status": "green",
   "indices": {
      "count": 3,
      "shards": {
         "total": 35,
         "primaries": 15,
         "replication": 1.333333333333333,
         "index": {
            "shards": {
               "min": 10,
               "max": 15,
               "avg": 11.66666666666666
            },
            "primaries": {
               "min": 5,
               "max": 5,
               "avg": 5
            },
            "replication": {
               "min": 1,
               "max": 2,
               "avg": 1.3333333333333333
            }
         }
      },
      "docs": {
         "count": 2,
         "deleted": 0
      },
      "store": {
         "size": "5.6kb",
         "size_in_bytes": 5770,
         "throttle_time": "0s",
         "throttle_time_in_millis": 0
      },
      "fielddata": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "query_cache": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "completion": {
         "size": "0b",
         "size_in_bytes": 0
      },
      "segments": {
         "count": 2,
         "memory": "6.4kb",
         "memory_in_bytes": 6596,
         "index_writer_memory": "0b",
         "index_writer_memory_in_bytes": 0,
         "index_writer_max_memory": "275.7mb",
         "index_writer_max_memory_in_bytes": 289194639,
         "version_map_memory": "0b",
         "version_map_memory_in_bytes": 0,
         "fixed_bit_set": "0b",
         "fixed_bit_set_memory_in_bytes": 0
      },
      "percolate": {
         "total": 0,
         "get_time": "0s",
         "time_in_millis": 0,
         "current": 0,
         "memory_size_in_bytes": -1,
         "memory_size": "-1b",
         "queries": 0
      }
   },
   "nodes": {
      "count": {
         "total": 2,
         "master_only": 0,
         "data_only": 0,
         "master_data": 2,
         "client": 0
      },
      "versions": [
         "2.4.2"
      ],
      "os": {
         "available_processors": 4,
         "mem": {
            "total": "8gb",
            "total_in_bytes": 8589934592
         },
         "names": [
            {
               "name": "Mac OS X",
               "count": 1
            }
         ],
         "cpu": [
            {
               "vendor": "Intel",
               "model": "MacBookAir5,2",
               "mhz": 2000,
               "total_cores": 4,
               "total_sockets": 4,
               "cores_per_socket": 16,
               "cache_size": "256b",
               "cache_size_in_bytes": 256,
               "count": 1
            }
         ]
      },
      "process": {
         "cpu": {
            "percent": 3
         },
         "open_file_descriptors": {
            "min": 200,
            "max": 346,
            "avg": 273
         }
      },
      "jvm": {
         "max_uptime": "24s",
         "max_uptime_in_millis": 24054,
         "versions": [
            {
               "version": "1.6.0_45",
               "vm_name": "Java HotSpot(TM) 64-Bit Server VM",
               "vm_version": "20.45-b01-451",
               "vm_vendor": "Apple Inc.",
               "count": 2
            }
         ],
         "mem": {
            "heap_used": "38.3mb",
            "heap_used_in_bytes": 40237120,
            "heap_max": "1.9gb",
            "heap_max_in_bytes": 2130051072
         },
         "threads": 89
      },
      "fs":
         {
            "total": "232.9gb",
            "total_in_bytes": 250140434432,
            "free": "31.3gb",
            "free_in_bytes": 33705881600,
            "available": "31.1gb",
            "available_in_bytes": 33443737600,
            "disk_reads": 21202753,
            "disk_writes": 27028840,
            "disk_io_op": 48231593,
            "disk_read_size": "528gb",
            "disk_read_size_in_bytes": 566980806656,
            "disk_write_size": "617.9gb",
            "disk_write_size_in_bytes": 663525366784,
            "disk_io_size": "1145.9gb",
            "disk_io_size_in_bytes": 1230506173440
       },
      "plugins": [
         // all plugins installed on nodes
         {
            "name": "inquisitor",
            "description": "",
            "url": "/_plugin/inquisitor/",
            "jvm": false,
            "site": true
         }
      ]
   }
}</programlisting>
</chapter>
<chapter id="cluster-pending">
<title>Pending cluster tasks<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/pending.asciidoc">Edit me</ulink></title>
<simpara>The pending cluster tasks API returns a list of any cluster-level changes
(e.g. create index, update mapping, allocate or fail shard) which have not yet
been executed.</simpara>
<note><simpara>This API returns a list of any pending updates to the cluster state. These are distinct from the tasks reported by the
<link linkend="tasks">Task Management API</link> which include periodic tasks and tasks initiated by the user, such as node stats, search queries, or create
index requests. However, if a user-initiated task such as a create index command causes a cluster state update, the activity of this task
might be reported by both task api and pending cluster tasks API.</simpara></note>
<programlisting language="js" linenumbering="unnumbered">$ curl -XGET 'http://localhost:9200/_cluster/pending_tasks'</programlisting>
<simpara>Usually this will return an empty list as cluster-level changes are usually
fast. However if there are tasks queued up, the output will look something
like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
   "tasks": [
      {
         "insert_order": 101,
         "priority": "URGENT",
         "source": "create-index [foo_9], cause [api]",
         "time_in_queue_millis": 86,
         "time_in_queue": "86ms"
      },
      {
         "insert_order": 46,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][1], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from shard_store]",
         "time_in_queue_millis": 842,
         "time_in_queue": "842ms"
      },
      {
         "insert_order": 45,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][0], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from shard_store]",
         "time_in_queue_millis": 858,
         "time_in_queue": "858ms"
      }
  ]
}</programlisting>
</chapter>
<chapter id="cluster-reroute">
<title>Cluster Reroute<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/reroute.asciidoc">Edit me</ulink></title>
<simpara>The reroute command allows to explicitly execute a cluster reroute
allocation command including specific commands. For example, a shard can
be moved from one node to another explicitly, an allocation can be
canceled, or an unassigned shard can be explicitly allocated on a
specific node.</simpara>
<simpara>Here is a short example of how a simple reroute API call:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/_cluster/reroute' -d '{
    "commands" : [ {
        "move" :
            {
              "index" : "test", "shard" : 0,
              "from_node" : "node1", "to_node" : "node2"
            }
        },
        {
          "allocate" : {
              "index" : "test", "shard" : 1, "node" : "node3"
          }
        }
    ]
}'</programlisting>
<simpara>An important aspect to remember is the fact that once when an allocation
occurs, the cluster will aim at re-balancing its state back to an even
state. For example, if the allocation includes moving a shard from
<literal>node1</literal> to <literal>node2</literal>, in an <literal>even</literal> state, then another shard will be moved
from <literal>node2</literal> to <literal>node1</literal> to even things out.</simpara>
<simpara>The cluster can be set to disable allocations, which means that only the
explicitly allocations will be performed. Obviously, only once all
commands has been applied, the cluster will aim to be re-balance its
state.</simpara>
<simpara>Another option is to run the commands in <literal>dry_run</literal> (as a URI flag, or in
the request body). This will cause the commands to apply to the current
cluster state, and return the resulting cluster after the commands (and
re-balancing) has been applied.</simpara>
<simpara>If the <literal>explain</literal> parameter is specified, a detailed explanation of why the
commands could or could not be executed is returned.</simpara>
<simpara>The commands supported are:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>move</literal>
</term>
<listitem>
<simpara>
    Move a started shard from one node to another node. Accepts
    <literal>index</literal> and <literal>shard</literal> for index name and shard number, <literal>from_node</literal> for the
    node to move the shard <literal>from</literal>, and <literal>to_node</literal> for the node to move the
    shard to.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cancel</literal>
</term>
<listitem>
<simpara>
    Cancel allocation of a shard (or recovery). Accepts <literal>index</literal>
    and <literal>shard</literal> for index name and shard number, and <literal>node</literal> for the node to
    cancel the shard allocation on. It also accepts <literal>allow_primary</literal> flag to
    explicitly specify that it is allowed to cancel allocation for a primary
    shard.  This can be used to force resynchronization of existing replicas
    from the primary shard by cancelling them and allowing them to be
    reinitialized through the standard reallocation process.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>allocate</literal>
</term>
<listitem>
<simpara>
    Allocate an unassigned shard to a node. Accepts the
    <literal>index</literal> and <literal>shard</literal> for index name and shard number, and <literal>node</literal> to
    allocate the shard to. It also accepts <literal>allow_primary</literal> flag to
    explicitly specify that it is allowed to explicitly allocate a primary
    shard (might result in data loss).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<warning><simpara>The <literal>allow_primary</literal> parameter will force a new <emphasis>empty</emphasis> primary shard
to be allocated <emphasis role="strong">without any data</emphasis>. If a node which has a copy of the original
shard (including data) rejoins the cluster later on, that data will be
deleted: the old shard copy will be replaced by the new live shard copy.</simpara></warning>
</chapter>
<chapter id="cluster-update-settings">
<title>Cluster Update Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/update-settings.asciidoc">Edit me</ulink></title>
<simpara>Allows to update cluster wide specific settings. Settings updated can
either be persistent (applied cross restarts) or transient (will not
survive a full cluster restart). Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_cluster/settings -d '{
    "persistent" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</programlisting>
<simpara>Or:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</programlisting>
<simpara>The cluster responds with the settings updated. So the response for the
last example will be:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "persistent" : {},
    "transient" : {
        "discovery.zen.minimum_master_nodes" : "2"
    }
}'</programlisting>
<simpara>Cluster wide settings can be returned using:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_cluster/settings</programlisting>
<bridgehead id="_precedence_of_settings" renderas="sect2">Precedence of settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/update-settings.asciidoc">Edit me</ulink></bridgehead>
<simpara>Transient cluster settings take precedence over persistent cluster settings,
which take precedence over settings configured in the <literal>elasticsearch.yml</literal>
config file.</simpara>
<simpara>For this reason it is preferrable to  use the <literal>elasticsearch.yml</literal> file only
for local configurations, and set all cluster-wider settings with the
<literal>settings</literal> API.</simpara>
<simpara>A list of dynamically updatable settings can be found in the
<link linkend="modules">Modules</link> documentation.</simpara>
</chapter>
<chapter id="cluster-nodes-stats">
<title>Nodes Stats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></title>
<bridgehead id="_nodes_statistics" renderas="sect2">Nodes statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>The cluster nodes stats API allows to retrieve one or more (or all) of
the cluster nodes statistics.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_nodes/stats'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/stats'</programlisting>
<simpara>The first command retrieves stats of all the nodes in the cluster. The
second command selectively retrieves nodes stats of only <literal>nodeId1</literal> and
<literal>nodeId2</literal>. All the nodes selective options are explained
<link linkend="cluster-nodes">here</link>.</simpara>
<simpara>By default, all stats are returned. You can limit this by combining any
of <literal>indices</literal>, <literal>os</literal>, <literal>process</literal>, <literal>jvm</literal>, <literal>transport</literal>, <literal>http</literal>,
<literal>fs</literal>, <literal>breaker</literal> and <literal>thread_pool</literal>. For example:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>indices</literal>
</simpara>
</entry>
<entry>
<simpara>
        Indices stats about size, document count, indexing and
        deletion times, search times, field cache size, merges and flushes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fs</literal>
</simpara>
</entry>
<entry>
<simpara>
        File system information, data path, free disk space, read/write
        stats (see <link linkend="fs-info">FS information</link>)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>http</literal>
</simpara>
</entry>
<entry>
<simpara>
        HTTP connection information
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>jvm</literal>
</simpara>
</entry>
<entry>
<simpara>
        JVM stats, memory pool information, garbage collection, buffer
        pools, number of loaded/unloaded classes
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>os</literal>
</simpara>
</entry>
<entry>
<simpara>
        Operating system stats, load average, mem, swap
        (see <link linkend="os-stats">OS statistics</link>)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>process</literal>
</simpara>
</entry>
<entry>
<simpara>
        Process statistics, memory consumption, cpu usage, open
        file descriptors (see <link linkend="process-stats">Process statistics</link>)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>thread_pool</literal>
</simpara>
</entry>
<entry>
<simpara>
        Statistics about each thread pool, including current
        size, queue and rejected tasks
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>transport</literal>
</simpara>
</entry>
<entry>
<simpara>
        Transport statistics about sent and received bytes in
        cluster communication
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>breaker</literal>
</simpara>
</entry>
<entry>
<simpara>
        Statistics about the field data circuit breaker
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<programlisting language="js" linenumbering="unnumbered"># return indices and os
curl -XGET 'http://localhost:9200/_nodes/stats/os'
# return just os and process
curl -XGET 'http://localhost:9200/_nodes/stats/os,process'
# specific type endpoint
curl -XGET 'http://localhost:9200/_nodes/stats/process'
curl -XGET 'http://localhost:9200/_nodes/10.0.0.1/stats/process'</programlisting>
<simpara>All stats can be explicitly requested via <literal>/_nodes/stats/_all</literal> or <literal>/_nodes/stats?metric=_all</literal>.</simpara>
<bridgehead id="fs-info" renderas="sect3">FS information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>fs</literal> flag can be set to retrieve
information that concern the file system:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>fs.timestamp</literal>
</term>
<listitem>
<simpara>
        Last time the file stores statistics have been refreshed
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.total.total_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total size (in bytes) of all file stores
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.total.free_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total number of unallocated bytes in all file stores
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.total.available_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total number of bytes available to this Java virtual machine on all file stores
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data</literal>
</term>
<listitem>
<simpara>
        List of all file stores
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.path</literal>
</term>
<listitem>
<simpara>
        Path to the file store
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.mount</literal>
</term>
<listitem>
<simpara>
        Mount point of the file store (ex: /dev/sda2)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.type</literal>
</term>
<listitem>
<simpara>
        Type of the file store (ex: ext4)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.total_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total size (in bytes) of the file store
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.free_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total number of unallocated bytes in the file store
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.available_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total number of bytes available to this Java virtual machine on this file store
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fs.data.spins</literal> (Linux only)
</term>
<listitem>
<simpara>
        Indicates if the file store is backed by spinning storage.
        <literal>null</literal> means we could not determine it, <literal>true</literal> means the device possibly spins
         and <literal>false</literal> means it does not (ex: solid-state disks).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="os-stats" renderas="sect3">Operating System statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>os</literal> flag can be set to retrieve statistics that concern
the operating system:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>os.timestamp</literal>
</term>
<listitem>
<simpara>
        Last time the operating system statistics have been refreshed
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.percent</literal>
</term>
<listitem>
<simpara>
    Recent CPU usage for the whole system, or -1 if not supported
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.load_average</literal>
</term>
<listitem>
<simpara>
        System load average for the last minute, or -1 if not supported
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.mem.total_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total amount of physical memory in bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.mem.free_in_bytes</literal>
</term>
<listitem>
<simpara>
        Amount of free physical memory in bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.mem.free_percent</literal>
</term>
<listitem>
<simpara>
        Percentage of free memory
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.mem.used_in_bytes</literal>
</term>
<listitem>
<simpara>
        Amount of used physical memory in bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.mem.used_percent</literal>
</term>
<listitem>
<simpara>
        Percentage of used memory
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.swap.total_in_bytes</literal>
</term>
<listitem>
<simpara>
        Total amount of swap space in bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.swap.free_in_bytes</literal>
</term>
<listitem>
<simpara>
        Amount of free swap space in bytes
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.swap.used_in_bytes</literal>
</term>
<listitem>
<simpara>
        Amount of used swap space in bytes
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="process-stats" renderas="sect3">Process statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>process</literal> flag can be set to retrieve statistics that concern
the current running process:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>process.timestamp</literal>
</term>
<listitem>
<simpara>
        Last time the process statistics have been refreshed
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.open_file_descriptors</literal>
</term>
<listitem>
<simpara>
        Number of opened file descriptors associated with the current process, or -1 if not supported
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.max_file_descriptors</literal>
</term>
<listitem>
<simpara>
        Maximum number of file descriptors allowed on the system, or -1 if not supported
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.cpu.percent</literal>
</term>
<listitem>
<simpara>
        CPU usage in percent, or -1 if not known at the time the stats are computed
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.cpu.total_in_millis</literal>
</term>
<listitem>
<simpara>
        CPU time (in milliseconds) used by the process on which the Java virtual machine is running, or -1 if not supported
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.mem.total_virtual_in_bytes</literal>
</term>
<listitem>
<simpara>
        Size in bytes of virtual memory that is guaranteed to be available to the running process
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="field-data" renderas="sect2">Field data statistics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can get information about field data memory usage on node
level or on index level.</simpara>
<programlisting language="js" linenumbering="unnumbered"># Node Stats
curl -XGET 'http://localhost:9200/_nodes/stats/indices/?fields=field1,field2&amp;pretty'

# Indices Stat
curl -XGET 'http://localhost:9200/_stats/fielddata/?fields=field1,field2&amp;pretty'

# You can use wildcards for field names
curl -XGET 'http://localhost:9200/_stats/fielddata/?fields=field*&amp;pretty'
curl -XGET 'http://localhost:9200/_nodes/stats/indices/?fields=field*&amp;pretty'</programlisting>
<bridgehead id="search-groups" renderas="sect2">Search groups<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-stats.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can get statistics about search groups for searches executed
on this node.</simpara>
<programlisting language="js" linenumbering="unnumbered"># All groups with all stats
curl -XGET 'http://localhost:9200/_nodes/stats?pretty&amp;groups=_all'

# Some groups from just the indices stats
curl -XGET 'http://localhost:9200/_nodes/stats/indices?pretty&amp;groups=foo,bar'</programlisting>
</chapter>
<chapter id="cluster-nodes-info">
<title>Nodes Info<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-info.asciidoc">Edit me</ulink></title>
<simpara>The cluster nodes info API allows to retrieve one or more (or all) of
the cluster nodes information.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_nodes'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2'</programlisting>
<simpara>The first command retrieves information of all the nodes in the cluster.
The second command selectively retrieves nodes information of only
<literal>nodeId1</literal> and <literal>nodeId2</literal>. All the nodes selective options are explained
<link linkend="cluster-nodes">here</link>.</simpara>
<simpara>By default, it just returns all attributes and core settings for a node.
It also allows to get only information on <literal>settings</literal>, <literal>os</literal>, <literal>process</literal>, <literal>jvm</literal>,
<literal>thread_pool</literal>, <literal>transport</literal>, <literal>http</literal> and <literal>plugins</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET 'http://localhost:9200/_nodes/process'
curl -XGET 'http://localhost:9200/_nodes/_all/process'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/jvm,process'
# same as above
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/info/jvm,process'

curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/_all</programlisting>
<simpara>The <literal>_all</literal> flag can be set to return all the information - or you can simply omit it.</simpara>
<bridgehead id="os-info" renderas="sect3">Operating System information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-info.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>os</literal> flag can be set to retrieve information that concern
the operating system:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>os.refresh_interval_in_millis</literal>
</term>
<listitem>
<simpara>
        Refresh interval for the OS statistics
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.name</literal>
</term>
<listitem>
<simpara>
        Name of the operating system (ex: Linux, Windows, Mac OS X)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.arch</literal>
</term>
<listitem>
<simpara>
        Name of the JVM architecture (ex: amd64, x86)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.version</literal>
</term>
<listitem>
<simpara>
        Version of the operating system
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.available_processors</literal>
</term>
<listitem>
<simpara>
        Number of processors available to the Java virtual machine
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>os.allocated_processors</literal>
</term>
<listitem>
<simpara>
    The number of processors actually used to calculate thread pool size. This number can be set
    with the <literal>processors</literal> setting of a node and defaults to the number of processors reported by the OS.
    In both cases this number will never be larger than 32.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="process-info" renderas="sect3">Process information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-info.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>process</literal> flag can be set to retrieve information that concern
the current running process:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>process.refresh_interval_in_millis</literal>
</term>
<listitem>
<simpara>
        Refresh interval for the process statistics
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.id</literal>
</term>
<listitem>
<simpara>
        Process identifier (PID)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>process.mlockall</literal>
</term>
<listitem>
<simpara>
        Indicates if the process address space has been successfully locked in memory
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="plugins-info" renderas="sect3">Plugins information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-info.asciidoc">Edit me</ulink></bridgehead>
<simpara><literal>plugins</literal> - if set, the result will contain details about the loaded
plugins per node:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>name</literal>: plugin name
</simpara>
</listitem>
<listitem>
<simpara>
<literal>description</literal>: plugin description if any
</simpara>
</listitem>
<listitem>
<simpara>
<literal>site</literal>: <literal>true</literal> if the plugin is a site plugin
</simpara>
</listitem>
<listitem>
<simpara>
<literal>jvm</literal>: <literal>true</literal> if the plugin is a plugin running in the JVM
</simpara>
</listitem>
<listitem>
<simpara>
<literal>url</literal>: URL if the plugin is a site plugin
</simpara>
</listitem>
</itemizedlist>
<simpara>The result will look similar to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "cluster_name" : "test-cluster-MacBook-Air-de-David.local",
  "nodes" : {
    "hJLXmY_NTrCytiIMbX4_1g" : {
      "name" : "node4",
      "transport_address" : "inet[/172.18.58.139:9303]",
      "hostname" : "MacBook-Air-de-David.local",
      "version" : "0.90.0.Beta2-SNAPSHOT",
      "http_address" : "inet[/172.18.58.139:9203]",
      "plugins" : [ {
        "name" : "test-plugin",
        "description" : "test-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "test-no-version-plugin",
        "description" : "test-no-version-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "dummy",
        "description" : "No description found for dummy.",
        "url" : "/_plugin/dummy/",
        "site" : false,
        "jvm" : true
      } ]
    }
  }
}</programlisting>
</chapter>
<chapter id="tasks">
<title>Task Management API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/tasks.asciidoc">Edit me</ulink></title>
<warning role="experimental"><simpara>The Task Management API is new and should still be considered experimental.  The API may change in ways that are not backwards compatible.</simpara></warning>
<bridgehead id="_current_tasks_information" renderas="sect2">Current Tasks Information<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/tasks.asciidoc">Edit me</ulink></bridgehead>
<simpara>The task management API allows to retrieve information about the tasks currently
executing on one or more nodes in the cluster.</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_tasks <co id="CO125-1"/>
GET /_tasks?nodes=nodeId1,nodeId2 <co id="CO125-2"/>
GET /_tasks?nodes=nodeId1,nodeId2&amp;actions=cluster:* <co id="CO125-3"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO125-1">
<para>
Retrieves all tasks currently running on all nodes in the cluster.
</para>
</callout>
<callout arearefs="CO125-2">
<para>
Retrieves all tasks running on nodes <literal>nodeId1</literal> and <literal>nodeId2</literal>.  See <xref linkend="cluster-nodes"/> for more info about how to select individual nodes.
</para>
</callout>
<callout arearefs="CO125-3">
<para>
Retrieves all cluster-related tasks running on nodes <literal>nodeId1</literal> and <literal>nodeId2</literal>.
</para>
</callout>
</calloutlist>
<simpara>The result will look similar to the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "nodes" : {
    "oTUltX4IQMOUUVeiohTt8A" : {
      "name" : "Tamara Rahn",
      "transport_address" : "127.0.0.1:9300",
      "host" : "127.0.0.1",
      "ip" : "127.0.0.1:9300",
      "tasks" : {
        "oTUltX4IQMOUUVeiohTt8A:124" : {
          "node" : "oTUltX4IQMOUUVeiohTt8A",
          "id" : 124,
          "type" : "direct",
          "action" : "cluster:monitor/tasks/lists[n]",
          "start_time_in_millis" : 1458585884904,
          "running_time_in_nanos" : 47402,
          "parent_task_id" : "oTUltX4IQMOUUVeiohTt8A:123"
        },
        "oTUltX4IQMOUUVeiohTt8A:123" : {
          "node" : "oTUltX4IQMOUUVeiohTt8A",
          "id" : 123,
          "type" : "transport",
          "action" : "cluster:monitor/tasks/lists",
          "start_time_in_millis" : 1458585884904,
          "running_time_in_nanos" : 236042
        }
      }
    }
  }
}</programlisting>
<simpara>It is also possible to retrieve information for a particular task, or all children of a particular
tasks using the following two commands:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_tasks/taskId1
GET /_tasks?parent_task_id=parentTaskId1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The task API can be also used to wait for completion of a particular task. The following call will
block for 10 seconds or until the task with id <literal>oTUltX4IQMOUUVeiohTt8A:12345</literal> is completed.</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_tasks/oTUltX4IQMOUUVeiohTt8A:12345?wait_for_completion=true&amp;timeout=10s</programlisting>
<remark> AUTOSENSE</remark>
<bridgehead id="_task_cancellation" renderas="sect2">Task Cancellation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/tasks.asciidoc">Edit me</ulink></bridgehead>
<simpara>If a long-running task supports cancellation, it can be cancelled by the following command:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_tasks/taskId1/_cancel</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The task cancellation command supports the same task selection parameters as the list tasks command, so multiple tasks
can be cancelled at the same time. For example, the following command will cancel all reindex tasks running on the
nodes <literal>nodeId1</literal> and <literal>nodeId2</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_tasks/_cancel?node_id=nodeId1,nodeId2&amp;actions=*reindex</programlisting>
<remark> AUTOSENSE</remark>
</chapter>
<chapter id="cluster-nodes-hot-threads">
<title>Nodes hot_threads<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/cluster/nodes-hot-threads.asciidoc">Edit me</ulink></title>
<simpara>An API allowing to get the current hot threads on each node in the
cluster. Endpoints are <literal>/_nodes/hot_threads</literal>, and
<literal>/_nodes/{nodesIds}/hot_threads</literal>.</simpara>
<simpara>The output is plain text with a breakdown of each node&#8217;s top hot
threads. Parameters allowed are:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>threads</literal>
</simpara>
</entry>
<entry>
<simpara>
number of hot threads to provide, defaults to 3.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>interval</literal>
</simpara>
</entry>
<entry>
<simpara>
the interval to do the second sampling of threads.
                                Defaults to 500ms.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>type</literal>
</simpara>
</entry>
<entry>
<simpara>
The type to sample, defaults to cpu, but supports wait and
                                block to see hot threads that are in wait or block state.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ignore_idle_threads</literal>
</simpara>
</entry>
<entry>
<simpara>
If true, known idle threads (e.g. waiting in a socket select, or to
                           get a task from an empty queue) are filtered out.  Defaults to true.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</chapter>
</part>
<part id="query-dsl">
<title>Query DSL <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>Elasticsearch provides a full Query DSL based on JSON to define queries.
Think of the Query DSL as an AST of queries, consisting of two types of
clauses:</simpara>
<variablelist>
<varlistentry>
<term>
Leaf query clauses
</term>
<listitem>
<simpara>
Leaf query clauses look for a particular value in a particular field, such as the
<link linkend="query-dsl-match-query"><literal>match</literal></link>, <link linkend="query-dsl-term-query"><literal>term</literal></link> or
<link linkend="query-dsl-range-query"><literal>range</literal></link> queries.  These queries can be used
by themselves.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Compound query clauses
</term>
<listitem>
<simpara>
Compound query clauses wrap other leaf <emphasis role="strong">or</emphasis> compound queries and are used to combine
multiple queries in a logical fashion (such as the
<link linkend="query-dsl-bool-query"><literal>bool</literal></link> or <link linkend="query-dsl-dis-max-query"><literal>dis_max</literal></link> query),
or to alter their behaviour (such as the <link linkend="query-dsl-not-query"><literal>not</literal></link> or
<link linkend="query-dsl-constant-score-query"><literal>constant_score</literal></link> query).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Query clauses behave differently depending on whether they are used in
<link linkend="query-filter-context">query context or filter context</link>.</simpara>
</partintro>
<chapter id="query-filter-context">
<title>Query and filter context<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query_filter_context.asciidoc">Edit me</ulink></title>
<simpara>The behaviour of a query clause depends on whether it is used in <emphasis>query context</emphasis> or
in <emphasis>filter context</emphasis>:</simpara>
<variablelist>
<varlistentry>
<term>
Query context
</term>
<listitem>
<simpara>A query clause used in query context answers the question &#8220;<emphasis>How well does this
document match this query clause?</emphasis>&#8221; Besides deciding whether or not the
document matches, the query clause also calculates a <literal>_score</literal> representing how
well the document matches, relative to other documents.</simpara>
<simpara>Query context is in effect whenever a query clause is passed to a <literal>query</literal> parameter,
such as the <literal>query</literal> parameter in the <link linkend="search-request-query"><literal>search</literal></link> API.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Filter context
</term>
<listitem>
<simpara>In <emphasis>filter</emphasis> context, a query clause answers the question &#8220;<emphasis>Does this document
match this query clause?</emphasis>&#8221;  The answer is a simple Yes or No&#8201;&#8212;&#8201;no scores are
calculated.  Filter context is mostly used for filtering structured data, e.g.</simpara>
<itemizedlist>
<listitem>
<simpara>
<emphasis>Does this <literal>timestamp</literal> fall into the range 2015 to 2016?</emphasis>
</simpara>
</listitem>
<listitem>
<simpara>
<emphasis>Is the <literal>status</literal>  field set to <literal>"published"</literal></emphasis>?
</simpara>
</listitem>
</itemizedlist>
<simpara>Frequently used filters will be cached automatically by Elasticsearch, to
speed up performance.</simpara>
<simpara>Filter context is in effect whenever a query clause is passed to a <literal>filter</literal>
parameter, such as the <literal>filter</literal> or <literal>must_not</literal> parameters in the
<link linkend="query-dsl-bool-query"><literal>bool</literal></link> query, the <literal>filter</literal> parameter in the
<link linkend="query-dsl-constant-score-query"><literal>constant_score</literal></link> query, or the
<link linkend="search-aggregations-bucket-filter-aggregation"><literal>filter</literal></link> aggregation.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Below is an example of query clauses being used in query and filter context
in the <literal>search</literal> API.  This query will match documents where all of the following
conditions are met:</simpara>
<itemizedlist>
<listitem>
<simpara>
The <literal>title</literal> field contains the word <literal>search</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>content</literal> field contains the word <literal>elasticsearch</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>status</literal> field contains the exact word <literal>published</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>publish_date</literal> field contains a date from 1 Jan 2015 onwards.
</simpara>
</listitem>
</itemizedlist>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "query": { <co id="CO126-1"/>
    "bool": { <co id="CO126-2"/>
      "must": [
        { "match": { "title":   "Search"        }}, <co id="CO126-3"/>
        { "match": { "content": "Elasticsearch" }}  <co id="CO126-4"/>
      ],
      "filter": [ <co id="CO126-5"/>
        { "term":  { "status": "published" }}, <co id="CO126-6"/>
        { "range": { "publish_date": { "gte": "2015-01-01" }}} <co id="CO126-7"/>
      ]
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO126-1">
<para>
The <literal>query</literal> parameter indicates query context.
</para>
</callout>
<callout arearefs="CO126-2 CO126-3 CO126-4">
<para>
The <literal>bool</literal> and two <literal>match</literal> clauses are used in query context,
    which means that they are used to score how well each document
    matches.
</para>
</callout>
<callout arearefs="CO126-5">
<para>
The <literal>filter</literal> parameter indicates filter context.
</para>
</callout>
<callout arearefs="CO126-6 CO126-7">
<para>
The <literal>term</literal> and <literal>range</literal> clauses are used in filter context.
    They will filter out documents which do not match, but they will
    not affect the score for matching documents.
</para>
</callout>
</calloutlist>
<tip><simpara>Use query clauses in query context for conditions which should affect the
score of matching documents (i.e. how well does the document match), and use
all other query clauses in filter context.</simpara></tip>
</chapter>
<chapter id="query-dsl-match-all-query">
<title>Match All Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-all-query.asciidoc">Edit me</ulink></title>
<simpara>The most simple query, which matches all documents, giving them all a <literal>_score</literal>
of <literal>1.0</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "match_all": {} }</programlisting>
<simpara>The <literal>_score</literal> can be changed with the <literal>boost</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "match_all": { "boost" : 1.2 }}</programlisting>
</chapter>
<chapter id="full-text-queries">
<title>Full text queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/full-text-queries.asciidoc">Edit me</ulink></title>
<simpara>The high-level full text queries are usually used for running full text
queries on full text fields like the body of an email. They understand how the
field being queried is <link linkend="analysis">analyzed</link> and will apply each field&#8217;s
<literal>analyzer</literal> (or <literal>search_analyzer</literal>) to the query string before executing.</simpara>
<simpara>The queries in this group are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-match-query"><literal>match</literal> query</link>
</term>
<listitem>
<simpara>
    The standard query for performing full text queries, including fuzzy matching
    and phrase or proximity queries.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-multi-match-query"><literal>multi_match</literal> query</link>
</term>
<listitem>
<simpara>
    The multi-field version of the <literal>match</literal> query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-common-terms-query"><literal>common_terms</literal> query</link>
</term>
<listitem>
<simpara>
    A more specialized query which gives more preference to uncommon words.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-query-string-query"><literal>query_string</literal> query</link>
</term>
<listitem>
<simpara>
    Supports the compact Lucene <link linkend="query-string-syntax">query string syntax</link>,
    allowing you to specify AND|OR|NOT conditions and multi-field search
    within a single query string. For expert users only.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-simple-query-string-query"><literal>simple_query_string</literal></link>
</term>
<listitem>
<simpara>
    A simpler, more robust version of the <literal>query_string</literal> syntax suitable
    for exposing directly to users.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="query-dsl-match-query">
<title>Match Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>A family of <literal>match</literal> queries that accepts text/numerics/dates, analyzes
them, and constructs a query. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match" : {
        "message" : "this is a test"
    }
}</programlisting>
<simpara>Note, <literal>message</literal> is the name of a field, you can substitute the name of
any field (including <literal>_all</literal>) instead.</simpara>
<simpara>There are three types of <literal>match</literal> query: <literal>boolean</literal>, <literal>phrase</literal>, and <literal>phrase_prefix</literal>:</simpara>
<section id="query-dsl-match-query-boolean">
<title>boolean<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>The default <literal>match</literal> query is of type <literal>boolean</literal>. It means that the text
provided is analyzed and the analysis process constructs a boolean query
from the provided text. The <literal>operator</literal> flag can be set to <literal>or</literal> or <literal>and</literal>
to control the boolean clauses (defaults to <literal>or</literal>). The minimum number of
optional <literal>should</literal> clauses to match can be set using the
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
parameter.</simpara>
<simpara>The <literal>analyzer</literal> can be set to control which analyzer will perform the
analysis process on the text. It defaults to the field explicit mapping
definition, or the default search analyzer.</simpara>
<simpara>The <literal>lenient</literal> parameter can be set to <literal>true</literal> to ignore exceptions caused by
data-type mismatches,  such as trying to query a numeric field with a text
query string. Defaults to <literal>false</literal>.</simpara>
<section id="query-dsl-match-query-fuzziness">
<title>Fuzziness<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara><literal>fuzziness</literal> allows <emphasis>fuzzy matching</emphasis> based on the type of field being queried.
See <xref linkend="fuzziness"/> for allowed settings.</simpara>
<simpara>The <literal>prefix_length</literal> and
<literal>max_expansions</literal> can be set in this case to control the fuzzy process.
If the fuzzy option is set the query will use <literal>top_terms_blended_freqs_${max_expansions}</literal>
as its <link linkend="query-dsl-multi-term-rewrite">rewrite method</link> the <literal>fuzzy_rewrite</literal> parameter allows to control how the query will get
rewritten.</simpara>
<simpara>Fuzzy transpositions (<literal>ab</literal> &#8594; <literal>ba</literal>) are allowed by default but can be disabled
by setting <literal>fuzzy_transpositions</literal> to <literal>false</literal>.</simpara>
<simpara>Here is an example when providing additional parameters (note the slight
change in structure, <literal>message</literal> is the field name):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "operator" : "and"
        }
    }
}</programlisting>
</section>
<section id="query-dsl-match-query-zero">
<title>Zero terms query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>If the analyzer used removes all tokens in a query like a <literal>stop</literal> filter
does, the default behavior is to match no documents at all. In order to
change that the <literal>zero_terms_query</literal> option can be used, which accepts
<literal>none</literal> (default) and <literal>all</literal> which corresponds to a <literal>match_all</literal> query.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "operator" : "and",
            "zero_terms_query": "all"
        }
    }
}</programlisting>
</section>
<section id="query-dsl-match-query-cutoff">
<title>Cutoff frequency<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>The match query supports a <literal>cutoff_frequency</literal> that allows
specifying an absolute or relative document frequency where high
frequency terms are moved into an optional subquery and are only scored
if one of the low frequency (below the cutoff) terms in the case of an
<literal>or</literal> operator or all of the low frequency terms in the case of an <literal>and</literal>
operator match.</simpara>
<simpara>This query allows handling <literal>stopwords</literal> dynamically at runtime, is domain
independent and doesn&#8217;t require a stopword file. It prevents scoring /
iterating high frequency terms and only takes the terms into account if a
more significant / lower frequency term matches a document. Yet, if all
of the query terms are above the given <literal>cutoff_frequency</literal> the query is
automatically transformed into a pure conjunction (<literal>and</literal>) query to
ensure fast execution.</simpara>
<simpara>The <literal>cutoff_frequency</literal> can either be relative to the total number of
documents if in the range <literal>[0..1)</literal> or absolute if greater or equal to
<literal>1.0</literal>.</simpara>
<simpara>Here is an example showing a query composed of stopwords exclusively:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "cutoff_frequency" : 0.001
        }
    }
}</programlisting>
<important><simpara>The <literal>cutoff_frequency</literal> option operates on a per-shard-level. This means
that when trying it out on test indexes with low document numbers you
should follow the advice in <ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/relevance-is-broken.html">Relevance is broken</ulink>.</simpara></important>
</section>
</section>
<section id="query-dsl-match-query-phrase">
<title>phrase<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match_phrase</literal> query analyzes the text and creates a <literal>phrase</literal> query
out of the analyzed text. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match_phrase" : {
        "message" : "this is a test"
    }
}</programlisting>
<simpara>Since <literal>match_phrase</literal> is only a <literal>type</literal> of a <literal>match</literal> query, it can also be
used in the following manner:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "type" : "phrase"
        }
    }
}</programlisting>
<simpara>A phrase query matches terms up to a configurable <literal>slop</literal>
(which defaults to 0) in any order. Transposed terms have a slop of 2.</simpara>
<simpara>The <literal>analyzer</literal> can be set to control which analyzer will perform the
analysis process on the text. It defaults to the field explicit mapping
definition, or the default search analyzer, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match_phrase" : {
        "message" : {
            "query" : "this is a test",
            "analyzer" : "my_analyzer"
        }
    }
}</programlisting>
</section>
<section id="query-dsl-match-query-phrase-prefix">
<title>match_phrase_prefix<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match_phrase_prefix</literal> is the same as <literal>match_phrase</literal>, except that it
allows for prefix matches on the last term in the text. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match_phrase_prefix" : {
        "message" : "quick brown f"
    }
}</programlisting>
<simpara>It accepts the same parameters as the phrase type. In addition, it also
accepts a <literal>max_expansions</literal> parameter (default <literal>50</literal>) that can control to how
many prefixes the last term will be expanded. It is highly recommended to set
it to an acceptable value to control the execution time of the query. For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "match_phrase_prefix" : {
        "message" : {
            "query" : "quick brown f",
            "max_expansions" : 10
        }
    }
}</programlisting>
<important>
<simpara>The <literal>match_phrase_prefix</literal> query is a poor-man&#8217;s autocomplete.  It is very easy
to use, which let&#8217;s you get started quickly with <emphasis>search-as-you-type</emphasis> but it&#8217;s
results, which usually are good enough,  can sometimes be confusing.</simpara>
<simpara>Consider the query string <literal>quick brown f</literal>.  This query works by creating a
phrase query out of <literal>quick</literal> and <literal>brown</literal> (i.e. the term <literal>quick</literal> must exist and
must be followed by the term <literal>brown</literal>).  Then it looks at the sorted term
dictionary to find the first 50 terms that begin with <literal>f</literal>, and
adds these terms to the phrase query.</simpara>
<simpara>The problem is that the first 50 terms may not include the term <literal>fox</literal> so the
phase <literal>quick brown fox</literal> will not be found.  This usually isn&#8217;t a problem as
the user will continue to type more letters until the word they are looking
for appears.</simpara>
<simpara>For better solutions for <emphasis>search-as-you-type</emphasis> see the
<link linkend="search-suggesters-completion">completion suggester</link> and
<ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/_index_time_search_as_you_type.html">Index-Time Search-as-You-Type</ulink>.</simpara>
</important>
</section>
</section>
<section id="query-dsl-multi-match-query">
<title>Multi Match Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>multi_match</literal> query builds on the <link linkend="query-dsl-match-query"><literal>match</literal> query</link>
to allow multi-field queries:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":    "this is a test", <co id="CO127-1"/>
    "fields": [ "subject", "message" ] <co id="CO127-2"/>
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO127-1">
<para>
The query string.
</para>
</callout>
<callout arearefs="CO127-2">
<para>
The fields to be queried.
</para>
</callout>
</calloutlist>
<bridgehead id="_literal_fields_literal_and_per_field_boosting" renderas="sect3"><literal>fields</literal> and per-field boosting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Fields can be specified with wildcards, eg:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":    "Will Smith",
    "fields": [ "title", "*_name" ] <co id="CO128-1"/>
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO128-1">
<para>
Query the <literal>title</literal>, <literal>first_name</literal> and <literal>last_name</literal> fields.
</para>
</callout>
</calloutlist>
<simpara>Individual fields can be boosted with the caret (<literal>^</literal>) notation:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query" : "this is a test",
    "fields" : [ "subject^3", "message" ] <co id="CO129-1"/>
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO129-1">
<para>
The <literal>subject</literal> field is three times as important as the <literal>message</literal> field.
</para>
</callout>
</calloutlist>
<bridgehead id="multi-match-types" renderas="sect3">Types of <literal>multi_match</literal> query:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The way the <literal>multi_match</literal> query is executed internally depends on the <literal>type</literal>
parameter, which can be set to:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>best_fields</literal>
</simpara>
</entry>
<entry>
<simpara>
(<emphasis role="strong">default</emphasis>) Finds documents which match any field, but
                    uses the  <literal>_score</literal> from the best field.  See <xref linkend="type-best-fields"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>most_fields</literal>
</simpara>
</entry>
<entry>
<simpara>
Finds documents which match any field and combines
                    the <literal>_score</literal> from each field.  See <xref linkend="type-most-fields"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>cross_fields</literal>
</simpara>
</entry>
<entry>
<simpara>
Treats fields with the same <literal>analyzer</literal> as though they
                    were one big field. Looks for each word in <emphasis role="strong">any</emphasis>
                    field. See <xref linkend="type-cross-fields"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>phrase</literal>
</simpara>
</entry>
<entry>
<simpara>
Runs a <literal>match_phrase</literal> query on each field and combines
                    the <literal>_score</literal> from each field.  See <xref linkend="type-phrase"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>phrase_prefix</literal>
</simpara>
</entry>
<entry>
<simpara>
Runs a <literal>match_phrase_prefix</literal> query on each field and
                    combines the <literal>_score</literal> from each field.  See <xref linkend="type-phrase"/>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<section id="type-best-fields">
<title><literal>best_fields</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>best_fields</literal> type is most useful when you are searching for multiple
words best found in the same field. For instance &#8220;brown fox&#8221; in a single
field is more meaningful than &#8220;brown&#8221; in one field and &#8220;fox&#8221; in the other.</simpara>
<simpara>The <literal>best_fields</literal> type generates a <link linkend="query-dsl-match-query"><literal>match</literal> query</link> for
each field and wraps them in a <link linkend="query-dsl-dis-max-query"><literal>dis_max</literal></link> query, to
find the single best matching field.  For instance, this query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "brown fox",
    "type":       "best_fields",
    "fields":     [ "subject", "message" ],
    "tie_breaker": 0.3
  }
}</programlisting>
<simpara>would be executed as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "dis_max": {
    "queries": [
      { "match": { "subject": "brown fox" }},
      { "match": { "message": "brown fox" }}
    ],
    "tie_breaker": 0.3
  }
}</programlisting>
<simpara>Normally the <literal>best_fields</literal> type uses the score of the <emphasis role="strong">single</emphasis> best matching
field, but if <literal>tie_breaker</literal> is specified, then it calculates the score as
follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
the score from the best matching field
</simpara>
</listitem>
<listitem>
<simpara>
plus <literal>tie_breaker * _score</literal> for all other matching fields
</simpara>
</listitem>
</itemizedlist>
<simpara>Also, accepts <literal>analyzer</literal>, <literal>boost</literal>, <literal>operator</literal>, <literal>minimum_should_match</literal>,
<literal>fuzziness</literal>, <literal>prefix_length</literal>, <literal>max_expansions</literal>, <literal>rewrite</literal>, <literal>zero_terms_query</literal>
and <literal>cutoff_frequency</literal>, as explained in <link linkend="query-dsl-match-query">match query</link>.</simpara>
<important id="operator-min">
<title><literal>operator</literal> and <literal>minimum_should_match</literal></title>
<simpara>The <literal>best_fields</literal> and <literal>most_fields</literal> types are <emphasis>field-centric</emphasis>&#8201;&#8212;&#8201;they generate
a <literal>match</literal> query <emphasis role="strong">per field</emphasis>.  This means that the <literal>operator</literal> and
<literal>minimum_should_match</literal> parameters are applied to each field individually,
which is probably not what you want.</simpara>
<simpara>Take this query for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "best_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and" <co id="CO130-1"/>
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO130-1">
<para>
All terms must be present.
</para>
</callout>
</calloutlist>
<simpara>This query is executed as:</simpara>
<literallayout class="monospaced">  (+first_name:will +first_name:smith)
| (+last_name:will  +last_name:smith)</literallayout>
<simpara>In other words, <emphasis role="strong">all terms</emphasis> must be present <emphasis role="strong">in a single field</emphasis> for a document
to match.</simpara>
<simpara>See <xref linkend="type-cross-fields"/> for a better solution.</simpara>
</important>
</section>
<section id="type-most-fields">
<title><literal>most_fields</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>most_fields</literal> type is most useful when querying multiple fields that
contain the same text analyzed in different ways.  For instance, the main
field may contain synonyms, stemming and terms without diacritics. A second
field may contain the original terms, and a third field might contain
shingles. By combining scores from all three fields we can match as many
documents as possible with the main field, but use the second and third fields
to push the most similar results to the top of the list.</simpara>
<simpara>This query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "quick brown fox",
    "type":       "most_fields",
    "fields":     [ "title", "title.original", "title.shingles" ]
  }
}</programlisting>
<simpara>would be executed as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "bool": {
    "should": [
      { "match": { "title":          "quick brown fox" }},
      { "match": { "title.original": "quick brown fox" }},
      { "match": { "title.shingles": "quick brown fox" }}
    ]
  }
}</programlisting>
<simpara>The score from each <literal>match</literal> clause is added together, then divided by the
number of <literal>match</literal> clauses.</simpara>
<simpara>Also, accepts <literal>analyzer</literal>, <literal>boost</literal>, <literal>operator</literal>, <literal>minimum_should_match</literal>,
<literal>fuzziness</literal>, <literal>prefix_length</literal>, <literal>max_expansions</literal>, <literal>rewrite</literal>, <literal>zero_terms_query</literal>
and <literal>cutoff_frequency</literal>, as explained in <link linkend="query-dsl-match-query">match query</link>, but
<emphasis role="strong">see <xref linkend="operator-min"/></emphasis>.</simpara>
</section>
<section id="type-phrase">
<title><literal>phrase</literal> and <literal>phrase_prefix</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>phrase</literal> and <literal>phrase_prefix</literal> types behave just like <xref linkend="type-best-fields"/>,
but they use a <literal>match_phrase</literal> or <literal>match_phrase_prefix</literal> query instead of a
<literal>match</literal> query.</simpara>
<simpara>This query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "quick brown f",
    "type":       "phrase_prefix",
    "fields":     [ "subject", "message" ]
  }
}</programlisting>
<simpara>would be executed as:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "dis_max": {
    "queries": [
      { "match_phrase_prefix": { "subject": "quick brown f" }},
      { "match_phrase_prefix": { "message": "quick brown f" }}
    ]
  }
}</programlisting>
<simpara>Also, accepts <literal>analyzer</literal>, <literal>boost</literal>, <literal>slop</literal> and <literal>zero_terms_query</literal>  as explained
in <xref linkend="query-dsl-match-query"/>.  Type <literal>phrase_prefix</literal> additionally accepts
<literal>max_expansions</literal>.</simpara>
</section>
<section id="type-cross-fields">
<title><literal>cross_fields</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cross_fields</literal> type is particularly useful with structured documents where
multiple fields <emphasis role="strong">should</emphasis> match.  For instance, when querying the <literal>first_name</literal>
and <literal>last_name</literal> fields for &#8220;Will Smith&#8221;, the best match is likely to have
&#8220;Will&#8221; in one field and &#8220;Smith&#8221; in the other.</simpara>
<sidebar>
<simpara>This sounds like a job for <xref linkend="type-most-fields"/> but there are two problems
with that approach. The first problem is that <literal>operator</literal> and
<literal>minimum_should_match</literal> are applied per-field, instead of per-term (see
<link linkend="operator-min">explanation above</link>).</simpara>
<simpara>The second problem is to do with relevance: the different term frequencies in
the <literal>first_name</literal> and <literal>last_name</literal> fields   can produce unexpected results.</simpara>
<simpara>For instance, imagine we have two people: &#8220;Will Smith&#8221; and &#8220;Smith Jones&#8221;.
&#8220;Smith&#8221; as a last name is very common (and so is of low importance) but
&#8220;Smith&#8221; as a first name is very uncommon (and so is of great importance).</simpara>
<simpara>If we do a search for &#8220;Will Smith&#8221;, the &#8220;Smith Jones&#8221; document will
probably appear above the better matching &#8220;Will Smith&#8221; because the score of
<literal>first_name:smith</literal> has trumped the combined scores of <literal>first_name:will</literal> plus
<literal>last_name:smith</literal>.</simpara>
</sidebar>
<simpara>One way of dealing with these types of queries is simply to index the
<literal>first_name</literal> and <literal>last_name</literal> fields into a single <literal>full_name</literal> field.  Of
course, this can only be done at index time.</simpara>
<simpara>The <literal>cross_field</literal> type tries to solve these problems at query time by taking a
<emphasis>term-centric</emphasis> approach.  It first analyzes the query string into individual
terms, then looks for each term in any of the fields, as though they were one
big field.</simpara>
<simpara>A query like:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "cross_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and"
  }
}</programlisting>
<simpara>is executed as:</simpara>
<literallayout class="monospaced">+(first_name:will  last_name:will)
+(first_name:smith last_name:smith)</literallayout>
<simpara>In other words, <emphasis role="strong">all terms</emphasis> must be present <emphasis role="strong">in at least one field</emphasis> for a
document to match.  (Compare this to
<link linkend="operator-min">the logic used for <literal>best_fields</literal> and <literal>most_fields</literal></link>.)</simpara>
<simpara>That solves one of the two problems. The problem of differing term frequencies
is solved by <emphasis>blending</emphasis> the term frequencies for all fields in order to even
out the differences.</simpara>
<simpara>In practice, <literal>first_name:smith</literal> will be treated as though it has the same
frequencies as <literal>last_name:smith</literal>, plus one. This will make matches on
<literal>first_name</literal> and <literal>last_name</literal> have comparable scores, with a tiny advantage
for <literal>last_name</literal> since it is the most likely field that contains <literal>smith</literal>.</simpara>
<simpara>Note that <literal>cross_fields</literal> is usually only useful on short string fields
that all have a <literal>boost</literal> of <literal>1</literal>. Otherwise boosts, term freqs and length
normalization contribute to the score in such a way that the blending of term
statistics is not meaningful anymore.</simpara>
<simpara>If you run the above query through the <xref linkend="search-validate"/>, it returns this
explanation:</simpara>
<literallayout class="monospaced">+blended("will",  fields: [first_name, last_name])
+blended("smith", fields: [first_name, last_name])</literallayout>
<simpara>Also, accepts <literal>analyzer</literal>, <literal>boost</literal>, <literal>operator</literal>, <literal>minimum_should_match</literal>,
<literal>zero_terms_query</literal> and <literal>cutoff_frequency</literal>, as explained in
<link linkend="query-dsl-match-query">match query</link>.</simpara>
<section id="_literal_cross_field_literal_and_analysis">
<title><literal>cross_field</literal> and analysis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cross_field</literal> type can only work in term-centric mode on fields that have
the same analyzer. Fields with the same analyzer are grouped together as in
the example above.  If there are multiple groups, they are combined with a
<literal>bool</literal> query.</simpara>
<simpara>For instance, if we have a <literal>first</literal> and <literal>last</literal> field which have
the same analyzer, plus a <literal>first.edge</literal> and <literal>last.edge</literal> which
both use an <literal>edge_ngram</literal> analyzer, this query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "fields":     [
        "first", "first.edge",
        "last",  "last.edge"
    ]
  }
}</programlisting>
<simpara>would be executed as:</simpara>
<literallayout class="monospaced">    blended("jon", fields: [first, last])
| (
    blended("j",   fields: [first.edge, last.edge])
    blended("jo",  fields: [first.edge, last.edge])
    blended("jon", fields: [first.edge, last.edge])
)</literallayout>
<simpara>In other words, <literal>first</literal> and <literal>last</literal> would be grouped together and
treated as a single field, and <literal>first.edge</literal> and <literal>last.edge</literal> would be
grouped together and treated as a single field.</simpara>
<simpara>Having multiple groups is fine, but when combined with <literal>operator</literal> or
<literal>minimum_should_match</literal>, it can suffer from the <link linkend="operator-min">same problem</link>
as <literal>most_fields</literal> or <literal>best_fields</literal>.</simpara>
<simpara>You can easily rewrite this query yourself as two separate <literal>cross_fields</literal>
queries combined with a <literal>bool</literal> query, and apply the <literal>minimum_should_match</literal>
parameter to just one of them:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool": {
        "should": [
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "first", "last" ],
                "minimum_should_match": "50%" <co id="CO131-1"/>
              }
            },
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "*.edge" ]
              }
            }
        ]
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO131-1">
<para>
Either <literal>will</literal> or <literal>smith</literal> must be present in either of the <literal>first</literal>
    or <literal>last</literal> fields
</para>
</callout>
</calloutlist>
<simpara>You can force all fields into the same group by specifying the <literal>analyzer</literal>
parameter in the query.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "analyzer":   "standard", <co id="CO132-1"/>
    "fields":     [ "first", "last", "*.edge" ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO132-1">
<para>
Use the <literal>standard</literal> analyzer for all fields.
</para>
</callout>
</calloutlist>
<simpara>which will be executed as:</simpara>
<literallayout class="monospaced">blended("will",  fields: [first, first.edge, last.edge, last])
blended("smith", fields: [first, first.edge, last.edge, last])</literallayout>
</section>
<section id="_literal_tie_breaker_literal">
<title><literal>tie_breaker</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-match-query.asciidoc">Edit me</ulink></title>
<simpara>By default, each per-term <literal>blended</literal> query will use the best score returned by
any field in a group, then these scores are added together to give the final
score. The <literal>tie_breaker</literal> parameter can change the default behaviour of the
per-term <literal>blended</literal> queries. It accepts:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>0.0</literal>
</simpara>
</entry>
<entry>
<simpara>
Take the single best score out of (eg) <literal>first_name:will</literal>
                    and <literal>last_name:will</literal> (<emphasis role="strong">default</emphasis>)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>1.0</literal>
</simpara>
</entry>
<entry>
<simpara>
Add together the scores for (eg) <literal>first_name:will</literal> and
                    <literal>last_name:will</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>0.0 &lt; n &lt; 1.0</literal>
</simpara>
</entry>
<entry>
<simpara>
Take the single best score plus <literal>tie_breaker</literal> multiplied
                    by each of the scores from other matching fields.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
</section>
<section id="query-dsl-common-terms-query">
<title>Common Terms Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/common-terms-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>common</literal> terms query is a modern alternative to stopwords which
improves the precision and recall of search results (by taking stopwords
into account), without sacrificing performance.</simpara>
<bridgehead id="_the_problem" renderas="sect3">The problem<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/common-terms-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Every term in a query has a cost. A search for <literal>"The brown fox"</literal>
requires three term queries, one for each of <literal>"the"</literal>, <literal>"brown"</literal> and
<literal>"fox"</literal>, all of which are executed against all documents in the index.
The query for <literal>"the"</literal> is likely to match many documents and thus has a
much smaller impact on relevance than the other two terms.</simpara>
<simpara>Previously, the solution to this problem was to ignore terms with high
frequency. By treating <literal>"the"</literal> as a <emphasis>stopword</emphasis>, we reduce the index size
and reduce the number of term queries that need to be executed.</simpara>
<simpara>The problem with this approach is that, while stopwords have a small
impact on relevance, they are still important. If we remove stopwords,
we lose precision, (eg we are unable to distinguish between <literal>"happy"</literal>
and <literal>"not happy"</literal>) and we lose recall (eg text like <literal>"The The"</literal> or
<literal>"To be or not to be"</literal> would simply not exist in the index).</simpara>
<bridgehead id="_the_solution" renderas="sect3">The solution<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/common-terms-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>common</literal> terms query divides the query terms into two groups: more
important (ie <emphasis>low frequency</emphasis> terms) and less important (ie <emphasis>high
frequency</emphasis> terms which would previously have been stopwords).</simpara>
<simpara>First it searches for documents which match the more important terms.
These are the terms which appear in fewer documents and have a greater
impact on relevance.</simpara>
<simpara>Then, it executes a second query for the less important terms&#8201;&#8212;&#8201;terms
which appear frequently and have a low impact on relevance. But instead
of calculating the relevance score for <emphasis role="strong">all</emphasis> matching documents, it only
calculates the <literal>_score</literal> for documents already matched by the first
query. In this way the high frequency terms can improve the relevance
calculation without paying the cost of poor performance.</simpara>
<simpara>If a query consists only of high frequency terms, then a single query is
executed as an <literal>AND</literal> (conjunction) query, in other words all terms are
required. Even though each individual term will match many documents,
the combination of terms narrows down the resultset to only the most
relevant. The single query can also be executed as an <literal>OR</literal> with a
specific
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>,
in this case a high enough value should probably be used.</simpara>
<simpara>Terms are allocated to the high or low frequency groups based on the
<literal>cutoff_frequency</literal>, which can be specified as an absolute frequency
(<literal>&gt;=1</literal>) or as a relative frequency (<literal>0.0 .. 1.0</literal>). (Remember that document
frequencies are computed on a per shard level as explained in the blog post
<ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/relevance-is-broken.html">Relevance is broken</ulink>.)</simpara>
<simpara>Perhaps the most interesting property of this query is that it adapts to
domain specific stopwords automatically. For example, on a video hosting
site, common terms like <literal>"clip"</literal> or <literal>"video"</literal> will automatically behave
as stopwords without the need to maintain a manual list.</simpara>
<bridgehead id="_examples_3" renderas="sect3">Examples<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/common-terms-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>In this example, words that have a document frequency greater than 0.1%
(eg <literal>"this"</literal> and <literal>"is"</literal>) will be treated as <emphasis>common terms</emphasis>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "common": {
    "body": {
      "query": "this is bonsai cool",
      "cutoff_frequency": 0.001
    }
  }
}</programlisting>
<simpara>The number of terms which should match can be controlled with the
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
(<literal>high_freq</literal>, <literal>low_freq</literal>), <literal>low_freq_operator</literal> (default <literal>"or"</literal>) and
<literal>high_freq_operator</literal> (default <literal>"or"</literal>) parameters.</simpara>
<simpara>For low frequency terms, set the <literal>low_freq_operator</literal> to <literal>"and"</literal> to make
all terms required:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "common": {
    "body": {
      "query": "nelly the elephant as a cartoon",
      "cutoff_frequency": 0.001,
      "low_freq_operator": "and"
    }
  }
}</programlisting>
<simpara>which is roughly equivalent to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "bool": {
    "must": [
      { "term": { "body": "nelly"}},
      { "term": { "body": "elephant"}},
      { "term": { "body": "cartoon"}}
    ],
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</programlisting>
<simpara>Alternatively use
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
to specify a minimum number or percentage of low frequency terms which
must be present, for instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "common": {
    "body": {
      "query": "nelly the elephant as a cartoon",
      "cutoff_frequency": 0.001,
      "minimum_should_match": 2
    }
  }
}</programlisting>
<simpara>which is roughly equivalent to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</programlisting>
<simpara>minimum_should_match</simpara>
<simpara>A different
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
can be applied for low and high frequency terms with the additional
<literal>low_freq</literal> and <literal>high_freq</literal> parameters. Here is an example when providing
additional parameters (note the change in structure):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "common": {
    "body": {
      "query": "nelly the elephant not as a cartoon",
      "cutoff_frequency": 0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</programlisting>
<simpara>which is roughly equivalent to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": {
      "bool": {
        "should": [
          { "term": { "body": "the"}},
          { "term": { "body": "not"}},
          { "term": { "body": "as"}},
          { "term": { "body": "a"}}
        ],
        "minimum_should_match": 3
      }
    }
  }
}</programlisting>
<simpara>In this case it means the high frequency terms have only an impact on
relevance when there are at least three of them. But the most
interesting use of the
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
for high frequency terms is when there are only high frequency terms:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "common": {
    "body": {
      "query": "how not to be",
      "cutoff_frequency": 0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</programlisting>
<simpara>which is roughly equivalent to:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "bool": {
    "should": [
      { "term": { "body": "how"}},
      { "term": { "body": "not"}},
      { "term": { "body": "to"}},
      { "term": { "body": "be"}}
    ],
    "minimum_should_match": "3&lt;50%"
  }
}</programlisting>
<simpara>The high frequency generated query is then slightly less restrictive
than with an <literal>AND</literal>.</simpara>
<simpara>The <literal>common</literal> terms query also supports <literal>boost</literal>, <literal>analyzer</literal> and
<literal>disable_coord</literal> as parameters.</simpara>
</section>
<section id="query-dsl-query-string-query">
<title>Query String Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-query.asciidoc">Edit me</ulink></title>
<simpara>A query that uses a query parser in order to parse its content. Here is
an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string" : {
        "default_field" : "content",
        "query" : "this AND that OR thus"
    }
}</programlisting>
<simpara>The <literal>query_string</literal> top level parameters include:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Parameter </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>query</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The actual query to be parsed. See <xref linkend="query-string-syntax"/>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_field</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default field for query terms if no prefix field
is specified. Defaults to the <literal>index.query.default_field</literal> index
settings, which in turn defaults to <literal>_all</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator used if no explicit operator
is specified. For example, with a default operator of <literal>OR</literal>, the query
<literal>capital of Hungary</literal> is translated to <literal>capital OR of OR Hungary</literal>, and
with default operator of <literal>AND</literal>, the same query is translated to
<literal>capital AND of AND Hungary</literal>. The default value is <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer name used to analyze the query string.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>allow_leading_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>When set, <literal>*</literal> or <literal>?</literal> are allowed as the first
character. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Whether terms of wildcard, prefix, fuzzy,
and range queries are to be automatically lower-cased or not (since they
are not analyzed). Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>enable_position_increments</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>true</literal> to enable position
increments in result queries. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fuzzy_max_expansions</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Controls the number of terms fuzzy queries will
expand to. Defaults to <literal>50</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fuzziness</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set the fuzziness for fuzzy queries. Defaults
to <literal>AUTO</literal>. See  <xref linkend="fuzziness"/> for allowed settings.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fuzzy_prefix_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set the prefix length for fuzzy queries. Default
is <literal>0</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>phrase_slop</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Sets the default slop for phrases. If zero, then exact
phrase matches are required. Default value is <literal>0</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>boost</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Sets the boost value of the query. Defaults to <literal>1.0</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>By default, wildcards terms in a query string are
not analyzed. By setting this value to <literal>true</literal>, a best effort will be
made to analyze those as well.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>auto_generate_phrase_queries</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_determinized_states</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Limit on how many automaton states regexp
queries are allowed to create.  This protects against too-difficult
(e.g. exponentially hard) regexps.  Defaults to 10000.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>minimum_should_match</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A value controlling how many "should" clauses
in the resulting boolean query should match. It can be an absolute value
(<literal>2</literal>), a percentage (<literal>30%</literal>) or a
<link linkend="query-dsl-minimum-should-match">combination of both</link>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to <literal>true</literal> will cause format based failures (like
providing text to a numeric field) to be ignored.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>locale</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Locale that should be used for string conversions.
Defaults to <literal>ROOT</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>time_zone</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Time Zone to be applied to any range query related to dates. See also
<ulink url="http://www.joda.org/joda-time/apidocs/org/joda/time/DateTimeZone.html">JODA timezone</ulink>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>When a multi term query is being generated, one can control how it gets
rewritten using the
<link linkend="query-dsl-multi-term-rewrite">rewrite</link>
parameter.</simpara>
<bridgehead id="_default_field" renderas="sect3">Default Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>When not explicitly specifying the field to search on in the query
string syntax, the <literal>index.query.default_field</literal> will be used to derive
which field to search on. It defaults to <literal>_all</literal> field.</simpara>
<simpara>So, if <literal>_all</literal> field is disabled, it might make sense to change it to set
a different default field.</simpara>
<bridgehead id="_multi_field" renderas="sect3">Multi Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>query_string</literal> query can also run against multiple fields. Fields can be
provided via the <literal>"fields"</literal> parameter (example below).</simpara>
<simpara>The idea of running the <literal>query_string</literal> query against multiple fields is to
expand each query term to an OR clause like this:</simpara>
<literallayout class="monospaced">field1:query_term OR field2:query_term | ...</literallayout>
<simpara>For example, the following query</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string" : {
        "fields" : ["content", "name"],
        "query" : "this AND that"
    }
}</programlisting>
<simpara>matches the same words as</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string": {
      "query": "(content:this OR name:this) AND (content:that OR name:that)"
    }
}</programlisting>
<simpara>Since several queries are generated from the individual search terms,
combining them can be automatically done using either a <literal>dis_max</literal> query or a
simple <literal>bool</literal> query. For example (the <literal>name</literal> is boosted by 5 using <literal>^5</literal>
notation):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string" : {
        "fields" : ["content", "name^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</programlisting>
<simpara>Simple wildcard can also be used to search "within" specific inner
elements of the document. For example, if we have a <literal>city</literal> object with
several fields (or inner object with fields) in it, we can automatically
search on all "city" fields:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string" : {
        "fields" : ["city.*"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</programlisting>
<simpara>Another option is to provide the wildcard fields search in the query
string itself (properly escaping the <literal>*</literal> sign), for example:
<literal>city.\*:something</literal>.</simpara>
<simpara>When running the <literal>query_string</literal> query against multiple fields, the
following additional parameters are allowed:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Parameter </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>use_dis_max</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Should the queries be combined using <literal>dis_max</literal> (set it
to <literal>true</literal>), or a <literal>bool</literal> query (set it to <literal>false</literal>). Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tie_breaker</literal></simpara></entry>
<entry align="left" valign="top"><simpara>When using <literal>dis_max</literal>, the disjunction max tie breaker.
Defaults to <literal>0</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</programlisting>
<section id="query-string-syntax">
<title>Query string syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>The query string &#8220;mini-language&#8221; is used by the
<xref linkend="query-dsl-query-string-query"/> and by the
<literal>q</literal> query string parameter in the <link linkend="search-search"><literal>search</literal> API</link>.</simpara>
<simpara>The query string is parsed into a series of <emphasis>terms</emphasis> and <emphasis>operators</emphasis>. A
term can be a single word&#8201;&#8212;&#8201;<literal>quick</literal> or <literal>brown</literal>&#8201;&#8212;&#8201;or a phrase, surrounded by
double quotes&#8201;&#8212;&#8201;<literal>"quick brown"</literal>&#8201;&#8212;&#8201;which searches for all the words in the
phrase, in the same order.</simpara>
<simpara>Operators allow you to customize the search&#8201;&#8212;&#8201;the available options are
explained below.</simpara>
<section id="_field_names">
<title>Field names<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>As mentioned in <xref linkend="query-dsl-query-string-query"/>, the <literal>default_field</literal> is searched for the
search terms, but it is possible to specify other fields in the query syntax:</simpara>
<itemizedlist>
<listitem>
<simpara>
where the <literal>status</literal> field contains <literal>active</literal>
</simpara>
<literallayout class="monospaced">status:active</literallayout>
</listitem>
<listitem>
<simpara>
where the <literal>title</literal> field contains <literal>quick</literal> or <literal>brown</literal>.
  If you omit the OR operator the default operator will be used
</simpara>
<literallayout class="monospaced">title:(quick OR brown)
title:(quick brown)</literallayout>
</listitem>
<listitem>
<simpara>
where the <literal>author</literal> field contains the exact phrase <literal>"john smith"</literal>
</simpara>
<literallayout class="monospaced">author:"John Smith"</literallayout>
</listitem>
<listitem>
<simpara>
where any of the fields <literal>book.title</literal>, <literal>book.content</literal> or <literal>book.date</literal> contains
  <literal>quick</literal> or <literal>brown</literal> (note how we need to escape the <literal>*</literal> with a backslash):
</simpara>
<literallayout class="monospaced">book.\*:(quick brown)</literallayout>
</listitem>
<listitem>
<simpara>
where the field <literal>title</literal> has no value (or is missing):
</simpara>
<literallayout class="monospaced">_missing_:title</literallayout>
</listitem>
<listitem>
<simpara>
where the field <literal>title</literal> has any non-null value:
</simpara>
<literallayout class="monospaced">_exists_:title</literallayout>
</listitem>
</itemizedlist>
</section>
<section id="_wildcards">
<title>Wildcards<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>Wildcard searches can be run on individual terms, using <literal>?</literal> to replace
a single character, and <literal>*</literal> to replace zero or more characters:</simpara>
<literallayout class="monospaced">qu?ck bro*</literallayout>
<simpara>Be aware that wildcard queries can use an enormous amount of memory and
perform very badly&#8201;&#8212;&#8201;just think how many terms need to be queried to
match the query string <literal>"a* b* c*"</literal>.</simpara>
<warning>
<simpara>Allowing a wildcard at the beginning of a word (eg <literal>"*ing"</literal>) is particularly
heavy, because all terms in the index need to be examined, just in case
they match.  Leading wildcards can be disabled by setting
<literal>allow_leading_wildcard</literal> to <literal>false</literal>.</simpara>
</warning>
<simpara>Wildcarded terms are not analyzed by default&#8201;&#8212;&#8201;they are lowercased
(<literal>lowercase_expanded_terms</literal> defaults to <literal>true</literal>) but no further analysis
is done, mainly because it is impossible to accurately analyze a word that
is missing some of its letters.  However, by setting <literal>analyze_wildcard</literal> to
<literal>true</literal>, an attempt will be made to analyze wildcarded words before searching
the term list for matching terms.</simpara>
</section>
<section id="_regular_expressions">
<title>Regular expressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>Regular expression patterns can be embedded in the query string by
wrapping them in forward-slashes (<literal>"/"</literal>):</simpara>
<literallayout class="monospaced">name:/joh?n(ath[oa]n)/</literallayout>
<simpara>The supported regular expression syntax is explained in <xref linkend="regexp-syntax"/>.</simpara>
<warning>
<simpara>The <literal>allow_leading_wildcard</literal> parameter does not have any control over
regular expressions.  A query string such as the following would force
Elasticsearch to visit every term in the index:</simpara>
<literallayout class="monospaced">/.*n/</literallayout>
<simpara>Use with caution!</simpara>
</warning>
</section>
<section id="_fuzziness">
<title>Fuzziness<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>We can search for terms that are
similar to, but not exactly like our search terms, using the &#8220;fuzzy&#8221;
operator:</simpara>
<literallayout class="monospaced">quikc~ brwn~ foks~</literallayout>
<simpara>This uses the
<ulink url="http://en.wikipedia.org/wiki/Damerau-Levenshtein_distance">Damerau-Levenshtein distance</ulink>
to find all terms with a maximum of
two changes, where a change is the insertion, deletion
or substitution of a single character, or transposition of two adjacent
characters.</simpara>
<simpara>The default <emphasis>edit distance</emphasis> is <literal>2</literal>, but an edit distance of <literal>1</literal> should be
sufficient to catch 80% of all human misspellings. It can be specified as:</simpara>
<literallayout class="monospaced">quikc~1</literallayout>
</section>
<section id="_proximity_searches">
<title>Proximity searches<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>While a phrase query (eg <literal>"john smith"</literal>) expects all of the terms in exactly
the same order, a proximity query allows the specified words to be further
apart or in a different order.  In the same way that fuzzy queries can
specify a maximum edit distance for characters in a word, a proximity search
allows us to specify a maximum edit distance of words in a phrase:</simpara>
<literallayout class="monospaced">"fox quick"~5</literallayout>
<simpara>The closer the text in a field is to the original order specified in the
query string, the more relevant that document is considered to be. When
compared to the above example query, the phrase <literal>"quick fox"</literal> would be
considered more relevant than <literal>"quick brown fox"</literal>.</simpara>
</section>
<section id="_ranges">
<title>Ranges<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>Ranges can be specified for date, numeric or string fields. Inclusive ranges
are specified with square brackets <literal>[min TO max]</literal> and exclusive ranges with
curly brackets <literal>{min TO max}</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>
All days in 2012:
</simpara>
<literallayout class="monospaced">date:[2012-01-01 TO 2012-12-31]</literallayout>
</listitem>
<listitem>
<simpara>
Numbers 1..5
</simpara>
<literallayout class="monospaced">count:[1 TO 5]</literallayout>
</listitem>
<listitem>
<simpara>
Tags between <literal>alpha</literal> and <literal>omega</literal>, excluding <literal>alpha</literal> and <literal>omega</literal>:
</simpara>
<literallayout class="monospaced">tag:{alpha TO omega}</literallayout>
</listitem>
<listitem>
<simpara>
Numbers from 10 upwards
</simpara>
<literallayout class="monospaced">count:[10 TO *]</literallayout>
</listitem>
<listitem>
<simpara>
Dates before 2012
</simpara>
<literallayout class="monospaced">date:{* TO 2012-01-01}</literallayout>
</listitem>
</itemizedlist>
<simpara>Curly and square brackets can be combined:</simpara>
<itemizedlist>
<listitem>
<simpara>
Numbers from 1 up to but not including 5
</simpara>
<literallayout class="monospaced">count:[1 TO 5}</literallayout>
</listitem>
</itemizedlist>
<simpara>Ranges with one side unbounded can use the following syntax:</simpara>
<literallayout class="monospaced">age:&gt;10
age:&gt;=10
age:&lt;10
age:&lt;=10</literallayout>
<note>
<simpara>To combine an upper and lower bound with the simplified syntax, you
would need to join two clauses with an <literal>AND</literal> operator:</simpara>
<literallayout class="monospaced">age:(&gt;=10 AND &lt;20)
age:(+&gt;=10 +&lt;20)</literallayout>
</note>
<simpara>The parsing of ranges in query strings can be complex and error prone. It is
much more reliable to use an explicit <link linkend="query-dsl-range-query"><literal>range</literal> query</link>.</simpara>
</section>
<section id="_boosting">
<title>Boosting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>Use the <emphasis>boost</emphasis> operator <literal>^</literal> to make one term more relevant than another.
For instance, if we want to find all documents about foxes, but we are
especially interested in quick foxes:</simpara>
<literallayout class="monospaced">quick^2 fox</literallayout>
<simpara>The default <literal>boost</literal> value is 1, but can be any positive floating point number.
Boosts between 0 and 1 reduce relevance.</simpara>
<simpara>Boosts can also be applied to phrases or to groups:</simpara>
<literallayout class="monospaced">"john smith"^2   (foo bar)^4</literallayout>
</section>
<section id="_boolean_operators">
<title>Boolean operators<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>By default, all terms are optional, as long as one term matches.  A search
for <literal>foo bar baz</literal> will find any document that contains one or more of
<literal>foo</literal> or <literal>bar</literal> or <literal>baz</literal>.  We have already discussed the <literal>default_operator</literal>
above which allows you to force all terms to be required, but there are
also <emphasis>boolean operators</emphasis> which can be used in the query string itself
to provide more control.</simpara>
<simpara>The preferred operators are <literal>+</literal> (this term <emphasis role="strong">must</emphasis> be present) and <literal>-</literal>
(this term <emphasis role="strong">must not</emphasis> be present). All other terms are optional.
For example, this query:</simpara>
<literallayout class="monospaced">quick brown +fox -news</literallayout>
<simpara>states that:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>fox</literal> must be present
</simpara>
</listitem>
<listitem>
<simpara>
<literal>news</literal> must not be present
</simpara>
</listitem>
<listitem>
<simpara>
<literal>quick</literal> and <literal>brown</literal> are optional&#8201;&#8212;&#8201;their presence increases the relevance
</simpara>
</listitem>
</itemizedlist>
<simpara>The familiar operators <literal>AND</literal>, <literal>OR</literal> and <literal>NOT</literal> (also written <literal>&amp;&amp;</literal>, <literal>||</literal> and <literal>!</literal>)
are also supported.  However, the effects of these operators can be more
complicated than is obvious at first glance.  <literal>NOT</literal> takes precedence over
<literal>AND</literal>, which takes precedence over <literal>OR</literal>.  While the <literal>+</literal> and <literal>-</literal> only affect
the term to the right of the operator, <literal>AND</literal> and <literal>OR</literal> can affect the terms to
the left and right.</simpara>
<sidebar>
<simpara>Rewriting the above query using <literal>AND</literal>, <literal>OR</literal> and <literal>NOT</literal> demonstrates the
complexity:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>quick OR brown AND fox AND NOT news</literal>
</term>
<listitem>
<simpara>
This is incorrect, because <literal>brown</literal> is now a required term.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>(quick OR brown) AND fox AND NOT news</literal>
</term>
<listitem>
<simpara>
This is incorrect because at least one of <literal>quick</literal> or <literal>brown</literal> is now required
and the search for those terms would be scored differently from the original
query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>((quick AND fox) OR (brown AND fox) OR fox) AND NOT news</literal>
</term>
<listitem>
<simpara>
This form now replicates the logic from the original query correctly, but
the relevance scoring bears little resemblance to the original.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>In contrast, the same query rewritten using the <link linkend="query-dsl-match-query"><literal>match</literal> query</link>
would look like this:</simpara>
<literallayout class="monospaced">{
    "bool": {
        "must":     { "match": "fox"         },
        "should":   { "match": "quick brown" },
        "must_not": { "match": "news"        }
    }
}</literallayout>
</sidebar>
</section>
<section id="_grouping">
<title>Grouping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>Multiple terms or clauses can be grouped together with parentheses, to form
sub-queries:</simpara>
<literallayout class="monospaced">(quick OR brown) AND fox</literallayout>
<simpara>Groups can be used to target a particular field, or to boost the result
of a sub-query:</simpara>
<literallayout class="monospaced">status:(active OR pending) title:(full text search)^2</literallayout>
</section>
<section id="_reserved_characters">
<title>Reserved characters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>If you need to use any of the characters which function as operators in your
query itself (and not as operators), then you should escape them with
a leading backslash. For instance, to search for <literal>(1+1)=2</literal>, you would
need to write your query as <literal>\(1\+1\)\=2</literal>.</simpara>
<simpara>The reserved characters are:  <literal>+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</literal></simpara>
<simpara>Failing to escape these special characters correctly could lead to a syntax
error which prevents your query from running.</simpara>
<sidebar>
<title>Watch this space</title>
<simpara>A space may also be a reserved character.  For instance, if you have a
synonym list which converts <literal>"wi fi"</literal> to <literal>"wifi"</literal>, a <literal>query_string</literal> search
for <literal>"wi fi"</literal> would fail. The query string parser would interpret your
query as a search for <literal>"wi OR fi"</literal>, while the token stored in your
index is actually <literal>"wifi"</literal>.  Escaping the space will protect it from
being touched by the query string parser: <literal>"wi\ fi"</literal>.</simpara>
</sidebar>
</section>
<section id="_empty_query">
<title>Empty Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/query-string-syntax.asciidoc">Edit me</ulink></title>
<simpara>If the query string is empty or only contains whitespaces the query will
yield an empty result set.</simpara>
</section>
</section>
</section>
<section id="query-dsl-simple-query-string-query">
<title>Simple Query String Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/simple-query-string-query.asciidoc">Edit me</ulink></title>
<simpara>A query that uses the SimpleQueryParser to parse its context. Unlike the
regular <literal>query_string</literal> query, the <literal>simple_query_string</literal> query will never
throw an exception, and discards invalid parts of the query. Here is
an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "simple_query_string" : {
        "query": "\"fried eggs\" +(eggplant | potato) -frittata",
        "analyzer": "snowball",
        "fields": ["body^5","_all"],
        "default_operator": "and"
    }
}</programlisting>
<simpara>The <literal>simple_query_string</literal> top level parameters include:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Parameter </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>query</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The actual query to be parsed. See below for syntax.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>fields</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The fields to perform the parsed query against. Defaults to the
<literal>index.query.default_field</literal> index settings, which in turn defaults to <literal>_all</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>default_operator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The default operator used if no explicit operator
is specified. For example, with a default operator of <literal>OR</literal>, the query
<literal>capital of Hungary</literal> is translated to <literal>capital OR of OR Hungary</literal>, and
with default operator of <literal>AND</literal>, the same query is translated to
<literal>capital AND of AND Hungary</literal>. The default value is <literal>OR</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyzer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The analyzer used to analyze each term of the query when
creating composite queries.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>flags</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Flags specifying which features of the <literal>simple_query_string</literal> to
enable. Defaults to <literal>ALL</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lowercase_expanded_terms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Whether terms of prefix and fuzzy queries should
be automatically lower-cased or not (since they are not analyzed). Defaults to
<literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>analyze_wildcard</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Whether terms of prefix queries should be automatically
analyzed or not. If <literal>true</literal> a best effort will be made to analyze the prefix. However,
some analyzers will be not able to provide a meaningful results
based just on the prefix of a term. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>locale</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Locale that should be used for string conversions.
Defaults to <literal>ROOT</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lenient</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to <literal>true</literal> will cause format based failures
(like providing text to a numeric field) to be ignored.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>minimum_should_match</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The minimum number of clauses that must match for a
 document to be returned. See the
 <link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link> documentation for the
 full list of options.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_simple_query_string_syntax" renderas="sect4">Simple Query String Syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/simple-query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>simple_query_string</literal> supports the following special characters:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>+</literal> signifies AND operation
</simpara>
</listitem>
<listitem>
<simpara>
<literal>|</literal> signifies OR operation
</simpara>
</listitem>
<listitem>
<simpara>
<literal>-</literal> negates a single token
</simpara>
</listitem>
<listitem>
<simpara>
<literal>"</literal> wraps a number of tokens to signify a phrase for searching
</simpara>
</listitem>
<listitem>
<simpara>
<literal>*</literal> at the end of a term signifies a prefix query
</simpara>
</listitem>
<listitem>
<simpara>
<literal>(</literal> and <literal>)</literal> signify precedence
</simpara>
</listitem>
<listitem>
<simpara>
<literal>~N</literal> after a word signifies edit distance (fuzziness)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>~N</literal> after a phrase signifies slop amount
</simpara>
</listitem>
</itemizedlist>
<simpara>In order to search for any of these special characters, they will need to
be escaped with <literal>\</literal>.</simpara>
<bridgehead id="_default_field_2" renderas="sect3">Default Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/simple-query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>When not explicitly specifying the field to search on in the query
string syntax, the <literal>index.query.default_field</literal> will be used to derive
which field to search on. It defaults to <literal>_all</literal> field.</simpara>
<simpara>So, if <literal>_all</literal> field is disabled, it might make sense to change it to set
a different default field.</simpara>
<bridgehead id="_multi_field_2" renderas="sect3">Multi Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/simple-query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "simple_query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "foo bar baz"
    }
}</programlisting>
<bridgehead id="_flags" renderas="sect3">Flags<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/simple-query-string-query.asciidoc">Edit me</ulink></bridgehead>
<simpara><literal>simple_query_string</literal> support multiple flags to specify which parsing features
should be enabled. It is specified as a <literal>|</literal>-delimited string with the
<literal>flags</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "simple_query_string" : {
        "query" : "foo | bar + baz*",
        "flags" : "OR|AND|PREFIX"
    }
}</programlisting>
<simpara>The available flags are: <literal>ALL</literal>, <literal>NONE</literal>, <literal>AND</literal>, <literal>OR</literal>, <literal>NOT</literal>, <literal>PREFIX</literal>, <literal>PHRASE</literal>,
<literal>PRECEDENCE</literal>, <literal>ESCAPE</literal>, <literal>WHITESPACE</literal>, <literal>FUZZY</literal>, <literal>NEAR</literal>, and <literal>SLOP</literal>.</simpara>
</section>
</chapter>
<chapter id="term-level-queries">
<title>Term level queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/term-level-queries.asciidoc">Edit me</ulink></title>
<simpara>While the <link linkend="full-text-queries">full text queries</link> will analyze the query
string before executing, the <emphasis>term-level queries</emphasis> operate on the exact terms
that are stored in the inverted index.</simpara>
<simpara>These queries are usually used for structured data like numbers, dates, and
enums, rather than full text fields.  Alternatively, they allow you to craft
low-level queries, foregoing the analysis process.</simpara>
<simpara>The queries in this group are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-term-query"><literal>term</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents which contain the exact term specified in the field
    specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-terms-query"><literal>terms</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents which contain any of the exact terms specified in the field
    specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-range-query"><literal>range</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains values (dates, numbers,
    or strings) in the range specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-exists-query"><literal>exists</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains any non-null value.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-missing-query"><literal>missing</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified does is missing or contains only
    <literal>null</literal> values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-prefix-query"><literal>prefix</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains terms which begin with
    the exact prefix specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-wildcard-query"><literal>wildcard</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains terms which match the
    pattern specified, where the pattern supports single character wildcards
    (<literal>?</literal>) and multi-character wildcards (<literal>*</literal>)
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-regexp-query"><literal>regexp</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains terms which match the
    <link linkend="regexp-syntax">regular expression</link> specified.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-fuzzy-query"><literal>fuzzy</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents where the field specified contains terms which are fuzzily
    similar to the specified term.  Fuzziness is measured as a
    <ulink url="http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">Levenshtein edit distance</ulink>
    of 1 or 2.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-type-query"><literal>type</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents of the specified type.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-ids-query"><literal>ids</literal> query</link>
</term>
<listitem>
<simpara>
    Find documents with the specified type and IDs.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="query-dsl-term-query">
<title>Term Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/term-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>term</literal> query finds documents that contain the <emphasis role="strong">exact</emphasis> term specified
in the inverted index.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "term" : { "user" : "Kimchy" } <co id="CO133-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO133-1">
<para>
Finds documents which contain the exact term <literal>Kimchy</literal> in the inverted index
    of the <literal>user</literal> field.
</para>
</callout>
</calloutlist>
<simpara>A <literal>boost</literal> parameter can be specified to give this <literal>term</literal> query a higher
relevance score than another query, for instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
  "query": {
    "bool": {
      "should": [
        {
          "term": {
            "status": {
              "value": "urgent",
              "boost": 2.0 <co id="CO134-1"/>
            }
          }
        },
        {
          "term": {
            "status": "normal" <co id="CO134-2"/>
          }
        }
      ]
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO134-1">
<para>
The <literal>urgent</literal> query clause has a boost of <literal>2.0</literal>, meaning it is twice as important
    as the query clause for <literal>normal</literal>.
</para>
</callout>
<callout arearefs="CO134-2">
<para>
The <literal>normal</literal> clause has the default neutral boost of <literal>1.0</literal>.
</para>
</callout>
</calloutlist>
<sidebar>
<title>Why doesn&#8217;t the <literal>term</literal> query match my document?</title>
<simpara>String fields can be <literal>analyzed</literal> (treated as full text, like the body of an
email), or <literal>not_analyzed</literal> (treated as exact values, like an email address or a
zip code).  Exact values (like numbers, dates, and <literal>not_analyzed</literal> strings) have
the exact value specified in the field added to the inverted index in order
to make them searchable.</simpara>
<simpara>By default, however, <literal>string</literal> fields are <literal>analyzed</literal>. This means that their
values are first passed through an <link linkend="analysis">analyzer</link> to produce a list of
terms, which are then added to the inverted index.</simpara>
<simpara>There are many ways to analyze text: the default
<link linkend="analysis-standard-analyzer"><literal>standard</literal> analyzer</link> drops most punctuation,
breaks up text into individual words, and lower cases them.    For instance,
the <literal>standard</literal> analyzer would turn the string &#8220;Quick Brown Fox!&#8221; into the
terms [<literal>quick</literal>, <literal>brown</literal>, <literal>fox</literal>].</simpara>
<simpara>This analysis process makes it possible to search for individual words
within a big block of full text.</simpara>
<simpara>The <literal>term</literal> query looks for the <emphasis role="strong">exact</emphasis> term in the field&#8217;s inverted index&#8201;&#8212;&#8201;it doesn&#8217;t know anything about the field&#8217;s analyzer.  This makes it useful for
looking up values in <literal>not_analyzed</literal> string fields, or in numeric or date
fields.  When querying full text fields, use the
<link linkend="query-dsl-match-query"><literal>match</literal> query</link> instead, which understands how the field
has been analyzed.</simpara>
<simpara>To demonstrate, try out the example below.  First, create an index, specifying the field mappings, and index a document:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "full_text": {
          "type":  "string" <co id="CO135-1"/>
        },
        "exact_value": {
          "type":  "string",
          "index": "not_analyzed" <co id="CO135-2"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "full_text":   "Quick Foxes!", <co id="CO135-3"/>
  "exact_value": "Quick Foxes!"  <co id="CO135-4"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO135-1">
<para>
The <literal>full_text</literal> field is <literal>analyzed</literal> by default.
</para>
</callout>
<callout arearefs="CO135-2">
<para>
The <literal>exact_value</literal> field is set to be <literal>not_analyzed</literal>.
</para>
</callout>
<callout arearefs="CO135-3">
<para>
The <literal>full_text</literal> inverted index will contain the terms: [<literal>quick</literal>, <literal>foxes</literal>].
</para>
</callout>
<callout arearefs="CO135-4">
<para>
The <literal>exact_value</literal> inverted index will contain the exact term: [<literal>Quick Foxes!</literal>].
</para>
</callout>
</calloutlist>
<simpara>Now, compare the results for the <literal>term</literal> query and the <literal>match</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/my_type/_search
{
  "query": {
    "term": {
      "exact_value": "Quick Foxes!" <co id="CO136-1"/>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "term": {
      "full_text": "Quick Foxes!" <co id="CO136-2"/>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "term": {
      "full_text": "foxes" <co id="CO136-3"/>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "match": {
      "full_text": "Quick Foxes!" <co id="CO136-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO136-1">
<para>
This query matches because the <literal>exact_value</literal> field contains the exact
    term <literal>Quick Foxes!</literal>.
</para>
</callout>
<callout arearefs="CO136-2">
<para>
This query does not match, because the <literal>full_text</literal> field only contains
    the terms <literal>quick</literal> and <literal>foxes</literal>. It does not contain the exact term
    <literal>Quick Foxes!</literal>.
</para>
</callout>
<callout arearefs="CO136-3">
<para>
A <literal>term</literal> query for the term <literal>foxes</literal> matches the <literal>full_text</literal> field.
</para>
</callout>
<callout arearefs="CO136-4">
<para>
This <literal>match</literal> query on the <literal>full_text</literal> field first analyzes the query string,
    then looks for documents containing <literal>quick</literal> or <literal>foxes</literal> or both.
</para>
</callout>
</calloutlist>
</sidebar>
</section>
<section id="query-dsl-terms-query">
<title>Terms Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/terms-query.asciidoc">Edit me</ulink></title>
<simpara>Filters documents that have fields that match any of the provided terms
(<emphasis role="strong">not analyzed</emphasis>). For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "constant_score" : {
        "filter" : {
            "terms" : { "user" : ["kimchy", "elasticsearch"]}
        }
    }
}</programlisting>
<simpara>The <literal>terms</literal> query is also aliased with <literal>in</literal> as the filter name for
simpler usage.</simpara>
<bridgehead id="query-dsl-terms-lookup" renderas="sect4">Terms lookup mechanism<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/terms-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>When it&#8217;s needed to specify a <literal>terms</literal> filter with a lot of terms it can
be beneficial to fetch those term values from a document in an index. A
concrete example would be to filter tweets tweeted by your followers.
Potentially the amount of user ids specified in the terms filter can be
a lot. In this scenario it makes sense to use the terms filter&#8217;s terms
lookup mechanism.</simpara>
<simpara>The terms lookup mechanism supports the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>index</literal>
</simpara>
</entry>
<entry>
<simpara>
    The index to fetch the term values from. Defaults to the
    current index.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>type</literal>
</simpara>
</entry>
<entry>
<simpara>
    The type to fetch the term values from.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>id</literal>
</simpara>
</entry>
<entry>
<simpara>
    The id of the document to fetch the term values from.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>path</literal>
</simpara>
</entry>
<entry>
<simpara>
    The field specified as path to fetch the actual values for the
    <literal>terms</literal> filter.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>routing</literal>
</simpara>
</entry>
<entry>
<simpara>
    A custom routing value to be used when retrieving the
    external terms doc.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The values for the <literal>terms</literal> filter will be fetched from a field in a
document with the specified id in the specified type and index.
Internally a get request is executed to fetch the values from the
specified path. At the moment for this feature to work the <literal>_source</literal>
needs to be stored.</simpara>
<simpara>Also, consider using an index with a single shard and fully replicated
across all nodes if the "reference" terms data is not large. The lookup
terms filter will prefer to execute the get request on a local node if
possible, reducing the need for networking.</simpara>
<bridgehead id="_terms_lookup_twitter_example" renderas="sect4">Terms lookup twitter example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/terms-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered"># index the information for user with id 2, specifically, its followers
curl -XPUT localhost:9200/users/user/2 -d '{
   "followers" : ["1", "3"]
}'

# index a tweet, from user with id 1
curl -XPUT localhost:9200/tweets/tweet/1 -d '{
   "user" : "1"
}'

# search on all the tweets that match the followers of user 2
curl -XGET localhost:9200/tweets/_search -d '{
  "query" : {
    "terms" : {
      "user" : {
        "index" : "users",
        "type" : "user",
        "id" : "2",
        "path" : "followers"
      }
    }
  }
}'</programlisting>
<simpara>The structure of the external terms document can also include array of
inner objects, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/users/user/2 -d '{
 "followers" : [
   {
     "id" : "1"
   },
   {
     "id" : "2"
   }
 ]
}'</programlisting>
<simpara>In which case, the lookup path will be <literal>followers.id</literal>.</simpara>
</section>
<section id="query-dsl-range-query">
<title>Range Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/range-query.asciidoc">Edit me</ulink></title>
<simpara>Matches documents with fields that have terms within a certain range.
The type of the Lucene query depends on the field type, for <literal>string</literal>
fields, the <literal>TermRangeQuery</literal>, while for number/date fields, the query is
a <literal>NumericRangeQuery</literal>. The following example returns all documents where
<literal>age</literal> is between <literal>10</literal> and <literal>20</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range" : {
        "age" : {
            "gte" : 10,
            "lte" : 20,
            "boost" : 2.0
        }
    }
}</programlisting>
<simpara>The <literal>range</literal> query accepts the following parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>gte</literal>
</simpara>
</entry>
<entry>
<simpara>
Greater-than or equal to
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>gt</literal>
</simpara>
</entry>
<entry>
<simpara>
Greater-than
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lte</literal>
</simpara>
</entry>
<entry>
<simpara>
Less-than or equal to
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lt</literal>
</simpara>
</entry>
<entry>
<simpara>
Less-than
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>boost</literal>
</simpara>
</entry>
<entry>
<simpara>
Sets the boost value of the query, defaults to <literal>1.0</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<section id="ranges-on-dates">
<title>Ranges on date fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/range-query.asciidoc">Edit me</ulink></title>
<simpara>When running <literal>range</literal> queries on fields of type <link linkend="date"><literal>date</literal></link>, ranges can be
specified using <xref linkend="date-math"/>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range" : {
        "date" : {
            "gte" : "now-1d/d",
            "lt" :  "now/d"
        }
    }
}</programlisting>
<section id="_date_math_and_rounding">
<title>Date math and rounding<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/range-query.asciidoc">Edit me</ulink></title>
<simpara>When using <link linkend="date-math">date math</link> to round dates to the nearest day, month,
hour, etc, the rounded dates depend on whether the ends of the ranges are
inclusive or exclusive.</simpara>
<simpara>Rounding up moves to the last millisecond of the rounding scope, and rounding
down to the first millisecond of the rounding scope. For example:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>gt</literal>
</simpara>
</entry>
<entry>
<simpara>
    Greater than the date rounded up: <literal>2014-11-18||/M</literal> becomes
    <literal>2014-11-30T23:59:59.999</literal>, ie excluding the entire month.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>gte</literal>
</simpara>
</entry>
<entry>
<simpara>
    Greater than or equal to the date rounded down: <literal>2014-11-18||/M</literal> becomes
    <literal>2014-11-01</literal>, ie including the entire month.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lt</literal>
</simpara>
</entry>
<entry>
<simpara>
    Less than the date rounded down: <literal>2014-11-18||/M</literal> becomes <literal>2014-11-01</literal>, ie
    excluding the entire month.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lte</literal>
</simpara>
</entry>
<entry>
<simpara>
    Less than or equal to the date rounded up: <literal>2014-11-18||/M</literal> becomes
    <literal>2014-11-30T23:59:59.999</literal>, ie including the entire month.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_date_format_in_range_queries">
<title>Date format in range queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/range-query.asciidoc">Edit me</ulink></title>
<simpara>Formatted dates will be parsed using the <link linkend="mapping-date-format"><literal>format</literal></link>
specified on the <link linkend="date"><literal>date</literal></link> field by default, but it can be overridden by
passing the <literal>format</literal> parameter to the <literal>range</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range" : {
        "born" : {
            "gte": "01/01/2012",
            "lte": "2013",
            "format": "dd/MM/yyyy||yyyy"
        }
    }
}</programlisting>
</section>
<section id="_time_zone_in_range_queries">
<title>Time zone in range queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/range-query.asciidoc">Edit me</ulink></title>
<simpara>Dates can be converted from another timezone to UTC either by specifying the
time zone in the date value itself (if the <link linkend="mapping-date-format"><literal>format</literal></link>
accepts it), or it can be specified as the <literal>time_zone</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "range" : {
        "timestamp" : {
            "gte": "2015-01-01 00:00:00", <co id="CO137-1"/>
            "lte": "now", <co id="CO137-2"/>
            "time_zone": "+01:00"
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO137-1">
<para>
This date will be converted to <literal>2014-12-31T23:00:00 UTC</literal>.
</para>
</callout>
<callout arearefs="CO137-2">
<para>
<literal>now</literal> is not affected by the <literal>time_zone</literal> parameter (dates must be stored as UTC).
</para>
</callout>
</calloutlist>
</section>
</section>
</section>
<section id="query-dsl-exists-query">
<title>Exists Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/exists-query.asciidoc">Edit me</ulink></title>
<simpara>Returns documents that have at least one non-<literal>null</literal> value in the original field:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "exists" : { "field" : "user" }
}</programlisting>
<simpara>For instance, these documents would all match the above query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": "jane" }
{ "user": "" } <co id="CO138-1"/>
{ "user": "-" } <co id="CO138-2"/>
{ "user": ["jane"] }
{ "user": ["jane", null ] } <co id="CO138-3"/></programlisting>
<calloutlist>
<callout arearefs="CO138-1">
<para>
An empty string is a non-<literal>null</literal> value.
</para>
</callout>
<callout arearefs="CO138-2">
<para>
Even though the <literal>standard</literal> analyzer would emit zero tokens, the original field is non-<literal>null</literal>.
</para>
</callout>
<callout arearefs="CO138-3">
<para>
At least one non-<literal>null</literal> value is required.
</para>
</callout>
</calloutlist>
<simpara>These documents would <emphasis role="strong">not</emphasis> match the above query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": null }
{ "user": [] } <co id="CO139-1"/>
{ "user": [null] } <co id="CO139-2"/>
{ "foo":  "bar" } <co id="CO139-3"/></programlisting>
<calloutlist>
<callout arearefs="CO139-1">
<para>
This field has no values.
</para>
</callout>
<callout arearefs="CO139-2">
<para>
At least one non-<literal>null</literal> value is required.
</para>
</callout>
<callout arearefs="CO139-3">
<para>
The <literal>user</literal> field is missing completely.
</para>
</callout>
</calloutlist>
<bridgehead id="_literal_null_value_literal_mapping" renderas="sect3"><literal>null_value</literal> mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/exists-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>If the field mapping includes the <link linkend="null-value"><literal>null_value</literal></link> setting
then explicit <literal>null</literal> values are replaced with the specified <literal>null_value</literal>.  For
instance, if the <literal>user</literal> field were mapped as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "user": {
    "type": "string",
    "null_value": "_null_"
  }</programlisting>
<simpara>then explicit <literal>null</literal> values would be indexed as the string <literal>_null_</literal>, and the
following docs would match the <literal>exists</literal> filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": null }
{ "user": [null] }</programlisting>
<simpara>However, these docs&#8212;without explicit <literal>null</literal> values&#8212;would still have
no values in the <literal>user</literal> field and thus would not match the <literal>exists</literal> filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": [] }
{ "foo": "bar" }</programlisting>
<section id="_literal_missing_literal_query">
<title><literal>missing</literal> query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/exists-query.asciidoc">Edit me</ulink></title>
<simpara>The exists query can advantageously replace the <literal>missing</literal> query when used inside a must_not clause as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">"bool": {
    "must_not": {
        "exists": {
            "field": "user"
        }
    }
}</programlisting>
<simpara>This query returns documents that have no value in the user field.</simpara>
</section>
</section>
<section id="query-dsl-missing-query">
<title>Missing Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/missing-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.2.0"><title>Deprecated in 2.2.0.</title><simpara> Use <literal>exists</literal> query inside a <literal>must_not</literal> clause instead.</simpara></warning>
<simpara>Returns documents that have only <literal>null</literal> values or no value in the original field:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "constant_score" : {
        "filter" : {
            "missing" : { "field" : "user" }
        }
    }
}</programlisting>
<simpara>For instance, the following docs would match the above filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": null }
{ "user": [] } <co id="CO140-1"/>
{ "user": [null] } <co id="CO140-2"/>
{ "foo":  "bar" } <co id="CO140-3"/></programlisting>
<calloutlist>
<callout arearefs="CO140-1">
<para>
This field has no values.
</para>
</callout>
<callout arearefs="CO140-2">
<para>
This field has no non-<literal>null</literal> values.
</para>
</callout>
<callout arearefs="CO140-3">
<para>
The <literal>user</literal> field is missing completely.
</para>
</callout>
</calloutlist>
<simpara>These documents would <emphasis role="strong">not</emphasis> match the above filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": "jane" }
{ "user": "" } <co id="CO141-1"/>
{ "user": "-" } <co id="CO141-2"/>
{ "user": ["jane"] }
{ "user": ["jane", null ] } <co id="CO141-3"/></programlisting>
<calloutlist>
<callout arearefs="CO141-1">
<para>
An empty string is a non-<literal>null</literal> value.
</para>
</callout>
<callout arearefs="CO141-2">
<para>
Even though the <literal>standard</literal> analyzer would emit zero tokens, the original field is non-<literal>null</literal>.
</para>
</callout>
<callout arearefs="CO141-3">
<para>
This field has one non-<literal>null</literal> value.
</para>
</callout>
</calloutlist>
<bridgehead id="_literal_null_value_literal_mapping_2" renderas="sect3"><literal>null_value</literal> mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/missing-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>If the field mapping includes a <link linkend="null-value"><literal>null_value</literal></link> then explicit <literal>null</literal> values
are replaced with the specified <literal>null_value</literal>.  For instance, if the <literal>user</literal> field were mapped
as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "user": {
    "type": "string",
    "null_value": "_null_"
  }</programlisting>
<simpara>then explicit <literal>null</literal> values would be indexed as the string <literal>_null_</literal>, and the
the following docs would <emphasis role="strong">not</emphasis> match the <literal>missing</literal> filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": null }
{ "user": [null] }</programlisting>
<simpara>However, these docs&#8212;without explicit <literal>null</literal> values&#8212;would still have
no values in the <literal>user</literal> field and thus would match the <literal>missing</literal> filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": [] }
{ "foo": "bar" }</programlisting>
<bridgehead id="_literal_existence_literal_and_literal_null_value_literal_parameters" renderas="sect4"><literal>existence</literal> and <literal>null_value</literal> parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/missing-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>When the field being queried has a <literal>null_value</literal> mapping, then the behaviour of
the <literal>missing</literal> filter can be altered with the <literal>existence</literal> and <literal>null_value</literal>
parameters:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "constant_score" : {
        "filter" : {
            "missing" : {
                "field" : "user",
                "existence" : true,
                "null_value" : false
            }
        }
    }
}</programlisting>
<variablelist>
<varlistentry>
<term>
<literal>existence</literal>
</term>
<listitem>
<simpara>When the <literal>existence</literal> parameter is set to <literal>true</literal> (the default), the missing
filter will include documents where the field has <emphasis role="strong">no</emphasis> values, ie:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": [] }
{ "foo": "bar" }</programlisting>
<simpara>When set to <literal>false</literal>, these documents will not be included.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>null_value</literal>
</term>
<listitem>
<simpara>When the <literal>null_value</literal> parameter is set to <literal>true</literal>, the missing
filter will include documents where the field contains a <literal>null</literal> value, ie:</simpara>
<programlisting language="js" linenumbering="unnumbered">{ "user": null }
{ "user": [null] }
{ "user": ["jane",null] } <co id="CO142-1"/></programlisting>
<calloutlist>
<callout arearefs="CO142-1">
<para>
Matches because the field contains a <literal>null</literal> value, even though it also contains a non-<literal>null</literal> value.
</para>
</callout>
</calloutlist>
<simpara>When set to <literal>false</literal> (the default), these documents will not be included.</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>Either <literal>existence</literal> or <literal>null_value</literal> or both must be set to <literal>true</literal>.</simpara></note>
</section>
<section id="query-dsl-prefix-query">
<title>Prefix Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/prefix-query.asciidoc">Edit me</ulink></title>
<simpara>Matches documents that have fields containing terms with a specified
prefix (<emphasis role="strong">not analyzed</emphasis>). The prefix query maps to Lucene <literal>PrefixQuery</literal>.
The following matches documents where the user field contains a term
that starts with <literal>ki</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "prefix" : { "user" : "ki" }
}</programlisting>
<simpara>A boost can also be associated with the query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "prefix" : { "user" :  { "value" : "ki", "boost" : 2.0 } }
}</programlisting>
<simpara>Or :</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "prefix" : { "user" :  { "prefix" : "ki", "boost" : 2.0 } }
}</programlisting>
<simpara>This multi term query allows you to control how it gets rewritten using the
<link linkend="query-dsl-multi-term-rewrite">rewrite</link>
parameter.</simpara>
</section>
<section id="query-dsl-wildcard-query">
<title>Wildcard Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/wildcard-query.asciidoc">Edit me</ulink></title>
<simpara>Matches documents that have fields matching a wildcard expression (<emphasis role="strong">not
analyzed</emphasis>). Supported wildcards are <literal>*</literal>, which matches any character
sequence (including the empty one), and <literal>?</literal>, which matches any single
character. Note that this query can be slow, as it needs to iterate over many
terms. In order to prevent extremely slow wildcard queries, a wildcard
term should not start with one of the wildcards <literal>*</literal> or <literal>?</literal>. The wildcard
query maps to Lucene <literal>WildcardQuery</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "wildcard" : { "user" : "ki*y" }
}</programlisting>
<simpara>A boost can also be associated with the query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "wildcard" : { "user" : { "value" : "ki*y", "boost" : 2.0 } }
}</programlisting>
<simpara>Or :</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "wildcard" : { "user" : { "wildcard" : "ki*y", "boost" : 2.0 } }
}</programlisting>
<simpara>This multi term query allows to control how it gets rewritten using the
<link linkend="query-dsl-multi-term-rewrite">rewrite</link>
parameter.</simpara>
</section>
<section id="query-dsl-regexp-query">
<title>Regexp Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/regexp-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>regexp</literal> query allows you to use regular expression term queries.
See <xref linkend="regexp-syntax"/> for details of the supported regular expression language.
The "term queries" in that first sentence means that Elasticsearch will apply
the regexp to the terms produced by the tokenizer for that field, and not
to the original text of the field.</simpara>
<simpara><emphasis role="strong">Note</emphasis>: The performance of a <literal>regexp</literal> query heavily depends on the
regular expression chosen. Matching everything like <literal>.*</literal> is very slow as
well as using lookaround regular expressions. If possible, you should
try to use a long prefix before your regular expression starts. Wildcard
matchers like <literal>.*?+</literal> will mostly lower performance.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "regexp":{
        "name.first": "s.*y"
    }
}</programlisting>
<simpara>Boosting is also supported</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "regexp":{
        "name.first":{
            "value":"s.*y",
            "boost":1.2
        }
    }
}</programlisting>
<simpara>You can also use special flags</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "regexp":{
        "name.first": {
            "value": "s.*y",
            "flags" : "INTERSECTION|COMPLEMENT|EMPTY"
        }
    }
}</programlisting>
<simpara>Possible flags are <literal>ALL</literal> (default), <literal>ANYSTRING</literal>, <literal>COMPLEMENT</literal>,
<literal>EMPTY</literal>, <literal>INTERSECTION</literal>, <literal>INTERVAL</literal>, or <literal>NONE</literal>. Please check the
<ulink url="http://lucene.apache.org/core/4_9_0/core/org/apache/lucene/util/automaton/RegExp.html">Lucene
documentation</ulink> for their meaning</simpara>
<simpara>Regular expressions are dangerous because it&#8217;s easy to accidentally
create an innocuous looking one that requires an exponential number of
internal determinized automaton states (and corresponding RAM and CPU)
for Lucene to execute.  Lucene prevents these using the
<literal>max_determinized_states</literal> setting (defaults to 10000).  You can raise
this limit to allow more complex regular expressions to execute.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "regexp":{
        "name.first": {
            "value": "s.*y",
            "flags" : "INTERSECTION|COMPLEMENT|EMPTY",
            "max_determinized_states": 20000
        }
    }
}</programlisting>
<section id="regexp-syntax">
<title>Regular expression syntax<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/regexp-syntax.asciidoc">Edit me</ulink></title>
<simpara>Regular expression queries are supported by the <literal>regexp</literal> and the <literal>query_string</literal>
queries.  The Lucene regular expression engine
is not Perl-compatible but supports a smaller range of operators.</simpara>
<note>
<simpara>We will not attempt to explain regular expressions, but
just explain the supported operators.</simpara>
</note>
<section id="_standard_operators">
<title>Standard operators<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/regexp-syntax.asciidoc">Edit me</ulink></title>
<variablelist>
<varlistentry>
<term>
Anchoring
</term>
<listitem>
<simpara>Most regular expression engines allow you to match any part of a string.
If you want the regexp pattern to start at the beginning of the string or
finish at the end of the string, then you have to <emphasis>anchor</emphasis> it specifically,
using <literal>^</literal> to indicate the beginning or <literal>$</literal> to indicate the end.</simpara>
<simpara>Lucene&#8217;s patterns are always anchored.  The pattern provided must match
the entire string. For string <literal>"abcde"</literal>:</simpara>
<literallayout class="monospaced">ab.*     # match
abcd     # no match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allowed characters
</term>
<listitem>
<simpara>Any Unicode characters may be used in the pattern, but certain characters
are reserved and must be escaped.  The standard reserved characters are:</simpara>
<literallayout class="monospaced">. ? + * | { } [ ] ( ) " \</literallayout>
<simpara>If you enable optional features (see below) then these characters may
also be reserved:</simpara>
<literallayout class="monospaced"># @ &amp; &lt; &gt;  ~</literallayout>
<simpara>Any reserved character can be escaped with a backslash <literal>"\*"</literal> including
a literal backslash character: <literal>"\\"</literal></simpara>
<simpara>Additionally, any characters (except double quotes) are interpreted literally
when surrounded by double quotes:</simpara>
<literallayout class="monospaced">john"@smith.com"</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Match any character
</term>
<listitem>
<simpara>The period <literal>"."</literal> can be used to represent any character.  For string <literal>"abcde"</literal>:</simpara>
<literallayout class="monospaced">ab...   # match
a.c.e   # match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
One-or-more
</term>
<listitem>
<simpara>The plus sign <literal>"+"</literal> can be used to repeat the preceding shortest pattern
once or more times. For string <literal>"aaabbb"</literal>:</simpara>
<literallayout class="monospaced">a+b+        # match
aa+bb+      # match
a+.+        # match
aa+bbb+     # match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Zero-or-more
</term>
<listitem>
<simpara>The asterisk <literal>"*"</literal> can be used to match the preceding shortest pattern
zero-or-more times.  For string <literal>"aaabbb</literal>":</simpara>
<literallayout class="monospaced">a*b*        # match
a*b*c*      # match
.*bbb.*     # match
aaa*bbb*    # match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Zero-or-one
</term>
<listitem>
<simpara>The question mark <literal>"?"</literal> makes the preceding shortest pattern optional. It
matches zero or one times.  For string <literal>"aaabbb"</literal>:</simpara>
<literallayout class="monospaced">aaa?bbb?    # match
aaaa?bbbb?  # match
.....?.?    # match
aa?bb?      # no match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Min-to-max
</term>
<listitem>
<simpara>Curly brackets <literal>"{}"</literal> can be used to specify a minimum and (optionally)
a maximum number of times the preceding shortest pattern can repeat.  The
allowed forms are:</simpara>
<literallayout class="monospaced">{5}     # repeat exactly 5 times
{2,5}   # repeat at least twice and at most 5 times
{2,}    # repeat at least twice</literallayout>
<simpara>For string <literal>"aaabbb"</literal>:</simpara>
<literallayout class="monospaced">a{3}b{3}        # match
a{2,4}b{2,4}    # match
a{2,}b{2,}      # match
.{3}.{3}        # match
a{4}b{4}        # no match
a{4,6}b{4,6}    # no match
a{4,}b{4,}      # no match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Grouping
</term>
<listitem>
<simpara>Parentheses <literal>"()"</literal> can be used to form sub-patterns. The quantity operators
listed above operate on the shortest previous pattern, which can be a group.
For string <literal>"ababab"</literal>:</simpara>
<literallayout class="monospaced">(ab)+       # match
ab(ab)+     # match
(..)+       # match
(...)+      # no match
(ab)*       # match
abab(ab)?   # match
ab(ab)?     # no match
(ab){3}     # match
(ab){1,2}   # no match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Alternation
</term>
<listitem>
<simpara>The pipe symbol <literal>"|"</literal> acts as an OR operator. The match will succeed if
the pattern on either the left-hand side OR the right-hand side matches.
The alternation applies to the <emphasis>longest pattern</emphasis>, not the shortest.
For string <literal>"aabb"</literal>:</simpara>
<literallayout class="monospaced">aabb|bbaa   # match
aacc|bb     # no match
aa(cc|bb)   # match
a+|b+       # no match
a+b+|b+a+   # match
a+(b|c)+    # match</literallayout>
</listitem>
</varlistentry>
<varlistentry>
<term>
Character classes
</term>
<listitem>
<simpara>Ranges of potential characters may be represented as character classes
by enclosing them in square brackets <literal>"[]"</literal>. A leading <literal>^</literal>
negates the character class. The allowed forms are:</simpara>
<literallayout class="monospaced">[abc]   # 'a' or 'b' or 'c'
[a-c]   # 'a' or 'b' or 'c'
[-abc]  # '-' or 'a' or 'b' or 'c'
[abc\-] # '-' or 'a' or 'b' or 'c'
[^abc]  # any character except 'a' or 'b' or 'c'
[^a-c]  # any character except 'a' or 'b' or 'c'
[^-abc]  # any character except '-' or 'a' or 'b' or 'c'
[^abc\-] # any character except '-' or 'a' or 'b' or 'c'</literallayout>
<simpara>Note that the dash <literal>"-"</literal> indicates a range of characters, unless it is
the first character or if it is escaped with a backslash.</simpara>
<simpara>For string <literal>"abcd"</literal>:</simpara>
<literallayout class="monospaced">ab[cd]+     # match
[a-d]+      # match
[^a-d]+     # no match</literallayout>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_optional_operators">
<title>Optional operators<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/regexp-syntax.asciidoc">Edit me</ulink></title>
<simpara>These operators are available by default as the <literal>flags</literal> parameter defaults to <literal>ALL</literal>.
Different flag combinations (concatenated with <literal>"|"</literal>) can be used to enable/disable
specific operators:</simpara>
<literallayout class="monospaced">{
    "regexp": {
        "username": {
            "value": "john~athon&lt;1-5&gt;",
            "flags": "COMPLEMENT|INTERVAL"
        }
    }
}</literallayout>
<variablelist>
<varlistentry>
<term>
Complement
</term>
<listitem>
<simpara>The complement is probably the most useful option. The shortest pattern that
follows a tilde <literal>"~"</literal> is negated.  For instance, `"ab~cd" means:</simpara>
<itemizedlist>
<listitem>
<simpara>
Starts with <literal>a</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Followed by <literal>b</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Followed by a string of any length that it anything but <literal>c</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Ends with <literal>d</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>For the string <literal>"abcdef"</literal>:</simpara>
<literallayout class="monospaced">ab~df     # match
ab~cf     # match
ab~cdef   # no match
a~(cb)def # match
a~(bc)def # no match</literallayout>
<simpara>Enabled with the <literal>COMPLEMENT</literal> or <literal>ALL</literal> flags.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Interval
</term>
<listitem>
<simpara>The interval option enables the use of numeric ranges, enclosed by angle
brackets <literal>"&lt;&gt;"</literal>. For string: <literal>"foo80"</literal>:</simpara>
<literallayout class="monospaced">foo&lt;1-100&gt;     # match
foo&lt;01-100&gt;    # match
foo&lt;001-100&gt;   # no match</literallayout>
<simpara>Enabled with the <literal>INTERVAL</literal> or <literal>ALL</literal> flags.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Intersection
</term>
<listitem>
<simpara>The ampersand <literal>"&amp;"</literal> joins two patterns in a way that both of them have to
match. For string <literal>"aaabbb"</literal>:</simpara>
<literallayout class="monospaced">aaa.+&amp;.+bbb     # match
aaa&amp;bbb         # no match</literallayout>
<simpara>Using this feature usually means that you should rewrite your regular
expression.</simpara>
<simpara>Enabled with the <literal>INTERSECTION</literal> or <literal>ALL</literal> flags.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Any string
</term>
<listitem>
<simpara>The at sign <literal>"@"</literal> matches any string in its entirety.  This could be combined
with the intersection and complement above to express &#8220;everything except&#8221;.
For instance:</simpara>
<literallayout class="monospaced">@&amp;~(foo.+)      # anything except string beginning with "foo"</literallayout>
<simpara>Enabled with the <literal>ANYSTRING</literal> or <literal>ALL</literal> flags.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
</section>
<section id="query-dsl-fuzzy-query">
<title>Fuzzy Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/fuzzy-query.asciidoc">Edit me</ulink></title>
<simpara>The fuzzy query uses similarity based on Levenshtein edit distance for
<literal>string</literal> fields, and a <literal>+/-</literal> margin on numeric and date fields.</simpara>
<section id="_string_fields_2">
<title>String fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/fuzzy-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>fuzzy</literal> query generates all possible matching terms that are within  the
maximum edit distance specified in <literal>fuzziness</literal> and then checks the term
dictionary to find out which of those generated terms actually exist in the
index.</simpara>
<simpara>Here is a simple example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fuzzy" : { "user" : "ki" }
}</programlisting>
<simpara>Or with more advanced settings:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fuzzy" : {
        "user" : {
            "value" :         "ki",
            "boost" :         1.0,
            "fuzziness" :     2,
            "prefix_length" : 0,
            "max_expansions": 100
        }
    }
}</programlisting>
<bridgehead id="_parameters_6" renderas="sect4">Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/fuzzy-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>fuzziness</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum edit distance. Defaults to <literal>AUTO</literal>. See <xref linkend="fuzziness"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>prefix_length</literal>
</simpara>
</entry>
<entry>
<simpara>
    The number of initial characters which will not be &#8220;fuzzified&#8221;. This
    helps to reduce the number of terms which must be examined. Defaults
    to <literal>0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_expansions</literal>
</simpara>
</entry>
<entry>
<simpara>
    The maximum number of terms that the <literal>fuzzy</literal> query will expand to.
    Defaults to <literal>50</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<warning><simpara>This query can be very heavy if <literal>prefix_length</literal> is set to <literal>0</literal> and if
<literal>max_expansions</literal> is set to a high number. It could result in every term in the
index being examined!</simpara></warning>
<bridgehead id="_numeric_and_date_fields" renderas="sect3">Numeric and date fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/fuzzy-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Performs a <xref linkend="query-dsl-range-query"/> &#8220;around&#8221; the value using the
<literal>fuzziness</literal> value as a <literal>+/-</literal> range, where:</simpara>
<literallayout class="monospaced">-fuzziness &lt;= field value &lt;= +fuzziness</literallayout>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fuzzy" : {
        "price" : {
            "value" : 12,
            "fuzziness" : 2
        }
    }
}</programlisting>
<simpara>Will result in a range query between 10 and 14. Date fields support
<link linkend="time-units">time values</link>, eg:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "fuzzy" : {
        "created" : {
            "value" : "2010-02-05T12:05:07",
            "fuzziness" : "1d"
        }
    }
}</programlisting>
<simpara>See <xref linkend="fuzziness"/> for more details about accepted values.</simpara>
</section>
</section>
<section id="query-dsl-type-query">
<title>Type Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/type-query.asciidoc">Edit me</ulink></title>
<simpara>Filters documents matching the provided document / mapping type.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "type" : {
        "value" : "my_type"
    }
}</programlisting>
</section>
<section id="query-dsl-ids-query">
<title>Ids Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/ids-query.asciidoc">Edit me</ulink></title>
<simpara>Filters documents that only have the provided ids. Note, this query
uses the <link linkend="mapping-uid-field">_uid</link> field.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "ids" : {
        "type" : "my_type",
        "values" : ["1", "4", "100"]
    }
}</programlisting>
<simpara>The <literal>type</literal> is optional and can be omitted, and can also accept an array
of values. If no type is specified, all types defined in the index mapping are tried.</simpara>
</section>
</chapter>
<chapter id="compound-queries">
<title>Compound queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/compound-queries.asciidoc">Edit me</ulink></title>
<simpara>Compound queries wrap other compound or leaf queries, either to combine their
results and scores, to change their behaviour, or to switch from query to
filter context.</simpara>
<simpara>The queries in this group are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-constant-score-query"><literal>constant_score</literal> query</link>
</term>
<listitem>
<simpara>
A query which wraps another query, but executes it in filter context.  All
matching documents are given the same &#8220;constant&#8221; <literal>_score</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-bool-query"><literal>bool</literal> query</link>
</term>
<listitem>
<simpara>
The default query for combining multiple leaf or compound query clauses, as
<literal>must</literal>, <literal>should</literal>, <literal>must_not</literal>, or <literal>filter</literal> clauses.  The <literal>must</literal> and <literal>should</literal>
clauses have their scores combined&#8201;&#8212;&#8201;the more matching clauses, the better&#8201;&#8212;&#8201;while the <literal>must_not</literal> and <literal>filter</literal> clauses are executed in filter context.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-dis-max-query"><literal>dis_max</literal> query</link>
</term>
<listitem>
<simpara>
A query which accepts multiple queries, and returns any documents which match
any of the query clauses.  While the <literal>bool</literal> query combines the scores from all
matching queries, the <literal>dis_max</literal> query uses the score of the single best-
matching query clause.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-function-score-query"><literal>function_score</literal> query</link>
</term>
<listitem>
<simpara>
Modify the scores returned by the main query with functions to take into
account factors like popularity, recency, distance, or custom algorithms
implemented with scripting.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-boosting-query"><literal>boosting</literal> query</link>
</term>
<listitem>
<simpara>
Return documents which match a <literal>positive</literal> query, but reduce the score of
documents which also match a <literal>negative</literal> query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-indices-query"><literal>indices</literal> query</link>
</term>
<listitem>
<simpara>
Execute one query for the specified indices, and another for other indices.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-and-query"><literal>and</literal></link>, <link linkend="query-dsl-or-query"><literal>or</literal></link>, <link linkend="query-dsl-not-query"><literal>not</literal></link>
</term>
<listitem>
<simpara>
Synonyms for the <literal>bool</literal> query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-filtered-query"><literal>filtered</literal> query</link>
</term>
<listitem>
<simpara>
Combine a query clause in query context with another in filter context. <phrase revisionflag="deleted" revision="2.0.0-beta1">Deprecated in 2.0.0-beta1. Use the <literal>bool</literal> query instead.</phrase>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-limit-query"><literal>limit</literal> query</link>
</term>
<listitem>
<simpara>
Limits the number of documents examined per shard.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="query-dsl-constant-score-query">
<title>Constant Score Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/constant-score-query.asciidoc">Edit me</ulink></title>
<simpara>A query that wraps another query and simply returns a
constant score equal to the query boost for every document in the
filter. Maps to Lucene <literal>ConstantScoreQuery</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "constant_score" : {
        "filter" : {
            "term" : { "user" : "kimchy"}
        },
        "boost" : 1.2
    }
}</programlisting>
</section>
<section id="query-dsl-bool-query">
<title>Bool Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/bool-query.asciidoc">Edit me</ulink></title>
<simpara>A query that matches documents matching boolean combinations of other
queries. The bool query maps to Lucene <literal>BooleanQuery</literal>. It is built using
one or more boolean clauses, each clause with a typed occurrence. The
occurrence types are:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Occur </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>must</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The clause (query) must appear in matching documents and will
contribute to the score.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>filter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The clause (query) must appear in matching documents. However unlike
<literal>must</literal> the score of the query will be ignored.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>should</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The clause (query) should appear in the matching document. In
a boolean query with no <literal>must</literal> or <literal>filter</literal> clauses, one or more <literal>should</literal> clauses
must match a document. The minimum number of should clauses to match can
be set using the
<link linkend="query-dsl-minimum-should-match"><literal>minimum_should_match</literal></link>
parameter.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>must_not</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The clause (query) must not appear in the matching
documents.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<important>
<title>Bool query in filter context</title>
<simpara>If this query is used in a filter context and it has <literal>should</literal>
clauses then at least one <literal>should</literal> clause is required to match.</simpara>
</important>
<simpara>The bool query also supports <literal>disable_coord</literal> parameter (defaults to
<literal>false</literal>). Basically the coord similarity computes a score factor based
on the fraction of all query terms that a document contains. See Lucene
<literal>BooleanQuery</literal> for more details.</simpara>
<simpara>The <literal>bool</literal> query takes a <emphasis>more-matches-is-better</emphasis> approach, so the score from
each matching <literal>must</literal> or <literal>should</literal> clause will be added together to provide the
final <literal>_score</literal> for each document.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "term" : { "user" : "kimchy" }
        },
        "filter": {
            "term" : { "tag" : "tech" }
        },
        "must_not" : {
            "range" : {
                "age" : { "from" : 10, "to" : 20 }
            }
        },
        "should" : [
            {
                "term" : { "tag" : "wow" }
            },
            {
                "term" : { "tag" : "elasticsearch" }
            }
        ],
        "minimum_should_match" : 1,
        "boost" : 1.0
    }
}</programlisting>
<section id="_scoring_with_literal_bool_filter_literal">
<title>Scoring with <literal>bool.filter</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/bool-query.asciidoc">Edit me</ulink></title>
<simpara>Queries specified under the <literal>filter</literal> element have no effect on scoring&#8201;&#8212;&#8201;scores are returned as <literal>0</literal>.  Scores are only affected by the query that has
been specified.  For instance, all three of the following queries return
all documents where the <literal>status</literal> field contains the term <literal>active</literal>.</simpara>
<simpara>This first query assigns a score of <literal>0</literal> to all documents, as no scoring
query has been specified:</simpara>
<programlisting language="json" linenumbering="unnumbered">GET _search
{
  "query": {
    "bool": {
      "filter": {
        "term": {
          "status": "active"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>This <literal>bool</literal> query has a <literal>match_all</literal> query, which assigns a score of <literal>1.0</literal> to
all documents.</simpara>
<programlisting language="json" linenumbering="unnumbered">GET _search
{
  "query": {
    "bool": {
      "must": {
        "match_all": {}
      },
      "filter": {
        "term": {
          "status": "active"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>This <literal>constant_score</literal> query behaves in exactly the same way as the second example above.
The <literal>constant_score</literal> query assigns a score of <literal>1.0</literal> to all documents matched
by the filter.</simpara>
<programlisting language="json" linenumbering="unnumbered">GET _search
{
  "query": {
    "constant_score": {
      "filter": {
        "term": {
          "status": "active"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_using_named_queries_to_see_which_clauses_matched">
<title>Using named queries to see which clauses matched<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/bool-query.asciidoc">Edit me</ulink></title>
<simpara>If you need to know which of the clauses in the bool query matched the documents
returned from the query, you can use
<link linkend="search-request-named-queries-and-filters">named queries</link> to assign a name to
each clause.</simpara>
</section>
</section>
<section id="query-dsl-dis-max-query">
<title>Dis Max Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/dis-max-query.asciidoc">Edit me</ulink></title>
<simpara>A query that generates the union of documents produced by its
subqueries, and that scores each document with the maximum score for
that document as produced by any subquery, plus a tie breaking increment
for any additional matching subqueries.</simpara>
<simpara>This is useful when searching for a word in multiple fields with
different boost factors (so that the fields cannot be combined
equivalently into a single search field). We want the primary score to
be the one associated with the highest boost, not the sum of the field
scores (as Boolean Query would give). If the query is "albino elephant"
this ensures that "albino" matching one field and "elephant" matching
another gets a higher score than "albino" matching both fields. To get
this result, use both Boolean Query and DisjunctionMax Query: for each
term a DisjunctionMaxQuery searches for it in each field, while the set
of these DisjunctionMaxQuery&#8217;s is combined into a BooleanQuery.</simpara>
<simpara>The tie breaker capability allows results that include the same term in
multiple fields to be judged better than results that include this term
in only the best of those multiple fields, without confusing this with
the better case of two different terms in the multiple fields.The
default <literal>tie_breaker</literal> is <literal>0.0</literal>.</simpara>
<simpara>This query maps to Lucene <literal>DisjunctionMaxQuery</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "dis_max" : {
        "tie_breaker" : 0.7,
        "boost" : 1.2,
        "queries" : [
            {
                "term" : { "age" : 34 }
            },
            {
                "term" : { "age" : 35 }
            }
        ]
    }
}</programlisting>
</section>
<section id="query-dsl-function-score-query">
<title>Function Score Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>function_score</literal> allows you to modify the score of documents that are
retrieved by a query. This can be useful if, for example, a score
function is computationally expensive and it is sufficient to compute
the score on a filtered set of documents.</simpara>
<simpara>To use <literal>function_score</literal>, the user has to define a query and one or
more functions, that compute a new score for each document returned
by the query.</simpara>
<simpara><literal>function_score</literal> can be used with only one function like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">"function_score": {
    "query": {},
    "boost": "boost for the whole query",
    "FUNCTION": {}, <co id="CO143-1"/>
    "boost_mode":"(multiply|replace|...)"
}</programlisting>
<calloutlist>
<callout arearefs="CO143-1">
<para>
See <xref linkend="score-functions"/> for a list of supported functions.
</para>
</callout>
</calloutlist>
<simpara>Furthermore, several functions can be combined. In this case one can
optionally choose to apply the function only if a document matches a
given filtering query</simpara>
<programlisting language="js" linenumbering="unnumbered">"function_score": {
    "query": {},
    "boost": "boost for the whole query",
    "functions": [
        {
            "filter": {},
            "FUNCTION": {}, <co id="CO144-1"/>
            "weight": number
        },
        {
            "FUNCTION": {} <co id="CO144-2"/>
        },
        {
            "filter": {},
            "weight": number
        }
    ],
    "max_boost": number,
    "score_mode": "(multiply|max|...)",
    "boost_mode": "(multiply|replace|...)",
    "min_score" : number
}</programlisting>
<calloutlist>
<callout arearefs="CO144-1 CO144-2">
<para>
See <xref linkend="score-functions"/> for a list of supported functions.
</para>
</callout>
</calloutlist>
<note><simpara>The scores produced by the filtering query of each function do not matter.</simpara></note>
<simpara>If no filter is given with a function this is equivalent to specifying
<literal>"match_all": {}</literal></simpara>
<simpara>First, each document is scored by the defined functions. The parameter
<literal>score_mode</literal> specifies how the computed scores are combined:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>multiply</literal>
</simpara>
</entry>
<entry>
<simpara>
scores are multiplied (default)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum</literal>
</simpara>
</entry>
<entry>
<simpara>
scores are summed
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>avg</literal>
</simpara>
</entry>
<entry>
<simpara>
scores are averaged
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>first</literal>
</simpara>
</entry>
<entry>
<simpara>
the first function that has a matching filter
                is applied
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max</literal>
</simpara>
</entry>
<entry>
<simpara>
maximum score is used
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min</literal>
</simpara>
</entry>
<entry>
<simpara>
minimum score is used
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Because scores can be on different scales (for example, between 0 and 1 for decay functions but arbitrary for <literal>field_value_factor</literal>) and also
because sometimes a different impact of functions on the score is desirable, the score of each function can be adjusted with a user defined
<literal>weight</literal>. The <literal>weight</literal> can be defined per function in the <literal>functions</literal> array (example above) and is multiplied with the score computed by
the respective function.
If weight is given without any other function declaration, <literal>weight</literal> acts as a function that simply returns the <literal>weight</literal>.</simpara>
<simpara>In case <literal>score_mode</literal> is set to <literal>avg</literal> the individual scores will be combined by a <emphasis role="strong">weighted</emphasis> average.
For example, if two functions return score 1 and 2 and their respective weights are 3 and 4, then their scores will be combined as
<literal>(1*3+2*4)/(3+4)</literal> and <emphasis role="strong">not</emphasis> <literal>(1*3+2*4)/2</literal>.</simpara>
<simpara>The new score can be restricted to not exceed a certain limit by setting
the <literal>max_boost</literal> parameter. The default for <literal>max_boost</literal> is FLT_MAX.</simpara>
<simpara>The newly computed score is combined with the score of the
query. The parameter <literal>boost_mode</literal> defines how:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>multiply</literal>
</simpara>
</entry>
<entry>
<simpara>
query score and function score is multiplied (default)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>replace</literal>
</simpara>
</entry>
<entry>
<simpara>
only function score is used, the query score is ignored
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum</literal>
</simpara>
</entry>
<entry>
<simpara>
query score and function score are added
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>avg</literal>
</simpara>
</entry>
<entry>
<simpara>
average
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max</literal>
</simpara>
</entry>
<entry>
<simpara>
max of query score and function score
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min</literal>
</simpara>
</entry>
<entry>
<simpara>
min of query score and function score
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>By default, modifying the score does not change which documents match. To exclude
documents that do not meet a certain score threshold the <literal>min_score</literal> parameter can be set to the desired score threshold.</simpara>
<simpara id="score-functions">The <literal>function_score</literal> query provides several types of score functions.</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="function-script-score"><literal>script_score</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="function-weight"><literal>weight</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="function-random"><literal>random_score</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="function-field-value-factor"><literal>field_value_factor</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="function-decay">decay functions</link>: <literal>gauss</literal>, <literal>linear</literal>, <literal>exp</literal>
</simpara>
</listitem>
</itemizedlist>
<section id="function-script-score">
<title>Script score<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>script_score</literal> function allows you to wrap another query and customize
the scoring of it optionally with a computation derived from other numeric
field values in the doc using a script expression. Here is a
simple sample:</simpara>
<programlisting language="js" linenumbering="unnumbered">"script_score" : {
    "script" : "_score * doc['my_numeric_field'].value"
}</programlisting>
<simpara>On top of the different scripting field values and expression, the
<literal>_score</literal> script parameter can be used to retrieve the score based on the
wrapped query.</simpara>
<simpara>Scripts are cached for faster execution. If the script has parameters
that it needs to take into account, it is preferable to reuse the same
script, and provide parameters to it:</simpara>
<programlisting language="js" linenumbering="unnumbered">"script_score": {
    "script": {
        "lang": "lang",
        "params": {
            "param1": value1,
            "param2": value2
        },
        "inline": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
    }
}</programlisting>
<simpara>Note that unlike the <literal>custom_score</literal> query, the
score of the query is multiplied with the result of the script scoring. If
you wish to inhibit this, set <literal>"boost_mode": "replace"</literal></simpara>
</section>
<section id="function-weight">
<title>Weight<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>weight</literal> score allows you to multiply the score by the provided
<literal>weight</literal>. This can sometimes be desired since boost value set on
specific queries gets normalized, while for this score function it does
not. The number value is of type float.</simpara>
<programlisting language="js" linenumbering="unnumbered">"weight" : number</programlisting>
</section>
<section id="function-random">
<title>Random<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>random_score</literal> generates scores using a hash of the <literal>_uid</literal> field,
with a <literal>seed</literal> for variation. If <literal>seed</literal> is not specified, the current
time is used.</simpara>
<note><simpara>Using this feature will load field data for <literal>_uid</literal>, which can
be a memory intensive operation since the values are unique.</simpara></note>
<programlisting language="js" linenumbering="unnumbered">"random_score": {
    "seed" : number
}</programlisting>
</section>
<section id="function-field-value-factor">
<title>Field Value factor<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>field_value_factor</literal> function allows you to use a field from a document to
influence the score. It&#8217;s similar to using the <literal>script_score</literal> function, however,
it avoids the overhead of scripting. If used on a multi-valued field, only the
first value of the field is used in calculations.</simpara>
<simpara>As an example, imagine you have a document indexed with a numeric <literal>popularity</literal>
field and wish to influence the score of a document with this field, an example
doing so would look like:</simpara>
<programlisting language="js" linenumbering="unnumbered">"field_value_factor": {
  "field": "popularity",
  "factor": 1.2,
  "modifier": "sqrt",
  "missing": 1
}</programlisting>
<simpara>Which will translate into the following formula for scoring:</simpara>
<simpara><literal>sqrt(1.2 * doc['popularity'].value)</literal></simpara>
<simpara>There are a number of options for the <literal>field_value_factor</literal> function:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>field</literal>
</simpara>
</entry>
<entry>
<simpara>
    Field to be extracted from the document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>factor</literal>
</simpara>
</entry>
<entry>
<simpara>
    Optional factor to multiply the field value with, defaults to <literal>1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>modifier</literal>
</simpara>
</entry>
<entry>
<simpara>
    Modifier to apply to the field value, can be one of: <literal>none</literal>, <literal>log</literal>,
    <literal>log1p</literal>, <literal>log2p</literal>, <literal>ln</literal>, <literal>ln1p</literal>, <literal>ln2p</literal>, <literal>square</literal>, <literal>sqrt</literal>, or <literal>reciprocal</literal>.
    Defaults to <literal>none</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top"> Modifier </entry>
<entry align="left" valign="top"> Meaning</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>none</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Do not apply any multiplier to the field value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>log</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Take the <ulink url="https://en.wikipedia.org/wiki/Logarithm">logarithm</ulink> of the field value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>log1p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Add 1 to the field value and take the logarithm</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>log2p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Add 2 to the field value and take the logarithm</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ln</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Take the <ulink url="https://en.wikipedia.org/wiki/Natural_logarithm">natural logarithm</ulink> of the field value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ln1p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Add 1 to the field value and take the natural logarithm</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ln2p</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Add 2 to the field value and take the natural logarithm</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>square</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Square the field value (multiply it by itself)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sqrt</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Take the <ulink url="https://en.wikipedia.org/wiki/Square_root">square root</ulink> of the field value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>reciprocal</literal></simpara></entry>
<entry align="left" valign="top"><simpara><ulink url="https://en.wikipedia.org/wiki/Multiplicative_inverse">Reciprocate</ulink> the field value, same as <literal>1/x</literal> where <literal>x</literal> is the field&#8217;s value</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<variablelist>
<varlistentry>
<term>
<literal>missing</literal>
</term>
<listitem>
<simpara>
    Value used if the document doesn&#8217;t have that field. The modifier
    and factor are still applied to it as though it were read from the document.
</simpara>
<literallayout class="monospaced">Keep in mind that taking the log() of 0, or the square root of a negative number
is an illegal operation, and an exception will be thrown. Be sure to limit the
values of the field with a range filter to avoid this, or use `log1p` and
`ln1p`.</literallayout>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="function-decay">
<title>Decay functions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>Decay functions score a document with a function that decays depending
on the distance of a numeric field value of the document from a user
given origin. This is similar to a range query, but with smooth edges
instead of boxes.</simpara>
<simpara>To use distance scoring on a query that has numerical fields, the user
has to define an <literal>origin</literal> and a <literal>scale</literal> for each field. The <literal>origin</literal>
is needed to define the &#8220;central point&#8221; from which the distance
is calculated, and the <literal>scale</literal> to define the rate of decay. The
decay function is specified as</simpara>
<programlisting language="js" linenumbering="unnumbered">"DECAY_FUNCTION": { <co id="CO145-1"/>
    "FIELD_NAME": { <co id="CO145-2"/>
          "origin": "11, 12",
          "scale": "2km",
          "offset": "0km",
          "decay": 0.33
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO145-1">
<para>
The <literal>DECAY_FUNCTION</literal> should be one of <literal>linear</literal>, <literal>exp</literal>, or <literal>gauss</literal>.
</para>
</callout>
<callout arearefs="CO145-2">
<para>
The specified field must be a numeric, date, or geo-point field.
</para>
</callout>
</calloutlist>
<simpara>In the above example, the field is a <link linkend="geo-point"><literal>geo_point</literal></link> and origin can be provided in geo format. <literal>scale</literal> and <literal>offset</literal> must be given with a unit in this case. If your field is a date field, you can set <literal>scale</literal> and <literal>offset</literal> as days, weeks, and so on. Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">    "gauss": {
        "date": {
              "origin": "2013-09-17", <co id="CO146-1"/>
              "scale": "10d",
              "offset": "5d", <co id="CO146-2"/>
              "decay" : 0.5 <co id="CO146-3"/>
        }
    }</programlisting>
<calloutlist>
<callout arearefs="CO146-1">
<para>
The date format of the origin depends on the <link linkend="mapping-date-format"><literal>format</literal></link> defined in
    your mapping. If you do not define the origin, the current time is used.
</para>
</callout>
<callout arearefs="CO146-2 CO146-3">
<para>
The <literal>offset</literal> and <literal>decay</literal> parameters are optional.
</para>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>origin</literal>
</simpara>
</entry>
<entry>
<simpara>
    The point of origin used for calculating distance. Must be given as a
    number for numeric field, date for date fields and geo point for geo fields.
    Required for geo and numeric field. For date fields the default is <literal>now</literal>. Date
    math (for example <literal>now-1h</literal>) is supported for origin.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>scale</literal>
</simpara>
</entry>
<entry>
<simpara>
    Required for all types. Defines the distance from origin + offest at which the computed
    score will equal <literal>decay</literal> parameter. For geo fields: Can be defined as number+unit (1km, 12m,&#8230;).
    Default unit is meters. For date fields: Can to be defined as a number+unit ("1h", "10d",&#8230;).
    Default unit is milliseconds. For numeric field: Any number.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>offset</literal>
</simpara>
</entry>
<entry>
<simpara>
    If an <literal>offset</literal> is defined, the decay function will only compute the
    decay function for documents with a distance greater that the defined
    <literal>offset</literal>. The default is 0.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>decay</literal>
</simpara>
</entry>
<entry>
<simpara>
    The <literal>decay</literal> parameter defines how documents are scored at the distance
    given at <literal>scale</literal>. If no <literal>decay</literal> is defined, documents at the distance
    <literal>scale</literal> will be scored 0.5.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</callout>
</calloutlist>
<simpara>In the first example, your documents might represents hotels and contain a geo
location field. You want to compute a decay function depending on how
far the hotel is from a given location. You might not immediately see
what scale to choose for the gauss function, but you can say something
like: "At a distance of 2km from the desired location, the score should
be reduced to one third."
The parameter "scale" will then be adjusted automatically to assure that
the score function computes a score of 0.33 for hotels that are 2km away
from the desired location.</simpara>
<simpara>In the second example, documents with a field value between 2013-09-12 and 2013-09-22 would get a weight of 1.0 and documents which are 15 days from that date a weight of 0.5.</simpara>
<section id="_supported_decay_functions">
<title>Supported decay functions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>DECAY_FUNCTION</literal> determines the shape of the decay:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>gauss</literal>
</term>
<listitem>
<simpara>Normal decay, computed as:</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/Gaussian.png"/>
  </imageobject>
  <textobject><phrase>images/Gaussian.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>where <inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/sigma.png"/>
  </imageobject>
  <textobject><phrase>images/sigma.png</phrase></textobject>
</inlinemediaobject> is computed to assure that the score takes the value <literal>decay</literal> at distance <literal>scale</literal> from <literal>origin</literal>+-<literal>offset</literal></simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/sigma_calc.png"/>
  </imageobject>
  <textobject><phrase>images/sigma_calc.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>See <xref linkend="gauss-decay"/> for graphs demonstrating the curve generated by the <literal>gauss</literal> function.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>exp</literal>
</term>
<listitem>
<simpara>Exponential decay, computed as:</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/Exponential.png"/>
  </imageobject>
  <textobject><phrase>images/Exponential.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>where again the parameter <inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/lambda.png"/>
  </imageobject>
  <textobject><phrase>images/lambda.png</phrase></textobject>
</inlinemediaobject> is computed to assure that the score takes the value <literal>decay</literal> at distance <literal>scale</literal> from <literal>origin</literal>+-<literal>offset</literal></simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/lambda_calc.png"/>
  </imageobject>
  <textobject><phrase>images/lambda_calc.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>See <xref linkend="exp-decay"/> for graphs demonstrating the curve generated by the <literal>exp</literal> function.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>linear</literal>
</term>
<listitem>
<simpara>Linear decay, computed as:</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/Linear.png"/>
  </imageobject>
  <textobject><phrase>images/Linear.png</phrase></textobject>
</inlinemediaobject>.</simpara>
<simpara>where again the parameter <literal>s</literal> is computed to assure that the score takes the value <literal>decay</literal> at distance <literal>scale</literal> from <literal>origin</literal>+-<literal>offset</literal></simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/s_calc.png"/>
  </imageobject>
  <textobject><phrase>images/s_calc.png</phrase></textobject>
</inlinemediaobject></simpara>
<simpara>In contrast to the normal and exponential decay, this function actually
sets the score to 0 if the field value exceeds twice the user given
scale value.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>For single functions the three decay functions together with their parameters can be visualized like this (the field in this example called "age"):</simpara>
<simpara><inlinemediaobject>
  <imageobject>
  <imagedata fileref="images/decay_2d.png" contentwidth="600"/>
  </imageobject>
  <textobject><phrase>images/decay_2d.png</phrase></textobject>
</inlinemediaobject></simpara>
</section>
<section id="_multi_values_fields">
<title>Multi-values fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>If a field used for computing the decay contains multiple values, per default the value closest to the origin is chosen for determining the distance.
This can be changed by setting <literal>multi_value_mode</literal>.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>min</literal>
</simpara>
</entry>
<entry>
<simpara>
Distance is the minimum distance
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max</literal>
</simpara>
</entry>
<entry>
<simpara>
Distance is the maximum distance
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>avg</literal>
</simpara>
</entry>
<entry>
<simpara>
Distance is the average distance
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>sum</literal>
</simpara>
</entry>
<entry>
<simpara>
Distance is the sum of all distances
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">    "DECAY_FUNCTION": {
        "FIELD_NAME": {
              "origin": ...,
              "scale": ...
        },
        "multi_value_mode": "avg"
    }</programlisting>
</section>
</section>
<section id="_detailed_example">
<title>Detailed example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>Suppose you are searching for a hotel in a certain town. Your budget is
limited. Also, you would like the hotel to be close to the town center,
so the farther the hotel is from the desired location the less likely
you are to check in.</simpara>
<simpara>You would like the query results that match your criterion (for
example, "hotel, Nancy, non-smoker") to be scored with respect to
distance to the town center and also the price.</simpara>
<simpara>Intuitively, you would like to define the town center as the origin and
maybe you are willing to walk 2km to the town center from the hotel.<?asciidoc-br?>
In this case your <emphasis role="strong">origin</emphasis> for the location field is the town center
and the <emphasis role="strong">scale</emphasis> is ~2km.</simpara>
<simpara>If your budget is low, you would probably prefer something cheap above
something expensive.  For the price field, the <emphasis role="strong">origin</emphasis> would be 0 Euros
and the <emphasis role="strong">scale</emphasis> depends on how much you are willing to pay, for example 20 Euros.</simpara>
<simpara>In this example, the fields might be called "price" for the price of the
hotel and "location" for the coordinates of this hotel.</simpara>
<simpara>The function for <literal>price</literal> in this case would be</simpara>
<programlisting language="js" linenumbering="unnumbered">"gauss": { <co id="CO147-1"/>
    "price": {
          "origin": "0",
          "scale": "20"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO147-1">
<para>
This decay function could also be <literal>linear</literal> or <literal>exp</literal>.
</para>
</callout>
</calloutlist>
<simpara>and for <literal>location</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">"gauss": { <co id="CO148-1"/>
    "location": {
          "origin": "11, 12",
          "scale": "2km"
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO148-1">
<para>
This decay function could also be <literal>linear</literal> or <literal>exp</literal>.
</para>
</callout>
</calloutlist>
<simpara>Suppose you want to multiply these two functions on the original score,
the request would look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /hotels/_search/
{
  "query": {
    "function_score": {
      "functions": [
        {
          "gauss": {
            "price": {
              "origin": "0",
              "scale": "20"
            }
          }
        },
        {
          "gauss": {
            "location": {
              "origin": "11, 12",
              "scale": "2km"
            }
          }
        }
      ],
      "query": {
        "match": {
          "properties": "balcony"
        }
      },
      "score_mode": "multiply"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Next, we show how the computed score looks like for each of the three
possible decay functions.</simpara>
<section id="gauss-decay">
<title>Normal decay, keyword <literal>gauss</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>When choosing <literal>gauss</literal> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</simpara>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png</phrase></textobject>
</mediaobject>
</informalfigure>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara>Suppose your original search results matches three hotels :</simpara>
<itemizedlist>
<listitem>
<simpara>
"Backback Nap"
</simpara>
</listitem>
<listitem>
<simpara>
"Drink n Drive"
</simpara>
</listitem>
<listitem>
<simpara>
"BnB Bellevue".
</simpara>
</listitem>
</itemizedlist>
<simpara>"Drink n Drive" is pretty far from your defined location (nearly 2 km)
and is not too cheap (about 13 Euros) so it gets a low factor a factor
of 0.56. "BnB Bellevue" and "Backback Nap" are both pretty close to the
defined location but "BnB Bellevue" is cheaper, so it gets a multiplier
of 0.86 whereas "Backpack Nap" gets a value of 0.66.</simpara>
</section>
<section id="exp-decay">
<title>Exponential decay, keyword <literal>exp</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>When choosing <literal>exp</literal> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</simpara>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png</phrase></textobject>
</mediaobject>
</informalfigure>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png</phrase></textobject>
</mediaobject>
</informalfigure>
</section>
<section id="linear-decay">
<title>Linear decay, keyword <literal>linear</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>When choosing <literal>linear</literal> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</simpara>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png</phrase></textobject>
</mediaobject>
</informalfigure>
<informalfigure>
<mediaobject>
  <imageobject>
  <imagedata fileref="https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png" contentwidth="700px"/>
  </imageobject>
  <textobject><phrase>https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png</phrase></textobject>
</mediaobject>
</informalfigure>
</section>
</section>
<section id="_supported_fields_for_decay_functions">
<title>Supported fields for decay functions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>Only numeric, date, and geo-point fields are supported.</simpara>
</section>
<section id="_what_if_a_field_is_missing">
<title>What if a field is missing?<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/function-score-query.asciidoc">Edit me</ulink></title>
<simpara>If the numeric field is missing in the document, the function will
return 1.</simpara>
</section>
</section>
<section id="query-dsl-boosting-query">
<title>Boosting Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/boosting-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>boosting</literal> query can be used to effectively demote results that
match a given query. Unlike the "NOT" clause in bool query, this still
selects documents that contain undesirable terms, but reduces their
overall score.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "boosting" : {
        "positive" : {
            "term" : {
                "field1" : "value1"
            }
        },
        "negative" : {
            "term" : {
                "field2" : "value2"
            }
        },
        "negative_boost" : 0.2
    }
}</programlisting>
</section>
<section id="query-dsl-indices-query">
<title>Indices Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/indices-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>indices</literal> query is useful in cases where a search is executed across
multiple indices. It allows to specify a list of index names and an inner
query that is only executed for indices matching names on that list.
For other indices that are searched, but that don&#8217;t match entries
on the list, the alternative <literal>no_match_query</literal> is executed.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "indices" : {
        "indices" : ["index1", "index2"],
        "query" : {
            "term" : { "tag" : "wow" }
        },
        "no_match_query" : {
            "term" : { "tag" : "kow" }
        }
    }
}</programlisting>
<simpara>You can use the <literal>index</literal> field to provide a single index.</simpara>
<simpara><literal>no_match_query</literal> can also have "string" value of <literal>none</literal> (to match no
documents), and <literal>all</literal> (to match all). Defaults to <literal>all</literal>.</simpara>
<simpara><literal>query</literal> is mandatory, as well as <literal>indices</literal> (or <literal>index</literal>).</simpara>
<tip>
<simpara>The fields order is important: if the <literal>indices</literal> are provided before <literal>query</literal>
or <literal>no_match_query</literal>, the related queries get parsed only against the indices
that they are going to be executed on. This is useful to avoid parsing queries
when it is not necessary and prevent potential mapping errors.</simpara>
</tip>
</section>
<section id="query-dsl-and-query">
<title>And Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/and-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta1"><title>Deprecated in 2.0.0-beta1.</title><simpara> Use the <literal>bool</literal> query instead.</simpara></warning>
<simpara>A query that matches documents using the <literal>AND</literal> boolean operator on other
queries.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "and" : [
                {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                },
                {
                    "prefix" : { "name.second" : "ba" }
                }
            ]
        }
    }
}</programlisting>
</section>
<section id="query-dsl-not-query">
<title>Not Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/not-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.1.0"><title>Deprecated in 2.1.0.</title><simpara> Use the <literal>bool</literal> query with <literal>must_not</literal> clause instead.</simpara></warning>
<simpara>A query that filters out matched documents using a query. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "range" : {
                    "postDate" : {
                        "from" : "2010-03-01",
                        "to" : "2010-04-01"
                    }
                }
            }
        }
    }
}</programlisting>
<simpara>Or, in a longer form with a <literal>filter</literal> element:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "filter" :  {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="query-dsl-or-query">
<title>Or Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/or-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta1"><title>Deprecated in 2.0.0-beta1.</title><simpara> Use the <literal>bool</literal> query instead.</simpara></warning>
<simpara>A query that matches documents using the <literal>OR</literal> boolean operator on other
queries.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "or" : [
                {
                    "term" : { "name.second" : "banon" }
                },
                {
                    "term" : { "name.nick" : "kimchy" }
                }
            ]
        }
    }
}</programlisting>
</section>
<section id="query-dsl-filtered-query">
<title>Filtered Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/filtered-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta1"><title>Deprecated in 2.0.0-beta1.</title><simpara> Use the <literal>bool</literal> query instead with a <literal>must</literal> clause for the query and a <literal>filter</literal> clause for the filter.</simpara></warning>
<simpara>The <literal>filtered</literal> query is used to combine a query which will be used for
scoring with another query which will only be used for filtering the result
set.</simpara>
<tip><simpara>Exclude as many document as you can with a filter, then query just the
documents that remain.</simpara></tip>
<programlisting language="js" linenumbering="unnumbered">{
  "filtered": {
    "query": {
      "match": { "tweet": "full text search" }
    },
    "filter": {
      "range": { "created": { "gte": "now-1d/d" }}
    }
  }
}</programlisting>
<simpara>The <literal>filtered</literal> query can be used wherever a <literal>query</literal> is expected, for instance,
to use the above example in search request:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_search -d '
{
  "query": {
    "filtered": { <co id="CO149-1"/>
      "query": {
        "match": { "tweet": "full text search" }
      },
      "filter": {
        "range": { "created": { "gte": "now-1d/d" }}
      }
    }
  }
}
'</programlisting>
<calloutlist>
<callout arearefs="CO149-1">
<para>
The <literal>filtered</literal> query is passed as the value of the <literal>query</literal>
    parameter in the search request.
</para>
</callout>
</calloutlist>
<section id="_filtering_without_a_query">
<title>Filtering without a query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/filtered-query.asciidoc">Edit me</ulink></title>
<simpara>If a <literal>query</literal> is not specified, it defaults to the
<link linkend="query-dsl-match-all-query"><literal>match_all</literal> query</link>.  This means that the
<literal>filtered</literal> query can be used to wrap just a filter, so that it can be used
wherever a query is expected.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_search -d '
{
  "query": {
    "filtered": { <co id="CO150-1"/>
      "filter": {
        "range": { "created": { "gte": "now-1d/d" }}
      }
    }
  }
}
'</programlisting>
<calloutlist>
<callout arearefs="CO150-1">
<para>
No <literal>query</literal> has been specified, so this request applies just the filter,
   returning all documents created since yesterday.
</para>
</callout>
</calloutlist>
<section id="_multiple_filters">
<title>Multiple filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/filtered-query.asciidoc">Edit me</ulink></title>
<simpara>Multiple filters can be applied by wrapping them in a
<link linkend="query-dsl-bool-query"><literal>bool</literal> query</link>, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "filtered": {
    "query": { "match": { "tweet": "full text search" }},
    "filter": {
      "bool": {
        "must": { "range": { "created": { "gte": "now-1d/d" }}},
        "should": [
          { "term": { "featured": true }},
          { "term": { "starred":  true }}
        ],
        "must_not": { "term": { "deleted": false }}
      }
    }
  }
}</programlisting>
</section>
</section>
</section>
<section id="query-dsl-limit-query">
<title>Limit Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/limit-query.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta1"><title>Deprecated in 2.0.0-beta1.</title><simpara> Use the <literal>terminate_after</literal> parameter instead.</simpara></warning>
<simpara>A limit query limits the number of documents (per shard) to execute on.
For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "filtered" : {
        "filter" : {
             "limit" : {"value" : 100}
         },
         "query" : {
            "term" : { "name.first" : "shay" }
        }
    }
}</programlisting>
</section>
</chapter>
<chapter id="joining-queries">
<title>Joining queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/joining-queries.asciidoc">Edit me</ulink></title>
<simpara>Performing full SQL-style joins in a distributed system like Elasticsearch is
prohibitively expensive.  Instead, Elasticsearch offers two forms of join
which are designed to scale horizontally.</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-nested-query"><literal>nested</literal> query</link>
</term>
<listitem>
<simpara>
Documents may contain fields of type <link linkend="nested"><literal>nested</literal></link>. These
fields are used to index arrays of objects, where each object can be queried
(with the <literal>nested</literal> query) as an independent document.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-has-child-query"><literal>has_child</literal></link> and <link linkend="query-dsl-has-parent-query"><literal>has_parent</literal></link> queries
</term>
<listitem>
<simpara>
A <link linkend="mapping-parent-field">parent-child relationship</link> can exist between two
document types within a single index. The <literal>has_child</literal> query returns parent
documents whose child documents match the specified query, while the
<literal>has_parent</literal> query returns child documents whose parent document matches the
specified query.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Also see the <link linkend="query-dsl-terms-lookup">terms-lookup mechanism</link> in the <literal>terms</literal>
query, which allows you to build a <literal>terms</literal> query from values contained in
another document.</simpara>
<section id="query-dsl-nested-query">
<title>Nested Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/nested-query.asciidoc">Edit me</ulink></title>
<simpara>Nested query allows to query nested objects / docs (see
<link linkend="nested">nested mapping</link>). The
query is executed against the nested objects / docs as if they were
indexed as separate docs (they are, internally) and resulting in the
root parent doc (or parent nested mapping). Here is a sample mapping we
will work with:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</programlisting>
<simpara>And here is a sample nested query usage:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "nested" : {
        "path" : "obj1",
        "score_mode" : "avg",
        "query" : {
            "bool" : {
                "must" : [
                    {
                        "match" : {"obj1.name" : "blue"}
                    },
                    {
                        "range" : {"obj1.count" : {"gt" : 5}}
                    }
                ]
            }
        }
    }
}</programlisting>
<simpara>The query <literal>path</literal> points to the nested object path, and the <literal>query</literal>
includes the query that will run on the nested docs matching
the direct path, and joining with the root parent docs. Note that any
fields referenced inside the query must use the complete path (fully
qualified).</simpara>
<simpara>The <literal>score_mode</literal> allows to set how inner children matching affects
scoring of parent. It defaults to <literal>avg</literal>, but can be <literal>sum</literal>, <literal>min</literal>,
<literal>max</literal> and <literal>none</literal>.</simpara>
<simpara>Multi level nesting is automatically supported, and detected, resulting
in an inner nested query to automatically match the relevant nesting
level (and not root) if it exists within another nested query.</simpara>
</section>
<section id="query-dsl-has-child-query">
<title>Has Child Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-child-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>has_child</literal> filter accepts a query and the child type to run against, and
results in parent documents that have child docs matching the query. Here is
an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "has_child" : {
        "type" : "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</programlisting>
<bridgehead id="_scoring_capabilities" renderas="sect3">Scoring capabilities<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-child-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>has_child</literal> also has scoring support. The
supported score modes are <literal>min</literal>, <literal>max</literal>, <literal>sum</literal>, <literal>avg</literal> or <literal>none</literal>. The default is
<literal>none</literal> and yields the same behaviour as in previous versions. If the
score mode is set to another value than <literal>none</literal>, the scores of all the
matching child documents are aggregated into the associated parent
documents. The score type can be specified with the <literal>score_mode</literal> field
inside the <literal>has_child</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "has_child" : {
        "type" : "blog_tag",
        "score_mode" : "sum",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</programlisting>
<bridgehead id="_min_max_children" renderas="sect3">Min/Max Children<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-child-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>has_child</literal> query allows you to specify that a minimum and/or maximum
number of children are required to match for the parent doc to be considered
a match:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "has_child" : {
        "type" : "blog_tag",
        "score_mode" : "sum",
        "min_children": 2, <co id="CO151-1"/>
        "max_children": 10, <co id="CO151-2"/>
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO151-1 CO151-2">
<para>
Both <literal>min_children</literal> and <literal>max_children</literal> are optional.
</para>
</callout>
</calloutlist>
<simpara>The  <literal>min_children</literal> and <literal>max_children</literal> parameters can be combined with
the <literal>score_mode</literal> parameter.</simpara>
<bridgehead id="_sorting" renderas="sect3">Sorting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-child-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Parent documents can&#8217;t be sorted by fields in matching child documents via the
regular sort options. If you need to sort parent document by field in the child
documents then you can should use the <literal>function_score</literal> query and then just sort
by <literal>_score</literal>.</simpara>
<simpara>Sorting blogs by child documents' <literal>click_count</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "has_child" : {
            "type" : "blog_tag",
            "score_mode" : "max",
            "query" : {
                "function_score" : {
                    "script_score": {
                        "script": "_score * doc['click_count'].value"
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="query-dsl-has-parent-query">
<title>Has Parent Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-parent-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>has_parent</literal> query accepts a query and a parent type. The query is
executed in the parent document space, which is specified by the parent
type. This query returns child documents which associated parents have
matched. For the rest <literal>has_parent</literal> query has the same options and works
in the same manner as the <literal>has_child</literal> query.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "has_parent" : {
        "parent_type" : "blog",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</programlisting>
<bridgehead id="_scoring_capabilities_2" renderas="sect3">Scoring capabilities<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-parent-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>has_parent</literal> also has scoring support. The
supported score types are <literal>score</literal> or <literal>none</literal>. The default is <literal>none</literal> and
this ignores the score from the parent document. The score is in this
case equal to the boost on the <literal>has_parent</literal> query (Defaults to 1). If
the score type is set to <literal>score</literal>, then the score of the matching parent
document is aggregated into the child documents belonging to the
matching parent document. The score mode can be specified with the
<literal>score_mode</literal> field inside the <literal>has_parent</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "has_parent" : {
        "parent_type" : "blog",
        "score_mode" : "score",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</programlisting>
<bridgehead id="_sorting_2" renderas="sect3">Sorting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/has-parent-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Child documents can&#8217;t be sorted by fields in matching parent documents via the
regular sort options. If you need to sort child documents by field in the parent
documents then you can should use the <literal>function_score</literal> query and then just sort
by <literal>_score</literal>.</simpara>
<simpara>Sorting tags by parent document' <literal>view_count</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query": {
        "has_parent" : {
            "parent_type" : "blog",
            "score" : true,
            "query" : {
                "function_score" : {
                    "script_score": {
                        "script": "_score * doc['view_count'].value"
                    }
                }
            }
        }
    }
}</programlisting>
</section>
</chapter>
<chapter id="geo-queries">
<title>Geo queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-queries.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch supports two types of geo data:
<link linkend="geo-point"><literal>geo_point</literal></link> fields which support lat/lon pairs, and
<link linkend="geo-shape"><literal>geo_shape</literal></link> fields, which support points,
lines, circles, polygons, multi-polygons etc.</simpara>
<simpara>The queries in this group are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-geo-shape-query"><literal>geo_shape</literal></link> query
</term>
<listitem>
<simpara>
    Find document with geo-shapes which either intersect, are contained by, or
    do not intersect with the specified geo-shape.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-geo-bounding-box-query"><literal>geo_bounding_box</literal></link> query
</term>
<listitem>
<simpara>
    Finds documents with geo-points that fall into the specified rectangle.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-geo-distance-query"><literal>geo_distance</literal></link> query
</term>
<listitem>
<simpara>
    Finds document with geo-points within the specified distance of a central
    point.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-geo-distance-range-query"><literal>geo_distance_range</literal></link> query
</term>
<listitem>
<simpara>
    Like the <literal>geo_point</literal> query, but the range starts at a specified distance
    from the central point.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-geo-polygon-query"><literal>geo_polygon</literal></link> query
</term>
<listitem>
<simpara>
    Find documents with geo-points within the specified polygon.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-geohash-cell-query"><literal>geohash_cell</literal></link> query
</term>
<listitem>
<simpara>
    Find geo-points whose geohash intersects with the geohash of the specified
    point.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<important>
<title>Percolating geo-queries in Elasticsearch 2.2.0 or later</title>
<simpara>The new <link linkend="geo-point"><literal>geo_point</literal> fields</link> added in Elasticsearch 2.2.0 and
above require that <link linkend="doc-values"><literal>doc_values</literal></link> are enabled in order to
function. Unfortunately, the in-memory index used by the percolator does not
yet have support for <literal>doc_values</literal>, meaning that <link linkend="geo-queries">geo-queries</link>
will not work in a percolator index created in Elasticsearch 2.2.0 or later.</simpara>
<simpara>See <xref linkend="geo-percolate"/> for a workaround.</simpara>
</important>
<section id="query-dsl-geo-shape-query">
<title>GeoShape Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-shape-query.asciidoc">Edit me</ulink></title>
<simpara>Filter documents indexed using the <literal>geo_shape</literal> type.</simpara>
<simpara>Requires the <link linkend="geo-shape"><literal>geo_shape</literal> Mapping</link>.</simpara>
<simpara>The <literal>geo_shape</literal> query uses the same grid square representation as the
geo_shape mapping to find documents that have a shape that intersects
with the query shape. It will also use the same PrefixTree configuration
as defined for the field mapping.</simpara>
<simpara>The query supports two ways of defining the query shape, either by
providing a whole shape definition, or by referencing the name of a shape
pre-indexed in another index. Both formats are defined below with
examples.</simpara>
<section id="_inline_shape_definition">
<title>Inline Shape Definition<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-shape-query.asciidoc">Edit me</ulink></title>
<simpara>Similar to the <literal>geo_shape</literal> type, the <literal>geo_shape</literal> Filter uses
<ulink url="http://www.geojson.org">GeoJSON</ulink> to represent shapes.</simpara>
<simpara>Given a document that looks like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "name": "Wind &amp; Wetter, Berlin, Germany",
    "location": {
        "type": "Point",
        "coordinates": [13.400544, 52.530286]
    }
}</programlisting>
<simpara>The following query will find the point using the Elasticsearch&#8217;s
<literal>envelope</literal> GeoJSON extension:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "query":{
        "bool": {
            "must": {
                "match_all": {}
            },
            "filter": {
                "geo_shape": {
                    "location": {
                        "shape": {
                            "type": "envelope",
                            "coordinates" : [[13.0, 53.0], [14.0, 52.0]]
                        },
                        "relation": "within"
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_pre_indexed_shape">
<title>Pre-Indexed Shape<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-shape-query.asciidoc">Edit me</ulink></title>
<simpara>The Query also supports using a shape which has already been indexed in
another index and/or index type. This is particularly useful for when
you have a pre-defined list of shapes which are useful to your
application and you want to reference this using a logical name (for
example <emphasis>New Zealand</emphasis>) rather than having to provide their coordinates
each time. In this situation it is only necessary to provide:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>id</literal> - The ID of the document that containing the pre-indexed shape.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index</literal> - Name of the index where the pre-indexed shape is. Defaults
to <emphasis>shapes</emphasis>.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>type</literal> - Index type where the pre-indexed shape is.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path</literal> - The field specified as path containing the pre-indexed shape.
Defaults to <emphasis>shape</emphasis>.
</simpara>
</listitem>
</itemizedlist>
<simpara>The following is an example of using the Filter with a pre-indexed
shape:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool": {
        "must": {
            "match_all": {}
        },
        "filter": {
            "geo_shape": {
                "location": {
                    "indexed_shape": {
                        "id": "DEU",
                        "type": "countries",
                        "index": "shapes",
                        "path": "location"
                    }
                }
            }
        }
    }
}</programlisting>
</section>
<section id="_spatial_relations">
<title>Spatial Relations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-shape-query.asciidoc">Edit me</ulink></title>
<simpara>The <link linkend="spatial-strategy">geo_shape strategy</link> mapping parameter determines
which spatial relation operators may be used at search time.</simpara>
<simpara>The following is a complete list of spatial relation operators available:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>INTERSECTS</literal> - (default) Return all documents whose <literal>geo_shape</literal> field
intersects the query geometry.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>DISJOINT</literal> - Return all documents whose <literal>geo_shape</literal> field
has nothing in common with the query geometry.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>WITHIN</literal> - Return all documents whose <literal>geo_shape</literal> field
is within the query geometry.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>CONTAINS</literal> - Return all documents whose <literal>geo_shape</literal> field
contains the query geometry.
</simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section id="query-dsl-geo-bounding-box-query">
<title>Geo Bounding Box Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></title>
<simpara>A query allowing to filter hits based on a point location using a
bounding box. Assuming the following indexed document:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</programlisting>
<simpara>Then the following simple query can be executed with a
<literal>geo_bounding_box</literal> filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_query_options" renderas="sect3">Query Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Option </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>_name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Optional name field to identify the filter</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ignore_malformed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>true</literal> to
accept geo points with invalid latitude or longitude (default is <literal>false</literal>).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to one of <literal>indexed</literal> or <literal>memory</literal> to defines whether this filter will
be executed in memory or indexed. See <link linkend="geo-bbox-type">Type</link> below for further details
Default is <literal>memory</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_accepted_formats" renderas="sect3">Accepted Formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>In much the same way the geo_point type can accept different
representations of the geo point, the filter can accept it as well:</simpara>
<bridgehead id="_lat_lon_as_properties_2" renderas="sect4">Lat Lon As Properties<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_lat_lon_as_array_2" renderas="sect4">Lat Lon As Array<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>[lon, lat]</literal>, note, the order of lon/lat here in order to
conform with <ulink url="http://geojson.org/">GeoJSON</ulink>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : [-74.1, 40.73],
                    "bottom_right" : [-71.12, 40.01]
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_lat_lon_as_string_2" renderas="sect4">Lat Lon As String<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>lat,lon</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "40.73, -74.1",
                    "bottom_right" : "40.01, -71.12"
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_geohash_2" renderas="sect4">Geohash<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "dr5r9ydj2y73",
                    "bottom_right" : "drj7teegpus6"
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_vertices" renderas="sect3">Vertices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The vertices of the bounding box can either be set by <literal>top_left</literal> and
<literal>bottom_right</literal> or by <literal>top_right</literal> and <literal>bottom_left</literal> parameters. More
over the names <literal>topLeft</literal>, <literal>bottomRight</literal>, <literal>topRight</literal> and <literal>bottomLeft</literal>
are supported. Instead of setting the values pairwise, one can use
the simple names <literal>top</literal>, <literal>left</literal>, <literal>bottom</literal> and <literal>right</literal> to set the
values separately.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top" : -74.1,
                    "left" : 40.73,
                    "bottom" : -71.12,
                    "right" : 40.01
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_geo_point_type_2" renderas="sect3">geo_point Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The filter <emphasis role="strong">requires</emphasis> the <literal>geo_point</literal> type to be set on the relevant
field.</simpara>
<bridgehead id="_multi_location_per_document" renderas="sect3">Multi Location Per Document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The filter can work with multiple locations / points per document. Once
a single location / point matches the filter, the document will be
included in the filter</simpara>
<bridgehead id="geo-bbox-type" renderas="sect3">Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-bounding-box-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The type of the bounding box execution by default is set to <literal>memory</literal>,
which means in memory checks if the doc falls within the bounding box
range. In some cases, an <literal>indexed</literal> option will perform faster (but note
that the <literal>geo_point</literal> type must have lat and lon indexed in this case).
Note, when using the indexed option, multi locations per document field
are not supported. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.10,
                        "lon" : -71.12
                    }
                },
                "type" : "indexed"
            }
        }
    }
}</programlisting>
</section>
<section id="query-dsl-geo-distance-query">
<title>Geo Distance Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></title>
<simpara>Filters documents that include only hits that exists within a specific
distance from a geo point. Assuming the following indexed json:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</programlisting>
<simpara>Then the following simple query can be executed with a <literal>geo_distance</literal>
filter:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "200km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_accepted_formats_2" renderas="sect3">Accepted Formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>In much the same way the <literal>geo_point</literal> type can accept different
representations of the geo point, the filter can accept it as well:</simpara>
<bridgehead id="_lat_lon_as_properties_3" renderas="sect4">Lat Lon As Properties<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_lat_lon_as_array_3" renderas="sect4">Lat Lon As Array<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>[lon, lat]</literal>, note, the order of lon/lat here in order to
conform with <ulink url="http://geojson.org/">GeoJSON</ulink>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : [-70, 40]
            }
        }
    }
}</programlisting>
<bridgehead id="_lat_lon_as_string_3" renderas="sect4">Lat Lon As String<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>lat,lon</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "40,-70"
            }
        }
    }
}</programlisting>
<bridgehead id="_geohash_3" renderas="sect4">Geohash<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "drm3btev3e86"
            }
        }
    }
}</programlisting>
<bridgehead id="_options_4" renderas="sect3">Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following are options allowed on the filter:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>distance</literal>
</simpara>
</entry>
<entry>
<simpara>
    The radius of the circle centred on the specified location. Points which
    fall into this circle are considered to be matches. The <literal>distance</literal> can be
    specified in various units. See <xref linkend="distance-units"/>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>distance_type</literal>
</simpara>
</entry>
<entry>
<simpara>
    How to compute the distance. Can either be <literal>sloppy_arc</literal> (default), <literal>arc</literal> (slightly more precise but significantly slower) or <literal>plane</literal> (faster, but inaccurate on long distances and close to the poles).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>optimize_bbox</literal>
</simpara>
</entry>
<entry>
<simpara>
    Whether to use the optimization of first running a bounding box check
    before the distance check. Defaults to <literal>memory</literal> which will do in memory
    checks. Can also have values of <literal>indexed</literal> to use indexed value check (make
    sure the <literal>geo_point</literal> type index lat lon in this case), or <literal>none</literal> which
    disables bounding box optimization. <phrase revisionflag="deleted" revision="2.2">Deprecated in 2.2.</phrase>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_name</literal>
</simpara>
</entry>
<entry>
<simpara>
    Optional name field to identify the query
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ignore_malformed</literal>
</simpara>
</entry>
<entry>
<simpara>
    Set to <literal>true</literal> to accept geo points with invalid latitude or
    longitude (default is <literal>false</literal>).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_geo_point_type_3" renderas="sect3">geo_point Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The filter <emphasis role="strong">requires</emphasis> the <literal>geo_point</literal> type to be set on the relevant
field.</simpara>
<bridgehead id="_multi_location_per_document_2" renderas="sect3">Multi Location Per Document<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>geo_distance</literal> filter can work with multiple locations / points per
document. Once a single location / point matches the filter, the
document will be included in the filter.</simpara>
</section>
<section id="query-dsl-geo-distance-range-query">
<title>Geo Distance Range Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-distance-range-query.asciidoc">Edit me</ulink></title>
<simpara>Filters documents that exists within a range from a specific point:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance_range" : {
                "from" : "200km",
                "to" : "400km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</programlisting>
<simpara>Supports the same point location parameter and query options as the
<link linkend="query-dsl-geo-distance-query">geo_distance</link>
filter. And also support the common parameters for range (lt, lte, gt,
gte, from, to, include_upper and include_lower).</simpara>
</section>
<section id="query-dsl-geo-polygon-query">
<title>Geo Polygon Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></title>
<simpara>A query allowing to include hits that only fall within a polygon of
points. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        {"lat" : 40, "lon" : -70},
                        {"lat" : 30, "lon" : -80},
                        {"lat" : 20, "lon" : -90}
                    ]
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_query_options_2" renderas="sect3">Query Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Option </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>_name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Optional name field to identify the filter</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ignore_malformed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>true</literal> to accept geo points with invalid latitude or
longitude (default is <literal>false</literal>).</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_allowed_formats" renderas="sect3">Allowed Formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="_lat_long_as_array" renderas="sect4">Lat Long as Array<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>[lon, lat]</literal>, note, the order of lon/lat here in order to
conform with <ulink url="http://geojson.org/">GeoJSON</ulink>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        [-70, 40],
                        [-80, 30],
                        [-90, 20]
                    ]
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_lat_lon_as_string_4" renderas="sect4">Lat Lon as String<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Format in <literal>lat,lon</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "40, -70",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_geohash_4" renderas="sect4">Geohash<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "drn5x1g8cu2y",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</programlisting>
<bridgehead id="_geo_point_type_4" renderas="sect3">geo_point Type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geo-polygon-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>The query <emphasis role="strong">requires</emphasis> the <link linkend="geo-point"><literal>geo_point</literal></link> type to be set on the
relevant field.</simpara>
</section>
<section id="query-dsl-geohash-cell-query">
<title>Geohash Cell Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/geohash-cell-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geohash_cell</literal> query provides access to a hierarchy of geohashes.
By defining a geohash cell, only <link linkend="geo-point">geopoints</link>
within this cell will match this filter.</simpara>
<simpara>To get this filter working all prefixes of a geohash need to be indexed. In
example a geohash <literal>u30</literal> needs to be decomposed into three terms: <literal>u30</literal>,
<literal>u3</literal> and <literal>u</literal>. This decomposition must be enabled in the mapping of the
<link linkend="geo-point">geopoint</link> field that&#8217;s going to be filtered by
setting the <literal>geohash_prefix</literal> option:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "mappings" : {
        "location": {
            "properties": {
                "pin": {
                    "type": "geo_point",
                    "geohash": true,
                    "geohash_prefix": true,
                    "geohash_precision": 10
                }
            }
        }
    }
}</programlisting>
<simpara>The geohash cell can be defined by all formats of <literal>geo_points</literal>. If such a cell is
defined by a latitude and longitude pair the size of the cell needs to be
set up. This can be done by the <literal>precision</literal> parameter of the filter. This
parameter can be set to an integer value which sets the length of the geohash
prefix. Instead of setting a geohash length directly it is also possible to
define the precision as distance, in example <literal>"precision": "50m"</literal>. (See
<xref linkend="distance-units"/>.)</simpara>
<simpara>The <literal>neighbors</literal> option of the filter offers the possibility to filter cells
next to the given cell.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "bool" : {
        "must" : {
            "match_all" : {}
        },
        "filter" : {
            "geohash_cell": {
                "pin": {
                    "lat": 13.4080,
                    "lon": 52.5186
                },
                "precision": 3,
                "neighbors": true
            }
        }
    }
}</programlisting>
</section>
</chapter>
<chapter id="specialized-queries">
<title>Specialized queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/special-queries.asciidoc">Edit me</ulink></title>
<simpara>This group contains queries which do not fit into the other groups:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-mlt-query"><literal>more_like_this</literal> query</link>
</term>
<listitem>
<simpara>
This query finds documents which are similar to the specified text, document,
or collection of documents.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-template-query"><literal>template</literal> query</link>
</term>
<listitem>
<simpara>
The <literal>template</literal> query accepts a Mustache template (either inline, indexed, or
from a file), and a map of parameters,  and combines the two to generate the
final query to execute.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-script-query"><literal>script</literal> query</link>
</term>
<listitem>
<simpara>
This query allows a script to act as a filter.  Also see the
<link linkend="query-dsl-function-score-query"><literal>function_score</literal> query</link>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="query-dsl-mlt-query">
<title>More Like This Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></title>
<simpara>The More Like This Query (MLT Query) finds documents that are "like" a given
set of documents. In order to do so, MLT selects a set of representative terms
of these input documents, forms a query using these terms, executes the query
and returns the results. The user controls the input documents, how the terms
should be selected and how the query is formed. <literal>more_like_this</literal> can be
shortened to <literal>mlt</literal>.</simpara>
<simpara>The simplest use case consists of asking for documents that are similar to a
provided piece of text. Here, we are asking for all movies that have some text
similar to "Once upon a time" in their "title" and in their "description"
fields, limiting the number of selected terms to 12.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "more_like_this" : {
        "fields" : ["title", "description"],
        "like" : "Once upon a time",
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</programlisting>
<simpara>A more complicated use case consists of mixing texts with documents already
existing in the index. In this case, the syntax to specify a document is
similar to the one used in the <link linkend="docs-multi-get">Multi GET API</link>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "more_like_this" : {
        "fields" : ["title", "description"],
        "like" : [
        {
            "_index" : "imdb",
            "_type" : "movies",
            "_id" : "1"
        },
        {
            "_index" : "imdb",
            "_type" : "movies",
            "_id" : "2"
        },
        "and potentially some more text here as well"
        ],
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</programlisting>
<simpara>Finally, users can mix some texts, a chosen set of documents but also provide
documents not necessarily present in the index. To provide documents not
present in the index, the syntax is similar to <link linkend="docs-termvectors-artificial-doc">artificial documents</link>.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "more_like_this" : {
        "fields" : ["name.first", "name.last"],
        "like" : [
        {
            "_index" : "marvel",
            "_type" : "quotes",
            "doc" : {
                "name": {
                    "first": "Ben",
                    "last": "Grimm"
                },
                "tweet": "You got no idea what I'd... what I'd give to be invisible."
            }
        },
        {
            "_index" : "marvel",
            "_type" : "quotes",
            "_id" : "2"
        }
        ],
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</programlisting>
<section id="_how_it_works">
<title>How it Works<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></title>
<simpara>Suppose we wanted to find all documents similar to a given input document.
Obviously, the input document itself should be its best match for that type of
query. And the reason would be mostly, according to
<ulink url="https://lucene.apache.org/core/4_9_0/core/org/apache/lucene/search/similarities/TFIDFSimilarity.html">Lucene scoring formula</ulink>,
due to the terms with the highest tf-idf. Therefore, the terms of the input
document that have the highest tf-idf are good representatives of that
document, and could be used within a disjunctive query (or <literal>OR</literal>) to retrieve similar
documents. The MLT query simply extracts the text from the input document,
analyzes it, usually using the same analyzer at the field, then selects the
top K terms with highest tf-idf to form a disjunctive query of these terms.</simpara>
<important><simpara>The fields on which to perform MLT must be indexed and of type
<literal>string</literal>. Additionally, when using <literal>like</literal> with documents, either <literal>_source</literal>
must be enabled or the fields must be <literal>stored</literal> or store <literal>term_vector</literal>. In
order to speed up analysis, it could help to store term vectors at index time.</simpara></important>
<simpara>For example, if we wish to perform MLT on the "title" and "tags.raw" fields,
we can explicitly store their <literal>term_vector</literal> at index time. We can still
perform MLT on the "description" and "tags" fields, as <literal>_source</literal> is enabled by
default, but there will be no speed up on analysis for these fields.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -s -XPUT 'http://localhost:9200/imdb/' -d '{
  "mappings": {
    "movies": {
      "properties": {
        "title": {
          "type": "string",
          "term_vector": "yes"
         },
         "description": {
          "type": "string"
        },
        "tags": {
          "type": "string",
          "fields" : {
            "raw": {
              "type" : "string",
              "index" : "not_analyzed",
              "term_vector" : "yes"
            }
          }
        }
      }
    }
  }
}</programlisting>
</section>
<section id="_parameters_7">
<title>Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></title>
<simpara>The only required parameter is <literal>like</literal>, all other parameters have sensible
defaults. There are three types of parameters: one to specify the document
input, the other one for term selection and for query formation.</simpara>
<bridgehead id="_document_input_parameters" renderas="sect3">Document Input Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>like</literal>
</simpara>
</entry>
<entry>
<simpara>
The only <emphasis role="strong">required</emphasis> parameter of the MLT query is <literal>like</literal> and follows a
versatile syntax, in which the user can specify free form text and/or a single
or multiple documents (see examples above). The syntax to specify documents is
similar to the one used by the <link linkend="docs-multi-get">Multi GET API</link>. When
specifying documents, the text is fetched from <literal>fields</literal> unless overridden in
each document request. The text is analyzed by the analyzer at the field, but
could also be overridden. The syntax to override the analyzer at the field
follows a similar syntax to the <literal>per_field_analyzer</literal> parameter of the
<link linkend="docs-termvectors-per-field-analyzer">Term Vectors API</link>.
Additionally, to provide documents not necessarily present in the index,
<link linkend="docs-termvectors-artificial-doc">artificial documents</link> are also supported.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>unlike</literal>
</simpara>
</entry>
<entry>
<simpara>
The <literal>unlike</literal> parameter is used in conjunction with <literal>like</literal> in order not to
select terms found in a chosen set of documents. In other words, we could ask
for documents <literal>like: "Apple"</literal>, but <literal>unlike: "cake crumble tree"</literal>. The syntax
is the same as <literal>like</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>fields</literal>
</simpara>
</entry>
<entry>
<simpara>
A list of fields to fetch and analyze the text from. Defaults to the <literal>_all</literal>
field for free text and to all possible fields for document inputs.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>like_text</literal>
</simpara>
</entry>
<entry>
<simpara>
<phrase revisionflag="deleted" revision="2.0.0-beta1">Deprecated in 2.0.0-beta1. Replaced by <literal>like</literal>.</phrase>
The text to find documents like it.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ids</literal> or <literal>docs</literal>
</simpara>
</entry>
<entry>
<simpara>
<phrase revisionflag="deleted" revision="2.0.0-beta1">Deprecated in 2.0.0-beta1. Replaced by <literal>like</literal>.</phrase>
A list of documents following the same syntax as the <link linkend="docs-multi-get">Multi GET API</link>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="mlt-query-term-selection" renderas="sect3">Term Selection Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>max_query_terms</literal>
</simpara>
</entry>
<entry>
<simpara>
The maximum number of query terms that will be selected. Increasing this value
gives greater accuracy at the expense of query execution speed. Defaults to
<literal>25</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_term_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
The minimum term frequency below which the terms will be ignored from the
input document. Defaults to <literal>2</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
The minimum document frequency below which the terms will be ignored from the
input document. Defaults to <literal>5</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_doc_freq</literal>
</simpara>
</entry>
<entry>
<simpara>
The maximum document frequency above which the terms will be ignored from the
input document. This could be useful in order to ignore highly frequent words
such as stop words. Defaults to unbounded (<literal>0</literal>).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
The minimum word length below which the terms will be ignored. The old name
<literal>min_word_len</literal> is deprecated. Defaults to <literal>0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_word_length</literal>
</simpara>
</entry>
<entry>
<simpara>
The maximum word length above which the terms will be ignored. The old name
<literal>max_word_len</literal> is deprecated. Defaults to unbounded (<literal>0</literal>).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stop_words</literal>
</simpara>
</entry>
<entry>
<simpara>
An array of stop words. Any word in this set is considered "uninteresting" and
ignored. If the analyzer allows for stop words, you might want to tell MLT to
explicitly ignore them, as for the purposes of document similarity it seems
reasonable to assume that "a stop word is never interesting".
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyzer</literal>
</simpara>
</entry>
<entry>
<simpara>
The analyzer that is used to analyze the free form text. Defaults to the
analyzer associated with the first field in <literal>fields</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_query_formation_parameters" renderas="sect3">Query Formation Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/mlt-query.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>minimum_should_match</literal>
</simpara>
</entry>
<entry>
<simpara>
After the disjunctive query has been formed, this parameter controls the
number of terms that must match.
The syntax is the same as the <link linkend="query-dsl-minimum-should-match">minimum should match</link>.
(Defaults to <literal>"30%"</literal>).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>boost_terms</literal>
</simpara>
</entry>
<entry>
<simpara>
Each term in the formed query could be further boosted by their tf-idf score.
This sets the boost factor to use when using this feature. Defaults to
deactivated (<literal>0</literal>). Any other positive value activates terms boosting with the
given boost factor.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>include</literal>
</simpara>
</entry>
<entry>
<simpara>
Specifies whether the input documents should also be included in the search
results returned. Defaults to <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>boost</literal>
</simpara>
</entry>
<entry>
<simpara>
Sets the boost value of the whole query. Defaults to <literal>1.0</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="query-dsl-template-query">
<title>Template Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/template-query.asciidoc">Edit me</ulink></title>
<simpara>A query that accepts a query template and a map of key/value pairs to fill in
template parameters. Templating is based on Mustache. For simple token substitution all you provide
is a query containing some variable that you want to substitute and the actual
values:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
    "query": {
        "template": {
            "inline": { "match": { "text": "{{query_string}}" }},
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</programlisting>
<simpara>The above request is translated into:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
    "query": {
        "match": {
            "text": "all about search"
        }
    }
}</programlisting>
<simpara>Alternatively passing the template as an escaped string works as well:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
    "query": {
        "template": {
            "inline": "{ \"match\": { \"text\": \"{{query_string}}\" }}", <co id="CO152-1"/>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO152-1">
<para>
New line characters (<literal>\n</literal>) should be escaped as <literal>\\n</literal> or removed,
    and quotes (<literal>"</literal>) should be escaped as <literal>\\"</literal>.
</para>
</callout>
</calloutlist>
<section id="_stored_templates">
<title>Stored templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/template-query.asciidoc">Edit me</ulink></title>
<simpara>You can register a template by storing it in the <literal>config/scripts</literal> directory, in a file using the <literal>.mustache</literal> extension.
In order to execute the stored template, reference it by name in the <literal>file</literal>
parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
    "query": {
        "template": {
            "file": "my_template", <co id="CO153-1"/>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO153-1">
<para>
Name of the query template in <literal>config/scripts/</literal>, i.e., <literal>my_template.mustache</literal>.
</para>
</callout>
</calloutlist>
<simpara>Alternatively, you can register a query template in the special <literal>.scripts</literal> index with:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_search/template/my_template
{
    "template": { "match": { "text": "{{query_string}}" }},
}</programlisting>
<simpara>and refer to it in the <literal>template</literal> query with the <literal>id</literal> parameter:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
    "query": {
        "template": {
            "id": "my_template", <co id="CO154-1"/>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</programlisting>
<calloutlist>
<callout arearefs="CO154-1">
<para>
Name of the query template in <literal>config/scripts/</literal>, i.e., <literal>my_template.mustache</literal>.
</para>
</callout>
</calloutlist>
<simpara>There is also a dedicated <literal>template</literal> endpoint, allows you to template an entire search request.
Please see <xref linkend="search-template"/> for more details.</simpara>
</section>
</section>
<section id="query-dsl-script-query">
<title>Script Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/script-query.asciidoc">Edit me</ulink></title>
<simpara>A query allowing to define
<link linkend="modules-scripting">scripts</link> as queries. They are typically used in a filter
context, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"bool" : {
    "must" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : "doc['num1'].value &gt; 1"
        }
    }
}</programlisting>
<bridgehead id="_custom_parameters" renderas="sect3">Custom Parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/script-query.asciidoc">Edit me</ulink></bridgehead>
<simpara>Scripts are compiled and cached for faster execution. If the same script
can be used, just with different parameters provider, it is preferable
to use the ability to pass parameters to the script itself, for example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"bool" : {
    "must" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : {
                "inline" : "doc['num1'].value &gt; param1",
                "params" : {
                    "param1" : 5
                }
            }
        }
    }
}</programlisting>
</section>
</chapter>
<chapter id="span-queries">
<title>Span queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-queries.asciidoc">Edit me</ulink></title>
<simpara>Span queries are low-level positional queries which provide expert control
over the order and proximity of the specified terms. These are typically used
to implement very specific queries on legal documents or patents.</simpara>
<simpara>Span queries cannot be mixed with non-span queries (with the exception of the <literal>span_multi</literal> query).</simpara>
<simpara>The queries in this group are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="query-dsl-span-term-query"><literal>span_term</literal> query</link>
</term>
<listitem>
<simpara>
The equivalent of the <link linkend="query-dsl-term-query"><literal>term</literal> query</link> but for use with
other span queries.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-multi-term-query"><literal>span_multi</literal> query</link>
</term>
<listitem>
<simpara>
Wraps a <link linkend="query-dsl-term-query"><literal>term</literal></link>, <link linkend="query-dsl-range-query"><literal>range</literal></link>,
<link linkend="query-dsl-prefix-query"><literal>prefix</literal></link>, <link linkend="query-dsl-wildcard-query"><literal>wildcard</literal></link>,
<link linkend="query-dsl-regexp-query"><literal>regexp</literal></link>, or <link linkend="query-dsl-fuzzy-query"><literal>fuzzy</literal></link> query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-first-query"><literal>span_first</literal> query</link>
</term>
<listitem>
<simpara>
Accepts another span query whose matches must appear within the first N
positions of the field.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-near-query"><literal>span_near</literal> query</link>
</term>
<listitem>
<simpara>
Accepts multiple span queries whose matches must be within the specified distance of each other, and possibly in the same order.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-or-query"><literal>span_or</literal> query</link>
</term>
<listitem>
<simpara>
Combines multiple span queries&#8201;&#8212;&#8201;returns documents which match any of the
specified queries.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-not-query"><literal>span_not</literal> query</link>
</term>
<listitem>
<simpara>
Wraps another span query, and excludes any documents which match that query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-containing-query"><literal>span_containing</literal> query</link>
</term>
<listitem>
<simpara>
Accepts a list of span queries, but only returns those spans which also match a second span query.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-within-query"><literal>span_within</literal> query</link>
</term>
<listitem>
<simpara>
The result from a single span query is returned as long is its span falls
within the spans returned by a list of other span queries.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-dsl-span-field-masking-query"><literal>field_masking_span</literal> query</link>
</term>
<listitem>
<simpara>
Allows queries like <literal>span-near</literal> or <literal>span-or</literal> across different fields.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="query-dsl-span-term-query">
<title>Span Term Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-term-query.asciidoc">Edit me</ulink></title>
<simpara>Matches spans containing a term. The span term query maps to Lucene
<literal>SpanTermQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_term" : { "user" : "kimchy" }
}</programlisting>
<simpara>A boost can also be associated with the query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_term" : { "user" : { "value" : "kimchy", "boost" : 2.0 } }
}</programlisting>
<simpara>Or :</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_term" : { "user" : { "term" : "kimchy", "boost" : 2.0 } }
}</programlisting>
</section>
<section id="query-dsl-span-multi-term-query">
<title>Span Multi Term Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-multi-term-query.asciidoc">Edit me</ulink></title>
<simpara>The <literal>span_multi</literal> query allows you to wrap a <literal>multi term query</literal> (one of wildcard,
fuzzy, prefix, term, range or regexp query) as a <literal>span query</literal>, so
it can be nested. Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki" } }
        }
    }
}</programlisting>
<simpara>A boost can also be associated with the query:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki", "boost" : 1.08 } }
        }
    }
}</programlisting>
</section>
<section id="query-dsl-span-first-query">
<title>Span First Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-first-query.asciidoc">Edit me</ulink></title>
<simpara>Matches spans near the beginning of a field. The span first query maps
to Lucene <literal>SpanFirstQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_first" : {
        "match" : {
            "span_term" : { "user" : "kimchy" }
        },
        "end" : 3
    }
}</programlisting>
<simpara>The <literal>match</literal> clause can be any other span type query. The <literal>end</literal> controls
the maximum end position permitted in a match.</simpara>
</section>
<section id="query-dsl-span-near-query">
<title>Span Near Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-near-query.asciidoc">Edit me</ulink></title>
<simpara>Matches spans which are near one another. One can specify <emphasis>slop</emphasis>, the
maximum number of intervening unmatched positions, as well as whether
matches are required to be in-order. The span near query maps to Lucene
<literal>SpanNearQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_near" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ],
        "slop" : 12,
        "in_order" : false,
        "collect_payloads" : false
    }
}</programlisting>
<simpara>The <literal>clauses</literal> element is a list of one or more other span type queries
and the <literal>slop</literal> controls the maximum number of intervening unmatched
positions permitted.</simpara>
</section>
<section id="query-dsl-span-or-query">
<title>Span Or Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-or-query.asciidoc">Edit me</ulink></title>
<simpara>Matches the union of its span clauses. The span or query maps to Lucene
<literal>SpanOrQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_or" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ]
    }
}</programlisting>
<simpara>The <literal>clauses</literal> element is a list of one or more other span type queries.</simpara>
</section>
<section id="query-dsl-span-not-query">
<title>Span Not Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-not-query.asciidoc">Edit me</ulink></title>
<simpara>Removes matches which overlap with another span query. The span not
query maps to Lucene <literal>SpanNotQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_not" : {
        "include" : {
            "span_term" : { "field1" : "hoya" }
        },
        "exclude" : {
            "span_near" : {
                "clauses" : [
                    { "span_term" : { "field1" : "la" } },
                    { "span_term" : { "field1" : "hoya" } }
                ],
                "slop" : 0,
                "in_order" : true
            }
        }
    }
}</programlisting>
<simpara>The <literal>include</literal> and <literal>exclude</literal> clauses can be any span type query. The
<literal>include</literal> clause is the span query whose matches are filtered, and the
<literal>exclude</literal> clause is the span query whose matches must not overlap those
returned.</simpara>
<simpara>In the above example all documents with the term hoya are filtered except the ones that have <emphasis>la</emphasis> preceding them.</simpara>
<simpara>Other top level options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>pre</literal>
</simpara>
</entry>
<entry>
<simpara>
If set the amount of tokens before the include span can&#8217;t have overlap with the exclude span.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>post</literal>
</simpara>
</entry>
<entry>
<simpara>
If set the amount of tokens after the include span can&#8217;t have overlap with the exclude span.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>dist</literal>
</simpara>
</entry>
<entry>
<simpara>
If set the amount of tokens from within the include span can&#8217;t have overlap with the exclude span. Equivalent
            of setting both <literal>pre</literal> and <literal>post</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="query-dsl-span-containing-query">
<title>Span Containing Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-containing-query.asciidoc">Edit me</ulink></title>
<simpara>Returns matches which enclose another span query. The span containing
query maps to Lucene <literal>SpanContainingQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_containing" : {
        "little" : {
            "span_term" : { "field1" : "foo" }
        },
        "big" : {
            "span_near" : {
                "clauses" : [
                    { "span_term" : { "field1" : "bar" } },
                    { "span_term" : { "field1" : "baz" } }
                ],
                "slop" : 5,
                "in_order" : true
            }
        }
    }
}</programlisting>
<simpara>The <literal>big</literal> and <literal>little</literal> clauses can be any span type query. Matching
spans from <literal>big</literal> that contain matches from <literal>little</literal> are returned.</simpara>
</section>
<section id="query-dsl-span-within-query">
<title>Span Within Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-within-query.asciidoc">Edit me</ulink></title>
<simpara>Returns matches which are enclosed inside another span query. The span within
query maps to Lucene <literal>SpanWithinQuery</literal>. Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "span_within" : {
        "little" : {
            "span_term" : { "field1" : "foo" }
        },
        "big" : {
            "span_near" : {
                "clauses" : [
                    { "span_term" : { "field1" : "bar" } },
                    { "span_term" : { "field1" : "baz" } }
                ],
                "slop" : 5,
                "in_order" : true
            }
        }
    }
}</programlisting>
<simpara>The <literal>big</literal> and <literal>little</literal> clauses can be any span type query. Matching
spans from <literal>little</literal> that are enclosed within <literal>big</literal> are returned.</simpara>
</section>
<section id="query-dsl-span-field-masking-query">
<title>Span Field Masking Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/span-field-masking-query.asciidoc">Edit me</ulink></title>
<simpara>Wrapper to allow span queries to participate in composite single-field span queries by <emphasis>lying</emphasis> about their search field. The span field masking query maps to Lucene&#8217;s <literal>SpanFieldMaskingQuery</literal></simpara>
<simpara>This can be used to support queries like <literal>span-near</literal> or <literal>span-or</literal> across different fields, which is not ordinarily permitted.</simpara>
<simpara>Span field masking query is invaluable in conjunction with <emphasis role="strong">multi-fields</emphasis> when same content is indexed with multiple analyzers. For instance we could index a field with the standard analyzer which breaks text up into words, and again with the english analyzer which stems words into their root form.</simpara>
<simpara>Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
  "query": {
    "span_near": {
      "clauses": [
        {
          "span_term": {
            "text": "quick brown"
          }
        },
        {
          "field_masking_span": {
            "query": {
              "span_term": {
                "text.stems": "fox"
              }
            },
            "field": "text"
          }
        }
      ],
      "slop": 5,
      "in_order": false
    }
  }
}</programlisting>
<remark> CONSOLE</remark>
<simpara>Note: as span field masking query returns the masked field, scoring will be done using the norms of the field name supplied. This may lead to unexpected scoring behaviour.</simpara>
</section>
</chapter>
<chapter id="query-dsl-minimum-should-match">
<title>Minimum Should Match<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/minimum-should-match.asciidoc">Edit me</ulink></title>
<simpara>The <literal>minimum_should_match</literal> parameter possible values:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Type </entry>
<entry align="left" valign="top">Example </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara><literal>3</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Indicates a fixed value regardless of the number of
optional clauses.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Negative integer</simpara></entry>
<entry align="left" valign="top"><simpara><literal>-2</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Indicates that the total number of optional
clauses, minus this number should be mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Percentage</simpara></entry>
<entry align="left" valign="top"><simpara><literal>75%</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Indicates that this percent of the total number of
optional clauses are necessary. The number computed from the percentage
is rounded down and used as the minimum.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Negative percentage</simpara></entry>
<entry align="left" valign="top"><simpara><literal>-25%</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Indicates that this percent of the total
number of optional clauses can be missing. The number computed from the
percentage is rounded down, before being subtracted from the total to
determine the minimum.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Combination</simpara></entry>
<entry align="left" valign="top"><simpara><literal>3&lt;90%</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A positive integer, followed by the less-than
symbol, followed by any of the previously mentioned specifiers is a
conditional specification. It indicates that if the number of optional
clauses is equal to (or less than) the integer, they are all required,
but if it&#8217;s greater than the integer, the specification applies. In this
example: if there are 1 to 3 clauses they are all required, but for 4 or
more clauses only 90% are required.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Multiple combinations</simpara></entry>
<entry align="left" valign="top"><simpara><literal>2&lt;-25% 9&lt;-3</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Multiple conditional
specifications can be separated by spaces, each one only being valid for
numbers greater than the one before it. In this example: if there are 1
or 2 clauses both are required, if there are 3-9 clauses all but 25% are
required, and if there are more than 9 clauses, all but three are
required.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara><emphasis role="strong">NOTE:</emphasis></simpara>
<simpara>When dealing with percentages, negative values can be used to get
different behavior in edge cases. 75% and -25% mean the same thing when
dealing with 4 clauses, but when dealing with 5 clauses 75% means 3 are
required, but -25% means 4 are required.</simpara>
<simpara>If the calculations based on the specification determine that no
optional clauses are needed, the usual rules about BooleanQueries still
apply at search time (a BooleanQuery containing no required clauses must
still match at least one optional clause)</simpara>
<simpara>No matter what number the calculation arrives at, a value greater than
the number of optional clauses, or a value less than 1 will never be
used. (ie: no matter how low or how high the result of the calculation
result is, the minimum number of required matches will never be lower
than 1 or greater than the number of clauses.</simpara>
</chapter>
<chapter id="query-dsl-multi-term-rewrite">
<title>Multi Term Query Rewrite<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/query-dsl/multi-term-rewrite.asciidoc">Edit me</ulink></title>
<simpara>Multi term queries, like
<link linkend="query-dsl-wildcard-query">wildcard</link> and
<link linkend="query-dsl-prefix-query">prefix</link> are called
multi term queries and end up going through a process of rewrite. This
also happens on the
<link linkend="query-dsl-query-string-query">query_string</link>.
All of those queries allow to control how they will get rewritten using
the <literal>rewrite</literal> parameter:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>constant_score</literal> (default): A rewrite method that performs like
<literal>constant_score_boolean</literal> when there are few matching terms and otherwise
visits all matching terms in sequence and marks documents for that term.
Matching documents are assigned a constant score equal to the query&#8217;s
boost.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>scoring_boolean</literal>: A rewrite method that first translates each term
into a should clause in a boolean query, and keeps the scores as
computed by the query. Note that typically such scores are meaningless
to the user, and require non-trivial CPU to compute, so it&#8217;s almost
always better to use <literal>constant_score_auto</literal>. This rewrite method will hit
too many clauses failure if it exceeds the boolean query limit (defaults
to <literal>1024</literal>).
</simpara>
</listitem>
<listitem>
<simpara>
<literal>constant_score_boolean</literal>: Similar to <literal>scoring_boolean</literal> except scores
are not computed. Instead, each matching document receives a constant
score equal to the query&#8217;s boost. This rewrite method will hit too many
clauses failure if it exceeds the boolean query limit (defaults to
<literal>1024</literal>).
</simpara>
</listitem>
<listitem>
<simpara>
<literal>top_terms_N</literal>: A rewrite method that first translates each term into
should clause in boolean query, and keeps the scores as computed by the
query. This rewrite method only uses the top scoring terms so it will
not overflow boolean max clause count. The <literal>N</literal> controls the size of the
top scoring terms to use.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>top_terms_boost_N</literal>: A rewrite method that first translates each term
into should clause in boolean query, but the scores are only computed as
the boost. This rewrite method only uses the top scoring terms so it
will not overflow the boolean max clause count. The <literal>N</literal> controls the
size of the top scoring terms to use.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>top_terms_blended_freqs_N</literal>: A rewrite method that first translates each
term into should clause in boolean query, but all term queries compute scores
as if they had the same frequency. In practice the frequency which is used
is the maximum frequency of all matching terms. This rewrite method only uses
the top scoring terms so it will not overflow boolean max clause count. The
<literal>N</literal> controls the size of the top scoring terms to use.
</simpara>
</listitem>
</itemizedlist>
</chapter>
</part>
<part id="mapping">
<title>Mapping <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>Mapping is the process of defining how a document, and the fields it contains,
are stored and indexed.  For instance, use mappings to define:</simpara>
<itemizedlist>
<listitem>
<simpara>
which string fields should be treated as full text fields.
</simpara>
</listitem>
<listitem>
<simpara>
which fields contain numbers, dates, or geolocations.
</simpara>
</listitem>
<listitem>
<simpara>
whether the values of all fields in the document should be
  indexed into the catch-all <link linkend="mapping-all-field"><literal>_all</literal></link> field.
</simpara>
</listitem>
<listitem>
<simpara>
the <link linkend="mapping-date-format">format</link> of date values.
</simpara>
</listitem>
<listitem>
<simpara>
custom rules to control the mapping for
  <link linkend="dynamic-mapping">dynamically added fields</link>.
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="mapping-type" renderas="sect1">Mapping Types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each index has one or more <emphasis>mapping types</emphasis>, which are used to divide the
documents in an index into logical groups. User documents might be stored in a
<literal>user</literal> type, and blog posts in a <literal>blogpost</literal> type.</simpara>
<simpara>Each mapping type has:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="mapping-fields">Meta-fields</link>
</term>
<listitem>
<simpara>
Meta-fields are used to customize how a document&#8217;s metadata associated is
treated. Examples of meta-fields include the document&#8217;s
<link linkend="mapping-index-field"><literal>_index</literal></link>, <link linkend="mapping-type-field"><literal>_type</literal></link>,
<link linkend="mapping-id-field"><literal>_id</literal></link>,  and <link linkend="mapping-source-field"><literal>_source</literal></link> fields.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="mapping-types">Fields</link> or <emphasis>properties</emphasis>
</term>
<listitem>
<simpara>
Each mapping type contains a list of fields or <literal>properties</literal> pertinent to that
type.  A <literal>user</literal> type might contain <literal>title</literal>, <literal>name</literal>, and <literal>age</literal> fields, while a
<literal>blogpost</literal> type might contain <literal>title</literal>, <literal>body</literal>, <literal>user_id</literal> and <literal>created</literal> fields.
Fields with the same name in different mapping types in the same index
<link linkend="field-conflicts">must have the same mapping</link>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<important><simpara>In Elasticsearch versions 2.0 - 2.3, dots are not permitted in field names.
Elasticsearch 2.4 adds a setting to allow dots, but this setting should be
used with caution.  See <xref linkend="dots-in-names"/> for more information.</simpara></important>
<bridgehead id="_field_datatypes" renderas="sect1">Field datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Each field has a data <literal>type</literal> which can be:</simpara>
<itemizedlist>
<listitem>
<simpara>
a simple type like <link linkend="string"><literal>string</literal></link>, <link linkend="date"><literal>date</literal></link>, <link linkend="number"><literal>long</literal></link>,
  <link linkend="number"><literal>double</literal></link>, <link linkend="boolean"><literal>boolean</literal></link> or <link linkend="ip"><literal>ip</literal></link>.
</simpara>
</listitem>
<listitem>
<simpara>
a type which supports the hierarchical nature of JSON such as
  <link linkend="object"><literal>object</literal></link> or <link linkend="nested"><literal>nested</literal></link>.
</simpara>
</listitem>
<listitem>
<simpara>
or a specialised type like <link linkend="geo-point"><literal>geo_point</literal></link>,
  <link linkend="geo-shape"><literal>geo_shape</literal></link>, or <link linkend="search-suggesters-completion"><literal>completion</literal></link>.
</simpara>
</listitem>
</itemizedlist>
<simpara>It is often useful to index the same field in different ways for different
purposes. For instance, a <literal>string</literal> field could be <link linkend="mapping-index">indexed</link> as
an <literal>analyzed</literal> field for full-text search, and as a <literal>not_analyzed</literal> field for
sorting or aggregations.  Alternatively, you could index a string field with
the <link linkend="analysis-standard-analyzer"><literal>standard</literal> analyzer</link>, the
<link linkend="english-analyzer"><literal>english</literal></link> analyzer, and the
<link linkend="french-analyzer"><literal>french</literal> analyzer</link>.</simpara>
<simpara>This is the purpose of <emphasis>multi-fields</emphasis>.  Most datatypes support multi-fields
via the <xref linkend="multi-fields"/> parameter.</simpara>
<bridgehead id="_dynamic_mapping" renderas="sect1">Dynamic mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Fields and mapping types do not need to be defined before being used. Thanks
to <emphasis>dynamic mapping</emphasis>, new mapping types and new field names will be added
automatically, just by indexing a document. New fields can be added both to
the top-level mapping type, and to inner <link linkend="object"><literal>object</literal></link>  and
<link linkend="nested"><literal>nested</literal></link> fields.</simpara>
<simpara>The
<link linkend="dynamic-mapping">dynamic mapping</link> rules can be configured to
customise the mapping that is used for new types and new fields.</simpara>
<bridgehead id="_explicit_mappings" renderas="sect1">Explicit mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>You know more about your data than Elasticsearch can guess, so while dynamic
mapping can be useful to get started, at some point you will want to specify
your own explicit mappings.</simpara>
<simpara>You can create mapping types and field mappings when you
<link linkend="indices-create-index">create an index</link>, and you can add mapping types and
fields to an existing index with the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara>
<bridgehead id="_updating_existing_mappings" renderas="sect1">Updating existing mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Other than where documented, <emphasis role="strong">existing type and field mappings cannot be
updated</emphasis>. Changing the mapping would mean invalidating already indexed
documents.  Instead, you should create a new index with the correct mappings
and reindex your data into that index.</simpara>
<bridgehead id="field-conflicts" renderas="sect1">Fields are shared across mapping types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Mapping types are used to group fields, but the fields in each mapping type
are not independent of each other. Fields with:</simpara>
<itemizedlist>
<listitem>
<simpara>
the <emphasis>same name</emphasis>
</simpara>
</listitem>
<listitem>
<simpara>
in the <emphasis>same index</emphasis>
</simpara>
</listitem>
<listitem>
<simpara>
in <emphasis>different mapping types</emphasis>
</simpara>
</listitem>
<listitem>
<simpara>
map to the <emphasis>same field</emphasis> internally,
</simpara>
</listitem>
<listitem>
<simpara>
and <emphasis role="strong">must have the same mapping</emphasis>.
</simpara>
</listitem>
</itemizedlist>
<simpara>If a <literal>title</literal> field exists in both the <literal>user</literal> and <literal>blogpost</literal> mapping types, the
<literal>title</literal> fields must have exactly the same mapping in each type.  The only
exceptions to this rule are the <xref linkend="copy-to"/>, <xref linkend="dynamic"/>, <xref linkend="enabled"/>,
<xref linkend="ignore-above"/>, <xref linkend="include-in-all"/>, and <xref linkend="properties"/> parameters, which may
have different settings per field.</simpara>
<simpara>Usually, fields with the same name also contain the same type of data, so
having the same mapping is not a problem.  When conflicts do arise, these can
be solved by choosing more descriptive names, such as <literal>user_title</literal> and
<literal>blog_title</literal>.</simpara>
<bridgehead id="_example_mapping" renderas="sect1">Example mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>A mapping for the example described above could be specified when creating the
index, as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index <co id="CO155-1"/>
{
  "mappings": {
    "user": { <co id="CO155-2"/>
      "_all":       { "enabled": false  }, <co id="CO155-3"/>
      "properties": { <co id="CO155-4"/>
        "title":    { "type": "string"  }, <co id="CO155-5"/>
        "name":     { "type": "string"  }, <co id="CO155-6"/>
        "age":      { "type": "integer" }  <co id="CO155-7"/>
      }
    },
    "blogpost": { <co id="CO155-8"/>
      "properties": { <co id="CO155-9"/>
        "title":    { "type": "string"  }, <co id="CO155-10"/>
        "body":     { "type": "string"  }, <co id="CO155-11"/>
        "user_id":  {
          "type":   "string", <co id="CO155-12"/>
          "index":  "not_analyzed"
        },
        "created":  {
          "type":   "date", <co id="CO155-13"/>
          "format": "strict_date_optional_time||epoch_millis"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO155-1">
<para>
Create an index called <literal>my_index</literal>.
</para>
</callout>
<callout arearefs="CO155-2 CO155-8">
<para>
Add mapping types called <literal>user</literal> and <literal>blogpost</literal>.
</para>
</callout>
<callout arearefs="CO155-3">
<para>
Disable the <literal>_all</literal> <link linkend="mapping-fields">meta field</link> for the <literal>user</literal> mapping type.
</para>
</callout>
<callout arearefs="CO155-4 CO155-9">
<para>
Specify fields or <emphasis>properties</emphasis> in each mapping type.
</para>
</callout>
<callout arearefs="CO155-5 CO155-6 CO155-7 CO155-10 CO155-11 CO155-12 CO155-13">
<para>
Specify the data <literal>type</literal> and mapping for each field.
</para>
</callout>
</calloutlist>
</partintro>
<chapter id="dots-in-names">
<title>Dots in field names<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dots-in-names.asciidoc">Edit me</ulink></title>
<simpara>In Elasticsearch 5.0, dots are permitted in field names and each step in the
path is interpreted as an object field, except for the last step.  For instance,
indexing the following document in Elasticsearch 5.0:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "server.latency.max": 100
}</programlisting>
<simpara>would result in the following mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "properties": {
    "server": {
      "type": "object",
      "properties": {
        "latency": {
          "type": "object",
          "properties": {
            "max": {
              "type": "long"
            }
          }
        }
      }
    }
  }
}</programlisting>
<simpara>Elasticsearch 2.x does not support this <emphasis>dots-to-object</emphasis> transformation and so
dots in field names are not allowed in versions 2.0 - 2.3.</simpara>
<bridgehead id="_enabling_support_for_dots_in_field_names" renderas="sect2">Enabling support for dots in field names<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dots-in-names.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch 2.4.0 adds a system property called <literal>mapper.allow_dots_in_name</literal>
which will disable the check for dots in field names.  You can enable this
system property as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">export ES_JAVA_OPTS="-Dmapper.allow_dots_in_name=true"
./bin/elasticsearch</programlisting>
<simpara>(ES_JAVA_OPTS can be set in the <literal>/etc/default/elasticsearch</literal> file if you&#8217;re
using the Debian package, or in the <literal>/etc/sysconfig/elasticsearch</literal> file if
you&#8217;re using the RPM.)</simpara>
<simpara>With this sytem property enabled, indexing the document above in 2.4.0 will
result in the following mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "properties": {
    "server.latency.max": {
      "type": "long"
    }
  }
}</programlisting>
<bridgehead id="_upgrading_fields_with_dots_to_5_x" renderas="sect2">Upgrading fields with dots to 5.x<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dots-in-names.asciidoc">Edit me</ulink></bridgehead>
<simpara>Indices created in 1.x must be reindexed in 2.4 before being upgraded to 5.x,
regardless of whether they have fields with dots or not. Alternatively,
indices from a 1.x cluster can be imported directly into a 5.x cluster using
<ulink url="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/reindex-upgrade.html#reindex-upgrade-remote">reindex-from-remote</ulink>.</simpara>
<simpara>Indices created in 2.4 can be upgraded to 5.x directly, as long as there are
no conflicts (see below). If there are dots in field names, the mapping will
be automatically updated to the object-style mapping shown in
<xref linkend="dots-in-names"/>.</simpara>
<warning>
<title>Dots can create conflicting fields</title>
<simpara>Indices containing fields that would produce conflicts when upgrading to the
object-style mapping cannot be upgraded to 5.x.  For instance, the following
mapping can be upgraded:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "properties": {
    "server.latency": {<co id="CO156-1"/>
      "type": "long"
    },
    "server.name": {<co id="CO156-2"/>
      "type": "string"
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO156-1 CO156-2">
<para>
The <literal>server</literal> field will become an <literal>object</literal> field in both cases.
</para>
</callout>
</calloutlist>
<simpara>This mapping <emphasis role="strong">cannot</emphasis> be upgraded:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "properties": {
    "server.latency": {<co id="CO157-1"/>
      "type": "long"
    },
    "server": {<co id="CO157-2"/>
      "type": "string"
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO157-1 CO157-2">
<para>
The <literal>server</literal> field is an <literal>object</literal> in <literal>server.latency</literal>, but a <literal>string</literal> in <literal>server</literal>. This is a conflict and will prevent the index from being opened in 5.x.
</para>
</callout>
</calloutlist>
</warning>
</chapter>
<chapter id="mapping-types">
<title>Field datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch supports a number of different datatypes for the fields in a
document:</simpara>
<bridgehead id="_core_datatypes" renderas="sect2">Core datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<xref linkend="string"/>
</term>
<listitem>
<simpara>
<literal>string</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="number"/>
</term>
<listitem>
<simpara>
<literal>long</literal>, <literal>integer</literal>, <literal>short</literal>, <literal>byte</literal>, <literal>double</literal>, <literal>float</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="date"/>
</term>
<listitem>
<simpara>
<literal>date</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="boolean"/>
</term>
<listitem>
<simpara>
<literal>boolean</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="binary"/>
</term>
<listitem>
<simpara>
<literal>binary</literal>
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_complex_datatypes" renderas="sect2">Complex datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<xref linkend="array"/>
</term>
<listitem>
<simpara>
Array support does not require a dedicated <literal>type</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="object"/>
</term>
<listitem>
<simpara>
<literal>object</literal> for single JSON objects
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="nested"/>
</term>
<listitem>
<simpara>
<literal>nested</literal> for arrays of JSON objects
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_geo_datatypes" renderas="sect2">Geo datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<xref linkend="geo-point"/>
</term>
<listitem>
<simpara>
<literal>geo_point</literal> for lat/lon points
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="geo-shape"/>
</term>
<listitem>
<simpara>
<literal>geo_shape</literal> for complex shapes like polygons
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_specialised_datatypes" renderas="sect2">Specialised datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<xref linkend="ip"/>
</term>
<listitem>
<simpara>
<literal>ip</literal> for IPv4 addresses
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="search-suggesters-completion">Completion datatype</link>
</term>
<listitem>
<simpara>
                    <literal>completion</literal> to provide auto-complete suggestions
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<xref linkend="token-count"/>
</term>
<listitem>
<simpara>
<literal>token_count</literal> to count the number of tokens in a string
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/mapper-size.html"><literal>mapper-murmur3</literal></ulink>
</term>
<listitem>
<simpara>
<literal>murmur3</literal> to compute hashes of values at index-time and store them in the index
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Attachment datatype
</term>
<listitem>
<simpara>
    See the <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/mapper-attachments.html"><literal>mapper-attachments</literal></ulink> plugin
    which supports indexing <literal>attachments</literal> like Microsoft Office formats, Open
    Document formats, ePub, HTML, etc. into an <literal>attachment</literal> datatype.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_multi_fields" renderas="sect2">Multi-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types.asciidoc">Edit me</ulink></bridgehead>
<simpara>It is often useful to index the same field in different ways for different
purposes. For instance, a <literal>string</literal> field could be <link linkend="mapping-index">indexed</link> as
an <literal>analyzed</literal> field for full-text search, and as a <literal>not_analyzed</literal> field for
sorting or aggregations.  Alternatively, you could index a string field with
the <link linkend="analysis-standard-analyzer"><literal>standard</literal> analyzer</link>, the
<link linkend="english-analyzer"><literal>english</literal></link> analyzer, and the
<link linkend="french-analyzer"><literal>french</literal> analyzer</link>.</simpara>
<simpara>This is the purpose of <emphasis>multi-fields</emphasis>.  Most datatypes support multi-fields
via the <xref linkend="multi-fields"/> parameter.</simpara>
<section id="array">
<title>Array datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/array.asciidoc">Edit me</ulink></title>
<simpara>In Elasticsearch, there is no dedicated <literal>array</literal> type.  Any field can contain
zero or more values by default, however, all values in the array must be of
the same datatype. For instance:</simpara>
<itemizedlist>
<listitem>
<simpara>
an array of strings: [ <literal>"one"</literal>, <literal>"two"</literal> ]
</simpara>
</listitem>
<listitem>
<simpara>
an array of integers: [ <literal>1</literal>, <literal>2</literal> ]
</simpara>
</listitem>
<listitem>
<simpara>
an array of arrays: [ <literal>1</literal>, [ <literal>2</literal>, <literal>3</literal> ]] which is the equivalent of [ <literal>1</literal>, <literal>2</literal>, <literal>3</literal> ]
</simpara>
</listitem>
<listitem>
<simpara>
an array of objects: [ <literal>{ "name": "Mary", "age": 12 }</literal>, <literal>{ "name": "John", "age": 10 }</literal>]
</simpara>
</listitem>
</itemizedlist>
<note>
<title>Arrays of objects</title>
<simpara>Arrays of objects do not work as you would expect: you cannot query each
object independently of the other objects in the array.  If you need to be
able to do this then you should use the <link linkend="nested"><literal>nested</literal></link> datatype instead
of the <link linkend="object"><literal>object</literal></link> datatype.</simpara>
<simpara>This is explained in more detail in <xref linkend="nested"/>.</simpara>
</note>
<simpara>When adding a field dynamically, the first value in the array determines the
field <literal>type</literal>.  All subsequent values must be of the same datatype or it must
at least be possible to <link linkend="coerce">coerce</link> subsequent values to the same
datatype.</simpara>
<simpara>Arrays with a mixture of datatypes are <emphasis>not</emphasis> supported: [ <literal>10</literal>, <literal>"some string"</literal> ]</simpara>
<simpara>An array may contain <literal>null</literal> values, which are either replaced by the
configured <link linkend="null-value"><literal>null_value</literal></link> or skipped entirely.  An empty array
<literal>[]</literal> is treated as a missing field&#8201;&#8212;&#8201;a field with no values.</simpara>
<simpara>Nothing needs to be pre-configured in order to use arrays in documents, they
are supported out of the box:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "message": "some arrays in this document...",
  "tags":  [ "elasticsearch", "wow" ], <co id="CO158-1"/>
  "lists": [ <co id="CO158-2"/>
    {
      "name": "prog_list",
      "description": "programming list"
    },
    {
      "name": "cool_list",
      "description": "cool stuff list"
    }
  ]
}

PUT my_index/my_type/2 <co id="CO158-3"/>
{
  "message": "no arrays in this document...",
  "tags":  "elasticsearch",
  "lists": {
    "name": "prog_list",
    "description": "programming list"
  }
}

GET my_index/_search
{
  "query": {
    "match": {
      "tags": "elasticsearch" <co id="CO158-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO158-1">
<para>
The <literal>tags</literal> field is dynamically added as a <literal>string</literal> field.
</para>
</callout>
<callout arearefs="CO158-2">
<para>
The <literal>lists</literal> field is dynamically added as an <literal>object</literal> field.
</para>
</callout>
<callout arearefs="CO158-3">
<para>
The second document contains no arrays, but can be indexed into the same fields.
</para>
</callout>
<callout arearefs="CO158-4">
<para>
The query looks for <literal>elasticsearch</literal> in the <literal>tags</literal> field, and matches both documents.
</para>
</callout>
</calloutlist>
<sidebar>
<title>Multi-value fields and the inverted index</title>
<simpara>The fact that all field types support multi-value fields out of the box is a
consequence of the origins of Lucene.  Lucene was designed to be a full text
search engine.  In order to be able to search for individual words within a
big block of text, Lucene tokenizes the text into individual terms, and
adds each term to the inverted index separately.</simpara>
<simpara>This means that even a simple text field must be able to support multiple
values by default.  When other datatypes were added, such as numbers and
dates, they used the same data structure as strings, and so got multi-values
for free.</simpara>
</sidebar>
</section>
<section id="binary">
<title>Binary datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/binary.asciidoc">Edit me</ulink></title>
<simpara>The <literal>binary</literal> type accepts a binary value as a
<ulink url="https://en.wikipedia.org/wiki/Base64">Base64</ulink> encoded string. The field is not
stored by default and is not searchable:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "name": {
          "type": "string"
        },
        "blob": {
          "type": "binary"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "name": "Some binary blob",
  "blob": "U29tZSBiaW5hcnkgYmxvYg==" <co id="CO159-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO159-1">
<para>
The Base64 encoded binary value must not have embedded newlines <literal>\n</literal>.
</para>
</callout>
</calloutlist>
<section id="binary-params">
<title>Parameters for <literal>binary</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/binary.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>binary</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="boolean">
<title>Boolean datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/boolean.asciidoc">Edit me</ulink></title>
<simpara>Boolean fields accept JSON <literal>true</literal> and <literal>false</literal> values, but can also accept
strings and numbers which are interpreted as either true or false:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
False values
</simpara>
</entry>
<entry>
<simpara>
    <literal>false</literal>, <literal>"false"</literal>, <literal>"off"</literal>, <literal>"no"</literal>, <literal>"0"</literal>, <literal>""</literal> (empty string), <literal>0</literal>, <literal>0.0</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
True values
</simpara>
</entry>
<entry>
<simpara>
    Anything that isn&#8217;t false.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "is_published": {
          "type": "boolean"
        }
      }
    }
  }
}

POST my_index/my_type/1
{
  "is_published": true <co id="CO160-1"/>
}

GET my_index/_search
{
  "query": {
    "term": {
      "is_published": 1 <co id="CO160-2"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO160-1">
<para>
Indexing a document with a JSON <literal>true</literal>.
</para>
</callout>
<callout arearefs="CO160-2">
<para>
Querying for the document with <literal>1</literal>, which is interpreted as <literal>true</literal>.
</para>
</callout>
</calloutlist>
<simpara>Aggregations like the <link linkend="search-aggregations-bucket-terms-aggregation"><literal>terms</literal> aggregation</link>  use <literal>1</literal> and <literal>0</literal> for the <literal>key</literal>, and the strings <literal>"true"</literal> and
<literal>"false"</literal> for the <literal>key_as_string</literal>. Boolean fields  when used in scripts,
return <literal>1</literal> and <literal>0</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST my_index/my_type/1
{
  "is_published": true
}

POST my_index/my_type/2
{
  "is_published": false
}

GET my_index/_search
{
  "aggs": {
    "publish_state": {
      "terms": {
        "field": "is_published"
      }
    }
  },
  "script_fields": {
    "is_published": {
      "script": "doc['is_published'].value" <co id="CO161-1"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO161-1">
<para>
Inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work.
</para>
</callout>
</calloutlist>
<section id="boolean-params">
<title>Parameters for <literal>boolean</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/boolean.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>boolean</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>not_analyzed</literal> (default) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts any of the true or false values listed above. The value is
    substituted for any explicit <literal>null</literal> values.  Defaults to <literal>null</literal>, which
    means the field is treated as missing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="date">
<title>Date datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/date.asciidoc">Edit me</ulink></title>
<simpara>JSON doesn&#8217;t have a date datatype, so dates in Elasticsearch can either be:</simpara>
<itemizedlist>
<listitem>
<simpara>
strings containing formatted dates, e.g. <literal>"2015-01-01"</literal> or <literal>"2015/01/01 12:10:30"</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
a long number representing <emphasis>milliseconds-since-the-epoch</emphasis>.
</simpara>
</listitem>
<listitem>
<simpara>
an integer representing <emphasis>seconds-since-the-epoch</emphasis>.
</simpara>
</listitem>
</itemizedlist>
<simpara>Internally, dates are converted to UTC (if the time-zone is specified) and
stored as a long number representing milliseconds-since-the-epoch.</simpara>
<simpara>Date formats can be customised, but if no <literal>format</literal> is specified then it uses
the default:</simpara>
<literallayout class="monospaced">"strict_date_optional_time||epoch_millis"</literallayout>
<simpara>This means that it will accept dates with optional timestamps, which conform
to the formats supported by <link linkend="strict-date-time"><literal>strict_date_optional_time</literal></link>
or milliseconds-since-the-epoch.</simpara>
<simpara>For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "date": {
          "type": "date" <co id="CO162-1"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{ "date": "2015-01-01" } <co id="CO162-2"/>

PUT my_index/my_type/2
{ "date": "2015-01-01T12:10:30Z" } <co id="CO162-3"/>

PUT my_index/my_type/3
{ "date": 1420070400001 } <co id="CO162-4"/>

GET my_index/_search
{
  "sort": { "date": "asc"} <co id="CO162-5"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO162-1">
<para>
The <literal>date</literal> field uses the default <literal>format</literal>.
</para>
</callout>
<callout arearefs="CO162-2">
<para>
This document uses a plain date.
</para>
</callout>
<callout arearefs="CO162-3">
<para>
This document includes a time.
</para>
</callout>
<callout arearefs="CO162-4">
<para>
This document uses milliseconds-since-the-epoch.
</para>
</callout>
<callout arearefs="CO162-5">
<para>
Note that the <literal>sort</literal> values that are returned are all in milliseconds-since-the-epoch.
</para>
</callout>
</calloutlist>
<section id="multiple-date-formats">
<title>Multiple date formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/date.asciidoc">Edit me</ulink></title>
<simpara>Multiple formats can be specified by separating them with <literal>||</literal> as a separator.
Each format will be tried in turn until a matching format is found.  The first
format will be used to convert the <emphasis>milliseconds-since-the-epoch</emphasis> value back
into a string.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "date": {
          "type":   "date",
          "format": "yyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="date-params">
<title>Parameters for <literal>date</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/date.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>date</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-date-format"><literal>format</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The date format(s) that can be parsed.  Defaults to
    <literal>strict_date_optional_time||epoch_millis</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="ignore-malformed"><literal>ignore_malformed</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    If <literal>true</literal>, malformed numbers are ignored. If <literal>false</literal> (default), malformed
    numbers throw an exception and reject the whole document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not the field value should be included in the
    <link linkend="mapping-all-field"><literal>_all</literal></link> field? Accepts <literal>true</literal> or <literal>false</literal>.  Defaults
    to <literal>false</literal> if <link linkend="mapping-index"><literal>index</literal></link> is set to <literal>no</literal>, or if a parent
    <link linkend="object"><literal>object</literal></link> field sets <literal>include_in_all</literal> to <literal>false</literal>.
    Otherwise defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>not_analyzed</literal> (default) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts a date value in one of the configured <literal>format</literal>'s as the field
    which is substituted for any explicit <literal>null</literal> values.  Defaults to <literal>null</literal>,
    which means the field is treated as missing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="precision-step"><literal>precision_step</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Controls the number of extra terms that are indexed to make
    <link linkend="query-dsl-range-query"><literal>range</literal> queries</link> faster. Defaults to <literal>16</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="geo-point">
<title>Geo-point datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-point.asciidoc">Edit me</ulink></title>
<simpara>Fields of type <literal>geo_point</literal> accept latitude-longitude pairs, which can be used:</simpara>
<itemizedlist>
<listitem>
<simpara>
to find geo-points within a <link linkend="query-dsl-geo-bounding-box-query">bounding box</link>,
  within a certain <link linkend="query-dsl-geo-distance-query">distance</link> of a central point,
  within a <link linkend="query-dsl-geo-polygon-query">polygon</link>, or within a
  <link linkend="query-dsl-geohash-cell-query">geohash</link> cell.
</simpara>
</listitem>
<listitem>
<simpara>
to aggregate documents by <link linkend="search-aggregations-bucket-geohashgrid-aggregation">geographically</link>
  or by <link linkend="search-aggregations-bucket-geodistance-aggregation">distance</link> from a central point.
</simpara>
</listitem>
<listitem>
<simpara>
to integrate distance into a document&#8217;s <link linkend="query-dsl-function-score-query">relevance score</link>.
</simpara>
</listitem>
<listitem>
<simpara>
to <link linkend="geo-sorting">sort</link> documents by distance.
</simpara>
</listitem>
</itemizedlist>
<important>
<title>Percolating geo-queries in Elasticsearch 2.2.0 or later</title>
<simpara>The new <link linkend="geo-point"><literal>geo_point</literal> fields</link> added in Elasticsearch 2.2.0 and
above require that <link linkend="doc-values"><literal>doc_values</literal></link> are enabled in order to
function. Unfortunately, the in-memory index used by the percolator does not
yet have support for <literal>doc_values</literal>, meaning that <link linkend="geo-queries">geo-queries</link>
will not work in a percolator index created in Elasticsearch 2.2.0 or later.</simpara>
<simpara>See <xref linkend="geo-percolate"/> for a workaround.</simpara>
</important>
<simpara>There are four ways that a geo-point may be specified, as demonstrated below:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "text": "Geo-point as an object",
  "location": { <co id="CO163-1"/>
    "lat": 41.12,
    "lon": -71.34
  }
}

PUT my_index/my_type/2
{
  "text": "Geo-point as a string",
  "location": "41.12,-71.34" <co id="CO163-2"/>
}

PUT my_index/my_type/3
{
  "text": "Geo-point as a geohash",
  "location": "drm3btev3e86" <co id="CO163-3"/>
}

PUT my_index/my_type/4
{
  "text": "Geo-point as an array",
  "location": [ -71.34, 41.12 ] <co id="CO163-4"/>
}

GET my_index/_search
{
  "query": {
    "geo_bounding_box": { <co id="CO163-5"/>
      "location": {
        "top_left": {
          "lat": 42,
          "lon": -72
        },
        "bottom_right": {
          "lat": 40,
          "lon": -74
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO163-1">
<para>
Geo-point expressed as an object, with <literal>lat</literal> and <literal>lon</literal> keys.
</para>
</callout>
<callout arearefs="CO163-2">
<para>
Geo-point expressed as a string with the format: <literal>"lat,lon"</literal>.
</para>
</callout>
<callout arearefs="CO163-3">
<para>
Geo-point expressed as a geohash.
</para>
</callout>
<callout arearefs="CO163-4">
<para>
Geo-point expressed as an array with the format: [ <literal>lon</literal>, <literal>lat</literal>]
</para>
</callout>
<callout arearefs="CO163-5">
<para>
A geo-bounding box query which finds all geo-points that fall inside the box.
</para>
</callout>
</calloutlist>
<important>
<title>Geo-points expressed as an array or string</title>
<simpara>Please note that string geo-points are ordered as <literal>lat,lon</literal>, while array
geo-points are ordered as the reverse: <literal>lon,lat</literal>.</simpara>
<simpara>Originally, <literal>lat,lon</literal> was used for both array and string, but the array
format was changed early on to conform to the format used by GeoJSON.</simpara>
</important>
<section id="geo-point-params">
<title>Parameters for <literal>geo_point</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-point.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>geo_point</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="geohash"><literal>geohash</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the geo-point also be indexed as a geohash in the <literal>.geohash</literal>
    sub-field? Defaults to <literal>false</literal>, unless <literal>geohash_prefix</literal> is <literal>true</literal>.
    <phrase revisionflag="deleted" revision="2.4">Deprecated in 2.4.</phrase>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="geohash-precision"><literal>geohash_precision</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The maximum length of the geohash to use for the <literal>geohash</literal> and
    <literal>geohash_prefix</literal> options. <phrase revisionflag="deleted" revision="2.4">Deprecated in 2.4.</phrase>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="geohash-prefix"><literal>geohash_prefix</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the geo-point also be indexed as a geohash plus all its prefixes?
    Defaults to <literal>false</literal>. <phrase revisionflag="deleted" revision="2.4">Deprecated in 2.4.</phrase>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="ignore-malformed"><literal>ignore_malformed</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    If <literal>true</literal>, malformed geo-points are ignored. If <literal>false</literal> (default),
    malformed geo-points throw an exception and reject the whole document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="lat-lon"><literal>lat_lon</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the geo-point also be indexed as <literal>.lat</literal> and <literal>.lon</literal> sub-fields?
    Accepts <literal>true</literal> and <literal>false</literal> (default). <phrase revisionflag="deleted" revision="2.3">Deprecated in 2.3.</phrase>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="_using_geo_points_in_scripts">
<title>Using geo-points in scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-point.asciidoc">Edit me</ulink></title>
<simpara>When accessing the value of a geo-point in a script, the value is returned as
a <literal>GeoPoint</literal> object, which allows access to the <literal>.lat</literal> and <literal>.lon</literal> values
respectively:</simpara>
<programlisting language="js" linenumbering="unnumbered">geopoint = doc['location'].value;
lat      = geopoint.lat;
lon      = geopoint.lon;</programlisting>
<simpara>For performance reasons, it is better to access the lat/lon values directly:</simpara>
<programlisting language="js" linenumbering="unnumbered">lat      = doc['location'].lat;
lon      = doc['location'].lon;</programlisting>
</section>
</section>
<section id="geo-shape">
<title>Geo-Shape datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_shape</literal> datatype facilitates the indexing of and searching
with arbitrary geo shapes such as rectangles and polygons. It should be
used when either the data being indexed or the queries being executed
contain shapes other than just points.</simpara>
<simpara>You can query documents using this type using
<link linkend="query-dsl-geo-shape-query">geo_shape Query</link>.</simpara>
<bridgehead id="geo-shape-mapping-options" renderas="sect3">Mapping Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>The geo_shape mapping maps geo_json geometry objects to the geo_shape
type. To enable it, users must explicitly map fields to the geo_shape
type.</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Option </entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top"> Default</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>tree</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Name of the PrefixTree implementation to be used: <literal>geohash</literal> for
GeohashPrefixTree and <literal>quadtree</literal> for QuadPrefixTree.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>geohash</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>precision</literal></simpara></entry>
<entry align="left" valign="top"><simpara>This parameter may be used instead of <literal>tree_levels</literal> to set
an appropriate value for the <literal>tree_levels</literal> parameter. The value
specifies the desired precision and Elasticsearch will calculate the
best tree_levels value to honor this precision. The value should be a
number followed by an optional distance unit. Valid distance units
include: <literal>in</literal>, <literal>inch</literal>, <literal>yd</literal>, <literal>yard</literal>, <literal>mi</literal>, <literal>miles</literal>, <literal>km</literal>, <literal>kilometers</literal>,
<literal>m</literal>,<literal>meters</literal>, <literal>cm</literal>,<literal>centimeters</literal>, <literal>mm</literal>, <literal>millimeters</literal>.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>meters</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tree_levels</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Maximum number of layers to be used by the PrefixTree.
This can be used to control the precision of shape representations and
therefore how many terms are indexed. Defaults to the default value of
the chosen PrefixTree implementation. Since this parameter requires a
certain level of understanding of the underlying implementation, users
may use the <literal>precision</literal> parameter instead. However, Elasticsearch only
uses the tree_levels parameter internally and this is what is returned
via the mapping API even if you use the precision parameter.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>50m</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>strategy</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The strategy parameter defines the approach for how to
represent shapes at indexing and search time. It also influences the
capabilities available so it is recommended to let Elasticsearch set
this parameter automatically. There are two strategies available:
<literal>recursive</literal> and <literal>term</literal>. Term strategy supports point types only (the
<literal>points_only</literal> parameter will be automatically set to true) while
Recursive strategy supports all shape types. (IMPORTANT: see
<link linkend="prefix-trees">Prefix trees</link> for more detailed information)</simpara></entry>
<entry align="left" valign="top"><simpara><literal>recursive</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>distance_error_pct</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Used as a hint to the PrefixTree about how
precise it should be. Defaults to 0.025 (2.5%) with 0.5 as the maximum
supported value. PERFORMANCE NOTE: This value will default to 0 if a <literal>precision</literal> or
<literal>tree_level</literal> definition is explicitly defined. This guarantees spatial precision
at the level defined in the mapping. This can lead to significant memory usage
for high resolution shapes with low error (e.g., large shapes at 1m with &lt; 0.001 error).
To improve indexing performance (at the cost of query accuracy) explicitly define
<literal>tree_level</literal> or <literal>precision</literal> along with a reasonable <literal>distance_error_pct</literal>, noting
that large shapes will have greater false positives.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>0.025</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>orientation</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Optionally define how to interpret vertex order for
polygons / multipolygons.  This parameter defines one of two coordinate
system rules (Right-hand or Left-hand) each of which can be specified in three
different ways. 1. Right-hand rule: <literal>right</literal>, <literal>ccw</literal>, <literal>counterclockwise</literal>,
2. Left-hand rule: <literal>left</literal>, <literal>cw</literal>, <literal>clockwise</literal>. The default orientation
(<literal>counterclockwise</literal>) complies with the OGC standard which defines
outer ring vertices in counterclockwise order with inner ring(s) vertices (holes)
in clockwise order. Setting this parameter in the geo_shape mapping explicitly
sets vertex order for the coordinate list of a geo_shape field but can be
overridden in each individual GeoJSON document.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>ccw</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>points_only</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Setting this option to <literal>true</literal> (defaults to <literal>false</literal>) configures
the <literal>geo_shape</literal> field type for point shapes only (NOTE: Multi-Points are not
yet supported). This optimizes index and search performance for the <literal>geohash</literal> and
<literal>quadtree</literal> when it is known that only points will be indexed. At present geo_shape
queries can not be executed on <literal>geo_point</literal> field types. This option bridges the gap
by improving point performance on a <literal>geo_shape</literal> field so that <literal>geo_shape</literal> queries are
optimal on a point only field.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>false</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="prefix-trees" renderas="sect3">Prefix trees<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>To efficiently represent shapes in the index, Shapes are converted into
a series of hashes representing grid squares (commonly referred to as "rasters")
using implementations of a PrefixTree. The tree notion comes from the fact that
the PrefixTree uses multiple grid layers, each with an increasing level of
precision to represent the Earth. This can be thought of as increasing the level
of detail of a map or image at higher zoom levels.</simpara>
<simpara>Multiple PrefixTree implementations are provided:</simpara>
<itemizedlist>
<listitem>
<simpara>
GeohashPrefixTree - Uses
<ulink url="http://en.wikipedia.org/wiki/Geohash">geohashes</ulink> for grid squares.
Geohashes are base32 encoded strings of the bits of the latitude and
longitude interleaved. So the longer the hash, the more precise it is.
Each character added to the geohash represents another tree level and
adds 5 bits of precision to the geohash. A geohash represents a
rectangular area and has 32 sub rectangles. The maximum amount of levels
in Elasticsearch is 24.
</simpara>
</listitem>
<listitem>
<simpara>
QuadPrefixTree - Uses a
<ulink url="http://en.wikipedia.org/wiki/Quadtree">quadtree</ulink> for grid squares.
Similar to geohash, quad trees interleave the bits of the latitude and
longitude the resulting hash is a bit set. A tree level in a quad tree
represents 2 bits in this bit set, one for each coordinate. The maximum
amount of levels for the quad trees in Elasticsearch is 50.
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="spatial-strategy" renderas="sect4">Spatial strategies<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>The PrefixTree implementations rely on a SpatialStrategy for decomposing
the provided Shape(s) into approximated grid squares. Each strategy answers
the following:</simpara>
<itemizedlist>
<listitem>
<simpara>
What type of Shapes can be indexed?
</simpara>
</listitem>
<listitem>
<simpara>
What types of Query Operations and Shapes can be used?
</simpara>
</listitem>
<listitem>
<simpara>
Does it support more than one Shape per field?
</simpara>
</listitem>
</itemizedlist>
<simpara>The following Strategy implementations (with corresponding capabilities)
are provided:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Strategy </entry>
<entry align="left" valign="top">Supported Shapes </entry>
<entry align="left" valign="top">Supported Queries </entry>
<entry align="left" valign="top">Multiple Shapes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>recursive</literal></simpara></entry>
<entry align="left" valign="top"><simpara><link linkend="input-structure">All</link></simpara></entry>
<entry align="left" valign="top"><simpara><literal>INTERSECTS</literal>, <literal>DISJOINT</literal>, <literal>WITHIN</literal>, <literal>CONTAINS</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>term</literal></simpara></entry>
<entry align="left" valign="top"><simpara><link linkend="point">Points</link></simpara></entry>
<entry align="left" valign="top"><simpara><literal>INTERSECTS</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Yes</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_accuracy" renderas="sect4">Accuracy<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>Geo_shape does not provide 100% accuracy and depending on how it is
configured it may return some false positives or false negatives for
certain queries. To mitigate this, it is important to select an
appropriate value for the tree_levels parameter and to adjust
expectations accordingly. For example, a point may be near the border of
a particular grid cell and may thus not match a query that only matches the
cell right next to it&#8201;&#8212;&#8201;even though the shape is very close to the point.</simpara>
<bridgehead id="_example_4" renderas="sect4">Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "properties": {
        "location": {
            "type": "geo_shape",
            "tree": "quadtree",
            "precision": "1m"
        }
    }
}</programlisting>
<simpara>This mapping maps the location field to the geo_shape type using the
quad_tree implementation and a precision of 1m. Elasticsearch translates
this into a tree_levels setting of 26.</simpara>
<bridgehead id="_performance_considerations" renderas="sect4">Performance considerations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch uses the paths in the prefix tree as terms in the index
and in queries. The higher the level is (and thus the precision), the
more terms are generated. Of course, calculating the terms, keeping them in
memory, and storing them on disk all have a price. Especially with higher
tree levels, indices can become extremely large even with a modest
amount of data. Additionally, the size of the features also matters.
Big, complex polygons can take up a lot of space at higher tree levels.
Which setting is right depends on the use case. Generally one trades off
accuracy against index size and query performance.</simpara>
<simpara>The defaults in Elasticsearch for both implementations are a compromise
between index size and a reasonable level of precision of 50m at the
equator. This allows for indexing tens of millions of shapes without
overly bloating the resulting index too much relative to the input size.</simpara>
<bridgehead id="input-structure" renderas="sect3">Input Structure<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <ulink url="http://www.geojson.org">GeoJSON</ulink> format is used to represent
<ulink url="http://geojson.org/geojson-spec.html#geometry-objects">shapes</ulink> as input
as follows:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">GeoJSON Type </entry>
<entry align="left" valign="top">Elasticsearch Type </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Point</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>point</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A single geographic coordinate.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>LineString</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>linestring</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An arbitrary line given two or more points.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Polygon</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>polygon</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A <emphasis>closed</emphasis> polygon whose first and last point
must match, thus requiring <literal>n + 1</literal> vertices to create an <literal>n</literal>-sided
polygon and a minimum of <literal>4</literal> vertices.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>MultiPoint</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>multipoint</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An array of unconnected, but likely related
points.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>MultiLineString</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>multilinestring</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An array of separate linestrings.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>MultiPolygon</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>multipolygon</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An array of separate polygons.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>GeometryCollection</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>geometrycollection</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A GeoJSON shape similar to the
<literal>multi*</literal> shapes except that multiple types can coexist (e.g., a Point
and a LineString).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>N/A</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>envelope</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A bounding rectangle, or envelope, specified by
specifying only the top left and bottom right points.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>N/A</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>circle</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A circle specified by a center point and radius with
units, which default to <literal>METERS</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<note>
<simpara>For all types, both the inner <literal>type</literal> and <literal>coordinates</literal> fields are
required.</simpara>
<simpara>In GeoJSON, and therefore Elasticsearch, the correct <emphasis role="strong">coordinate
order is longitude, latitude (X, Y)</emphasis> within coordinate arrays. This
differs from many Geospatial APIs (e.g., Google Maps) that generally
use the colloquial latitude, longitude (Y, X).</simpara>
</note>
<bridgehead id="point" renderas="sect4"><ulink url="http://geojson.org/geojson-spec.html#id2">Point</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A point is a single geographic coordinate, such as the location of a
building or the current position given by a smartphone&#8217;s Geolocation
API.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "point",
        "coordinates" : [-77.03653, 38.897676]
    }
}</programlisting>
<bridgehead id="_ulink_url_http_geojson_org_geojson_spec_html_id3_linestring_ulink" renderas="sect4"><ulink url="http://geojson.org/geojson-spec.html#id3">LineString</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A <literal>linestring</literal> defined by an array of two or more positions. By
specifying only two points, the <literal>linestring</literal> will represent a straight
line.  Specifying more than two points creates an arbitrary path.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "linestring",
        "coordinates" : [[-77.03653, 38.897676], [-77.009051, 38.889939]]
    }
}</programlisting>
<simpara>The above <literal>linestring</literal> would draw a straight line starting at the White
House to the US Capitol Building.</simpara>
<bridgehead id="_ulink_url_http_www_geojson_org_geojson_spec_html_id4_polygon_ulink" renderas="sect4"><ulink url="http://www.geojson.org/geojson-spec.html#id4">Polygon</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A polygon is defined by a list of a list of points. The first and last
points in each (outer) list must be the same (the polygon must be
closed).</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ]
        ]
    }
}</programlisting>
<simpara>The first array represents the outer boundary of the polygon, the other
arrays represent the interior shapes ("holes"):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ],
            [ [100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2] ]
        ]
    }
}</programlisting>
<simpara><emphasis role="strong">IMPORTANT NOTE:</emphasis> GeoJSON does not mandate a specific order for vertices thus ambiguous
polygons around the dateline and poles are possible. To alleviate ambiguity
the Open Geospatial Consortium (OGC)
<ulink url="http://www.opengeospatial.org/standards/sfa">Simple Feature Access</ulink> specification
defines the following vertex ordering:</simpara>
<itemizedlist>
<listitem>
<simpara>
Outer Ring - Counterclockwise
</simpara>
</listitem>
<listitem>
<simpara>
Inner Ring(s) / Holes - Clockwise
</simpara>
</listitem>
</itemizedlist>
<simpara>For polygons that do not cross the dateline, vertex order will not matter in
Elasticsearch. For polygons that do cross the dateline, Elasticsearch requires
vertex ordering to comply with the OGC specification. Otherwise, an unintended polygon
may be created and unexpected query/filter results will be returned.</simpara>
<simpara>The following provides an example of an ambiguous polygon.  Elasticsearch will apply
OGC standards to eliminate ambiguity resulting in a polygon that crosses the dateline.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [-177.0, 10.0], [176.0, 15.0], [172.0, 0.0], [176.0, -15.0], [-177.0, -10.0], [-177.0, 10.0] ],
            [ [178.2, 8.2], [-178.8, 8.2], [-180.8, -8.8], [178.2, 8.8] ]
        ]
    }
}</programlisting>
<simpara>An <literal>orientation</literal> parameter can be defined when setting the geo_shape mapping (see <xref linkend="geo-shape-mapping-options"/>). This will define vertex
order for the coordinate list on the mapped geo_shape field. It can also be overridden on each document.  The following is an example for
overriding the orientation on a document:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "polygon",
        "orientation" : "clockwise",
        "coordinates" : [
            [ [-177.0, 10.0], [176.0, 15.0], [172.0, 0.0], [176.0, -15.0], [-177.0, -10.0], [-177.0, 10.0] ],
            [ [178.2, 8.2], [-178.8, 8.2], [-180.8, -8.8], [178.2, 8.8] ]
        ]
    }
}</programlisting>
<bridgehead id="_ulink_url_http_www_geojson_org_geojson_spec_html_id5_multipoint_ulink" renderas="sect4"><ulink url="http://www.geojson.org/geojson-spec.html#id5">MultiPoint</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A list of geojson points.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "multipoint",
        "coordinates" : [
            [102.0, 2.0], [103.0, 2.0]
        ]
    }
}</programlisting>
<bridgehead id="_ulink_url_http_www_geojson_org_geojson_spec_html_id6_multilinestring_ulink" renderas="sect4"><ulink url="http://www.geojson.org/geojson-spec.html#id6">MultiLineString</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A list of geojson linestrings.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "multilinestring",
        "coordinates" : [
            [ [102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0] ],
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0] ],
            [ [100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8] ]
        ]
    }
}</programlisting>
<bridgehead id="_ulink_url_http_www_geojson_org_geojson_spec_html_id7_multipolygon_ulink" renderas="sect4"><ulink url="http://www.geojson.org/geojson-spec.html#id7">MultiPolygon</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A list of geojson polygons.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "multipolygon",
        "coordinates" : [
            [ [[102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0], [102.0, 2.0]] ],

            [ [[100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0]],
              [[100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2]] ]
        ]
    }
}</programlisting>
<bridgehead id="_ulink_url_http_geojson_org_geojson_spec_html_geometrycollection_geometry_collection_ulink" renderas="sect4"><ulink url="http://geojson.org/geojson-spec.html#geometrycollection">Geometry Collection</ulink><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>A collection of geojson geometry objects.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type": "geometrycollection",
        "geometries": [
            {
                "type": "point",
                "coordinates": [100.0, 0.0]
            },
            {
                "type": "linestring",
                "coordinates": [ [101.0, 0.0], [102.0, 1.0] ]
            }
        ]
    }
}</programlisting>
<bridgehead id="_envelope" renderas="sect4">Envelope<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch supports an <literal>envelope</literal> type, which consists of coordinates
for upper left and lower right points of the shape to represent a
bounding rectangle:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "envelope",
        "coordinates" : [ [-45.0, 45.0], [45.0, -45.0] ]
    }
}</programlisting>
<bridgehead id="_circle" renderas="sect4">Circle<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch supports a <literal>circle</literal> type, which consists of a center
point with a radius:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "location" : {
        "type" : "circle",
        "coordinates" : [-45.0, 45.0],
        "radius" : "100m"
    }
}</programlisting>
<simpara>Note: The inner <literal>radius</literal> field is required. If not specified, then
the units of the <literal>radius</literal> will default to <literal>METERS</literal>.</simpara>
<bridgehead id="_sorting_and_retrieving_index_shapes" renderas="sect3">Sorting and Retrieving index Shapes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/geo-shape.asciidoc">Edit me</ulink></bridgehead>
<simpara>Due to the complex input structure and index representation of shapes,
it is not currently possible to sort shapes or retrieve their fields
directly. The geo_shape value is only retrievable through the <literal>_source</literal>
field.</simpara>
</section>
<section id="ip">
<title>IPv4 datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/ip.asciidoc">Edit me</ulink></title>
<simpara>An <literal>ip</literal> field is really a <link linkend="number"><literal>long</literal></link> field which accepts
<ulink url="https://en.wikipedia.org/wiki/IPv4">IPv4</ulink> addresses and indexes them as long
values:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "ip_addr": {
          "type": "ip"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "ip_addr": "192.168.1.1"
}

GET my_index/_search
{
  "query": {
    "range": {
      "ip_addr": {
        "gte": "192.168.1.0",
        "lt":  "192.168.2.0"
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<section id="ip-params">
<title>Parameters for <literal>ip</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/ip.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>ip</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not the field value should be included in the
    <link linkend="mapping-all-field"><literal>_all</literal></link> field? Accepts <literal>true</literal> or <literal>false</literal>.  Defaults
    to <literal>false</literal> if <link linkend="mapping-index"><literal>index</literal></link> is set to <literal>no</literal>, or if a parent
    <link linkend="object"><literal>object</literal></link> field sets <literal>include_in_all</literal> to <literal>false</literal>.
    Otherwise defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>not_analyzed</literal> (default) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts an IPv4 value which is substituted for any explicit <literal>null</literal> values.
    Defaults to <literal>null</literal>, which means the field is treated as missing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="precision-step"><literal>precision_step</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Controls the number of extra terms that are indexed to make
    <link linkend="query-dsl-range-query"><literal>range</literal> queries</link> faster. Defaults to <literal>16</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<note><simpara>IPv6 addresses are not supported yet.</simpara></note>
</section>
</section>
<section id="nested">
<title>Nested datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/nested.asciidoc">Edit me</ulink></title>
<simpara>The <literal>nested</literal> type is a specialised version of the <link linkend="object"><literal>object</literal></link> datatype
that allows arrays of objects to be indexed and queried independently of each
other.</simpara>
<section id="_how_arrays_of_objects_are_flattened">
<title>How arrays of objects are flattened<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/nested.asciidoc">Edit me</ulink></title>
<simpara>Arrays of inner <link linkend="object"><literal>object</literal> fields</link> do not work the way you may expect.
Lucene has no concept of inner objects, so Elasticsearch flattens object
hierarchies into a simple list of field names and values. For instance, the
following document:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "group" : "fans",
  "user" : [ <co id="CO164-1"/>
    {
      "first" : "John",
      "last" :  "Smith"
    },
    {
      "first" : "Alice",
      "last" :  "White"
    }
  ]
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO164-1">
<para>
The <literal>user</literal> field is dynamically added as a field of type <literal>object</literal>.
</para>
</callout>
</calloutlist>
<simpara>would be transformed internally into a document that looks more like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "group" :        "fans",
  "user.first" : [ "alice", "john" ],
  "user.last" :  [ "smith", "white" ]
}</programlisting>
<simpara>The <literal>user.first</literal> and <literal>user.last</literal> fields are flattened into multi-value fields,
and the association between <literal>alice</literal> and <literal>white</literal> is lost.  This document would
incorrectly match a query for <literal>alice AND smith</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "user.first": "Alice" }},
        { "match": { "user.last":  "Smith" }}
      ]
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="_using_literal_nested_literal_fields_for_arrays_of_objects">
<title>Using <literal>nested</literal> fields for arrays of objects<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/nested.asciidoc">Edit me</ulink></title>
<simpara>If you need to index arrays of objects and to maintain the independence of
each object in the array, you should use the <literal>nested</literal> datatype instead of the
<link linkend="object"><literal>object</literal></link> datatype.  Internally, nested objects index each object in
the array as a separate hidden document, meaning that each nested object can be
queried independently of the others, with the <link linkend="query-dsl-nested-query"><literal>nested</literal> query</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "user": {
          "type": "nested" <co id="CO165-1"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "group" : "fans",
  "user" : [
    {
      "first" : "John",
      "last" :  "Smith"
    },
    {
      "first" : "Alice",
      "last" :  "White"
    }
  ]
}

GET my_index/_search
{
  "query": {
    "nested": {
      "path": "user",
      "query": {
        "bool": {
          "must": [
            { "match": { "user.first": "Alice" }},
            { "match": { "user.last":  "Smith" }} <co id="CO165-2"/>
          ]
        }
      }
    }
  }
}

GET my_index/_search
{
  "query": {
    "nested": {
      "path": "user",
      "query": {
        "bool": {
          "must": [
            { "match": { "user.first": "Alice" }},
            { "match": { "user.last":  "White" }} <co id="CO165-3"/>
          ]
        }
      },
      "inner_hits": { <co id="CO165-4"/>
        "highlight": {
          "fields": {
            "user.first": {}
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO165-1">
<para>
The <literal>user</literal> field is mapped as type <literal>nested</literal> instead of type <literal>object</literal>.
</para>
</callout>
<callout arearefs="CO165-2">
<para>
This query doesn&#8217;t match because <literal>Alice</literal> and <literal>Smith</literal> are not in the same nested object.
</para>
</callout>
<callout arearefs="CO165-3">
<para>
This query matches because <literal>Alice</literal> and <literal>White</literal> are in the same nested object.
</para>
</callout>
<callout arearefs="CO165-4">
<para>
<literal>inner_hits</literal> allow us to highlight the matching nested documents.
</para>
</callout>
</calloutlist>
<simpara>Nested documents can be:</simpara>
<itemizedlist>
<listitem>
<simpara>
queried with the <link linkend="query-dsl-nested-query"><literal>nested</literal></link> query.
</simpara>
</listitem>
<listitem>
<simpara>
analyzed with the <link linkend="search-aggregations-bucket-nested-aggregation"><literal>nested</literal></link>
  and <link linkend="search-aggregations-bucket-reverse-nested-aggregation"><literal>reverse_nested</literal></link>
  aggregations.
</simpara>
</listitem>
<listitem>
<simpara>
sorted with <link linkend="nested-sorting">nested sorting</link>.
</simpara>
</listitem>
<listitem>
<simpara>
retrieved and highlighted with <link linkend="nested-inner-hits">nested inner hits</link>.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="nested-params">
<title>Parameters for <literal>nested</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/nested.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>nested</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="dynamic"><literal>dynamic</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not new <literal>properties</literal> should be added dynamically to an existing
    nested object.  Accepts <literal>true</literal> (default), <literal>false</literal> and <literal>strict</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Sets the default <literal>include_in_all</literal> value for all the <literal>properties</literal> within
    the nested object. Nested documents do not have their own <literal>_all</literal> field.
    Instead, values are added to the <literal>_all</literal> field of the main &#8220;root&#8221;
    document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="properties"><literal>properties</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The fields within the nested object, which can be of any
    <link linkend="mapping-types">datatype</link>, including <literal>nested</literal>. New properties
    may be added to an existing nested object.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<important>
<simpara>Because nested documents are indexed as separate documents, they can only be
accessed  within the scope of the <literal>nested</literal> query, the
<literal>nested</literal>/<literal>reverse_nested</literal>, or <link linkend="nested-inner-hits">nested inner hits</link>.</simpara>
<simpara>For instance, if a string field within a nested document has
<link linkend="index-options"><literal>index_options</literal></link> set to <literal>offsets</literal> to allow use of the postings
highlighter, these offsets will not be available during the main highlighting
phase.  Instead, highlighting needs to be performed via
<link linkend="nested-inner-hits">nested inner hits</link>.</simpara>
</important>
</section>
<section id="_limiting_the_number_of_literal_nested_literal_fields">
<title>Limiting the number of <literal>nested</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/nested.asciidoc">Edit me</ulink></title>
<simpara>Indexing a document with 100 nested fields actually indexes 101 documents as each nested
document is indexed as a separate document. To safeguard against ill-defined mappings
the number of nested fields that can be defined per index has been limited to 50. This
default limit can be changed with the index setting <literal>index.mapping.nested_fields.limit</literal>.</simpara>
</section>
</section>
<section id="number">
<title>Numeric datatypes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/numeric.asciidoc">Edit me</ulink></title>
<simpara>The following numeric types are supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>long</literal>
</simpara>
</entry>
<entry>
<simpara>
A signed 64-bit integer with a minimum value of <literal>-2<superscript>63</superscript></literal> and a maximum value of <literal>2<superscript>63</superscript>-1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>integer</literal>
</simpara>
</entry>
<entry>
<simpara>
A signed 32-bit integer with a minimum value of <literal>-2<superscript>31</superscript></literal> and a maximum value of <literal>2<superscript>31</superscript>-1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>short</literal>
</simpara>
</entry>
<entry>
<simpara>
A signed 16-bit integer with a minimum value of <literal>-32,768</literal> and a maximum value of <literal>32,767</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>byte</literal>
</simpara>
</entry>
<entry>
<simpara>
A signed 8-bit integer with a minimum value of <literal>-128</literal> and a maximum value of <literal>127</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>double</literal>
</simpara>
</entry>
<entry>
<simpara>
A double-precision 64-bit IEEE 754 floating point.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>float</literal>
</simpara>
</entry>
<entry>
<simpara>
A single-precision 32-bit IEEE 754 floating point.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Below is an example of configuring a mapping with numeric fields:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "number_of_bytes": {
          "type": "integer"
        },
        "time_in_seconds": {
          "type": "float"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<section id="number-params">
<title>Parameters for numeric fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/numeric.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by numeric types:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="coerce"><literal>coerce</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Try to convert strings to numbers and truncate fractions for integers.
    Accepts <literal>true</literal> (default) and <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="ignore-malformed"><literal>ignore_malformed</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    If <literal>true</literal>, malformed numbers are ignored. If <literal>false</literal> (default), malformed
    numbers throw an exception and reject the whole document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not the field value should be included in the
    <link linkend="mapping-all-field"><literal>_all</literal></link> field? Accepts <literal>true</literal> or <literal>false</literal>.  Defaults
    to <literal>false</literal> if <link linkend="mapping-index"><literal>index</literal></link> is set to <literal>no</literal>, or if a parent
    <link linkend="object"><literal>object</literal></link> field sets <literal>include_in_all</literal> to <literal>false</literal>.
    Otherwise defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>not_analyzed</literal> (default) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts a numeric value of the same <literal>type</literal> as the field which is
    substituted for any explicit <literal>null</literal> values.  Defaults to <literal>null</literal>, which
    means the field is treated as missing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="precision-step"><literal>precision_step</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Controls the number of extra terms that are indexed to make
    <link linkend="query-dsl-range-query"><literal>range</literal> queries</link> faster. The default depends on the
    numeric <literal>type</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="object">
<title>Object datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/object.asciidoc">Edit me</ulink></title>
<simpara>JSON documents are hierarchical in nature: the document may contain inner
objects which, in turn, may contain inner objects themselves:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{ <co id="CO166-1"/>
  "region": "US",
  "manager": { <co id="CO166-2"/>
    "age":     30,
    "name": { <co id="CO166-3"/>
      "first": "John",
      "last":  "Smith"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO166-1">
<para>
The outer document is also a JSON object.
</para>
</callout>
<callout arearefs="CO166-2">
<para>
It contains an inner object called <literal>manager</literal>.
</para>
</callout>
<callout arearefs="CO166-3">
<para>
Which in turn contains an inner object called <literal>name</literal>.
</para>
</callout>
</calloutlist>
<simpara>Internally, this document is indexed as a simple, flat list of key-value
pairs, something like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "region":             "US",
  "manager.age":        30,
  "manager.name.first": "John",
  "manager.name.last":  "Smith"
}</programlisting>
<simpara>An explicit mapping for the above document could look like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": { <co id="CO167-1"/>
      "properties": {
        "region": {
          "type": "string",
          "index": "not_analyzed"
        },
        "manager": { <co id="CO167-2"/>
          "properties": {
            "age":  { "type": "integer" },
            "name": { <co id="CO167-3"/>
              "properties": {
                "first": { "type": "string" },
                "last":  { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO167-1">
<para>
The mapping type is a type of object, and has a <literal>properties</literal> field.
</para>
</callout>
<callout arearefs="CO167-2">
<para>
The <literal>manager</literal> field is an inner <literal>object</literal> field.
</para>
</callout>
<callout arearefs="CO167-3">
<para>
The <literal>manager.name</literal> field is an inner <literal>object</literal> field within the <literal>manager</literal> field.
</para>
</callout>
</calloutlist>
<simpara>You are not required to set the field <literal>type</literal> to <literal>object</literal> explicitly, as this is the default value.</simpara>
<section id="object-params">
<title>Parameters for <literal>object</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/object.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>object</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="dynamic"><literal>dynamic</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not new <literal>properties</literal> should be added dynamically
    to an existing object.  Accepts <literal>true</literal> (default), <literal>false</literal>
    and <literal>strict</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="enabled"><literal>enabled</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the JSON value given for the object field should be
    parsed and indexed (<literal>true</literal>, default) or completely ignored (<literal>false</literal>).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Sets the default <literal>include_in_all</literal> value for all the <literal>properties</literal> within
    the object. The object itself is not added to the <literal>_all</literal> field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="properties"><literal>properties</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The fields within the object, which can be of any
    <link linkend="mapping-types">datatype</link>, including <literal>object</literal>. New properties
    may be added to an existing object.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<important><simpara>If you need to index arrays of objects instead of single objects,
read <xref linkend="nested"/> first.</simpara></important>
</section>
</section>
<section id="string">
<title>String datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/string.asciidoc">Edit me</ulink></title>
<simpara>Fields of type <literal>string</literal> accept text values.  Strings may be sub-divided into:</simpara>
<variablelist>
<varlistentry>
<term>
Full text
</term>
<listitem>
<simpara>Full text values, like the body of an email, are typically used for text based
relevance searches, such as: <emphasis>Find the most relevant documents that match a
query for "quick brown fox"</emphasis>.</simpara>
<simpara>These fields are <literal>analyzed</literal>, that is they are passed through an
<link linkend="analysis">analyzer</link> to convert the string into a list of individual terms
before being indexed. The analysis process allows Elasticsearch to search for
individual words <emphasis>within</emphasis>  each full text field.  Full text fields are not
used for sorting and seldom used for aggregations (although the
<link linkend="search-aggregations-bucket-significantterms-aggregation">significant terms aggregation</link> is a notable exception).</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
Keywords
</term>
<listitem>
<simpara>
Keywords are exact values like email addresses, hostnames, status codes, or
tags.  They are typically used for filtering (<emphasis>Find me all blog posts where
<literal>status</literal> is <literal>published</literal></emphasis>), for sorting, and for aggregations. Keyword
fields are <literal>not_analyzed</literal>.  Instead, the exact string value is added to the
index as a single term.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Below is an example of a mapping for a full text (<literal>analyzed</literal>) and a keyword
(<literal>not_analyzed</literal>) string field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "full_name": { <co id="CO168-1"/>
          "type":  "string"
        },
        "status": {
          "type":  "string", <co id="CO168-2"/>
          "index": "not_analyzed"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO168-1">
<para>
The <literal>full_name</literal> field is an <literal>analyzed</literal> full text field&#8201;&#8212;&#8201;<literal>index:analyzed</literal> is the default.
</para>
</callout>
<callout arearefs="CO168-2">
<para>
The <literal>status</literal> field is a <literal>not_analyzed</literal> keyword field.
</para>
</callout>
</calloutlist>
<simpara>Sometimes it is useful to have both a full text (<literal>analyzed</literal>) and a keyword
(<literal>not_analyzed</literal>) version of the same field: one for full text search and the
other for aggregations and sorting. This can be achieved with
<link linkend="multi-fields">multi-fields</link>.</simpara>
<section id="string-params">
<title>Parameters for string fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/string.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>string</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="analyzer"><literal>analyzer</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The <link linkend="analysis">analyzer</link> which should be used for
    <link linkend="mapping-index"><literal>analyzed</literal></link> string fields, both at index-time and at
    search-time (unless overridden by the  <link linkend="search-analyzer"><literal>search_analyzer</literal></link>).
    Defaults to the default index analyzer, or the
    <link linkend="analysis-standard-analyzer"><literal>standard</literal> analyzer</link>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    or <literal>false</literal>. Defaults to <literal>true</literal> for <literal>not_analyzed</literal> fields. Analyzed fields
    do not support doc values.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="fielddata"><literal>fielddata</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Can the field use in-memory fielddata for sorting, aggregations,
    or scripting? Accepts <literal>{ "format": "disabled" }</literal> or <literal>{ "format": "paged_bytes" }</literal> (default).
    Not analyzed fields will use <link linkend="doc-values">doc values</link> in preference
    to fielddata.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="multi-fields"><literal>fields</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Multi-fields allow the same string value to be indexed in multiple ways for
    different purposes, such as one field for search and a multi-field for
    sorting and aggregations, or the same string value analyzed by different
    analyzers.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="ignore-above"><literal>ignore_above</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Do not index or analyze any string longer than this value.  Defaults to <literal>0</literal> (disabled).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not the field value should be included in the
    <link linkend="mapping-all-field"><literal>_all</literal></link> field? Accepts <literal>true</literal> or <literal>false</literal>.  Defaults
    to <literal>false</literal> if <link linkend="mapping-index"><literal>index</literal></link> is set to <literal>no</literal>, or if a parent
    <link linkend="object"><literal>object</literal></link> field sets <literal>include_in_all</literal> to <literal>false</literal>.
    Otherwise defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>analyzed</literal> (default, treat as full-text field),
    <literal>not_analyzed</literal> (treat as keyword field) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="index-options"><literal>index_options</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    What information should be stored in the index, for search and highlighting purposes.
    Defaults to <literal>positions</literal> for <link linkend="mapping-index"><literal>analyzed</literal></link> fields, and to <literal>docs</literal> for
    <literal>not_analyzed</literal> fields.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="norms"><literal>norms</literal></link>
</simpara>
</entry>
<entry>
<simpara>Whether field-length should be taken into account when scoring queries.
Defaults depend on the <link linkend="mapping-index"><literal>index</literal></link> setting:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>analyzed</literal> fields default to <literal>{ "enabled": true, "loading": "lazy" }</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>not_analyzed</literal> fields default to <literal>{ "enabled": false }</literal>.
</simpara>
</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts a string value which is substituted for any explicit <literal>null</literal>
    values.  Defaults to <literal>null</literal>, which means the field is treated as missing.
    If the field is <literal>analyzed</literal>, the <literal>null_value</literal> will also be analyzed.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="position-increment-gap"><literal>position_increment_gap</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The number of fake term position which should be inserted between each
    element of an array of strings. Defaults to the <literal>position_increment_gap</literal>
    configured on the analyzer which defaults to <literal>100</literal>. <literal>100</literal> was chosen because it
    prevents phrase queries with reasonably large slops (less than 100) from
    matching terms across field values.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="search-analyzer"><literal>search_analyzer</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The <link linkend="analyzer"><literal>analyzer</literal></link> that should be used at search time on
    <link linkend="mapping-index"><literal>analyzed</literal></link> fields. Defaults to the <literal>analyzer</literal> setting.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="search-quote-analyzer"><literal>search_quote_analyzer</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The <link linkend="analyzer"><literal>analyzer</literal></link> that should be used at search time when a
    phrase is encountered. Defaults to the <literal>search_analyzer</literal> setting.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="similarity"><literal>similarity</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Which scoring algorithm or <emphasis>similarity</emphasis> should be used. Defaults
    to <literal>default</literal>, which uses TF/IDF.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="term-vector"><literal>term_vector</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether term vectors should be stored for an <link linkend="mapping-index"><literal>analyzed</literal></link>
    field. Defaults to <literal>no</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
<section id="token-count">
<title>Token count datatype<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/token-count.asciidoc">Edit me</ulink></title>
<simpara>A field of type <literal>token_count</literal> is really an <link linkend="number"><literal>integer</literal></link> field which
accepts string values, analyzes them, then indexes the number of tokens in the
string.</simpara>
<simpara>For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "name": { <co id="CO169-1"/>
          "type": "string",
          "fields": {
            "length": { <co id="CO169-2"/>
              "type":     "token_count",
              "analyzer": "standard"
            }
          }
        }
      }
    }
  }
}

PUT my_index/my_type/1
{ "name": "John Smith" }

PUT my_index/my_type/2
{ "name": "Rachel Alice Williams" }

GET my_index/_search
{
  "query": {
    "term": {
      "name.length": 3 <co id="CO169-3"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO169-1">
<para>
The <literal>name</literal> field is an analyzed string field which uses the default <literal>standard</literal> analyzer.
</para>
</callout>
<callout arearefs="CO169-2">
<para>
The <literal>name.length</literal> field is a <literal>token_count</literal> <link linkend="multi-fields">multi-field</link> which will index the number of tokens in the <literal>name</literal> field.
</para>
</callout>
<callout arearefs="CO169-3">
<para>
This query matches only the document containing <literal>Rachel Alice Williams</literal>, as it contains three tokens.
</para>
</callout>
</calloutlist>
<note>
<simpara>Technically the <literal>token_count</literal> type sums position increments rather than
counting tokens. This means that even if the analyzer filters out stop
words they are included in the count.</simpara>
</note>
<section id="token-count-params">
<title>Parameters for <literal>token_count</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/types/token-count.asciidoc">Edit me</ulink></title>
<simpara>The following parameters are accepted by <literal>token_count</literal> fields:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="analyzer"><literal>analyzer</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The <link linkend="analysis">analyzer</link> which should be used to analyze the string
    value. Required. For best performance, use an analyzer without token
    filters.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Field-level index time boosting. Accepts a floating point number, defaults
    to <literal>1.0</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be stored on disk in a column-stride fashion, so that it
    can later be used for sorting, aggregations, or scripting? Accepts <literal>true</literal>
    (default) or <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Should the field be searchable? Accepts <literal>not_analyzed</literal> (default) and <literal>no</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether or not the field value should be included in the
    <link linkend="mapping-all-field"><literal>_all</literal></link> field? Accepts <literal>true</literal> or <literal>false</literal>.  Defaults
    to <literal>false</literal>. Note: if <literal>true</literal>, it is the string value that is added to <literal>_all</literal>,
    not the calculated token count.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Accepts a numeric value of the same <literal>type</literal> as the field which is
    substituted for any explicit <literal>null</literal> values.  Defaults to <literal>null</literal>, which
    means the field is treated as missing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="precision-step"><literal>precision_step</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Controls the number of extra terms that are indexed to make
    <link linkend="query-dsl-range-query"><literal>range</literal> queries</link> faster. Defaults to <literal>32</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    Whether the field value should be stored and retrievable separately from
    the <link linkend="mapping-source-field"><literal>_source</literal></link> field. Accepts <literal>true</literal> or <literal>false</literal>
    (default).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
</section>
</chapter>
<chapter id="mapping-fields">
<title>Meta-Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></title>
<simpara>Each document has metadata associated with it, such as the <literal>_index</literal>, mapping
<link linkend="mapping-type-field"><literal>_type</literal></link>, and <literal>_id</literal> meta-fields.  The behaviour of some of these meta-fields
can be customised when a mapping type is created.</simpara>
<bridgehead id="_identity_meta_fields" renderas="sect2">Identity meta-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<link linkend="mapping-index-field"><literal>_index</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The index to which the document belongs.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-uid-field"><literal>_uid</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    A composite field consisting of the <literal>_type</literal> and the <literal>_id</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-type-field"><literal>_type</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The document&#8217;s <link linkend="mapping-type">mapping type</link>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<link linkend="mapping-id-field"><literal>_id</literal></link>
</simpara>
</entry>
<entry>
<simpara>
    The document&#8217;s ID.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_document_source_meta_fields" renderas="sect2">Document source meta-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<link linkend="mapping-source-field"><literal>_source</literal></link>
</term>
<listitem>
<simpara>
    The original JSON representing the body of the document.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/mapper-size.html"><literal>_size</literal></ulink>
</term>
<listitem>
<simpara>
    The size of the <literal>_source</literal> field in bytes, provided by the
    <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/mapper-size.html"><literal>mapper-size</literal> plugin</ulink>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_indexing_meta_fields" renderas="sect2">Indexing meta-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<link linkend="mapping-all-field"><literal>_all</literal></link>
</term>
<listitem>
<simpara>
    A <emphasis>catch-all</emphasis>  field that indexes the values of all other fields.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="mapping-field-names-field"><literal>_field_names</literal></link>
</term>
<listitem>
<simpara>
    All fields in the document which contain non-null values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="mapping-timestamp-field"><literal>_timestamp</literal></link>
</term>
<listitem>
<simpara>
    A timestamp associated with the document, either specified manually or auto-generated.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="mapping-ttl-field"><literal>_ttl</literal></link>
</term>
<listitem>
<simpara>
    How long a document should live before it is automatically deleted.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_routing_meta_fields" renderas="sect2">Routing meta-fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<link linkend="mapping-parent-field"><literal>_parent</literal></link>
</term>
<listitem>
<simpara>
    Used to create a parent-child relationship between two mapping types.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="mapping-routing-field"><literal>_routing</literal></link>
</term>
<listitem>
<simpara>
    A custom routing value which routes a document to a particular shard.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_other_meta_field" renderas="sect2">Other meta-field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<link linkend="mapping-meta-field"><literal>_meta</literal></link>
</term>
<listitem>
<simpara>
    Application specific metadata.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="mapping-all-field">
<title><literal>_all</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_all</literal> field is a special <emphasis>catch-all</emphasis> field which concatenates the values
of all of the other fields into one big string, using space as a delimiter, which is then
<link linkend="analysis">analyzed</link> and indexed, but not stored.  This means that it can be
searched, but not retrieved.</simpara>
<simpara>The <literal>_all</literal> field allows you to search for values in documents without knowing
which field contains the value.  This makes it a useful option when getting
started with a new dataset. For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/user/1 <co id="CO170-1"/>
{
  "first_name":    "John",
  "last_name":     "Smith",
  "date_of_birth": "1970-10-24"
}

GET my_index/_search
{
  "query": {
    "match": {
      "_all": "john smith 1970"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO170-1">
<para>
The <literal>_all</literal> field will contain the terms: [ <literal>"john"</literal>, <literal>"smith"</literal>, <literal>"1970"</literal>, <literal>"10"</literal>, <literal>"24"</literal> ]
</para>
</callout>
</calloutlist>
<note>
<title>All values treated as strings</title>
<simpara>The <literal>date_of_birth</literal> field in the above example is recognised as a <literal>date</literal> field
and so will index a single term representing <literal>1970-10-24 00:00:00 UTC</literal>. The
<literal>_all</literal> field, however, treats all values as strings, so the date value is
indexed as the three string terms: <literal>"1970"</literal>, <literal>"24"</literal>, <literal>"10"</literal>.</simpara>
<simpara>It is important to note that the <literal>_all</literal> field combines the original values
from each field as a string. It does not combine the <emphasis>terms</emphasis> from each field.</simpara>
</note>
<simpara>The <literal>_all</literal> field is just a <link linkend="string"><literal>string</literal></link> field, and accepts the same
parameters that  other string fields accept, including <literal>analyzer</literal>,
<literal>term_vectors</literal>, <literal>index_options</literal>, and <literal>store</literal>.</simpara>
<simpara>The <literal>_all</literal> field can be useful, especially when exploring new data using
simple filtering.  However, by concatenating field values into one big string,
the <literal>_all</literal> field loses the distinction between short fields (more relevant)
and long fields (less relevant). For use cases where search relevance is
important, it is better to query individual fields specifically.</simpara>
<simpara>The <literal>_all</literal> field is not free: it requires extra CPU cycles and uses more disk
space. If not needed, it can be completely <link linkend="disabling-all-field">disabled</link> or
customised on a <link linkend="include-in-all">per-field basis</link>.</simpara>
<section id="querying-all-field">
<title>Using the <literal>_all</literal> field in queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>The <link linkend="query-dsl-query-string-query"><literal>query_string</literal></link> and
<link linkend="query-dsl-simple-query-string-query"><literal>simple_query_string</literal></link> queries query
the <literal>_all</literal> field by default, unless another field is specified:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search
{
  "query": {
    "query_string": {
      "query": "john smith 1970"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The same goes for the <literal>?q=</literal> parameter in <link linkend="search-uri-request">URI search requests</link> (which is rewritten to a <literal>query_string</literal> query internally):</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _search?q=john+smith+1970</programlisting>
<simpara>Other queries, such as the <link linkend="query-dsl-match-query"><literal>match</literal></link> and
<link linkend="query-dsl-term-query"><literal>term</literal></link> queries require you to specify
the <literal>_all</literal> field explicitly, as per the
<link linkend="mapping-all-field">first example</link>.</simpara>
</section>
<section id="disabling-all-field">
<title>Disabling the <literal>_all</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_all</literal> field can be completely disabled per-type by setting <literal>enabled</literal> to
<literal>false</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "type_1": { <co id="CO171-1"/>
      "properties": {...}
    },
    "type_2": { <co id="CO171-2"/>
      "_all": {
        "enabled": false
      },
      "properties": {...}
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO171-1">
<para>
The <literal>_all</literal> field in <literal>type_1</literal> is enabled.
</para>
</callout>
<callout arearefs="CO171-2">
<para>
The <literal>_all</literal> field in <literal>type_2</literal> is completely disabled.
</para>
</callout>
</calloutlist>
<simpara>If the <literal>_all</literal> field is disabled, then URI search requests and the
<literal>query_string</literal> and <literal>simple_query_string</literal> queries will not be able to use it
for queries (see <xref linkend="querying-all-field"/>).  You can configure them to use a
different field with the <literal>index.query.default_field</literal> setting:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_all": {
        "enabled": false <co id="CO172-1"/>
      },
      "properties": {
        "content": {
          "type": "string"
        }
      }
    }
  },
  "settings": {
    "index.query.default_field": "content" <co id="CO172-2"/>
  },
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO172-1">
<para>
The <literal>_all</literal> field is disabled for the <literal>my_type</literal> type.
</para>
</callout>
<callout arearefs="CO172-2">
<para>
The <literal>query_string</literal> query will default to querying the <literal>content</literal> field in this index.
</para>
</callout>
</calloutlist>
</section>
<section id="excluding-from-all">
<title>Excluding fields from <literal>_all</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>Individual fields can be included or excluded from the <literal>_all</literal> field with the
<link linkend="include-in-all"><literal>include_in_all</literal></link> setting.</simpara>
</section>
<section id="all-field-and-boosting">
<title>Index boosting and the <literal>_all</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>Individual fields can be <emphasis>boosted</emphasis> at index time, with the <link linkend="index-boost"><literal>boost</literal></link>
parameter. The <literal>_all</literal> field takes these boosts into account:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT myindex
{
  "mappings": {
    "mytype": {
      "properties": {
        "title": { <co id="CO173-1"/>
          "type": "string",
          "boost": 2
        },
        "content": { <co id="CO173-2"/>
          "type": "string"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO173-1 CO173-2">
<para>
When querying the <literal>_all</literal> field, words that originated in the
    <literal>title</literal> field are twice as relevant as words that originated in
    the <literal>content</literal> field.
</para>
</callout>
</calloutlist>
<warning><simpara>Using index-time boosting with the <literal>_all</literal> field has a significant
impact on query performance. Usually the better solution is to query fields
individually, with optional query time boosting.</simpara></warning>
</section>
<section id="custom-all-fields">
<title>Custom <literal>_all</literal> fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>While there is only a single <literal>_all</literal> field per index, the <link linkend="copy-to"><literal>copy_to</literal></link>
parameter allows the creation of multiple <emphasis>custom <literal>_all</literal> fields</emphasis>. For
instance, <literal>first_name</literal> and <literal>last_name</literal> fields can be combined together into
the <literal>full_name</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT myindex
{
  "mappings": {
    "mytype": {
      "properties": {
        "first_name": {
          "type":    "string",
          "copy_to": "full_name" <co id="CO174-1"/>
        },
        "last_name": {
          "type":    "string",
          "copy_to": "full_name" <co id="CO174-2"/>
        },
        "full_name": {
          "type":    "string"
        }
      }
    }
  }
}

PUT myindex/mytype/1
{
  "first_name": "John",
  "last_name": "Smith"
}

GET myindex/_search
{
  "query": {
    "match": {
      "full_name": "John Smith"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO174-1 CO174-2">
<para>
The <literal>first_name</literal> and <literal>last_name</literal> values are copied to the <literal>full_name</literal> field.
</para>
</callout>
</calloutlist>
</section>
<section id="highlighting-all-field">
<title>Highlighting and the <literal>_all</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>A field can only be used for <link linkend="search-request-highlighting">highlighting</link>  if
the original string value is available, either from the
<link linkend="mapping-source-field"><literal>_source</literal></link>  field or as a stored field.</simpara>
<simpara>The <literal>_all</literal> field is not present in the <literal>_source</literal> field and it is not stored by
default, and so cannot be highlighted. There are two options. Either
<link linkend="all-field-store">store the <literal>_all</literal> field</link> or highlight the
<link linkend="all-highlight-fields">original fields</link>.</simpara>
<section id="all-field-store">
<title>Store the <literal>_all</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>If <literal>store</literal> is set to <literal>true</literal>, then the original field value is retrievable and
can be highlighted:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT myindex
{
  "mappings": {
    "mytype": {
      "_all": {
        "store": true
      }
    }
  }
}

PUT myindex/mytype/1
{
  "first_name": "John",
  "last_name": "Smith"
}

GET _search
{
  "query": {
    "match": {
      "_all": "John Smith"
    }
  },
  "highlight": {
    "fields": {
      "_all": {}
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Of course, storing the <literal>_all</literal> field will use significantly more disk space
and, because it is a combination of other fields, it may result in odd
highlighting results.</simpara>
<simpara>The <literal>_all</literal> field also accepts the <literal>term_vector</literal> and <literal>index_options</literal>
parameters, allowing the use of the fast vector highlighter and the postings
highlighter.</simpara>
</section>
<section id="all-highlight-fields">
<title>Highlight original fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/all-field.asciidoc">Edit me</ulink></title>
<simpara>You can query the <literal>_all</literal> field, but use the original fields for highlighting as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT myindex
{
  "mappings": {
    "mytype": {
      "_all": {}
    }
  }
}

PUT myindex/mytype/1
{
  "first_name": "John",
  "last_name": "Smith"
}

GET _search
{
  "query": {
    "match": {
      "_all": "John Smith" <co id="CO175-1"/>
    }
  },
  "highlight": {
    "fields": {
      "*_name": { <co id="CO175-2"/>
        "require_field_match": "false"  <co id="CO175-3"/>
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO175-1">
<para>
The query inspects the <literal>_all</literal> field to find matching documents.
</para>
</callout>
<callout arearefs="CO175-2">
<para>
Highlighting is performed on the two name fields, which are available from the <literal>_source</literal>.
</para>
</callout>
<callout arearefs="CO175-3">
<para>
The query wasn&#8217;t run against the name fields, so set <literal>require_field_match</literal> to <literal>false</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
</section>
<section id="mapping-field-names-field">
<title><literal>_field_names</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/field-names-field.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_field_names</literal> field indexes the names of every field in a document that
contains any value other than <literal>null</literal>.  This field is used by the
<link linkend="query-dsl-exists-query"><literal>exists</literal></link> and <link linkend="query-dsl-missing-query"><literal>missing</literal></link>
queries to find documents that either have or don&#8217;t have any non-<literal>null</literal> value
for a particular field.</simpara>
<simpara>The value of the <literal>_field_name</literal> field is accessible in queries, aggregations, and
scripts:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Example documents
PUT my_index/my_type/1
{
  "title": "This is a document"
}

PUT my_index/my_type/1
{
  "title": "This is another document",
  "body": "This document has a body"
}

GET my_index/_search
{
  "query": {
    "terms": {
      "_field_names": [ "title" ] <co id="CO176-1"/>
    }
  },
  "aggs": {
    "Field names": {
      "terms": {
        "field": "_field_names", <co id="CO176-2"/>
        "size": 10
      }
    }
  },
  "script_fields": {
    "Field names": {
      "script": "doc['_field_names']" <co id="CO176-3"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO176-1">
<para>
Querying on the <literal>_field_names</literal> field (also see the <link linkend="query-dsl-exists-query"><literal>exists</literal></link> and <link linkend="query-dsl-missing-query"><literal>missing</literal></link> queries)
</para>
</callout>
<callout arearefs="CO176-2">
<para>
Aggregating on the <literal>_field_names</literal> field
</para>
</callout>
<callout arearefs="CO176-3">
<para>
Accessing the <literal>_field_names</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-id-field">
<title><literal>_id</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/id-field.asciidoc">Edit me</ulink></title>
<simpara>Each document indexed is associated with a <link linkend="mapping-type-field"><literal>_type</literal></link> (see
<xref linkend="mapping-type"/>) and an <link linkend="mapping-id-field"><literal>_id</literal></link>.  The <literal>_id</literal> field is not
indexed as its value can be derived automatically from the
<link linkend="mapping-uid-field"><literal>_uid</literal></link> field.</simpara>
<simpara>The value of the <literal>_id</literal> field is accessible in certain queries (<literal>term</literal>,
<literal>terms</literal>, <literal>match</literal>, <literal>query_string</literal>, <literal>simple_query_string</literal>), but
<emphasis>not</emphasis> in aggregations, scripts or when sorting, where the <link linkend="mapping-uid-field"><literal>_uid</literal></link>
field should be used instead:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Example documents
PUT my_index/my_type/1
{
  "text": "Document with ID 1"
}

PUT my_index/my_type/2
{
  "text": "Document with ID 2"
}

GET my_index/_search
{
  "query": {
    "terms": {
      "_id": [ "1", "2" ] <co id="CO177-1"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO177-1">
<para>
Querying on the <literal>_id</literal> field (also see the <link linkend="query-dsl-ids-query"><literal>ids</literal> query</link>)
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-index-field">
<title><literal>_index</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/index-field.asciidoc">Edit me</ulink></title>
<simpara>When performing queries across multiple indexes, it is sometimes desirable to
add query clauses that are associated with documents of only certain indexes.
The <literal>_index</literal> field allows matching on the index a document was indexed into.
Its value is accessible in <literal>term</literal>, or <literal>terms</literal> queries, aggregations,
scripts, and when sorting:</simpara>
<note><simpara>The <literal>_index</literal> is exposed as a virtual field&#8201;&#8212;&#8201;it is not added to the
Lucene index as a real field.  This means that you can use the <literal>_index</literal> field
in a <literal>term</literal> or <literal>terms</literal> query (or any query that is rewritten to a <literal>term</literal>
query, such as the <literal>match</literal>,  <literal>query_string</literal> or <literal>simple_query_string</literal> query),
but it does not support <literal>prefix</literal>, <literal>wildcard</literal>, <literal>regexp</literal>, or <literal>fuzzy</literal> queries.</simpara></note>
<programlisting language="js" linenumbering="unnumbered"># Example documents
PUT index_1/my_type/1
{
  "text": "Document in index 1"
}

PUT index_2/my_type/2
{
  "text": "Document in index 2"
}

GET index_1,index_2/_search
{
  "query": {
    "terms": {
      "_index": ["index_1", "index_2"] <co id="CO178-1"/>
    }
  },
  "aggs": {
    "indices": {
      "terms": {
        "field": "_index", <co id="CO178-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_index": { <co id="CO178-3"/>
        "order": "asc"
      }
    }
  ],
  "script_fields": {
    "index_name": {
      "script": "doc['_index']" <co id="CO178-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO178-1">
<para>
Querying on the <literal>_index</literal> field
</para>
</callout>
<callout arearefs="CO178-2">
<para>
Aggregating on the <literal>_index</literal> field
</para>
</callout>
<callout arearefs="CO178-3">
<para>
Sorting on the <literal>_index</literal> field
</para>
</callout>
<callout arearefs="CO178-4">
<para>
Accessing the <literal>_index</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-meta-field">
<title><literal>_meta</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/meta-field.asciidoc">Edit me</ulink></title>
<simpara>Each mapping type can have custom meta data associated with it. These are not
used at all by Elasticsearch, but can be used to store application-specific
metadata, such as the class that a document belongs to:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "user": {
      "_meta": { <co id="CO179-1"/>
        "class": "MyApp::User",
        "version": {
          "min": "1.0",
          "max": "1.3"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO179-1">
<para>
This <literal>_meta</literal> info can be retrieved with the
    <link linkend="indices-get-mapping">GET mapping</link> API.
</para>
</callout>
</calloutlist>
<simpara>The <literal>_meta</literal> field can be updated on an existing type using the
<link linkend="indices-put-mapping">PUT mapping</link> API.</simpara>
</section>
<section id="mapping-parent-field">
<title><literal>_parent</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/parent-field.asciidoc">Edit me</ulink></title>
<simpara>A parent-child relationship can be established between documents in the same
index by making one mapping type the parent of another:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_parent": {},
    "my_child": {
      "_parent": {
        "type": "my_parent" <co id="CO180-1"/>
      }
    }
  }
}

PUT my_index/my_parent/1 <co id="CO180-2"/>
{
  "text": "This is a parent document"
}

PUT my_index/my_child/2?parent=1 <co id="CO180-3"/>
{
  "text": "This is a child document"
}

PUT my_index/my_child/3?parent=1 <co id="CO180-4"/>
{
  "text": "This is another child document"
}

GET my_index/my_parent/_search
{
  "query": {
    "has_child": { <co id="CO180-5"/>
      "type": "my_child",
      "query": {
        "match": {
          "text": "child document"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO180-1">
<para>
The <literal>my_parent</literal> type is parent to the <literal>my_child</literal> type.
</para>
</callout>
<callout arearefs="CO180-2">
<para>
Index a parent document.
</para>
</callout>
<callout arearefs="CO180-3 CO180-4">
<para>
Index two child documents, specifying the parent document&#8217;s ID.
</para>
</callout>
<callout arearefs="CO180-5">
<para>
Find all parent documents that have children which match the query.
</para>
</callout>
</calloutlist>
<simpara>See the <link linkend="query-dsl-has-child-query"><literal>has_child</literal></link> and
<link linkend="query-dsl-has-parent-query"><literal>has_parent</literal></link> queries,
the <link linkend="search-aggregations-bucket-children-aggregation"><literal>children</literal></link> aggregation,
and <link linkend="parent-child-inner-hits">inner hits</link> for more information.</simpara>
<simpara>The value of the <literal>_parent</literal> field is accessible in queries, aggregations, scripts,
and when sorting:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "terms": {
      "_parent": [ "1" ] <co id="CO181-1"/>
    }
  },
  "aggs": {
    "parents": {
      "terms": {
        "field": "_parent", <co id="CO181-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_parent": { <co id="CO181-3"/>
        "order": "desc"
      }
    }
  ],
  "script_fields": {
    "parent": {
      "script": "doc['_parent']" <co id="CO181-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO181-1">
<para>
Querying on the <literal>_parent</literal> field (also see the <link linkend="query-dsl-has-parent-query"><literal>has_parent</literal> query</link> and the <link linkend="query-dsl-has-child-query"><literal>has_child</literal> query</link>)
</para>
</callout>
<callout arearefs="CO181-2">
<para>
Aggregating on the <literal>_parent</literal> field (also see the <link linkend="search-aggregations-bucket-children-aggregation"><literal>children</literal></link> aggregation)
</para>
</callout>
<callout arearefs="CO181-3">
<para>
Sorting on the <literal>_parent</literal> field
</para>
</callout>
<callout arearefs="CO181-4">
<para>
Accessing the <literal>_parent</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
<section id="_parent_child_restrictions">
<title>Parent-child restrictions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/parent-field.asciidoc">Edit me</ulink></title>
<itemizedlist>
<listitem>
<simpara>
The parent and child types must be different&#8201;&#8212;&#8201;parent-child relationships
  cannot be established between documents of the same type.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>_parent.type</literal> setting can only point to a type that doesn&#8217;t exist yet.
  This means that a type cannot become a parent type after it is has been
  created.
</simpara>
</listitem>
<listitem>
<simpara>
Parent and child documents must be indexed on the same shard.  The <literal>parent</literal>
  ID is used as the <link linkend="mapping-routing-field">routing</link> value for the child,
  to ensure that the child is indexed on the same shard as the parent.
  This means that the same <literal>parent</literal> value needs to be provided when
  <link linkend="docs-get">getting</link>, <link linkend="docs-delete">deleting</link>, or <link linkend="docs-update">updating</link>
  a child document.
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="_global_ordinals">
<title>Global ordinals<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/parent-field.asciidoc">Edit me</ulink></title>
<simpara>Parent-child uses <link linkend="global-ordinals">global ordinals</link> to speed up joins.
Global ordinals need to be rebuilt after any change to a shard. The more
parent id values are stored in a shard, the longer it takes to rebuild the
global ordinals for the <literal>_parent</literal> field.</simpara>
<simpara>Global ordinals, by default, are built lazily: the first parent-child query or
aggregation after a refresh will trigger building of global ordinals. This can
introduce a significant latency spike for your users. You can use
<link linkend="fielddata-loading">eager_global_ordinals</link> to shift the cost of building global
ordinals from query time to refresh time, by mapping the <literal>_parent</literal> field as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_parent": {},
    "my_child": {
      "_parent": {
        "type": "my_parent",
        "fielddata": {
          "loading": "eager_global_ordinals"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The amount of heap used by global ordinals can be checked as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered"># Per-index
GET _stats/fielddata?human&amp;fields=_parent

# Per-node per-index
GET _nodes/stats/indices/fielddata?human&amp;fields=_parent</programlisting>
<remark> AUTOSENSE</remark>
</section>
</section>
<section id="mapping-routing-field">
<title><literal>_routing</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/routing-field.asciidoc">Edit me</ulink></title>
<simpara>A document is routed to a particular shard in an index using the following
formula:</simpara>
<literallayout class="monospaced">shard_num = hash(_routing) % num_primary_shards</literallayout>
<simpara>The default value used for <literal>_routing</literal> is the document&#8217;s <link linkend="mapping-id-field"><literal>_id</literal></link>
or the document&#8217;s <link linkend="mapping-parent-field"><literal>_parent</literal></link> ID, if present.</simpara>
<simpara>Custom routing patterns can be implemented by specifying a custom <literal>routing</literal>
value per document.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1?routing=user1 <co id="CO182-1"/>
{
  "title": "This is a document"
}

GET my_index/my_type/1?routing=user1 <co id="CO182-2"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO182-1">
<para>
This document uses <literal>user1</literal> as its routing value, instead of its ID.
</para>
</callout>
<callout arearefs="CO182-2">
<para>
The same <literal>routing</literal> value needs to be provided when
    <link linkend="docs-get">getting</link>, <link linkend="docs-delete">deleting</link>, or <link linkend="docs-update">updating</link>
    the document.
</para>
</callout>
</calloutlist>
<simpara>The value of the <literal>_routing</literal> field is accessible in queries, aggregations, scripts,
and when sorting:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "terms": {
      "_routing": [ "user1" ] <co id="CO183-1"/>
    }
  },
  "aggs": {
    "Routing values": {
      "terms": {
        "field": "_routing", <co id="CO183-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_routing": { <co id="CO183-3"/>
        "order": "desc"
      }
    }
  ],
  "script_fields": {
    "Routing value": {
      "script": "doc['_routing']" <co id="CO183-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO183-1">
<para>
Querying on the <literal>_routing</literal> field (also see the <link linkend="query-dsl-ids-query"><literal>ids</literal> query</link>)
</para>
</callout>
<callout arearefs="CO183-2">
<para>
Aggregating on the <literal>_routing</literal> field
</para>
</callout>
<callout arearefs="CO183-3">
<para>
Sorting on the <literal>_routing</literal> field
</para>
</callout>
<callout arearefs="CO183-4">
<para>
Accessing the <literal>_routing</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
<section id="_searching_with_custom_routing">
<title>Searching with custom routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/routing-field.asciidoc">Edit me</ulink></title>
<simpara>Custom routing can reduce the impact of searches.  Instead of having to fan
out a search request to all the shards in an index, the request can be sent to
just the shard that matches the specific routing value (or values):</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search?routing=user1,user2 <co id="CO184-1"/>
{
  "query": {
    "match": {
      "title": "document"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO184-1">
<para>
This search request will only be executed on the shards associated with the <literal>user1</literal> and <literal>user2</literal> routing values.
</para>
</callout>
</calloutlist>
</section>
<section id="_making_a_routing_value_required">
<title>Making a routing value required<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/routing-field.asciidoc">Edit me</ulink></title>
<simpara>When using custom routing, it is important to provide the routing value
whenever <link linkend="docs-index_">indexing</link>, <link linkend="docs-get">getting</link>,
<link linkend="docs-delete">deleting</link>, or <link linkend="docs-update">updating</link> a document.</simpara>
<simpara>Forgetting the routing value can lead to a document being indexed on more than
one shard.  As a safeguard, the <literal>_routing</literal> field can be configured to make a
custom <literal>routing</literal> value required for all CRUD operations:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_routing": {
        "required": true <co id="CO185-1"/>
      }
    }
  }
}

PUT my_index/my_type/1 <co id="CO185-2"/>
{
  "text": "No routing value provided"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO185-1">
<para>
Routing is required for <literal>my_type</literal> documents.
</para>
</callout>
<callout arearefs="CO185-2">
<para>
This index request throws a <literal>routing_missing_exception</literal>.
</para>
</callout>
</calloutlist>
</section>
<section id="_unique_ids_with_custom_routing">
<title>Unique IDs with custom routing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/routing-field.asciidoc">Edit me</ulink></title>
<simpara>When indexing documents specifying a custom <literal>_routing</literal>, the uniqueness of the
<literal>_id</literal> is not guaranteed across all of the shards in the index. In fact,
documents with the same <literal>_id</literal> might end up on different shards if indexed with
different <literal>_routing</literal> values.</simpara>
<simpara>It is up to the user to ensure that IDs are unique across the index.</simpara>
</section>
</section>
<section id="mapping-source-field">
<title><literal>_source</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/source-field.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_source</literal> field contains the original JSON document body that was passed
at index time.  The <literal>_source</literal> field itself is not indexed (and thus is not
searchable), but it is stored so that it can be returned when executing
<emphasis>fetch</emphasis> requests, like <link linkend="docs-get">get</link> or <link linkend="search-search">search</link>.</simpara>
<section id="_disabling_the_literal__source_literal_field">
<title>Disabling the <literal>_source</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/source-field.asciidoc">Edit me</ulink></title>
<simpara>Though very handy to have around, the source field does incur storage overhead
within the index. For this reason, it can be disabled as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT tweets
{
  "mappings": {
    "tweet": {
      "_source": {
        "enabled": false
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<warning>
<title>Think before disabling the <literal>_source</literal> field</title>
<simpara>Users often disable the <literal>_source</literal> field without thinking about the
consequences, and then live to regret it.  If the <literal>_source</literal> field isn&#8217;t
available then a number of features are not supported:</simpara>
<itemizedlist>
<listitem>
<simpara>
The <link linkend="docs-update"><literal>update</literal> API</link>.
</simpara>
</listitem>
<listitem>
<simpara>
On the fly <link linkend="search-request-highlighting">highlighting</link>.
</simpara>
</listitem>
<listitem>
<simpara>
The ability to reindex from one Elasticsearch index to another, either
  to change mappings or analysis, or to upgrade an index to a new major
  version.
</simpara>
</listitem>
<listitem>
<simpara>
The ability to debug queries or aggregations by viewing the original
  document used at index time.
</simpara>
</listitem>
<listitem>
<simpara>
Potentially in the future, the ability to repair index corruption
  automatically.
</simpara>
</listitem>
</itemizedlist>
</warning>
<tip><simpara>If disk space is a concern, rather increase the
<link linkend="index-codec">compression level</link> instead of disabling the <literal>_source</literal>.</simpara></tip>
<sidebar>
<title>The metrics use case</title>
<simpara>The <emphasis>metrics</emphasis> use case is distinct from other time-based or logging use cases
in that there are many small documents which consist only of numbers, dates,
or keywords.  There are no updates, no highlighting requests, and the data
ages quickly so there is no need to reindex.  Search requests typically use
simple queries to filter the dataset by date or tags, and the results are
returned as aggregations.</simpara>
<simpara>In this case, disabling the <literal>_source</literal> field will save space and reduce I/O.
It is also advisable to disable the <link linkend="mapping-all-field"><literal>_all</literal> field</link> in the
metrics case.</simpara>
</sidebar>
</section>
<section id="include-exclude">
<title>Including / Excluding fields from <literal>_source</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/source-field.asciidoc">Edit me</ulink></title>
<simpara>An expert-only feature is the ability to prune the contents of the <literal>_source</literal>
field after the document has been indexed, but before the <literal>_source</literal> field is
stored.</simpara>
<warning><simpara>Removing fields from the <literal>_source</literal> has similar downsides to disabling
<literal>_source</literal>, especially the fact that you cannot reindex documents from one
Elasticsearch index to another. Consider using
<link linkend="search-request-source-filtering">source filtering</link> instead.</simpara></warning>
<simpara>The <literal>includes</literal>/<literal>excludes</literal> parameters (which also accept wildcards) can be used
as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT logs
{
  "mappings": {
    "event": {
      "_source": {
        "includes": [
          "*.count",
          "meta.*"
        ],
        "excludes": [
          "meta.description",
          "meta.other.*"
        ]
      }
    }
  }
}

PUT logs/event/1
{
  "requests": {
    "count": 10,
    "foo": "bar" <co id="CO186-1"/>
  },
  "meta": {
    "name": "Some metric",
    "description": "Some metric description", <co id="CO186-2"/>
    "other": {
      "foo": "one", <co id="CO186-3"/>
      "baz": "two" <co id="CO186-4"/>
    }
  }
}

GET logs/event/_search
{
  "query": {
    "match": {
      "meta.other.foo": "one" <co id="CO186-5"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO186-1 CO186-2 CO186-3 CO186-4">
<para>
These fields will be removed from the stored <literal>_source</literal> field.
</para>
</callout>
<callout arearefs="CO186-5">
<para>
We can still search on this field, even though it is not in the stored <literal>_source</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="mapping-timestamp-field">
<title><literal>_timestamp</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/timestamp-field.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The <literal>_timestamp</literal> field is deprecated.  Instead, use a normal <link linkend="date"><literal>date</literal></link> field and set its value explicitly.</simpara></warning>
<simpara>The <literal>_timestamp</literal> field, when enabled, allows a timestamp to be indexed and
stored with a document. The timestamp may be specified manually, generated
automatically, or set to a default value:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_timestamp": { <co id="CO187-1"/>
        "enabled": true
      }
    }
  }
}

PUT my_index/my_type/1?timestamp=2015-01-01 <co id="CO187-2"/>
{ "text": "Timestamp as a formatted date" }

PUT my_index/my_type/2?timestamp=1420070400000 <co id="CO187-3"/>
{ "text": "Timestamp as milliseconds since the epoch" }

PUT my_index/my_type/3 <co id="CO187-4"/>
{ "text": "Autogenerated timestamp set to now()" }</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO187-1">
<para>
Enable the <literal>_timestamp</literal> field with default settings.
</para>
</callout>
<callout arearefs="CO187-2">
<para>
Set the timestamp manually with a formatted date.
</para>
</callout>
<callout arearefs="CO187-3">
<para>
Set the timestamp with milliseconds since the epoch.
</para>
</callout>
<callout arearefs="CO187-4">
<para>
Auto-generates a timestamp with <link linkend="date-math">now()</link>.
</para>
</callout>
</calloutlist>
<simpara>The behaviour of the <literal>_timestamp</literal> field can be configured with the following parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>default</literal>
</term>
<listitem>
<simpara>
    A default value to be used if none is provided.  Defaults to <link linkend="date-math">now()</link>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>format</literal>
</term>
<listitem>
<simpara>
    The <link linkend="mapping-date-format">date format</link> (or formats) to use when parsing timestamps.  Defaults to <literal>epoch_millis||strictDateOptionalTime</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>ignore_missing</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> (default), replace missing timestamps with the <literal>default</literal> value.  If <literal>false</literal>, throw an exception.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The value of the <literal>_timestamp</literal> field is accessible in queries, aggregations, scripts,
and when sorting:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "range": {
      "_timestamp": { <co id="CO188-1"/>
        "gte": "2015-01-01"
      }
    }
  },
  "aggs": {
    "Timestamps": {
      "terms": {
        "field": "_timestamp", <co id="CO188-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_timestamp": { <co id="CO188-3"/>
        "order": "desc"
      }
    }
  ],
  "script_fields": {
    "Timestamp": {
      "script": "doc['_timestamp']" <co id="CO188-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO188-1">
<para>
Querying on the <literal>_timestamp</literal> field
</para>
</callout>
<callout arearefs="CO188-2">
<para>
Aggregating on the <literal>_timestamp</literal> field
</para>
</callout>
<callout arearefs="CO188-3">
<para>
Sorting on the <literal>_timestamp</literal> field
</para>
</callout>
<callout arearefs="CO188-4">
<para>
Accessing the <literal>_timestamp</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-ttl-field">
<title><literal>_ttl</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/ttl-field.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0-beta2"><title>Deprecated in 2.0.0-beta2.</title><simpara>The current <literal>_ttl</literal> implementation is deprecated and will be replaced with a different implementation in a future version.</simpara></warning>
<simpara>Some types of documents, such as session data or special offers, come with an
expiration date. The <literal>_ttl</literal> field allows you to specify the minimum time a
document should live, after which time the document is deleted automatically.</simpara>
<tip>
<title>Prefer index-per-timeframe to TTL</title>
<simpara>With TTL , expired documents first have to be marked as deleted then later
purged from the index when segments are merged.  For append-only time-based
data such as log events, it is much more efficient to use an index-per-day /
week / month instead of TTLs.  Old log data can be removed by simply deleting
old indices.</simpara>
</tip>
<simpara>The <literal>_ttl</literal> field may be enabled as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_ttl": {
        "enabled": true
      }
    }
  }
}

PUT my_index/my_type/1?ttl=10m <co id="CO189-1"/>
{
  "text": "Will expire in 10 minutes"
}

PUT my_index/my_type/2 <co id="CO189-2"/>
{
  "text": "Will not expire"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO189-1">
<para>
This document will expire 10 minutes after being indexed.
</para>
</callout>
<callout arearefs="CO189-2">
<para>
This document has no TTL set and will not expire.
</para>
</callout>
</calloutlist>
<simpara>The expiry time is calculated as the value of the
<link linkend="mapping-timestamp-field"><literal>_timestamp</literal></link> field (or <literal>now()</literal> if the <literal>_timestamp</literal>
is not enabled) plus the <literal>ttl</literal> specified in the indexing request.</simpara>
<section id="_default_ttl">
<title>Default TTL<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/ttl-field.asciidoc">Edit me</ulink></title>
<simpara>You can provide a default <literal>_ttl</literal>, which will be applied to indexing requests where the <literal>ttl</literal> is not specified:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "_ttl": {
        "enabled": true,
        "default": "5m"
      }
    }
  }
}

PUT my_index/my_type/1?ttl=10m <co id="CO190-1"/>
{
  "text": "Will expire in 10 minutes"
}

PUT my_index/my_type/2 <co id="CO190-2"/>
{
  "text": "Will expire in 5 minutes"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO190-1">
<para>
This document will expire 10 minutes after being indexed.
</para>
</callout>
<callout arearefs="CO190-2">
<para>
This document has no TTL set and so will expire after the default 5 minutes.
</para>
</callout>
</calloutlist>
<simpara>The <literal>default</literal> value can use <link linkend="time-units">time units</link> like <literal>d</literal> for days, and
will use <literal>ms</literal> as the default unit if no time unit is provided.</simpara>
<simpara>You can dynamically update the <literal>default</literal> value using the put mapping
API. It won&#8217;t change the <literal>_ttl</literal> of already indexed documents but will be
used for future documents.</simpara>
</section>
<section id="_note_on_documents_expiration">
<title>Note on documents expiration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/ttl-field.asciidoc">Edit me</ulink></title>
<simpara>Expired documents will be automatically deleted periodically. The following
settings control the expiry process:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.ttl.interval</literal>
</term>
<listitem>
<simpara>
How often the purge process should run. Defaults to <literal>60s</literal>. Expired documents
may still be retrieved before they are purged.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.ttl.bulk_size</literal>
</term>
<listitem>
<simpara>
How many deletions are handled by a single <link linkend="docs-bulk"><literal>bulk</literal></link> request. The
default value is <literal>10000</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="_note_on_literal_detect_noop_literal">
<title>Note on <literal>detect_noop</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/ttl-field.asciidoc">Edit me</ulink></title>
<simpara>If an update tries to update just the <literal>_ttl</literal> without changing the <literal>_source</literal> of
the document it&#8217;s expiration time won&#8217;t be updated if <literal>detect_noop</literal> is <literal>true</literal>.
In 2.1 <literal>detect_noop</literal> defaults to <literal>true</literal>.</simpara>
</section>
</section>
<section id="mapping-type-field">
<title><literal>_type</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/type-field.asciidoc">Edit me</ulink></title>
<simpara>Each document indexed is associated with a <link linkend="mapping-type-field"><literal>_type</literal></link> (see
<xref linkend="mapping-type"/>) and an <link linkend="mapping-id-field"><literal>_id</literal></link>.  The <literal>_type</literal> field is
indexed in order to make searching by type name fast.</simpara>
<simpara>The value of the <literal>_type</literal> field is accessible in queries, aggregations,
scripts, and when sorting:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Example documents
PUT my_index/type_1/1
{
  "text": "Document with type 1"
}

PUT my_index/type_2/2
{
  "text": "Document with type 2"
}

GET my_index/_search/type_*
{
  "query": {
    "terms": {
      "_type": [ "type_1", "type_2" ] <co id="CO191-1"/>
    }
  },
  "aggs": {
    "types": {
      "terms": {
        "field": "_type", <co id="CO191-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_type": { <co id="CO191-3"/>
        "order": "desc"
      }
    }
  ],
  "script_fields": {
    "type": {
      "script": "doc['_type']" <co id="CO191-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO191-1">
<para>
Querying on the <literal>_type</literal> field
</para>
</callout>
<callout arearefs="CO191-2">
<para>
Aggregating on the <literal>_type</literal> field
</para>
</callout>
<callout arearefs="CO191-3">
<para>
Sorting on the <literal>_type</literal> field
</para>
</callout>
<callout arearefs="CO191-4">
<para>
Accessing the <literal>_type</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-uid-field">
<title><literal>_uid</literal> field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/fields/uid-field.asciidoc">Edit me</ulink></title>
<simpara>Each document indexed is associated with a <link linkend="mapping-type-field"><literal>_type</literal></link> (see
<xref linkend="mapping-type"/>) and an <link linkend="mapping-id-field"><literal>_id</literal></link>.  These values are
combined as <literal>{type}#{id}</literal> and indexed as the <literal>_uid</literal> field.</simpara>
<simpara>The value of the <literal>_uid</literal> field is accessible in queries, aggregations, scripts,
and when sorting:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Example documents
PUT my_index/my_type/1
{
  "text": "Document with ID 1"
}

PUT my_index/my_type/2
{
  "text": "Document with ID 2"
}

GET my_index/_search
{
  "query": {
    "terms": {
      "_uid": [ "my_type#1", "my_type#2" ] <co id="CO192-1"/>
    }
  },
  "aggs": {
    "UIDs": {
      "terms": {
        "field": "_uid", <co id="CO192-2"/>
        "size": 10
      }
    }
  },
  "sort": [
    {
      "_uid": { <co id="CO192-3"/>
        "order": "desc"
      }
    }
  ],
  "script_fields": {
    "UID": {
      "script": "doc['_uid']" <co id="CO192-4"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO192-1">
<para>
Querying on the <literal>_uid</literal> field (also see the <link linkend="query-dsl-ids-query"><literal>ids</literal> query</link>)
</para>
</callout>
<callout arearefs="CO192-2">
<para>
Aggregating on the <literal>_uid</literal> field
</para>
</callout>
<callout arearefs="CO192-3">
<para>
Sorting on the <literal>_uid</literal> field
</para>
</callout>
<callout arearefs="CO192-4">
<para>
Accessing the <literal>_uid</literal> field in scripts (inline scripts must be <link linkend="enable-dynamic-scripting">enabled</link> for this example to work)
</para>
</callout>
</calloutlist>
</section>
</chapter>
<chapter id="mapping-params">
<title>Mapping parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params.asciidoc">Edit me</ulink></title>
<simpara>The following pages provide detailed explanations of the various mapping
parameters that are used by <link linkend="mapping-types">field mappings</link>:</simpara>
<simpara>The following mapping parameters are common to some or all field datatypes:</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="analyzer"><literal>analyzer</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="index-boost"><literal>boost</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="coerce"><literal>coerce</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="copy-to"><literal>copy_to</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="doc-values"><literal>doc_values</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="dynamic"><literal>dynamic</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="enabled"><literal>enabled</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="fielddata"><literal>fielddata</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="geohash"><literal>geohash</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="geohash-precision"><literal>geohash_precision</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="geohash-prefix"><literal>geohash_prefix</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="mapping-date-format"><literal>format</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="ignore-above"><literal>ignore_above</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="ignore-malformed"><literal>ignore_malformed</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="include-in-all"><literal>include_in_all</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="index-options"><literal>index_options</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="lat-lon"><literal>lat_lon</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="mapping-index"><literal>index</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="multi-fields"><literal>fields</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="norms"><literal>norms</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="null-value"><literal>null_value</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="position-increment-gap"><literal>position_increment_gap</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="properties"><literal>properties</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="search-analyzer"><literal>search_analyzer</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="similarity"><literal>similarity</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="mapping-store"><literal>store</literal></link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="term-vector"><literal>term_vector</literal></link>
</simpara>
</listitem>
</itemizedlist>
<section id="analyzer">
<title><literal>analyzer</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/analyzer.asciidoc">Edit me</ulink></title>
<simpara>The values of <link linkend="mapping-index"><literal>analyzed</literal></link> string fields are passed through an
<link linkend="analysis">analyzer</link> to convert the string into a stream of <emphasis>tokens</emphasis> or
<emphasis>terms</emphasis>.  For instance, the string <literal>"The quick Brown Foxes."</literal> may, depending
on which analyzer is used,  be analyzed to the tokens: <literal>quick</literal>, <literal>brown</literal>,
<literal>fox</literal>.  These are the actual terms that are indexed for the field, which makes
it possible to search efficiently for individual words <emphasis>within</emphasis>  big blobs of
text.</simpara>
<simpara>This analysis process needs to happen not just at index time, but also at
query time: the query string needs to be passed through the same (or a
similar) analyzer so that the terms that it tries to find are in the same
format as those that exist in the index.</simpara>
<simpara>Elasticsearch ships with a number of <link linkend="analysis-analyzers">pre-defined analyzers</link>,
which can be used without further configuration.  It also ships with many
<link linkend="analysis-charfilters">character filters</link>, <link linkend="analysis-tokenizers">tokenizers</link>,
and <xref linkend="analysis-tokenfilters"/> which can be combined to configure
custom analyzers per index.</simpara>
<simpara>Analyzers can be specified per-query, per-field or per-index. At index time,
Elasticsearch will look for an analyzer in this order:</simpara>
<itemizedlist>
<listitem>
<simpara>
The <literal>analyzer</literal> defined in the field mapping.
</simpara>
</listitem>
<listitem>
<simpara>
An analyzer named <literal>default</literal> in the index settings.
</simpara>
</listitem>
<listitem>
<simpara>
The <link linkend="analysis-standard-analyzer"><literal>standard</literal></link> analyzer.
</simpara>
</listitem>
</itemizedlist>
<simpara>At query time, there are a few more layers:</simpara>
<itemizedlist>
<listitem>
<simpara>
The <literal>analyzer</literal> defined in a <link linkend="full-text-queries">full-text query</link>.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>search_analyzer</literal> defined in the field mapping.
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>analyzer</literal> defined in the field mapping.
</simpara>
</listitem>
<listitem>
<simpara>
An analyzer named <literal>default_search</literal> in the index settings.
</simpara>
</listitem>
<listitem>
<simpara>
An analyzer named <literal>default</literal> in the index settings.
</simpara>
</listitem>
<listitem>
<simpara>
The <link linkend="analysis-standard-analyzer"><literal>standard</literal></link> analyzer.
</simpara>
</listitem>
</itemizedlist>
<simpara>The easiest way to specify an analyzer for a particular field is to define it
in the field mapping, as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "text": { <co id="CO193-1"/>
          "type": "string",
          "fields": {
            "english": { <co id="CO193-2"/>
              "type":     "string",
              "analyzer": "english"
            }
          }
        }
      }
    }
  }
}

GET my_index/_analyze?field=text <co id="CO193-3"/>
{
  "text": "The quick Brown Foxes."
}

GET my_index/_analyze?field=text.english <co id="CO193-4"/>
{
  "text": "The quick Brown Foxes."
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO193-1">
<para>
The <literal>text</literal> field uses the default <literal>standard</literal> analyzer`.
</para>
</callout>
<callout arearefs="CO193-2">
<para>
The <literal>text.english</literal> <link linkend="multi-fields">multi-field</link> uses the <literal>english</literal> analyzer, which removes stop words and applies stemming.
</para>
</callout>
<callout arearefs="CO193-3">
<para>
This returns the tokens: [ <literal>the</literal>, <literal>quick</literal>, <literal>brown</literal>, <literal>foxes</literal> ].
</para>
</callout>
<callout arearefs="CO193-4">
<para>
This returns the tokens: [ <literal>quick</literal>, <literal>brown</literal>, <literal>fox</literal> ].
</para>
</callout>
</calloutlist>
<section id="search-quote-analyzer">
<title><literal>search_quote_analyzer</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>search_quote_analyzer</literal> setting allows you to specify an analyzer for phrases, this is particularly useful when dealing with disabling
stop words for phrase queries.</simpara>
<simpara>To disable stop words for phrases a field utilising three analyzer settings will be required:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
An <literal>analyzer</literal> setting for indexing all terms including stop words
</simpara>
</listitem>
<listitem>
<simpara>
A <literal>search_analyzer</literal> setting for non-phrase queries that will remove stop words
</simpara>
</listitem>
<listitem>
<simpara>
A <literal>search_quote_analyzer</literal> setting for phrase queries that will not remove stop words
</simpara>
</listitem>
</orderedlist>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
   "settings":{
      "analysis":{
         "analyzer":{
            "my_analyzer":{ <co id="CO194-1"/>
               "type":"custom",
               "tokenizer":"standard",
               "filter":[
                  "lowercase"
               ]
            },
            "my_stop_analyzer":{ <co id="CO194-2"/>
               "type":"custom",
               "tokenizer":"standard",
               "filter":[
                  "lowercase",
                  "english_stop"
               ]
            }
         },
         "filter":{
            "english_stop":{
               "type":"stop",
               "stopwords":"_english_"
            }
         }
      }
   },
   "mappings":{
      "my_type":{
         "properties":{
            "title": {
               "type":"string",
               "analyzer":"my_analyzer", <co id="CO194-3"/>
               "search_analyzer":"my_stop_analyzer", <co id="CO194-4"/>
               "search_quote_analyzer":"my_analyzer" <co id="CO194-5"/>
              }
            }
         }
      }
   }
}</programlisting>
<remark> AUTOSENSE</remark>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
   "title":"The Quick Brown Fox"
}

PUT my_index/my_type/2
{
   "title":"A Quick Brown Fox"
}

GET my_index/my_type/_search
{
   "query":{
      "query_string":{
         "query":"\"the quick brown fox\"" <co id="CO194-6"/>
      }
   }
}</programlisting>
<calloutlist>
<callout arearefs="CO194-1">
<para>
<literal>my_analyzer</literal> analyzer which tokens all terms including stop words
</para>
</callout>
<callout arearefs="CO194-2">
<para>
<literal>my_stop_analyzer</literal> analyzer which removes stop words
</para>
</callout>
<callout arearefs="CO194-3">
<para>
<literal>analyzer</literal> setting that points to the <literal>my_analyzer</literal> analyzer which will be used at index time
</para>
</callout>
<callout arearefs="CO194-4">
<para>
<literal>search_analyzer</literal> setting that points to the <literal>my_stop_analyzer</literal> and removes stop words for non-phrase queries
</para>
</callout>
<callout arearefs="CO194-5">
<para>
<literal>search_quote_analyzer</literal> setting that points to the <literal>my_analyzer</literal> analyzer and ensures that stop words are not removed from phrase queries
</para>
</callout>
<callout arearefs="CO194-6">
<para>
Since the query is wrapped in quotes it is detected as a phrase query therefore the <literal>search_quote_analyzer</literal> kicks in and ensures the stop words
are not removed from the query. The <literal>my_analyzer</literal> analyzer will then return the following tokens [<literal>the</literal>, <literal>quick</literal>, <literal>brown</literal>, <literal>fox</literal>] which will match one
of the documents. Meanwhile term queries will be analyzed with the <literal>my_stop_analyzer</literal> analyzer which will filter out stop words. So a search for either
<literal>The quick brown fox</literal> or <literal>A quick brown fox</literal> will return both documents since both documents contain the following tokens [<literal>quick</literal>, <literal>brown</literal>, <literal>fox</literal>].
Without the <literal>search_quote_analyzer</literal> it would not be possible to do exact matches for phrase queries as the stop words from phrase queries would be
removed resulting in both documents matching.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="index-boost">
<title><literal>boost</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/boost.asciidoc">Edit me</ulink></title>
<simpara>Individual fields can be <emphasis>boosted</emphasis>&#8201;&#8212;&#8201;count more towards the relevance score&#8201;&#8212;&#8201;at index time, with the <literal>boost</literal> parameter as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "title": {
          "type": "string",
          "boost": 2 <co id="CO195-1"/>
        },
        "content": {
          "type": "string"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO195-1">
<para>
Matches on the <literal>title</literal> field will have twice the weight as those on the
    <literal>content</literal> field, which has the default <literal>boost</literal> of <literal>1.0</literal>.
</para>
</callout>
</calloutlist>
<simpara>Note that a <literal>title</literal> field will usually be shorter than a <literal>content</literal> field.  The
default relevance calculation takes field length into account, so a short
<literal>title</literal> field will have a higher natural boost than a long <literal>content</literal> field.</simpara>
<warning>
<title>Why index time boosting is a bad idea</title>
<simpara>We advise against using index time boosting for the following reasons:</simpara>
<itemizedlist>
<listitem>
<simpara>
You cannot change index-time <literal>boost</literal> values without reindexing all of your
  documents.
</simpara>
</listitem>
<listitem>
<simpara>
Every query supports query-time boosting which achieves the same effect. The
  difference is that you can tweak the <literal>boost</literal> value without having to reindex.
</simpara>
</listitem>
<listitem>
<simpara>
Index-time boosts are stored as part of the <link linkend="norms"><literal>norm</literal></link>, which is only one
  byte.  This reduces the resolution of the field length normalization factor
  which can lead to lower quality relevance calculations.
</simpara>
</listitem>
</itemizedlist>
</warning>
<simpara>The only advantage that index time boosting has is that it is copied with the
value into the <link linkend="mapping-all-field"><literal>_all</literal></link> field. This means that, when
querying the <literal>_all</literal> field, words that originated from the <literal>title</literal> field will
have a higher score than words that originated in the <literal>content</literal> field.
This functionality comes at a cost: queries on the <literal>_all</literal> field are slower
when index-time boosting is used.</simpara>
</section>
<section id="coerce">
<title><literal>coerce</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/coerce.asciidoc">Edit me</ulink></title>
<simpara>Data is not always clean.  Depending on how it is produced a number might be
rendered in the JSON body as a true JSON number, e.g. <literal>5</literal>, but it might also
be rendered as a string, e.g. <literal>"5"</literal>.  Alternatively, a number that should be
an integer might instead be rendered as a floating point, e.g. <literal>5.0</literal>, or even
<literal>"5.0"</literal>.</simpara>
<simpara>Coercion attempts to clean up dirty values to fit the datatype of a field.
For instance:</simpara>
<itemizedlist>
<listitem>
<simpara>
Strings will be coerced to numbers.
</simpara>
</listitem>
<listitem>
<simpara>
Floating points will be truncated for integer values.
</simpara>
</listitem>
<listitem>
<simpara>
Lon/lat geo-points will be normalized to a standard -180:180 / -90:90 coordinate system.
</simpara>
</listitem>
</itemizedlist>
<simpara>For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "number_one": {
          "type": "integer"
        },
        "number_two": {
          "type": "integer",
          "coerce": false
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "number_one": "10" <co id="CO196-1"/>
}

PUT my_index/my_type/2
{
  "number_two": "10" <co id="CO196-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO196-1">
<para>
The <literal>number_one</literal> field will contain the integer <literal>10</literal>.
</para>
</callout>
<callout arearefs="CO196-2">
<para>
This document will be rejected because coercion is disabled.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>coerce</literal> setting is allowed to have different settings for fields of
the same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="coerce-setting">
<title>Index-level default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/coerce.asciidoc">Edit me</ulink></title>
<simpara>The <literal>index.mapping.coerce</literal> setting can be set on the index level to disable
coercion globally across all mapping types:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "index.mapping.coerce": false
  },
  "mappings": {
    "my_type": {
      "properties": {
        "number_one": {
          "type": "integer"
        },
        "number_two": {
          "type": "integer",
          "coerce": true
        }
      }
    }
  }
}

PUT my_index/my_type/1
{ "number_one": "10" } <co id="CO197-1"/>

PUT my_index/my_type/2
{ "number_two": "10" } <co id="CO197-2"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO197-1">
<para>
This document will be rejected because the <literal>number_one</literal> field inherits the index-level coercion setting.
</para>
</callout>
<callout arearefs="CO197-2">
<para>
The <literal>number_two</literal> field overrides the index level setting to enable coercion.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="copy-to">
<title><literal>copy_to</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/copy-to.asciidoc">Edit me</ulink></title>
<simpara>The <literal>copy_to</literal> parameter allows you to create custom
<link linkend="mapping-all-field"><literal>_all</literal></link> fields.  In other words, the values of multiple
fields can be copied into a group field, which can then be queried as a single
field.  For instance, the <literal>first_name</literal> and <literal>last_name</literal> fields can be copied to
the <literal>full_name</literal> field as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "first_name": {
          "type": "string",
          "copy_to": "full_name" <co id="CO198-1"/>
        },
        "last_name": {
          "type": "string",
          "copy_to": "full_name" <co id="CO198-2"/>
        },
        "full_name": {
          "type": "string"
        }
      }
    }
  }
}

PUT /my_index/my_type/1
{
  "first_name": "John",
  "last_name": "Smith"
}

GET /my_index/_search
{
  "query": {
    "match": {
      "full_name": { <co id="CO198-3"/>
        "query": "John Smith",
        "operator": "and"
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO198-1 CO198-2">
<para>
The values of the <literal>first_name</literal> and <literal>last_name</literal> fields are copied to the
     <literal>full_name</literal> field.
</para>
</callout>
<callout arearefs="CO198-3">
<para>
The <literal>first_name</literal> and <literal>last_name</literal> fields can still be queried for the
     first name and last name respectively, but the <literal>full_name</literal> field can be
     queried for both first and last names.
</para>
</callout>
</calloutlist>
<simpara>Some important points:</simpara>
<itemizedlist>
<listitem>
<simpara>
It is the field <emphasis>value</emphasis> which is copied, not the terms (which result from the analysis process).
</simpara>
</listitem>
<listitem>
<simpara>
The original <link linkend="mapping-source-field"><literal>_source</literal></link> field will not be modified to show the copied values.
</simpara>
</listitem>
<listitem>
<simpara>
The same value can be copied to multiple fields, with <literal>"copy_to": [ "field_1", "field_2" ]</literal>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="doc-values">
<title><literal>doc_values</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/doc-values.asciidoc">Edit me</ulink></title>
<simpara>Most fields are <link linkend="mapping-index">indexed</link> by default, which makes them
searchable. The inverted index allows queries to look up the search term in
unique sorted list of terms, and from that immediately have access to the list
of documents that contain the term.</simpara>
<simpara>Sorting, aggregations, and access to field values in scripts requires a
different data access pattern.  Instead of looking up the term and finding
documents, we need to be able to look up the document and find the terms that
it has in a field.</simpara>
<simpara>Doc values are the on-disk data structure, built at document index time, which
makes this data access pattern possible. They store the same values as the
<literal>_source</literal> but in a column-oriented fashion that is way more efficient for
sorting and aggregations. Doc values are supported on almost all field types,
with the <emphasis>notable exception of <literal>analyzed</literal> string fields</emphasis>.</simpara>
<simpara>All fields which support doc values have them enabled by default. If you are
sure that you don&#8217;t need to sort or aggregate on a field, or access the field
value from a script, you can disable doc values in order to save disk space:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "status_code": { <co id="CO199-1"/>
          "type":       "string",
          "index":      "not_analyzed"
        },
        "session_id": { <co id="CO199-2"/>
          "type":       "string",
          "index":      "not_analyzed",
          "doc_values": false
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO199-1">
<para>
The <literal>status_code</literal> field has <literal>doc_values</literal> enabled by default.
</para>
</callout>
<callout arearefs="CO199-2">
<para>
The <literal>session_id</literal> has <literal>doc_values</literal> disabled, but can still be queried.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>doc_values</literal> setting is allowed to have different settings for fields
of the same name in the same index.  It can be disabled (set to <literal>false</literal>) on
existing fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
<section id="dynamic">
<title><literal>dynamic</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/dynamic.asciidoc">Edit me</ulink></title>
<simpara>By default, fields can be added <emphasis>dynamically</emphasis> to a document, or to
<link linkend="object">inner objects</link> within a document, just by indexing a document
containing the new field.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">DELETE my_index <co id="CO200-1"/>

PUT my_index/my_type/1 <co id="CO200-2"/>
{
  "username": "johnsmith",
  "name": {
    "first": "John",
    "last": "Smith"
  }
}

GET my_index/_mapping <co id="CO200-3"/>

PUT my_index/my_type/2 <co id="CO200-4"/>
{
  "username": "marywhite",
  "email": "mary@white.com",
  "name": {
    "first": "Mary",
    "middle": "Alice",
    "last": "White"
  }
}

GET my_index/_mapping <co id="CO200-5"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO200-1">
<para>
First delete the index, in case it already exists.
</para>
</callout>
<callout arearefs="CO200-2">
<para>
This document introduces the string field <literal>username</literal>, the object field
    <literal>name</literal>, and two string fields under the <literal>name</literal> object which can be
    referred to as <literal>name.first</literal> and <literal>name.last</literal>.
</para>
</callout>
<callout arearefs="CO200-3">
<para>
Check the mapping to verify the above.
</para>
</callout>
<callout arearefs="CO200-4">
<para>
This document adds two string fields: <literal>email</literal> and <literal>name.middle</literal>.
</para>
</callout>
<callout arearefs="CO200-5">
<para>
Check the mapping to verify the changes.
</para>
</callout>
</calloutlist>
<simpara>The details of how new fields are detected and added to the mapping is explained in <xref linkend="dynamic-mapping"/>.</simpara>
<simpara>The <literal>dynamic</literal> setting controls whether new fields can be added dynamically or
not.  It accepts three settings:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>true</literal>
</simpara>
</entry>
<entry>
<simpara>
Newly detected fields are added to the mapping. (default)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>false</literal>
</simpara>
</entry>
<entry>
<simpara>
Newly detected fields are ignored.  New fields must be added explicitly.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>strict</literal>
</simpara>
</entry>
<entry>
<simpara>
If new fields are detected, an exception is thrown and the document is rejected.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The <literal>dynamic</literal> setting may be set at the mapping type level, and on each
<link linkend="object">inner object</link>.  Inner objects inherit the setting from their parent
object or from the mapping type.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic": false, <co id="CO201-1"/>
      "properties": {
        "user": { <co id="CO201-2"/>
          "properties": {
            "name": {
              "type": "string"
            },
            "social_networks": { <co id="CO201-3"/>
              "dynamic": true,
              "properties": {}
            }
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO201-1">
<para>
Dynamic mapping is disabled at the type level, so no new top-level fields will be added dynamically.
</para>
</callout>
<callout arearefs="CO201-2">
<para>
The <literal>user</literal> object inherits the type-level setting.
</para>
</callout>
<callout arearefs="CO201-3">
<para>
The <literal>user.social_networks</literal> object enables dynamic mapping, so new fields may be added to this inner object.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>dynamic</literal> setting is allowed to have different settings for fields of
the same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
<section id="enabled">
<title><literal>enabled</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/enabled.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch tries to index all of the fields you give it, but sometimes you
want to just store the field without indexing it.  For instance, imagine that
you are using Elasticsearch as a web session store.  You may want to index the
session ID and last update time, but you don&#8217;t need to query or run
aggregations on the session data itself.</simpara>
<simpara>The <literal>enabled</literal> setting, which can be applied only to the mapping type and to
<link linkend="object"><literal>object</literal></link> fields, causes Elasticsearch to skip parsing of the
contents of the field entirely.  The JSON can still be retrieved from the
<link linkend="mapping-source-field"><literal>_source</literal></link> field, but it is not searchable or stored
in any other way:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "session": {
      "properties": {
        "user_id": {
          "type":  "string",
          "index": "not_analyzed"
        },
        "last_updated": {
          "type": "date"
        },
        "session_data": { <co id="CO202-1"/>
          "enabled": false
        }
      }
    }
  }
}

PUT my_index/session/session_1
{
  "user_id": "kimchy",
  "session_data": { <co id="CO202-2"/>
    "arbitrary_object": {
      "some_array": [ "foo", "bar", { "baz": 2 } ]
    }
  },
  "last_updated": "2015-12-06T18:20:22"
}

PUT my_index/session/session_2
{
  "user_id": "jpountz",
  "session_data": "none", <co id="CO202-3"/>
  "last_updated": "2015-12-06T18:22:13"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO202-1">
<para>
The <literal>session_data</literal> field is disabled.
</para>
</callout>
<callout arearefs="CO202-2">
<para>
Any arbitrary data can be passed to the <literal>session_data</literal> field as it will be entirely ignored.
</para>
</callout>
<callout arearefs="CO202-3">
<para>
The <literal>session_data</literal> will also ignore values that are not JSON objects.
</para>
</callout>
</calloutlist>
<simpara>The entire mapping type may be disabled as well, in which case the document is
stored in the <link linkend="mapping-source-field"><literal>_source</literal></link> field, which means it can be
retrieved, but none of its contents are indexed in any way:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "session": { <co id="CO203-1"/>
      "enabled": false
    }
  }
}

PUT my_index/session/session_1
{
  "user_id": "kimchy",
  "session_data": {
    "arbitrary_object": {
      "some_array": [ "foo", "bar", { "baz": 2 } ]
    }
  },
  "last_updated": "2015-12-06T18:20:22"
}

GET my_index/session/session_1 <co id="CO203-2"/>

GET my_index/_mapping <co id="CO203-3"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO203-1">
<para>
The entire <literal>session</literal> mapping type is disabled.
</para>
</callout>
<callout arearefs="CO203-2">
<para>
The document can be retrieved.
</para>
</callout>
<callout arearefs="CO203-3">
<para>
Checking the mapping reveals that no fields have been added.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>enabled</literal> setting is allowed to have different settings for fields of
the same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
<section id="fielddata">
<title><literal>fielddata</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/fielddata.asciidoc">Edit me</ulink></title>
<simpara>Most fields are <link linkend="mapping-index">indexed</link> by default, which makes them
searchable. The inverted index allows queries to look up the search term in
unique sorted list of terms, and from that immediately have access to the list
of documents that contain the term.</simpara>
<simpara>Sorting, aggregations, and access to field values in scripts requires a
different data access pattern.  Instead of lookup up the term and finding
documents, we need to be able to look up the document and find the terms that
it has in a field.</simpara>
<simpara>Most fields can use index-time, on-disk <link linkend="doc-values"><literal>doc_values</literal></link> to support
this type of data access pattern, but <literal>analyzed</literal> string fields do not support
<literal>doc_values</literal>.</simpara>
<simpara>Instead, <literal>analyzed</literal> strings use a query-time data structure called
<literal>fielddata</literal>.  This data structure is built on demand the first time that a
field is used for aggregations, sorting, or is accessed in a script.  It is built
by reading the entire inverted index for each segment from disk, inverting the
term ↔︎ document relationship, and storing the result in memory, in the
JVM heap.</simpara>
<simpara>Loading fielddata is an expensive process so, once it has been loaded, it
remains in memory for the lifetime of the segment.</simpara>
<warning>
<title>Fielddata can fill up your heap space</title>
<simpara>Fielddata can consume a lot of heap space, especially when loading high
cardinality <literal>analyzed</literal> string fields.  Most of the time, it doesn&#8217;t make sense
to sort or aggregate on <literal>analyzed</literal> string fields (with the notable exception
of the
<link linkend="search-aggregations-bucket-significantterms-aggregation"><literal>significant_terms</literal></link>
aggregation).  Always think about whether a <literal>not_analyzed</literal> field (which can
use <literal>doc_values</literal>) would be  a better fit for your use case.</simpara>
</warning>
<tip><simpara>The <literal>fielddata.*</literal> settings must have the same settings for fields of the
same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="fielddata-format">
<title><literal>fielddata.format</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/fielddata.asciidoc">Edit me</ulink></title>
<simpara>For <literal>analyzed</literal> string fields, the fielddata <literal>format</literal> controls whether
fielddata should be enabled or not.  It accepts: <literal>disabled</literal> and <literal>paged_bytes</literal>
(enabled, which is the default).  To disable fielddata loading, you can use
the following mapping:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "text": {
          "type": "string",
          "fielddata": {
            "format": "disabled" <co id="CO204-1"/>
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO204-1">
<para>
The <literal>text</literal> field cannot be used for sorting, aggregations, or in scripts.
</para>
</callout>
</calloutlist>
<note>
<title>Fielddata and other datatypes</title>
<simpara>Historically, other field datatypes also used fielddata, but this has been replaced
by index-time, disk-based <link linkend="doc-values"><literal>doc_values</literal></link>.</simpara>
</note>
</section>
<section id="fielddata-loading">
<title><literal>fielddata.loading</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/fielddata.asciidoc">Edit me</ulink></title>
<simpara>This per-field setting controls when fielddata is loaded into memory. It
accepts three options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>lazy</literal>
</simpara>
</entry>
<entry>
<simpara>
    Fielddata is only loaded into memory when it is needed. (default)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>eager</literal>
</simpara>
</entry>
<entry>
<simpara>
    Fielddata is loaded into memory before a new search segment becomes
    visible to search.  This can reduce the latency that a user may experience
    if their search request has to trigger lazy loading from a big segment.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>eager_global_ordinals</literal>
</simpara>
</entry>
<entry>
<simpara>
    Loading fielddata into memory is only part of the work that is required.
    After loading the fielddata for each segment, Elasticsearch builds the
    <xref linkend="global-ordinals"/> data structure to make a list of all unique terms
    across all the segments in a shard.  By default, global ordinals are built
    lazily.  If the field has a very high cardinality, global ordinals may
    take some time to build, in which case you can use eager loading instead.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<sidebar id="global-ordinals">
<title>Global ordinals</title>
<simpara>Global ordinals is a data-structure on top of fielddata and doc values, that
maintains an incremental numbering for each unique term in a lexicographic
order. Each term has a unique number and the number of term <emphasis>A</emphasis> is lower than
the number of term <emphasis>B</emphasis>. Global ordinals are only supported on string fields.</simpara>
<simpara>Fielddata and doc values also have ordinals, which is a unique numbering for all terms
in a particular segment and field. Global ordinals just build on top of this,
by providing a mapping between the segment ordinals and the global ordinals,
the latter being unique across the entire shard.</simpara>
<simpara>Global ordinals are used for features that use segment ordinals, such as
sorting and the terms aggregation, to improve the execution time. A terms
aggregation relies purely on global ordinals to perform the aggregation at the
shard level, then converts global ordinals to the real term only for the final
reduce phase, which combines results from different shards.</simpara>
<simpara>Global ordinals for a specified field are tied to <emphasis>all the segments of a
shard</emphasis>, while fielddata and doc values ordinals are tied to a single segment.
which is different than for field data for a specific field which is tied to a
single segment. For this reason global ordinals need to be entirely rebuilt
whenever a once new segment becomes visible.</simpara>
<simpara>The loading time of global ordinals depends on the number of terms in a field, but in general
it is low, since it source field data has already been loaded. The memory overhead of global
ordinals is a small because it is very efficiently compressed. Eager loading of global ordinals
can move the loading time from the first search request, to the refresh itself.</simpara>
</sidebar>
</section>
<section id="field-data-filtering">
<title><literal>fielddata.filter</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/fielddata.asciidoc">Edit me</ulink></title>
<simpara>Fielddata filtering can be used to reduce the number of terms loaded into
memory, and thus reduce memory usage. Terms can be filtered by <emphasis>frequency</emphasis> or
by <emphasis>regular expression</emphasis>, or a combination of the two:</simpara>
<variablelist>
<varlistentry>
<term>
Filtering by frequency
</term>
<listitem>
<simpara>The frequency filter allows you to only load terms whose document frequency falls
between a <literal>min</literal> and <literal>max</literal> value, which can be expressed an absolute
number (when the number is bigger than 1.0) or as a percentage
(eg <literal>0.01</literal> is <literal>1%</literal> and <literal>1.0</literal> is <literal>100%</literal>). Frequency is calculated
<emphasis role="strong">per segment</emphasis>. Percentages are based on the number of docs which have a
value for the field, as opposed to all docs in the segment.</simpara>
<simpara>Small segments can be excluded completely by specifying the minimum
number of docs that the segment should contain with <literal>min_segment_size</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "tag": {
          "type": "string",
          "fielddata": {
            "filter": {
              "frequency": {
                "min": 0.001,
                "max": 0.1,
                "min_segment_size": 500
              }
            }
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</listitem>
</varlistentry>
<varlistentry>
<term>
Filtering by regex
</term>
<listitem>
<simpara>Terms can also be filtered by regular expression - only values which
match the regular expression are loaded. Note: the regular expression is
applied to each term in the field, not to the whole field value. For
instance, to only load hashtags from a tweet, we can use a regular
expression which matches terms beginning with <literal>#</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "tweet": {
          "type": "string",
          "analyzer": "whitespace",
          "fielddata": {
            "filter": {
              "regex": {
                "pattern": "^#.*"
              }
            }
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</listitem>
</varlistentry>
</variablelist>
<simpara>These filters can be updated on an existing field mapping and will take
effect the next time the fielddata for a segment is loaded. Use the
<link linkend="indices-clearcache">Clear Cache</link> API
to reload the fielddata using the new filters.</simpara>
</section>
</section>
<section id="mapping-date-format">
<title><literal>format</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/format.asciidoc">Edit me</ulink></title>
<simpara>In JSON documents, dates are represented as strings. Elasticsearch uses a set
of preconfigured formats to recognize and parse these strings into a long
value representing <emphasis>milliseconds-since-the-epoch</emphasis> in UTC.</simpara>
<simpara>Besides the <link linkend="built-in-date-formats">built-in formats</link>, your own
<link linkend="custom-date-formats">custom formats</link> can be specified using the familiar
<literal>yyyy/MM/dd</literal> syntax:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "date": {
          "type":   "date",
          "format": "yyyy-MM-dd"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Many APIs which support date values also support <link linkend="date-math">date math</link>
expressions, such as <literal>now-1m/d</literal>&#8201;&#8212;&#8201;the current time, minus one month, rounded
down to the nearest day.</simpara>
<tip><simpara>The <literal>format</literal> setting must have the same setting for fields of the same
name in the same index.  Its value can be updated on existing fields using the
<link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="custom-date-formats">
<title>Custom date formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/format.asciidoc">Edit me</ulink></title>
<simpara>Completely customizable date formats are supported.  The syntax for these is explained
<ulink url="http://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html">in the Joda docs</ulink>.</simpara>
</section>
<section id="built-in-date-formats">
<title>Built In Formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/format.asciidoc">Edit me</ulink></title>
<simpara>Most of the below dates have a <literal>strict</literal> companion dates, which means, that
year, month and day parts of the week must have prepending zeros in order
to be valid. This means, that a date like <literal>5/11/1</literal> would not be valid, but
you would need to specify the full date, which would be <literal>2005/11/01</literal> in this
example. So instead of <literal>date_optional_time</literal> you would need to specify
<literal>strict_date_optional_time</literal>.</simpara>
<simpara>The following tables lists all the defaults ISO formats supported:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>epoch_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for the number of milliseconds since the epoch. Note, that
    this timestamp allows a max length of 13 chars, so only dates between 1653
    and 2286 are supported. You should use a different date formatter in
    that case.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>epoch_second</literal>
</term>
<listitem>
<simpara>
    A formatter for the number of seconds since the epoch. Note, that this
    timestamp allows a max length of 10 chars, so only dates between 1653 and
    2286 are supported. You should use a different date formatter in that
    case.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="strict-date-time" xreflabel="[strict-date-time]"/><literal>date_optional_time</literal> or <literal>strict_date_optional_time</literal>
</term>
<listitem>
<simpara>
    A generic ISO datetime parser where the date is mandatory and the time is
    optional.
    <ulink url="http://www.joda.org/joda-time/apidocs/org/joda/time/format/ISODateTimeFormat.html#dateOptionalTimeParser--">Full details here</ulink>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_date</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a full date as four digit year, two digit month of
    year, and two digit day of month: <literal>yyyyMMdd</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_date_time</literal>
</term>
<listitem>
<simpara>
    A basic formatter that combines a basic date and time, separated by a <emphasis>T</emphasis>:
    <literal>yyyyMMdd'T'HHmmss.SSSZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A basic formatter that combines a basic date and time without millis,
    separated by a <emphasis>T</emphasis>: <literal>yyyyMMdd'T'HHmmssZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_ordinal_date</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date, using a four digit year and three
    digit dayOfYear: <literal>yyyyDDD</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_ordinal_date_time</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date and time, using a four digit year and
    three digit dayOfYear: <literal>yyyyDDD'T'HHmmss.SSSZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_ordinal_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date and time without millis, using a four
    digit year and three digit dayOfYear: <literal>yyyyDDD'T'HHmmssZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_time</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a two digit hour of day, two digit minute of hour,
    two digit second of minute, three digit millis, and time zone offset:
    <literal>HHmmss.SSSZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a two digit hour of day, two digit minute of hour,
    two digit second of minute, and time zone offset: <literal>HHmmssZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_t_time</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a two digit hour of day, two digit minute of hour,
    two digit second of minute, three digit millis, and time zone off set
    prefixed by <emphasis>T</emphasis>: <literal>'T'HHmmss.SSSZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_t_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a two digit hour of day, two digit minute of hour,
    two digit second of minute, and time zone offset prefixed by <emphasis>T</emphasis>:
    <literal>'T'HHmmssZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_week_date</literal> or <literal>strict_basic_week_date</literal>
</term>
<listitem>
<simpara>
    A basic formatter for a full date as four digit weekyear, two digit week
    of weekyear, and one digit day of week: <literal>xxxx'W'wwe</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_week_date_time</literal> or <literal>strict_basic_week_date_time</literal>
</term>
<listitem>
<simpara>
    A basic formatter that combines a basic weekyear date and time, separated
    by a <emphasis>T</emphasis>: <literal>xxxx'W'wwe'T'HHmmss.SSSZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>basic_week_date_time_no_millis</literal> or <literal>strict_basic_week_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A basic formatter that combines a basic weekyear date and time without
    millis, separated by a <emphasis>T</emphasis>: <literal>xxxx'W'wwe'T'HHmmssZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date</literal> or <literal>strict_date</literal>
</term>
<listitem>
<simpara>
    A formatter for a full date as four digit year, two digit month of year,
    and two digit day of month: <literal>yyyy-MM-dd</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_hour</literal> or <literal>strict_date_hour</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date and two digit hour of day.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_hour_minute</literal> or <literal>strict_date_hour_minute</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date, two digit hour of day, and two
    digit minute of hour.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_hour_minute_second</literal> or <literal>strict_date_hour_minute_second</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date, two digit hour of day, two digit
    minute of hour, and two digit second of minute.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_hour_minute_second_fraction</literal> or <literal>strict_date_hour_minute_second_fraction</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date, two digit hour of day, two digit
    minute of hour, two digit second of minute, and three digit fraction of
    second: <literal>yyyy-MM-dd'T'HH:mm:ss.SSS</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_hour_minute_second_millis</literal> or <literal>strict_date_hour_minute_second_millis</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date, two digit hour of day, two digit
    minute of hour, two digit second of minute, and three digit fraction of
    second: <literal>yyyy-MM-dd'T'HH:mm:ss.SSS</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_time</literal> or <literal>strict_date_time</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date and time, separated by a <emphasis>T</emphasis>:
    <literal>yyyy-MM-dd'T'HH:mm:ss.SSSZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>date_time_no_millis</literal> or <literal>strict_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full date and time without millis, separated
    by a <emphasis>T</emphasis>: <literal>yyyy-MM-dd'T'HH:mm:ssZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>hour</literal> or <literal>strict_hour</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>hour_minute</literal> or <literal>strict_hour_minute</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day and two digit minute of hour.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>hour_minute_second</literal> or <literal>strict_hour_minute_second</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, and two
    digit second of minute.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>hour_minute_second_fraction</literal> or <literal>strict_hour_minute_second_fraction</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, and three digit fraction of second: <literal>HH:mm:ss.SSS</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>hour_minute_second_millis</literal> or <literal>strict_hour_minute_second_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, and three digit fraction of second: <literal>HH:mm:ss.SSS</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>ordinal_date</literal> or <literal>strict_ordinal_date</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date, using a four digit year and three
    digit dayOfYear: <literal>yyyy-DDD</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>ordinal_date_time</literal> or <literal>strict_ordinal_date_time</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date and time, using a four digit year and
    three digit dayOfYear: <literal>yyyy-DDD'T'HH:mm:ss.SSSZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>ordinal_date_time_no_millis</literal> or <literal>strict_ordinal_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for a full ordinal date and time without millis, using a four
    digit year and three digit dayOfYear: <literal>yyyy-DDD'T'HH:mm:ssZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>time</literal> or <literal>strict_time</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, three digit fraction of second, and time zone
    offset: <literal>HH:mm:ss.SSSZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>time_no_millis</literal> or <literal>strict_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, and time zone offset: <literal>HH:mm:ssZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>t_time</literal> or <literal>strict_t_time</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, three digit fraction of second, and time zone
    offset prefixed by <emphasis>T</emphasis>: <literal>'T'HH:mm:ss.SSSZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>t_time_no_millis</literal> or <literal>strict_t_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter for a two digit hour of day, two digit minute of hour, two
    digit second of minute, and time zone offset prefixed by <emphasis>T</emphasis>: <literal>'T'HH:mm:ssZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>week_date</literal> or <literal>strict_week_date</literal>
</term>
<listitem>
<simpara>
    A formatter for a full date as four digit weekyear, two digit week of
    weekyear, and one digit day of week: <literal>xxxx-'W'ww-e</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>week_date_time</literal> or <literal>strict_week_date_time</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full weekyear date and time, separated by a
    <emphasis>T</emphasis>: <literal>xxxx-'W'ww-e'T'HH:mm:ss.SSSZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>week_date_time_no_millis</literal> or <literal>strict_week_date_time_no_millis</literal>
</term>
<listitem>
<simpara>
    A formatter that combines a full weekyear date and time without millis,
    separated by a <emphasis>T</emphasis>: <literal>xxxx-'W'ww-e'T'HH:mm:ssZZ</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>weekyear</literal> or <literal>strict_weekyear</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit weekyear.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>weekyear_week</literal> or <literal>strict_weekyear_week</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit weekyear and two digit week of weekyear.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>weekyear_week_day</literal> or <literal>strict_weekyear_week_day</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit weekyear, two digit week of weekyear, and one
    digit day of week.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>year</literal> or <literal>strict_year</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit year.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>year_month</literal> or <literal>strict_year_month</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit year and two digit month of year.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>year_month_day</literal> or <literal>strict_year_month_day</literal>
</term>
<listitem>
<simpara>
    A formatter for a four digit year, two digit month of year, and two digit
    day of month.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section id="geohash">
<title><literal>geohash</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/geohash.asciidoc">Edit me</ulink></title>
<simpara>Geohashes are a form of lat/lon encoding which divides the earth up into
a grid. Each cell in this grid is represented by a geohash string. Each
cell in turn can be further subdivided into smaller cells which are
represented by a longer string. So the longer the geohash, the smaller
(and thus more accurate) the cell is.</simpara>
<simpara>Because geohashes are just strings, they can be stored in an inverted
index like any other string, which makes querying them very efficient.</simpara>
<simpara>If you enable the <literal>geohash</literal> option, a <literal>geohash</literal> &#8220;sub-field&#8221; will be indexed
as, eg <literal>.geohash</literal>. The length of the geohash is controlled by the
<link linkend="geohash-precision"><literal>geohash_precision</literal></link> parameter.</simpara>
<simpara>If the <link linkend="geohash-prefix"><literal>geohash_prefix</literal></link> option is enabled, the <literal>geohash</literal>
option will be enabled automatically.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point", <co id="CO205-1"/>
          "geohash": true
        }
      }
    }
  }
}


PUT my_index/my_type/1
{
  "location": {
    "lat": 41.12,
    "lon": -71.34
  }
}

GET my_index/_search?fielddata_fields=location.geohash <co id="CO205-2"/>
{
  "query": {
    "prefix": {
      "location.geohash": "drm3b" <co id="CO205-3"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO205-1">
<para>
A <literal>location.geohash</literal> field will be indexed for each geo-point.
</para>
</callout>
<callout arearefs="CO205-2">
<para>
The geohash can be retrieved with <link linkend="doc-values"><literal>doc_values</literal></link>.
</para>
</callout>
<callout arearefs="CO205-3">
<para>
A <link linkend="query-dsl-prefix-query"><literal>prefix</literal></link> query can find all geohashes which start with a particular prefix.
</para>
</callout>
</calloutlist>
<warning>
<simpara>A <literal>prefix</literal> query on geohashes is expensive.  Instead, consider using the
<link linkend="geohash-prefix"><literal>geohash_prefix</literal></link> to pay the expense once at index time
instead of on every query.</simpara>
</warning>
</section>
<section id="geohash-precision">
<title><literal>geohash_precision</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/geohash-precision.asciidoc">Edit me</ulink></title>
<simpara>Geohashes are a form of lat/lon encoding which divides the earth up into
a grid. Each cell in this grid is represented by a geohash string. Each
cell in turn can be further subdivided into smaller cells which are
represented by a longer string. So the longer the geohash, the smaller
(and thus more accurate) the cell is.</simpara>
<simpara>The <literal>geohash_precision</literal> setting controls the length of the geohash that is
indexed when the <link linkend="geohash"><literal>geohash</literal></link> option is enabled, and the maximum
geohash length when the <link linkend="geohash-prefix"><literal>geohash_prefix</literal></link> option is enabled.</simpara>
<simpara>It accepts:</simpara>
<itemizedlist>
<listitem>
<simpara>
a number between 1 and 12 (default), which represents the length of the geohash.
</simpara>
</listitem>
<listitem>
<simpara>
a <link linkend="distance-units">distance</link>, e.g. <literal>1km</literal>.
</simpara>
</listitem>
</itemizedlist>
<simpara>If a distance is specified, it will be translated to the smallest
geohash-length that will provide the requested resolution.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point",
          "geohash_prefix": true,
          "geohash_precision": 6 <co id="CO206-1"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "location": {
    "lat": 41.12,
    "lon": -71.34
  }
}

GET my_index/_search?fielddata_fields=location.geohash
{
  "query": {
    "term": {
      "location.geohash": "drm3bt"
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO206-1">
<para>
A <literal>geohash_precision</literal> of 6 equates to geohash cells of approximately 1.26km x 0.6km
</para>
</callout>
</calloutlist>
</section>
<section id="geohash-prefix">
<title><literal>geohash_prefix</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/geohash-prefix.asciidoc">Edit me</ulink></title>
<simpara>Geohashes are a form of lat/lon encoding which divides the earth up into
a grid. Each cell in this grid is represented by a geohash string. Each
cell in turn can be further subdivided into smaller cells which are
represented by a longer string. So the longer the geohash, the smaller
(and thus more accurate) the cell is.</simpara>
<simpara>While the <link linkend="geohash"><literal>geohash</literal></link> option enables indexing the geohash that
corresponds to the lat/lon point, at the specified
<link linkend="geohash-precision">precision</link>, the <literal>geohash_prefix</literal> option will also
index all the enclosing cells as well.</simpara>
<simpara>For instance, a geohash of <literal>drm3btev3e86</literal> will index all of the following
terms: [ <literal>d</literal>, <literal>dr</literal>, <literal>drm</literal>, <literal>drm3</literal>, <literal>drm3b</literal>, <literal>drm3bt</literal>, <literal>drm3bte</literal>, <literal>drm3btev</literal>,
<literal>drm3btev3</literal>, <literal>drm3btev3e</literal>, <literal>drm3btev3e8</literal>, <literal>drm3btev3e86</literal> ].</simpara>
<simpara>The geohash prefixes can be used with the
<link linkend="query-dsl-geohash-cell-query"><literal>geohash_cell</literal> query</link> to find points within a
particular geohash, or its neighbours:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point",
          "geohash_prefix": true,
          "geohash_precision": 6
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "location": {
    "lat": 41.12,
    "lon": -71.34
  }
}

GET my_index/_search?fielddata_fields=location.geohash
{
  "query": {
    "geohash_cell": {
      "location": {
        "lat": 41.02,
        "lon": -71.48
      },
      "precision": 4, <co id="CO207-1"/>
      "neighbors": true <co id="CO207-2"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="ignore-above">
<title><literal>ignore_above</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/ignore-above.asciidoc">Edit me</ulink></title>
<simpara>Strings longer than the <literal>ignore_above</literal> setting will not be processed by the
<link linkend="analyzer">analyzer</link> and will not be indexed. This is mainly useful for
<link linkend="mapping-index"><literal>not_analyzed</literal></link> string fields, which are typically used for
filtering, aggregations, and sorting.  These are structured fields and it
doesn&#8217;t usually make sense to allow very long terms to be indexed in these
fields.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "message": {
          "type": "string",
          "index": "not_analyzed",
          "ignore_above": 20 <co id="CO207-3"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1 <co id="CO207-4"/>
{
  "message": "Syntax error"
}

PUT my_index/my_type/2 <co id="CO207-5"/>
{
  "message": "Syntax error with some long stacktrace"
}

GET _search <co id="CO207-6"/>
{
  "aggs": {
    "messages": {
      "terms": {
        "field": "message"
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO207-1 CO207-2 CO207-3">
<para>
This field will ignore any string longer than 20 characters.
</para>
</callout>
<callout arearefs="CO207-4">
<para>
This document is indexed successfully.
</para>
</callout>
<callout arearefs="CO207-5">
<para>
This document will be indexed, but without indexing the <literal>message</literal> field.
</para>
</callout>
<callout arearefs="CO207-6">
<para>
Search returns both documents, but only the first is present in the terms aggregation.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>ignore_above</literal> setting is allowed to have different settings for
fields of the same name in the same index.  Its value can be updated on
existing fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<simpara>This option is also useful for protecting against Lucene&#8217;s term byte-length
limit of <literal>32766</literal>.</simpara>
<note><simpara>The value for <literal>ignore_above</literal> is the <emphasis>character count</emphasis>, but Lucene counts
bytes. If you use UTF-8 text with many non-ASCII characters, you may want to
set the limit to <literal>32766 / 3 = 10922</literal> since UTF-8 characters may occupy at most
3 bytes.</simpara></note>
</section>
<section id="ignore-malformed">
<title><literal>ignore_malformed</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/ignore-malformed.asciidoc">Edit me</ulink></title>
<simpara>Sometimes you don&#8217;t have much control over the data that you receive.  One
user may send a <literal>login</literal> field that is a <link linkend="date"><literal>date</literal></link>, and another sends a
<literal>login</literal> field that is an email address.</simpara>
<simpara>Trying to index the wrong datatype into a field throws an exception by
default, and rejects the whole document.  The <literal>ignore_malformed</literal> parameter, if
set to <literal>true</literal>, allows the exception to be ignored.  The malformed field is not
indexed, but other fields in the document are processed normally.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "number_one": {
          "type": "integer"
        },
        "number_two": {
          "type": "integer",
          "ignore_malformed": true
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "text":       "Some text value",
  "number_one": "foo" <co id="CO208-1"/>
}

PUT my_index/my_type/2
{
  "text":       "Some text value",
  "number_two": "foo" <co id="CO208-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO208-1">
<para>
This document will be rejected because <literal>number_one</literal> does not allow malformed values.
</para>
</callout>
<callout arearefs="CO208-2">
<para>
This document will have the <literal>text</literal> field indexed, but not the <literal>number_two</literal> field.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>ignore_malformed</literal> setting is allowed to have different settings for
fields of the same name in the same index.  Its value can be updated on
existing fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="ignore-malformed-setting">
<title>Index-level default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/ignore-malformed.asciidoc">Edit me</ulink></title>
<simpara>The <literal>index.mapping.ignore_malformed</literal> setting can be set on the index level to
allow to ignore malformed content globally across all mapping types.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "index.mapping.ignore_malformed": true <co id="CO209-1"/>
  },
  "mappings": {
    "my_type": {
      "properties": {
        "number_one": { <co id="CO209-2"/>
          "type": "byte"
        },
        "number_two": {
          "type": "integer",
          "ignore_malformed": false <co id="CO209-3"/>
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO209-1 CO209-2">
<para>
The <literal>number_one</literal> field inherits the index-level setting.
</para>
</callout>
<callout arearefs="CO209-3">
<para>
The <literal>number_two</literal> field overrides the index-level setting to turn off <literal>ignore_malformed</literal>.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="include-in-all">
<title><literal>include_in_all</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/include-in-all.asciidoc">Edit me</ulink></title>
<simpara>The <literal>include_in_all</literal> parameter provides per-field control over which fields
are included in the <link linkend="mapping-all-field"><literal>_all</literal></link> field.  It defaults to <literal>true</literal>, unless <link linkend="mapping-index"><literal>index</literal></link> is set to <literal>no</literal>.</simpara>
<simpara>This example demonstrates how to exclude the <literal>date</literal> field from the <literal>_all</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "title": { <co id="CO210-1"/>
          "type": "string"
        }
        "content": { <co id="CO210-2"/>
          "type": "string"
        },
        "date": { <co id="CO210-3"/>
          "type": "date",
          "include_in_all": false
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO210-1 CO210-2">
<para>
The <literal>title</literal> and <literal>content</literal> fields will be included in the <literal>_all</literal> field.
</para>
</callout>
<callout arearefs="CO210-3">
<para>
The <literal>date</literal> field will not be included in the <literal>_all</literal> field.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>include_in_all</literal> setting is allowed to have different settings for
fields of the same name in the same index.  Its value can be updated on
existing fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<simpara>The <literal>include_in_all</literal> parameter can also be set at the type level and on
<link linkend="object"><literal>object</literal></link> or <link linkend="nested"><literal>nested</literal></link> fields, in which case all sub-
fields inherit that setting.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "include_in_all": false, <co id="CO211-1"/>
      "properties": {
        "title":          { "type": "string" },
        "author": {
          "include_in_all": true, <co id="CO211-2"/>
          "properties": {
            "first_name": { "type": "string" },
            "last_name":  { "type": "string" }
          }
        },
        "editor": {
          "properties": {
            "first_name": { "type": "string" }, <co id="CO211-3"/>
            "last_name":  { "type": "string", "include_in_all": true } <co id="CO211-4"/>
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO211-1">
<para>
All fields in <literal>my_type</literal> are excluded from <literal>_all</literal>.
</para>
</callout>
<callout arearefs="CO211-2">
<para>
The <literal>author.first_name</literal> and <literal>author.last_name</literal> fields are included in <literal>_all</literal>.
</para>
</callout>
<callout arearefs="CO211-3 CO211-4">
<para>
Only the <literal>editor.last_name</literal> field is included in <literal>_all</literal>.
    The <literal>editor.first_name</literal> inherits the type-level setting and is excluded.
</para>
</callout>
</calloutlist>
<note>
<title>Multi-fields and <literal>include_in_all</literal></title>
<simpara>The original field value is added to the <literal>_all</literal> field, not the terms produced
by a field&#8217;s analyzer.  For this reason, it makes no sense to set
<literal>include_in_all</literal> to <literal>true</literal> on <link linkend="multi-fields">multi-fields</link>, as each
multi-field has exactly the same value as its parent.</simpara>
</note>
</section>
<section id="mapping-index">
<title><literal>index</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/index.asciidoc">Edit me</ulink></title>
<simpara>The <literal>index</literal> option controls how field values are indexed and, thus, how they
are searchable.  It accepts three values:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>no</literal>
</simpara>
</entry>
<entry>
<simpara>
    Do not add this field value to the index. With this setting, the field
    will not be queryable.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>not_analyzed</literal>
</simpara>
</entry>
<entry>
<simpara>
    Add the field value to the index unchanged, as a single term.  This is the
    default for all fields that support this option except for
    <link linkend="string"><literal>string</literal></link> fields.  <literal>not_analyzed</literal> fields are usually used with
    <link linkend="term-level-queries">term-level queries</link> for structured search.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>analyzed</literal>
</simpara>
</entry>
<entry>
<simpara>
    This option applies only to <literal>string</literal> fields, for which it is the default.
    The string field value is first <link linkend="analysis">analyzed</link> to convert the
    string into terms (e.g. a list of individual words), which are then
    indexed.  At search time, the query string is passed through
    (<link linkend="search-analyzer">usually</link>) the same analyzer to generate terms
    in the same format as those in the index.  It is this process that enables
    <link linkend="full-text-queries">full text search</link>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>For example, you can create a <literal>not_analyzed</literal> string field with the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "status_code": {
          "type": "string",
          "index": "not_analyzed"
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="index-options">
<title><literal>index_options</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/index-options.asciidoc">Edit me</ulink></title>
<simpara>The <literal>index_options</literal> parameter controls what information is added to the
inverted index, for search and highlighting purposes.  It accepts the
following settings:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>docs</literal>
</simpara>
</entry>
<entry>
<simpara>
    Only the doc number is indexed.  Can answer the question <emphasis>Does this term
    exist in this field?</emphasis>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>freqs</literal>
</simpara>
</entry>
<entry>
<simpara>
    Doc number and term frequencies are indexed.  Term frequencies are used to
    score repeated terms higher than single terms.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>positions</literal>
</simpara>
</entry>
<entry>
<simpara>
    Doc number, term frequencies, and term positions (or order) are indexed.
    Positions can be used for
    <link linkend="query-dsl-match-query-phrase">proximity or phrase queries</link>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>offsets</literal>
</simpara>
</entry>
<entry>
<simpara>
    Doc number, term frequencies, positions, and start and end character
    offsets (which map the term back to the original string) are indexed.
    Offsets are used by the <link linkend="postings-highlighter">postings highlighter</link>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara><link linkend="mapping-index">Analyzed</link> string fields use <literal>positions</literal> as the default, and
all other fields use <literal>docs</literal> as the default.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "text": {
          "type": "string",
          "index_options": "offsets"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "text": "Quick brown fox"
}

GET my_index/_search
{
  "query": {
    "match": {
      "text": "brown fox"
    }
  },
  "highlight": {
    "fields": {
      "text": {} <co id="CO212-1"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO212-1">
<para>
The <literal>text</literal> field will use the postings highlighter by default because <literal>offsets</literal> are indexed.
</para>
</callout>
</calloutlist>
</section>
<section id="lat-lon">
<title><literal>lat_lon</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/lat-lon.asciidoc">Edit me</ulink></title>
<simpara><link linkend="geo-queries">Geo-queries</link> are usually performed by plugging the value of
each <link linkend="geo-point"><literal>geo_point</literal></link> field into a formula to determine whether it
falls into the required area or not. Unlike most queries, the inverted index
is not involved.</simpara>
<simpara>Setting <literal>lat_lon</literal> to <literal>true</literal> causes the latitude and longitude values to be
indexed as numeric fields (called <literal>.lat</literal> and <literal>.lon</literal>). These fields can be used
by the <link linkend="query-dsl-geo-bounding-box-query"><literal>geo_bounding_box</literal></link> and
<link linkend="query-dsl-geo-distance-query"><literal>geo_distance</literal></link> queries instead of
performing in-memory calculations.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "location": {
          "type": "geo_point",
          "lat_lon": true <co id="CO213-1"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "location": {
    "lat": 41.12,
    "lon": -71.34
  }
}


GET my_index/_search
{
  "query": {
    "geo_distance": {
      "location": {
        "lat": 41,
        "lon": -71
      },
      "distance": "50km",
      "optimize_bbox": "indexed" <co id="CO213-2"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO213-1">
<para>
Setting <literal>lat_lon</literal> to true indexes the geo-point in the <literal>location.lat</literal> and <literal>location.lon</literal> fields.
</para>
</callout>
<callout arearefs="CO213-2">
<para>
The <literal>indexed</literal> option tells the geo-distance query to use the inverted index instead of the in-memory calculation.
</para>
</callout>
</calloutlist>
<simpara>Whether the in-memory or indexed operation performs better depends both on
your dataset and on the types of queries that you are running.</simpara>
<note><simpara>The <literal>lat_lon</literal> option only makes sense for single-value <literal>geo_point</literal>
fields. It will not work with arrays of geo-points.</simpara></note>
</section>
<section id="multi-fields">
<title><literal>fields</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/multi-fields.asciidoc">Edit me</ulink></title>
<simpara>It is often useful to index the same field in different ways for different
purposes.  This is the purpose of <emphasis>multi-fields</emphasis>. For instance, a <literal>string</literal>
field could be <link linkend="mapping-index">indexed</link> as an <literal>analyzed</literal> field for full-text
search, and as a <literal>not_analyzed</literal> field for sorting or aggregations:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "city": {
          "type": "string",
          "fields": {
            "raw": { <co id="CO214-1"/>
              "type":  "string",
              "index": "not_analyzed"
            }
          }
        }
      }
    }
  }
}

PUT /my_index/my_type/1
{
  "city": "New York"
}

PUT /my_index/my_type/2
{
  "city": "York"
}

GET /my_index/_search
{
  "query": {
    "match": {
      "city": "york" <co id="CO214-2"/>
    }
  },
  "sort": {
    "city.raw": "asc" <co id="CO214-3"/>
  },
  "aggs": {
    "Cities": {
      "terms": {
        "field": "city.raw" <co id="CO214-4"/>
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO214-1">
<para>
The <literal>city.raw</literal> field is a <literal>not_analyzed</literal> version of the <literal>city</literal> field.
</para>
</callout>
<callout arearefs="CO214-2">
<para>
The analyzed <literal>city</literal> field can be used for full text search.
</para>
</callout>
<callout arearefs="CO214-3 CO214-4">
<para>
The <literal>city.raw</literal> field can be used for sorting and aggregations
</para>
</callout>
</calloutlist>
<note><simpara>Multi-fields do not change the original <literal>_source</literal> field.</simpara></note>
<tip><simpara>The <literal>fields</literal> setting is allowed to have different settings for fields of
the same name in the same index.  New multi-fields can be added to existing
fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="_multi_fields_with_multiple_analyzers">
<title>Multi-fields with multiple analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/multi-fields.asciidoc">Edit me</ulink></title>
<simpara>Another use case of multi-fields is to analyze the same field in different
ways for better relevance. For instance we could index a field with the
<link linkend="analysis-standard-analyzer"><literal>standard</literal> analyzer</link> which breaks text up into
words, and again with the <link linkend="english-analyzer"><literal>english</literal> analyzer</link>
which stems words into their root form:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "text": { <co id="CO215-1"/>
          "type": "string",
          "fields": {
            "english": { <co id="CO215-2"/>
              "type":     "string",
              "analyzer": "english"
            }
          }
        }
      }
    }
  }
}

PUT my_index/my_type/1
{ "text": "quick brown fox" } <co id="CO215-3"/>

PUT my_index/my_type/2
{ "text": "quick brown foxes" } <co id="CO215-4"/>

GET my_index/_search
{
  "query": {
    "multi_match": {
      "query": "quick brown foxes",
      "fields": [ <co id="CO215-5"/>
        "text",
        "text.english"
      ],
      "type": "most_fields" <co id="CO215-6"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO215-1">
<para>
The <literal>text</literal> field uses the <literal>standard</literal> analyzer.
</para>
</callout>
<callout arearefs="CO215-2">
<para>
The <literal>text.english</literal> field uses the <literal>english</literal> analyzer.
</para>
</callout>
<callout arearefs="CO215-3 CO215-4">
<para>
Index two documents, one with <literal>fox</literal> and the other with <literal>foxes</literal>.
</para>
</callout>
<callout arearefs="CO215-5 CO215-6">
<para>
Query both the <literal>text</literal> and <literal>text.english</literal> fields and combine the scores.
</para>
</callout>
</calloutlist>
<simpara>The <literal>text</literal> field contains the term <literal>fox</literal> in the first document and <literal>foxes</literal> in
the second document.  The <literal>text.english</literal> field contains <literal>fox</literal> for both
documents, because <literal>foxes</literal> is stemmed to <literal>fox</literal>.</simpara>
<simpara>The query string is also analyzed by the <literal>standard</literal> analyzer for the <literal>text</literal>
field, and by the <literal>english</literal> analyzer` for the <literal>text.english</literal> field.  The
stemmed field allows a query for <literal>foxes</literal> to also match the document containing
just <literal>fox</literal>.  This allows us to match as many documents as possible.  By also
querying the unstemmed <literal>text</literal> field, we improve the relevance score of the
document which matches <literal>foxes</literal> exactly.</simpara>
</section>
</section>
<section id="norms">
<title><literal>norms</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/norms.asciidoc">Edit me</ulink></title>
<simpara>Norms store various normalization factors&#8201;&#8212;&#8201;a number to represent the
relative field length and the <link linkend="index-boost">index time <literal>boost</literal></link> setting&#8201;&#8212;&#8201;that are later used at query time in order to compute the score of a document
relatively to a query.</simpara>
<simpara>Although useful for scoring, norms also require quite a lot of memory
(typically in the order of one byte per document per field in your index, even
for documents that don&#8217;t have this specific field). As a consequence, if you
don&#8217;t need scoring on a specific field, you should disable norms on that
field. In  particular, this is the case for fields that are used solely for
filtering or aggregations.</simpara>
<tip><simpara>The <literal>norms.enabled</literal> setting must have the same setting for fields of the
same name in the same index.  Norms can be disabled on existing fields using
the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<simpara>Norms can be disabled (but not reenabled) after the fact, using the
<link linkend="indices-put-mapping">PUT mapping API</link> like so:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/_mapping/my_type
{
  "properties": {
    "title": {
      "type": "string",
      "norms": {
        "enabled": false
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<note><simpara>Norms will not be removed instantly, but will be removed as old segments
are merged into new segments as you continue indexing new documents. Any score
computation on a field that has had norms removed might return inconsistent
results since some documents won&#8217;t have norms anymore while other documents
might still have norms.</simpara></note>
<section id="_lazy_loading_of_norms">
<title>Lazy loading of norms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/norms.asciidoc">Edit me</ulink></title>
<simpara>Norms can be loaded into memory eagerly (<literal>eager</literal>), whenever a new segment
comes online, or they can loaded lazily (<literal>lazy</literal>, default), only when the field
is queried.</simpara>
<simpara>Eager loading can be configured as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/_mapping/my_type
{
  "properties": {
    "title": {
      "type": "string",
      "norms": {
        "loading": "eager"
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<tip><simpara>The <literal>norms.loading</literal> setting must have the same setting for fields of the
same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
</section>
<section id="null-value">
<title><literal>null_value</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/null-value.asciidoc">Edit me</ulink></title>
<simpara>A <literal>null</literal> value cannot be indexed or searched.  When a field is set to <literal>null</literal>,
(or an empty array or an array of <literal>null</literal> values)  it is treated as though that
field has no values.</simpara>
<simpara>The <literal>null_value</literal> parameter allows you to replace explicit <literal>null</literal> values with
the specified value so that it can be indexed and searched.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "status_code": {
          "type":       "string",
          "index":      "not_analyzed",
          "null_value": "NULL" <co id="CO216-1"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "status_code": null
}

PUT my_index/my_type/2
{
  "status_code": [] <co id="CO216-2"/>
}

GET my_index/_search
{
  "query": {
    "term": {
      "status_code": "NULL" <co id="CO216-3"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO216-1">
<para>
Replace explicit <literal>null</literal> values with the term <literal>NULL</literal>.
</para>
</callout>
<callout arearefs="CO216-2">
<para>
An empty array does not contain an explicit <literal>null</literal>, and so won&#8217;t be replaced with the <literal>null_value</literal>.
</para>
</callout>
<callout arearefs="CO216-3">
<para>
A query for <literal>NULL</literal> returns document 1, but not document 2.
</para>
</callout>
</calloutlist>
<important><simpara>The <literal>null_value</literal> needs to be the same datatype as the field.  For
instance, a <literal>long</literal> field cannot have a string <literal>null_value</literal>.  String fields
which are <literal>analyzed</literal> will also pass the <literal>null_value</literal> through the configured
analyzer.</simpara></important>
<simpara>Also see the <link linkend="query-dsl-missing-query"><literal>missing</literal> query</link> for its <literal>null_value</literal> support.</simpara>
</section>
<section id="position-increment-gap">
<title><literal>position_increment_gap</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/position-increment-gap.asciidoc">Edit me</ulink></title>
<simpara><link linkend="mapping-index">Analyzed</link> string fields take term <link linkend="index-options">positions</link>
into account, in order to be able to support
<link linkend="query-dsl-match-query-phrase">proximity or phrase queries</link>.
When indexing string fields with multiple values a "fake" gap is added between
the values to prevent most phrase queries from matching across the values. The
size of this gap is configured using <literal>position_increment_gap</literal> and defaults to
<literal>100</literal>.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index/groups/1
{
    "names": [ "John Abraham", "Lincoln Smith"]
}

GET /my_index/groups/_search
{
    "query": {
        "match_phrase": {
            "names": "Abraham Lincoln" <co id="CO217-1"/>
        }
    }
}

GET /my_index/groups/_search
{
    "query": {
        "match_phrase": {
            "names": "Abraham Lincoln",
            "slop": 101 <co id="CO217-2"/>
        }
    }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO217-1">
<para>
This phrase query doesn&#8217;t match our document which is totally expected.
</para>
</callout>
<callout arearefs="CO217-2">
<para>
This phrase query matches our document, even though <literal>Abraham</literal> and <literal>Lincoln</literal>
    are in separate strings, because <literal>slop</literal> &gt; <literal>position_increment_gap</literal>.
</para>
</callout>
</calloutlist>
<simpara>The <literal>position_increment_gap</literal> can be specified in the mapping.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "names": {
          "type": "string",
          "position_increment_gap": 0 <co id="CO218-1"/>
        }
      }
    }
  }
}

PUT /my_index/groups/1
{
    "names": [ "John Abraham", "Lincoln Smith"]
}

GET /my_index/groups/_search
{
    "query": {
        "match_phrase": {
            "names": "Abraham Lincoln" <co id="CO218-2"/>
        }
    }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO218-1">
<para>
The first term in the next array element will be 0 terms apart from the
    last term in the previous array element.
</para>
</callout>
<callout arearefs="CO218-2">
<para>
The phrase query matches our document which is weird, but its what we asked
    for in the mapping.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>position_increment_gap</literal> setting is allowed to have different settings
for fields of the same name in the same index.  Its value can be updated on
existing fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
<section id="precision-step">
<title><literal>precision_step</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/precision-step.asciidoc">Edit me</ulink></title>
<simpara>Most <link linkend="number">numeric</link> datatypes index extra terms representing numeric
ranges for each number to make <link linkend="query-dsl-range-query"><literal>range</literal> queries</link>
faster.  For instance, this <literal>range</literal> query:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "range": {
    "number": {
      "gte": 0
      "lte": 321
    }
  }</programlisting>
<simpara>might be executed internally as a <link linkend="query-dsl-terms-query"><literal>terms</literal> query</link> that
looks something like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "terms": {
    "number": [
      "0-255",
      "256-319"
      "320",
      "321"
    ]
  }</programlisting>
<simpara>These extra terms greatly reduce the number of terms that have to be examined,
at the cost of increased disk space.</simpara>
<simpara>The default value for <literal>precision_step</literal> depends on the <literal>type</literal> of the numeric field:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>long</literal>, <literal>double</literal>, <literal>date</literal>, <literal>ip</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>16</literal> (3 extra terms)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>integer</literal>, <literal>float</literal>, <literal>short</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>8</literal> (3 extra terms)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>byte</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>2147483647</literal> (0 extra terms)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>token_count</literal>
</simpara>
</entry>
<entry>
<simpara>
<literal>32</literal> (0 extra terms)
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The value of the <literal>precision_step</literal> setting indicates the number of bits that
should be compressed into an extra term.  A <literal>long</literal> value consists of 64 bits,
so a <literal>precision_step</literal> of 16 results in the following terms:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
Bits 0-15
</simpara>
</entry>
<entry>
<simpara>
<literal>value &amp; 1111111111111111 0000000000000000 0000000000000000 0000000000000000</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Bits 0-31
</simpara>
</entry>
<entry>
<simpara>
<literal>value &amp; 1111111111111111 1111111111111111 0000000000000000 0000000000000000</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Bits 0-47
</simpara>
</entry>
<entry>
<simpara>
<literal>value &amp; 1111111111111111 1111111111111111 1111111111111111 0000000000000000</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Bits 0-63
</simpara>
</entry>
<entry>
<simpara>
<literal>value</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="properties">
<title><literal>properties</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/properties.asciidoc">Edit me</ulink></title>
<simpara>Type mappings, <link linkend="object"><literal>object</literal> fields</link> and <link linkend="nested"><literal>nested</literal> fields</link>
contain sub-fields, called <literal>properties</literal>. These properties may be of any
<link linkend="mapping-types">datatype</link>, including <literal>object</literal> and <literal>nested</literal>.  Properties can
be added:</simpara>
<itemizedlist>
<listitem>
<simpara>
explicitly by defining them when <link linkend="indices-create-index">creating an index</link>.
</simpara>
</listitem>
<listitem>
<simpara>
explicitly by defining them when adding or updating a mapping type with the <link linkend="indices-put-mapping">PUT mapping</link> API.
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="dynamic-mapping">dynamically</link> just by indexing documents containing new fields.
</simpara>
</listitem>
</itemizedlist>
<simpara>Below is an example of adding <literal>properties</literal> to a mapping type, an <literal>object</literal>
field, and a <literal>nested</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": { <co id="CO219-1"/>
      "properties": {
        "manager": { <co id="CO219-2"/>
          "properties": {
            "age":  { "type": "integer" },
            "name": { "type": "string"  }
          }
        },
        "employees": { <co id="CO219-3"/>
          "type": "nested",
          "properties": {
            "age":  { "type": "integer" },
            "name": { "type": "string"  }
          }
        }
      }
    }
  }
}

PUT my_index/my_type/1 <co id="CO219-4"/>
{
  "region": "US",
  "manager": {
    "name": "Alice White",
    "age": 30
  },
  "employees": [
    {
      "name": "John Smith",
      "age": 34
    },
    {
      "name": "Peter Brown",
      "age": 26
    }
  ]
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO219-1">
<para>
Properties under the <literal>my_type</literal> mapping type.
</para>
</callout>
<callout arearefs="CO219-2">
<para>
Properties under the <literal>manager</literal> object field.
</para>
</callout>
<callout arearefs="CO219-3">
<para>
Properties under the <literal>employees</literal> nested field.
</para>
</callout>
<callout arearefs="CO219-4">
<para>
An example document which corresponds to the above mapping.
</para>
</callout>
</calloutlist>
<tip><simpara>The <literal>properties</literal> setting is allowed to have different settings for fields
of the same name in the same index.  New properties can be added to existing
fields using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
<section id="_dot_notation">
<title>Dot notation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/properties.asciidoc">Edit me</ulink></title>
<simpara>Inner fields can be referred to in queries, aggregations, etc., using <emphasis>dot
notation</emphasis>:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET my_index/_search
{
  "query": {
    "match": {
      "manager.name": "Alice White" <co id="CO220-1"/>
    }
  },
  "aggs": {
    "Employees": {
      "nested": {
        "path": "employees"
      },
      "aggs": {
        "Employee Ages": {
          "histogram": {
            "field": "employees.age", <co id="CO220-2"/>
            "interval": 5
          }
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<important><simpara>The full path to the inner field must be specified.</simpara></important>
</section>
</section>
<section id="search-analyzer">
<title><literal>search_analyzer</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/search-analyzer.asciidoc">Edit me</ulink></title>
<simpara>Usually, the same <link linkend="analyzer">analyzer</link> should be applied at index time and at
search time, to ensure that the terms in the query are in the same format as
the terms in the inverted index.</simpara>
<simpara>Sometimes, though, it can make sense to use a different analyzer at search
time, such as when using the  <link linkend="analysis-edgengram-tokenizer"><literal>edge_ngram</literal></link>
tokenizer for autocomplete.</simpara>
<simpara>By default, queries will use the <literal>analyzer</literal> defined in the field mapping, but
this can be overridden with the <literal>search_analyzer</literal> setting:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "autocomplete_filter": {
          "type": "edge_ngram",
          "min_gram": 1,
          "max_gram": 20
        }
      },
      "analyzer": {
        "autocomplete": { <co id="CO220-3"/>
          "type": "custom",
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "autocomplete_filter"
          ]
        }
      }
    }
  },
  "mappings": {
    "my_type": {
      "properties": {
        "text": {
          "type": "string",
          "analyzer": "autocomplete", <co id="CO220-4"/>
          "search_analyzer": "standard" <co id="CO220-5"/>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "text": "Quick Brown Fox" <co id="CO220-6"/>
}

GET my_index/_search
{
  "query": {
    "match": {
      "text": {
        "query": "Quick Br", <co id="CO220-7"/>
        "operator": "and"
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO220-1 CO220-3">
<para>
Analysis settings to define the custom <literal>autocomplete</literal> analyzer.
</para>
</callout>
<callout arearefs="CO220-2 CO220-4 CO220-5">
<para>
The <literal>text</literal> field uses the <literal>autocomplete</literal> analyzer at index time, but the <literal>standard</literal> analyzer at search time.
</para>
</callout>
<callout arearefs="CO220-6">
<para>
This field is indexed as the terms: [ <literal>q</literal>, <literal>qu</literal>, <literal>qui</literal>, <literal>quic</literal>, <literal>quick</literal>, <literal>b</literal>, <literal>br</literal>, <literal>bro</literal>, <literal>brow</literal>, <literal>brown</literal>, <literal>f</literal>, <literal>fo</literal>, <literal>fox</literal> ]
</para>
</callout>
<callout arearefs="CO220-7">
<para>
The query searches for both of these terms: [ <literal>quick</literal>, <literal>br</literal> ]
</para>
</callout>
</calloutlist>
<simpara>See <ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/_index_time_search_as_you_type.html">Index time search-as-you-
type</ulink> for a full explanation of this example.</simpara>
<tip><simpara>The <literal>search_analyzer</literal> setting must have the same setting for fields of
the same name in the same index.  Its value can be updated on existing fields
using the <link linkend="indices-put-mapping">PUT mapping API</link>.</simpara></tip>
</section>
<section id="similarity">
<title><literal>similarity</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/similarity.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch allows you to configure a scoring algorithm or <emphasis>similarity</emphasis> per
field. The <literal>similarity</literal> setting provides a simple way of choosing a similarity
algorithm other than the default TF/IDF, such as <literal>BM25</literal>.</simpara>
<simpara>Similarities are mostly useful for <link linkend="string"><literal>string</literal></link> fields, especially
<literal>analyzed</literal> string fields, but can also apply to other field types.</simpara>
<simpara>Custom similarities can be configured by tuning the parameters of the built-in
similarities. For more details about this expert options, see the
<link linkend="index-modules-similarity">similarity module</link>.</simpara>
<simpara>The only similarities which can be used out of the box, without any further
configuration are:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>default</literal>
</term>
<listitem>
<simpara>
        The Default TF/IDF algorithm used by Elasticsearch and
        Lucene. See <ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/practical-scoring-function.html">Lucene’s Practical Scoring Function</ulink>
        for more information.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>BM25</literal>
</term>
<listitem>
<simpara>
        The Okapi BM25 algorithm.
        See <ulink url="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/pluggable-similarites.html">Pluggable Similarity Algorithms</ulink>
        for more information.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The <literal>similarity</literal> can be set on the field level when a field is first created,
as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "default_field": { <co id="CO221-1"/>
          "type": "string"
        },
        "bm25_field": {
          "type": "string",
          "similarity": "BM25" <co id="CO221-2"/>
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO221-1">
<para>
The <literal>default_field</literal> uses the <literal>default</literal> similarity (ie TF/IDF).
</para>
</callout>
<callout arearefs="CO221-2">
<para>
The <literal>bm25_field</literal> uses the <literal>BM25</literal> similarity.
</para>
</callout>
</calloutlist>
</section>
<section id="mapping-store">
<title><literal>store</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/store.asciidoc">Edit me</ulink></title>
<simpara>By default, field values are <link linkend="mapping-index">indexed</link> to make them searchable,
but they are not <emphasis>stored</emphasis>.  This means that the field can be queried, but the
original field value cannot be retrieved.</simpara>
<simpara>Usually this doesn&#8217;t matter.  The field value is already part of the
<link linkend="mapping-source-field"><literal>_source</literal> field</link>, which is stored by default. If you
only want to retrieve the value of a single field or of a few fields, instead
of the whole <literal>_source</literal>, then this can be achieved with
<link linkend="search-request-source-filtering">source filtering</link>.</simpara>
<simpara>In certain situations it can make sense to <literal>store</literal> a field.  For instance, if
you have a document with a <literal>title</literal>, a <literal>date</literal>, and a very large <literal>content</literal>
field, you may want to retrieve just the <literal>title</literal> and the <literal>date</literal> without having
to extract those fields from a large <literal>_source</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "title": {
          "type": "string",
          "store": true <co id="CO222-1"/>
        },
        "date": {
          "type": "date",
          "store": true <co id="CO222-2"/>
        },
        "content": {
          "type": "string"
        }
      }
    }
  }
}

PUT /my_index/my_type/1
{
  "title":   "Some short title",
  "date":    "2015-01-01",
  "content": "A very long content field..."
}

GET my_index/_search
{
  "fields": [ "title", "date" ] <co id="CO222-3"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO222-1 CO222-2">
<para>
The <literal>title</literal> and <literal>date</literal> fields are stored.
</para>
</callout>
<callout arearefs="CO222-3">
<para>
This request will retrieve the values of the <literal>title</literal> and <literal>date</literal> fields.
</para>
</callout>
</calloutlist>
<note>
<title>Stored fields returned as arrays</title>
<simpara>For consistency, stored fields are always returned as an <emphasis>array</emphasis> because there
is no way of knowing if the original field value was a single value, multiple
values, or an empty array.</simpara>
<simpara>If you need the original value, you should retrieve it from the <literal>_source</literal>
field instead.</simpara>
</note>
<simpara>Another situation where it can make sense to make a field stored is for those
that don&#8217;t appear in the <literal>_source</literal> field (such as <link linkend="copy-to"><literal>copy_to</literal> fields</link>).</simpara>
</section>
<section id="term-vector">
<title><literal>term_vector</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/params/term-vector.asciidoc">Edit me</ulink></title>
<simpara>Term vectors contain information about the terms produced by the
<link linkend="analysis">analysis</link> process, including:</simpara>
<itemizedlist>
<listitem>
<simpara>
a list of terms.
</simpara>
</listitem>
<listitem>
<simpara>
the position (or order) of each term.
</simpara>
</listitem>
<listitem>
<simpara>
the start and end character offsets mapping the term to its
  origin in the original string.
</simpara>
</listitem>
</itemizedlist>
<simpara>These term vectors can be stored so that they can be retrieved for a
particular document.</simpara>
<simpara>The <literal>term_vector</literal> setting accepts:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>no</literal>
</simpara>
</entry>
<entry>
<simpara>
No term vectors are stored. (default)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>yes</literal>
</simpara>
</entry>
<entry>
<simpara>
Just the terms in the field are stored.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>with_positions</literal>
</simpara>
</entry>
<entry>
<simpara>
Terms and positions are stored.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>with_offsets</literal>
</simpara>
</entry>
<entry>
<simpara>
Terms and character offsets are stored.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>with_positions_offsets</literal>
</simpara>
</entry>
<entry>
<simpara>
Terms, positions, and character offsets are stored.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The fast vector highlighter requires <literal>with_positions_offsets</literal>.  The term
vectors API can retrieve whatever is stored.</simpara>
<warning><simpara>Setting <literal>with_positions_offsets</literal> will double the size of a field&#8217;s
index.</simpara></warning>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "text": {
          "type":        "string",
          "term_vector": "with_positions_offsets"
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "text": "Quick brown fox"
}

GET my_index/_search
{
  "query": {
    "match": {
      "text": "brown fox"
    }
  },
  "highlight": {
    "fields": {
      "text": {} <co id="CO223-1"/>
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO223-1">
<para>
The fast vector highlighter will be used by default for the <literal>text</literal> field
    because term vectors are enabled.
</para>
</callout>
</calloutlist>
<programlisting language="js" linenumbering="unnumbered"></programlisting>
<remark> AUTOSENSE</remark>
</section>
</chapter>
<chapter id="dynamic-mapping">
<title>Dynamic Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic-mapping.asciidoc">Edit me</ulink></title>
<simpara>One of the most important features of Elasticsearch is that it tries to get
out of your way and let you start exploring your data as quickly as possible.
To index a document, you don&#8217;t have to first create an index, define a mapping
type, and define your fields&#8201;&#8212;&#8201;you can just index a document and the index,
type, and fields will spring to life automatically:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT data/counters/1 <co id="CO224-1"/>
{ "count": 5 }</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO224-1">
<para>
Creates the <literal>data</literal> index, the <literal>counters</literal> mapping type, and a field
    called <literal>count</literal> with datatype <literal>long</literal>.
</para>
</callout>
</calloutlist>
<simpara>The automatic detection and addition of new types and fields is called
<emphasis>dynamic mapping</emphasis>. The dynamic mapping rules can be customised to suit your
purposes with:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="default-mapping"><literal>_default_</literal> mapping</link>
</term>
<listitem>
<simpara>
    Configure the base mapping to be used for new mapping types.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="dynamic-field-mapping">Dynamic field mappings</link>
</term>
<listitem>
<simpara>
    The rules governing dynamic field detection.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="dynamic-templates">Dynamic templates</link>
</term>
<listitem>
<simpara>
    Custom rules to configure the mapping for dynamically added fields.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<tip><simpara><link linkend="indices-templates">Index templates</link> allow you to configure the default
mappings, settings, aliases, and warmers for new indices, whether created
automatically or explicitly.</simpara></tip>
<bridgehead id="_disabling_automatic_type_creation" renderas="sect2">Disabling automatic type creation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic-mapping.asciidoc">Edit me</ulink></bridgehead>
<simpara>Automatic type creation can be disabled by setting the <literal>index.mapper.dynamic</literal>
setting to <literal>false</literal> in the index settings:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_settings <co id="CO225-1"/>
{
  "index.mapper.dynamic":false
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO225-1">
<para>
Disable automatic type creation for all indices.
</para>
</callout>
</calloutlist>
<simpara>Regardless of the value of this setting, types can still be added explicitly
when <link linkend="indices-create-index">creating an index</link> or with the
<link linkend="indices-put-mapping">PUT mapping</link> API.</simpara>
<section id="default-mapping">
<title><literal>_default_</literal> mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/default-mapping.asciidoc">Edit me</ulink></title>
<simpara>The default mapping, which will be used as the base mapping for any new
mapping types, can be customised by adding a mapping type with the name
<literal>_default_</literal> to an index, either when
<link linkend="indices-create-index">creating the index</link> or later on with the
<link linkend="indices-put-mapping">PUT mapping</link> API.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "_default_": { <co id="CO226-1"/>
      "_all": {
        "enabled": false
      }
    },
    "user": {}, <co id="CO226-2"/>
    "blogpost": { <co id="CO226-3"/>
      "_all": {
        "enabled": true
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO226-1">
<para>
The <literal>_default_</literal> mapping defaults the <link linkend="mapping-all-field"><literal>_all</literal></link> field to disabled.
</para>
</callout>
<callout arearefs="CO226-2">
<para>
The <literal>user</literal> type inherits the settings from <literal>_default_</literal>.
</para>
</callout>
<callout arearefs="CO226-3">
<para>
The <literal>blogpost</literal> type overrides the defaults and enables the <link linkend="mapping-all-field"><literal>_all</literal></link> field.
</para>
</callout>
</calloutlist>
<simpara>While the <literal>_default_</literal> mapping can be updated after an index has been created,
the new defaults will only affect mapping types that are created afterwards.</simpara>
<simpara>The <literal>_default_</literal> mapping can be used in conjunction with
<link linkend="indices-templates">Index templates</link> to control dynamically created types
within automatically created indices:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _template/logging
{
  "template":   "logs-*", <co id="CO227-1"/>
  "settings": { "number_of_shards": 1 }, <co id="CO227-2"/>
  "mappings": {
    "_default_": {
      "_all": { <co id="CO227-3"/>
        "enabled": false
      },
      "dynamic_templates": [
        {
          "strings": { <co id="CO227-4"/>
            "match_mapping_type": "string",
            "mapping": {
              "type": "string",
              "fields": {
                "raw": {
                  "type":  "string",
                  "index": "not_analyzed",
                  "ignore_above": 256
                }
              }
            }
          }
        }
      ]
    }
  }
}

PUT logs-2015.10.01/event/1
{ "message": "error:16" }</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO227-1">
<para>
The <literal>logging</literal> template will match any indices beginning with <literal>logs-</literal>.
</para>
</callout>
<callout arearefs="CO227-2">
<para>
Matching indices will be created with a single primary shard.
</para>
</callout>
<callout arearefs="CO227-3">
<para>
The <literal>_all</literal> field will be disabled by default for new type mappings.
</para>
</callout>
<callout arearefs="CO227-4">
<para>
String fields will be created with an <literal>analyzed</literal> main field, and a <literal>not_analyzed</literal> <literal>.raw</literal> field.
</para>
</callout>
</calloutlist>
</section>
<section id="dynamic-field-mapping">
<title>Dynamic field mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/field-mapping.asciidoc">Edit me</ulink></title>
<simpara>By default, when a previously unseen field is found in a document,
Elasticsearch will add the new field to the type mapping.   This behaviour can
be disabled, both at the document and at the <link linkend="object"><literal>object</literal></link>  level, by
setting the <link linkend="dynamic"><literal>dynamic</literal></link> parameter to <literal>false</literal> or to <literal>strict</literal>.</simpara>
<simpara>Assuming <literal>dynamic</literal> field mapping is enabled, some simple rules are used to
determine which datatype the field should have:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<emphasis role="strong">JSON datatype</emphasis>
</simpara>
</entry>
<entry>
<simpara>
<emphasis role="strong">Elasticsearch datatype</emphasis>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>null</literal>
</simpara>
</entry>
<entry>
<simpara>
No field is added.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>true</literal> or <literal>false</literal>
</simpara>
</entry>
<entry>
<simpara>
<link linkend="boolean"><literal>boolean</literal></link> field
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
floating&#160;point&#160;number
</simpara>
</entry>
<entry>
<simpara>
<link linkend="number"><literal>double</literal></link> field
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
integer
</simpara>
</entry>
<entry>
<simpara>
<link linkend="number"><literal>long</literal></link> field
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
object
</simpara>
</entry>
<entry>
<simpara>
<link linkend="object"><literal>object</literal></link> field
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
array
</simpara>
</entry>
<entry>
<simpara>
Depends on the first non-<literal>null</literal> value in the array.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
string
</simpara>
</entry>
<entry>
<simpara>
Either a <link linkend="date"><literal>date</literal></link> field
                                        (if the value passes <link linkend="date-detection">date detection</link>),
                                    a <link linkend="number"><literal>double</literal></link> or <link linkend="number"><literal>long</literal></link> field
                                        (if the value passes <link linkend="numeric-detection">numeric detection</link>)
                                    or an <link linkend="mapping-index"><literal>analyzed</literal></link> <link linkend="string"><literal>string</literal></link> field.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>These are the only <link linkend="mapping-types">field datatypes</link> that are dynamically
detected.  All other datatypes must be mapped explicitly.</simpara>
<simpara>Besides the options listed below, dynamic field mapping rules can be further
customised with <link linkend="dynamic-templates"><literal>dynamic_templates</literal></link>.</simpara>
<section id="date-detection">
<title>Date detection<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/field-mapping.asciidoc">Edit me</ulink></title>
<simpara>If <literal>date_detection</literal> is enabled (default), then new string fields are checked
to see whether their contents match any of the date patterns specified in
<literal>dynamic_date_formats</literal>.  If a match is found, a new <link linkend="date"><literal>date</literal></link> field is
added with the corresponding format.</simpara>
<simpara>The default value for <literal>dynamic_date_formats</literal> is:</simpara>
<simpara>&#91; <link linkend="strict-date-time"><literal>"strict_date_optional_time"</literal></link>,<literal>"yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z"</literal>]</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_type/1
{
  "create_date": "2015/09/02"
}

GET my_index/_mapping <co id="CO228-1"/></programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO228-1">
<para>
The <literal>create_date</literal> field has been added as a <link linkend="date"><literal>date</literal></link>
    field with the <link linkend="mapping-date-format"><literal>format</literal></link>:<?asciidoc-br?>
    <literal>"yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z"</literal>.
</para>
</callout>
</calloutlist>
<section id="_disabling_date_detection">
<title>Disabling date detection<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/field-mapping.asciidoc">Edit me</ulink></title>
<simpara>Dynamic date detection can be disabled by setting <literal>date_detection</literal> to <literal>false</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "date_detection": false
    }
  }
}

PUT my_index/my_type/1 <co id="CO229-1"/>
{
  "create": "2015/09/02"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO229-1">
<para>
The <literal>create_date</literal> field has been added as a <link linkend="string"><literal>string</literal></link> field.
</para>
</callout>
</calloutlist>
</section>
<section id="_customising_detected_date_formats">
<title>Customising detected date formats<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/field-mapping.asciidoc">Edit me</ulink></title>
<simpara>Alternatively, the <literal>dynamic_date_formats</literal> can be customised to support your
own <link linkend="mapping-date-format">date formats</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic_date_formats": ["MM/dd/yyyy"]
    }
  }
}

PUT my_index/my_type/1
{
  "create_date": "09/25/2015"
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
</section>
<section id="numeric-detection">
<title>Numeric detection<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/field-mapping.asciidoc">Edit me</ulink></title>
<simpara>While JSON has support for native floating point and integer datatypes, some
applications or languages may sometimes render numbers as strings. Usually the
correct solution is to map these fields explicitly, but numeric detection
(which is disabled by default) can be enabled to do this automatically:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "numeric_detection": true
    }
  }
}

PUT my_index/my_type/1
{
  "my_float":   "1.0", <co id="CO230-1"/>
  "my_integer": "1" <co id="CO230-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO230-1">
<para>
The <literal>my_float</literal> field is added as a <link linkend="number"><literal>double</literal></link> field.
</para>
</callout>
<callout arearefs="CO230-2">
<para>
The <literal>my_integer</literal> field is added as a <link linkend="number"><literal>long</literal></link> field.
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="dynamic-templates">
<title>Dynamic templates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>Dynamic templates allow you to define custom mappings that can be applied to
dynamically added fields based on:</simpara>
<itemizedlist>
<listitem>
<simpara>
the <link linkend="dynamic-mapping">datatype</link> detected by Elasticsearch, with <link linkend="match-mapping-type"><literal>match_mapping_type</literal></link>.
</simpara>
</listitem>
<listitem>
<simpara>
the name of the field, with <link linkend="match-unmatch"><literal>match</literal> and <literal>unmatch</literal></link> or <link linkend="match-pattern"><literal>match_pattern</literal></link>.
</simpara>
</listitem>
<listitem>
<simpara>
the full dotted path to the field, with <link linkend="path-match-unmatch"><literal>path_match</literal> and <literal>path_unmatch</literal></link>.
</simpara>
</listitem>
</itemizedlist>
<simpara>The original field name <literal>{name}</literal> and the detected datatype
<literal>{dynamic_type</literal>} <link linkend="template-variables">template variables</link> can be used in
the mapping specification as placeholders.</simpara>
<important><simpara>Dynamic field mappings are only added when a field contains a
concrete value&#8201;&#8212;&#8201;not <literal>null</literal> or an empty array. This means that if the
<literal>null_value</literal> option  is used in a <literal>dynamic_template</literal>, it will only be applied
after the first document  with a concrete value for the field has been
indexed.</simpara></important>
<simpara>Dynamic templates are specified as an array of named objects:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "dynamic_templates": [
    {
      "my_template_name": { <co id="CO231-1"/>
        ...  match conditions ... <co id="CO231-2"/>
        "mapping": { ... } <co id="CO231-3"/>
      }
    },
    ...
  ]</programlisting>
<calloutlist>
<callout arearefs="CO231-1">
<para>
The template name can be any string value.
</para>
</callout>
<callout arearefs="CO231-2">
<para>
The match conditions can include any of : <literal>match_mapping_type</literal>, <literal>match</literal>, <literal>match_pattern</literal>, <literal>unmatch</literal>, <literal>path_match</literal>, <literal>path_unmatch</literal>.
</para>
</callout>
<callout arearefs="CO231-3">
<para>
The mapping that the matched field should use.
</para>
</callout>
</calloutlist>
<simpara>Templates are processed in order&#8201;&#8212;&#8201;the first matching template wins. New
templates can be appended to the end of the list with the
<link linkend="indices-put-mapping">PUT mapping</link> API.  If a new template has the same
name as an existing template, it will replace the old version.</simpara>
<section id="match-mapping-type">
<title><literal>match_mapping_type</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match_mapping_type</literal> matches on the datatype detected by
<link linkend="dynamic-field-mapping">dynamic field mapping</link>, in other words, the datatype
that Elasticsearch thinks the field should have.  Only the following datatypes
can be automatically detected: <literal>boolean</literal>, <literal>date</literal>, <literal>double</literal>, <literal>long</literal>, <literal>object</literal>,
<literal>string</literal>.  It also accepts <literal>*</literal> to match all datatypes.</simpara>
<simpara>For example, if we wanted to map all integer fields as <literal>integer</literal> instead of
<literal>long</literal>, and all <literal>string</literal> fields as both <literal>analyzed</literal> and <literal>not_analyzed</literal>, we
could use the following template:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic_templates": [
        {
          "integers": {
            "match_mapping_type": "long",
            "mapping": {
              "type": "integer"
            }
          }
        },
        {
          "strings": {
            "match_mapping_type": "string",
            "mapping": {
              "type": "string",
              "fields": {
                "raw": {
                  "type":  "string",
                  "index": "not_analyzed",
                  "ignore_above": 256
                }
              }
            }
          }
        }
      ]
    }
  }
}

PUT my_index/my_type/1
{
  "my_integer": 5, <co id="CO232-1"/>
  "my_string": "Some string" <co id="CO232-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO232-1">
<para>
The <literal>my_integer</literal> field is mapped as an <literal>integer</literal>.
</para>
</callout>
<callout arearefs="CO232-2">
<para>
The <literal>my_string</literal> field is mapped as an analyzed <literal>string</literal>, with a <literal>not_analyzed</literal> <link linkend="multi-fields">multi field</link>.
</para>
</callout>
</calloutlist>
</section>
<section id="match-unmatch">
<title><literal>match</literal> and <literal>unmatch</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match</literal> parameter uses a pattern to match on the fieldname, while
<literal>unmatch</literal> uses a pattern to exclude fields matched by <literal>match</literal>.</simpara>
<simpara>The following example matches all <literal>string</literal> fields whose name starts with
<literal>long_</literal> (except for those which end with <literal>_text</literal>) and maps them as <literal>long</literal>
fields:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic_templates": [
        {
          "longs_as_strings": {
            "match_mapping_type": "string",
            "match":   "long_*",
            "unmatch": "*_text",
            "mapping": {
              "type": "long"
            }
          }
        }
      ]
    }
  }
}

PUT my_index/my_type/1
{
  "long_num": "5", <co id="CO233-1"/>
  "long_text": "foo" <co id="CO233-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO233-1">
<para>
The <literal>long_num</literal> field is mapped as a <literal>long</literal>.
</para>
</callout>
<callout arearefs="CO233-2">
<para>
The <literal>long_text</literal> field uses the default <literal>string</literal> mapping.
</para>
</callout>
</calloutlist>
</section>
<section id="match-pattern">
<title><literal>match_pattern</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match_pattern</literal> parameter adjusts the behavior of the <literal>match</literal> parameter
such that it supports full Java regular expression matching on the field name
instead of simple wildcards, for instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">  "match_pattern": "regex",
  "match": "^profit_\d+$"</programlisting>
</section>
<section id="path-match-unmatch">
<title><literal>path_match</literal> and <literal>path_unmatch</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>The <literal>path_match</literal> and <literal>path_unmatch</literal> parameters work in the same way as <literal>match</literal>
and <literal>unmatch</literal>, but operate on the full dotted path to the field, not just the
final name, e.g. <literal>some_object.*.some_field</literal>.</simpara>
<simpara>This example copies the values of any fields in the <literal>name</literal> object to the
top-level <literal>full_name</literal> field, except for the <literal>middle</literal> field:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic_templates": [
        {
          "full_name": {
            "path_match":   "name.*",
            "path_unmatch": "*.middle",
            "mapping": {
              "type":       "string",
              "copy_to":    "full_name"
            }
          }
        }
      ]
    }
  }
}

PUT my_index/my_type/1
{
  "name": {
    "first":  "Alice",
    "middle": "Mary",
    "last":   "White"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="template-variables">
<title><literal>{name}</literal> and <literal>{dynamic_type}</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>The <literal>{name}</literal> and <literal>{dynamic_type}</literal> placeholders are replaced in the <literal>mapping</literal>
with the field name and detected dynamic type.  The following example sets all
string fields to use an <link linkend="analyzer"><literal>analyzer</literal></link> with the same name as the
field, and disables <link linkend="doc-values"><literal>doc_values</literal></link> for all non-string fields:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "mappings": {
    "my_type": {
      "dynamic_templates": [
        {
          "named_analyzers": {
            "match_mapping_type": "string",
            "match": "*",
            "mapping": {
              "type": "string",
              "analyzer": "{name}"
            }
          }
        },
        {
          "no_doc_values": {
            "match_mapping_type":"*",
            "mapping": {
              "type": "{dynamic_type}",
              "doc_values": false
            }
          }
        }
      ]
    }
  }
}

PUT my_index/my_type/1
{
  "english": "Some English text", <co id="CO234-1"/>
  "count":   5 <co id="CO234-2"/>
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO234-1">
<para>
The <literal>english</literal> field is mapped as a <literal>string</literal> field with the <literal>english</literal> analyzer.
</para>
</callout>
<callout arearefs="CO234-2">
<para>
The <literal>count</literal> field is mapped as a <literal>long</literal> field with <literal>doc_values</literal> disabled
</para>
</callout>
</calloutlist>
</section>
</section>
<section id="override-default-template">
<title>Override default template<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/dynamic/templates.asciidoc">Edit me</ulink></title>
<simpara>You can override the default mappings for all indices and all types
by specifying a <literal>_default_</literal> type mapping in an index template
which matches all indices.</simpara>
<simpara>For example, to disable the <literal>_all</literal> field by default for all types in all
new indices, you could create the following index template:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _template/disable_all_field
{
  "disable_all_field": {
    "order": 0,
    "template": "*", <co id="CO235-1"/>
    "mappings": {
      "_default_": { <co id="CO235-2"/>
        "_all": { <co id="CO235-3"/>
          "enabled": false
        }
      }
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO235-1">
<para>
Applies the mappings to an <literal>index</literal> which matches the pattern <literal>*</literal>, in other
    words, all new indices.
</para>
</callout>
<callout arearefs="CO235-2">
<para>
Defines the <literal>_default_</literal> type mapping types within the index.
</para>
</callout>
<callout arearefs="CO235-3">
<para>
Disables the <literal>_all</literal> field by default.
</para>
</callout>
</calloutlist>
</section>
</chapter>
<chapter id="mapping-transform">
<title>Transform<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/transform.asciidoc">Edit me</ulink></title>
<warning revisionflag="deleted" revision="2.0.0"><simpara>Deprecated in 2.0.0.</simpara></warning>
<simpara>The document can be transformed before it is indexed by registering a script in
the <literal>transform</literal> element of the mapping. The result of the transform is indexed
but the original source is stored in the <literal>_source</literal> field.</simpara>
<simpara>This was deprecated in 2.0.0 because it made debugging very difficult. As of
now there really isn&#8217;t a feature to use in its place other than transforming
the document in the client application.</simpara>
<simpara>Deprecated or no, here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "example" : {
        "transform" : {
            "script" : {
                "inline": "if (ctx._source['title']?.startsWith('t')) ctx._source['suggest'] = ctx._source['content']",
                "params" : {
                    "variable" : "not used but an example anyway"
                },
                "lang": "groovy"
            }
        },
        "properties": {
           "title": { "type": "string" },
           "content": { "type": "string" },
           "suggest": { "type": "string" }
        }
    }
}</programlisting>
<simpara>Its also possible to specify multiple transforms:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "example" : {
        "transform" : [
            {"script": "ctx._source['suggest'] = ctx._source['content']"},
            {"script": "ctx._source['foo'] = ctx._source['bar'];"}
        ]
    }
}</programlisting>
<simpara>Because the result isn&#8217;t stored in the source it can&#8217;t normally be fetched by
source filtering.  It can be highlighted if it is marked as stored.</simpara>
<section id="_get_transformed">
<title>Get Transformed<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/transform.asciidoc">Edit me</ulink></title>
<simpara>The get endpoint will retransform the source if the <literal>_source_transform</literal>
parameter is set.  Example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">curl -XGET "http://localhost:9200/test/example/3?pretty&amp;_source_transform"</programlisting>
<simpara>The transform is performed before any source filtering but it is mostly
designed to make it easy to see what was passed to the index for debugging.</simpara>
</section>
<section id="_immutable_transformation">
<title>Immutable Transformation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/mapping/transform.asciidoc">Edit me</ulink></title>
<simpara>Once configured the transform script cannot be modified.  This is not
because that is technically impossible but instead because madness lies
down that road.</simpara>
</section>
</chapter>
</part>
<part id="analysis">
<title>Analysis <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>The index analysis module acts as a configurable registry of Analyzers
that can be used in order to both break indexed (analyzed) fields when a
document is indexed and process query strings. It maps to the Lucene
<literal>Analyzer</literal>.</simpara>
<simpara>Analyzers are composed of a single <link linkend="analysis-tokenizers">Tokenizer</link>
and zero or more <link linkend="analysis-tokenfilters">TokenFilters</link>. The tokenizer may
be preceded by one or more <link linkend="analysis-charfilters">CharFilters</link>. The
analysis module allows one to register <literal>TokenFilters</literal>, <literal>Tokenizers</literal> and
<literal>Analyzers</literal> under logical names that can then be referenced either in
mapping definitions or in certain APIs. The Analysis module
automatically registers (<emphasis role="strong">if not explicitly defined</emphasis>) built in
analyzers, token filters, and tokenizers.</simpara>
<simpara>Here is a sample configuration:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            standard :
                type : standard
                stopwords : [stop1, stop2]
            myAnalyzer1 :
                type : standard
                stopwords : [stop1, stop2, stop3]
                max_token_length : 500
            # configure a custom analyzer which is
            # exactly like the default standard analyzer
            myAnalyzer2 :
                tokenizer : standard
                filter : [standard, lowercase, stop]
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
            myTokenizer2 :
                type : keyword
                buffer_size : 512
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myTokenFilter2 :
                type : length
                min : 0
                max : 2000</programlisting>
<bridgehead id="backwards-compatibility" renderas="sect2">Backwards compatibility<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis.asciidoc">Edit me</ulink></bridgehead>
<simpara>All analyzers, tokenizers, and token filters can be configured with a
<literal>version</literal> parameter to control which Lucene version behavior they should
use. Possible values are: <literal>3.0</literal> - <literal>3.6</literal>, <literal>4.0</literal> - <literal>4.3</literal> (the highest
version number is the default option).</simpara>
</partintro>
<chapter id="analysis-analyzers">
<title>Analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers.asciidoc">Edit me</ulink></title>
<simpara>Analyzers are composed of a single <link linkend="analysis-tokenizers">Tokenizer</link>
and zero or more <link linkend="analysis-tokenfilters">TokenFilters</link>. The tokenizer may
be preceded by one or more <link linkend="analysis-charfilters">CharFilters</link>.
The analysis module allows you to register <literal>Analyzers</literal> under logical
names which can then be referenced either in mapping definitions or in
certain APIs.</simpara>
<simpara>Elasticsearch comes with a number of prebuilt analyzers which are
ready to use.  Alternatively, you can combine the built in
character filters, tokenizers and token filters to create
<link linkend="analysis-custom-analyzer">custom analyzers</link>.</simpara>
<bridgehead id="default-analyzers" renderas="sect2">Default Analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers.asciidoc">Edit me</ulink></bridgehead>
<simpara>An analyzer is registered under a logical name. It can then be
referenced from mapping definitions or certain APIs. When none are
defined, defaults are used. There is an option to define which analyzers
will be used by default when none can be derived.</simpara>
<simpara>The <literal>default</literal> logical name allows one to configure an analyzer that will
be used both for indexing and for searching APIs. The <literal>default_search</literal>
logical name can be used to configure a default analyzer that will be
used just when searching (the <literal>default</literal> analyzer would still be used for
indexing).</simpara>
<simpara>For instance, the following settings could be used to perform exact matching
only by default:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
  analysis :
    analyzer :
      default :
        tokenizer : keyword</programlisting>
<bridgehead id="aliasing-analyzers" renderas="sect2">Aliasing Analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers.asciidoc">Edit me</ulink></bridgehead>
<simpara>Analyzers can be aliased to have several registered lookup names
associated with them. For example, the following will allow
the <literal>standard</literal> analyzer to also be referenced with <literal>alias1</literal>
and <literal>alias2</literal> values.</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
  analysis :
    analyzer :
      standard :
        alias: [alias1, alias2]
        type : standard
        stopwords : [test1, test2, test3]</programlisting>
<simpara>Below is a list of the built in analyzers.</simpara>
<section id="analysis-standard-analyzer">
<title>Standard Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/standard-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>standard</literal> is built using the
<link linkend="analysis-standard-tokenizer">Standard Tokenizer</link> with the
<link linkend="analysis-standard-tokenfilter">Standard Token Filter</link>,
<link linkend="analysis-lowercase-tokenfilter">Lower Case Token Filter</link>, and
<link linkend="analysis-stop-tokenfilter">Stop Token Filter</link>.</simpara>
<simpara>The following are settings that can be set for a <literal>standard</literal> analyzer
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>stopwords</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A list of stopwords to initialize the stop filter with.
Defaults to an <emphasis>empty</emphasis> stopword list Check
<link linkend="analysis-stop-analyzer">Stop Analyzer</link> for more details.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_token_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum token length. If a token is seen that exceeds
this length then it is split at <literal>max_token_length</literal> intervals. Defaults to <literal>255</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-simple-analyzer">
<title>Simple Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/simple-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>simple</literal> that is built using a
<link linkend="analysis-lowercase-tokenizer">Lower Case Tokenizer</link>.</simpara>
</section>
<section id="analysis-whitespace-analyzer">
<title>Whitespace Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/whitespace-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>whitespace</literal> that is built using a
<link linkend="analysis-whitespace-tokenizer">Whitespace Tokenizer</link>.</simpara>
</section>
<section id="analysis-stop-analyzer">
<title>Stop Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/stop-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>stop</literal> that is built using a
<link linkend="analysis-lowercase-tokenizer">Lower Case Tokenizer</link>, with
<link linkend="analysis-stop-tokenfilter">Stop Token Filter</link>.</simpara>
<simpara>The following are settings that can be set for a <literal>stop</literal> analyzer type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>stopwords</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A list of stopwords to initialize the stop filter with.
Defaults to the english stop words.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>stopwords_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A path (either relative to <literal>config</literal> location, or
absolute) to a stopwords file configuration.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Use <literal>stopwords: _none_</literal> to explicitly specify an <emphasis>empty</emphasis> stopword list.</simpara>
</section>
<section id="analysis-keyword-analyzer">
<title>Keyword Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/keyword-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>keyword</literal> that "tokenizes" an entire stream as a
single token. This is useful for data like zip codes, ids and so on.
Note, when using mapping definitions, it might make more sense to simply
mark the field as <literal>not_analyzed</literal>.</simpara>
</section>
<section id="analysis-pattern-analyzer">
<title>Pattern Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>pattern</literal> analyzer uses a regular expression to split the text into terms.
The regular expression should match the <emphasis role="strong">token separators</emphasis>  not the tokens
themselves. The regular expression defaults to <literal>\W+</literal> (or all non-word characters).</simpara>
<warning>
<title>Beware of Pathological Regular Expressions</title>
<simpara>The pattern analyzer uses
<ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</ulink>.</simpara>
<simpara>A badly written regular expression could run very slowly or even throw a
StackOverflowError and cause the node it is running on to exit suddenly.</simpara>
<simpara>Read more about <ulink url="http://www.regular-expressions.info/catastrophic.html">pathological regular expressions and how to avoid them</ulink>.</simpara>
</warning>
<bridgehead id="_definition" renderas="sect2">Definition<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></bridgehead>
<simpara>It consists of:</simpara>
<variablelist>
<varlistentry>
<term>
Tokenizer
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
<link linkend="analysis-pattern-tokenizer">Pattern Tokenizer</link>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Token Filters
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
<link linkend="analysis-lowercase-tokenfilter">Lower Case Token Filter</link>
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="analysis-stop-tokenfilter">Stop Token Filter</link> (disabled by default)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_example_output" renderas="sect2">Example output<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">POST _analyze
{
  "analyzer": "pattern",
  "text": "The 2 QUICK Brown-Foxes jumped over the lazy dog's bone."
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above sentence would produce the following terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ the, 2, quick, brown, foxes, jumped, over, the, lazy, dog, s, bone ]</programlisting>
<bridgehead id="_configuration" renderas="sect2">Configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>pattern</literal> analyzer accepts the following parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>pattern</literal>
</simpara>
</entry>
<entry>
<simpara>
    A <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java regular expression</ulink>, defaults to <literal>\W+</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flags</literal>
</simpara>
</entry>
<entry>
<simpara>
    Java regular expression <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#field.summary">flags</ulink>.
    Flags should be pipe-separated, eg <literal>"CASE_INSENSITIVE|COMMENTS"</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lowercase</literal>
</simpara>
</entry>
<entry>
<simpara>
    Should terms be lowercased or not. Defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopwords</literal>
</simpara>
</entry>
<entry>
<simpara>
    A pre-defined stop words list like <literal>_english_</literal> or an array  containing a
    list of stop words.  Defaults to <literal>\_none_</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopwords_path</literal>
</simpara>
</entry>
<entry>
<simpara>
    The path to a file containing stop words.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>See the <link linkend="analysis-stop-tokenfilter">Stop Token Filter</link> for more information
about stop word configuration.</simpara>
<bridgehead id="_example_configuration" renderas="sect2">Example configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></bridgehead>
<simpara>In this example, we configure the <literal>pattern</literal> analyzer to split email addresses
on non-word characters or on underscores (<literal>\W|_</literal>), and to lower-case the result:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_email_analyzer": {
          "type":      "pattern",
          "pattern":   "\\W|_", <co id="CO236-1"/>
          "lowercase": true
        }
      }
    }
  }
}

POST my_index/_analyze
{
  "analyzer": "my_email_analyzer",
  "text": "John_Smith@foo-bar.com"
}</programlisting>
<remark> AUTOSENSE</remark>
<calloutlist>
<callout arearefs="CO236-1">
<para>
The backslashes in the pattern need to be escaped when specifying the
    pattern as a JSON string.
</para>
</callout>
</calloutlist>
<simpara>The above example produces the following terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ john, smith, foo, bar, com ]</programlisting>
<bridgehead id="_camelcase_tokenizer" renderas="sect3">CamelCase tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/pattern-analyzer.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following more complicated example splits CamelCase text into tokens:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "camel": {
          "type": "pattern",
          "pattern": "([^\\p{L}\\d]+)|(?&lt;=\\D)(?=\\d)|(?&lt;=\\d)(?=\\D)|(?&lt;=[\\p{L}&amp;&amp;[^\\p{Lu}]])(?=\\p{Lu})|(?&lt;=\\p{Lu})(?=\\p{Lu}[\\p{L}&amp;&amp;[^\\p{Lu}]])"
        }
      }
    }
  }
}

GET my_index/_analyze
{
  "analyzer": "camel",
  "text": "MooseX::FTPClass2_beta"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above example produces the following terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ moose, x, ftp, class, 2, beta ]</programlisting>
<simpara>The regex above is easier to understand as:</simpara>
<programlisting language="js" linenumbering="unnumbered">  ([^\p{L}\d]+)                 # swallow non letters and numbers,
| (?&lt;=\D)(?=\d)                 # or non-number followed by number,
| (?&lt;=\d)(?=\D)                 # or number followed by non-number,
| (?&lt;=[ \p{L} &amp;&amp; [^\p{Lu}]])    # or lower case
  (?=\p{Lu})                    #   followed by upper case,
| (?&lt;=\p{Lu})                   # or upper case
  (?=\p{Lu}                     #   followed by upper case
    [\p{L}&amp;&amp;[^\p{Lu}]]          #   then lower case
  )</programlisting>
</section>
<section id="analysis-lang-analyzer">
<title>Language Analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>A set of analyzers aimed at analyzing specific language text. The
following types are supported:
<link linkend="arabic-analyzer"><literal>arabic</literal></link>,
<link linkend="armenian-analyzer"><literal>armenian</literal></link>,
<link linkend="basque-analyzer"><literal>basque</literal></link>,
<link linkend="brazilian-analyzer"><literal>brazilian</literal></link>,
<link linkend="bulgarian-analyzer"><literal>bulgarian</literal></link>,
<link linkend="catalan-analyzer"><literal>catalan</literal></link>,
<link linkend="cjk-analyzer"><literal>cjk</literal></link>,
<link linkend="czech-analyzer"><literal>czech</literal></link>,
<link linkend="danish-analyzer"><literal>danish</literal></link>,
<link linkend="dutch-analyzer"><literal>dutch</literal></link>,
<link linkend="english-analyzer"><literal>english</literal></link>,
<link linkend="finnish-analyzer"><literal>finnish</literal></link>,
<link linkend="french-analyzer"><literal>french</literal></link>,
<link linkend="galician-analyzer"><literal>galician</literal></link>,
<link linkend="german-analyzer"><literal>german</literal></link>,
<link linkend="greek-analyzer"><literal>greek</literal></link>,
<link linkend="hindi-analyzer"><literal>hindi</literal></link>,
<link linkend="hungarian-analyzer"><literal>hungarian</literal></link>,
<link linkend="indonesian-analyzer"><literal>indonesian</literal></link>,
<link linkend="irish-analyzer"><literal>irish</literal></link>,
<link linkend="italian-analyzer"><literal>italian</literal></link>,
<link linkend="latvian-analyzer"><literal>latvian</literal></link>,
<link linkend="lithuanian-analyzer"><literal>lithuanian</literal></link>,
<link linkend="norwegian-analyzer"><literal>norwegian</literal></link>,
<link linkend="persian-analyzer"><literal>persian</literal></link>,
<link linkend="portuguese-analyzer"><literal>portuguese</literal></link>,
<link linkend="romanian-analyzer"><literal>romanian</literal></link>,
<link linkend="russian-analyzer"><literal>russian</literal></link>,
<link linkend="sorani-analyzer"><literal>sorani</literal></link>,
<link linkend="spanish-analyzer"><literal>spanish</literal></link>,
<link linkend="swedish-analyzer"><literal>swedish</literal></link>,
<link linkend="turkish-analyzer"><literal>turkish</literal></link>,
<link linkend="thai-analyzer"><literal>thai</literal></link>.</simpara>
<section id="_configuring_language_analyzers">
<title>Configuring language analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<section id="_stopwords">
<title>Stopwords<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>All analyzers support setting custom <literal>stopwords</literal> either internally in
the config, or by using an external stopwords file by setting
<literal>stopwords_path</literal>. Check <link linkend="analysis-stop-analyzer">Stop Analyzer</link> for
more details.</simpara>
</section>
<section id="_excluding_words_from_stemming">
<title>Excluding words from stemming<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>stem_exclusion</literal> parameter allows you to specify an array
of lowercase words that should not be stemmed.  Internally, this
functionality is implemented by adding the
<link linkend="analysis-keyword-marker-tokenfilter"><literal>keyword_marker</literal> token filter</link>
with the <literal>keywords</literal> set to the value of the <literal>stem_exclusion</literal> parameter.</simpara>
<simpara>The following analyzers support setting custom <literal>stem_exclusion</literal> list:
<literal>arabic</literal>, <literal>armenian</literal>, <literal>basque</literal>, <literal>catalan</literal>, <literal>bulgarian</literal>, <literal>catalan</literal>,
<literal>czech</literal>, <literal>finnish</literal>, <literal>dutch</literal>, <literal>english</literal>, <literal>finnish</literal>, <literal>french</literal>, <literal>galician</literal>,
<literal>german</literal>, <literal>irish</literal>, <literal>hindi</literal>, <literal>hungarian</literal>, <literal>indonesian</literal>, <literal>italian</literal>, <literal>latvian</literal>,
<literal>lithuanian</literal>, <literal>norwegian</literal>, <literal>portuguese</literal>, <literal>romanian</literal>, <literal>russian</literal>, <literal>sorani</literal>,
<literal>spanish</literal>, <literal>swedish</literal>, <literal>turkish</literal>.</simpara>
</section>
</section>
<section id="_reimplementing_language_analyzers">
<title>Reimplementing language analyzers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The built-in language analyzers can be reimplemented as <literal>custom</literal> analyzers
(as described below) in order to customize their behaviour.</simpara>
<note><simpara>If you do not intend to exclude words from being stemmed (the
equivalent of the <literal>stem_exclusion</literal> parameter above), then you should remove
the <literal>keyword_marker</literal> token filter from the custom analyzer configuration.</simpara></note>
<section id="arabic-analyzer">
<title><literal>arabic</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>arabic</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "arabic_stop": {
          "type":       "stop",
          "stopwords":  "_arabic_" <co id="CO237-1"/>
        },
        "arabic_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO237-2"/>
        },
        "arabic_stemmer": {
          "type":       "stemmer",
          "language":   "arabic"
        }
      },
      "analyzer": {
        "arabic": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "arabic_stop",
            "arabic_normalization",
            "arabic_keywords",
            "arabic_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO237-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO237-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="armenian-analyzer">
<title><literal>armenian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>armenian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "armenian_stop": {
          "type":       "stop",
          "stopwords":  "_armenian_" <co id="CO238-1"/>
        },
        "armenian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO238-2"/>
        },
        "armenian_stemmer": {
          "type":       "stemmer",
          "language":   "armenian"
        }
      },
      "analyzer": {
        "armenian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "armenian_stop",
            "armenian_keywords",
            "armenian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO238-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO238-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="basque-analyzer">
<title><literal>basque</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>basque</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "basque_stop": {
          "type":       "stop",
          "stopwords":  "_basque_" <co id="CO239-1"/>
        },
        "basque_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO239-2"/>
        },
        "basque_stemmer": {
          "type":       "stemmer",
          "language":   "basque"
        }
      },
      "analyzer": {
        "basque": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "basque_stop",
            "basque_keywords",
            "basque_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO239-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO239-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="brazilian-analyzer">
<title><literal>brazilian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>brazilian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "brazilian_stop": {
          "type":       "stop",
          "stopwords":  "_brazilian_" <co id="CO240-1"/>
        },
        "brazilian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO240-2"/>
        },
        "brazilian_stemmer": {
          "type":       "stemmer",
          "language":   "brazilian"
        }
      },
      "analyzer": {
        "brazilian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "brazilian_stop",
            "brazilian_keywords",
            "brazilian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO240-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO240-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="bulgarian-analyzer">
<title><literal>bulgarian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>bulgarian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "bulgarian_stop": {
          "type":       "stop",
          "stopwords":  "_bulgarian_" <co id="CO241-1"/>
        },
        "bulgarian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO241-2"/>
        },
        "bulgarian_stemmer": {
          "type":       "stemmer",
          "language":   "bulgarian"
        }
      },
      "analyzer": {
        "bulgarian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "bulgarian_stop",
            "bulgarian_keywords",
            "bulgarian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO241-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO241-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="catalan-analyzer">
<title><literal>catalan</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>catalan</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "catalan_elision": {
        "type":         "elision",
            "articles": [ "d", "l", "m", "n", "s", "t"]
        },
        "catalan_stop": {
          "type":       "stop",
          "stopwords":  "_catalan_" <co id="CO242-1"/>
        },
        "catalan_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO242-2"/>
        },
        "catalan_stemmer": {
          "type":       "stemmer",
          "language":   "catalan"
        }
      },
      "analyzer": {
        "catalan": {
          "tokenizer":  "standard",
          "filter": [
            "catalan_elision",
            "lowercase",
            "catalan_stop",
            "catalan_keywords",
            "catalan_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO242-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO242-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="cjk-analyzer">
<title><literal>cjk</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cjk</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "english_stop": {
          "type":       "stop",
          "stopwords":  "_english_" <co id="CO243-1"/>
        }
      },
      "analyzer": {
        "cjk": {
          "tokenizer":  "standard",
          "filter": [
            "cjk_width",
            "lowercase",
            "cjk_bigram",
            "english_stop"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO243-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
</calloutlist>
</section>
<section id="czech-analyzer">
<title><literal>czech</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>czech</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "czech_stop": {
          "type":       "stop",
          "stopwords":  "_czech_" <co id="CO244-1"/>
        },
        "czech_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO244-2"/>
        },
        "czech_stemmer": {
          "type":       "stemmer",
          "language":   "czech"
        }
      },
      "analyzer": {
        "czech": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "czech_stop",
            "czech_keywords",
            "czech_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO244-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO244-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="danish-analyzer">
<title><literal>danish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>danish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "danish_stop": {
          "type":       "stop",
          "stopwords":  "_danish_" <co id="CO245-1"/>
        },
        "danish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO245-2"/>
        },
        "danish_stemmer": {
          "type":       "stemmer",
          "language":   "danish"
        }
      },
      "analyzer": {
        "danish": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "danish_stop",
            "danish_keywords",
            "danish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO245-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO245-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="dutch-analyzer">
<title><literal>dutch</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>dutch</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "dutch_stop": {
          "type":       "stop",
          "stopwords":  "_dutch_" <co id="CO246-1"/>
        },
        "dutch_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO246-2"/>
        },
        "dutch_stemmer": {
          "type":       "stemmer",
          "language":   "dutch"
        },
        "dutch_override": {
          "type":       "stemmer_override",
          "rules": [
            "fiets=&gt;fiets",
            "bromfiets=&gt;bromfiets",
            "ei=&gt;eier",
            "kind=&gt;kinder"
          ]
        }
      },
      "analyzer": {
        "dutch": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "dutch_stop",
            "dutch_keywords",
            "dutch_override",
            "dutch_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO246-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO246-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="english-analyzer">
<title><literal>english</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>english</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "english_stop": {
          "type":       "stop",
          "stopwords":  "_english_" <co id="CO247-1"/>
        },
        "english_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO247-2"/>
        },
        "english_stemmer": {
          "type":       "stemmer",
          "language":   "english"
        },
        "english_possessive_stemmer": {
          "type":       "stemmer",
          "language":   "possessive_english"
        }
      },
      "analyzer": {
        "english": {
          "tokenizer":  "standard",
          "filter": [
            "english_possessive_stemmer",
            "lowercase",
            "english_stop",
            "english_keywords",
            "english_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO247-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO247-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="finnish-analyzer">
<title><literal>finnish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>finnish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "finnish_stop": {
          "type":       "stop",
          "stopwords":  "_finnish_" <co id="CO248-1"/>
        },
        "finnish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO248-2"/>
        },
        "finnish_stemmer": {
          "type":       "stemmer",
          "language":   "finnish"
        }
      },
      "analyzer": {
        "finnish": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "finnish_stop",
            "finnish_keywords",
            "finnish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO248-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO248-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="french-analyzer">
<title><literal>french</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>french</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "french_elision": {
          "type":         "elision",
          "articles_case": true,
            "articles": [
              "l", "m", "t", "qu", "n", "s",
              "j", "d", "c", "jusqu", "quoiqu",
              "lorsqu", "puisqu"
            ]
        },
        "french_stop": {
          "type":       "stop",
          "stopwords":  "_french_" <co id="CO249-1"/>
        },
        "french_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO249-2"/>
        },
        "french_stemmer": {
          "type":       "stemmer",
          "language":   "light_french"
        }
      },
      "analyzer": {
        "french": {
          "tokenizer":  "standard",
          "filter": [
            "french_elision",
            "lowercase",
            "french_stop",
            "french_keywords",
            "french_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO249-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO249-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="galician-analyzer">
<title><literal>galician</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>galician</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "galician_stop": {
          "type":       "stop",
          "stopwords":  "_galician_" <co id="CO250-1"/>
        },
        "galician_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO250-2"/>
        },
        "galician_stemmer": {
          "type":       "stemmer",
          "language":   "galician"
        }
      },
      "analyzer": {
        "galician": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "galician_stop",
            "galician_keywords",
            "galician_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO250-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO250-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="german-analyzer">
<title><literal>german</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>german</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "german_stop": {
          "type":       "stop",
          "stopwords":  "_german_" <co id="CO251-1"/>
        },
        "german_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO251-2"/>
        },
        "german_stemmer": {
          "type":       "stemmer",
          "language":   "light_german"
        }
      },
      "analyzer": {
        "german": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "german_stop",
            "german_keywords",
            "german_normalization",
            "german_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO251-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO251-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="greek-analyzer">
<title><literal>greek</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>greek</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "greek_stop": {
          "type":       "stop",
          "stopwords":  "_greek_" <co id="CO252-1"/>
        },
        "greek_lowercase": {
          "type":       "lowercase",
          "language":   "greek"
        },
        "greek_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO252-2"/>
        },
        "greek_stemmer": {
          "type":       "stemmer",
          "language":   "greek"
        }
      },
      "analyzer": {
        "greek": {
          "tokenizer":  "standard",
          "filter": [
            "greek_lowercase",
            "greek_stop",
            "greek_keywords",
            "greek_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO252-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO252-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="hindi-analyzer">
<title><literal>hindi</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>hindi</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "hindi_stop": {
          "type":       "stop",
          "stopwords":  "_hindi_" <co id="CO253-1"/>
        },
        "hindi_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO253-2"/>
        },
        "hindi_stemmer": {
          "type":       "stemmer",
          "language":   "hindi"
        }
      },
      "analyzer": {
        "hindi": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "indic_normalization",
            "hindi_normalization",
            "hindi_stop",
            "hindi_keywords",
            "hindi_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO253-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO253-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="hungarian-analyzer">
<title><literal>hungarian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>hungarian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "hungarian_stop": {
          "type":       "stop",
          "stopwords":  "_hungarian_" <co id="CO254-1"/>
        },
        "hungarian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO254-2"/>
        },
        "hungarian_stemmer": {
          "type":       "stemmer",
          "language":   "hungarian"
        }
      },
      "analyzer": {
        "hungarian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "hungarian_stop",
            "hungarian_keywords",
            "hungarian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO254-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO254-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="indonesian-analyzer">
<title><literal>indonesian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>indonesian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "indonesian_stop": {
          "type":       "stop",
          "stopwords":  "_indonesian_" <co id="CO255-1"/>
        },
        "indonesian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO255-2"/>
        },
        "indonesian_stemmer": {
          "type":       "stemmer",
          "language":   "indonesian"
        }
      },
      "analyzer": {
        "indonesian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "indonesian_stop",
            "indonesian_keywords",
            "indonesian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO255-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO255-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="irish-analyzer">
<title><literal>irish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>irish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "irish_elision": {
          "type":       "elision",
          "articles": [ "h", "n", "t" ]
        },
        "irish_stop": {
          "type":       "stop",
          "stopwords":  "_irish_" <co id="CO256-1"/>
        },
        "irish_lowercase": {
          "type":       "lowercase",
          "language":   "irish"
        },
        "irish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO256-2"/>
        },
        "irish_stemmer": {
          "type":       "stemmer",
          "language":   "irish"
        }
      },
      "analyzer": {
        "irish": {
          "tokenizer":  "standard",
          "filter": [
            "irish_stop",
            "irish_elision",
            "irish_lowercase",
            "irish_keywords",
            "irish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO256-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO256-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="italian-analyzer">
<title><literal>italian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>italian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "italian_elision": {
        "type":         "elision",
            "articles": [
                "c", "l", "all", "dall", "dell",
                "nell", "sull", "coll", "pell",
                "gl", "agl", "dagl", "degl", "negl",
                "sugl", "un", "m", "t", "s", "v", "d"
            ]
        },
        "italian_stop": {
          "type":       "stop",
          "stopwords":  "_italian_" <co id="CO257-1"/>
        },
        "italian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO257-2"/>
        },
        "italian_stemmer": {
          "type":       "stemmer",
          "language":   "light_italian"
        }
      },
      "analyzer": {
        "italian": {
          "tokenizer":  "standard",
          "filter": [
            "italian_elision",
            "lowercase",
            "italian_stop",
            "italian_keywords",
            "italian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO257-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO257-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="latvian-analyzer">
<title><literal>latvian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>latvian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "latvian_stop": {
          "type":       "stop",
          "stopwords":  "_latvian_" <co id="CO258-1"/>
        },
        "latvian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO258-2"/>
        },
        "latvian_stemmer": {
          "type":       "stemmer",
          "language":   "latvian"
        }
      },
      "analyzer": {
        "latvian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "latvian_stop",
            "latvian_keywords",
            "latvian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO258-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO258-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="lithuanian-analyzer">
<title><literal>lithuanian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>lithuanian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "lithuanian_stop": {
          "type":       "stop",
          "stopwords":  "_lithuanian_" <co id="CO259-1"/>
        },
        "lithuanian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO259-2"/>
        },
        "lithuanian_stemmer": {
          "type":       "stemmer",
          "language":   "lithuanian"
        }
      },
      "analyzer": {
        "lithuanian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "lithuanian_stop",
            "lithuanian_keywords",
            "lithuanian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO259-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO259-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="norwegian-analyzer">
<title><literal>norwegian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>norwegian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "norwegian_stop": {
          "type":       "stop",
          "stopwords":  "_norwegian_" <co id="CO260-1"/>
        },
        "norwegian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO260-2"/>
        },
        "norwegian_stemmer": {
          "type":       "stemmer",
          "language":   "norwegian"
        }
      },
      "analyzer": {
        "norwegian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "norwegian_stop",
            "norwegian_keywords",
            "norwegian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO260-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO260-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="persian-analyzer">
<title><literal>persian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>persian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "char_filter": {
        "zero_width_spaces": {
            "type":       "mapping",
            "mappings": [ "\\u200C=&gt; "] <co id="CO261-1"/>
        }
      },
      "filter": {
        "persian_stop": {
          "type":       "stop",
          "stopwords":  "_persian_" <co id="CO261-2"/>
        }
      },
      "analyzer": {
        "persian": {
          "tokenizer":     "standard",
          "char_filter": [ "zero_width_spaces" ],
          "filter": [
            "lowercase",
            "arabic_normalization",
            "persian_normalization",
            "persian_stop"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO261-1">
<para>
Replaces zero-width non-joiners with an ASCII space.
</para>
</callout>
<callout arearefs="CO261-2">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
</calloutlist>
</section>
<section id="portuguese-analyzer">
<title><literal>portuguese</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>portuguese</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "portuguese_stop": {
          "type":       "stop",
          "stopwords":  "_portuguese_" <co id="CO262-1"/>
        },
        "portuguese_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO262-2"/>
        },
        "portuguese_stemmer": {
          "type":       "stemmer",
          "language":   "light_portuguese"
        }
      },
      "analyzer": {
        "portuguese": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "portuguese_stop",
            "portuguese_keywords",
            "portuguese_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO262-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO262-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="romanian-analyzer">
<title><literal>romanian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>romanian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "romanian_stop": {
          "type":       "stop",
          "stopwords":  "_romanian_" <co id="CO263-1"/>
        },
        "romanian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO263-2"/>
        },
        "romanian_stemmer": {
          "type":       "stemmer",
          "language":   "romanian"
        }
      },
      "analyzer": {
        "romanian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "romanian_stop",
            "romanian_keywords",
            "romanian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO263-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO263-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="russian-analyzer">
<title><literal>russian</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>russian</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "russian_stop": {
          "type":       "stop",
          "stopwords":  "_russian_" <co id="CO264-1"/>
        },
        "russian_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO264-2"/>
        },
        "russian_stemmer": {
          "type":       "stemmer",
          "language":   "russian"
        }
      },
      "analyzer": {
        "russian": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "russian_stop",
            "russian_keywords",
            "russian_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO264-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO264-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="sorani-analyzer">
<title><literal>sorani</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>sorani</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "sorani_stop": {
          "type":       "stop",
          "stopwords":  "_sorani_" <co id="CO265-1"/>
        },
        "sorani_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO265-2"/>
        },
        "sorani_stemmer": {
          "type":       "stemmer",
          "language":   "sorani"
        }
      },
      "analyzer": {
        "sorani": {
          "tokenizer":  "standard",
          "filter": [
            "sorani_normalization",
            "lowercase",
            "sorani_stop",
            "sorani_keywords",
            "sorani_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO265-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO265-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="spanish-analyzer">
<title><literal>spanish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>spanish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "spanish_stop": {
          "type":       "stop",
          "stopwords":  "_spanish_" <co id="CO266-1"/>
        },
        "spanish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO266-2"/>
        },
        "spanish_stemmer": {
          "type":       "stemmer",
          "language":   "light_spanish"
        }
      },
      "analyzer": {
        "spanish": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "spanish_stop",
            "spanish_keywords",
            "spanish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO266-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO266-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="swedish-analyzer">
<title><literal>swedish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>swedish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "swedish_stop": {
          "type":       "stop",
          "stopwords":  "_swedish_" <co id="CO267-1"/>
        },
        "swedish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO267-2"/>
        },
        "swedish_stemmer": {
          "type":       "stemmer",
          "language":   "swedish"
        }
      },
      "analyzer": {
        "swedish": {
          "tokenizer":  "standard",
          "filter": [
            "lowercase",
            "swedish_stop",
            "swedish_keywords",
            "swedish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO267-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO267-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="turkish-analyzer">
<title><literal>turkish</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>turkish</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "turkish_stop": {
          "type":       "stop",
          "stopwords":  "_turkish_" <co id="CO268-1"/>
        },
        "turkish_lowercase": {
          "type":       "lowercase",
          "language":   "turkish"
        },
        "turkish_keywords": {
          "type":       "keyword_marker",
          "keywords":   [] <co id="CO268-2"/>
        },
        "turkish_stemmer": {
          "type":       "stemmer",
          "language":   "turkish"
        }
      },
      "analyzer": {
        "turkish": {
          "tokenizer":  "standard",
          "filter": [
            "apostrophe",
            "turkish_lowercase",
            "turkish_stop",
            "turkish_keywords",
            "turkish_stemmer"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO268-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
<callout arearefs="CO268-2">
<para>
This filter should be removed unless there are words which should
    be excluded from stemming.
</para>
</callout>
</calloutlist>
</section>
<section id="thai-analyzer">
<title><literal>thai</literal> analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/lang-analyzer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>thai</literal> analyzer could be reimplemented as a <literal>custom</literal> analyzer as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "settings": {
    "analysis": {
      "filter": {
        "thai_stop": {
          "type":       "stop",
          "stopwords":  "_thai_" <co id="CO269-1"/>
        }
      },
      "analyzer": {
        "thai": {
          "tokenizer":  "thai",
          "filter": [
            "lowercase",
            "thai_stop"
          ]
        }
      }
    }
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO269-1">
<para>
The default stopwords can be overridden with the <literal>stopwords</literal>
    or <literal>stopwords_path</literal> parameters.
</para>
</callout>
</calloutlist>
</section>
</section>
</section>
<section id="analysis-snowball-analyzer">
<title>Snowball Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/snowball-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>snowball</literal> that uses the
<link linkend="analysis-standard-tokenizer">standard tokenizer</link>, with
<link linkend="analysis-standard-tokenfilter">standard filter</link>,
<link linkend="analysis-lowercase-tokenfilter">lowercase filter</link>,
<link linkend="analysis-stop-tokenfilter">stop filter</link>, and
<link linkend="analysis-snowball-tokenfilter">snowball filter</link>.</simpara>
<simpara>The Snowball Analyzer is a stemming analyzer from Lucene that is
originally based on the snowball project from
<ulink url="http://snowballstem.org">snowballstem.org</ulink>.</simpara>
<simpara>Sample usage:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "type" : "snowball",
                    "language" : "English"
                }
            }
        }
    }
}</programlisting>
<simpara>The <literal>language</literal> parameter can have the same values as the
<link linkend="analysis-snowball-tokenfilter">snowball filter</link> and defaults to <literal>English</literal>. Note that not all the language
analyzers have a default set of stopwords provided.</simpara>
<simpara>The <literal>stopwords</literal> parameter can be used to provide stopwords for the
languages that have no defaults, or to simply replace the default set
with your custom list. Check <link linkend="analysis-stop-analyzer">Stop Analyzer</link>
for more details. A default set of stopwords for many of these
languages is available from for instance
<ulink url="https://github.com/apache/lucene-solr/tree/master/lucene/analysis/common/src/resources/org/apache/lucene/analysis/">here</ulink>
and
<ulink url="https://github.com/apache/lucene-solr/tree/master/lucene/analysis/common/src/resources/org/apache/lucene/analysis/snowball">here.</ulink></simpara>
<simpara>A sample configuration (in YAML format) specifying Swedish with
stopwords:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
           my_analyzer:
                type: snowball
                language: Swedish
                stopwords: "och,det,att,i,en,jag,hon,som,han,på,den,med,var,sig,för,så,till,är,men,ett,om,hade,de,av,icke,mig,du,henne,då,sin,nu,har,inte,hans,honom,skulle,hennes,där,min,man,ej,vid,kunde,något,från,ut,när,efter,upp,vi,dem,vara,vad,över,än,dig,kan,sina,här,ha,mot,alla,under,någon,allt,mycket,sedan,ju,denna,själv,detta,åt,utan,varit,hur,ingen,mitt,ni,bli,blev,oss,din,dessa,några,deras,blir,mina,samma,vilken,er,sådan,vår,blivit,dess,inom,mellan,sådant,varför,varje,vilka,ditt,vem,vilket,sitta,sådana,vart,dina,vars,vårt,våra,ert,era,vilkas"</programlisting>
</section>
<section id="analysis-custom-analyzer">
<title>Custom Analyzer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/analyzers/custom-analyzer.asciidoc">Edit me</ulink></title>
<simpara>An analyzer of type <literal>custom</literal> that allows to combine a <literal>Tokenizer</literal> with
zero or more <literal>Token Filters</literal>, and zero or more <literal>Char Filters</literal>. The
custom analyzer accepts a logical/registered name of the tokenizer to
use, and a list of logical/registered names of token filters.
The name of the custom analyzer must not start with "_".</simpara>
<simpara>The following are settings that can be set for a <literal>custom</literal> analyzer type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>tokenizer</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The logical / registered name of the tokenizer to use.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>filter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An optional list of logical / registered name of token
filters.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>char_filter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An optional list of logical / registered name of char
filters.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>position_increment_gap</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An optional number of positions to increment
between each value of a field using this analyzer. Defaults to 100.
100 was chosen because it prevents phrase queries with reasonably large
slops (less than 100) from matching terms across field values.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : myTokenizer1
                filter : [myTokenFilter1, myTokenFilter2]
                char_filter : [my_html]
                position_increment_gap: 256
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myTokenFilter2 :
                type : length
                min : 0
                max : 2000
        char_filter :
              my_html :
                type : html_strip
                escaped_tags : [xxx, yyy]
                read_ahead : 1024</programlisting>
</section>
</chapter>
<chapter id="analysis-tokenizers">
<title>Tokenizers<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers.asciidoc">Edit me</ulink></title>
<simpara>Tokenizers are used to break a string down into a stream of terms
or tokens. A simple tokenizer might split the string up into terms
wherever it encounters whitespace or punctuation.</simpara>
<simpara>Elasticsearch has a number of built in tokenizers which can be
used to build <link linkend="analysis-custom-analyzer">custom analyzers</link>.</simpara>
<section id="analysis-standard-tokenizer">
<title>Standard Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/standard-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>standard</literal> providing grammar based tokenizer that is
a good tokenizer for most European language documents. The tokenizer
implements the Unicode Text Segmentation algorithm, as specified in
<ulink url="http://unicode.org/reports/tr29/">Unicode Standard Annex #29</ulink>.</simpara>
<simpara>The following are settings that can be set for a <literal>standard</literal> tokenizer
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>max_token_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum token length. If a token is seen that
exceeds this length then it is split at <literal>max_token_length</literal> intervals. Defaults to <literal>255</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-edgengram-tokenizer">
<title>Edge NGram Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/edgengram-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>edgeNGram</literal>.</simpara>
<simpara>This tokenizer is very similar to <literal>nGram</literal> but only keeps n-grams which
start at the beginning of a token.</simpara>
<simpara>The following are settings that can be set for a <literal>edgeNGram</literal> tokenizer
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description </entry>
<entry align="left" valign="top">Default value</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>min_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Minimum size in codepoints of a single n-gram</simpara></entry>
<entry align="left" valign="top"><simpara><literal>1</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Maximum size in codepoints of a single n-gram</simpara></entry>
<entry align="left" valign="top"><simpara><literal>2</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>token_chars</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Characters classes to keep in the
tokens, Elasticsearch will split on characters that don&#8217;t belong to any
of these classes.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[]</literal> (Keep all characters)</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara><literal>token_chars</literal> accepts the following character classes:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>letter</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>a</literal>, <literal>b</literal>, <literal>ï</literal> or <literal>京</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>digit</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>3</literal> or <literal>7</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>whitespace</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>" "</literal> or <literal>"\n"</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>punctuation</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>!</literal> or <literal>"</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>symbol</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>$</literal> or <literal>√</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_example_5" renderas="sect3">Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/edgengram-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings" : {
            "analysis" : {
                "analyzer" : {
                    "my_edge_ngram_analyzer" : {
                        "tokenizer" : "my_edge_ngram_tokenizer"
                    }
                },
                "tokenizer" : {
                    "my_edge_ngram_tokenizer" : {
                        "type" : "edgeNGram",
                        "min_gram" : "2",
                        "max_gram" : "5",
                        "token_chars": [ "letter", "digit" ]
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=my_edge_ngram_analyzer' -d 'FC Schalke 04'
    # FC, Sc, Sch, Scha, Schal, 04</programlisting>
<bridgehead id="_literal_side_literal_deprecated" renderas="sect3"><literal>side</literal> deprecated<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/edgengram-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<simpara>There used to be a <literal>side</literal> parameter up to <literal>0.90.1</literal> but it is now deprecated. In
order to emulate the behavior of <literal>"side" : "BACK"</literal> a
<link linkend="analysis-reverse-tokenfilter"><literal>reverse</literal> token filter</link>  should be used together
with the <link linkend="analysis-edgengram-tokenfilter"><literal>edgeNGram</literal> token filter</link>. The
<literal>edgeNGram</literal> filter must be enclosed in <literal>reverse</literal> filters like this:</simpara>
<programlisting language="js" linenumbering="unnumbered">    "filter" : ["reverse", "edgeNGram", "reverse"]</programlisting>
<simpara>which essentially reverses the token, builds front <literal>EdgeNGrams</literal> and reverses
the ngram again. This has the same effect as the previous <literal>"side" : "BACK"</literal> setting.</simpara>
</section>
<section id="analysis-keyword-tokenizer">
<title>Keyword Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/keyword-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>keyword</literal> that emits the entire input as a single
output.</simpara>
<simpara>The following are settings that can be set for a <literal>keyword</literal> tokenizer
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>buffer_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The term buffer size. Defaults to <literal>256</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-letter-tokenizer">
<title>Letter Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/letter-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>letter</literal> that divides text at non-letters. That&#8217;s to
say, it defines tokens as maximal strings of adjacent letters. Note,
this does a decent job for most European languages, but does a terrible
job for some Asian languages, where words are not separated by spaces.</simpara>
</section>
<section id="analysis-lowercase-tokenizer">
<title>Lowercase Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/lowercase-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>lowercase</literal> that performs the function of
<link linkend="analysis-letter-tokenizer">Letter Tokenizer</link> and
<link linkend="analysis-lowercase-tokenfilter">Lower Case Token Filter</link> together. It divides text at non-letters and converts
them to lower case. While it is functionally equivalent to the
combination of
<link linkend="analysis-letter-tokenizer">Letter Tokenizer</link> and
<link linkend="analysis-lowercase-tokenfilter">Lower Case Token Filter</link>, there is a performance advantage to doing the two
tasks at once, hence this (redundant) implementation.</simpara>
</section>
<section id="analysis-ngram-tokenizer">
<title>NGram Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/ngram-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>nGram</literal>.</simpara>
<simpara>The following are settings that can be set for a <literal>nGram</literal> tokenizer type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description </entry>
<entry align="left" valign="top">Default value</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>min_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Minimum size in codepoints of a single n-gram</simpara></entry>
<entry align="left" valign="top"><simpara><literal>1</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Maximum size in codepoints of a single n-gram</simpara></entry>
<entry align="left" valign="top"><simpara><literal>2</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>token_chars</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Characters classes to keep in the
tokens, Elasticsearch will split on characters that don&#8217;t belong to any
of these classes.</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[]</literal> (Keep all characters)</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara><literal>token_chars</literal> accepts the following character classes:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>letter</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>a</literal>, <literal>b</literal>, <literal>ï</literal> or <literal>京</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>digit</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>3</literal> or <literal>7</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>whitespace</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>" "</literal> or <literal>"\n"</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>punctuation</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>!</literal> or <literal>"</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>symbol</literal>
</simpara>
</entry>
<entry>
<simpara>
for example <literal>$</literal> or <literal>√</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_example_6" renderas="sect3">Example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/ngram-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">    curl -XPUT 'localhost:9200/test' -d '
    {
        "settings" : {
            "analysis" : {
                "analyzer" : {
                    "my_ngram_analyzer" : {
                        "tokenizer" : "my_ngram_tokenizer"
                    }
                },
                "tokenizer" : {
                    "my_ngram_tokenizer" : {
                        "type" : "nGram",
                        "min_gram" : "2",
                        "max_gram" : "3",
                        "token_chars": [ "letter", "digit" ]
                    }
                }
            }
        }
    }'

    curl 'localhost:9200/test/_analyze?pretty=1&amp;analyzer=my_ngram_analyzer' -d 'FC Schalke 04'
    # FC, Sc, Sch, ch, cha, ha, hal, al, alk, lk, lke, ke, 04</programlisting>
</section>
<section id="analysis-whitespace-tokenizer">
<title>Whitespace Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/whitespace-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>whitespace</literal> that divides text at whitespace.</simpara>
</section>
<section id="analysis-pattern-tokenizer">
<title>Pattern Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/pattern-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>pattern</literal> tokenizer uses a regular expression to either split text into
terms whenever it matches a word separator, or to capture matching text as
terms.</simpara>
<simpara>The default pattern is <literal>\W+</literal>, which splits text whenever it encounters
non-word characters.</simpara>
<warning>
<title>Beware of Pathological Regular Expressions</title>
<simpara>The pattern tokenizer uses
<ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</ulink>.</simpara>
<simpara>A badly written regular expression could run very slowly or even throw a
StackOverflowError and cause the node it is running on to exit suddenly.</simpara>
<simpara>Read more about <ulink url="http://www.regular-expressions.info/catastrophic.html">pathological regular expressions and how to avoid them</ulink>.</simpara>
</warning>
<bridgehead id="_example_output_2" renderas="sect2">Example output<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/pattern-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">POST _analyze
{
  "tokenizer": "pattern",
  "text": "The foo_bar_size's default is 5."
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above sentence would produce the following terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ The, foo_bar_size, s, default, is, 5 ]</programlisting>
<bridgehead id="_configuration_2" renderas="sect2">Configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/pattern-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>pattern</literal> tokenizer accepts the following parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>pattern</literal>
</simpara>
</entry>
<entry>
<simpara>
    A <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java regular expression</ulink>, defaults to <literal>\W+</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flags</literal>
</simpara>
</entry>
<entry>
<simpara>
    Java regular expression <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#field.summary">flags</ulink>.
    lags should be pipe-separated, eg <literal>"CASE_INSENSITIVE|COMMENTS"</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>group</literal>
</simpara>
</entry>
<entry>
<simpara>
    Which capture group to extract as tokens.  Defaults to <literal>-1</literal> (split).
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_example_configuration_2" renderas="sect2">Example configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/pattern-tokenizer.asciidoc">Edit me</ulink></bridgehead>
<simpara>In this example, we configure the <literal>pattern</literal> tokenizer to break text into
tokens when it encounters commas:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_analyzer": {
          "tokenizer": "my_tokenizer"
        }
      },
      "tokenizer": {
        "my_tokenizer": {
          "type": "pattern",
          "pattern": ","
        }
      }
    }
  }
}

POST my_index/_analyze
{
  "analyzer": "my_analyzer",
  "text": "comma,separated,values"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above example produces the following terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ comma, separated, values ]</programlisting>
<simpara>In the next example, we configure the <literal>pattern</literal> tokenizer to capture values
enclosed in double quotes (ignoring embedded escaped quotes <literal>\"</literal>).  The regex
itself looks like this:</simpara>
<literallayout class="monospaced">"((?:\\"|[^"]|\\")*)"</literallayout>
<simpara>And reads as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
A literal <literal>"</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Start capturing:
</simpara>
<itemizedlist>
<listitem>
<simpara>
A literal <literal>\"</literal> OR any character except <literal>"</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Repeat until no more characters match
</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>
A literal closing <literal>"</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>When the pattern is specified in JSON, the <literal>"</literal> and <literal>\</literal> characters need to be
escaped, so the pattern ends up looking like:</simpara>
<literallayout class="monospaced">\"((?:\\\\\"|[^\"]|\\\\\")+)\"</literallayout>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_analyzer": {
          "tokenizer": "my_tokenizer"
        }
      },
      "tokenizer": {
        "my_tokenizer": {
          "type": "pattern",
          "pattern": "\"((?:\\\\\"|[^\"]|\\\\\")+)\"",
          "group": 1
        }
      }
    }
  }
}

POST my_index/_analyze
{
  "analyzer": "my_analyzer",
  "text": "\"value\", \"value with embedded \\\" quote\""
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above example produces the following two terms:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ value, value with embedded \" quote ]</programlisting>
</section>
<section id="analysis-uaxurlemail-tokenizer">
<title>UAX Email URL Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/uaxurlemail-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>uax_url_email</literal> which works exactly like the
<literal>standard</literal> tokenizer, but tokenizes emails and urls as single tokens.</simpara>
<simpara>The following are settings that can be set for a <literal>uax_url_email</literal>
tokenizer type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>max_token_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum token length. If a token is seen that
exceeds this length then it is discarded. Defaults to <literal>255</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-pathhierarchy-tokenizer">
<title>Path Hierarchy Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/pathhierarchy-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>The <literal>path_hierarchy</literal> tokenizer takes something like this:</simpara>
<screen>/something/something/else</screen>
<simpara>And produces tokens:</simpara>
<screen>/something
/something/something
/something/something/else</screen>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>delimiter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The character delimiter to use, defaults to <literal>/</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>replacement</literal></simpara></entry>
<entry align="left" valign="top"><simpara>An optional replacement character to use. Defaults to
the <literal>delimiter</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>buffer_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The buffer size to use, defaults to <literal>1024</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>reverse</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Generates tokens in reverse order, defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>skip</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Controls initial tokens to skip, defaults to <literal>0</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-classic-tokenizer">
<title>Classic Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/classic-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>classic</literal> providing grammar based tokenizer that is
a good tokenizer for English language documents. This tokenizer has
heuristics for special treatment of acronyms, company names, email addresses,
and internet host names. However, these rules don&#8217;t always work, and
the tokenizer doesn&#8217;t work well for most languages other than English.</simpara>
<simpara>The following are settings that can be set for a <literal>classic</literal> tokenizer
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>max_token_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum token length. If a token is seen that
exceeds this length then it is discarded. Defaults to <literal>255</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-thai-tokenizer">
<title>Thai Tokenizer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenizers/thai-tokenizer.asciidoc">Edit me</ulink></title>
<simpara>A tokenizer of type <literal>thai</literal> that segments Thai text into words. This tokenizer
uses the built-in Thai segmentation algorithm included with Java to divide
up Thai text. Text in other languages in general will be treated the same
as <literal>standard</literal>.</simpara>
</section>
</chapter>
<chapter id="analysis-tokenfilters">
<title>Token Filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters.asciidoc">Edit me</ulink></title>
<simpara>Token filters accept a stream of tokens from a
<link linkend="analysis-tokenizers">tokenizer</link> and can modify tokens
(eg lowercasing), delete tokens (eg remove stopwords)
or add tokens (eg synonyms).</simpara>
<simpara>Elasticsearch has a number of built in token filters which can be
used to build <link linkend="analysis-custom-analyzer">custom analyzers</link>.</simpara>
<section id="analysis-standard-tokenfilter">
<title>Standard Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/standard-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>standard</literal> that normalizes tokens extracted with
the
<link linkend="analysis-standard-tokenizer">Standard Tokenizer</link>.</simpara>
<tip>
<simpara>The <literal>standard</literal> token filter currently does nothing.  It remains as a placeholder
in case some filtering function needs to be added in a future version.</simpara>
</tip>
</section>
<section id="analysis-asciifolding-tokenfilter">
<title>ASCII Folding Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/asciifolding-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>asciifolding</literal> that converts alphabetic, numeric,
and symbolic Unicode characters which are not in the first 127 ASCII
characters (the "Basic Latin" Unicode block) into their ASCII
equivalents, if one exists.  Example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "asciifolding"]
            }
        }
    }
}</programlisting>
<simpara>Accepts <literal>preserve_original</literal> setting which defaults to false but if true
will keep the original token as well as emit the folded token.  For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "my_ascii_folding"]
            }
        },
        "filter" : {
            "my_ascii_folding" : {
                "type" : "asciifolding",
                "preserve_original" : true
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-length-tokenfilter">
<title>Length Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/length-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>length</literal> that removes words that are too long or
too short for the stream.</simpara>
<simpara>The following are settings that can be set for a <literal>length</literal> token filter
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>min</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The minimum number. Defaults to <literal>0</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum number. Defaults to <literal>Integer.MAX_VALUE</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-lowercase-tokenfilter">
<title>Lowercase Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/lowercase-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>lowercase</literal> that normalizes token text to lower
case.</simpara>
<simpara>Lowercase token filter supports Greek, Irish, and Turkish lowercase token
filters through the <literal>language</literal> parameter. Below is a usage example in a
custom analyzer</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : myTokenizer1
                filter : [myTokenFilter1, myGreekLowerCaseFilter]
                char_filter : [my_html]
        tokenizer :
            myTokenizer1 :
                type : standard
                max_token_length : 900
        filter :
            myTokenFilter1 :
                type : stop
                stopwords : [stop1, stop2, stop3, stop4]
            myGreekLowerCaseFilter :
                type : lowercase
                language : greek
        char_filter :
              my_html :
                type : html_strip
                escaped_tags : [xxx, yyy]
                read_ahead : 1024</programlisting>
</section>
<section id="analysis-uppercase-tokenfilter">
<title>Uppercase Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/uppercase-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>uppercase</literal> that normalizes token text to upper
case.</simpara>
</section>
<section id="analysis-ngram-tokenfilter">
<title>NGram Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/ngram-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>nGram</literal>.</simpara>
<simpara>The following are settings that can be set for a <literal>nGram</literal> token filter
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>min_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defaults to <literal>1</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defaults to <literal>2</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-edgengram-tokenfilter">
<title>Edge NGram Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/edgengram-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>edgeNGram</literal>.</simpara>
<simpara>The following are settings that can be set for a <literal>edgeNGram</literal> token
filter type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>min_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defaults to <literal>1</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max_gram</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defaults to <literal>2</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>side</literal></simpara></entry>
<entry align="left" valign="top"><simpara>deprecated. Either <literal>front</literal> or <literal>back</literal>. Defaults to <literal>front</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-porterstem-tokenfilter">
<title>Porter Stem Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/porterstem-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>porter_stem</literal> that transforms the token stream as
per the Porter stemming algorithm.</simpara>
<simpara>Note, the input to the stemming filter must already be in lower case, so
you will need to use
<link linkend="analysis-lowercase-tokenfilter">Lower Case Token Filter</link> or
<link linkend="analysis-lowercase-tokenizer">Lower Case Tokenizer</link> farther down the Tokenizer chain in order for this to
work properly!. For example, when using custom analyzer, make sure the
<literal>lowercase</literal> filter comes before the <literal>porter_stem</literal> filter in the list of
filters.</simpara>
</section>
<section id="analysis-shingle-tokenfilter">
<title>Shingle Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/shingle-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>shingle</literal> that constructs shingles (token
n-grams) from a token stream. In other words, it creates combinations of
tokens as a single token. For example, the sentence "please divide this
sentence into shingles" might be tokenized into shingles "please
divide", "divide this", "this sentence", "sentence into", and "into
shingles".</simpara>
<simpara>This filter handles position increments &gt; 1 by inserting filler tokens
(tokens with termtext "_"). It does not handle a position increment of
0.</simpara>
<simpara>The following are settings that can be set for a <literal>shingle</literal> token filter
type:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>max_shingle_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum shingle size. Defaults to <literal>2</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>min_shingle_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The minimum shingle size. Defaults to <literal>2</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>output_unigrams</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If <literal>true</literal> the output will contain the input tokens
(unigrams) as well as the shingles. Defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>output_unigrams_if_no_shingles</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If <literal>output_unigrams</literal> is <literal>false</literal> the
output will contain the input tokens (unigrams) if no shingles are
available. Note if <literal>output_unigrams</literal> is set to <literal>true</literal> this setting has
no effect. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>token_separator</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The string to use when joining adjacent tokens to
form a shingle. Defaults to <literal>" "</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>filler_token</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The string to use as a replacement for each position
at which there is no actual token in the stream. For instance this string is
used if the position increment is greater than one when a <literal>stop</literal> filter is used
together with the <literal>shingle</literal> filter. Defaults to <literal>"_"</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section id="analysis-stop-tokenfilter">
<title>Stop Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/stop-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>stop</literal> that removes stop words from token
streams.</simpara>
<simpara>The following are settings that can be set for a <literal>stop</literal> token filter
type:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>stopwords</literal>
</simpara>
</entry>
<entry>
<simpara>
    A list of stop words to use. Defaults to <literal>_english_</literal> stop words.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopwords_path</literal>
</simpara>
</entry>
<entry>
<simpara>
    A path (either relative to <literal>config</literal> location, or absolute) to a stopwords
    file configuration. Each stop word should be in its own "line" (separated
    by a line break). The file must be UTF-8 encoded.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ignore_case</literal>
</simpara>
</entry>
<entry>
<simpara>
    Set to <literal>true</literal> to lower case all words first. Defaults to <literal>false</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>remove_trailing</literal>
</simpara>
</entry>
<entry>
<simpara>
    Set to <literal>false</literal> in order to not ignore the last term of a search if it is a
    stop word. This is very useful for the completion suggester as a query
    like <literal>green a</literal> can be extended to <literal>green apple</literal> even though you remove
    stop words in general. Defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The <literal>stopwords</literal> parameter accepts either an array of stopwords:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
    "settings": {
        "analysis": {
            "filter": {
                "my_stop": {
                    "type":       "stop",
                    "stopwords": ["and", "is", "the"]
                }
            }
        }
    }
}</programlisting>
<simpara>or a predefined language-specific list:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
    "settings": {
        "analysis": {
            "filter": {
                "my_stop": {
                    "type":       "stop",
                    "stopwords":  "_english_"
                }
            }
        }
    }
}</programlisting>
<simpara>Elasticsearch provides the following predefined list of languages:</simpara>
<simpara><literal>_arabic_</literal>, <literal>_armenian_</literal>, <literal>_basque_</literal>, <literal>_brazilian_</literal>, <literal>_bulgarian_</literal>,
<literal>_catalan_</literal>, <literal>_czech_</literal>, <literal>_danish_</literal>, <literal>_dutch_</literal>, <literal>_english_</literal>, <literal>_finnish_</literal>,
<literal>_french_</literal>, <literal>_galician_</literal>, <literal>_german_</literal>, <literal>_greek_</literal>, <literal>_hindi_</literal>, <literal>_hungarian_</literal>,
<literal>_indonesian_</literal>, <literal>_irish_</literal>, <literal>_italian_</literal>, <literal>_latvian_</literal>, <literal>_norwegian_</literal>, <literal>_persian_</literal>,
<literal>_portuguese_</literal>, <literal>_romanian_</literal>, <literal>_russian_</literal>, <literal>_sorani_</literal>, <literal>_spanish_</literal>,
<literal>_swedish_</literal>, <literal>_thai_</literal>, <literal>_turkish_</literal>.</simpara>
<simpara>For the empty stopwords list (to disable stopwords) use: <literal>_none_</literal>.</simpara>
</section>
<section id="analysis-word-delimiter-tokenfilter">
<title>Word Delimiter Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/word-delimiter-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Named <literal>word_delimiter</literal>, it Splits words into subwords and performs
optional transformations on subword groups. Words are split into
subwords with the following rules:</simpara>
<itemizedlist>
<listitem>
<simpara>
split on intra-word delimiters (by default, all non alpha-numeric
characters).
</simpara>
</listitem>
<listitem>
<simpara>
"Wi-Fi" &#8594; "Wi", "Fi"
</simpara>
</listitem>
<listitem>
<simpara>
split on case transitions: "PowerShot" &#8594; "Power", "Shot"
</simpara>
</listitem>
<listitem>
<simpara>
split on letter-number transitions: "SD500" &#8594; "SD", "500"
</simpara>
</listitem>
<listitem>
<simpara>
leading and trailing intra-word delimiters on each subword are
ignored: "//hello---there, <emphasis>dude</emphasis>" &#8594; "hello", "there", "dude"
</simpara>
</listitem>
<listitem>
<simpara>
trailing "'s" are removed for each subword: "O&#8217;Neil&#8217;s" &#8594; "O", "Neil"
</simpara>
</listitem>
</itemizedlist>
<simpara>Parameters include:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>generate_word_parts</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes parts of words to be
    generated: "PowerShot" &#8658; "Power" "Shot". Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>generate_number_parts</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes number subwords to be
    generated: "500-42" &#8658; "500" "42". Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>catenate_words</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes maximum runs of word parts to be
    catenated: "wi-fi" &#8658; "wifi". Defaults to <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>catenate_numbers</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes maximum runs of number parts to
    be catenated: "500-42" &#8658; "50042". Defaults to <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>catenate_all</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes all subword parts to be catenated:
    "wi-fi-4000" &#8658; "wifi4000". Defaults to <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>split_on_case_change</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes "PowerShot" to be two tokens;
    ("Power-Shot" remains two parts regards). Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>preserve_original</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> includes original words in subwords:
    "500-42" &#8658; "500-42" "500" "42". Defaults to <literal>false</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>split_on_numerics</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes "j2se" to be three tokens; "j"
    "2" "se". Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>stem_english_possessive</literal>
</term>
<listitem>
<simpara>
    If <literal>true</literal> causes trailing "'s" to be
    removed for each subword: "O&#8217;Neil&#8217;s" &#8658; "O", "Neil". Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Advance settings include:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>protected_words</literal>
</term>
<listitem>
<simpara>
    A list of protected words from being delimiter.
    Either an array, or also can set <literal>protected_words_path</literal> which resolved
    to a file configured with protected words (one on each line).
    Automatically resolves to <literal>config/</literal> based location if exists.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>type_table</literal>
</term>
<listitem>
<simpara>
    A custom type mapping table, for example (when configured
    using <literal>type_table_path</literal>):
</simpara>
</listitem>
</varlistentry>
</variablelist>
<programlisting language="js" linenumbering="unnumbered">    # Map the $, %, '.', and ',' characters to DIGIT
    # This might be useful for financial data.
    $ =&gt; DIGIT
    % =&gt; DIGIT
    . =&gt; DIGIT
    \\u002C =&gt; DIGIT

    # in some cases you might not want to split on ZWJ
    # this also tests the case where we need a bigger byte[]
    # see http://en.wikipedia.org/wiki/Zero-width_joiner
    \\u200D =&gt; ALPHANUM</programlisting>
<note><simpara>Using a tokenizer like the <literal>standard</literal> tokenizer may interfere with
the <literal>catenate_*</literal> and <literal>preserve_original</literal> parameters, as the original
string may already have lost punctuation during tokenization.  Instead,
you may want to use the <literal>whitespace</literal> tokenizer.</simpara></note>
</section>
<section id="analysis-stemmer-tokenfilter">
<title>Stemmer Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/stemmer-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A filter that provides access to (almost) all of the available stemming token
filters through a single unified interface. For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "my_stemmer"]
                }
            },
            "filter" : {
                "my_stemmer" : {
                    "type" : "stemmer",
                    "name" : "light_german"
                }
            }
        }
    }
}</programlisting>
<simpara>The <literal>language</literal>/<literal>name</literal> parameter controls the stemmer with the following
available values (the preferred filters are marked in <emphasis role="strong">bold</emphasis>):</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
Arabic
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/ar/ArabicStemmer.html"><emphasis role="strong"><literal>arabic</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Armenian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/armenian/stemmer.html"><emphasis role="strong"><literal>armenian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Basque
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/basque/stemmer.html"><emphasis role="strong"><literal>basque</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Brazilian Portuguese
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/br/BrazilianStemmer.html"><emphasis role="strong"><literal>brazilian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Bulgarian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://members.unine.ch/jacques.savoy/Papers/BUIR.pdf"><emphasis role="strong"><literal>bulgarian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Catalan
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/catalan/stemmer.html"><emphasis role="strong"><literal>catalan</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Czech
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://portal.acm.org/citation.cfm?id=1598600"><emphasis role="strong"><literal>czech</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Danish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/danish/stemmer.html"><emphasis role="strong"><literal>danish</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Dutch
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/dutch/stemmer.html"><emphasis role="strong"><literal>dutch</literal></emphasis></ulink>,
<ulink url="http://snowball.tartarus.org/algorithms/kraaij_pohlmann/stemmer.html"><literal>dutch_kp</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
English
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/porter/stemmer.html"><emphasis role="strong"><literal>english</literal></emphasis></ulink>,
<ulink url="http://ciir.cs.umass.edu/pubfiles/ir-35.pdf"><literal>light_english</literal></ulink>,
<ulink url="http://www.researchgate.net/publication/220433848_How_effective_is_suffixing"><literal>minimal_english</literal></ulink>,
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/en/EnglishPossessiveFilter.html"><literal>possessive_english</literal></ulink>,
<ulink url="http://snowball.tartarus.org/algorithms/english/stemmer.html"><literal>porter2</literal></ulink>,
<ulink url="http://snowball.tartarus.org/algorithms/lovins/stemmer.html"><literal>lovins</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Finnish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/finnish/stemmer.html"><emphasis role="strong"><literal>finnish</literal></emphasis></ulink>,
<ulink url="http://clef.isti.cnr.it/2003/WN_web/22.pdf"><literal>light_finnish</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
French
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/french/stemmer.html"><literal>french</literal></ulink>,
<ulink url="http://dl.acm.org/citation.cfm?id=1141523"><emphasis role="strong"><literal>light_french</literal></emphasis></ulink>,
<ulink url="http://dl.acm.org/citation.cfm?id=318984"><literal>minimal_french</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Galician
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://bvg.udc.es/recursos_lingua/stemming.jsp"><emphasis role="strong"><literal>galician</literal></emphasis></ulink>,
<ulink url="http://bvg.udc.es/recursos_lingua/stemming.jsp"><literal>minimal_galician</literal></ulink> (Plural step only)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
German
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/german/stemmer.html"><literal>german</literal></ulink>,
<ulink url="http://snowball.tartarus.org/algorithms/german2/stemmer.html"><literal>german2</literal></ulink>,
<ulink url="http://dl.acm.org/citation.cfm?id=1141523"><emphasis role="strong"><literal>light_german</literal></emphasis></ulink>,
<ulink url="http://members.unine.ch/jacques.savoy/clef/morpho.pdf"><literal>minimal_german</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Greek
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://sais.se/mthprize/2007/ntais2007.pdf"><emphasis role="strong"><literal>greek</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Hindi
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://computing.open.ac.uk/Sites/EACLSouthAsia/Papers/p6-Ramanathan.pdf"><emphasis role="strong"><literal>hindi</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Hungarian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/hungarian/stemmer.html"><emphasis role="strong"><literal>hungarian</literal></emphasis></ulink>,
<ulink url="http://dl.acm.org/citation.cfm?id=1141523&amp;dl=ACM&amp;coll=DL&amp;CFID=179095584&amp;CFTOKEN=80067181"><literal>light_hungarian</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Indonesian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://www.illc.uva.nl/Publications/ResearchReports/MoL-2003-02.text.pdf"><emphasis role="strong"><literal>indonesian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Irish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/otherapps/oregan/intro.html"><emphasis role="strong"><literal>irish</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Italian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/italian/stemmer.html"><literal>italian</literal></ulink>,
<ulink url="http://www.ercim.eu/publication/ws-proceedings/CLEF2/savoy.pdf"><emphasis role="strong"><literal>light_italian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Kurdish (Sorani)
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/ckb/SoraniStemmer.html"><emphasis role="strong"><literal>sorani</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Latvian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/lv/LatvianStemmer.html"><emphasis role="strong"><literal>latvian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Lithuanian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://svn.apache.org/viewvc/lucene/dev/branches/lucene_solr_5_3/lucene/analysis/common/src/java/org/apache/lucene/analysis/lt/stem_ISO_8859_1.sbl?view=markup"><emphasis role="strong"><literal>lithuanian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Norwegian (Bokmål)
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/norwegian/stemmer.html"><emphasis role="strong"><literal>norwegian</literal></emphasis></ulink>,
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/no/NorwegianLightStemmer.html"><emphasis role="strong"><literal>light_norwegian</literal></emphasis></ulink>,
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/no/NorwegianMinimalStemmer.html"><literal>minimal_norwegian</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Norwegian (Nynorsk)
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/no/NorwegianLightStemmer.html"><emphasis role="strong"><literal>light_nynorsk</literal></emphasis></ulink>,
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/no/NorwegianMinimalStemmer.html"><literal>minimal_nynorsk</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Portuguese
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/portuguese/stemmer.html"><literal>portuguese</literal></ulink>,
<ulink url="http://dl.acm.org/citation.cfm?id=1141523&amp;dl=ACM&amp;coll=DL&amp;CFID=179095584&amp;CFTOKEN=80067181"><emphasis role="strong"><literal>light_portuguese</literal></emphasis></ulink>,
<ulink url="http://www.inf.ufrgs.br/~buriol/papers/Orengo_CLEF07.pdf"><literal>minimal_portuguese</literal></ulink>,
<ulink url="http://www.inf.ufrgs.br/\~viviane/rslp/index.htm"><literal>portuguese_rslp</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Romanian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/romanian/stemmer.html"><emphasis role="strong"><literal>romanian</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Russian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/russian/stemmer.html"><emphasis role="strong"><literal>russian</literal></emphasis></ulink>,
<ulink url="http://doc.rero.ch/lm.php?url=1000%2C43%2C4%2C20091209094227-CA%2FDolamic_Ljiljana_-_Indexing_and_Searching_Strategies_for_the_Russian_20091209.pdf"><literal>light_russian</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Spanish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/spanish/stemmer.html"><literal>spanish</literal></ulink>,
<ulink url="http://www.ercim.eu/publication/ws-proceedings/CLEF2/savoy.pdf"><emphasis role="strong"><literal>light_spanish</literal></emphasis></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Swedish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/swedish/stemmer.html"><emphasis role="strong"><literal>swedish</literal></emphasis></ulink>,
<ulink url="http://clef.isti.cnr.it/2003/WN_web/22.pdf"><literal>light_swedish</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Turkish
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://snowball.tartarus.org/algorithms/turkish/stemmer.html"><emphasis role="strong"><literal>turkish</literal></emphasis></ulink>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="analysis-stemmer-override-tokenfilter">
<title>Stemmer Override Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/stemmer-override-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Overrides stemming algorithms, by applying a custom mapping, then
protecting these terms from being modified by stemmers. Must be placed
before any stemming filters.</simpara>
<simpara>Rules are separated by <literal>=&gt;</literal></simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>rules</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A list of mapping rules to use.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>rules_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A path (either relative to <literal>config</literal> location, or
absolute) to a list of mappings.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, custom_stems, porter_stem]
        filter:
            custom_stems:
                type: stemmer_override
                rules_path : analysis/custom_stems.txt</programlisting>
</section>
<section id="analysis-keyword-marker-tokenfilter">
<title>Keyword Marker Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keyword-marker-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Protects words from being modified by stemmers. Must be placed before
any stemming filters.</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>keywords</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A list of words to use.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>keywords_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A path (either relative to <literal>config</literal> location, or
absolute) to a list of words.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ignore_case</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>true</literal> to lower case all words first. Defaults to
<literal>false</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, protwords, porter_stem]
        filter :
            protwords :
                type : keyword_marker
                keywords_path : analysis/protwords.txt</programlisting>
</section>
<section id="analysis-keyword-repeat-tokenfilter">
<title>Keyword Repeat Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keyword-repeat-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>keyword_repeat</literal> token filter Emits each incoming token twice once
as keyword and once as a non-keyword to allow an unstemmed version of a
term to be indexed side by side with the stemmed version of the term.
Given the nature of this filter each token that isn&#8217;t transformed by a
subsequent stemmer will be indexed twice. Therefore, consider adding a
<literal>unique</literal> filter with <literal>only_on_same_position</literal> set to <literal>true</literal> to drop
unnecessary duplicates.</simpara>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, keyword_repeat, porter_stem, unique_stem]
            unique_stem:
                type: unique
                only_on_same_position : true</programlisting>
</section>
<section id="analysis-kstem-tokenfilter">
<title>KStem Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/kstem-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>kstem</literal> token filter is a high performance filter for english. All
terms must already be lowercased (use <literal>lowercase</literal> filter) for this
filter to work correctly.</simpara>
</section>
<section id="analysis-snowball-tokenfilter">
<title>Snowball Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/snowball-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A filter that stems words using a Snowball-generated stemmer. The
<literal>language</literal> parameter controls the stemmer with the following available
values: <literal>Armenian</literal>, <literal>Basque</literal>, <literal>Catalan</literal>, <literal>Danish</literal>, <literal>Dutch</literal>, <literal>English</literal>,
<literal>Finnish</literal>, <literal>French</literal>, <literal>German</literal>, <literal>German2</literal>, <literal>Hungarian</literal>, <literal>Italian</literal>, <literal>Kp</literal>,
<literal>Lithuanian</literal>, <literal>Lovins</literal>, <literal>Norwegian</literal>, <literal>Porter</literal>, <literal>Portuguese</literal>, <literal>Romanian</literal>,
<literal>Russian</literal>, <literal>Spanish</literal>, <literal>Swedish</literal>, <literal>Turkish</literal>.</simpara>
<simpara>For example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "my_snow"]
                }
            },
            "filter" : {
                "my_snow" : {
                    "type" : "snowball",
                    "language" : "Lovins"
                }
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-phonetic-tokenfilter">
<title>Phonetic Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/phonetic-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>phonetic</literal> token filter is provided as the <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/analysis-phonetic.html"><literal>analysis-phonetic</literal></ulink> plugin.</simpara>
</section>
<section id="analysis-synonym-tokenfilter">
<title>Synonym Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/synonym-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>synonym</literal> token filter allows to easily handle synonyms during the
analysis process. Synonyms are configured using a configuration file.
Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "synonym" : {
                    "tokenizer" : "whitespace",
                    "filter" : ["synonym"]
                }
            },
            "filter" : {
                "synonym" : {
                    "type" : "synonym",
                    "synonyms_path" : "analysis/synonym.txt"
                }
            }
        }
    }
}</programlisting>
<simpara>The above configures a <literal>synonym</literal> filter, with a path of
<literal>analysis/synonym.txt</literal> (relative to the <literal>config</literal> location). The
<literal>synonym</literal> analyzer is then configured with the filter. Additional
settings are: <literal>ignore_case</literal> (defaults to <literal>false</literal>), and <literal>expand</literal>
(defaults to <literal>true</literal>).</simpara>
<simpara>The <literal>tokenizer</literal> parameter controls the tokenizers that will be used to
tokenize the synonym, and defaults to the <literal>whitespace</literal> tokenizer.</simpara>
<simpara>Two synonym formats are supported: Solr, WordNet.</simpara>
<bridgehead id="_solr_synonyms" renderas="sect3">Solr synonyms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/synonym-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following is a sample format of the file:</simpara>
<programlisting language="js" linenumbering="unnumbered"># Blank lines and lines starting with pound are comments.

# Explicit mappings match any token sequence on the LHS of "=&gt;"
# and replace with all alternatives on the RHS.  These types of mappings
# ignore the expand parameter in the schema.
# Examples:
i-pod, i pod =&gt; ipod,
sea biscuit, sea biscit =&gt; seabiscuit

# Equivalent synonyms may be separated with commas and give
# no explicit mapping.  In this case the mapping behavior will
# be taken from the expand parameter in the schema.  This allows
# the same synonym file to be used in different synonym handling strategies.
# Examples:
ipod, i-pod, i pod
foozball , foosball
universe , cosmos

# If expand==true, "ipod, i-pod, i pod" is equivalent
# to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod, i-pod, i pod
# If expand==false, "ipod, i-pod, i pod" is equivalent
# to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod

# Multiple synonym mapping entries are merged.
foo =&gt; foo bar
foo =&gt; baz
# is equivalent to
foo =&gt; foo bar, baz</programlisting>
<simpara>You can also define synonyms for the filter directly in the
configuration file (note use of <literal>synonyms</literal> instead of <literal>synonyms_path</literal>):</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "filter" : {
        "synonym" : {
            "type" : "synonym",
            "synonyms" : [
                "i-pod, i pod =&gt; ipod",
                "universe, cosmos"
            ]
        }
    }
}</programlisting>
<simpara>However, it is recommended to define large synonyms set in a file using
<literal>synonyms_path</literal>, because specifying them inline increases cluster size unnecessarily.</simpara>
<bridgehead id="_wordnet_synonyms" renderas="sect3">WordNet synonyms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/synonym-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>Synonyms based on <ulink url="http://wordnet.princeton.edu/">WordNet</ulink> format can be
declared using <literal>format</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "filter" : {
        "synonym" : {
            "type" : "synonym",
            "format" : "wordnet",
            "synonyms" : [
                "s(100000001,1,'abstain',v,1,0).",
                "s(100000001,2,'refrain',v,1,0).",
                "s(100000001,3,'desist',v,1,0)."
            ]
        }
    }
}</programlisting>
<simpara>Using <literal>synonyms_path</literal> to define WordNet synonyms in a file is supported
as well.</simpara>
</section>
<section id="analysis-compound-word-tokenfilter">
<title>Compound Word Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/compound-word-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>hyphenation_decompounder</literal> and <literal>dictionary_decompounder</literal> token filters can
decompose compound words found in many German languages into word parts.</simpara>
<simpara>Both token filters require a dictionary of word parts, which can be provided
as:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>word_list</literal>
</simpara>
</entry>
<entry>
<simpara>
An array of words, specified inline in the token filter configuration, or
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>word_list_path</literal>
</simpara>
</entry>
<entry>
<simpara>
The path (either absolute or relative to the <literal>config</literal> directory) to a UTF-8
encoded file containing one word per line.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_hyphenation_decompounder" renderas="sect2">Hyphenation decompounder<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/compound-word-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>hyphenation_decompounder</literal> uses hyphenation grammars to find potential
subwords that are then checked against the word dictionary. The quality of the
output tokens is directly connected to the quality of the grammar file you
use. For languages like German they are quite good.</simpara>
<simpara>XML based hyphenation grammar files can be found in the
<ulink url="http://offo.sourceforge.net/hyphenation/#FOP+XML+Hyphenation+Patterns">Objects For Formatting Objects</ulink>
(OFFO) Sourceforge project. Currently only FOP v1.2 compatible hyphenation files
are supported. You can download <ulink url="https://sourceforge.net/projects/offo/files/offo-hyphenation/1.2/offo-hyphenation_v1.2.zip/download">offo-hyphenation_v1.2.zip</ulink>
directly and look in the <literal>offo-hyphenation/hyph/</literal> directory.
Credits for the hyphenation code go to the Apache FOP project .</simpara>
<bridgehead id="_dictionary_decompounder" renderas="sect2">Dictionary decompounder<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/compound-word-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>dictionary_decompounder</literal> uses a brute force approach in conjunction with
only the word dictionary to find subwords in a compound word. It is much
slower than the hyphenation decompounder but can be used as a first start to
check the quality of your dictionary.</simpara>
<bridgehead id="_compound_token_filter_parameters" renderas="sect2">Compound token filter parameters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/compound-word-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following parameters can be used to configure a compound word token
filter:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>type</literal>
</simpara>
</entry>
<entry>
<simpara>
Either <literal>dictionary_decompounder</literal> or <literal>hyphenation_decompounder</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>word_list</literal>
</simpara>
</entry>
<entry>
<simpara>
A array containing a list of words to use for the word dictionary.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>word_list_path</literal>
</simpara>
</entry>
<entry>
<simpara>
The path (either absolute or relative to the <literal>config</literal> directory) to the word dictionary.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>hyphenation_patterns_path</literal>
</simpara>
</entry>
<entry>
<simpara>
The path (either absolute or relative to the <literal>config</literal> directory) to a FOP XML hyphenation pattern file. (required for hyphenation)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_word_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Minimum word size. Defaults to 5.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>min_subword_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Minimum subword size. Defaults to 2.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_subword_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Maximum subword size. Defaults to 15.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>only_longest_match</literal>
</simpara>
</entry>
<entry>
<simpara>
Whether to include only the longest matching subword or not.  Defaults to <literal>false</literal>
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer2 :
                type : custom
                tokenizer : standard
                filter : [myTokenFilter1, myTokenFilter2]
        filter :
            myTokenFilter1 :
                type : dictionary_decompounder
                word_list: [one, two, three]
            myTokenFilter2 :
                type : hyphenation_decompounder
                word_list_path: path/to/words.txt
                hyphenation_patterns_path: path/to/fop.xml
                max_subword_size : 22</programlisting>
</section>
<section id="analysis-reverse-tokenfilter">
<title>Reverse Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/reverse-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>reverse</literal> that simply reverses each token.</simpara>
</section>
<section id="analysis-elision-tokenfilter">
<title>Elision Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/elision-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter which removes elisions. For example, "l&#8217;avion" (the
plane) will tokenized as "avion" (plane).</simpara>
<simpara>Accepts <literal>articles</literal> setting which is a set of stop words articles. For
example:</simpara>
<programlisting language="js" linenumbering="unnumbered">"index" : {
    "analysis" : {
        "analyzer" : {
            "default" : {
                "tokenizer" : "standard",
                "filter" : ["standard", "elision"]
            }
        },
        "filter" : {
            "elision" : {
                "type" : "elision",
                "articles" : ["l", "m", "t", "qu", "n", "s", "j"]
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-truncate-tokenfilter">
<title>Truncate Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/truncate-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>truncate</literal> token filter can be used to truncate tokens into a
specific length. This can come in handy with keyword (single token)
based mapped fields that are used for sorting in order to reduce memory
usage.</simpara>
<simpara>It accepts a <literal>length</literal> parameter which control the number of characters
to truncate to, defaults to <literal>10</literal>.</simpara>
</section>
<section id="analysis-unique-tokenfilter">
<title>Unique Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/unique-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>unique</literal> token filter can be used to only index unique tokens during
analysis. By default it is applied on all the token stream. If
<literal>only_on_same_position</literal> is set to <literal>true</literal>, it will only remove duplicate
tokens on the same position.</simpara>
</section>
<section id="analysis-pattern-capture-tokenfilter">
<title>Pattern Capture Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/pattern-capture-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>pattern_capture</literal> token filter, unlike the <literal>pattern</literal> tokenizer,
emits a token for every capture group in the regular expression.
Patterns are not anchored to the beginning and end of the string, so
each pattern can match multiple times, and matches are allowed to
overlap.</simpara>
<warning>
<title>Beware of Pathological Regular Expressions</title>
<simpara>The pattern capture token filter uses
<ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</ulink>.</simpara>
<simpara>A badly written regular expression could run very slowly or even throw a
StackOverflowError and cause the node it is running on to exit suddenly.</simpara>
<simpara>Read more about <ulink url="http://www.regular-expressions.info/catastrophic.html">pathological regular expressions and how to avoid them</ulink>.</simpara>
</warning>
<simpara>For instance a pattern like :</simpara>
<programlisting language="js" linenumbering="unnumbered">"(([a-z]+)(\d*))"</programlisting>
<simpara>when matched against:</simpara>
<programlisting language="js" linenumbering="unnumbered">"abc123def456"</programlisting>
<simpara>would produce the tokens: [ <literal>abc123</literal>, <literal>abc</literal>, <literal>123</literal>, <literal>def456</literal>, <literal>def</literal>,
<literal>456</literal> ]</simpara>
<simpara>If <literal>preserve_original</literal> is set to <literal>true</literal> (the default) then it would also
emit the original token: <literal>abc123def456</literal>.</simpara>
<simpara>This is particularly useful for indexing text like camel-case code, eg
<literal>stripHTML</literal> where a user may search for <literal>"strip html"</literal> or <literal>"striphtml"</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/  -d '
{
   "settings" : {
      "analysis" : {
         "filter" : {
            "code" : {
               "type" : "pattern_capture",
               "preserve_original" : 1,
               "patterns" : [
                  "(\\p{Ll}+|\\p{Lu}\\p{Ll}+|\\p{Lu}+)",
                  "(\\d+)"
               ]
            }
         },
         "analyzer" : {
            "code" : {
               "tokenizer" : "pattern",
               "filter" : [ "code", "lowercase" ]
            }
         }
      }
   }
}
'</programlisting>
<simpara>When used to analyze the text</simpara>
<programlisting language="js" linenumbering="unnumbered">import static org.apache.commons.lang.StringEscapeUtils.escapeHtml</programlisting>
<simpara>this emits the tokens: [ <literal>import</literal>, <literal>static</literal>, <literal>org</literal>, <literal>apache</literal>, <literal>commons</literal>,
<literal>lang</literal>, <literal>stringescapeutils</literal>, <literal>string</literal>, <literal>escape</literal>, <literal>utils</literal>, <literal>escapehtml</literal>,
<literal>escape</literal>, <literal>html</literal> ]</simpara>
<simpara>Another example is analyzing email addresses:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/test/  -d '
{
   "settings" : {
      "analysis" : {
         "filter" : {
            "email" : {
               "type" : "pattern_capture",
               "preserve_original" : 1,
               "patterns" : [
                  "([^@]+)",
                  "(\\p{L}+)",
                  "(\\d+)",
                  "@(.+)"
               ]
            }
         },
         "analyzer" : {
            "email" : {
               "tokenizer" : "uax_url_email",
               "filter" : [ "email", "lowercase",  "unique" ]
            }
         }
      }
   }
}
'</programlisting>
<simpara>When the above analyzer is used on an email address like:</simpara>
<programlisting language="js" linenumbering="unnumbered">john-smith_123@foo-bar.com</programlisting>
<simpara>it would produce the following tokens:</simpara>
<literallayout class="monospaced">john-smith_123@foo-bar.com, john-smith_123,
john, smith, 123, foo-bar.com, foo, bar, com</literallayout>
<simpara>Multiple patterns are required to allow overlapping captures, but also
means that patterns are less dense and easier to understand.</simpara>
<simpara><emphasis role="strong">Note:</emphasis> All tokens are emitted in the same position, and with the same
character offsets, so when combined with highlighting, the whole
original token will be highlighted, not just the matching subset. For
instance, querying the above email address for <literal>"smith"</literal> would
highlight:</simpara>
<programlisting language="js" linenumbering="unnumbered">  &lt;em&gt;john-smith_123@foo-bar.com&lt;/em&gt;</programlisting>
<simpara>not:</simpara>
<programlisting language="js" linenumbering="unnumbered">  john-&lt;em&gt;smith&lt;/em&gt;_123@foo-bar.com</programlisting>
</section>
<section id="analysis-pattern_replace-tokenfilter">
<title>Pattern Replace Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/pattern_replace-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>pattern_replace</literal> token filter allows to easily handle string
replacements based on a regular expression. The regular expression is
defined using the <literal>pattern</literal> parameter, and the replacement string can be
provided using the <literal>replacement</literal> parameter (supporting referencing the
original text, as explained
<ulink url="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)">here</ulink>).</simpara>
<warning>
<title>Beware of Pathological Regular Expressions</title>
<simpara>The pattern replace token filter uses
<ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</ulink>.</simpara>
<simpara>A badly written regular expression could run very slowly or even throw a
StackOverflowError and cause the node it is running on to exit suddenly.</simpara>
<simpara>Read more about <ulink url="http://www.regular-expressions.info/catastrophic.html">pathological regular expressions and how to avoid them</ulink>.</simpara>
</warning>
</section>
<section id="analysis-trim-tokenfilter">
<title>Trim Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/trim-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>trim</literal> token filter trims the whitespace surrounding a token.</simpara>
</section>
<section id="analysis-limit-token-count-tokenfilter">
<title>Limit Token Count Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/limit-token-count-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Limits the number of tokens that are indexed per document and field.</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>max_token_count</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum number of tokens that should be indexed
per document and field. The default is <literal>1</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>consume_all_tokens</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If set to <literal>true</literal> the filter exhaust the stream
even if <literal>max_token_count</literal> tokens have been consumed already. The default
is <literal>false</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            myAnalyzer :
                type : custom
                tokenizer : standard
                filter : [lowercase, five_token_limit]
        filter :
            five_token_limit :
                type : limit
                max_token_count : 5</programlisting>
</section>
<section id="analysis-hunspell-tokenfilter">
<title>Hunspell Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/hunspell-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Basic support for hunspell stemming. Hunspell dictionaries will be
picked up from a dedicated hunspell directory on the filesystem
(<literal>&lt;path.conf&gt;/hunspell</literal>). Each dictionary is expected to
have its own directory named after its associated locale (language).
This dictionary directory is expected to hold a single <literal>*.aff</literal> and
one or more <literal>*.dic</literal> files (all of which will automatically be picked up).
For example, assuming the default hunspell location is used, the
following directory layout will define the <literal>en_US</literal> dictionary:</simpara>
<programlisting language="js" linenumbering="unnumbered">- conf
    |-- hunspell
    |    |-- en_US
    |    |    |-- en_US.dic
    |    |    |-- en_US.aff</programlisting>
<simpara>Each dictionary can be configured with one setting:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>ignore_case</literal>
</term>
<listitem>
<simpara>
    If true, dictionary matching will be case insensitive
    (defaults to <literal>false</literal>)
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>This setting can be configured globally in <literal>elasticsearch.yml</literal> using</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>indices.analysis.hunspell.dictionary.ignore_case</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>or for specific dictionaries:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>indices.analysis.hunspell.dictionary.en_US.ignore_case</literal>.
</simpara>
</listitem>
</itemizedlist>
<simpara>It is also possible to add <literal>settings.yml</literal> file under the dictionary
directory which holds these settings (this will override any other
settings defined in the <literal>elasticsearch.yml</literal>).</simpara>
<simpara>One can use the hunspell stem filter by configuring it the analysis
settings:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "analysis" : {
        "analyzer" : {
            "en" : {
                "tokenizer" : "standard",
                "filter" : [ "lowercase", "en_US" ]
            }
        },
        "filter" : {
            "en_US" : {
                "type" : "hunspell",
                "locale" : "en_US",
                "dedup" : true
            }
        }
    }
}</programlisting>
<simpara>The hunspell token filter accepts four options:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>locale</literal>
</term>
<listitem>
<simpara>
    A locale for this filter. If this is unset, the <literal>lang</literal> or
    <literal>language</literal> are used instead - so one of these has to be set.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>dictionary</literal>
</term>
<listitem>
<simpara>
    The name of a dictionary. The path to your hunspell
    dictionaries should be configured via
    <literal>indices.analysis.hunspell.dictionary.location</literal> before.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>dedup</literal>
</term>
<listitem>
<simpara>
    If only unique terms should be returned, this needs to be
    set to <literal>true</literal>. Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>longest_only</literal>
</term>
<listitem>
<simpara>
    If only the longest term should be returned, set this to <literal>true</literal>.
    Defaults to <literal>false</literal>: all possible stems are returned.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>As opposed to the snowball stemmers (which are algorithm based)
this is a dictionary lookup based stemmer and therefore the quality of
the stemming is determined by the quality of the dictionary.</simpara></note>
<bridgehead id="_dictionary_loading" renderas="sect3">Dictionary loading<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/hunspell-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, the default Hunspell directory (<literal>config/hunspell/</literal>) is checked
for dictionaries when the node starts up, and any dictionaries are
automatically loaded.</simpara>
<simpara>Dictionary loading can be deferred until they are actually used by setting
<literal>indices.analysis.hunspell.dictionary.lazy</literal> to `true`in the config file.</simpara>
<bridgehead id="_references" renderas="sect3">References<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/hunspell-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>Hunspell is a spell checker and morphological analyzer designed for
languages with rich morphology and complex word compounding and
character encoding.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
Wikipedia, <ulink url="http://en.wikipedia.org/wiki/Hunspell">http://en.wikipedia.org/wiki/Hunspell</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Source code, <ulink url="http://hunspell.sourceforge.net/">http://hunspell.sourceforge.net/</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Open Office Hunspell dictionaries, <ulink url="http://wiki.openoffice.org/wiki/Dictionaries">http://wiki.openoffice.org/wiki/Dictionaries</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mozilla Hunspell dictionaries, <ulink url="https://addons.mozilla.org/en-US/firefox/language-tools/">https://addons.mozilla.org/en-US/firefox/language-tools/</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Chromium Hunspell dictionaries,
   <ulink url="http://src.chromium.org/viewvc/chrome/trunk/deps/third_party/hunspell_dictionaries/">http://src.chromium.org/viewvc/chrome/trunk/deps/third_party/hunspell_dictionaries/</ulink>
</simpara>
</listitem>
</orderedlist>
</section>
<section id="analysis-common-grams-tokenfilter">
<title>Common Grams Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/common-grams-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Token filter that generates bigrams for frequently occurring terms.
Single terms are still indexed. It can be used as an alternative to the
<link linkend="analysis-stop-tokenfilter">Stop Token Filter</link> when we don&#8217;t want to completely ignore common terms.</simpara>
<simpara>For example, the text "the quick brown is a fox" will be tokenized as
"the", "the_quick", "quick", "brown", "brown_is", "is_a", "a_fox",
"fox". Assuming "the", "is" and "a" are common words.</simpara>
<simpara>When <literal>query_mode</literal> is enabled, the token filter removes common words and
single terms followed by a common word. This parameter should be enabled
in the search analyzer.</simpara>
<simpara>For example, the query "the quick brown is a fox" will be tokenized as
"the_quick", "quick", "brown_is", "is_a", "a_fox", "fox".</simpara>
<simpara>The following are settings that can be set:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>common_words</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A list of common words to use.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>common_words_path</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A path (either relative to <literal>config</literal> location, or
absolute) to a list of common words. Each word should be in its own
"line" (separated by a line break). The file must be UTF-8 encoded.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ignore_case</literal></simpara></entry>
<entry align="left" valign="top"><simpara>If true, common words matching will be case insensitive
(defaults to <literal>false</literal>).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>query_mode</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Generates bigrams then removes common words and single
terms followed by a common word (defaults to <literal>false</literal>).</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Note, <literal>common_words</literal> or <literal>common_words_path</literal> field is required.</simpara>
<simpara>Here is an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">index :
    analysis :
        analyzer :
            index_grams :
                tokenizer : whitespace
                filter : [common_grams]
            search_grams :
                tokenizer : whitespace
                filter : [common_grams_query]
        filter :
            common_grams :
                type : common_grams
                common_words: [a, an, the]
            common_grams_query :
                type : common_grams
                query_mode: true
                common_words: [a, an, the]</programlisting>
</section>
<section id="analysis-normalization-tokenfilter">
<title>Normalization Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/normalization-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>There are several token filters available which try to normalize special
characters of a certain language.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
Arabic
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/ar/ArabicNormalizer.html"><literal>arabic_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
German
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/de/GermanNormalizationFilter.html"><literal>german_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Hindi
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/hi/HindiNormalizer.html"><literal>hindi_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Indic
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/in/IndicNormalizer.html"><literal>indic_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Kurdish (Sorani)
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/ckb/SoraniNormalizer.html"><literal>sorani_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Persian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/fa/PersianNormalizer.html"><literal>persian_normalization</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Scandinavian
</simpara>
</entry>
<entry>
<simpara>
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/miscellaneous/ScandinavianNormalizationFilter.html"><literal>scandinavian_normalization</literal></ulink>,
<ulink url="http://lucene.apache.org/core/4_9_0/analyzers-common/org/apache/lucene/analysis/miscellaneous/ScandinavianFoldingFilter.html"><literal>scandinavian_folding</literal></ulink>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
Serbian
</simpara>
</entry>
<entry>
<simpara>
not-released-yet[<literal>serbian_normalization</literal>],
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="analysis-cjk-width-tokenfilter">
<title>CJK Width Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/cjk-width-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cjk_width</literal> token filter normalizes CJK width differences:</simpara>
<itemizedlist>
<listitem>
<simpara>
Folds fullwidth ASCII variants into the equivalent basic Latin
</simpara>
</listitem>
<listitem>
<simpara>
Folds halfwidth Katakana variants into the equivalent Kana
</simpara>
</listitem>
</itemizedlist>
<note><simpara>This token filter can be viewed as a subset of NFKC/NFKD
Unicode normalization.  See the <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/analysis-icu-normalization-charfilter.html"><literal>analysis-icu</literal> plugin</ulink>
for full normalization support.</simpara></note>
</section>
<section id="analysis-cjk-bigram-tokenfilter">
<title>CJK Bigram Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/cjk-bigram-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>cjk_bigram</literal> token filter forms bigrams out of the CJK
terms that are generated by the <link linkend="analysis-standard-tokenizer"><literal>standard</literal> tokenizer</link>
or the <literal>icu_tokenizer</literal> (see <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/analysis-icu-tokenizer.html"><literal>analysis-icu</literal> plugin</ulink>).</simpara>
<simpara>By default, when a CJK character has no adjacent characters to form a bigram,
it is output in unigram form. If you always want to output both unigrams and
bigrams, set the <literal>output_unigrams</literal> flag to <literal>true</literal>. This can be used for a
combined unigram+bigram approach.</simpara>
<simpara>Bigrams are generated for characters in <literal>han</literal>, <literal>hiragana</literal>, <literal>katakana</literal> and
<literal>hangul</literal>, but bigrams can be disabled for particular scripts with the
<literal>ignored_scripts</literal> parameter.  All non-CJK input is passed through unmodified.</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "han_bigrams" : {
                    "tokenizer" : "standard",
                    "filter" : ["han_bigrams_filter"]
                }
            },
            "filter" : {
                "han_bigrams_filter" : {
                    "type" : "cjk_bigram",
                    "ignored_scripts": [
                        "hiragana",
                        "katakana",
                        "hangul"
                    ],
                    "output_unigrams" : true
                }
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-delimited-payload-tokenfilter">
<title>Delimited Payload Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/delimited-payload-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>Named <literal>delimited_payload_filter</literal>. Splits tokens into tokens and payload whenever a delimiter character is found.</simpara>
<simpara>Example: "the|1 quick|2 fox|3" is split by default into tokens <literal>the</literal>, <literal>quick</literal>, and <literal>fox</literal> with payloads <literal>1</literal>, <literal>2</literal>, and <literal>3</literal> respectively.</simpara>
<simpara>Parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>delimiter</literal>
</term>
<listitem>
<simpara>
    Character used for splitting the tokens. Default is <literal>|</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>encoding</literal>
</term>
<listitem>
<simpara>
    The type of the payload. <literal>int</literal> for integer, <literal>float</literal> for float and <literal>identity</literal> for characters. Default is <literal>float</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="analysis-keep-words-tokenfilter">
<title>Keep Words Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-words-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>keep</literal> that only keeps tokens with text contained in a
predefined set of words. The set of words can be defined in the settings or
loaded from a text file containing one word per line.</simpara>
<bridgehead id="_options_5" renderas="sect2">Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-words-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
keep_words
</simpara>
</entry>
<entry>
<simpara>
a list of words to keep
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
keep_words_path
</simpara>
</entry>
<entry>
<simpara>
a path to a words file
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
keep_words_case
</simpara>
</entry>
<entry>
<simpara>
a boolean indicating whether to lower case the words (defaults to <literal>false</literal>)
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_settings_example" renderas="sect2">Settings example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-words-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "words_till_three"]
                },
                "my_analyzer1" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "words_on_file"]
                }
            },
            "filter" : {
                "words_till_three" : {
                    "type" : "keep",
                    "keep_words" : [ "one", "two", "three"]
                },
                "words_on_file" : {
                    "type" : "keep",
                    "keep_words_path" : "/path/to/word/file"
                }
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-keep-types-tokenfilter">
<title>Keep Types Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-types-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>A token filter of type <literal>keep_types</literal> that only keeps tokens with a token type
contained in a predefined set.</simpara>
<bridgehead id="_options_6" renderas="sect2">Options<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-types-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
types
</simpara>
</entry>
<entry>
<simpara>
a list of types to keep
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_settings_example_2" renderas="sect2">Settings example<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/keep-types-tokenfilter.asciidoc">Edit me</ulink></bridgehead>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "analyzer" : {
                "my_analyzer" : {
                    "tokenizer" : "standard",
                    "filter" : ["standard", "lowercase", "extract_numbers"]
                },
            },
            "filter" : {
                "extract_numbers" : {
                    "type" : "keep_types",
                    "types" : [ "&lt;NUM&gt;" ]
                },
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-classic-tokenfilter">
<title>Classic Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/classic-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>classic</literal> token filter does optional post-processing of
terms that are generated by the <link linkend="analysis-classic-tokenizer"><literal>classic</literal> tokenizer</link>.</simpara>
<simpara>This filter removes the english possessive from the end of words, and
it removes dots from acronyms.</simpara>
</section>
<section id="analysis-apostrophe-tokenfilter">
<title>Apostrophe Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/apostrophe-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>apostrophe</literal> token filter strips all characters after an apostrophe,
including the apostrophe itself.</simpara>
</section>
<section id="analysis-decimal-digit-tokenfilter">
<title>Decimal Digit Token Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/tokenfilters/decimal-digit-tokenfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>decimal_digit</literal> token filter folds unicode digits to <literal>0-9</literal></simpara>
</section>
</chapter>
<chapter id="analysis-charfilters">
<title>Character Filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters.asciidoc">Edit me</ulink></title>
<simpara>Character filters are used to preprocess the string of
characters before it is passed to the <link linkend="analysis-tokenizers">tokenizer</link>.
A character filter may be used to strip out HTML markup, or to convert
<literal>"&amp;"</literal> characters to the word <literal>"and"</literal>.</simpara>
<simpara>Elasticsearch has built in characters filters which can be
used to build <link linkend="analysis-custom-analyzer">custom analyzers</link>.</simpara>
<section id="analysis-mapping-charfilter">
<title>Mapping Char Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters/mapping-charfilter.asciidoc">Edit me</ulink></title>
<simpara>A char filter of type <literal>mapping</literal> replacing characters of an analyzed text
with given mapping.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>mappings</literal>
</simpara>
</entry>
<entry>
<simpara>
    A list of mappings to use.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>mappings_path</literal>
</simpara>
</entry>
<entry>
<simpara>
    A path, relative to the <literal>config</literal> directory, to a mappings file
    configuration.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Here is a sample configuration:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
    "index" : {
        "analysis" : {
            "char_filter" : {
                "my_mapping" : {
                    "type" : "mapping",
                    "mappings" : [
                      "ph =&gt; f",
                      "qu =&gt; k"
                    ]
                }
            },
            "analyzer" : {
                "custom_with_char_filter" : {
                    "tokenizer" : "standard",
                    "char_filter" : ["my_mapping"]
                }
            }
        }
    }
}</programlisting>
</section>
<section id="analysis-htmlstrip-charfilter">
<title>HTML Strip Char Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters/htmlstrip-charfilter.asciidoc">Edit me</ulink></title>
<simpara>A char filter of type <literal>html_strip</literal> stripping out HTML elements from an
analyzed text.</simpara>
</section>
<section id="analysis-pattern-replace-charfilter">
<title>Pattern Replace Char Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters/pattern-replace-charfilter.asciidoc">Edit me</ulink></title>
<simpara>The <literal>pattern_replace</literal> character filter uses a regular expression to match
characters which should be replaced with the specified replacement string.
The replacement string can refer to capture groups in the regular expression.</simpara>
<warning>
<title>Beware of Pathological Regular Expressions</title>
<simpara>The pattern replace character filter uses
<ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Regular Expressions</ulink>.</simpara>
<simpara>A badly written regular expression could run very slowly or even throw a
StackOverflowError and cause the node it is running on to exit suddenly.</simpara>
<simpara>Read more about <ulink url="http://www.regular-expressions.info/catastrophic.html">pathological regular expressions and how to avoid them</ulink>.</simpara>
</warning>
<bridgehead id="_configuration_3" renderas="sect2">Configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters/pattern-replace-charfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>pattern_replace</literal> character filter accepts the following parameters:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>pattern</literal>
</simpara>
</entry>
<entry>
<simpara>
    A <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java regular expression</ulink>. Required.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>replacement</literal>
</simpara>
</entry>
<entry>
<simpara>
    The replacement string, which can reference capture groups using the
    <literal>$1</literal>..<literal>$9</literal> syntax, as explained
    <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Matcher.html#appendReplacement-java.lang.StringBuffer-java.lang.String-">here</ulink>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flags</literal>
</simpara>
</entry>
<entry>
<simpara>
    Java regular expression <ulink url="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html#field.summary">flags</ulink>.
    Flags should be pipe-separated, eg <literal>"CASE_INSENSITIVE|COMMENTS"</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_example_configuration_3" renderas="sect2">Example configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/analysis/charfilters/pattern-replace-charfilter.asciidoc">Edit me</ulink></bridgehead>
<simpara>In this example, we configure the <literal>pattern_replace</literal> character filter to
replace any embedded dashes in numbers with underscores, i.e <literal>123-456-789</literal> &#8594;
<literal>123_456_789</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_analyzer": {
          "tokenizer": "standard",
          "char_filter": [
            "my_char_filter"
          ]
        }
      },
      "char_filter": {
        "my_char_filter": {
          "type": "pattern_replace",
          "pattern": "(\\d+)-(?=\\d)",
          "replacement": "$1_"
        }
      }
    }
  }
}

POST my_index/_analyze
{
  "analyzer": "my_analyzer",
  "text": "My credit card is 123-456-789"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above example produces the following term:</simpara>
<programlisting language="text" linenumbering="unnumbered">[ My, credit, card, is 123_456_789 ]</programlisting>
<warning><simpara>Using a replacement string that changes the length of the original
text will work for search purposes, but will result in incorrect highlighting,
as can be seen in the following example.</simpara></warning>
<simpara>This example inserts a space whenever it encounters a lower-case letter
followed by an upper-case letter (i.e. <literal>fooBarBaz</literal> &#8594; <literal>foo Bar Baz</literal>), allowing
camelCase words to be queried individually:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_analyzer": {
          "tokenizer": "standard",
          "char_filter": [
            "my_char_filter"
          ],
          "filter": [
            "lowercase"
          ]
        }
      },
      "char_filter": {
        "my_char_filter": {
          "type": "pattern_replace",
          "pattern": "(?&lt;=\\p{Lower})(?=\\p{Upper})",
          "replacement": " "
        }
      }
    }
  },
  "mappings": {
    "my_type": {
      "properties": {
        "text": {
          "type": "text",
          "analyzer": "my_analyzer"
        }
      }
    }
  }
}

POST my_index/_analyze
{
  "analyzer": "my_analyzer",
  "text": "The fooBarBaz method"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The above returns the following terms:</simpara>
<programlisting language="js" linenumbering="unnumbered">[ the, foo, bar, baz, method ]</programlisting>
<simpara>Querying for <literal>bar</literal> will find the document correctly, but highlighting on the
result will produce incorrect highlights, because our character filter changed
the length of the original text:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT my_index/my_doc/1?refresh
{
  "text": "The fooBarBaz method"
}

GET my_index/_search
{
  "query": {
    "match": {
      "text": "bar"
    }
  },
  "highlight": {
    "fields": {
      "text": {}
    }
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The output from the above is:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "timed_out": false,
  "took": $body.took,
  "_shards": {
    "total": 5,
    "successful": 5,
    "failed": 0
  },
  "hits": {
    "total": 1,
    "max_score": 0.2824934,
    "hits": [
      {
        "_index": "my_index",
        "_type": "my_doc",
        "_id": "1",
        "_score": 0.2824934,
        "_source": {
          "text": "The fooBarBaz method"
        },
        "highlight": {
          "text": [
            "The foo&lt;em&gt;Ba&lt;/em&gt;rBaz method" <co id="CO270-1"/>
          ]
        }
      }
    ]
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO270-1">
<para>
Note the incorrect highlight.
</para>
</callout>
</calloutlist>
</section>
</chapter>
</part>
<part id="modules">
<title>Modules <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section contains modules responsible for various aspects of the functionality in Elasticsearch.  Each module has settings which may be:</simpara>
<variablelist>
<varlistentry>
<term>
<emphasis>static</emphasis>
</term>
<listitem>
<simpara>
These settings must be set at the node level, either in the
<literal>elasticsearch.yml</literal> file, or as an environment variable or on the command line
when starting a node.  They must be set on every relevant node in the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis>dynamic</emphasis>
</term>
<listitem>
<simpara>
These settings can be dynamically updated on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The modules in this section are:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="modules-cluster">Cluster-level routing and shard allocation</link>
</term>
<listitem>
<simpara>
    Settings to control where, when, and how shards are allocated to nodes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-discovery">Discovery</link>
</term>
<listitem>
<simpara>
    How nodes discover each other to form a cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-gateway">Gateway</link>
</term>
<listitem>
<simpara>
    How many nodes need to join the cluster before recovery can start.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-http">HTTP</link>
</term>
<listitem>
<simpara>
    Settings to control the HTTP REST interface.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-indices">Indices</link>
</term>
<listitem>
<simpara>
    Global index-related settings.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-network">Network</link>
</term>
<listitem>
<simpara>
    Controls default network settings.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-node">Node client</link>
</term>
<listitem>
<simpara>
    A Java node client joins the cluster, but doesn&#8217;t hold data or act as a master node.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-plugins">Plugins</link>
</term>
<listitem>
<simpara>
    Using plugins to extend Elasticsearch.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-scripting">Scripting</link>
</term>
<listitem>
<simpara>
    Custom scripting available in Lucene Expressions, Groovy, Python, and
    Javascript.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-snapshots">Snapshot/Restore</link>
</term>
<listitem>
<simpara>
    Backup your data with snapshot/restore.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-threadpool">Thread pools</link>
</term>
<listitem>
<simpara>
    Information about the dedicated thread pools used in Elasticsearch.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-transport">Transport</link>
</term>
<listitem>
<simpara>
    Configure the transport networking layer, used internally by Elasticsearch
    to communicate between nodes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-tribe">Tribe nodes</link>
</term>
<listitem>
<simpara>
    A tribe node joins one or more clusters and acts as a federated
    client across them.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</partintro>
<chapter id="modules-cluster">
<title>Cluster<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster.asciidoc">Edit me</ulink></title>
<simpara>One of the main roles of the master is to decide which shards to allocate to
which nodes, and when to move shards between nodes in order to rebalance the
cluster.</simpara>
<simpara>There are a number of settings available to control the shard allocation process:</simpara>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="shards-allocation"/> lists the settings to control the allocation and
    rebalancing operations.
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="disk-allocator"/> explains how Elasticsearch takes available disk space
    into account, and the related settings.
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="allocation-awareness"/> and <xref linkend="forced-awareness"/> control how shards can
    be distributed across different racks or availability zones.
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="allocation-filtering"/> allows certain nodes or groups of nodes excluded
    from allocation so that they can be decommissioned.
</simpara>
</listitem>
</itemizedlist>
<simpara>Besides these, there are a few other <link linkend="misc-cluster">miscellaneous cluster-level settings</link>.</simpara>
<simpara>All of the settings in this section are <emphasis>dynamic</emphasis> settings which can be
updated on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API.</simpara>
<section id="shards-allocation">
<title>Cluster Level Shard Allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/shards_allocation.asciidoc">Edit me</ulink></title>
<simpara>Shard allocation is the process of allocating shards to nodes. This can
happen during initial recovery, replica allocation, rebalancing, or
when nodes are added or removed.</simpara>
<bridgehead id="_shard_allocation_settings" renderas="sect2">Shard Allocation Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/shards_allocation.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following <emphasis>dynamic</emphasis> settings may be used to control shard allocation and recovery:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.allocation.enable</literal>
</term>
<listitem>
<simpara>Enable or disable allocation for specific kinds of shards:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>all</literal> -             (default) Allows shard allocation for all kinds of shards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>primaries</literal> -       Allows shard allocation only for primary shards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>new_primaries</literal> -   Allows shard allocation only for primary shards for new indices.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>none</literal> -            No shard allocations of any kind are allowed for any indices.
</simpara>
</listitem>
</itemizedlist>
<simpara>This setting does not affect the recovery of local primary shards when
restarting a node.  A restarted node that has a copy of an unassigned primary
shard will recover that primary immediately, assuming that the
<link linkend="index.recovery.initial_shards"><literal>index.recovery.initial_shards</literal></link> setting is
satisfied.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.node_concurrent_recoveries</literal>
</term>
<listitem>
<simpara>
     How many concurrent shard recoveries are allowed to happen on a node.
     Defaults to <literal>2</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.node_initial_primaries_recoveries</literal>
</term>
<listitem>
<simpara>
    While the recovery of replicas happens over the network, the recovery of
    an unassigned primary after node restart uses data from the local disk.
    These should be fast so more initial primary recoveries can happen in
    parallel on the same node.  Defaults to <literal>4</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.same_shard.host</literal>
</term>
<listitem>
<simpara>
      Allows to perform a check to prevent allocation of multiple instances of
      the same shard on a single host, based on host name and host address.
      Defaults to <literal>false</literal>, meaning that no check is performed by default. This
      setting only applies if multiple nodes are started on the same machine.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.concurrent_streams</literal>
</term>
<listitem>
<simpara>
       The number of network streams to open per node to recover a shard from
       a peer shard. Defaults to <literal>3</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.concurrent_small_file_streams</literal>
</term>
<listitem>
<simpara>
       The number of streams to open per node for small files (under 5mb) to
       recover a shard from a peer shard. Defaults to <literal>2</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_shard_rebalancing_settings" renderas="sect2">Shard Rebalancing Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/shards_allocation.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following <emphasis>dynamic</emphasis> settings may be used to control the rebalancing of
shards across the cluster:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.rebalance.enable</literal>
</term>
<listitem>
<simpara>Enable or disable rebalancing for specific kinds of shards:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>all</literal> -         (default) Allows shard balancing for all kinds of shards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>primaries</literal> -   Allows shard balancing only for primary shards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>replicas</literal> -    Allows shard balancing only for replica shards.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>none</literal> -        No shard balancing of any kind are allowed for any indices.
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.allow_rebalance</literal>
</term>
<listitem>
<simpara>Specify when shard rebalancing is allowed:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>always</literal> -                    Always allow rebalancing.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>indices_primaries_active</literal> -  Only when all primaries in the cluster are allocated.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>indices_all_active</literal> -        (default) Only when all shards (primaries and replicas) in the cluster are allocated.
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.cluster_concurrent_rebalance</literal>
</term>
<listitem>
<simpara>
      Allow to control how many concurrent shard rebalances are
      allowed cluster wide. Defaults to <literal>2</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_shard_balancing_heuristics" renderas="sect2">Shard Balancing Heuristics<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/shards_allocation.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following settings are used together to determine where to place each
shard.  The cluster is balanced when no allowed action can bring the weights
of each node closer together by more then the <literal>balance.threshold</literal>.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.allocation.balance.shard</literal>
</term>
<listitem>
<simpara>
     Defines the weight factor for shards allocated on a node
     (float). Defaults to <literal>0.45f</literal>.  Raising this raises the tendency to
     equalize the number of shards across all nodes in the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.balance.index</literal>
</term>
<listitem>
<simpara>
     Defines a factor to the number of shards per index allocated
      on a specific node (float). Defaults to <literal>0.55f</literal>.  Raising this raises the
      tendency to equalize the number of shards per index across all nodes in
      the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.balance.threshold</literal>
</term>
<listitem>
<simpara>
     Minimal optimization value of operations that should be performed (non
      negative float). Defaults to <literal>1.0f</literal>.  Raising this will cause the cluster
      to be less aggressive about optimizing the shard balance.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>Regardless of the result of the balancing algorithm, rebalancing might
not be allowed due to forced awareness or allocation filtering.</simpara></note>
</section>
<section id="disk-allocator">
<title>Disk-based Shard Allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/disk_allocator.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch factors in the available disk space on a node before deciding
whether to allocate new shards to that node or to actively relocate shards
away from that node.</simpara>
<simpara>Below are the settings that can be configured in the <literal>elasticsearch.yml</literal> config
file or updated dynamically on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.allocation.disk.threshold_enabled</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>true</literal>.  Set to <literal>false</literal> to disable the disk allocation decider.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.disk.watermark.low</literal>
</term>
<listitem>
<simpara>
    Controls the low watermark for disk usage. It defaults to 85%, meaning ES will
    not allocate new shards to nodes once they have more than 85% disk used. It
    can also be set to an absolute byte value (like 500mb) to prevent ES from
    allocating shards if less than the configured amount of space is available.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.disk.watermark.high</literal>
</term>
<listitem>
<simpara>
    Controls the high watermark. It defaults to 90%, meaning ES will attempt to
    relocate shards to another node if the node disk usage rises above 90%. It can
    also be set to an absolute byte value (similar to the low watermark) to
    relocate shards once less than the configured amount of space is available on
    the node.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>Percentage values refer to used disk space, while byte values refer to
free disk space. This can be confusing, since it flips the meaning of high and
low. For example, it makes sense to set the low watermark to 10gb and the high
watermark to 5gb, but not the other way around.</simpara></note>
<variablelist>
<varlistentry>
<term>
<literal>cluster.info.update.interval</literal>
</term>
<listitem>
<simpara>
    How often Elasticsearch should check on disk usage for each node in the
    cluster. Defaults to <literal>30s</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.disk.include_relocations</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>true</literal>, which means that Elasticsearch will take into account
    shards that are currently being relocated to the target node when computing a
    node&#8217;s disk usage. Taking relocating shards' sizes into account may, however,
    mean that the disk usage for a node is incorrectly estimated on the high side,
    since the relocation could be 90% complete and a recently retrieved disk usage
    would include the total size of the relocating shard as well as the space
    already used by the running relocation.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>An example of updating the low watermark to no more than 80% of the disk size, a
high watermark of at least 50 gigabytes free, and updating the information about
the cluster every minute:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.disk.watermark.low": "80%",
    "cluster.routing.allocation.disk.watermark.high": "50gb",
    "cluster.info.update.interval": "1m"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<note><simpara>Prior to 2.0.0, when using multiple data paths, the disk threshold
decider only factored in the usage across all data paths (if you had two
data paths, one with 50b out of 100b free (50% used) and another with
40b out of 50b free (80% used) it would see the node&#8217;s disk usage as 90b
out of 150b). In 2.0.0, the minimum and maximum disk usages are tracked
separately.</simpara></note>
</section>
<section id="allocation-awareness">
<title>Shard Allocation Awareness<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/allocation_awareness.asciidoc">Edit me</ulink></title>
<simpara>When running nodes on multiple VMs on the same physical server, on multiple
racks, or across multiple awareness zones, it is more likely that two nodes on
the same physical server, in the same rack, or in the same awareness zone will
crash at the same time, rather than two unrelated nodes crashing
simultaneously.</simpara>
<simpara>If Elasticsearch is <emphasis>aware</emphasis> of the physical configuration of your hardware, it
can ensure that the primary shard and its replica shards are spread across
different physical servers, racks, or zones, to minimise the risk of losing
all shard copies at the same time.</simpara>
<simpara>The shard allocation awareness settings allow you to tell Elasticsearch about
your hardware configuration.</simpara>
<simpara>As an example, let&#8217;s assume we have several racks.  When we start a node, we
can tell it which rack it is in by assigning it an arbitrary metadata
attribute called <literal>rack_id</literal>&#8201;&#8212;&#8201;we could use any attribute name.  For example:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/elasticsearch --node.rack_id rack_one <co id="CO271-1"/></programlisting>
<calloutlist>
<callout arearefs="CO271-1">
<para>
This setting could also be specified in the <literal>elasticsearch.yml</literal> config file.
</para>
</callout>
</calloutlist>
<simpara>Now, we need to setup <emphasis>shard allocation awareness</emphasis>  by telling Elasticsearch
which attributes to use.  This can be configured in the <literal>elasticsearch.yml</literal>
file on <emphasis role="strong">all</emphasis> master-eligible nodes, or it can be set (and changed) with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API.</simpara>
<simpara>For our example, we&#8217;ll set the value in the config file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">cluster.routing.allocation.awareness.attributes: rack_id</programlisting>
<simpara>With this config in place, let&#8217;s say we start two nodes with <literal>node.rack_id</literal>
set to <literal>rack_one</literal>, and we create an index with 5 primary shards and 1 replica
of each primary.  All primaries and replicas are allocated across the two
nodes.</simpara>
<simpara>Now, if we start two more nodes with <literal>node.rack_id</literal> set to <literal>rack_two</literal>,
Elasticsearch will move shards across to the new nodes, ensuring (if possible)
that no two copies of the same shard will be in the same rack. However if <literal>rack_two</literal>
were to fail, taking down both of its nodes, Elasticsearch will still allocate the lost
shard copies to nodes in <literal>rack_one</literal>.</simpara>
<sidebar>
<title>Prefer local shards</title>
<simpara>When executing search or GET requests, with shard awareness enabled,
Elasticsearch will prefer using local shards&#8201;&#8212;&#8201;shards in the same awareness
group&#8201;&#8212;&#8201;to execute the request. This is usually faster than crossing racks or
awareness zones.</simpara>
</sidebar>
<simpara>Multiple awareness attributes can be specified, in which case the combination
of values from each attribute is considered to be a separate value.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">cluster.routing.allocation.awareness.attributes: rack_id,zone</programlisting>
<note><simpara>When using awareness attributes, shards will not be allocated to
nodes that don&#8217;t have values set for those attributes.</simpara></note>
<note><simpara>Number of primary/replica of a shard allocated on a specific group
of nodes with the same awareness attribute value is determined by the number
of attribute values. When the number of nodes in groups is unbalanced and
there are many replicas, replica shards may be left unassigned.</simpara></note>
<bridgehead id="forced-awareness" renderas="sect2">Forced Awareness<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/allocation_awareness.asciidoc">Edit me</ulink></bridgehead>
<simpara>Imagine that you have two awareness zones and enough hardware across the two
zones to host all of your primary and replica shards.  But perhaps the
hardware in a single zone, while sufficient to host half the shards, would be
unable to host <emphasis role="strong">ALL</emphasis> the shards.</simpara>
<simpara>With ordinary awareness, if one zone lost contact with the other zone,
Elasticsearch would assign all of the missing replica shards to a single zone.
But in this example, this sudden extra load would cause the hardware in the
remaining zone to be overloaded.</simpara>
<simpara>Forced awareness solves this problem by <emphasis role="strong">NEVER</emphasis> allowing copies of the same
shard to be allocated to the same zone.</simpara>
<simpara>For example, lets say we have an awareness attribute called <literal>zone</literal>, and
we know we are going to have two zones, <literal>zone1</literal> and <literal>zone2</literal>. Here is how
we can force awareness on a node:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">cluster.routing.allocation.awareness.force.zone.values: zone1,zone2 <co id="CO272-1"/>
cluster.routing.allocation.awareness.attributes: zone</programlisting>
<calloutlist>
<callout arearefs="CO272-1">
<para>
We must list all possible values that the <literal>zone</literal> attribute can have.
</para>
</callout>
</calloutlist>
<simpara>Now, if we start 2 nodes with <literal>node.zone</literal> set to <literal>zone1</literal> and create an index
with 5 shards and 1 replica. The index will be created, but only the 5 primary
shards will be allocated (with no replicas). Only when we start more shards
with <literal>node.zone</literal> set to <literal>zone2</literal> will the replicas be allocated.</simpara>
<simpara>The <literal>cluster.routing.allocation.awareness.*</literal> settings can all be updated
dynamically on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API.</simpara>
</section>
<section id="allocation-filtering">
<title>Shard Allocation Filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/allocation_filtering.asciidoc">Edit me</ulink></title>
<simpara>While <xref linkend="index-modules-allocation"/> provides <emphasis role="strong">per-index</emphasis> settings to control the
allocation of shards to nodes, cluster-level shard allocation filtering allows
you to allow or disallow the allocation of shards from <emphasis role="strong">any</emphasis> index to
particular nodes.</simpara>
<simpara>The typical use case for cluster-wide shard allocation filtering is when you
want to decommission a node, and you would like to move the shards from that
node to other nodes in the cluster before shutting it down.</simpara>
<simpara>For instance, we could decommission a node using its IP address as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient" : {
    "cluster.routing.allocation.exclude._ip" : "10.0.0.1"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<note><simpara>Shards will only be relocated if it is possible to do so without
breaking another routing constraint, such as never allocating a primary and
replica shard to the same node.</simpara></note>
<simpara>Cluster-wide shard allocation filtering works in the same way as index-level
shard allocation filtering (see <xref linkend="index-modules-allocation"/> for details).</simpara>
<simpara>The available <emphasis>dynamic</emphasis> cluster settings are as follows, where <literal>{attribute}</literal>
refers to an arbitrary node attribute.:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.allocation.include.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has at least one of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.require.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has <emphasis>all</emphasis> of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>cluster.routing.allocation.exclude.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has <emphasis>none</emphasis> of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>These special attributes are also supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_name</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by node name
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_ip</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by IP address (the IP address associated with the hostname)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_host</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by hostname
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>All attribute values can be specified with wildcards, eg:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _cluster/settings
{
  "transient": {
    "cluster.routing.allocation.exclude._ip": "192.168.2.*"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="misc-cluster">
<title>Miscellaneous cluster settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/misc.asciidoc">Edit me</ulink></title>
<section id="cluster-read-only">
<title>Metadata<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/misc.asciidoc">Edit me</ulink></title>
<simpara>An entire cluster may be set to read-only with the following <emphasis>dynamic</emphasis> setting:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.blocks.read_only</literal>
</term>
<listitem>
<simpara>
      Make the whole cluster read only (indices do not accept write
      operations), metadata is not allowed to be modified (create or delete
      indices).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<warning><simpara>Don&#8217;t rely on this setting to prevent changes to your cluster. Any
user with access to the <link linkend="cluster-update-settings">cluster-update-settings</link>
API can make the cluster read-write again.</simpara></warning>
</section>
<section id="cluster-logger">
<title>Logger<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/cluster/misc.asciidoc">Edit me</ulink></title>
<simpara>The settings which control logging can be updated dynamically with the
<literal>logger.</literal> prefix.  For instance, to increase the logging level of the
<literal>indices.recovery</literal> module to <literal>DEBUG</literal>, issue this request:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_cluster/settings
{
  "transient": {
    "logger.indices.recovery": "DEBUG"
  }
}</programlisting>
</section>
</section>
</chapter>
<chapter id="modules-discovery">
<title>Discovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery.asciidoc">Edit me</ulink></title>
<simpara>The discovery module is responsible for discovering nodes within a
cluster, as well as electing a master node.</simpara>
<simpara>Note, Elasticsearch is a peer to peer based system, nodes communicate
with one another directly if operations are delegated / broadcast. All
the main APIs (index, delete, search) do not communicate with the master
node. The responsibility of the master node is to maintain the global
cluster state, and act if nodes join or leave the cluster by reassigning
shards. Each time a cluster state is changed, the state is made known to
the other nodes in the cluster (the manner depends on the actual
discovery implementation).</simpara>
<bridgehead id="_settings" renderas="sect2">Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>cluster.name</literal> allows to create separated clusters from one another.
The default value for the cluster name is <literal>elasticsearch</literal>, though it is
recommended to change this to reflect the logical group name of the
cluster running.</simpara>
<section id="modules-discovery-azure">
<title>Azure Discovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/azure.asciidoc">Edit me</ulink></title>
<simpara>Azure discovery allows to use the Azure APIs to perform automatic discovery (similar to multicast).
It is available as a plugin. See <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/cloud-azure.html">cloud-azure</ulink> for more information.</simpara>
</section>
<section id="modules-discovery-ec2">
<title>EC2 Discovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/ec2.asciidoc">Edit me</ulink></title>
<simpara>EC2 discovery is available as a plugin. See <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/cloud-aws.html">cloud-aws</ulink> for more information.</simpara>
</section>
<section id="modules-discovery-gce">
<title>Google Compute Engine Discovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/gce.asciidoc">Edit me</ulink></title>
<simpara>Google Compute Engine (GCE) discovery allows to use the GCE APIs to perform automatic discovery (similar to multicast).
It is available as a plugin. See <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/cloud-gce.html">cloud-gce</ulink> for more information.</simpara>
</section>
<section id="modules-discovery-zen">
<title>Zen Discovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></title>
<simpara>The zen discovery is the built in discovery module for elasticsearch and
the default. It provides unicast discovery, but can be extended to
support cloud environments and other forms of discovery.</simpara>
<simpara>The zen discovery is integrated with other modules, for example, all
communication between nodes is done using the
<link linkend="modules-transport">transport</link> module.</simpara>
<simpara>It is separated into several sub modules, which are explained below:</simpara>
<bridgehead id="ping" renderas="sect3">Ping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>This is the process where a node uses the discovery mechanisms to find
other nodes.</simpara>
<bridgehead id="unicast" renderas="sect4">Unicast<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>The unicast discovery requires a list of hosts to use that will act
as gossip routers. It provides the following settings with the
<literal>discovery.zen.ping.unicast</literal> prefix:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>hosts</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Either an array setting or a comma delimited setting. Each
value should be in the form of <literal>host:port</literal> or <literal>host</literal> (where <literal>port</literal> defaults to <literal>9300</literal>). Note that IPv6 hosts must be bracketed. Defaults to
<literal>127.0.0.1, [::1]</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The unicast discovery uses the
<link linkend="modules-transport">transport</link> module to
perform the discovery.</simpara>
<bridgehead id="master-election" renderas="sect3">Master Election<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>As part of the ping process a master of the cluster is either
elected or joined to. This is done automatically. The
<literal>discovery.zen.ping_timeout</literal> (which defaults to <literal>3s</literal>) allows for the
tweaking of election time to handle cases of slow or congested networks
(higher values assure less chance of failure). Once a node joins, it
will send a join request to the master (<literal>discovery.zen.join_timeout</literal>)
with a timeout defaulting at 20 times the ping timeout.</simpara>
<simpara>When the master node stops or has encountered a problem, the cluster nodes
start pinging again and will elect a new master. This pinging round also
serves as a protection against (partial) network failures where a node may unjustly
think that the master has failed. In this case the node will simply hear from
other nodes about the currently active master.</simpara>
<simpara>If <literal>discovery.zen.master_election.filter_client</literal> is <literal>true</literal>, pings from client nodes (nodes where <literal>node.client</literal> is
<literal>true</literal>, or both <literal>node.data</literal> and <literal>node.master</literal> are <literal>false</literal>) are ignored during master election; the default value is
<literal>true</literal>. If <literal>discovery.zen.master_election.filter_data</literal> is <literal>true</literal>, pings from non-master-eligible data nodes (nodes
where <literal>node.data</literal> is <literal>true</literal> and <literal>node.master</literal> is <literal>false</literal>) are ignored during master election; the default value is
<literal>false</literal>. Pings from master-eligible nodes are always observed during master election.</simpara>
<simpara>Nodes can be excluded from becoming a master by setting <literal>node.master</literal> to
<literal>false</literal>. Note, once a node is a client node (<literal>node.client</literal> set to
<literal>true</literal>), it will not be allowed to become a master (<literal>node.master</literal> is
automatically set to <literal>false</literal>).</simpara>
<simpara>The <literal>discovery.zen.minimum_master_nodes</literal> sets the minimum
number of master eligible nodes that need to join a newly elected master in order for an election to
complete and for the elected node to accept its mastership. The same setting controls the minimum number of
active master eligible nodes that should be a part of any active cluster. If this requirement is not met the
active master node will step down and a new master election will be begin.</simpara>
<simpara>This setting must be set to a quorum of your master eligible nodes. It is recommended to avoid
having only two master eligible nodes, since a quorum of two is two. Therefore, a loss
of either master eligible node will result in an inoperable cluster.</simpara>
<bridgehead id="fault-detection" renderas="sect3">Fault Detection<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>There are two fault detection processes running. The first is by the
master, to ping all the other nodes in the cluster and verify that they
are alive. And on the other end, each node pings to master to verify if
its still alive or an election process needs to be initiated.</simpara>
<simpara>The following settings control the fault detection process using the
<literal>discovery.zen.fd</literal> prefix:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>ping_interval</literal></simpara></entry>
<entry align="left" valign="top"><simpara>How often a node gets pinged. Defaults to <literal>1s</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ping_timeout</literal></simpara></entry>
<entry align="left" valign="top"><simpara>How long to wait for a ping response, defaults to
<literal>30s</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ping_retries</literal></simpara></entry>
<entry align="left" valign="top"><simpara>How many ping failures / timeouts cause a node to be
considered failed. Defaults to <literal>3</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_cluster_state_updates" renderas="sect3">Cluster state updates<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>The master node is the only node in a cluster that can make changes to the
cluster state. The master node processes one cluster state update at a time,
applies the required changes and publishes the updated cluster state to all
the other nodes in the cluster. Each node receives the publish message,
updates its own cluster state and replies to the master node, which waits for
all nodes to respond, up to a timeout, before going ahead processing the next
updates in the queue. The <literal>discovery.zen.publish_timeout</literal> is set by default
to 30 seconds and can be changed dynamically through the
<link linkend="cluster-update-settings">cluster update settings api</link></simpara>
<bridgehead id="no-master-block" renderas="sect3">No master block<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/discovery/zen.asciidoc">Edit me</ulink></bridgehead>
<simpara>For the cluster to be fully operational, it must have an active master and the
number of running master eligible nodes must satisfy the
<literal>discovery.zen.minimum_master_nodes</literal> setting if set. The
<literal>discovery.zen.no_master_block</literal> settings controls what operations should be
rejected when there is no active master.</simpara>
<simpara>The <literal>discovery.zen.no_master_block</literal> setting has two valid options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>all</literal>
</simpara>
</entry>
<entry>
<simpara>
All operations on the node&#8212;i.e. both read &amp; writes&#8212;will be rejected. This also applies for api cluster state
read or write operations, like the get index settings, put mapping and cluster state api.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>write</literal>
</simpara>
</entry>
<entry>
<simpara>
(default) Write operations will be rejected. Read operations will succeed, based on the last known cluster configuration.
This may result in partial reads of stale data as this node may be isolated from the rest of the cluster.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The <literal>discovery.zen.no_master_block</literal> setting doesn&#8217;t apply to nodes-based apis (for example cluster stats, node info and
node stats apis).  Requests to these apis will not be blocked and can run on any available node.</simpara>
</section>
</chapter>
<chapter id="modules-gateway">
<title>Local Gateway<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/gateway.asciidoc">Edit me</ulink></title>
<simpara>The local gateway module stores the cluster state and shard data across full
cluster restarts.</simpara>
<literallayout class="monospaced">The following _static_ settings, which must be set on every master node,
 control how long a freshly elected master should wait before it tries to
 recover the cluster state and the cluster's data:</literallayout>
<variablelist>
<varlistentry>
<term>
<literal>gateway.expected_nodes</literal>
</term>
<listitem>
<simpara>
    The number of (data or master) nodes that are expected to be in the cluster.
    Recovery of local shards will start as soon as the expected number of
    nodes have joined the cluster. Defaults to <literal>0</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>gateway.expected_master_nodes</literal>
</term>
<listitem>
<simpara>
    The number of master nodes that are expected to be in the cluster.
    Recovery of local shards will start as soon as the expected number of
    master nodes have joined the cluster. Defaults to <literal>0</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>gateway.expected_data_nodes</literal>
</term>
<listitem>
<simpara>
    The number of data nodes that are expected to be in the cluster.
    Recovery of local shards will start as soon as the expected number of
    data nodes have joined the cluster. Defaults to <literal>0</literal>
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>gateway.recover_after_time</literal>
</term>
<listitem>
<simpara>
    If the expected number of nodes is not achieved, the recovery process waits
    for the configured amount of time before trying to recover regardless.
    Defaults to <literal>5m</literal> if one of the <literal>expected_nodes</literal> settings is configured.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Once the <literal>recover_after_time</literal> duration has timed out, recovery will start
as long as the following conditions are met:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>gateway.recover_after_nodes</literal>
</term>
<listitem>
<simpara>
    Recover as long as this many data or master nodes have joined the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>gateway.recover_after_master_nodes</literal>
</term>
<listitem>
<simpara>
    Recover as long as this many master nodes have joined the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>gateway.recover_after_data_nodes</literal>
</term>
<listitem>
<simpara>
    Recover as long as this many data nodes have joined the cluster.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>These settings only take effect on a full cluster restart.</simpara></note>
</chapter>
<chapter id="modules-http">
<title>HTTP<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/http.asciidoc">Edit me</ulink></title>
<simpara>The http module allows to expose <emphasis role="strong">elasticsearch</emphasis> APIs
over HTTP.</simpara>
<simpara>The http mechanism is completely asynchronous in nature, meaning that
there is no blocking thread waiting for a response. The benefit of using
asynchronous communication for HTTP is solving the
<ulink url="http://en.wikipedia.org/wiki/C10k_problem">C10k problem</ulink>.</simpara>
<simpara>When possible, consider using
<ulink url="http://en.wikipedia.org/wiki/Keepalive#HTTP_Keepalive">HTTP keep alive</ulink>
when connecting for better performance and try to get your favorite
client not to do
<ulink url="http://en.wikipedia.org/wiki/Chunked_transfer_encoding">HTTP chunking</ulink>.</simpara>
<bridgehead id="_settings_2" renderas="sect2">Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/http.asciidoc">Edit me</ulink></bridgehead>
<simpara>The settings in the table below can be configured for HTTP. Note that none of
them are dynamically updatable so for them to take effect they should be set in
<literal>elasticsearch.yml</literal>.</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>http.port</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A bind port range. Defaults to <literal>9200-9300</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.publish_port</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The port that HTTP clients should use when
communicating with this node. Useful when a cluster node is behind a
proxy or firewall and the <literal>http.port</literal> is not directly addressable
from the outside. Defaults to the actual port assigned via <literal>http.port</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.bind_host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The host address to bind the HTTP service to. Defaults to <literal>http.host</literal> (if set) or <literal>network.bind_host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.publish_host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The host address to publish for HTTP clients to connect to. Defaults to <literal>http.host</literal> (if set) or <literal>network.publish_host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Used to set the <literal>http.bind_host</literal> and the <literal>http.publish_host</literal> Defaults to <literal>http.host</literal> or <literal>network.host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.max_content_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The max content of an HTTP request. Defaults to
<literal>100mb</literal>. If set to greater than <literal>Integer.MAX_VALUE</literal>, it will be reset to 100mb.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.max_initial_line_length</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The max length of an HTTP URL. Defaults
to <literal>4kb</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.max_header_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The max size of allowed headers.  Defaults to <literal>8kB</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.compression</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Support for compression when possible (with
Accept-Encoding). Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.compression_level</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Defines the compression level to use.
Defaults to <literal>6</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.enabled</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Enable or disable cross-origin resource sharing,
i.e. whether a browser on another origin can do requests to
Elasticsearch. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.allow-origin</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Which origins to allow. Defaults to no origins
allowed. If you prepend and append a <literal>/</literal> to the value, this will
be treated as a regular expression, allowing you to support HTTP and HTTPs.
for example using <literal>/https?:\/\/localhost(:[0-9]+)?/</literal> would return the
request header appropriately in both cases. <literal>*</literal> is a valid value but is
considered a <emphasis role="strong">security risk</emphasis> as your elasticsearch instance is open to cross origin
requests from <emphasis role="strong">anywhere</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.max-age</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Browsers send a "preflight" OPTIONS-request to
determine CORS settings. <literal>max-age</literal> defines how long the result should
be cached for. Defaults to <literal>1728000</literal> (20 days)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.allow-methods</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Which methods to allow. Defaults to
<literal>OPTIONS, HEAD, GET, POST, PUT, DELETE</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.allow-headers</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Which headers to allow. Defaults to
<literal>X-Requested-With, Content-Type, Content-Length</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.cors.allow-credentials</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Whether the <literal>Access-Control-Allow-Credentials</literal>
header should be returned. Note: This header is only returned, when the setting is
set to <literal>true</literal>. Defaults to <literal>false</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.detailed_errors.enabled</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Enables or disables the output of detailed error messages
and stack traces in response output. Note: When set to <literal>false</literal> and the <literal>error_trace</literal> request
parameter is specified, an error will be returned; when <literal>error_trace</literal> is not specified, a
simple message will be returned. Defaults to <literal>true</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.pipelining</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Enable or disable HTTP pipelining, defaults to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>http.pipelining.max_events</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The maximum number of events to be queued up in memory before a HTTP connection is closed, defaults to <literal>10000</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>It also uses the common
<link linkend="modules-network">network settings</link>.</simpara>
<bridgehead id="_disable_http" renderas="sect2">Disable HTTP<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/http.asciidoc">Edit me</ulink></bridgehead>
<simpara>The http module can be completely disabled and not started by setting
<literal>http.enabled</literal> to <literal>false</literal>. Elasticsearch nodes (and Java clients) communicate
internally using the <link linkend="modules-transport">transport interface</link>, not HTTP. It
might make  sense to disable the <literal>http</literal> layer entirely on nodes which are not
meant to serve REST requests directly. For instance, you could disable HTTP on
<link linkend="modules-node">data-only nodes</link> if you also have
<link linkend="modules-node">client nodes</link> which are intended to serve all REST requests.
Be aware, however, that you will not be able to send any REST requests (eg to
retrieve node stats) directly to nodes which have HTTP disabled.</simpara>
</chapter>
<chapter id="modules-indices">
<title>Indices<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices.asciidoc">Edit me</ulink></title>
<simpara>The indices module controls index-related settings that are globally managed
for all indices, rather than being configurable at a per-index level.</simpara>
<simpara>Available settings include:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="circuit-breaker">Circuit breaker</link>
</term>
<listitem>
<simpara>
    Circuit breakers set limits on memory usage to avoid out of memory exceptions.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-fielddata">Fielddata cache</link>
</term>
<listitem>
<simpara>
    Set limits on the amount of heap used by the in-memory fielddata cache.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="query-cache">Node query cache</link>
</term>
<listitem>
<simpara>
    Configure the amount heap used to cache queries results.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="indexing-buffer">Indexing buffer</link>
</term>
<listitem>
<simpara>
    Control the size of the buffer allocated to the indexing process.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="shard-request-cache">Shard request cache</link>
</term>
<listitem>
<simpara>
    Control the behaviour of the shard-level request cache.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="recovery">Recovery</link>
</term>
<listitem>
<simpara>
    Control the resource limits on the shard recovery process.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="indices-ttl">TTL interval</link>
</term>
<listitem>
<simpara>
    Control how expired documents are removed.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<section id="circuit-breaker">
<title>Circuit Breaker<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/circuit_breaker.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch contains multiple circuit breakers used to prevent operations from
causing an OutOfMemoryError. Each breaker specifies a limit for how much memory
it can use. Additionally, there is a parent-level breaker that specifies the
total amount of memory that can be used across all breakers.</simpara>
<simpara>These settings can be dynamically updated on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API.</simpara>
<bridgehead id="parent-circuit-breaker" renderas="sect3">Parent circuit breaker<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/circuit_breaker.asciidoc">Edit me</ulink></bridgehead>
<simpara>The parent-level breaker can be configured with the following setting:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.breaker.total.limit</literal>
</term>
<listitem>
<simpara>
    Starting limit for overall parent breaker, defaults to 70% of JVM heap.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="fielddata-circuit-breaker" renderas="sect3">Field data circuit breaker<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/circuit_breaker.asciidoc">Edit me</ulink></bridgehead>
<simpara>The field data circuit breaker allows Elasticsearch to estimate the amount of
memory a field will require to be loaded into memory. It can then prevent the
field data loading by raising an exception. By default the limit is configured
to 60% of the maximum JVM heap. It can be configured with the following
parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.breaker.fielddata.limit</literal>
</term>
<listitem>
<simpara>
    Limit for fielddata breaker, defaults to 60% of JVM heap
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.breaker.fielddata.overhead</literal>
</term>
<listitem>
<simpara>
    A constant that all field data estimations are multiplied with to determine a
    final estimation. Defaults to 1.03
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="request-circuit-breaker" renderas="sect3">Request circuit breaker<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/circuit_breaker.asciidoc">Edit me</ulink></bridgehead>
<simpara>The request circuit breaker allows Elasticsearch to prevent per-request data
structures (for example, memory used for calculating aggregations during a
request) from exceeding a certain amount of memory.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.breaker.request.limit</literal>
</term>
<listitem>
<simpara>
    Limit for request breaker, defaults to 40% of JVM heap
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.breaker.request.overhead</literal>
</term>
<listitem>
<simpara>
    A constant that all request estimations are multiplied with to determine a
    final estimation. Defaults to 1
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="in-flight-circuit-breaker" renderas="sect3">In flight requests circuit breaker<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/circuit_breaker.asciidoc">Edit me</ulink></bridgehead>
<simpara>The in flight requests circuit breaker allows Elasticsearch to limit the memory usage of all
currently active incoming requests on transport or HTTP level from exceeding a certain amount of
memory on a node. The memory usage is based on the content length of the request itself.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>network.breaker.inflight_requests.limit</literal>
</term>
<listitem>
<simpara>
    Limit for in flight requests breaker, defaults to 100% of JVM heap. This means that it is bound
    by the limit configured for the parent circuit breaker.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>network.breaker.inflight_requests.overhead</literal>
</term>
<listitem>
<simpara>
    A constant that all in flight requests estimations are multiplied with to determine a
    final estimation. Defaults to 1
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="modules-fielddata" renderas="sect2">Fielddata<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/fielddata.asciidoc">Edit me</ulink></bridgehead>
<simpara>The field data cache is used mainly when sorting on or computing aggregations
on a field. It loads all the field values to memory in order to provide fast
document based access to those values. The field data cache can be
expensive to build for a field, so its recommended to have enough memory
to allocate it, and to keep it loaded.</simpara>
<simpara>The amount of memory used for the field
data cache can be controlled using <literal>indices.fielddata.cache.size</literal>. Note:
reloading  the field data which does not fit into your cache will be expensive
and  perform poorly.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.fielddata.cache.size</literal>
</term>
<listitem>
<simpara>
    The max size of the field data cache, eg <literal>30%</literal> of node heap space, or an
    absolute value, eg <literal>12GB</literal>. Defaults to unbounded.  Also see
    <xref linkend="fielddata-circuit-breaker"/>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<note><simpara>These are static settings which must be configured on every data node in
the cluster.</simpara></note>
<bridgehead id="fielddata-monitoring" renderas="sect3">Monitoring field data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/fielddata.asciidoc">Edit me</ulink></bridgehead>
<simpara>You can monitor memory usage for field data as well as the field data circuit
breaker using
<link linkend="cluster-nodes-stats">Nodes Stats API</link></simpara>
</section>
<section id="query-cache">
<title>Node Query Cache<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/query_cache.asciidoc">Edit me</ulink></title>
<simpara>The query cache is responsible for caching the results of queries.
There is one queries cache per node that is shared by all shards.
The cache implements an LRU eviction policy: when a cache becomes full, the
least recently used data is evicted to make way for new data.</simpara>
<simpara>The query cache only caches queries which are being used in a filter context.</simpara>
<simpara>The following setting is <emphasis>static</emphasis> and must be configured on every data node in
the cluster:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.queries.cache.size</literal>
</term>
<listitem>
<simpara>
    Controls the memory size for the filter cache , defaults to <literal>10%</literal>. Accepts
    either a percentage value, like <literal>5%</literal>, or an exact value, like <literal>512mb</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="indexing-buffer">
<title>Indexing Buffer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/indexing_buffer.asciidoc">Edit me</ulink></title>
<simpara>The indexing buffer is used to store newly indexed documents.  When it fills
up, the documents in the buffer are written to a segment on disk. It is divided
between all shards on the node.</simpara>
<simpara>The following settings are <emphasis>static</emphasis> and must be configured on every data node
in the cluster:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.memory.index_buffer_size</literal>
</term>
<listitem>
<simpara>
    Accepts either a percentage or a byte size value. It defaults to <literal>10%</literal>,
    meaning that <literal>10%</literal> of the total heap allocated to a node will be used as the
    indexing buffer size.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.memory.min_index_buffer_size</literal>
</term>
<listitem>
<simpara>
    If the <literal>index_buffer_size</literal> is specified as a percentage, then this
    setting can be used to specify an absolute minimum.  Defaults to <literal>48mb</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.memory.max_index_buffer_size</literal>
</term>
<listitem>
<simpara>
    If the <literal>index_buffer_size</literal> is specified as a percentage, then this
    setting can be used to specify an absolute maximum.  Defaults to unbounded.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.memory.min_shard_index_buffer_size</literal>
</term>
<listitem>
<simpara>
    Sets a hard lower limit for the memory allocated per shard for its own
    indexing buffer. Defaults to <literal>4mb</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section id="shard-request-cache">
<title>Shard request cache<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></title>
<simpara>When a search request is run against an index or against many indices, each
involved shard executes the search locally and returns its local results to
the <emphasis>coordinating node</emphasis>, which combines these shard-level results into a
&#8220;global&#8221; result set.</simpara>
<simpara>The shard-level request cache module caches the local results on each shard.
This allows frequently used (and potentially heavy) search requests to return
results almost instantly. The requests cache is a very good fit for the logging
use case, where only the most recent index is being actively updated&#8201;&#8212;&#8201;results from older indices will be served directly from the cache.</simpara>
<important>
<simpara>For now, the requests cache will only cache the results of search requests
where <literal>size=0</literal>, so it will not cache <literal>hits</literal>,
but it will cache <literal>hits.total</literal>,  <link linkend="search-aggregations">aggregations</link>, and
<link linkend="search-suggesters">suggestions</link>.</simpara>
<simpara>Queries that use <literal>now</literal> (see <xref linkend="date-math"/>) cannot be cached.</simpara>
</important>
<bridgehead id="_cache_invalidation" renderas="sect3">Cache invalidation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The cache is smart&#8201;&#8212;&#8201;it keeps the same <emphasis>near real-time</emphasis> promise as uncached
search.</simpara>
<simpara>Cached results are invalidated automatically whenever the shard refreshes, but
only if the data in the shard has actually changed.  In other words, you will
always get the same results from the cache as you would for an uncached search
request.</simpara>
<simpara>The longer the refresh interval, the longer that cached entries will remain
valid. If the cache is full, the least recently used cache keys will be
evicted.</simpara>
<simpara>The cache can be expired manually with the <link linkend="indices-clearcache"><literal>clear-cache</literal> API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST 'localhost:9200/kimchy,elasticsearch/_cache/clear?request_cache=true'</programlisting>
<bridgehead id="_enabling_caching_by_default" renderas="sect3">Enabling caching by default<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The cache is not enabled by default, but can be enabled when creating a new
index as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/my_index -d'
{
  "settings": {
    "index.requests.cache.enable": true
  }
}
'</programlisting>
<simpara>It can also be enabled or disabled dynamically on an existing index with the
<link linkend="indices-update-settings"><literal>update-settings</literal></link> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/my_index/_settings -d'
{ "index.requests.cache.enable": true }
'</programlisting>
<bridgehead id="_enabling_caching_per_request" renderas="sect3">Enabling caching per request<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>request_cache</literal> query-string parameter can be used to enable or disable
caching on a <emphasis role="strong">per-request</emphasis> basis.  If set, it overrides the index-level setting:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/my_index/_search?request_cache=true' -d'
{
  "size": 0,
  "aggs": {
    "popular_colors": {
      "terms": {
        "field": "colors"
      }
    }
  }
}
'</programlisting>
<important><simpara>If your query uses a script whose result is not deterministic (e.g.
it uses a random function or references the current time) you should set the
<literal>request_cache</literal> flag to <literal>false</literal> to disable caching for that request.</simpara></important>
<bridgehead id="_cache_key" renderas="sect3">Cache key<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The whole JSON body is used as the cache key.  This means that if the JSON
changes&#8201;&#8212;&#8201;for instance if keys are output in a different order&#8201;&#8212;&#8201;then the
cache key will not be recognised.</simpara>
<tip><simpara>Most JSON libraries support a <emphasis>canonical</emphasis> mode which ensures that JSON
keys are always emitted in the same order. This canonical mode can be used in
the application to ensure that a request is always serialized in the same way.</simpara></tip>
<bridgehead id="_cache_settings" renderas="sect3">Cache settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The cache is managed at the node level, and has a default maximum size of <literal>1%</literal>
of the heap.  This can be changed in the <literal>config/elasticsearch.yml</literal> file with:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">indices.requests.cache.size: 2%</programlisting>
<simpara>Also, you can use the <literal>indices.requests.cache.expire</literal> setting to specify a TTL
for cached results, but there should be no reason to do so.  Remember that
stale results are automatically invalidated when the index is refreshed. This
setting is provided for completeness' sake only.</simpara>
<bridgehead id="_monitoring_cache_usage" renderas="sect3">Monitoring cache usage<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/request_cache.asciidoc">Edit me</ulink></bridgehead>
<simpara>The size of the cache (in bytes) and the number of evictions can be viewed
by index, with the <link linkend="indices-stats"><literal>indices-stats</literal></link> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_stats/request_cache?pretty&amp;human'</programlisting>
<simpara>or by node with the <link linkend="cluster-nodes-stats"><literal>nodes-stats</literal></link> API:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl 'localhost:9200/_nodes/stats/indices/request_cache?pretty&amp;human'</programlisting>
</section>
<section id="recovery">
<title>Indices Recovery<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/recovery.asciidoc">Edit me</ulink></title>
<simpara>The following <emphasis>expert</emphasis> settings can be set to manage the recovery policy.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.recovery.concurrent_streams</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>3</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.concurrent_small_file_streams</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>2</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.file_chunk_size</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>512kb</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.translog_ops</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>1000</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.translog_size</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>512kb</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.compress</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>true</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.recovery.max_bytes_per_sec</literal>
</term>
<listitem>
<simpara>
    Defaults to <literal>40mb</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>These settings can be dynamically updated on a live cluster with the
<link linkend="cluster-update-settings">cluster-update-settings</link> API:</simpara>
</section>
<section id="indices-ttl">
<title>TTL interval<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/indices/ttl_interval.asciidoc">Edit me</ulink></title>
<simpara>Documents that have a <link linkend="mapping-ttl-field"><literal>ttl</literal></link> value set need to be deleted
once they have expired.  How and how often they are deleted is controlled by
the following dynamic cluster settings:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>indices.ttl.interval</literal>
</term>
<listitem>
<simpara>
    How often the deletion process runs.  Defaults to <literal>60s</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>indices.ttl.bulk_size</literal>
</term>
<listitem>
<simpara>
    The deletions are processed with a <link linkend="docs-bulk">bulk request</link>.
    The number of deletions processed can be configured with
    this settings. Defaults to <literal>10000</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</chapter>
<chapter id="modules-network">
<title>Network Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch binds to localhost only by default.  This is sufficient for you
to run a local development server (or even a development cluster, if you start
multiple nodes on the same machine), but you will need to configure some
<link linkend="common-network-settings">basic network settings</link> in order to run a real
production cluster across multiple servers.</simpara>
<warning>
<title>Be careful with the network configuration!</title>
<simpara>Never expose an unprotected node to the public internet.</simpara>
</warning>
<bridgehead id="common-network-settings" renderas="sect2">Commonly Used Network Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<literal>network.host</literal>
</term>
<listitem>
<simpara>
The node will bind to this hostname or IP address and <emphasis>publish</emphasis> (advertise)
this host to other nodes in the cluster. Accepts an IP address, hostname, a
<link linkend="network-interface-values">special value</link>, or an array of any combination
of these.
</simpara>
<simpara>Defaults to <literal>_local_</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>discovery.zen.ping.unicast.hosts</literal>
</term>
<listitem>
<simpara>
In order to join a cluster, a node needs to know the hostname or IP address of
at least some of the other nodes in the cluster.  This setting provides the
initial list of other nodes that this node will try to contact. Accepts IP
addresses or hostnames.
</simpara>
<simpara>Defaults to <literal>["127.0.0.1", "[::1]"]</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>http.port</literal>
</term>
<listitem>
<simpara>
Port to bind to for incoming HTTP requests. Accepts a single value or a range.
If a range is specified, the node will bind to the first available port in the
range.
</simpara>
<simpara>Defaults to <literal>9200-9300</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>transport.tcp.port</literal>
</term>
<listitem>
<simpara>
Port to bind for communication between nodes. Accepts a single value or a
range. If a range is specified, the node will bind to the first available port
in the range.
</simpara>
<simpara>Defaults to <literal>9300-9400</literal>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="network-interface-values" renderas="sect2">Special values for <literal>network.host</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following special values may be passed to <literal>network.host</literal>:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_[networkInterface]_</literal>
</simpara>
</entry>
<entry>
<simpara>
  Addresses of a network interface, for example <literal>_en0_</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_local_</literal>
</simpara>
</entry>
<entry>
<simpara>
  Any loopback addresses on the system, for example <literal>127.0.0.1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_site_</literal>
</simpara>
</entry>
<entry>
<simpara>
  Any site-local addresses on the system, for example <literal>192.168.0.1</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_global_</literal>
</simpara>
</entry>
<entry>
<simpara>
  Any globally-scoped addresses on the system, for example <literal>8.8.8.8</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_ipv4_vs_ipv6" renderas="sect3">IPv4 vs IPv6<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<simpara>These special values will work over both IPv4 and IPv6 by default, but you can
also limit this with the use of <literal>:ipv4</literal> of <literal>:ipv6</literal> specifiers. For example,
<literal>_en0:ipv4_</literal> would only bind to the IPv4 addresses of interface <literal>en0</literal>.</simpara>
<tip>
<title>Discovery in the cloud</title>
<simpara>More special settings are available when running in the cloud with either the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/cloud-aws-discovery.html#cloud-aws-discovery-network-host">AWS Cloud plugin</ulink> or the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/discovery-gce-network-host.html#discovery-gce-network-host">Google Compute Engine Cloud plugin</ulink>
installed.</simpara>
</tip>
<bridgehead id="advanced-network-settings" renderas="sect2">Advanced network settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>network.host</literal> setting explained in <link linkend="common-network-settings">Commonly used network settings</link>
is a shortcut which sets the <emphasis>bind host</emphasis> and the <emphasis>publish host</emphasis> at the same
time. In advanced used cases, such as when running behind a proxy server, you
may need to set these settings to different values:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>network.bind_host</literal>
</term>
<listitem>
<simpara>
This specifies which network interface(s) a node should bind to in order to
listen for incoming requests.  A node can bind to multiple interfaces, e.g.
two network cards, or a site-local address and a local address. Defaults to
<literal>network.host</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>network.publish_host</literal>
</term>
<listitem>
<simpara>
The publish host is the single interface that the node advertises to other
nodes in the cluster, so that those nodes can connect to it.   Currently an
elasticsearch node may be bound to multiple addresses, but only publishes one.
If not specified, this defaults to the &#8220;best&#8221; address from
<literal>network.host</literal>, sorted by IPv4/IPv6 stack preference, then by
reachability.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Both of the above settings can be configured just like <literal>network.host</literal>&#8201;&#8212;&#8201;they
accept IP addresses, host names, and
<link linkend="network-interface-values">special values</link>.</simpara>
<bridgehead id="tcp-settings" renderas="sect2">Advanced TCP Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<simpara>Any component that uses TCP (like the <link linkend="modules-http">HTTP</link> and
<link linkend="modules-transport">Transport</link> modules) share the following settings:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>network.tcp.no_delay</literal>
</simpara>
</entry>
<entry>
<simpara>
Enable or disable the <ulink url="https://en.wikipedia.org/wiki/Nagle%27s_algorithm">TCP no delay</ulink>
setting. Defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>network.tcp.keep_alive</literal>
</simpara>
</entry>
<entry>
<simpara>
Enable or disable <ulink url="https://en.wikipedia.org/wiki/Keepalive">TCP keep alive</ulink>.
Defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>network.tcp.reuse_address</literal>
</simpara>
</entry>
<entry>
<simpara>
Should an address be reused or not. Defaults to <literal>true</literal> on non-windows
machines.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>network.tcp.send_buffer_size</literal>
</simpara>
</entry>
<entry>
<simpara>
The size of the TCP send buffer (specified with <link linkend="size-units">size units</link>).
By default not explicitly set.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>network.tcp.receive_buffer_size</literal>
</simpara>
</entry>
<entry>
<simpara>
The size of the TCP receive buffer (specified with <link linkend="size-units">size units</link>).
By default not explicitly set.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_transport_and_http_protocols" renderas="sect2">Transport and HTTP protocols<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/network.asciidoc">Edit me</ulink></bridgehead>
<simpara>An Elasticsearch node exposes two network protocols which inherit the above
settings, but may be further configured independently:</simpara>
<variablelist>
<varlistentry>
<term>
TCP Transport
</term>
<listitem>
<simpara>
Used for communication between nodes in the cluster, by the Java
<ulink url="https://www.elastic.co/guide/en/elasticsearch/client/java-api/2.4//transport-client.html">Transport client</ulink> and by the
<link linkend="modules-tribe">Tribe node</link>.  See the <link linkend="modules-transport">Transport module</link>
for more information.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
HTTP
</term>
<listitem>
<simpara>
Exposes the JSON-over-HTTP interface used by all clients other than the Java
clients. See the <link linkend="modules-http">HTTP module</link> for more information.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="modules-node">
<title>Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></title>
<simpara>Any time that you start an instance of Elasticsearch, you are starting a
<emphasis>node</emphasis>. A collection of connected nodes is  called a
<link linkend="modules-cluster">cluster</link>. If you are running a single node of Elasticsearch,
then you have a cluster of one node.</simpara>
<simpara>Every node in the cluster can handle <link linkend="modules-http">HTTP</link> and
<link linkend="modules-transport">Transport</link> traffic by default. The transport layer
is used exclusively for communication between nodes and between nodes and the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/client/java-api/2.4//transport-client.html">Java <literal>TransportClient</literal></ulink>; the HTTP layer is
used only by external REST clients.</simpara>
<simpara>All nodes know about all the other nodes in the cluster and can forward client
requests to the appropriate node. Besides that, each node serves one or more
purpose:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="master-node">Master-eligible node</link>
</term>
<listitem>
<simpara>
A node that has <literal>node.master</literal> set to <literal>true</literal> (default), which makes it eligible
to be <link linkend="modules-discovery-zen">elected as the <emphasis>master</emphasis> node</link>, which controls
the cluster.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="data-node">Data node</link>
</term>
<listitem>
<simpara>
A node that has <literal>node.data</literal> set to <literal>true</literal> (default). Data nodes hold data and
perform data related operations such as CRUD, search, and aggregations.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="client-node">Client node</link>
</term>
<listitem>
<simpara>
A client node has both <literal>node.master</literal> and <literal>node.data</literal> set to <literal>false</literal>. It can
neither hold data nor become the master node.  It behaves as a &#8220;smart
router&#8221; and is used to forward cluster-level requests to the master node and
data-related requests (such as search) to the appropriate data nodes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="modules-tribe">Tribe node</link>
</term>
<listitem>
<simpara>
A tribe node, configured via the <literal>tribe.*</literal> settings, is a special type  of
client node that can connect to multiple clusters and perform search and other
operations across all connected clusters.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>By default a node is both a master-eligible node and a data node. This is very
convenient for small clusters but, as the cluster grows, it becomes important
to consider separating dedicated master-eligible nodes from dedicated data
nodes.</simpara>
<note id="coordinating-node">
<title>Coordinating node</title>
<simpara>Requests like search requests or bulk-indexing requests may involve data held
on different data nodes. A search request, for example, is executed in two
phases which are coordinated by the node which receives the client request&#8201;&#8212;&#8201;the <emphasis>coordinating node</emphasis>.</simpara>
<simpara>In the <emphasis>scatter</emphasis> phase, the coordinating node forwards the request to the data
nodes which hold the data.  Each data node executes the request locally and
returns its results to the coordinating node. In the <emphasis>gather</emphasis>  phase, the
coordinating node reduces each data node&#8217;s results into a single global
resultset.</simpara>
<simpara>This means that a <emphasis>client</emphasis> node needs to have enough memory and CPU in order to
deal with the gather phase.</simpara>
</note>
<bridgehead id="master-node" renderas="sect2">Master Eligible Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>The master node is responsible for lightweight cluster-wide actions such as
creating or deleting an index, tracking which nodes are part of the cluster,
and deciding which shards to allocate to which nodes. It is important for
cluster health to have a stable master node.</simpara>
<simpara>Any master-eligible node (all nodes by default) may be elected to become the
master node by the <link linkend="modules-discovery-zen">master election process</link>.</simpara>
<simpara>Indexing and searching your data is CPU-, memory-, and I/O-intensive work
which can put pressure on a node&#8217;s resources. To ensure that your master
node is stable and not under pressure, it is a good idea in a bigger
cluster to split the roles between dedicated master-eligible nodes and
dedicated data nodes.</simpara>
<simpara>While master nodes can also behave as <link linkend="coordinating-node">coordinating nodes</link>
and route search and indexing requests from clients to data nodes, it is
better <emphasis>not</emphasis> to use dedicated master nodes for this purpose. It is important
for the stability of the cluster that master-eligible nodes do as little work
as possible.</simpara>
<simpara>To create a standalone master-eligible node, set:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.master: true <co id="CO273-1"/>
node.data: false <co id="CO273-2"/></programlisting>
<calloutlist>
<callout arearefs="CO273-1">
<para>
The <literal>node.master</literal> role is enabled by default.
</para>
</callout>
<callout arearefs="CO273-2">
<para>
Disable the <literal>node.data</literal> role (enabled by default).
</para>
</callout>
</calloutlist>
<bridgehead id="split-brain" renderas="sect3">Avoiding split brain with <literal>minimum_master_nodes</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>To prevent data loss, it is vital to configure the
<literal>discovery.zen.minimum_master_nodes</literal> setting (which defaults to <literal>1</literal>) so that
each master-eligible node knows the <emphasis>minimum number of master-eligible nodes</emphasis>
that must be visible in order to form a cluster.</simpara>
<simpara>To explain, imagine that you have a cluster consisting of two master-eligible
nodes. A network failure breaks communication between these two nodes.  Each
node sees one master-eligible node&#8230; itself. With <literal>minimum_master_nodes</literal> set
to the default of <literal>1</literal>,  this is sufficient to form a cluster. Each node elects
itself as the new master (thinking that the other master-eligible node has
died) and the result is two clusters, or a <emphasis>split brain</emphasis>.  These two nodes
will never rejoin until one node is restarted.  Any data that has been written
to the restarted node will be lost.</simpara>
<simpara>Now imagine that you have a cluster with three master-eligible nodes, and
<literal>minimum_master_nodes</literal> set to <literal>2</literal>.  If a network split separates one node from
the other two nodes, the side with one node cannot see enough master-eligible
nodes and will realise that it cannot elect itself as master.  The side with
two nodes will elect a new master (if needed) and continue functioning
correctly.  As soon as the network split is resolved, the single node will
rejoin the cluster and start serving requests again.</simpara>
<simpara>This setting should be set to a <emphasis>quorum</emphasis> of master-eligible nodes:</simpara>
<literallayout class="monospaced">(master_eligible_nodes / 2) + 1</literallayout>
<simpara>In other words, if there are three master-eligible nodes, then minimum master
nodes should be set to <literal>(3 / 2) + 1</literal> or <literal>2</literal>:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">discovery.zen.minimum_master_nodes: 2 <co id="CO274-1"/></programlisting>
<calloutlist>
<callout arearefs="CO274-1">
<para>
Defaults to <literal>1</literal>.
</para>
</callout>
</calloutlist>
<simpara>This setting can also be changed dynamically on a live cluster with the
<link linkend="cluster-update-settings">cluster update settings API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT _cluster/settings
{
  "transient": {
    "discovery.zen.minimum_master_nodes": 2
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<tip><simpara>An advantage of splitting the master and data roles between dedicated
nodes is that you can have just three master-eligible nodes and set
<literal>minimum_master_nodes</literal> to <literal>2</literal>. You never have to change this setting, no
matter how many dedicated data nodes you add to the cluster.</simpara></tip>
<bridgehead id="data-node" renderas="sect2">Data Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>Data nodes hold the shards that contain the documents you have indexed. Data
nodes handle data related operations like CRUD, search, and aggregations.
These operations are I/O-, memory-, and CPU-intensive. It is important to
monitor these resources and to add more data nodes if they are overloaded.</simpara>
<simpara>The main benefit of having dedicated data nodes is the separation of the
master and data roles.</simpara>
<simpara>To create a dedicated data node, set:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.master: false <co id="CO275-1"/>
node.data: true <co id="CO275-2"/></programlisting>
<calloutlist>
<callout arearefs="CO275-1">
<para>
Disable the <literal>node.master</literal> role (enabled by default).
</para>
</callout>
<callout arearefs="CO275-2">
<para>
The <literal>node.data</literal> role is enabled by default.
</para>
</callout>
</calloutlist>
<bridgehead id="client-node" renderas="sect2">Client Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>If you take away the ability to be able to handle master duties and take away
the ability to hold data, then you are left with a <emphasis>client</emphasis> node that can only
route requests, handle the search reduce phase, and distribute bulk indexing.
Essentially, client nodes behave as smart load balancers.</simpara>
<simpara>Standalone client nodes can benefit large clusters by offloading the
coordinating node role from data and master-eligible nodes.  Client nodes join
the cluster and receive the full <link linkend="cluster-state">cluster state</link>, like every
other node, and they use the cluster state to route requests directly to the
appropriate place(s).</simpara>
<warning><simpara>Adding too many client nodes to a cluster can increase the burden on
the entire cluster because the elected master node must await acknowledgement
of cluster state updates from every node! The benefit of client nodes should
not be overstated&#8201;&#8212;&#8201;data nodes can happily serve the same purpose as client
nodes.</simpara></warning>
<simpara>To create a deciated client node, set:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.master: false <co id="CO276-1"/>
node.data: false <co id="CO276-2"/></programlisting>
<calloutlist>
<callout arearefs="CO276-1">
<para>
Disable the <literal>node.master</literal> role (enabled by default).
</para>
</callout>
<callout arearefs="CO276-2">
<para>
Disable the <literal>node.data</literal> role (enabled by default).
</para>
</callout>
</calloutlist>
<bridgehead id="_node_data_path_settings" renderas="sect1">Node data path settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="data-path" renderas="sect2"><literal>path.data</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>Every data and master-eligible node requires access to a data directory where
shards and index and cluster metadata will be stored. The <literal>path.data</literal> defaults
to <literal>$ES_HOME/data</literal> but can be configured in the <literal>elasticsearch.yml</literal> config
file an absolute path or a path relative to <literal>$ES_HOME</literal> as follows:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.data:  /var/elasticsearch/data</programlisting>
<simpara>Like all node settings, it can also be specified on the command line as:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/elasticsearch --path.data /var/elasticsearch/data</programlisting>
<tip><simpara>When using the <literal>.zip</literal> or <literal>.tar.gz</literal> distributions, the <literal>path.data</literal> setting
should be configured to locate the data directory outside the Elasticsearch
home directory, so that the home directory can be deleted without deleting
your data! The RPM and Debian distributions do this for you already.</simpara></tip>
<bridgehead id="max-local-storage-nodes" renderas="sect2"><literal>node.max_local_storage_nodes</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <link linkend="data-path">data path</link> can be shared by multiple nodes, even by nodes
from different clusters.  This is very useful for testing failover and
different configurations on your development machine.  In production, however,
it is recommended to run only one node of Elasticsearch per server.</simpara>
<simpara>To prevent more than one node from sharing the same data path, add this
setting to the <literal>elasticsearch.yml</literal> config file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">node.max_local_storage_nodes: 1</programlisting>
<warning><simpara>Never run different node types (i.e. master, data, client) from the
same data directory. This can lead to unexpected data loss.</simpara></warning>
<bridgehead id="_other_node_settings" renderas="sect1">Other node settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/node.asciidoc">Edit me</ulink></bridgehead>
<simpara>More node settings can be found in <link linkend="modules">Modules</link>.  Of particular note are
the <link linkend="cluster-name"><literal>cluster.name</literal></link>, the <link linkend="node-name"><literal>node.name</literal></link> and the
<link linkend="modules-network">network settings</link>.</simpara>
</chapter>
<chapter id="modules-plugins">
<title>Plugins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/plugins.asciidoc">Edit me</ulink></title>
<bridgehead id="_plugins" renderas="sect2">Plugins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/plugins.asciidoc">Edit me</ulink></bridgehead>
<simpara>Plugins are a way to enhance the basic elasticsearch functionality in a
custom manner. They range from adding custom mapping types, custom
analyzers (in a more built in fashion), native scripts, custom discovery
and more.</simpara>
<simpara>See the <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/index.html">Plugins documentation</ulink> for more.</simpara>
</chapter>
<chapter id="modules-scripting">
<title>Scripting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></title>
<simpara>The scripting module allows to use scripts in order to evaluate custom
expressions. For example, scripts can be used to return "script fields"
as part of a search request, or can be used to evaluate a custom score
for a query and so on.</simpara>
<simpara>The scripting module uses by default <ulink url="http://groovy-lang.org/">groovy</ulink>
(previously <ulink url="http://mvel.codehaus.org/">mvel</ulink> in 1.3.x and earlier) as the
scripting language with some extensions. Groovy is used since it is extremely
fast and very simple to use.</simpara>
<important>
<title>Groovy dynamic scripting off by default from v1.4.3</title>
<simpara>Groovy dynamic scripting is off by default, preventing dynamic Groovy scripts
from being accepted as part of a request or retrieved from the special
<literal>.scripts</literal> index. You will still be able to use Groovy scripts stored in files
in the <literal>config/scripts/</literal> directory on every node.</simpara>
<simpara>To convert an inline script to a file, take this simple script
as an example:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
  "script_fields": {
    "my_field": {
      "script": {
        "inline": "1 + my_var",
        "params": {
          "my_var": 2
        }
      }
    }
  }
}</programlisting>
<simpara>Save the contents of the <literal>inline</literal> field as a file called <literal>config/scripts/my_script.groovy</literal>
on every data node in the cluster:</simpara>
<programlisting language="js" linenumbering="unnumbered">1 + my_var</programlisting>
<simpara>Now you can access the script by file name (without the extension):</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_search
{
  "script_fields": {
    "my_field": {
      "script": {
        "file": "my_script",
        "params": {
          "my_var": 2
        }
      }
    }
  }
}</programlisting>
</important>
<simpara>Additional <literal>lang</literal> plugins are provided to allow to execute scripts in
different languages. All places where a script can be used, a <literal>lang</literal> parameter
can be provided to define the language of the script. The following are the
supported scripting languages:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33*"/>
<colspec colname="col_2" colwidth="33*"/>
<colspec colname="col_3" colwidth="33*"/>
<thead>
<row>
<entry align="left" valign="top">Language   </entry>
<entry align="left" valign="top">Sandboxed </entry>
<entry align="left" valign="top">Required plugin</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>groovy</simpara></entry>
<entry align="left" valign="top"><simpara>no</simpara></entry>
<entry align="left" valign="top"><simpara>built-in</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>expression</simpara></entry>
<entry align="left" valign="top"><simpara>yes</simpara></entry>
<entry align="left" valign="top"><simpara>built-in</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>mustache</simpara></entry>
<entry align="left" valign="top"><simpara>yes</simpara></entry>
<entry align="left" valign="top"><simpara>built-in</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>javascript</simpara></entry>
<entry align="left" valign="top"><simpara>no</simpara></entry>
<entry align="left" valign="top"><simpara><ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/lang-javascript.html">elasticsearch-lang-javascript</ulink></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>python</simpara></entry>
<entry align="left" valign="top"><simpara>no</simpara></entry>
<entry align="left" valign="top"><simpara><ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/lang-python.html">elasticsearch-lang-python</ulink></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>To increase security, Elasticsearch does not allow you to specify scripts for
non-sandboxed languages with a request. Instead, scripts must be placed in the
<literal>scripts</literal> directory inside the configuration directory (the directory where
elasticsearch.yml is). The default location of this <literal>scripts</literal> directory can be
changed by setting <literal>path.scripts</literal> in elasticsearch.yml. Scripts placed into
this directory will automatically be picked up and be available to be used.
Once a script has been placed in this directory, it can be referenced by name.
For example, a script called <literal>calculate-score.groovy</literal> can be referenced in a
request like this:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ tree config
config
├── elasticsearch.yml
├── logging.yml
└── scripts
    └── calculate-score.groovy</programlisting>
<programlisting language="sh" linenumbering="unnumbered">$ cat config/scripts/calculate-score.groovy
log(_score * 2) + my_modifier</programlisting>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST localhost:9200/_search -d '{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "body": "foo"
        }
      },
      "functions": [
        {
          "script_score": {
            "script": {
              "lang": "groovy",
              "file": "calculate-score",
              "params": {
                "my_modifier": 8
              }
            }
          }
        }
      ]
    }
  }
}'</programlisting>
<simpara>The name of the script is derived from the hierarchy of directories it
exists under, and the file name without the lang extension. For example,
a script placed under <literal>config/scripts/group1/group2/test.py</literal> will be
named <literal>group1_group2_test</literal>.</simpara>
<bridgehead id="_indexed_scripts" renderas="sect2">Indexed Scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch allows you to store scripts in an internal index known as
<literal>.scripts</literal> and reference them by id. There are REST endpoints to manage
indexed scripts as follows:</simpara>
<simpara>Requests to the scripts endpoint look like :</simpara>
<programlisting language="js" linenumbering="unnumbered">/_scripts/{lang}/{id}</programlisting>
<simpara>Where the <literal>lang</literal> part is the language the script is in and the <literal>id</literal> part is the id
of the script. In the <literal>.scripts</literal> index the type of the document will be set to the <literal>lang</literal>.</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST localhost:9200/_scripts/groovy/indexedCalculateScore -d '{
     "script": "log(_score * 2) + my_modifier"
}'</programlisting>
<simpara>This will create a document with id: <literal>indexedCalculateScore</literal> and type: <literal>groovy</literal> in the
<literal>.scripts</literal> index. The type of the document is the language used by the script.</simpara>
<simpara>This script can be accessed at query time by using the <literal>id</literal> script parameter and passing
the script id:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST localhost:9200/_search -d '{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "body": "foo"
        }
      },
      "functions": [
        {
          "script_score": {
            "script": {
              "id": "indexedCalculateScore",
              "lang" : "groovy",
              "params": {
                "my_modifier": 8
              }
            }
          }
        }
      ]
    }
  }
}'</programlisting>
<simpara>The script can be viewed by:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XGET localhost:9200/_scripts/groovy/indexedCalculateScore</programlisting>
<simpara>This is rendered as:</simpara>
<programlisting language="js" linenumbering="unnumbered">'{
     "script": "log(_score * 2) + my_modifier"
}'</programlisting>
<simpara>Indexed scripts can be deleted by:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XDELETE localhost:9200/_scripts/groovy/indexedCalculateScore</programlisting>
<bridgehead id="enable-dynamic-scripting" renderas="sect2">Enabling dynamic scripting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>We recommend running Elasticsearch behind an application or proxy, which
protects Elasticsearch from the outside world. If users are allowed to run
inline scripts (even in a search request) or indexed scripts, then they have
the same access to your box as the user that Elasticsearch is running as. For
this reason dynamic scripting is allowed only for sandboxed languages by default.</simpara>
<simpara>First, you should not run Elasticsearch as the <literal>root</literal> user, as this would allow
a script to access or do <emphasis role="strong">anything</emphasis> on your server, without limitations. Second,
you should not expose Elasticsearch directly to users, but instead have a proxy
application inbetween. If you <emphasis role="strong">do</emphasis> intend to expose Elasticsearch directly to
your users, then you have to decide whether you trust them enough to run scripts
on your box or not.</simpara>
<simpara>It is possible to enable scripts based on their source, for
every script engine, through the following settings that need to be added to the
<literal>config/elasticsearch.yml</literal> file on every node.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.inline: true
script.indexed: true</programlisting>
<simpara>While this still allows execution of named scripts provided in the config, or
<emphasis>native</emphasis> Java scripts registered through plugins, it also allows users to run
arbitrary scripts via the API. Instead of sending the name of the file as the
script, the body of the script can be sent instead or retrieved from the
<literal>.scripts</literal> indexed if previously stored.</simpara>
<simpara>There are three possible configuration values for any of the fine-grained
script settings:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Value </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>false</literal></simpara></entry>
<entry align="left" valign="top"><simpara>scripting is turned off completely, in the context of the setting being set.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>true</literal></simpara></entry>
<entry align="left" valign="top"><simpara>scripting is turned on, in the context of the setting being set.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sandbox</literal></simpara></entry>
<entry align="left" valign="top"><simpara>scripts may be executed only for languages that are sandboxed</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>The default values are the following:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.inline: sandbox
script.indexed: sandbox
script.file: true</programlisting>
<note><simpara>Global scripting settings affect the <literal>mustache</literal> scripting language.
<link linkend="search-template">Search templates</link> internally use the <literal>mustache</literal> language,
and will still be enabled by default as the <literal>mustache</literal> engine is sandboxed,
but they will be enabled/disabled according to fine-grained settings
specified in <literal>elasticsearch.yml</literal>.</simpara></note>
<simpara>It is also possible to control which operations can execute scripts. The
supported operations are:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Value </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>aggs</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Aggregations (wherever they may be used)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>search</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Search api, Percolator api and Suggester api (e.g filters, script_fields)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>update</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Update api</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>plugin</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Any plugin that makes use of scripts under the generic <literal>plugin</literal> category</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Plugins can also define custom operations that they use scripts for instead
of using the generic <literal>plugin</literal> category. Those operations can be referred to
in the following form: <literal>${pluginName}_${operation}</literal>.</simpara>
<simpara>The following example disables scripting for <literal>update</literal> and <literal>mapping</literal> operations,
regardless of the script source, for any engine. Scripts can still be
executed from sandboxed languages as part of <literal>aggregations</literal>, <literal>search</literal>
and plugins execution though, as the above defaults still get applied.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.update: false
script.mapping: false</programlisting>
<simpara>Generic settings get applied in order, operation based ones have precedence
over source based ones. Language specific settings are supported too. They
need to be prefixed with the <literal>script.engine.&lt;engine&gt;</literal> prefix and have
precedence over any other generic settings.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">script.engine.groovy.file.aggs: true
script.engine.groovy.file.mapping: true
script.engine.groovy.file.search: true
script.engine.groovy.file.update: true
script.engine.groovy.file.plugin: true
script.engine.groovy.indexed.aggs: true
script.engine.groovy.indexed.mapping: false
script.engine.groovy.indexed.search: true
script.engine.groovy.indexed.update: false
script.engine.groovy.indexed.plugin: false
script.engine.groovy.inline.aggs: true
script.engine.groovy.inline.mapping: false
script.engine.groovy.inline.search: false
script.engine.groovy.inline.update: false
script.engine.groovy.inline.plugin: false</programlisting>
<bridgehead id="_default_scripting_language" renderas="sect2">Default Scripting Language<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>The default scripting language (assuming no <literal>lang</literal> parameter is provided) is
<literal>groovy</literal>. In order to change it, set the <literal>script.default_lang</literal> to the
appropriate language.</simpara>
<bridgehead id="_automatic_script_reloading" renderas="sect2">Automatic Script Reloading<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>config/scripts</literal> directory is scanned periodically for changes.
New and changed scripts are reloaded and deleted script are removed
from preloaded scripts cache. The reload frequency can be specified
using <literal>resource.reload.interval</literal> setting, which defaults to <literal>60s</literal>.
To disable script reloading completely set <literal>script.auto_reload_enabled</literal>
to <literal>false</literal>.</simpara>
<bridgehead id="native-java-scripts" renderas="sect2">Native (Java) Scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Sometimes <literal>groovy</literal> and <literal>expressions</literal> aren&#8217;t enough. For those times you can
implement a native script.</simpara>
<simpara>The best way to implement a native script is to write a plugin and install it.
The plugin <ulink url="https://www.elastic.co/guide/en/elasticsearch/plugins/2.4/plugin-authors.html">documentation</ulink> has more information on
how to write a plugin so that Elasticsearch will properly load it.</simpara>
<simpara>To register the actual script you&#8217;ll need to implement <literal>NativeScriptFactory</literal>
to construct the script. The actual script will extend either
<literal>AbstractExecutableScript</literal> or <literal>AbstractSearchScript</literal>. The second one is likely
the most useful and has several helpful subclasses you can extend like
<literal>AbstractLongSearchScript</literal>, <literal>AbstractDoubleSearchScript</literal>, and
<literal>AbstractFloatSearchScript</literal>. Finally, your plugin should register the native
script by declaring the <literal>onModule(ScriptModule)</literal> method.</simpara>
<simpara>If you squashed the whole thing into one class it&#8217;d look like:</simpara>
<programlisting language="java" linenumbering="unnumbered">public class MyNativeScriptPlugin extends Plugin {
    @Override
    public String name() {
        return "my-native-script";
    }
    @Override
    public String description() {
        return "my native script that does something great";
    }
    public void onModule(ScriptModule scriptModule) {
        scriptModule.registerScript("my_script", MyNativeScriptFactory.class);
    }

    public static class MyNativeScriptFactory implements NativeScriptFactory {
        @Override
        public ExecutableScript newScript(@Nullable Map&lt;String, Object&gt; params) {
            return new MyNativeScript();
        }
        @Override
        public boolean needsScores() {
            return false;
        }
    }

    public static class MyNativeScript extends AbstractFloatSearchScript {
        @Override
        public float runAsFloat() {
            float a = (float) source().get("a");
            float b = (float) source().get("b");
            return a * b;
        }
    }
}</programlisting>
<simpara>You can execute the script by specifying its <literal>lang</literal> as <literal>native</literal>, and the name
of the script as the <literal>inline</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPOST localhost:9200/_search -d '{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "body": "foo"
        }
      },
      "functions": [
        {
          "script_score": {
            "script": {
                "inline": "my_script",
                "lang" : "native"
            }
          }
        }
      ]
    }
  }
}'</programlisting>
<bridgehead id="_lucene_expressions_scripts" renderas="sect2">Lucene Expressions Scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Lucene&#8217;s expressions module provides a mechanism to compile a
<literal>javascript</literal> expression to bytecode.  This allows very fast execution,
as if you had written a <literal>native</literal> script.  Expression scripts can be
used in <literal>script_score</literal>, <literal>script_fields</literal>, sort scripts and numeric aggregation scripts.</simpara>
<simpara>See the <ulink url="http://lucene.apache.org/core/4_9_0/expressions/index.html?org/apache/lucene/expressions/js/package-summary.html">expressions module documentation</ulink>
for details on what operators and functions are available.</simpara>
<simpara>Variables in <literal>expression</literal> scripts are available to access:</simpara>
<itemizedlist>
<listitem>
<simpara>
Single valued document fields, e.g. <literal>doc['myfield'].value</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Single valued document fields can also be accessed without <literal>.value</literal> e.g. <literal>doc['myfield']</literal>
</simpara>
</listitem>
<listitem>
<simpara>
Parameters passed into the script, e.g. <literal>mymodifier</literal>
</simpara>
</listitem>
<listitem>
<simpara>
The current document&#8217;s score, <literal>_score</literal> (only available when used in a <literal>script_score</literal>)
</simpara>
</listitem>
</itemizedlist>
<simpara>Variables in <literal>expression</literal> scripts that are of type <literal>date</literal> may use the following member methods:</simpara>
<itemizedlist>
<listitem>
<simpara>
getYear()
</simpara>
</listitem>
<listitem>
<simpara>
getMonth()
</simpara>
</listitem>
<listitem>
<simpara>
getDayOfMonth()
</simpara>
</listitem>
<listitem>
<simpara>
getHourOfDay()
</simpara>
</listitem>
<listitem>
<simpara>
getMinutes()
</simpara>
</listitem>
<listitem>
<simpara>
getSeconds()
</simpara>
</listitem>
</itemizedlist>
<simpara>The following example shows the difference in years between the <literal>date</literal> fields date0 and date1:</simpara>
<simpara><literal>doc['date1'].getYear() - doc['date0'].getYear()</literal></simpara>
<simpara>There are a few limitations relative to other script languages:</simpara>
<itemizedlist>
<listitem>
<simpara>
Only numeric fields may be accessed
</simpara>
</listitem>
<listitem>
<simpara>
Stored fields are not available
</simpara>
</listitem>
<listitem>
<simpara>
If a field is sparse (only some documents contain a value), documents missing the field will have a value of <literal>0</literal>
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="_score" renderas="sect2">Score<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>In all scripts that can be used in aggregations, the current
document&#8217;s score is accessible in <literal>_score</literal>.</simpara>
<bridgehead id="_computing_scores_based_on_terms_in_scripts" renderas="sect2">Computing scores based on terms in scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>see <link linkend="modules-advanced-scripting">advanced scripting documentation</link></simpara>
<bridgehead id="_document_fields" renderas="sect2">Document Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most scripting revolve around the use of specific document fields data.
The <literal>doc['field_name']</literal> can be used to access specific field data within
a document (the document in question is usually derived by the context
the script is used). Document fields are very fast to access since they
end up being loaded into memory (all the relevant field values/tokens
are loaded to memory). Note, however, that the <literal>doc[...]</literal> notation only
allows for simple valued fields (can’t return a json object from it)
and makes sense only on non-analyzed or single term based fields.</simpara>
<simpara>The following data can be extracted from a field:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Expression </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].value</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The native value of the field. For example,
if its a short type, it will be short.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].values</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The native array values of the field. For
example, if its a short type, it will be short[]. Remember, a field can
have several values within a single doc. Returns an empty array if the
field has no values.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].empty</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A boolean indicating if the field has no
values within the doc.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].lat</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The latitude of a geo point type.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].lon</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The longitude of a geo point type.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].lats</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The latitudes of a geo point type.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].lons</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The longitudes of a geo point type.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distance(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in meters)
of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distanceWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in meters)
of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distanceInMiles(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in
miles) of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distanceInMilesWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in
miles) of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distanceInKm(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in
km) of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].distanceInKmWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>plane</literal> distance (in
km) of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistance(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
meters) of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistanceWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
meters) of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistanceInMiles(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
miles) of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistanceInMilesWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
miles) of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistanceInKm(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
km) of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].arcDistanceInKmWithDefault(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
km) of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].factorDistance(lat, lon)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The distance factor of this geo point field from the provided lat/lon.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].factorDistance(lat, lon, default)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The distance factor of this geo point field from the provided lat/lon with a default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].geohashDistance(geohash)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in meters)
of this geo point field from the provided geohash.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].geohashDistanceInKm(geohash)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in km)
of this geo point field from the provided geohash.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>doc['field_name'].geohashDistanceInMiles(geohash)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The <literal>arc</literal> distance (in
miles) of this geo point field from the provided geohash.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<bridgehead id="_stored_fields" renderas="sect2">Stored Fields<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Stored fields can also be accessed when executing a script. Note, they
are much slower to access compared with document fields, as they are not
loaded into memory. They can be simply accessed using
<literal>_fields['my_field_name'].value</literal> or <literal>_fields['my_field_name'].values</literal>.</simpara>
<bridgehead id="_accessing_the_score_of_a_document_within_a_script" renderas="sect2">Accessing the score of a document within a script<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>When using scripting for calculating the score of a document (for instance, with
the <literal>function_score</literal> query), you can access the score using the <literal>_score</literal>
variable inside of a Groovy script.</simpara>
<bridgehead id="_source_field" renderas="sect2">Source Field<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>The source field can also be accessed when executing a script. The
source field is loaded per doc, parsed, and then provided to the script
for evaluation. The <literal>_source</literal> forms the context under which the source
field can be accessed, for example <literal>_source.obj2.obj1.field3</literal>.</simpara>
<simpara>Accessing <literal>_source</literal> is much slower compared to using <literal>doc</literal>
but the data is not loaded into memory. For a single field access <literal>_fields</literal> may be
faster than using <literal>_source</literal> due to the extra overhead of potentially parsing large documents.
However, <literal>_source</literal> may be faster if you access multiple fields or if the source has already been
loaded for other purposes.</simpara>
<bridgehead id="_groovy_built_in_functions" renderas="sect2">Groovy Built In Functions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>There are several built in functions that can be used within scripts.
They include:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Function </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>sin(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the trigonometric sine of an angle.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cos(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the trigonometric cosine of an angle.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tan(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the trigonometric tangent of an angle.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>asin(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the arc sine of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>acos(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the arc cosine of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>atan(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the arc tangent of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>toRadians(angdeg)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Converts an angle measured in degrees to an
approximately equivalent angle measured in radians</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>toDegrees(angrad)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Converts an angle measured in radians to an
approximately equivalent angle measured in degrees.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>exp(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns Euler&#8217;s number <emphasis>e</emphasis> raised to the power of value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>log(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the natural logarithm (base <emphasis>e</emphasis>) of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>log10(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the base 10 logarithm of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sqrt(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the correctly rounded positive square root of a
value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cbrt(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the cube root of a double value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>IEEEremainder(f1, f2)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Computes the remainder operation on two
arguments as prescribed by the IEEE 754 standard.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ceil(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the smallest (closest to negative infinity) value
that is greater than or equal to the argument and is equal to a
mathematical integer.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>floor(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the largest (closest to positive infinity) value
that is less than or equal to the argument and is equal to a
mathematical integer.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>rint(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the value that is closest in value to the argument
and is equal to a mathematical integer.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>atan2(y, x)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the angle <emphasis>theta</emphasis> from the conversion of
rectangular coordinates (<emphasis>x</emphasis>, <emphasis>y</emphasis>) to polar coordinates (r,<emphasis>theta</emphasis>).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pow(a, b)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the value of the first argument raised to the
power of the second argument.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>round(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the closest <emphasis>int</emphasis> to the argument.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>random()</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns a random <emphasis>double</emphasis> value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>abs(a)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the absolute value of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>max(a, b)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the greater of two values.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>min(a, b)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the smaller of two values.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ulp(d)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the size of an ulp of the argument.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>signum(d)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the signum function of the argument.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sinh(x)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the hyperbolic sine of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cosh(x)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the hyperbolic cosine of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tanh(x)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns the hyperbolic tangent of a value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>hypot(x, y)</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Returns sqrt(<emphasis>x2</emphasis> + <emphasis>y2</emphasis>) without intermediate overflow
or underflow.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<section id="modules-advanced-scripting">
<title>Text scoring in scripts<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></title>
<simpara>Text features, such as term or document frequency for a specific term can be accessed in scripts (see <link linkend="modules-scripting">scripting documentation</link> ) with the <literal>_index</literal> variable. This can be useful if, for example, you want to implement your own scoring model using for example a script inside a <link linkend="query-dsl-function-score-query">function score query</link>.
Statistics over the document collection are computed <emphasis role="strong">per shard</emphasis>, not per
index.</simpara>
<bridgehead id="_nomenclature" renderas="sect3">Nomenclature:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>df</literal>
</simpara>
</entry>
<entry>
<simpara>
    document frequency. The number of documents a term appears in. Computed
    per field.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>tf</literal>
</simpara>
</entry>
<entry>
<simpara>
    term frequency. The number times a term appears in a field in one specific
    document.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ttf</literal>
</simpara>
</entry>
<entry>
<simpara>
    total term frequency. The number of times this term appears in all
    documents, that is, the sum of <literal>tf</literal> over all documents.  Computed per
    field.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara><literal>df</literal> and <literal>ttf</literal> are computed per shard and therefore these numbers can vary
depending on the shard the current document resides in.</simpara>
<bridgehead id="_shard_statistics" renderas="sect3">Shard statistics:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
<literal>_index.numDocs()</literal>
</term>
<listitem>
<simpara>
    Number of documents in shard.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index.maxDoc()</literal>
</term>
<listitem>
<simpara>
    Maximal document number in shard.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index.numDeletedDocs()</literal>
</term>
<listitem>
<simpara>
    Number of deleted documents in shard.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_field_statistics_3" renderas="sect3">Field statistics:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Field statistics can be accessed with a subscript operator like this:
<literal>_index['FIELD']</literal>.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>_index['FIELD'].docCount()</literal>
</term>
<listitem>
<simpara>
    Number of documents containing the field <literal>FIELD</literal>. Does not take deleted documents into account.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index['FIELD'].sumttf()</literal>
</term>
<listitem>
<simpara>
    Sum of <literal>ttf</literal> over all terms that appear in field <literal>FIELD</literal> in all documents.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index['FIELD'].sumdf()</literal>
</term>
<listitem>
<simpara>
    The sum of <literal>df</literal> s over all terms that appear in field <literal>FIELD</literal> in all
    documents.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Field statistics are computed per shard and therefore these numbers can vary
depending on the shard the current document resides in.
The number of terms in a field cannot be accessed using the <literal>_index</literal> variable. See <xref linkend="token-count"/> for how to do that.</simpara>
<bridgehead id="_term_statistics_2" renderas="sect3">Term statistics:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>Term statistics for a field can be accessed with a subscript operator like
this: <literal>_index['FIELD']['TERM']</literal>. This will never return null, even if term or field does not exist.
If you do not need the term frequency, call <literal>_index['FIELD'].get('TERM', 0)</literal>
to avoid unnecessary initialization of the frequencies. The flag will have only
affect is your set the <link linkend="index-options"><literal>index_options</literal></link> to <literal>docs</literal>.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>_index['FIELD']['TERM'].df()</literal>
</term>
<listitem>
<simpara>
    <literal>df</literal> of term <literal>TERM</literal> in field <literal>FIELD</literal>. Will be returned, even if the term
    is not present in the current document.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index['FIELD']['TERM'].ttf()</literal>
</term>
<listitem>
<simpara>
    The sum of term frequencies of term <literal>TERM</literal> in field <literal>FIELD</literal> over all
    documents. Will be returned, even if the term is not present in the
    current document.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>_index['FIELD']['TERM'].tf()</literal>
</term>
<listitem>
<simpara>
    <literal>tf</literal> of term <literal>TERM</literal> in field <literal>FIELD</literal>. Will be 0 if the term is not present
    in the current document.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_term_positions_offsets_and_payloads" renderas="sect3">Term positions, offsets and payloads:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>If you need information on the positions of terms in a field, call
<literal>_index['FIELD'].get('TERM', flag)</literal> where flag can be</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_POSITIONS</literal>
</simpara>
</entry>
<entry>
<simpara>
if you need the positions of the term
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_OFFSETS</literal>
</simpara>
</entry>
<entry>
<simpara>
if you need the offsets of the term
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_PAYLOADS</literal>
</simpara>
</entry>
<entry>
<simpara>
if you need the payloads of the term
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_CACHE</literal>
</simpara>
</entry>
<entry>
<simpara>
if you need to iterate over all positions several times
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>The iterator uses the underlying lucene classes to iterate over positions. For efficiency reasons, you can only iterate over positions once. If you need to iterate over the positions several times, set the <literal>_CACHE</literal> flag.</simpara>
<simpara>You can combine the operators with a <literal>|</literal> if you need more than one info. For
example, the following will return an object holding the positions and payloads,
as well as all statistics:</simpara>
<literallayout class="monospaced">`_index['FIELD'].get('TERM', _POSITIONS | _PAYLOADS)`</literallayout>
<simpara>Positions can be accessed with an iterator that returns an object
(<literal>POS_OBJECT</literal>) holding position, offsets and payload for each term position.</simpara>
<variablelist>
<varlistentry>
<term>
<literal>POS_OBJECT.position</literal>
</term>
<listitem>
<simpara>
    The position of the term.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.startOffset</literal>
</term>
<listitem>
<simpara>
    The start offset of the term.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.endOffset</literal>
</term>
<listitem>
<simpara>
    The end offset of the term.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.payload</literal>
</term>
<listitem>
<simpara>
    The payload of the term.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.payloadAsInt(missingValue)</literal>
</term>
<listitem>
<simpara>
    The payload of the term converted to integer. If the current position has
    no payload, the <literal>missingValue</literal> will be returned. Call this only if you
    know that your payloads are integers.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.payloadAsFloat(missingValue)</literal>
</term>
<listitem>
<simpara>
    The payload of the term converted to float. If the current position has no
    payload, the <literal>missingValue</literal> will be returned. Call this only if you know
    that your payloads are floats.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>POS_OBJECT.payloadAsString()</literal>
</term>
<listitem>
<simpara>
    The payload of the term converted to string. If the current position has
    no payload, <literal>null</literal> will be returned. Call this only if you know that your
    payloads are strings.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Example: sums up all payloads for the term <literal>foo</literal>.</simpara>
<programlisting language="groovy" linenumbering="unnumbered">termInfo = _index['my_field'].get('foo',_PAYLOADS);
score = 0;
for (pos in termInfo) {
    score = score + pos.payloadAsInt(0);
}
return score;</programlisting>
<bridgehead id="_term_vectors" renderas="sect3">Term vectors:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/advanced-scripting.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>_index</literal> variable can only be used to gather statistics for single terms. If you want to use information on all terms in a field, you must store the term vectors (see <xref linkend="term-vector"/>). To access them, call
<literal>_index.termVectors()</literal> to get a
<ulink url="https://lucene.apache.org/core/4_0_0/core/org/apache/lucene/index/Fields.html">Fields</ulink>
instance. This object can then be used as described in <ulink url="https://lucene.apache.org/core/4_0_0/core/org/apache/lucene/index/Fields.html">lucene doc</ulink> to iterate over fields and then for each field iterate over each term in the field.
The method will return null if the term vectors were not stored.</simpara>
</section>
<section id="modules-scripting-security">
<title>Scripting and the Java Security Manager<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></title>
<simpara>Elasticsearch runs with the <ulink url="https://docs.oracle.com/javase/tutorial/essential/environment/security.html">Java Security Manager</ulink>
enabled by default.  The security policy in Elasticsearch locks down the
permissions granted to each class to the bare minimum required to operate.
The benefit of doing this is that it severely limits the attack vectors
available to a hacker.</simpara>
<simpara>Restricting permissions is particularly important with scripting languages
like Groovy and Javascript which are designed to do anything that can be done
in Java itself, including writing to the file system, opening sockets to
remote servers, etc.</simpara>
<bridgehead id="_script_classloader_whitelist" renderas="sect2">Script Classloader Whitelist<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></bridgehead>
<simpara>Scripting languages are only allowed to load classes which appear in a
hardcoded whitelist that can be found in
<ulink url="https://github.com/elastic/elasticsearch/blob/2.4/core/src/main/java/org/elasticsearch/script/ClassPermission.java"><literal>org.elasticsearch.script.ClassPermission</literal></ulink>.</simpara>
<simpara>In a script, attempting to load a class that does not appear in the whitelist
<emphasis>may</emphasis> result in a <literal>ClassNotFoundException</literal>, for instance this script:</simpara>
<programlisting language="json" linenumbering="unnumbered">GET _search
{
  "script_fields": {
    "the_hour": {
      "script": "use(java.math.BigInteger); new BigInteger(1)"
    }
  }
}</programlisting>
<simpara>will return the following exception:</simpara>
<programlisting language="json" linenumbering="unnumbered">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(java.math.BigInteger); new BigInteger(1)] using lang [groovy]",
    "caused_by": {
      "type": "no_class_def_found_error",
      "reason": "java/math/BigInteger",
      "caused_by": {
        "type": "class_not_found_exception",
        "reason": "java.math.BigInteger"
      }
    }
  }
}</programlisting>
<simpara>However, classloader issues may also result in more difficult to interpret
exceptions.  For instance, this script:</simpara>
<programlisting language="groovy" linenumbering="unnumbered">use(groovy.time.TimeCategory); new Date(123456789).format('HH')</programlisting>
<simpara>Returns the following exception:</simpara>
<programlisting language="json" linenumbering="unnumbered">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(groovy.time.TimeCategory); new Date(123456789).format('HH')] using lang [groovy]",
    "caused_by": {
      "type": "missing_property_exception",
      "reason": "No such property: groovy for class: 8d45f5c1a07a1ab5dda953234863e283a7586240"
    }
  }
}</programlisting>
<bridgehead id="_dealing_with_java_security_manager_issues" renderas="sect1">Dealing with Java Security Manager issues<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></bridgehead>
<simpara>If you encounter issues with the Java Security Manager, you have three options
for resolving these issues:</simpara>
<bridgehead id="_fix_the_security_problem" renderas="sect2">Fix the security problem<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></bridgehead>
<simpara>The safest and most secure long term solution is to change the code causing
the security issue.  We recognise that this may take time to do correctly and
so we provide the following two alternatives.</simpara>
<bridgehead id="_disable_the_java_security_manager" renderas="sect2">Disable the Java Security Manager<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></bridgehead>
<warning revisionflag="deleted" revision="2.2.0"><title>Deprecated in 2.2.0.</title><simpara>The ability to disable the Java Security Manager will be removed in a future version.</simpara></warning>
<simpara>You can disable the Java Security Manager entirely with the
<literal>security.manager.enabled</literal> command line flag:</simpara>
<programlisting language="sh" linenumbering="unnumbered">./bin/elasticsearch --security.manager.enabled false</programlisting>
<warning><simpara>This disables the Security Manager entirely and makes Elasticsearch
much more vulnerable to attacks! It is an option that should only be used in
the most urgent of situations and for the shortest amount of time possible.
Optional security is not secure at all because it <emphasis role="strong">will</emphasis> be disabled and
leave the system vulnerable.  This option will be removed in a future version.</simpara></warning>
<bridgehead id="_customising_the_classloader_whitelist" renderas="sect2">Customising the classloader whitelist<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/scripting/security.asciidoc">Edit me</ulink></bridgehead>
<simpara>The classloader whitelist can be customised by tweaking the local Java
Security Policy either:</simpara>
<itemizedlist>
<listitem>
<simpara>
system wide: <literal>$JAVA_HOME/lib/security/java.policy</literal>,
</simpara>
</listitem>
<listitem>
<simpara>
for just the <literal>elasticsearch</literal> user: <literal>/home/elasticsearch/.java.policy</literal>, or
</simpara>
</listitem>
<listitem>
<simpara>
from a file specified in the <literal>JAVA_OPTS</literal> environment variable with <literal>-Djava.security.policy=someURL</literal>:
</simpara>
<programlisting language="js" linenumbering="unnumbered">export JAVA_OPTS="${JAVA_OPTS} -Djava.security.policy=file:///path/to/my.policy`
./bin/elasticsearch</programlisting>
</listitem>
</itemizedlist>
<simpara>Permissions may be granted at the class, package, or global level.  For instance:</simpara>
<programlisting language="js" linenumbering="unnumbered">grant {
    permission org.elasticsearch.script.ClassPermission "java.util.Base64"; // allow class
    permission org.elasticsearch.script.ClassPermission "java.util.*"; // allow package
    permission org.elasticsearch.script.ClassPermission "*"; // allow all (disables filtering basically)
};</programlisting>
<simpara>Here is an example of how to enable the <literal>groovy.time.TimeCategory</literal> class:</simpara>
<programlisting language="js" linenumbering="unnumbered">grant {
    permission org.elasticsearch.script.ClassPermission "java.lang.Class";
    permission org.elasticsearch.script.ClassPermission "groovy.time.TimeCategory";
};</programlisting>
<tip>
<simpara>Before adding classes to the whitelist, consider the security impact that it
will have on Elasticsearch. Do you really need an extra class or can your code
be rewritten in a more secure way?</simpara>
<simpara>It is quite possible that we have not whitelisted a generically useful and
safe class. If you have a class that you think should be whitelisted by
default, please open an issue on GitHub and we will consider the impact of
doing so.</simpara>
</tip>
<simpara>See <ulink url="http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html</ulink> for more information.</simpara>
</section>
</chapter>
<chapter id="modules-snapshots">
<title>Snapshot And Restore<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></title>
<simpara>The snapshot and restore module allows to create snapshots of individual
indices or an entire cluster into a remote repository like shared file system,
S3, or HDFS. These snapshots are great for backups because they can be restored
relatively quickly but they are not archival because they can only be restored
to versions of Elasticsearch that can read the index. That means that:</simpara>
<itemizedlist>
<listitem>
<simpara>
A snapshot of an index created in 2.x can be restored to 5.x.
</simpara>
</listitem>
<listitem>
<simpara>
A snapshot of an index created in 1.x can be restored to 2.x.
</simpara>
</listitem>
<listitem>
<simpara>
A snapshot of an index created in 1.x can <emphasis role="strong">not</emphasis> be restored to 5.x.
</simpara>
</listitem>
</itemizedlist>
<simpara>To restore a snapshot of an index created in 1.x to 5.x you can restore it to
a 2.x cluster and use reindex-from-remote (only available in 5.0+) to rebuild
the index in a 5.x cluster. This is as time consuming as restoring from
archival copies of the original data.</simpara>
<bridgehead id="_repositories" renderas="sect2">Repositories<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>Before any snapshot or restore operation can be performed, a snapshot repository should be registered in
Elasticsearch. The repository settings are repository-type specific. See below for details.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_snapshot/my_backup
{
  "type": "fs",
  "settings": {
        ... repository specific settings ...
  }
}</programlisting>
<simpara>Once a repository is registered, its information can be obtained using the following command:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_snapshot/my_backup</programlisting>
<remark> AUTOSENSE</remark>
<simpara>which returns:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "my_backup": {
    "type": "fs",
    "settings": {
      "compress": true,
      "location": "/mount/backups/my_backup"
    }
  }
}</programlisting>
<simpara>Information about multiple repositories can be fetched in one go by using a comma-delimited list of repository names.
Star wildcards are supported as well. For example, information about repositories that start with <literal>repo</literal> or that contain <literal>backup</literal>
can be obtained using the following command:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_snapshot/repo*,*backup*</programlisting>
<simpara>If a repository name is not specified, or <literal>_all</literal> is used as repository name Elasticsearch will return information about
all repositories currently registered in the cluster:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_snapshot</programlisting>
<simpara>or</simpara>
<programlisting language="js" linenumbering="unnumbered">GET /_snapshot/_all</programlisting>
<bridgehead id="_shared_file_system_repository" renderas="sect4">Shared File System Repository<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>The shared file system repository (<literal>"type": "fs"</literal>) uses the shared file system to store snapshots. In order to register
the shared file system repository it is necessary to mount the same shared filesystem to the same location on all
master and data nodes. This location (or one of its parent directories) must be registered in the <literal>path.repo</literal>
setting on all master and data nodes.</simpara>
<simpara>Assuming that the shared filesystem is mounted to <literal>/mount/backups/my_backup</literal>, the following setting should be added to
<literal>elasticsearch.yml</literal> file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.repo: ["/mount/backups", "/mount/longterm_backups"]</programlisting>
<simpara>The <literal>path.repo</literal> setting supports Microsoft Windows UNC paths as long as at least server name and share are specified as
a prefix and back slashes are properly escaped:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">path.repo: ["\\\\MY_SERVER\\Snapshots"]</programlisting>
<simpara>After all nodes are restarted, the following command can be used to register the shared file system repository with
the name <literal>my_backup</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/_snapshot/my_backup' -d '{
    "type": "fs",
    "settings": {
        "location": "/mount/backups/my_backup",
        "compress": true
    }
}'</programlisting>
<simpara>If the repository location is specified as a relative path this path will be resolved against the first path specified
in <literal>path.repo</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">$ curl -XPUT 'http://localhost:9200/_snapshot/my_backup' -d '{
    "type": "fs",
    "settings": {
        "location": "my_backup",
        "compress": true
    }
}'</programlisting>
<simpara>The following settings are supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>location</literal>
</simpara>
</entry>
<entry>
<simpara>
Location of the snapshots. Mandatory.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>compress</literal>
</simpara>
</entry>
<entry>
<simpara>
Turns on compression of the snapshot files. Compression is applied only to metadata files (index mapping and settings). Data files are not compressed. Defaults to <literal>true</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>chunk_size</literal>
</simpara>
</entry>
<entry>
<simpara>
Big files can be broken down into chunks during snapshotting if needed. The chunk size can be specified in bytes or by
 using size value notation, i.e. 1g, 10m, 5k. Defaults to <literal>null</literal> (unlimited chunk size).
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_restore_bytes_per_sec</literal>
</simpara>
</entry>
<entry>
<simpara>
Throttles per node restore rate. Defaults to <literal>40mb</literal> per second.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>max_snapshot_bytes_per_sec</literal>
</simpara>
</entry>
<entry>
<simpara>
Throttles per node snapshot rate. Defaults to <literal>40mb</literal> per second.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>readonly</literal>
</simpara>
</entry>
<entry>
<simpara>
Makes repository read-only. Defaults to <literal>false</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<bridgehead id="_read_only_url_repository" renderas="sect4">Read-only URL Repository<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>The URL repository (<literal>"type": "url"</literal>) can be used as an alternative read-only way to access data created by the shared file
system repository. The URL specified in the <literal>url</literal> parameter should point to the root of the shared filesystem repository.
The following settings are supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>url</literal>
</simpara>
</entry>
<entry>
<simpara>
Location of the snapshots. Mandatory.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>URL Repository supports the following protocols: "http", "https", "ftp", "file" and "jar". URL repositories with <literal>http:</literal>,
<literal>https:</literal>, and <literal>ftp:</literal> URLs has to be whitelisted by specifying allowed URLs in the <literal>repositories.url.allowed_urls</literal> setting.
This setting supports wildcards in the place of host, path, query, and fragment. For example:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">repositories.url.allowed_urls: ["http://www.example.org/root/*", "https://*.mydomain.com/*?*#*"]</programlisting>
<simpara>URL repositories with <literal>file:</literal> URLs can only point to locations registered in the <literal>path.repo</literal> setting similar to
shared file system repository.</simpara>
<bridgehead id="_repository_plugins" renderas="sect4">Repository plugins<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>Other repository backends are available in these official plugins:</simpara>
<itemizedlist>
<listitem>
<simpara>
<ulink url="https://github.com/elasticsearch/elasticsearch-cloud-aws#s3-repository">AWS Cloud Plugin</ulink> for S3 repositories
</simpara>
</listitem>
<listitem>
<simpara>
<ulink url="https://github.com/elasticsearch/elasticsearch-hadoop/tree/master/repository-hdfs">HDFS Plugin</ulink> for Hadoop environments
</simpara>
</listitem>
<listitem>
<simpara>
<ulink url="https://github.com/elasticsearch/elasticsearch-cloud-azure#azure-repository">Azure Cloud Plugin</ulink> for Azure storage repositories
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="_repository_verification" renderas="sect4">Repository Verification<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>When a repository is registered, it&#8217;s immediately verified on all master and data nodes to make sure that it is functional
on all nodes currently present in the cluster. The <literal>verify</literal> parameter can be used to explicitly disable the repository
verification when registering or updating a repository:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_snapshot/s3_repository?verify=false
{
  "type": "s3",
  "settings": {
    "bucket": "my_s3_bucket",
    "region": "eu-west-1"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The verification process can also be executed manually by running the following command:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_snapshot/s3_repository/_verify</programlisting>
<remark> AUTOSENSE</remark>
<simpara>It returns a list of nodes where repository was successfully verified or an error message if verification process failed.</simpara>
<bridgehead id="_snapshot" renderas="sect2">Snapshot<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>A repository can contain multiple snapshots of the same cluster. Snapshots are identified by unique names within the
cluster. A snapshot with the name <literal>snapshot_1</literal> in the repository <literal>my_backup</literal> can be created by executing the following
command:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The <literal>wait_for_completion</literal> parameter specifies whether or not the request should return immediately after snapshot
initialization (default) or wait for snapshot completion. During snapshot initialization, information about all
previous snapshots is loaded into the memory, which means that in large repositories it may take several seconds (or
even minutes) for this command to return even if the <literal>wait_for_completion</literal> parameter is set to <literal>false</literal>.</simpara>
<simpara>By default a snapshot of all open and started indices in the cluster is created. This behavior can be changed by
specifying the list of indices in the body of the snapshot request.</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_snapshot/my_backup/snapshot_1
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": false
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The list of indices that should be included into the snapshot can be specified using the <literal>indices</literal> parameter that
supports <link linkend="search-multi-index-type">multi index syntax</link>. The snapshot request also supports the
<literal>ignore_unavailable</literal> option. Setting it to <literal>true</literal> will cause indices that do not exist to be ignored during snapshot
creation. By default, when <literal>ignore_unavailable</literal> option is not set and an index is missing the snapshot request will fail.
By setting <literal>include_global_state</literal> to false it&#8217;s possible to prevent the cluster global state to be stored as part of
the snapshot. By default, the entire snapshot will fail if one or more indices participating in the snapshot don&#8217;t have
all primary shards available. This behaviour can be changed by setting <literal>partial</literal> to <literal>true</literal>.</simpara>
<simpara>The index snapshot process is incremental. In the process of making the index snapshot Elasticsearch analyses
the list of the index files that are already stored in the repository and copies only files that were created or
changed since the last snapshot. That allows multiple snapshots to be preserved in the repository in a compact form.
Snapshotting process is executed in non-blocking fashion. All indexing and searching operation can continue to be
executed against the index that is being snapshotted. However, a snapshot represents the point-in-time view of the index
at the moment when snapshot was created, so no records that were added to the index after the snapshot process was started
will be present in the snapshot. The snapshot process starts immediately for the primary shards that has been started
and are not relocating at the moment. Before version 1.2.0, the snapshot operation fails if the cluster has any relocating or
initializing primaries of indices participating in the snapshot. Starting with version 1.2.0, Elasticsearch waits for
relocation or initialization of shards to complete before snapshotting them.</simpara>
<simpara>Besides creating a copy of each index the snapshot process can also store global cluster metadata, which includes persistent
cluster settings and templates. The transient settings and registered snapshot repositories are not stored as part of
the snapshot.</simpara>
<simpara>Only one snapshot process can be executed in the cluster at any time. While snapshot of a particular shard is being
created this shard cannot be moved to another node, which can interfere with rebalancing process and allocation
filtering. Elasticsearch will only be able to move a shard to another node (according to the current allocation
filtering settings and rebalancing algorithm) once the snapshot is finished.</simpara>
<simpara>Once a snapshot is created information about this snapshot can be obtained using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Similar as for repositories, information about multiple snapshots can be queried in one go, supporting wildcards as well:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_*,some_other_snapshot</programlisting>
<remark> AUTOSENSE</remark>
<simpara>All snapshots currently stored in the repository can be listed using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/_all</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The command fails if some of the snapshots are unavailable. The boolean parameter <literal>ignore_unvailable</literal> can be used to
return all snapshots that are currently available.</simpara>
<simpara>A currently running snapshot can be retrieved using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">$ curl -XGET "localhost:9200/_snapshot/my_backup/_current"</programlisting>
<simpara>A snapshot can be deleted from the repository using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">DELETE /_snapshot/my_backup/snapshot_1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>When a snapshot is deleted from a repository, Elasticsearch deletes all files that are associated with the deleted
snapshot and not used by any other snapshots. If the deleted snapshot operation is executed while the snapshot is being
created the snapshotting process will be aborted and all files created as part of the snapshotting process will be
cleaned. Therefore, the delete snapshot operation can be used to cancel long running snapshot operations that were
started by mistake.</simpara>
<simpara>A repository can be deleted using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">DELETE /_snapshot/my_backup</programlisting>
<remark> AUTOSENSE</remark>
<simpara>When a repository is deleted, Elasticsearch only removes the reference to the location where the repository is storing
the snapshots. The snapshots themselves are left untouched and in place.</simpara>
<bridgehead id="_restore" renderas="sect2">Restore<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>A snapshot can be restored using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">POST /_snapshot/my_backup/snapshot_1/_restore</programlisting>
<remark> AUTOSENSE</remark>
<simpara>By default, all indices in the snapshot as well as cluster state are restored. It&#8217;s possible to select indices that
should be restored as well as prevent global cluster state from being restored by using <literal>indices</literal> and
<literal>include_global_state</literal> options in the restore request body. The list of indices supports
<link linkend="search-multi-index-type">multi index syntax</link>. The <literal>rename_pattern</literal> and <literal>rename_replacement</literal> options can be also used to
rename indices on restore using regular expression that supports referencing the original text as explained
<ulink url="http://docs.oracle.com/javase/6/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String)">here</ulink>.
Set <literal>include_aliases</literal> to <literal>false</literal> to prevent aliases from being restored together with associated indices</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_snapshot/my_backup/snapshot_1/_restore
{
  "indices": "index_1,index_2",
  "ignore_unavailable": true,
  "include_global_state": false,
  "rename_pattern": "index_(.+)",
  "rename_replacement": "restored_index_$1"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The restore operation can be performed on a functioning cluster. However, an existing index can be only restored if it&#8217;s
<link linkend="indices-open-close">closed</link> and has the same number of shards as the index in the snapshot.
The restore operation automatically opens restored indices if they were closed and creates new indices if they
didn&#8217;t exist in the cluster. If cluster state is restored, the restored templates that don&#8217;t currently exist in the
cluster are added and existing templates with the same name are replaced by the restored templates. The restored
persistent settings are added to the existing persistent settings.</simpara>
<bridgehead id="_partial_restore" renderas="sect3">Partial restore<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, the entire restore operation will fail if one or more indices participating in the operation don&#8217;t have
snapshots of all shards available. It can occur if some shards failed to snapshot for example. It is still possible to
restore such indices by setting <literal>partial</literal> to <literal>true</literal>. Please note, that only successfully snapshotted shards will be
restored in this case and all missing shards will be recreated empty.</simpara>
<bridgehead id="_changing_index_settings_during_restore" renderas="sect3">Changing index settings during restore<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most of index settings can be overridden during the restore process. For example, the following command will restore
the index <literal>index_1</literal> without creating any replicas while switching back to default refresh interval:</simpara>
<programlisting language="js" linenumbering="unnumbered">POST /_snapshot/my_backup/snapshot_1/_restore
{
  "indices": "index_1",
  "index_settings": {
    "index.number_of_replicas": 0
  },
  "ignore_index_settings": [
    "index.refresh_interval"
  ]
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Please note, that some settings such as <literal>index.number_of_shards</literal> cannot be changed during restore operation.</simpara>
<bridgehead id="_restoring_to_a_different_cluster" renderas="sect3">Restoring to a different cluster<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>The information stored in a snapshot is not tied to a particular cluster or a cluster name. Therefore it&#8217;s possible to
restore a snapshot made from one cluster into another cluster. All that is required is registering the repository
containing the snapshot in the new cluster and starting the restore process. The new cluster doesn&#8217;t have to have the
same size or topology.  However, the version of the new cluster should be the same or newer than the cluster that was
used to create the snapshot.</simpara>
<simpara>If the new cluster has a smaller size additional considerations should be made. First of all it&#8217;s necessary to make sure
that new cluster have enough capacity to store all indices in the snapshot. It&#8217;s possible to change indices settings
during restore to reduce the number of replicas, which can help with restoring snapshots into smaller cluster. It&#8217;s also
possible to select only subset of the indices using the <literal>indices</literal> parameter.  Prior to version 1.5.0 elasticsearch
didn&#8217;t check restored persistent settings making it possible to accidentally restore an incompatible
<literal>discovery.zen.minimum_master_nodes</literal> setting, and as a result disable a smaller cluster until the required number of
master eligible nodes is added.  Starting with version 1.5.0 incompatible settings are ignored.</simpara>
<simpara>If indices in the original cluster were assigned to particular nodes using
<link linkend="shard-allocation-filtering">shard allocation filtering</link>, the same rules will be enforced in the new cluster. Therefore
if the new cluster doesn&#8217;t contain nodes with appropriate attributes that a restored index can be allocated on, such
index will not be successfully restored unless these index allocation settings are changed during restore operation.</simpara>
<bridgehead id="_snapshot_status" renderas="sect2">Snapshot status<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>A list of currently running snapshots with their detailed status information can be obtained using the following command:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/_status</programlisting>
<remark> AUTOSENSE</remark>
<simpara>In this format, the command will return information about all currently running snapshots. By specifying a repository name, it&#8217;s possible
to limit the results to a particular repository:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/_status</programlisting>
<remark> AUTOSENSE</remark>
<simpara>If both repository name and snapshot id are specified, this command will return detailed status information for the given snapshot even
if it&#8217;s not currently running:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_1/_status</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Multiple ids are also supported:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_1,snapshot_2/_status</programlisting>
<remark> AUTOSENSE</remark>
<bridgehead id="_monitoring_snapshot_restore_progress" renderas="sect2">Monitoring snapshot/restore progress<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>There are several ways to monitor the progress of the snapshot and restores processes while they are running. Both
operations support <literal>wait_for_completion</literal> parameter that would block client until the operation is completed. This is
the simplest method that can be used to get notified about operation completion.</simpara>
<simpara>The snapshot operation can be also monitored by periodic calls to the snapshot info:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,
executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait
for available resources before returning the result. On very large shards the wait time can be significant.</simpara>
<simpara>To get more immediate and complete information about snapshots the snapshot status command can be used instead:</simpara>
<programlisting language="sh" linenumbering="unnumbered">GET /_snapshot/my_backup/snapshot_1/_status</programlisting>
<remark> AUTOSENSE</remark>
<simpara>While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns
complete breakdown of the current state for each shard participating in the snapshot.</simpara>
<simpara>The restore process piggybacks on the standard recovery mechanism of the Elasticsearch. As a result, standard recovery
monitoring services can be used to monitor the state of restore. When restore operation is executed the cluster
typically goes into <literal>red</literal> state. It happens because the restore operation starts with "recovering" primary shards of the
restored indices. During this operation the primary shards become unavailable which manifests itself in the <literal>red</literal> cluster
state. Once recovery of primary shards is completed Elasticsearch is switching to standard replication process that
creates the required number of replicas at this moment cluster switches to the <literal>yellow</literal> state. Once all required replicas
are created, the cluster switches to the <literal>green</literal> states.</simpara>
<simpara>The cluster health operation provides only a high level status of the restore process. It’s possible to get more
detailed insight into the current state of the recovery process by using <link linkend="indices-recovery">indices recovery</link> and
<link linkend="cat-recovery">cat recovery</link> APIs.</simpara>
<bridgehead id="_stopping_currently_running_snapshot_and_restore_operations" renderas="sect2">Stopping currently running snapshot and restore operations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>The snapshot and restore framework allows running only one snapshot or one restore operation at a time. If a currently
running snapshot was executed by mistake, or takes unusually long, it can be terminated using the snapshot delete operation.
The snapshot delete operation checks if the deleted snapshot is currently running and if it does, the delete operation stops
that snapshot before deleting the snapshot data from the repository.</simpara>
<programlisting language="sh" linenumbering="unnumbered">DELETE /_snapshot/my_backup/snapshot_1</programlisting>
<remark> AUTOSENSE</remark>
<simpara>The restore operation uses the standard shard recovery mechanism. Therefore, any currently running restore operation can
be canceled by deleting indices that are being restored. Please note that data for all deleted indices will be removed
from the cluster as a result of this operation.</simpara>
<bridgehead id="_effect_of_cluster_blocks_on_snapshot_and_restore_operations" renderas="sect2">Effect of cluster blocks on snapshot and restore operations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/snapshots.asciidoc">Edit me</ulink></bridgehead>
<simpara>Many snapshot and restore operations are affected by cluster and index blocks. For example, registering and unregistering
repositories require write global metadata access. The snapshot operation requires that all indices and their metadata as
well as the global metadata were readable. The restore operation requires the global metadata to be writable, however
the index level blocks are ignored during restore because indices are essentially recreated during restore.
Please note that a repository content is not part of the cluster and therefore cluster blocks don&#8217;t affect internal
repository operations such as listing or deleting snapshots from an already registered repository.</simpara>
</chapter>
<chapter id="modules-threadpool">
<title>Thread Pool<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></title>
<simpara>A node holds several thread pools in order to improve how threads memory consumption
are managed within a node. Many of these pools also have queues associated with them,
which allow pending requests to be held instead
of discarded.</simpara>
<simpara>There are several thread pools, but the important ones include:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>generic</literal>
</term>
<listitem>
<simpara>
    For generic operations (e.g., background node discovery).
    Thread pool type is <literal>cached</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index</literal>
</term>
<listitem>
<simpara>
    For index/delete operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal># of available processors</literal>,
    queue_size of <literal>200</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>search</literal>
</term>
<listitem>
<simpara>
    For count/search operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal>int((# of available_processors * 3) / 2) + 1</literal>,
    queue_size of <literal>1000</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>suggest</literal>
</term>
<listitem>
<simpara>
    For suggest operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal># of available processors</literal>,
    queue_size of <literal>1000</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>get</literal>
</term>
<listitem>
<simpara>
    For get operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal># of available processors</literal>,
    queue_size of <literal>1000</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>bulk</literal>
</term>
<listitem>
<simpara>
    For bulk operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal># of available processors</literal>,
    queue_size of <literal>50</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>percolate</literal>
</term>
<listitem>
<simpara>
    For percolate operations. Thread pool type is <literal>fixed</literal>
    with a size of <literal># of available processors</literal>,
    queue_size of <literal>1000</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>snapshot</literal>
</term>
<listitem>
<simpara>
    For snapshot/restore operations. Thread pool type is <literal>scaling</literal> with a
    keep-alive of <literal>5m</literal> and a size of <literal>min(5, (# of available processors)/2)</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>warmer</literal>
</term>
<listitem>
<simpara>
    For segment warm-up operations. Thread pool type is <literal>scaling</literal> with a
    keep-alive of <literal>5m</literal> and a size of <literal>min(5, (# of available processors)/2)</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>refresh</literal>
</term>
<listitem>
<simpara>
    For refresh operations. Thread pool type is <literal>scaling</literal> with a
    keep-alive of <literal>5m</literal> and a size of <literal>min(10, (# of available processors)/2)</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>listener</literal>
</term>
<listitem>
<simpara>
    Mainly for java client executing of action when listener threaded is set to true.
    Thread pool type is <literal>scaling</literal> with a default size of <literal>min(10, (# of available processors)/2)</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Changing a specific thread pool can be done by setting its type-specific parameters; for example, changing the <literal>index</literal>
thread pool to have more threads:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">threadpool:
    index:
        size: 30</programlisting>
<note><simpara>you can update thread pool settings dynamically using <xref linkend="cluster-update-settings"/>.</simpara></note>
<bridgehead id="types" renderas="sect2">Thread pool types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following are the types of thread pools and their respective parameters:</simpara>
<bridgehead id="_literal_cached_literal" renderas="sect3"><literal>cached</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>cached</literal> thread pool is an unbounded thread pool that will spawn a
thread if there are pending requests. This thread pool is used to
prevent requests submitted to this pool from blocking or being
rejected. Unused threads in this thread pool will be terminated after
a keep alive expires (defaults to five minutes). The <literal>cached</literal> thread
pool is reserved for the <link linkend="modules-threadpool"><literal>generic</literal></link> thread pool.</simpara>
<simpara>The <literal>keep_alive</literal> parameter determines how long a thread should be kept
around in the thread pool without doing any work.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">threadpool:
    generic:
        keep_alive: 2m</programlisting>
<bridgehead id="_literal_fixed_literal" renderas="sect3"><literal>fixed</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>fixed</literal> thread pool holds a fixed size of threads to handle the
requests with a queue (optionally bounded) for pending requests that
have no threads to service them.</simpara>
<simpara>The <literal>size</literal> parameter controls the number of threads, and defaults to the
number of cores times 5.</simpara>
<simpara>The <literal>queue_size</literal> allows to control the size of the queue of pending
requests that have no threads to execute them. By default, it is set to
<literal>-1</literal> which means its unbounded. When a request comes in and the queue is
full, it will abort the request.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">threadpool:
    index:
        size: 30
        queue_size: 1000</programlisting>
<bridgehead id="_literal_scaling_literal" renderas="sect3"><literal>scaling</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></bridgehead>
<simpara>The <literal>scaling</literal> thread pool holds a dynamic number of threads. This number is
proportional to the workload and varies between 1 and the value of the
<literal>size</literal> parameter.</simpara>
<simpara>The <literal>keep_alive</literal> parameter determines how long a thread should be kept
around in the thread pool without it doing any work.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">threadpool:
    warmer:
        size: 8
        keep_alive: 2m</programlisting>
<bridgehead id="processors" renderas="sect2">Processors setting<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/threadpool.asciidoc">Edit me</ulink></bridgehead>
<simpara>The number of processors is automatically detected, and the thread pool
settings are automatically set based on it. In some cases it can be
useful to override the number of detected processors. This can be done
by explicitly setting the <literal>processors</literal> setting.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">processors: 2</programlisting>
<simpara>There are a few use-cases for explicitly overriding the <literal>processors</literal>
setting:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
If you are running multiple instances of Elasticsearch on the same
host but want Elasticsearch to size its thread pools as if it only has a
fraction of the CPU, you should override the <literal>processors</literal> setting to the
desired fraction (e.g., if you&#8217;re running two instances of Elasticsearch
on a 16-core machine, set <literal>processors</literal> to 8). Note that this is an
expert-level use-case and there&#8217;s a lot more involved than just setting
the <literal>processors</literal> setting as there are other considerations like changing
the number of garbage collector threads, pinning processes to cores,
etc.
</simpara>
</listitem>
<listitem>
<simpara>
The number of processors is by default bounded to 32. This means that
on systems that have more than 32 processors, Elasticsearch will size
its thread pools as if there are only 32 processors present. This
limitation was added to avoid creating too many threads on systems that
have not properly adjusted the <literal>ulimit</literal> for max number of processes. In
cases where you&#8217;ve adjusted the <literal>ulimit</literal> appropriately, you can override
this bound by explicitly setting the <literal>processors</literal> setting.
</simpara>
</listitem>
<listitem>
<simpara>
Sometimes the number of processors is wrongly detected and in such
cases explicitly setting the <literal>processors</literal> setting will workaround such
issues.
</simpara>
</listitem>
</orderedlist>
<simpara>In order to check the number of processors detected, use the nodes info
API with the <literal>os</literal> flag.</simpara>
</chapter>
<chapter id="modules-transport">
<title>Transport<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/transport.asciidoc">Edit me</ulink></title>
<simpara>The transport module is used for internal communication between nodes
within the cluster. Each call that goes from one node to the other uses
the transport module (for example, when an HTTP GET request is processed
by one node, and should actually be processed by another node that holds
the data).</simpara>
<simpara>The transport mechanism is completely asynchronous in nature, meaning
that there is no blocking thread waiting for a response. The benefit of
using asynchronous communication is first solving the
<ulink url="http://en.wikipedia.org/wiki/C10k_problem">C10k problem</ulink>, as well as
being the ideal solution for scatter (broadcast) / gather operations such
as search in ElasticSearch.</simpara>
<bridgehead id="_tcp_transport" renderas="sect2">TCP Transport<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/transport.asciidoc">Edit me</ulink></bridgehead>
<simpara>The TCP transport is an implementation of the transport module using
TCP. It allows for the following settings:</simpara>
<informaltable
frame="all"
rowsep="1" colsep="1"
>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting </entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>transport.tcp.port</literal></simpara></entry>
<entry align="left" valign="top"><simpara>A bind port range. Defaults to <literal>9300-9400</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.publish_port</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The port that other nodes in the cluster
should use when communicating with this node. Useful when a cluster node
is behind a proxy or firewall and the <literal>transport.tcp.port</literal> is not directly
addressable from the outside. Defaults to the actual port assigned via
<literal>transport.tcp.port</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.bind_host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The host address to bind the transport service to. Defaults to <literal>transport.host</literal> (if set) or <literal>network.bind_host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.publish_host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The host address to publish for nodes in the cluster to connect to. Defaults to <literal>transport.host</literal> (if set) or <literal>network.publish_host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Used to set the <literal>transport.bind_host</literal> and the <literal>transport.publish_host</literal> Defaults to <literal>transport.host</literal> or <literal>network.host</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.tcp.connect_timeout</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The socket connect timeout setting (in
time setting format). Defaults to <literal>30s</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.tcp.compress</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Set to <literal>true</literal> to enable compression (LZF)
between all nodes. Defaults to <literal>false</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport.ping_schedule</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Schedule a regular ping message to ensure that connections are kept alive. Defaults to <literal>5s</literal> in the transport client and <literal>-1</literal> (disabled) elsewhere.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>It also uses the common
<link linkend="modules-network">network settings</link>.</simpara>
<bridgehead id="_tcp_transport_profiles" renderas="sect3">TCP Transport Profiles<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/transport.asciidoc">Edit me</ulink></bridgehead>
<simpara>Elasticsearch allows you to bind to multiple ports on different interfaces by the use of transport profiles. See this example configuration</simpara>
<programlisting language="yaml" linenumbering="unnumbered">transport.profiles.default.port: 9300-9400
transport.profiles.default.bind_host: 10.0.0.1
transport.profiles.client.port: 9500-9600
transport.profiles.client.bind_host: 192.168.0.1
transport.profiles.dmz.port: 9700-9800
transport.profiles.dmz.bind_host: 172.16.1.2</programlisting>
<simpara>The <literal>default</literal> profile is a special. It is used as fallback for any other profiles, if those do not have a specific configuration setting set.
Note that the default profile is how other nodes in the cluster will connect to this node usually. In the future this feature will allow to enable node-to-node communication via multiple interfaces.</simpara>
<simpara>The following parameters can be configured like that</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>port</literal>: The port to bind to
</simpara>
</listitem>
<listitem>
<simpara>
<literal>bind_host</literal>: The host to bind
</simpara>
</listitem>
<listitem>
<simpara>
<literal>publish_host</literal>: The host which is published in informational APIs
</simpara>
</listitem>
<listitem>
<simpara>
<literal>tcp_no_delay</literal>: Configures the <literal>TCP_NO_DELAY</literal> option for this socket
</simpara>
</listitem>
<listitem>
<simpara>
<literal>tcp_keep_alive</literal>: Configures the <literal>SO_KEEPALIVE</literal> option for this socket
</simpara>
</listitem>
<listitem>
<simpara>
<literal>reuse_address</literal>: Configures the <literal>SO_REUSEADDR</literal> option for this socket
</simpara>
</listitem>
<listitem>
<simpara>
<literal>tcp_send_buffer_size</literal>: Configures the send buffer size of the socket
</simpara>
</listitem>
<listitem>
<simpara>
<literal>tcp_receive_buffer_size</literal>: Configures the receive buffer size of the socket
</simpara>
</listitem>
</itemizedlist>
<bridgehead id="_local_transport" renderas="sect2">Local Transport<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/transport.asciidoc">Edit me</ulink></bridgehead>
<simpara>This is a handy transport to use when running integration tests within
the JVM. It is automatically enabled when using
<literal>NodeBuilder#local(true)</literal>.</simpara>
<bridgehead id="_transport_tracer" renderas="sect2">Transport Tracer<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/transport.asciidoc">Edit me</ulink></bridgehead>
<simpara>The transport module has a dedicated tracer logger which, when activated, logs incoming and out going requests. The log can be dynamically activated
by settings the level of the <literal>transport.tracer</literal> logger to <literal>TRACE</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "logger.transport.tracer" : "TRACE"
    }
}'</programlisting>
<simpara>You can also control which actions will be traced, using a set of include and exclude wildcard patterns. By default every request will be traced
except for fault detection pings:</simpara>
<programlisting language="js" linenumbering="unnumbered">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "transport.tracer.include" : "*"
        "transport.tracer.exclude" : "internal:discovery/zen/fd*"
    }
}'</programlisting>
</chapter>
<chapter id="modules-tribe">
<title>Tribe node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/tribe.asciidoc">Edit me</ulink></title>
<simpara>The <emphasis>tribes</emphasis> feature allows a <emphasis>tribe node</emphasis> to act as a federated client across
multiple clusters.</simpara>
<simpara>The tribe node works by retrieving the cluster state from all connected
clusters and merging them into a global cluster state. With this information
at hand, it is able to perform read and write operations against the nodes in
all clusters as if they were local. Note that a tribe node needs to be able
to connect to each single node in every configured cluster.</simpara>
<simpara>The <literal>elasticsearch.yml</literal> config file for a tribe node just needs to list the
clusters that should be joined, for instance:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">tribe:
    t1: <co id="CO277-1"/>
        cluster.name:   cluster_one
    t2: <co id="CO277-2"/>
        cluster.name:   cluster_two</programlisting>
<calloutlist>
<callout arearefs="CO277-1 CO277-2">
<para>
<literal>t1</literal> and <literal>t2</literal> are arbitrary names representing the connection to each
    cluster.
</para>
</callout>
</calloutlist>
<simpara>The example above configures connections to two clusters, name <literal>t1</literal> and <literal>t2</literal>
respectively.  The tribe node will create a <link linkend="modules-node">node client</link> to
connect each cluster using <link linkend="unicast">unicast discovery</link> by default. Any
other settings for the connection can be configured under <literal>tribe.{name}</literal>, just
like the <literal>cluster.name</literal> in the example.</simpara>
<simpara>The merged global cluster state means that almost all operations work in the
same way as a single cluster: distributed search, suggest, percolation,
indexing, etc.</simpara>
<simpara>However, there are a few exceptions:</simpara>
<itemizedlist>
<listitem>
<simpara>
The merged view cannot handle indices with the same name in multiple
  clusters. By default it will pick one of them, see later for on_conflict options.
</simpara>
</listitem>
<listitem>
<simpara>
Master level read operations (eg <xref linkend="cluster-state"/>, <xref linkend="cluster-health"/>)
  will automatically execute with a local flag set to true since there is
  no master.
</simpara>
</listitem>
<listitem>
<simpara>
Master level write operations (eg <xref linkend="indices-create-index"/>) are not
  allowed. These should be performed on a single cluster.
</simpara>
</listitem>
</itemizedlist>
<simpara>The tribe node can be configured to block all write operations and all
metadata operations with:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">tribe:
    blocks:
        write:    true
        metadata: true</programlisting>
<simpara>The tribe node can also configure blocks on selected indices:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">tribe:
    blocks:
        write.indices:    hk*,ldn*
        metadata.indices: hk*,ldn*</programlisting>
<simpara>When there is a conflict and multiple clusters hold the same index, by default
the tribe node will pick one of them. This can be configured using the <literal>tribe.on_conflict</literal>
setting. It defaults to <literal>any</literal>, but can be set to <literal>drop</literal> (drop indices that have
a conflict), or <literal>prefer_[tribeName]</literal> to prefer the index from a specific tribe.</simpara>
<bridgehead id="_tribe_node_settings" renderas="sect2">Tribe node settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/modules/tribe.asciidoc">Edit me</ulink></bridgehead>
<simpara>The tribe node starts a node client for each listed cluster.  The following
configuration options are passed down from the tribe node to each node client:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>node.name</literal> (used to derive the <literal>node.name</literal> for each node client)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>network.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>network.bind_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>network.publish_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.bind_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.publish_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path.home</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path.conf</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path.plugins</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path.logs</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>path.scripts</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>shield.*</literal>
</simpara>
</listitem>
</itemizedlist>
<simpara>Almost any setting (except for <literal>path.*</literal>) may be configured at the node client
level itself, in which case it will override any passed through setting from
the tribe node.  Settings you may want to set at the node client level
include:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>network.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>network.bind_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>network.publish_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.bind_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>transport.publish_host</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>cluster.name</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>discovery.zen.ping.unicast.hosts</literal>
</simpara>
</listitem>
</itemizedlist>
<programlisting language="yaml" linenumbering="unnumbered">path.scripts:   some/path/to/config <co id="CO278-1"/>
network.host:   192.168.1.5 <co id="CO278-2"/>

tribe:
  t1:
    cluster.name:   cluster_one
  t2:
    cluster.name:   cluster_two
    network.host:   10.1.2.3 <co id="CO278-3"/></programlisting>
<calloutlist>
<callout arearefs="CO278-1">
<para>
The <literal>path.scripts</literal> setting is inherited by both <literal>t1</literal> and <literal>t2</literal>.
</para>
</callout>
<callout arearefs="CO278-2">
<para>
The <literal>network.host</literal> setting is inherited by <literal>t1</literal>.
</para>
</callout>
<callout arearefs="CO278-3">
<para>
The <literal>t3</literal> node client overrides the inherited from the tribe node.
</para>
</callout>
</calloutlist>
</chapter>
</part>
<part id="index-modules">
<title>Index Modules <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>Index Modules are modules created per index and control all aspects related to
an index.</simpara>
<bridgehead id="index-modules-settings" renderas="sect1">Index Settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules.asciidoc">Edit me</ulink></bridgehead>
<simpara>Index level settings can be set per-index.  Settings may be:</simpara>
<variablelist>
<varlistentry>
<term>
<emphasis>static</emphasis>
</term>
<listitem>
<simpara>
They can only be set at index creation time or on a
<link linkend="indices-open-close">closed index</link>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<emphasis>dynamic</emphasis>
</term>
<listitem>
<simpara>
They can be changed on a live index using the
<link linkend="indices-update-settings">update-index-settings</link> API.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<warning><simpara>Changing static or dynamic index settings on a closed index could
result in incorrect settings that are impossible to rectify without deleting
and recreating the index.</simpara></warning>
<bridgehead id="_static_index_settings" renderas="sect2">Static index settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules.asciidoc">Edit me</ulink></bridgehead>
<simpara>Below is a list of all <emphasis>static</emphasis> index settings that are not associated with any
specific index module:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.number_of_shards</literal>
</term>
<listitem>
<simpara>
    The number of primary shards that an index should have.  Defaults to 5.
    This setting can only be set at index creation time.  It cannot be
    changed on a closed index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.shard.check_on_startup</literal>
</term>
<listitem>
<simpara><phrase role="experimental">This functionality is experimental and may be changed or removed completely in a future release.</phrase> Whether or not shards should be checked for corruption before opening. When
corruption is detected, it will prevent the shard from being opened. Accepts:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>false</literal>
</term>
<listitem>
<simpara>
    (default) Don&#8217;t check for corruption when opening a shard.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>checksum</literal>
</term>
<listitem>
<simpara>
    Check for physical corruption.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>true</literal>
</term>
<listitem>
<simpara>
    Check for both physical and logical corruption. This is much more
    expensive in terms of CPU and memory usage.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>fix</literal>
</term>
<listitem>
<simpara>
    Check for both physical and logical corruption.  Segments that were reported
    as corrupted will be automatically removed. This option <emphasis role="strong">may result in data loss</emphasis>.
    Use with extreme caution!
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Checking shards may take a lot of time on large indices.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="index-codec" xreflabel="[index-codec]"/> <literal>index.codec</literal>
</term>
<listitem>
<simpara>
    The <literal>default</literal> value compresses stored data with LZ4
    compression, but this can be set to <literal>best_compression</literal>
    which uses <ulink url="https://en.wikipedia.org/wiki/DEFLATE">DEFLATE</ulink> for a higher
    compression ratio, at the expense of slower stored fields performance.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="dynamic-index-settings" renderas="sect2">Dynamic index settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules.asciidoc">Edit me</ulink></bridgehead>
<simpara>Below is a list of all <emphasis>dynamic</emphasis> index settings that are not associated with any
specific index module:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.number_of_replicas</literal>
</term>
<listitem>
<simpara>
    The number of replicas each primary shard has.  Defaults to 1.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.auto_expand_replicas</literal>
</term>
<listitem>
<simpara>
    Auto-expand the number of replicas based on the number of available nodes.
    Set to a dash delimited lower and upper bound (e.g. <literal>0-5</literal>) or use <literal>all</literal>
    for the upper bound (e.g. <literal>0-all</literal>).  Defaults to <literal>false</literal> (i.e. disabled).
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.refresh_interval</literal>
</term>
<listitem>
<simpara>
    How often to perform a refresh operation, which makes recent changes to the
    index visible to search.  Defaults to <literal>1s</literal>.  Can be set to <literal>-1</literal> to disable
    refresh.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.max_result_window</literal>
</term>
<listitem>
<simpara>
    The maximum value of <literal>from + size</literal> for searches to this index. Defaults to
    <literal>10000</literal>. Search requests take heap memory and time proportional to
    <literal>from + size</literal> and this limits that memory. See
    to raising this.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.blocks.read_only</literal>
</term>
<listitem>
<simpara>
    Set to <literal>true</literal> to make the index and index metadata read only, <literal>false</literal> to
    allow writes and metadata changes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.blocks.read</literal>
</term>
<listitem>
<simpara>
    Set to <literal>true</literal> to disable read operations against the index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.blocks.write</literal>
</term>
<listitem>
<simpara>
    Set to <literal>true</literal> to disable write operations against the index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.blocks.metadata</literal>
</term>
<listitem>
<simpara>
    Set to <literal>true</literal> to disable index metadata reads and writes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.ttl.disable_purge</literal>
</term>
<listitem>
<simpara>
    <phrase role="experimental">This functionality is experimental and may be changed or removed completely in a future release.</phrase> Disables the purge of <link linkend="mapping-ttl-field">expired docs</link> on
    the current index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="index.recovery.initial_shards" xreflabel="[index.recovery.initial_shards]"/><literal>index.recovery.initial_shards</literal>
</term>
<listitem>
<simpara>A primary shard is only recovered only if there are enough nodes available to
allocate sufficient replicas to form a quorum. It can be set to:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>quorum</literal> (default)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>quorum-1</literal> (or <literal>half</literal>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>full</literal>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>full-1</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
Number values are also supported, e.g. <literal>1</literal>.
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_settings_in_other_index_modules" renderas="sect2">Settings in other index modules<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules.asciidoc">Edit me</ulink></bridgehead>
<simpara>Other index settings are available in index modules:</simpara>
<variablelist>
<varlistentry>
<term>
<link linkend="analysis">Analysis</link>
</term>
<listitem>
<simpara>
    Settings to define analyzers, tokenizers, token filters and character
    filters.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-allocation">Index shard allocation</link>
</term>
<listitem>
<simpara>
    Control over where, when, and how shards are allocated to nodes.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-mapper">Mapping</link>
</term>
<listitem>
<simpara>
    Enable or disable dynamic mapping for an index.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-merge">Merging</link>
</term>
<listitem>
<simpara>
    Control over how shards are merged by the background merge process.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-similarity">Similarities</link>
</term>
<listitem>
<simpara>
    Configure custom similarity settings to customize how search results are
    scored.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-slowlog">Slowlog</link>
</term>
<listitem>
<simpara>
    Control over how slow queries and fetch requests are logged.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-store">Store</link>
</term>
<listitem>
<simpara>
    Configure the type of filesystem used to access shard data.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<link linkend="index-modules-translog">Translog</link>
</term>
<listitem>
<simpara>
    Control over the transaction log and background flush operations.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</partintro>
<chapter id="index-modules-analysis">
<title>Analysis<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/analysis.asciidoc">Edit me</ulink></title>
<simpara>The index analysis module acts as a configurable registry of <emphasis>analyzers</emphasis>
that can be used in order to convert a string field into individual terms
which are:</simpara>
<itemizedlist>
<listitem>
<simpara>
added to the inverted index in order to make the document searchable
</simpara>
</listitem>
<listitem>
<simpara>
used by high level queries such as the <link linkend="query-dsl-match-query"><literal>match</literal> query</link>
  to generate search terms.
</simpara>
</listitem>
</itemizedlist>
<simpara>See <xref linkend="analysis"/> for configuration details.</simpara>
</chapter>
<chapter id="index-modules-allocation">
<title>Index Shard Allocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation.asciidoc">Edit me</ulink></title>
<simpara>This module provides per-index settings to control the allocation of shards to
nodes:</simpara>
<itemizedlist>
<listitem>
<simpara>
<link linkend="shard-allocation-filtering">Shard allocation filtering</link>: Controlling which shards are allocated to which nodes.
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="delayed-allocation">Delayed allocation</link>: Delaying allocation of unassigned shards caused by a node leaving.
</simpara>
</listitem>
<listitem>
<simpara>
<link linkend="allocation-total-shards">Total shards per node</link>: A hard limit on the number of shards from the same index per node.
</simpara>
</listitem>
</itemizedlist>
<section id="shard-allocation-filtering">
<title>Shard Allocation Filtering<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/filtering.asciidoc">Edit me</ulink></title>
<simpara>Shard allocation filtering allows you to specify which nodes are allowed
to host the shards of a particular index.</simpara>
<note><simpara>The per-index shard allocation filters explained below work in
conjunction with the cluster-wide allocation filters explained in
<xref linkend="shards-allocation"/>.</simpara></note>
<simpara>It is possible to assign arbitrary metadata attributes to each node at
startup.  For instance, nodes could be assigned a <literal>rack</literal> and a <literal>group</literal>
attribute as follows:</simpara>
<programlisting language="sh" linenumbering="unnumbered">bin/elasticsearch --node.rack rack1 --node.size big  <co id="CO279-1"/></programlisting>
<calloutlist>
<callout arearefs="CO279-1">
<para>
These attribute settings can also be specified in the <literal>elasticsearch.yml</literal> config file.
</para>
</callout>
</calloutlist>
<simpara>These metadata attributes can be used with the
<literal>index.routing.allocation.*</literal> settings to allocate an index to a particular
group of nodes.  For instance, we can move the index <literal>test</literal> to either <literal>big</literal> or
<literal>medium</literal> nodes as follows:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT test/_settings
{
  "index.routing.allocation.include.size": "big,medium"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Alternatively, we can move the index <literal>test</literal> away from the <literal>small</literal> nodes with
an <literal>exclude</literal> rule:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT test/_settings
{
  "index.routing.allocation.exclude.size": "small"
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>Multiple rules can be specified, in which case all conditions must be
satisfied.  For instance, we could move the index <literal>test</literal> to <literal>big</literal> nodes in
<literal>rack1</literal> with the following:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT test/_settings
{
  "index.routing.allocation.include.size": "big",
  "index.routing.allocation.include.rack": "rack1"
}</programlisting>
<remark> AUTOSENSE</remark>
<note><simpara>If some conditions cannot be satisfied then shards will not be moved.</simpara></note>
<simpara>The following settings are <emphasis>dynamic</emphasis>, allowing live indices to be moved from
one set of nodes to another:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.routing.allocation.include.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has at least one of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.routing.allocation.require.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has <emphasis>all</emphasis> of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.routing.allocation.exclude.{attribute}</literal>
</term>
<listitem>
<simpara>
    Assign the index to a node whose <literal>{attribute}</literal> has <emphasis>none</emphasis> of the
    comma-separated values.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>These special attributes are also supported:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>_name</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by node name
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_host_ip</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by host IP address (IP associated with hostname)
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_publish_ip</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by publish IP address
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_ip</literal>
</simpara>
</entry>
<entry>
<simpara>
Match either <literal>_host_ip</literal> or <literal>_publish_ip</literal>
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>_host</literal>
</simpara>
</entry>
<entry>
<simpara>
Match nodes by hostname
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>All attribute values can be specified with wildcards, eg:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT test/_settings
{
  "index.routing.allocation.include._ip": "192.168.2.*"
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="delayed-allocation">
<title>Delaying allocation when a node leaves<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/delayed.asciidoc">Edit me</ulink></title>
<simpara>When a node leaves the cluster for whatever reason, intentional or otherwise,
the master reacts by:</simpara>
<itemizedlist>
<listitem>
<simpara>
Promoting a replica shard to primary to replace any primaries that were on the node.
</simpara>
</listitem>
<listitem>
<simpara>
Allocating replica shards to replace the missing replicas (assuming there are enough nodes).
</simpara>
</listitem>
<listitem>
<simpara>
Rebalancing shards evenly across the remaining nodes.
</simpara>
</listitem>
</itemizedlist>
<simpara>These actions are intended to protect the cluster against data loss by
ensuring that every shard is fully replicated as soon as possible.</simpara>
<simpara>Even though we throttle concurrent recoveries both at the
<link linkend="recovery">node level</link> and at the <link linkend="shards-allocation">cluster level</link>, this
&#8220;shard-shuffle&#8221; can still put a lot of extra load on the cluster which
may not be necessary if the missing node is likely to return soon. Imagine
this scenario:</simpara>
<itemizedlist>
<listitem>
<simpara>
Node 5 loses network connectivity.
</simpara>
</listitem>
<listitem>
<simpara>
The master promotes a replica shard to primary for each primary that was on Node 5.
</simpara>
</listitem>
<listitem>
<simpara>
The master allocates new replicas to other nodes in the cluster.
</simpara>
</listitem>
<listitem>
<simpara>
Each new replica makes an entire copy of the primary shard across the network.
</simpara>
</listitem>
<listitem>
<simpara>
More shards are moved to different nodes to rebalance the cluster.
</simpara>
</listitem>
<listitem>
<simpara>
Node 5 returns after a few minutes.
</simpara>
</listitem>
<listitem>
<simpara>
The master rebalances the cluster by allocating shards to Node 5.
</simpara>
</listitem>
</itemizedlist>
<simpara>If the master had just waited for a few minutes, then the missing shards could
have been re-allocated to Node 5 with the minimum of network traffic.  This
process would be even quicker for idle shards (shards not receiving indexing
requests) which have been automatically <link linkend="indices-synced-flush">sync-flushed</link>.</simpara>
<simpara>The allocation of replica shards which become unassigned because a node has
left can be delayed with the <literal>index.unassigned.node_left.delayed_timeout</literal>
dynamic setting, which defaults to <literal>1m</literal>.</simpara>
<simpara>This setting can be updated on a live index (or on all indices):</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_all/_settings
{
  "settings": {
    "index.unassigned.node_left.delayed_timeout": "5m"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>With delayed allocation enabled, the above scenario changes to look like this:</simpara>
<itemizedlist>
<listitem>
<simpara>
Node 5 loses network connectivity.
</simpara>
</listitem>
<listitem>
<simpara>
The master promotes a replica shard to primary for each primary that was on Node 5.
</simpara>
</listitem>
<listitem>
<simpara>
The master logs a message that allocation of unassigned shards has been delayed, and for how long.
</simpara>
</listitem>
<listitem>
<simpara>
The cluster remains yellow because there are unassigned replica shards.
</simpara>
</listitem>
<listitem>
<simpara>
Node 5 returns after a few minutes, before the <literal>timeout</literal> expires.
</simpara>
</listitem>
<listitem>
<simpara>
The missing replicas are re-allocated to Node 5 (and sync-flushed shards recover almost immediately).
</simpara>
</listitem>
</itemizedlist>
<note><simpara>This setting will not affect the promotion of replicas to primaries, nor
will it affect the assignment of replicas that have not been assigned
previously. In particular, delayed allocation does not come into effect after a full cluster restart.
Also, in case of a master failover situation, elapsed delay time is forgotten
(i.e. reset to the full initial delay).</simpara></note>
<section id="_cancellation_of_shard_relocation">
<title>Cancellation of shard relocation<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/delayed.asciidoc">Edit me</ulink></title>
<simpara>If delayed allocation times out, the master assigns the missing shards to
another node which will start recovery.  If the missing node rejoins the
cluster, and its shards still have the same sync-id as the primary, shard
relocation will be cancelled and the synced shard will be used for recovery
instead.</simpara>
<simpara>For this reason, the default <literal>timeout</literal> is set to just one minute: even if shard
relocation begins, cancelling recovery in favour of the synced shard is cheap.</simpara>
</section>
<section id="_monitoring_delayed_unassigned_shards">
<title>Monitoring delayed unassigned shards<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/delayed.asciidoc">Edit me</ulink></title>
<simpara>The number of shards whose allocation has been delayed by this timeout setting
can be viewed with the <link linkend="cluster-health">cluster health API</link>:</simpara>
<programlisting language="js" linenumbering="unnumbered">GET _cluster/health <co id="CO280-1"/></programlisting>
<calloutlist>
<callout arearefs="CO280-1">
<para>
This request will return a <literal>delayed_unassigned_shards</literal> value.
</para>
</callout>
</calloutlist>
</section>
<section id="_removing_a_node_permanently">
<title>Removing a node permanently<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/delayed.asciidoc">Edit me</ulink></title>
<simpara>If a node is not going to return and you would like Elasticsearch to allocate
the missing shards immediately, just update the timeout to zero:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /_all/_settings
{
  "settings": {
    "index.unassigned.node_left.delayed_timeout": "0"
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>You can reset the timeout as soon as the missing shards have started to recover.</simpara>
</section>
</section>
<section id="recovery-prioritization">
<title>Index recovery prioritization<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/prioritization.asciidoc">Edit me</ulink></title>
<simpara>Unallocated shards are recovered in order of priority, whenever possible.
Indices are sorted into priority order as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>
the optional <literal>index.priority</literal> setting (higher before lower)
</simpara>
</listitem>
<listitem>
<simpara>
the index creation date (higher before lower)
</simpara>
</listitem>
<listitem>
<simpara>
the index name (higher before lower)
</simpara>
</listitem>
</itemizedlist>
<simpara>This means that, by default, newer indices will be recovered before older indices.</simpara>
<simpara>Use the per-index dynamically updateable <literal>index.priority</literal> setting to customise
the index prioritization order.  For instance:</simpara>
<programlisting language="json" linenumbering="unnumbered">PUT index_1

PUT index_2

PUT index_3
{
  "settings": {
    "index.priority": 10
  }
}

PUT index_4
{
  "settings": {
    "index.priority": 5
  }
}</programlisting>
<remark> AUTOSENSE</remark>
<simpara>In the above example:</simpara>
<itemizedlist>
<listitem>
<simpara>
<literal>index_3</literal> will be recovered first because it has the highest <literal>index.priority</literal>.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index_4</literal> will be recovered next because it has the next highest priority.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index_2</literal> will be recovered next because it was created more recently.
</simpara>
</listitem>
<listitem>
<simpara>
<literal>index_1</literal> will be recovered last.
</simpara>
</listitem>
</itemizedlist>
<simpara>This setting accepts an integer, and can be updated on a live index with the
<link linkend="indices-update-settings">update index settings API</link>:</simpara>
<programlisting language="json" linenumbering="unnumbered">PUT index_4/_settings
{
  "index.priority": 1
}</programlisting>
<remark> AUTOSENSE</remark>
</section>
<section id="allocation-total-shards">
<title>Total Shards Per Node<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/allocation/total_shards.asciidoc">Edit me</ulink></title>
<simpara>The cluster-level shard allocator tries to spread the shards of a single index
across as many nodes as possible.  However, depending on how many shards and
indices you have, and how big they are, it may not always be possible to spread
shards evenly.</simpara>
<simpara>The following <emphasis>dynamic</emphasis> setting allows you to specify a hard limit on the total
number of shards from a single index allowed per node:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.routing.allocation.total_shards_per_node</literal>
</term>
<listitem>
<simpara>
    The maximum number of shards (replicas and primaries) that will be
    allocated to a single node.  Defaults to unbounded.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>You can also limit the amount of shards a node can have regardless of the index:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>cluster.routing.allocation.total_shards_per_node</literal>
</term>
<listitem>
<simpara>
    The maximum number of shards (replicas and primaries) that will be
    allocated to a single node globally.  Defaults to unbounded (-1).
</simpara>
</listitem>
</varlistentry>
</variablelist>
<warning>
<simpara>These settings impose a hard limit which can result in some shards not being
allocated.</simpara>
<simpara>Use with caution.</simpara>
</warning>
</section>
</chapter>
<chapter id="index-modules-mapper">
<title>Mapper<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/mapper.asciidoc">Edit me</ulink></title>
<simpara>The mapper module acts as a registry for the type mapping definitions
added to an index either when creating it or by using the put mapping
api. It also handles the dynamic mapping support for types that have no
explicit mappings pre defined. For more information about mapping
definitions, check out the <link linkend="mapping">mapping section</link>.</simpara>
</chapter>
<chapter id="index-modules-merge">
<title>Merge<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/merge.asciidoc">Edit me</ulink></title>
<simpara>A shard in elasticsearch is a Lucene index, and a Lucene index is broken down
into segments. Segments are internal storage elements in the index where the
index data is stored, and are immutable. Smaller segments are periodically
merged into larger segments to keep the index size at bay and to expunge
deletes.</simpara>
<simpara>The merge process uses auto-throttling to balance the use of hardware
resources between merging and other activities like search.</simpara>
<bridgehead id="merge-scheduling" renderas="sect2">Merge scheduling<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/merge.asciidoc">Edit me</ulink></bridgehead>
<simpara>The merge scheduler (ConcurrentMergeScheduler) controls the execution of merge
operations when they are needed.  Merges run in separate threads, and when the
maximum number of threads is reached, further merges will wait until a merge
thread becomes available.</simpara>
<simpara>The merge scheduler supports the following <emphasis>dynamic</emphasis> setting:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.merge.scheduler.max_thread_count</literal>
</term>
<listitem>
<simpara>
    The maximum number of threads that may be merging at once. Defaults to
    <literal>Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))</literal>
    which works well for a good solid-state-disk (SSD).  If your index is on
    spinning platter drives instead, decrease this to 1.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="index-modules-similarity">
<title>Similarity module<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></title>
<simpara>A similarity (scoring / ranking model) defines how matching documents
are scored. Similarity is per field, meaning that via the mapping one
can define a different similarity per field.</simpara>
<simpara>Configuring a custom similarity is considered a expert feature and the
builtin similarities are most likely sufficient as is described in
<xref linkend="similarity"/>.</simpara>
<bridgehead id="configuration" renderas="sect2">Configuring a similarity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>Most existing or custom Similarities have configuration options which
can be configured via the index settings as shown below. The index
options can be provided when creating an index or updating index
settings.</simpara>
<programlisting language="js" linenumbering="unnumbered">"similarity" : {
  "my_similarity" : {
    "type" : "DFR",
    "basic_model" : "g",
    "after_effect" : "l",
    "normalization" : "h2",
    "normalization.h2.c" : "3.0"
  }
}</programlisting>
<simpara>Here we configure the DFRSimilarity so it can be referenced as
<literal>my_similarity</literal> in mappings as is illustrate in the below example:</simpara>
<programlisting language="js" linenumbering="unnumbered">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "similarity" : "my_similarity" }
    }
}</programlisting>
<bridgehead id="_available_similarities" renderas="sect2">Available similarities<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<bridgehead id="default-similarity" renderas="sect3">Default similarity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>The default similarity that is based on the TF/IDF model. This
similarity has the following option:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>discount_overlaps</literal>
</term>
<listitem>
<simpara>
    Determines whether overlap tokens (Tokens with
    0 position increment) are ignored when computing norm. By default this
    is true, meaning overlap tokens do not count when computing norms.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>Type name: <literal>default</literal></simpara>
<bridgehead id="bm25" renderas="sect3">BM25 similarity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>Another TF/IDF based similarity that has built-in tf normalization and
is supposed to work better for short fields (like names). See
<ulink url="http://en.wikipedia.org/wiki/Okapi_BM25">Okapi_BM25</ulink> for more details.
This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>k1</literal>
</simpara>
</entry>
<entry>
<simpara>
    Controls non-linear term frequency normalization
    (saturation). The default value is <literal>1.2</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>b</literal>
</simpara>
</entry>
<entry>
<simpara>
    Controls to what degree document length normalizes tf values.
    The default value is <literal>0.75</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>discount_overlaps</literal>
</simpara>
</entry>
<entry>
<simpara>
    Determines whether overlap tokens (Tokens with
    0 position increment) are ignored when computing norm. By default this
    is true, meaning overlap tokens do not count when computing norms.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Type name: <literal>BM25</literal></simpara>
<bridgehead id="drf" renderas="sect3">DFR similarity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>Similarity that implements the
<ulink url="http://lucene.apache.org/core/5_2_1/core/org/apache/lucene/search/similarities/DFRSimilarity.html">divergence
from randomness</ulink> framework. This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>basic_model</literal>
</simpara>
</entry>
<entry>
<simpara>
    Possible values: <literal>be</literal>, <literal>d</literal>, <literal>g</literal>, <literal>if</literal>, <literal>in</literal>, <literal>ine</literal> and <literal>p</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>after_effect</literal>
</simpara>
</entry>
<entry>
<simpara>
    Possible values: <literal>no</literal>, <literal>b</literal> and <literal>l</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>normalization</literal>
</simpara>
</entry>
<entry>
<simpara>
    Possible values: <literal>no</literal>, <literal>h1</literal>, <literal>h2</literal>, <literal>h3</literal> and <literal>z</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>All options but the first option need a normalization value.</simpara>
<simpara>Type name: <literal>DFR</literal></simpara>
<bridgehead id="dfi" renderas="sect3">DFI similarity<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>Similarity that implements the <ulink url="http://trec.nist.gov/pubs/trec21/papers/irra.web.nb.pdf">divergence from independence</ulink>
model.
This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>independence_measure</literal>
</simpara>
</entry>
<entry>
<simpara>
Possible values <literal>standardized</literal>, <literal>saturated</literal>, <literal>chisquared</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Type name: <literal>DFI</literal></simpara>
<bridgehead id="ib" renderas="sect3">IB similarity.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara><ulink url="http://lucene.apache.org/core/5_2_1/core/org/apache/lucene/search/similarities/IBSimilarity.html">Information
based model</ulink> . The algorithm is based on the concept that the information content in any symbolic <emphasis>distribution</emphasis>
sequence is primarily determined by the repetitive usage of its basic elements.
For written texts this challenge would correspond to comparing the writing styles of different authors.
This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>distribution</literal>
</simpara>
</entry>
<entry>
<simpara>
Possible values: <literal>ll</literal> and <literal>spl</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>lambda</literal>
</simpara>
</entry>
<entry>
<simpara>
Possible values: <literal>df</literal> and <literal>ttf</literal>.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>normalization</literal>
</simpara>
</entry>
<entry>
<simpara>
Same as in <literal>DFR</literal> similarity.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Type name: <literal>IB</literal></simpara>
<bridgehead id="lm_dirichlet" renderas="sect3">LM Dirichlet similarity.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara><ulink url="http://lucene.apache.org/core/5_2_1/core/org/apache/lucene/search/similarities/LMDirichletSimilarity.html">LM
Dirichlet similarity</ulink> . This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>mu</literal>
</simpara>
</entry>
<entry>
<simpara>
Default to <literal>2000</literal>.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Type name: <literal>LMDirichlet</literal></simpara>
<bridgehead id="lm_jelinek_mercer" renderas="sect3">LM Jelinek Mercer similarity.<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara><ulink url="http://lucene.apache.org/core/5_2_1/core/org/apache/lucene/search/similarities/LMJelinekMercerSimilarity.html">LM
Jelinek Mercer similarity</ulink> . The algorithm attempts to capture important patterns in the text, while leaving out noise. This similarity has the following options:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>lambda</literal>
</simpara>
</entry>
<entry>
<simpara>
The optimal value depends on both the collection and the query. The optimal value is around <literal>0.1</literal>
for title queries and <literal>0.7</literal> for long queries. Default to <literal>0.1</literal>. When value approaches <literal>0</literal>, documents that match more query terms will be ranked higher than those that match fewer terms.
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Type name: <literal>LMJelinekMercer</literal></simpara>
<bridgehead id="default-base" renderas="sect3">Default and Base Similarities<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/similarity.asciidoc">Edit me</ulink></bridgehead>
<simpara>By default, Elasticsearch will use whatever similarity is configured as
<literal>default</literal>. However, the similarity functions <literal>queryNorm()</literal> and <literal>coord()</literal>
are not per-field. Consequently, for expert users wanting to change the
implementation used for these two methods, while not changing the
<literal>default</literal>, it is possible to configure a similarity with the name
<literal>base</literal>. This similarity will then be used for the two methods.</simpara>
<simpara>You can change the default similarity for all fields by putting the following setting into <literal>elasticsearch.yml</literal>:</simpara>
<programlisting language="js" linenumbering="unnumbered">index.similarity.default.type: BM25</programlisting>
</chapter>
<chapter id="index-modules-slowlog">
<title>Slow Log<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/slowlog.asciidoc">Edit me</ulink></title>
<bridgehead id="search-slow-log" renderas="sect2">Search Slow Log<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/slowlog.asciidoc">Edit me</ulink></bridgehead>
<simpara>Shard level slow search log allows to log slow search (query and fetch
phases) into a dedicated log file.</simpara>
<simpara>Thresholds can be set for both the query phase of the execution, and
fetch phase, here is a sample:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

index.search.slowlog.threshold.fetch.warn: 1s
index.search.slowlog.threshold.fetch.info: 800ms
index.search.slowlog.threshold.fetch.debug: 500ms
index.search.slowlog.threshold.fetch.trace: 200ms</programlisting>
<simpara>All of the above settings are <emphasis>dynamic</emphasis> and can be set per-index.</simpara>
<simpara>By default, none are enabled (set to <literal>-1</literal>). Levels (<literal>warn</literal>, <literal>info</literal>,
<literal>debug</literal>, <literal>trace</literal>) allow to control under which logging level the log
will be logged. Not all are required to be configured (for example, only
<literal>warn</literal> threshold can be set). The benefit of several levels is the
ability to quickly "grep" for specific thresholds breached.</simpara>
<simpara>The logging is done on the shard level scope, meaning the execution of a
search request within a specific shard. It does not encompass the whole
search request, which can be broadcast to several shards in order to
execute. Some of the benefits of shard level logging is the association
of the actual execution on the specific machine, compared with request
level.</simpara>
<simpara>The logging file is configured by default using the following
configuration (found in <literal>logging.yml</literal>):</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index_search_slow_log_file:
  type: dailyRollingFile
  file: ${path.logs}/${cluster.name}_index_search_slowlog.log
  datePattern: "'.'yyyy-MM-dd"
  layout:
    type: pattern
    conversionPattern: "[%d{ISO8601}][%-5p][%-25c] %m%n"</programlisting>
<bridgehead id="index-slow-log" renderas="sect2">Index Slow log<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/slowlog.asciidoc">Edit me</ulink></bridgehead>
<simpara>The indexing slow log, similar in functionality to the search slow
log. The log file name ends with <literal>_index_indexing_slowlog.log</literal>. Log and
the thresholds are configured in the elasticsearch.yml file in the same
way as the search slowlog. Index slowlog sample:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 500ms
index.indexing.slowlog.level: info
index.indexing.slowlog.source: 1000</programlisting>
<simpara>All of the above settings are <emphasis>dynamic</emphasis> and can be set per-index.</simpara>
<simpara>By default Elasticsearch will log the first 1000 characters of the _source in
the slowlog. You can change that with <literal>index.indexing.slowlog.source</literal>. Setting
it to <literal>false</literal> or <literal>0</literal> will skip logging the source entirely an setting it to
<literal>true</literal> will log the entire source regardless of size.</simpara>
<simpara>The index slow log file is configured by default in the <literal>logging.yml</literal>
file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index_indexing_slow_log_file:
    type: dailyRollingFile
    file: ${path.logs}/${cluster.name}_index_indexing_slowlog.log
    datePattern: "'.'yyyy-MM-dd"
    layout:
      type: pattern
      conversionPattern: "[%d{ISO8601}][%-5p][%-25c] %m%n"</programlisting>
</chapter>
<chapter id="index-modules-store">
<title>Store<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/store.asciidoc">Edit me</ulink></title>
<simpara>The store module allows you to control how index data is stored and accessed on disk.</simpara>
<bridgehead id="file-system" renderas="sect2">File system storage types<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/store.asciidoc">Edit me</ulink></bridgehead>
<simpara>There are different file system implementations or <emphasis>storage types</emphasis>. The best
one for the operating environment will be automatically chosen: <literal>mmapfs</literal> on
Windows 64bit, <literal>simplefs</literal> on Windows 32bit, and <literal>default</literal> (hybrid <literal>niofs</literal> and
<literal>mmapfs</literal>) for the rest.</simpara>
<simpara>This can be overridden for all indices by adding this to the
<literal>config/elasticsearch.yml</literal> file:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">index.store.type: niofs</programlisting>
<simpara>It is a <emphasis>static</emphasis> setting that can be set on a per-index basis at index
creation time:</simpara>
<programlisting language="js" linenumbering="unnumbered">PUT /my_index
{
  "settings": {
    "index.store.type": "niofs"
  }
}</programlisting>
<warning role="experimental"><simpara>This is an expert-only setting and may be removed in the future.</simpara></warning>
<simpara>The following sections lists all the different storage types supported.</simpara>
<variablelist>
<varlistentry>
<term>
<anchor id="simplefs" xreflabel="[simplefs]"/><literal>simplefs</literal>
</term>
<listitem>
<simpara>
The Simple FS type is a straightforward implementation of file system
storage (maps to Lucene <literal>SimpleFsDirectory</literal>) using a random access file.
This implementation has poor concurrent performance (multiple threads
will bottleneck). It is usually better to use the <literal>niofs</literal> when you need
index persistence.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="niofs" xreflabel="[niofs]"/><literal>niofs</literal>
</term>
<listitem>
<simpara>
The NIO FS type stores the shard index on the file system (maps to
Lucene <literal>NIOFSDirectory</literal>) using NIO. It allows multiple threads to read
from the same file concurrently. It is not recommended on Windows
because of a bug in the SUN Java implementation.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="mmapfs" xreflabel="[mmapfs]"/><literal>mmapfs</literal>
</term>
<listitem>
<simpara>
The MMap FS type stores the shard index on the file system (maps to
Lucene <literal>MMapDirectory</literal>) by mapping a file into memory (mmap). Memory
mapping uses up a portion of the virtual memory address space in your
process equal to the size of the file being mapped. Before using this
class, be sure you have allowed plenty of
<link linkend="vm-max-map-count">virtual address space</link>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<anchor id="default_fs" xreflabel="[default_fs]"/><literal>default_fs</literal>
</term>
<listitem>
<simpara>
The <literal>default</literal> type is a hybrid of NIO FS and MMapFS, which chooses the best
file system for each type of file. Currently only the Lucene term dictionary
and doc values files are memory mapped to reduce the impact on the operating
system. All other files are opened using Lucene <literal>NIOFSDirectory</literal>. Address
space settings (<xref linkend="vm-max-map-count"/>) might also apply if your term
dictionaries are large.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="index-modules-translog">
<title>Translog<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/translog.asciidoc">Edit me</ulink></title>
<simpara>Changes to Lucene are only persisted to disk during a Lucene commit,
which is a relatively heavy operation and so cannot be performed after every
index or delete operation. Changes that happen after one commit and before another
will be lost in the event of process exit or HW failure.</simpara>
<simpara>To prevent this data loss, each shard has a <emphasis>transaction log</emphasis> or write ahead
log associated with it. Any index or delete operation is written to the
translog after being processed by the internal Lucene index.</simpara>
<simpara>In the event of a crash, recent transactions can be replayed from the
transaction log when the shard recovers.</simpara>
<simpara>An Elasticsearch flush is the process of performing a Lucene commit and
starting a new translog. It is done automatically in the background in order
to make sure the transaction log doesn&#8217;t grow too large, which would make
replaying its operations take a considerable amount of time during recovery.
It is also exposed through an API, though its rarely needed to be performed
manually.</simpara>
<bridgehead id="_flush_settings" renderas="sect2">Flush settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/translog.asciidoc">Edit me</ulink></bridgehead>
<simpara>The following <link linkend="indices-update-settings">dynamically updatable</link> settings
control how often the in-memory buffer is flushed to disk:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.translog.flush_threshold_size</literal>
</term>
<listitem>
<simpara>
Once the translog hits this size, a flush will happen. Defaults to <literal>512mb</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.translog.flush_threshold_ops</literal>
</term>
<listitem>
<simpara>
After how many operations to flush. Defaults to <literal>unlimited</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.translog.flush_threshold_period</literal>
</term>
<listitem>
<simpara>
How long to wait before triggering a flush regardless of translog size. Defaults to <literal>30m</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.translog.interval</literal>
</term>
<listitem>
<simpara>
How often to check if a flush is needed, randomized between the interval value
and 2x the interval value. Defaults to <literal>5s</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="_translog_settings" renderas="sect2">Translog settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/index-modules/translog.asciidoc">Edit me</ulink></bridgehead>
<simpara>The data in the transaction log is only persisted to disk when the translog is
<literal>fsync</literal>ed and committed.  In the event of hardware failure, any data written
since the previous translog commit will be lost.</simpara>
<simpara>By default, Elasticsearch commits the translog at the end of every <link linkend="docs-index_">index</link>, <link linkend="docs-delete">delete</link>,
<link linkend="docs-update">update</link>, or  <link linkend="docs-bulk">bulk</link> request.  In fact, Elasticsearch
will only report success of an index, delete, update, or bulk request to the
client after the transaction log has been successfully <literal>fsync</literal>ed and committed
on the primary and on every allocated replica.</simpara>
<simpara>The following <emphasis>static</emphasis> per-index setting controls sync frequency of the translog:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.translog.sync_interval</literal>
</term>
<listitem>
<simpara>
How often the translog is <literal>fsync</literal>ed to disk and committed, regardless of
write operations. Defaults to <literal>5s</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>The following <link linkend="indices-update-settings">dynamically updatable</link> per-index settings
control the behaviour of the transaction log:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>index.translog.durability</literal>
</term>
<listitem>
<simpara>Whether or not to <literal>fsync</literal> and commit the translog after every index, delete,
update, or bulk request.  This setting accepts the following parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>request</literal>
</term>
<listitem>
<simpara>
    (default) <literal>fsync</literal> and commit after every request. In the event
    of hardware failure, all acknowledged writes will already have been
    committed to disk.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>async</literal>
</term>
<listitem>
<simpara>
    <literal>fsync</literal> and commit in the background every <literal>sync_interval</literal>. In
    the event of hardware failure, all acknowledged writes since the last
    automatic commit will be discarded.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>index.translog.fs.type</literal>
</term>
<listitem>
<simpara>Whether to buffer writes to the transaction log in memory or not.  This
setting accepts the following parameters:</simpara>
<variablelist>
<varlistentry>
<term>
<literal>buffered</literal>
</term>
<listitem>
<simpara>
    (default) Translog writes first go to a 64kB buffer in memory,
    and are only written to the disk when the buffer is full, or when an
    <literal>fsync</literal> is triggered by a write request or the <literal>sync_interval</literal>.
</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>
<literal>simple</literal>
</term>
<listitem>
<simpara>
    Translog writes are written to the file system immediately, without
    buffering.  However, these writes will only be persisted to disk when an
    <literal>fsync</literal> and commit is triggered by a write request or the <literal>sync_interval</literal>.
</simpara>
</listitem>
</varlistentry>
</variablelist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
</part>
<part id="testing">
<title>Testing <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section is about utilizing elasticsearch as part of your testing infrastructure.</simpara>
<bridgehead id="testing-header" renderas="sect1">Testing:<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing.asciidoc">Edit me</ulink></bridgehead>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="testing-framework"/>
</simpara>
</listitem>
</itemizedlist>
</partintro>
<chapter id="testing-framework">
<title>Java Testing Framework<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara id="testing-intro">Testing is a crucial part of your application, and as information retrieval itself is already a complex topic, there should not be any additional complexity in setting up a testing infrastructure, which uses elasticsearch. This is the main reason why we decided to release an additional file to the release, which allows you to use the same testing infrastructure we do in the elasticsearch core. The testing framework allows you to setup clusters with multiple nodes in order to check if your code covers everything needed to run in a cluster. The framework prevents you from writing complex code yourself to start, stop or manage several test nodes in a cluster. In addition there is another very important feature called randomized testing, which you are getting for free as it is part of the elasticsearch infrastructure.</simpara>
<section id="why-randomized-testing">
<title>why randomized testing?<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>The key concept of randomized testing is not to use the same input values for every testcase, but still be able to reproduce it in case of a failure. This allows to test with vastly different input variables in order to make sure, that your implementation is actually independent from your provided test data.</simpara>
<simpara>All of the tests are run using a custom junit runner, the <literal>RandomizedRunner</literal> provided by the randomized-testing project. If you are interested in the implementation being used, check out the <ulink url="http://labs.carrotsearch.com/randomizedtesting.html">RandomizedTesting webpage</ulink>.</simpara>
</section>
<section id="using-elasticsearch-test-classes">
<title>Using the elasticsearch test classes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>First, you need to include the testing dependency in your project, along with the elasticsearch dependency you have already added. If you use maven and its <literal>pom.xml</literal> file, it looks like this</simpara>
<screen id="source" xreflabel="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;
    &lt;artifactId&gt;lucene-test-framework&lt;/artifactId&gt;
    &lt;version&gt;${lucene.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;
    &lt;version&gt;${elasticsearch.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
    &lt;type&gt;test-jar&lt;/type&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</screen>
<simpara>Replace the elasticsearch version and the lucene version with the corresponding elasticsearch version and its accompanying lucene release.</simpara>
<simpara>We provide a few classes that you can inherit from in your own test classes which provide:</simpara>
<itemizedlist>
<listitem>
<simpara>
pre-defined loggers
</simpara>
</listitem>
<listitem>
<simpara>
randomized testing infrastructure
</simpara>
</listitem>
<listitem>
<simpara>
a number of helper methods
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="unit-tests">
<title>unit tests<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>If your test is a well isolated unit test which doesn&#8217;t need a running elasticsearch cluster, you can use the <literal>ESTestCase</literal>. If you are testing lucene features, use <literal>ESTestCase</literal> and if you are testing concrete token streams, use the <literal>ESTokenStreamTestCase</literal> class. Those specific classes execute additional checks which ensure that no resources leaks are happening, after the test has run.</simpara>
</section>
<section id="integration-tests">
<title>integration tests<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>These kind of tests require firing up a whole cluster of nodes, before the tests can actually be run. Compared to unit tests they are obviously way more time consuming, but the test infrastructure tries to minimize the time cost by only restarting the whole cluster, if this is configured explicitly.</simpara>
<simpara>The class your tests have to inherit from is <literal>ESIntegTestCase</literal>. By inheriting from this class, you will no longer need to start elasticsearch nodes manually in your test, although you might need to ensure that at least a certain number of nodes are up. The integration test behaviour can be configured heavily by specifying different system properties on test runs. See the <literal>TESTING.asciidoc</literal> documentation in the <ulink url="https://github.com/elastic/elasticsearch/blob/master/TESTING.asciidoc">source repository</ulink> for more information.</simpara>
<section id="number-of-shards">
<title>number of shards<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>The number of shards used for indices created during integration tests is randomized between <literal>1</literal> and <literal>10</literal> unless overwritten upon index creation via index settings.
The rule of thumb is not to specify the number of shards unless needed, so that each test will use a different one all the time. Alternatively you can override the <literal>numberOfShards()</literal> method. The same applies to the <literal>numberOfReplicas()</literal> method.</simpara>
</section>
<section id="helper-methods">
<title>generic helper methods<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>There are a couple of helper methods in <literal>ESIntegTestCase</literal>, which will make your tests shorter and more concise.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>refresh()</literal>
</simpara>
</entry>
<entry>
<simpara>
Refreshes all indices in a cluster
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ensureGreen()</literal>
</simpara>
</entry>
<entry>
<simpara>
Ensures a green health cluster state, waiting for relocations. Waits the default timeout of 30 seconds before failing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ensureYellow()</literal>
</simpara>
</entry>
<entry>
<simpara>
Ensures a yellow health cluster state, also waits for 30 seconds before failing.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>createIndex(name)</literal>
</simpara>
</entry>
<entry>
<simpara>
Creates an index with the specified name
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flush()</literal>
</simpara>
</entry>
<entry>
<simpara>
Flushes all indices in a cluster
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>flushAndRefresh()</literal>
</simpara>
</entry>
<entry>
<simpara>
Combines <literal>flush()</literal> and <literal>refresh()</literal> calls
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>forceMerge()</literal>
</simpara>
</entry>
<entry>
<simpara>
Waits for all relocations and force merges all indices in the cluster to one segment.
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>indexExists(name)</literal>
</simpara>
</entry>
<entry>
<simpara>
Checks if given index exists
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>admin()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns an <literal>AdminClient</literal> for administrative tasks
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>clusterService()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns the cluster service java class
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>cluster()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns the test cluster class, which is explained in the next paragraphs
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="test-cluster-methods">
<title>test cluster methods<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>The <literal>InternalTestCluster</literal> class is the heart of the cluster functionality in a randomized test and allows you to configure a specific setting or replay certain types of outages to check, how your custom code reacts.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>ensureAtLeastNumNodes(n)</literal>
</simpara>
</entry>
<entry>
<simpara>
Ensure at least the specified number of nodes is running in the cluster
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>ensureAtMostNumNodes(n)</literal>
</simpara>
</entry>
<entry>
<simpara>
Ensure at most the specified number of nodes is running in the cluster
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>getInstance()</literal>
</simpara>
</entry>
<entry>
<simpara>
Get a guice instantiated instance of a class from a random node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>getInstanceFromNode()</literal>
</simpara>
</entry>
<entry>
<simpara>
Get a guice instantiated instance of a class from a specified node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopRandomNode()</literal>
</simpara>
</entry>
<entry>
<simpara>
Stop a random node in your cluster to mimic an outage
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopCurrentMasterNode()</literal>
</simpara>
</entry>
<entry>
<simpara>
Stop the current master node to force a new election
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>stopRandomNonMaster()</literal>
</simpara>
</entry>
<entry>
<simpara>
Stop a random non master node to mimic an outage
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>buildNode()</literal>
</simpara>
</entry>
<entry>
<simpara>
Create a new elasticsearch node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>startNode(settings)</literal>
</simpara>
</entry>
<entry>
<simpara>
Create and start a new elasticsearch node
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="changing-node-settings">
<title>Changing node settings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>If you want to ensure a certain configuration for the nodes, which are started as part of the <literal>EsIntegTestCase</literal>, you can override the <literal>nodeSettings()</literal> method</simpara>
<programlisting language="java" linenumbering="unnumbered">public class Mytests extends ESIntegTestCase {

  @Override
  protected Settings nodeSettings(int nodeOrdinal) {
      return Settings.builder().put(super.nodeSettings(nodeOrdinal))
             .put("node.mode", "network")
             .build();
  }

}</programlisting>
</section>
<section id="accessing-clients">
<title>Accessing clients<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>In order to execute any actions, you have to use a client. You can use the <literal>ESIntegTestCase.client()</literal> method to get back a random client. This client can be a <literal>TransportClient</literal> or a <literal>NodeClient</literal> - and usually you do not need to care as long as the action gets executed. There are several more methods for client selection inside of the <literal>InternalTestCluster</literal> class, which can be accessed using the <literal>ESIntegTestCase.internalCluster()</literal> method.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>iterator()</literal>
</simpara>
</entry>
<entry>
<simpara>
An iterator over all available clients
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>masterClient()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a client which is connected to the master node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>nonMasterClient()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a client which is not connected to the master node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>clientNodeClient()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a client, which is running on a client node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>client(String nodeName)</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a client to a given node
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>smartClient()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a smart client
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
</section>
<section id="scoping">
<title>Scoping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>By default the tests are run with unique cluster per test suite. Of course all indices and templates are deleted between each test. However, sometimes you need to start a new cluster for each test - for example, if you load a certain plugin, but you do not want to load it for every test.</simpara>
<simpara>You can use the <literal>@ClusterScope</literal> annotation at class level to configure this behaviour</simpara>
<programlisting language="java" linenumbering="unnumbered">@ClusterScope(scope=TEST, numNodes=1)
public class CustomSuggesterSearchTests extends ESIntegTestCase {
  // ... tests go here
}</programlisting>
<simpara>The above sample configures the test to use a new cluster for each test method. The default scope is <literal>SUITE</literal> (one cluster for all test methods in the test). The <literal>numNodes</literal> settings allows you to only start a certain number of nodes, which can speed up test execution, as starting a new node is a costly and time consuming operation and might not be needed for this test.</simpara>
</section>
<section id="changing-node-configuration">
<title>Changing plugins via configuration<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>As elasticsearch is using JUnit 4, using the <literal>@Before</literal> and <literal>@After</literal> annotations is not a problem. However you should keep in mind, that this does not have any effect in your cluster setup, as the cluster is already up and running when those methods are run. So in case you want to configure settings - like loading a plugin on node startup - before the node is actually running, you should overwrite the <literal>nodePlugins()</literal> method from the <literal>ESIntegTestCase</literal> class and return the plugin classes each node should load.</simpara>
<programlisting language="java" linenumbering="unnumbered">@Override
protected Collection&lt;Class&lt;? extends Plugin&gt;&gt; nodePlugins() {
  return pluginList(CustomSuggesterPlugin.class);
}</programlisting>
</section>
</section>
<section id="randomized-testing">
<title>Randomized testing<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>The code snippets you saw so far did not show any trace of randomized testing features, as they are carefully hidden under the hood. However when you are writing your own tests, you should make use of these features as well. Before starting with that, you should know, how to repeat a failed test with the same setup, how it failed. Luckily this is quite easy, as the whole mvn call is logged together with failed tests, which means you can simply copy and paste that line and run the test.</simpara>
<section id="generating-random-data">
<title>Generating random data<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>The next step is to convert your test using static test data into a test using randomized test data. The kind of data you could randomize varies a lot with the functionality you are testing against. Take a look at the following examples (note, that this list could go on for pages, as a distributed system has many, many moving parts):</simpara>
<itemizedlist>
<listitem>
<simpara>
Searching for data using arbitrary UTF8 signs
</simpara>
</listitem>
<listitem>
<simpara>
Changing your mapping configuration, index and field names with each run
</simpara>
</listitem>
<listitem>
<simpara>
Changing your response sizes/configurable limits with each run
</simpara>
</listitem>
<listitem>
<simpara>
Changing the number of shards/replicas when creating an index
</simpara>
</listitem>
</itemizedlist>
<simpara>So, how can you create random data. The most important thing to know is, that you never should instantiate your own <literal>Random</literal> instance, but use the one provided in the <literal>RandomizedTest</literal>, from which all elasticsearch dependent test classes inherit from.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>getRandom()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns the random instance, which can recreated when calling the test with specific parameters
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomBoolean()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random boolean
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomByte()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random byte
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomShort()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random short
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomInt()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random integer
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomLong()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random long
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomFloat()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random float
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomDouble()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random double
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomInt(max)</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random integer between 0 and max
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>between()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random between the supplied range
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>atLeast()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random integer of at least the specified integer
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>atMost()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random integer of at most the specified integer
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomLocale()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random locale
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomTimeZone()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random timezone
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>randomFrom()</literal>
</simpara>
</entry>
<entry>
<simpara>
Returns a random element from a list/array
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>In addition, there are a couple of helper methods, allowing you to create random ASCII and Unicode strings, see methods beginning with <literal>randomAscii</literal>, <literal>randomUnicode</literal>, and <literal>randomRealisticUnicode</literal> in the random test class. The latter one tries to create more realistic unicode string by not being arbitrary random.</simpara>
<simpara>If you want to debug a specific problem with a specific random seed, you can use the <literal>@Seed</literal> annotation to configure a specific seed for a test. If you want to run a test more than once, instead of starting the whole test suite over and over again, you can use the <literal>@Repeat</literal> annotation with an arbitrary value. Each iteration than gets run with a different seed.</simpara>
</section>
</section>
<section id="assertions">
<title>Assertions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/testing/testing-framework.asciidoc">Edit me</ulink></title>
<simpara>As many elasticsearch tests are checking for a similar output, like the amount of hits or the first hit or special highlighting, a couple of predefined assertions have been created. Those have been put into the <literal>ElasticsearchAssertions</literal> class. There is also a specific geo assertions in <literal>ElasticsearchGeoAssertions</literal>.</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>assertHitCount()</literal>
</simpara>
</entry>
<entry>
<simpara>
Checks hit count of a search or count request
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertAcked()</literal>
</simpara>
</entry>
<entry>
<simpara>
Ensure the a request has been acknowledged by the master
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertSearchHits()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts a search response contains specific ids
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertMatchCount()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts a matching count from a percolation response
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertFirstHit()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts the first hit hits the specified matcher
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertSecondHit()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts the second hit hits the specified matcher
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertThirdHit()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts the third hits hits the specified matcher
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertSearchHit()</literal>
</simpara>
</entry>
<entry>
<simpara>
Assert a certain element in a search response hits the specified matcher
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertNoFailures()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts that no shard failures have occurred in the response
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertFailures()</literal>
</simpara>
</entry>
<entry>
<simpara>
Asserts that shard failures have happened during a search request
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertHighlight()</literal>
</simpara>
</entry>
<entry>
<simpara>
Assert specific highlights matched
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertSuggestion()</literal>
</simpara>
</entry>
<entry>
<simpara>
Assert for specific suggestions
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertSuggestionSize()</literal>
</simpara>
</entry>
<entry>
<simpara>
Assert for specific suggestion count
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>assertThrows()</literal>
</simpara>
</entry>
<entry>
<simpara>
Assert a specific exception has been thrown
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Common matchers</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0"><tgroup cols="2"><colspec colwidth="15*"/><colspec colwidth="85*"/><tbody valign="top">
<row>
<entry>
<simpara>
<literal>hasId()</literal>
</simpara>
</entry>
<entry>
<simpara>
Matcher to check for a search hit id
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>hasType()</literal>
</simpara>
</entry>
<entry>
<simpara>
Matcher to check for a search hit type
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>hasIndex()</literal>
</simpara>
</entry>
<entry>
<simpara>
Matcher to check for a search hit index
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>hasScore()</literal>
</simpara>
</entry>
<entry>
<simpara>
Matcher to check for a certain score of a hit
</simpara>
</entry>
</row>
<row>
<entry>
<simpara>
<literal>hasStatus()</literal>
</simpara>
</entry>
<entry>
<simpara>
Matcher to check for a certain <literal>RestStatus</literal> of a response
</simpara>
</entry>
</row>
</tbody></tgroup></informaltable>
<simpara>Usually, you would combine assertions and matchers in your test like this</simpara>
<programlisting language="java" linenumbering="unnumbered">SearchResponse seearchResponse = client().prepareSearch() ...;
assertHitCount(searchResponse, 4);
assertFirstHit(searchResponse, hasId("4"));
assertSearchHits(searchResponse, "1", "2", "3", "4");</programlisting>
</section>
</chapter>
</part>
<glossary id="glossary">
<title>Glossary of terms<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/glossary.asciidoc">Edit me</ulink></title>
<glossentry>
<glossterm>
<anchor id="glossary-analysis" xreflabel="[glossary-analysis]"/> analysis 
</glossterm>
<glossdef>
<simpara>
  Analysis is the process of converting <link linkend="glossary-text">full text</link> to
  <link linkend="glossary-term">terms</link>. Depending on which analyzer is used, these phrases:
  <literal>FOO BAR</literal>, <literal>Foo-Bar</literal>, <literal>foo,bar</literal> will probably all result in the
  terms <literal>foo</literal> and <literal>bar</literal>. These terms are what is actually stored in
  the index.
 <?asciidoc-br?>
  A full text query (not a <link linkend="glossary-term">term</link> query) for <literal>FoO:bAR</literal> will
  also be analyzed to the terms <literal>foo</literal>,<literal>bar</literal> and will thus match the
  terms stored in the index.
 <?asciidoc-br?>
  It is this process of analysis (both at index time and at search time)
  that allows elasticsearch to perform full text queries.
 <?asciidoc-br?>
  Also see <link linkend="glossary-text">text</link> and <link linkend="glossary-term">term</link>.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-cluster" xreflabel="[glossary-cluster]"/> cluster 
</glossterm>
<glossdef>
<simpara>
  A cluster consists of one or more <link linkend="glossary-node">nodes</link> which share the
  same cluster name. Each cluster has a single master node which is
  chosen automatically by the cluster and which can be replaced if the
  current master node fails.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-document" xreflabel="[glossary-document]"/> document 
</glossterm>
<glossdef>
<simpara>
  A document is a JSON document which is stored in elasticsearch. It is
  like a row in a table in a relational database. Each document is
  stored in an <link linkend="glossary-index">index</link> and has a <link linkend="glossary-type">type</link> and an
  <link linkend="glossary-id">id</link>.
 <?asciidoc-br?>
  A document is a JSON object (also known in other languages as a hash /
  hashmap / associative array) which contains zero or more
  <link linkend="glossary-field">fields</link>, or key-value pairs.
 <?asciidoc-br?>
  The original JSON document that is indexed will be stored in the
  <link linkend="glossary-source_field"><literal>_source</literal> field</link>, which is returned by default when
  getting or searching for a document.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-id" xreflabel="[glossary-id]"/> id 
</glossterm>
<glossdef>
<simpara>
  The ID of a <link linkend="glossary-document">document</link> identifies a document. The
  <literal>index/type/id</literal> of a document must be unique. If no ID is provided,
  then it will be auto-generated. (also see <link linkend="glossary-routing">routing</link>)
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-field" xreflabel="[glossary-field]"/> field 
</glossterm>
<glossdef>
<simpara>
  A <link linkend="glossary-document">document</link> contains a list of fields, or key-value
  pairs. The value can be a simple (scalar) value (eg a string, integer,
  date), or a nested structure like an array or an object. A field is
  similar to a column in a table in a relational database.
 <?asciidoc-br?>
  The <link linkend="glossary-mapping">mapping</link> for each field has a field <emphasis>type</emphasis> (not to
  be confused with document <link linkend="glossary-type">type</link>) which indicates the type
  of data that can be stored in that field, eg <literal>integer</literal>, <literal>string</literal>,
  <literal>object</literal>. The mapping also allows you to define (amongst other things)
  how the value for a field should be analyzed.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-index" xreflabel="[glossary-index]"/> index 
</glossterm>
<glossdef>
<simpara>
  An index is like a <emphasis>database</emphasis> in a relational database. It has a
  <link linkend="glossary-mapping">mapping</link> which defines multiple <link linkend="glossary-type">types</link>.
 <?asciidoc-br?>
  An index is a logical namespace which maps to one or more
  <link linkend="glossary-primary-shard">primary shards</link> and can have zero or more
  <link linkend="glossary-replica-shard">replica shards</link>.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-mapping" xreflabel="[glossary-mapping]"/> mapping 
</glossterm>
<glossdef>
<simpara>
  A mapping is like a <emphasis>schema definition</emphasis> in a relational database. Each
  <link linkend="glossary-index">index</link> has a mapping, which defines each <link linkend="glossary-type">type</link>
  within the index, plus a number of index-wide settings.
 <?asciidoc-br?>
  A mapping can either be defined explicitly, or it will be generated
  automatically when a document is indexed.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-node" xreflabel="[glossary-node]"/> node 
</glossterm>
<glossdef>
<simpara>
  A node is a running instance of elasticsearch which belongs to a
  <link linkend="glossary-cluster">cluster</link>. Multiple nodes can be started on a single
  server for testing purposes, but usually you should have one node per
  server.
 <?asciidoc-br?>
  At startup, a node will use unicast to discover an existing cluster with
  the same cluster name and will try to join that cluster.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-primary-shard" xreflabel="[glossary-primary-shard]"/> primary shard 
</glossterm>
<glossdef>
<simpara>
  Each document is stored in a single primary <link linkend="glossary-shard">shard</link>. When
  you index a document, it is indexed first on the primary shard, then
  on all <link linkend="glossary-replica-shard">replicas</link> of the primary shard.
 <?asciidoc-br?>
  By default, an <link linkend="glossary-index">index</link> has 5 primary shards. You can
  specify fewer or more primary shards to scale the number of
  <link linkend="glossary-document">documents</link> that your index can handle.
 <?asciidoc-br?>
  You cannot change the number of primary shards in an index, once the
  index is created.
 <?asciidoc-br?>
  See also <link linkend="glossary-routing">routing</link>
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-replica-shard" xreflabel="[glossary-replica-shard]"/> replica shard 
</glossterm>
<glossdef>
<simpara>
  Each <link linkend="glossary-primary-shard">primary shard</link> can have zero or more
  replicas. A replica is a copy of the primary shard, and has two
  purposes:
 <?asciidoc-br?>
</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>
increase failover: a replica shard can be promoted to a primary
  shard if the primary fails
</simpara>
</listitem>
<listitem>
<simpara>
increase performance: get and search requests can be handled by
  primary or replica shards.
 <?asciidoc-br?>
  By default, each primary shard has one replica, but the number of
  replicas can be changed dynamically on an existing index. A replica
  shard will never be started on the same node as its primary shard.
</simpara>
</listitem>
</orderedlist>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-routing" xreflabel="[glossary-routing]"/> routing 
</glossterm>
<glossdef>
<simpara>
  When you index a document, it is stored on a single
  <link linkend="glossary-primary-shard">primary shard</link>. That shard is chosen by hashing
  the <literal>routing</literal> value. By default, the <literal>routing</literal> value is derived from
  the ID of the document or, if the document has a specified parent
  document, from the ID of the parent document (to ensure that child and
  parent documents are stored on the same shard).
 <?asciidoc-br?>
  This value can be overridden by specifying a <literal>routing</literal> value at index
  time, or a <link linkend="mapping-routing-field">routing   field</link> in the <link linkend="glossary-mapping">mapping</link>.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-shard" xreflabel="[glossary-shard]"/> shard 
</glossterm>
<glossdef>
<simpara>
  A shard is a single Lucene instance. It is a low-level “worker” unit
  which is managed automatically by elasticsearch. An index is a logical
  namespace which points to <link linkend="glossary-primary-shard">primary</link> and
  <link linkend="glossary-replica-shard">replica</link> shards.
 <?asciidoc-br?>
  Other than defining the number of primary and replica shards that an
  index should have, you never need to refer to shards directly.
  Instead, your code should deal only with an index.
 <?asciidoc-br?>
  Elasticsearch distributes shards amongst all <link linkend="glossary-node">nodes</link> in the
  <link linkend="glossary-cluster">cluster</link>, and can move shards automatically from one
  node to another in the case of node failure, or the addition of new
  nodes.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-source_field" xreflabel="[glossary-source_field]"/> source field 
</glossterm>
<glossdef>
<simpara>
  By default, the JSON document that you index will be stored in the
  <literal>_source</literal> field and will be returned by all get and search requests.
  This allows you access to the original object directly from search
  results, rather than requiring a second step to retrieve the object
  from an ID.
 <?asciidoc-br?>
  Note: the exact JSON string that you indexed will be returned to you,
  even if it contains invalid JSON. The contents of this field do not
  indicate anything about how the data in the object has been indexed.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-term" xreflabel="[glossary-term]"/> term 
</glossterm>
<glossdef>
<simpara>
  A term is an exact value that is indexed in elasticsearch. The terms
  <literal>foo</literal>, <literal>Foo</literal>, <literal>FOO</literal> are NOT equivalent. Terms (i.e. exact values) can
  be searched for using <emphasis>term</emphasis> queries.<?asciidoc-br?>
   See also <link linkend="glossary-text">text</link> and <link linkend="glossary-analysis">analysis</link>.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-text" xreflabel="[glossary-text]"/> text 
</glossterm>
<glossdef>
<simpara>
  Text (or full text) is ordinary unstructured text, such as this
  paragraph. By default, text will be <link linkend="glossary-analysis">analyzed</link> into
  <link linkend="glossary-term">terms</link>, which is what is actually stored in the index.
 <?asciidoc-br?>
  Text <link linkend="glossary-field">fields</link> need to be analyzed at index time in order to
  be searchable as full text, and keywords in full text queries must be
  analyzed at search time to produce (and search for) the same terms
  that were generated at index time.
 <?asciidoc-br?>
  See also <link linkend="glossary-term">term</link> and <link linkend="glossary-analysis">analysis</link>.
</simpara>
</glossdef>
</glossentry>
<glossentry>
<glossterm>
<anchor id="glossary-type" xreflabel="[glossary-type]"/> type 
</glossterm>
<glossdef>
<simpara>
  A type is like a <emphasis>table</emphasis> in a relational database. Each type has a
  list of <link linkend="glossary-field">fields</link> that can be specified for
  <link linkend="glossary-document">documents</link> of that type. The <link linkend="glossary-mapping">mapping</link>
  defines how each field in the document is analyzed.
</simpara>
</glossdef>
</glossentry>
</glossary>
<part id="es-release-notes">
<title>Release Notes <ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes.asciidoc">Edit me</ulink></title>
<partintro>
<simpara>This section summarizes the changes in each release.</simpara>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="release-notes-2.4.2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.4.1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.4.0"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.5"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.4"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.3"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.3.0"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.2.2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.2.1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.2.0"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.1.2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.1.1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.1.0"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.0"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.0-rc1"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.0-beta2"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="release-notes-2.0.0-beta1"/>
</simpara>
</listitem>
</itemizedlist>
</partintro>
<chapter id="release-notes-2.4.2">
<title>2.4.2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.2.asciidoc">Edit me</ulink></title>
<bridgehead id="enhancement-2.4.2" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rescorer should be applied in the TopHits aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/20978">#20978</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19317">#19317</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not cache term queries. <ulink url="https://github.com/elastic/elasticsearch/pull/21566">#21566</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16031">#16031</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/20116">#20116</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Skip shard management code when updating cluster state on client/tribe nodes <ulink url="https://github.com/elastic/elasticsearch/pull/20731">#20731</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
ShardActiveResponseHandler shouldn&#8217;t hold to an entire cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/21470">#21470</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21394">#21394</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log about deprecated position_increment_gap setting on non-analyzed fields <ulink url="https://github.com/elastic/elasticsearch/pull/20810">#20810</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/20413">#20413</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/20806">#20806</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.4.2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
MultiGet should not fail entirely if alias resolves to many indices <ulink url="https://github.com/elastic/elasticsearch/pull/20858">#20858</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20845">#20845</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed date math expression support in multi get requests. <ulink url="https://github.com/elastic/elasticsearch/pull/20659">#20659</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17957">#17957</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove cluster update task when task times out <ulink url="https://github.com/elastic/elasticsearch/pull/21578">#21578</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21568">#21568</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reenable shard management on IndicesClusterStateService <ulink url="https://github.com/elastic/elasticsearch/pull/20741">#20741</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Binary fields indexed into an upgraded (from 1.x &#8594; 2.x) index hit "Compressor detection can only be called on some xcontent bytes or compressed xcontent bytes" exception <ulink url="https://github.com/elastic/elasticsearch/pull/21440">#21440</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11280">#11280</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Protect BytesStreamOutput against overflows of the current number of written bytes. <ulink url="https://github.com/elastic/elasticsearch/pull/21174">#21174</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21159">#21159</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
StoreStatsCache should also ignore AccessDeniedException when checking file size <ulink url="https://github.com/elastic/elasticsearch/pull/20790">#20790</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17580">#17580</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only negate index expression on all indices with preceding wildcard <ulink url="https://github.com/elastic/elasticsearch/pull/20898">#20898</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/19800">#19800</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/20033">#20033</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Null checked for source when calling sourceRef <ulink url="https://github.com/elastic/elasticsearch/pull/21431">#21431</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19279">#19279</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix logger when you can not create an azure storage client <ulink url="https://github.com/elastic/elasticsearch/pull/20669">#20669</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20633">#20633</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NPE when parsing InnerHits with highlight query <ulink url="https://github.com/elastic/elasticsearch/pull/21065">#21065</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21061">#21061</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Stricter parsing of multi_match "query" parameter <ulink url="https://github.com/elastic/elasticsearch/pull/20884">#20884</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20785">#20785</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix match_phrase_prefix query with single term on _all field <ulink url="https://github.com/elastic/elasticsearch/pull/20471">#20471</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20470">#20470</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
The routing query string param is supported by mget but was missing from the rest spec <ulink url="https://github.com/elastic/elasticsearch/pull/21357">#21357</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Read indices options in indices upgrade API <ulink url="https://github.com/elastic/elasticsearch/pull/21281">#21281</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21099">#21099</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Max score should be updated when a rescorer is used <ulink url="https://github.com/elastic/elasticsearch/pull/20977">#20977</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20651">#20651</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make range queries round up upper bounds again. <ulink url="https://github.com/elastic/elasticsearch/pull/20582">#20582</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/20579">#20579</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8889">#8889</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.4.2" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update Joda Time to version 2.9.5 on branch 2.4 <ulink url="https://github.com/elastic/elasticsearch/pull/21533">#21533</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/21468">#21468</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.4.1">
<title>2.4.1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.1.asciidoc">Edit me</ulink></title>
<bridgehead id="enhancement-2.4.1" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Change DiskThresholdDecider&#8217;s behavior when factoring in leaving shards <ulink url="https://github.com/elastic/elasticsearch/pull/20349">#20349</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add clusterUUID to RestMainAction output <ulink url="https://github.com/elastic/elasticsearch/pull/20507">#20507</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20503">#20503</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.4.1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Guard against negative result from FileStore.getUsableSpace when pick… <ulink url="https://github.com/elastic/elasticsearch/pull/20527">#20527</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19554">#19554</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
skip GeoPointMultiTermQuery when highlighting <ulink url="https://github.com/elastic/elasticsearch/pull/20412">#20412</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17537">#17537</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix highlighting of MultiTermQuery within a FunctionScoreQuery <ulink url="https://github.com/elastic/elasticsearch/pull/20400">#20400</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20392">#20392</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix IndexNotFoundException in multi index search request. <ulink url="https://github.com/elastic/elasticsearch/pull/20188">#20188</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3839">#3839</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t fail replica if FlushNotAllowedEngineException is thrown <ulink url="https://github.com/elastic/elasticsearch/pull/20632">#20632</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/20569">#20569</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/20597">#20597</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t send exception responses twice <ulink url="https://github.com/elastic/elasticsearch/pull/20585">#20585</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Windows GC options <ulink url="https://github.com/elastic/elasticsearch/pull/20620">#20620</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20558">#20558</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fail parsing when match query contains an array of terms <ulink url="https://github.com/elastic/elasticsearch/pull/20445">#20445</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15741">#15741</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Correct the description for refresh <ulink url="https://github.com/elastic/elasticsearch/pull/20200">#20200</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make reindex tests a little less flaky <ulink url="https://github.com/elastic/elasticsearch/pull/20258">#20258</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Native scripts should be created once per index, not per segment. <ulink url="https://github.com/elastic/elasticsearch/pull/20609">#20609</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Validate max thread/merge settings <ulink url="https://github.com/elastic/elasticsearch/pull/20383">#20383</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20380">#20380</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.4.0">
<title>2.4.0 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></title>
<bridgehead id="breaking-2.4.0" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Single comma-delimited response header for multiple values <ulink url="https://github.com/elastic/elasticsearch/pull/19872">#19872</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19841">#19841</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.4.0" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate optimize_bbox on geodistance queries <ulink url="https://github.com/elastic/elasticsearch/pull/20032">#20032</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20014">#20014</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate geohash parameters for geo_point parser <ulink url="https://github.com/elastic/elasticsearch/pull/20030">#20030</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20009">#20009</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add deprecation logging for <literal>_timestamp</literal> and <literal>_ttl</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/19031">#19031</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18980">#18980</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate soon-to-be-unsupported queries. <ulink url="https://github.com/elastic/elasticsearch/pull/18376">#18376</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18276">#18276</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate camelCase usages <ulink url="https://github.com/elastic/elasticsearch/pull/17800">#17800</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8988">#8988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate sort option reverse. <ulink url="https://github.com/elastic/elasticsearch/pull/17378">#17378</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17047">#17047</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate bootstrap.mlockall <ulink url="https://github.com/elastic/elasticsearch/pull/18671">#18671</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18669">#18669</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate camelCase settings magic <ulink url="https://github.com/elastic/elasticsearch/pull/17875">#17875</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8988">#8988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adds deprecation notices on removed BlobContainer methods <ulink url="https://github.com/elastic/elasticsearch/pull/19729">#19729</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/18813">#18813</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/19727">#19727</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="feature-2.4.0" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add CONTAINS relation to geo_shape query <ulink url="https://github.com/elastic/elasticsearch/pull/14810">#14810</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14713">#14713</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/17866">#17866</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for path_style_access <ulink url="https://github.com/elastic/elasticsearch/pull/19497">#19497</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15114">#15114</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backport: Reindex&#8217;s throttling <ulink url="https://github.com/elastic/elasticsearch/pull/18020">#18020</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.4.0" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Circuit Breakers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Limit request size <ulink url="https://github.com/elastic/elasticsearch/pull/17133">#17133</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16011">#16011</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Batch process node left and node failure 2.x <ulink url="https://github.com/elastic/elasticsearch/pull/19362">#19362</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/19282">#19282</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/19289">#19289</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve performance of applyDeletedShards <ulink url="https://github.com/elastic/elasticsearch/pull/18788">#18788</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18776">#18776</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sliced lock contention 2.x <ulink url="https://github.com/elastic/elasticsearch/pull/18067">#18067</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16872">#16872</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18053">#18053</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18060">#18060</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Kill thread local leak <ulink url="https://github.com/elastic/elasticsearch/pull/17921">#17921</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/283">#283</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/630">#630</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove hostname from NetworkAddress.format (2.x) <ulink url="https://github.com/elastic/elasticsearch/pull/17606">#17606</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/17601">#17601</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/17604">#17604</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve TimeUnitRounding for edge cases and DST transitions <ulink url="https://github.com/elastic/elasticsearch/pull/18589">#18589</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Turn RestChannel into an interface <ulink url="https://github.com/elastic/elasticsearch/pull/17643">#17643</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17133">#17133</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Require executor name when calling scheduleWithFixedDelay <ulink url="https://github.com/elastic/elasticsearch/pull/17538">#17538</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Implement available for all StreamInput classes <ulink url="https://github.com/elastic/elasticsearch/pull/17218">#17218</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add created flag to IndexingOperationListener#postIndex <ulink url="https://github.com/elastic/elasticsearch/pull/17340">#17340</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17333">#17333</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add shardId and node name in search slow log <ulink url="https://github.com/elastic/elasticsearch/pull/19949">#19949</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19735">#19735</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mappings: Allow to force dots in field names <ulink url="https://github.com/elastic/elasticsearch/pull/19937">#19937</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Exclude admin / diagnostic requests from HTTP request limiting <ulink url="https://github.com/elastic/elasticsearch/pull/18833">#18833</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/17951">#17951</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18145">#18145</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Netty request/response tracer should wait for send <ulink url="https://github.com/elastic/elasticsearch/pull/18500">#18500</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Exclude specific transport actions from request size limit check <ulink url="https://github.com/elastic/elasticsearch/pull/17951">#17951</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Provide better error message when an incompatible node connects to a node <ulink url="https://github.com/elastic/elasticsearch/pull/17182">#17182</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17090">#17090</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Increase default max open files to 65536 <ulink url="https://github.com/elastic/elasticsearch/pull/18041">#18041</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18040">#18040</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow configuring Windows service name, description and user <ulink url="https://github.com/elastic/elasticsearch/pull/17312">#17312</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow adding additional child types that point to an existing parent type <ulink url="https://github.com/elastic/elasticsearch/pull/18446">#18446</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17956">#17956</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fixed QueryParsingException in multi match query <ulink url="https://github.com/elastic/elasticsearch/pull/19564">#19564</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13405">#13405</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16098">#16098</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
CORS handling triggered whether User-Agent is a browser or not <ulink url="https://github.com/elastic/elasticsearch/pull/18283">#18283</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Switch default batch size for reindex to 1000 <ulink url="https://github.com/elastic/elasticsearch/pull/18340">#18340</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mustache: Add util functions to render JSON and join array values <ulink url="https://github.com/elastic/elasticsearch/pull/19153">#19153</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18856">#18856</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Compile each Groovy script in its own classloader <ulink url="https://github.com/elastic/elasticsearch/pull/18975">#18975</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18918">#18918</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.4.0" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix potential AssertionError with include/exclude on terms aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/19252">#19252</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18575">#18575</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pass resolved extended bounds to unmapped histogram aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/19085">#19085</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19009">#19009</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix "key_as_string" for date histogram and epoch_millis/epoch_second format with time zone <ulink url="https://github.com/elastic/elasticsearch/pull/19043">#19043</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19038">#19038</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix TimeUnitRounding for hour, minute and second units <ulink url="https://github.com/elastic/elasticsearch/pull/18415">#18415</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18326">#18326</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds serialisation of sigma to extended_stats_bucket pipeline aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/17703">#17703</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17701">#17701</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ExtendedStatsAggregator should also pass sigma to emtpy aggs. <ulink url="https://github.com/elastic/elasticsearch/pull/17388">#17388</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17362">#17362</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevents exception being raised when ordering by an aggregation which wasn&#8217;t collected <ulink url="https://github.com/elastic/elasticsearch/pull/17379">#17379</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17225">#17225</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Setting <emphasis>other</emphasis> bucket on empty aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/17264">#17264</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16546">#16546</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rebalancing policy shouldn&#8217;t prevent hard allocation decisions <ulink url="https://github.com/elastic/elasticsearch/pull/17698">#17698</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14057">#14057</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14259">#14259</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>Character.MODIFIER_SYMBOL</literal> to the list of symbol categories. <ulink url="https://github.com/elastic/elasticsearch/pull/18402">#18402</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18388">#18388</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Copy headers and context to individual requests inside a bulk <ulink url="https://github.com/elastic/elasticsearch/pull/18816">#18816</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix merge stats rendering in RestIndicesAction <ulink url="https://github.com/elastic/elasticsearch/pull/18720">#18720</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expand wildcards to closed indices in <literal>/_cat/indices</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/18545">#18545</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16419">#16419</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/17395">#17395</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix column aliases in <literal>_cat/indices</literal>, <literal>_cat/nodes</literal> and <literal>_cat/shards</literal> APIs <ulink url="https://github.com/elastic/elasticsearch/pull/17145">#17145</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17101">#17101</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent TransportReplicationAction to route request based on stale local routing table <ulink url="https://github.com/elastic/elasticsearch/pull/19296">#19296</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16274">#16274</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/19187">#19187</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix block checks when no indices are specified <ulink url="https://github.com/elastic/elasticsearch/pull/19047">#19047</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8105">#8105</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cluster stats: fix memory available that is always set to 0 <ulink url="https://github.com/elastic/elasticsearch/pull/17328">#17328</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17278">#17278</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw exception if using a closed transport client <ulink url="https://github.com/elastic/elasticsearch/pull/18722">#18722</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18708">#18708</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix misplaced cast when parsing seconds <ulink url="https://github.com/elastic/elasticsearch/pull/18548">#18548</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18546">#18546</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t try to compute completion stats on a reader after we already closed it <ulink url="https://github.com/elastic/elasticsearch/pull/18094">#18094</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make sure TimeIntervalRounding is monotonic for increasing dates <ulink url="https://github.com/elastic/elasticsearch/pull/19020">#19020</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix invalid rounding value for TimeIntervalRounding close to DST transitions <ulink url="https://github.com/elastic/elasticsearch/pull/18800">#18800</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix problem with TimeIntervalRounding on DST end <ulink url="https://github.com/elastic/elasticsearch/pull/18780">#18780</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Plain highlighter should ignore parent/child queries <ulink url="https://github.com/elastic/elasticsearch/pull/19616">#19616</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14999">#14999</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Let fast vector highlighter also extract terms from the nested query&#8217;s inner query. <ulink url="https://github.com/elastic/elasticsearch/pull/19337">#19337</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19265">#19265</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Skip all geo point queries in plain highlighter <ulink url="https://github.com/elastic/elasticsearch/pull/18495">#18495</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17537">#17537</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Exclude all but string fields from highlighting if wildcards are used… <ulink url="https://github.com/elastic/elasticsearch/pull/18183">#18183</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17537">#17537</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Indexed Scripts/Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t ignore custom sharding settings in create index request for <literal>.scripts</literal> index <ulink url="https://github.com/elastic/elasticsearch/pull/18965">#18965</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18912">#18912</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix filtering of node ids for TransportNodesAction <ulink url="https://github.com/elastic/elasticsearch/pull/18634">#18634</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18618">#18618</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add missing index name to search slow log. <ulink url="https://github.com/elastic/elasticsearch/pull/17818">#17818</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17025">#17025</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mapping updates on objects should propagate <literal>include_an_all</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/20051">#20051</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mappings: Fix detection of metadata fields in documents <ulink url="https://github.com/elastic/elasticsearch/pull/19765">#19765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix not_analyzed string fields to error when position_increment_gap is set <ulink url="https://github.com/elastic/elasticsearch/pull/19510">#19510</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Automatically created indices should honor <literal>index.mapper.dynamic</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/19478">#19478</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17592">#17592</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Process dynamic templates in order. <ulink url="https://github.com/elastic/elasticsearch/pull/18638">#18638</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/18625">#18625</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2401">#2401</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix cross type mapping updates for <literal>boolean</literal> fields. <ulink url="https://github.com/elastic/elasticsearch/pull/17882">#17882</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/17879">#17879</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18740">#18740</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail if an object is added after a field with the same name. <ulink url="https://github.com/elastic/elasticsearch/pull/17568">#17568</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17567">#17567</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
RESTART_ON_UPGRADE incorrectly named ES_RESTART_ON_UPGRADE in sysconfig <ulink url="https://github.com/elastic/elasticsearch/pull/19976">#19976</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19950">#19950</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Set the SC and QPC type always to <literal>.percolator</literal> in percolate api <ulink url="https://github.com/elastic/elasticsearch/pull/19210">#19210</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19130">#19130</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed NPE when percolator filter option is "empty". <ulink url="https://github.com/elastic/elasticsearch/pull/18563">#18563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6172">#6172</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Analysis Kuromoji
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prebuild Japanese Stop Words Token Filter <ulink url="https://github.com/elastic/elasticsearch/pull/19816">#19816</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19814">#19814</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Support specific key/secret for EC2 <ulink url="https://github.com/elastic/elasticsearch/pull/19513">#19513</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12978">#12978</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/19445">#19445</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing permission for S3 repository <ulink url="https://github.com/elastic/elasticsearch/pull/19121">#19121</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18539">#18539</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make discovery-azure work again on 2.4 branch <ulink url="https://github.com/elastic/elasticsearch/pull/19116">#19116</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/18637">#18637</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/19062">#19062</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix remove of azure files <ulink url="https://github.com/elastic/elasticsearch/pull/18571">#18571</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16472">#16472</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18436">#18436</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18451">#18451</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NPE when GCE region is empty <ulink url="https://github.com/elastic/elasticsearch/pull/19175">#19175</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16967">#16967</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make parsing of bool queries stricter <ulink url="https://github.com/elastic/elasticsearch/pull/19052">#19052</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/19034">#19034</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NullPointerException in SimpleQueryParser when analyzing text produces a null query <ulink url="https://github.com/elastic/elasticsearch/pull/18243">#18243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18202">#18202</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Apply the default operator on analyzed wildcard in simple_query_string builder <ulink url="https://github.com/elastic/elasticsearch/pull/17776">#17776</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Apply the default operator on analyzed wildcard in query_string builder: <ulink url="https://github.com/elastic/elasticsearch/pull/17711">#17711</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2183">#2183</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not decode path when sending error <ulink url="https://github.com/elastic/elasticsearch/pull/18477">#18477</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18476">#18476</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
CORS should permit same origin requests <ulink url="https://github.com/elastic/elasticsearch/pull/18278">#18278</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18256">#18256</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow CORS requests to work with HTTP compression enabled <ulink url="https://github.com/elastic/elasticsearch/pull/18101">#18101</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/18066">#18066</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18089">#18089</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes reading of CORS pre-flight headers and methods <ulink url="https://github.com/elastic/elasticsearch/pull/17525">#17525</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17523">#17523</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix OOM in AbstractXContentParser <ulink url="https://github.com/elastic/elasticsearch/pull/15350">#15350</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15338">#15338</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backports Notify GatewayRecoveryListener on failure <ulink url="https://github.com/elastic/elasticsearch/pull/17805">#17805</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make reindex and lang-javascript compatible <ulink url="https://github.com/elastic/elasticsearch/pull/19933">#19933</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
AllTermQuery must implement equals/hashCode. <ulink url="https://github.com/elastic/elasticsearch/pull/20196">#20196</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20161">#20161</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add ref-counting to SearchContext to prevent accessing already closed readers <ulink url="https://github.com/elastic/elasticsearch/pull/20095">#20095</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/20008">#20008</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>_only_nodes</literal> preferences <ulink url="https://github.com/elastic/elasticsearch/pull/18483">#18483</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12546">#12546</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12700">#12700</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Speed up named queries. <ulink url="https://github.com/elastic/elasticsearch/pull/18470">#18470</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle <literal>indices=["_all"]</literal> when restoring a snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/18025">#18025</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
On restore, selecting concrete indices can select wrong index <ulink url="https://github.com/elastic/elasticsearch/pull/17715">#17715</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix sync flush total shards statistics <ulink url="https://github.com/elastic/elasticsearch/pull/18766">#18766</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Translog can delete valid .ckp file when views are closed after the translog <ulink url="https://github.com/elastic/elasticsearch/pull/19035">#19035</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16495">#16495</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Call ensureOpen on Translog#newView() to prevent IllegalStateException <ulink url="https://github.com/elastic/elasticsearch/pull/17191">#17191</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.4.0" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.4.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update jackson to version 2.8.1 (on 2.4 branch) <ulink url="https://github.com/elastic/elasticsearch/pull/20011">#20011</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18939">#18939</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade lucene to 5.5.2 <ulink url="https://github.com/elastic/elasticsearch/pull/19496">#19496</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade joda-time to 2.9.4 <ulink url="https://github.com/elastic/elasticsearch/pull/18609">#18609</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14524">#14524</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18017">#18017</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update Jackson 2.6.2 &#8594; 2.6.6 (latest and final 2.6 patch) <ulink url="https://github.com/elastic/elasticsearch/pull/18052">#18052</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to netty 3.10.6.Final <ulink url="https://github.com/elastic/elasticsearch/pull/19235">#19235</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update aws sdk to 1.10.69 and add throttle_retries repository setting <ulink url="https://github.com/elastic/elasticsearch/pull/18048">#18048</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/17784">#17784</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/538">#538</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/586">#586</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/589">#589</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.3.5">
<title>2.3.5 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.5.asciidoc">Edit me</ulink></title>
<simpara>There are no changes in Elasticsearch 2.3.5 except for the version bump.  This
is a compatibility release for bug fixes in Marvel, Watcher, and Shield.</simpara>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
</chapter>
<chapter id="release-notes-2.3.4">
<title>2.3.4 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.4.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
<bridgehead id="bug-2.3.4" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.4.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Copy headers and context to individual requests inside a bulk <ulink url="https://github.com/elastic/elasticsearch/pull/18816">#18816</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix merge stats rendering in RestIndicesAction <ulink url="https://github.com/elastic/elasticsearch/pull/18720">#18720</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expand wildcards to closed indices in /_cat/indices <ulink url="https://github.com/elastic/elasticsearch/pull/18545">#18545</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16419">#16419</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/17395">#17395</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix block checks when no indices are specified <ulink url="https://github.com/elastic/elasticsearch/pull/19047">#19047</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8105">#8105</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix misplaced cast when parsing seconds <ulink url="https://github.com/elastic/elasticsearch/pull/18548">#18548</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18546">#18546</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Skip all geo point queries in plain highlighter <ulink url="https://github.com/elastic/elasticsearch/pull/18495">#18495</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17537">#17537</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix filtering of node ids for TransportNodesAction <ulink url="https://github.com/elastic/elasticsearch/pull/18634">#18634</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18618">#18618</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fixed NPE when percolator filter option is "empty". <ulink url="https://github.com/elastic/elasticsearch/pull/18563">#18563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6172">#6172</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not decode path when sending error <ulink url="https://github.com/elastic/elasticsearch/pull/18477">#18477</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18476">#18476</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Translog can delete valid .ckp file when views are closed after the translog <ulink url="https://github.com/elastic/elasticsearch/pull/19035">#19035</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16495">#16495</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.3.4" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.4.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade joda-time to 2.9.4 <ulink url="https://github.com/elastic/elasticsearch/pull/18609">#18609</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14524">#14524</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18017">#18017</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.3.3">
<title>2.3.3 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.3.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
<bridgehead id="feature-2.3.3" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.3.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add CONTAINS relation to geo_shape query <ulink url="https://github.com/elastic/elasticsearch/pull/14810">#14810</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14713">#14713</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/17866">#17866</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.3.3" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.3.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Kill thread local leak <ulink url="https://github.com/elastic/elasticsearch/pull/17921">#17921</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/283">#283</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/630">#630</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
CORS handling triggered whether User-Agent is a browser or not <ulink url="https://github.com/elastic/elasticsearch/pull/18283">#18283</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.3.3" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.3.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t try to compute completion stats on a reader after we already closed it <ulink url="https://github.com/elastic/elasticsearch/pull/18094">#18094</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Exclude all but string fields from highlighting if wildcards are used… <ulink url="https://github.com/elastic/elasticsearch/pull/18183">#18183</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17537">#17537</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NullPointerException in SimpleQueryParser when analyzing text produces a null query <ulink url="https://github.com/elastic/elasticsearch/pull/18243">#18243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18202">#18202</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
CORS should permit same origin requests <ulink url="https://github.com/elastic/elasticsearch/pull/18278">#18278</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18256">#18256</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow CORS requests to work with HTTP compression enabled <ulink url="https://github.com/elastic/elasticsearch/pull/18101">#18101</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/18066">#18066</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/18089">#18089</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.3.3" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.3.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update Jackson 2.6.2 &#8594; 2.6.6 (latest and final 2.6 patch) <ulink url="https://github.com/elastic/elasticsearch/pull/18052">#18052</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.3.2">
<title>2.3.2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.2.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
<bridgehead id="deprecation-2.3.2" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate camelCase usages <ulink url="https://github.com/elastic/elasticsearch/pull/17800">#17800</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8988">#8988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate sort option reverse. <ulink url="https://github.com/elastic/elasticsearch/pull/17378">#17378</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17047">#17047</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate camelCase settings magic <ulink url="https://github.com/elastic/elasticsearch/pull/17875">#17875</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8988">#8988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.3.2" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Analyze API : Fix/deprecated filters in analyze in 2x <ulink url="https://github.com/elastic/elasticsearch/pull/17844">#17844</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15189">#15189</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.3.2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Aggregations: Adds serialisation of sigma to extended_stats_bucket pipeline aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/17703">#17703</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17701">#17701</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ExtendedStatsAggregator should also pass sigma to emtpy aggs. <ulink url="https://github.com/elastic/elasticsearch/pull/17388">#17388</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17362">#17362</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rebalancing policy shouldn&#8217;t prevent hard allocation decisions <ulink url="https://github.com/elastic/elasticsearch/pull/17698">#17698</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14057">#14057</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14259">#14259</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
When considering the size of shadow replica shards, set size to 0 <ulink url="https://github.com/elastic/elasticsearch/pull/17509">#17509</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17460">#17460</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add missing index name to search slow log. <ulink url="https://github.com/elastic/elasticsearch/pull/17818">#17818</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17025">#17025</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fail if an object is added after a field with the same name. <ulink url="https://github.com/elastic/elasticsearch/pull/17568">#17568</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17567">#17567</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
More Like This
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Alias items are not ignored anymore <ulink url="https://github.com/elastic/elasticsearch/pull/17204">#17204</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14944">#14944</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fixes reading of CORS pre-flight headers and methods <ulink url="https://github.com/elastic/elasticsearch/pull/17524">#17524</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17523">#17523</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
index is a required url part for update by query <ulink url="https://github.com/elastic/elasticsearch/pull/17503">#17503</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backports Notify GatewayRecoveryListener on failure <ulink url="https://github.com/elastic/elasticsearch/pull/17805">#17805</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
On restore, selecting concrete indices can select wrong index <ulink url="https://github.com/elastic/elasticsearch/pull/17715">#17715</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.3.1">
<title>2.3.1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.1.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
<bridgehead id="bug-2.3.1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevents exception being raised when ordering by an aggregation which wasn&#8217;t collected <ulink url="https://github.com/elastic/elasticsearch/pull/17379">#17379</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17225">#17225</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cluster stats: fix memory available that is always set to 0 <ulink url="https://github.com/elastic/elasticsearch/pull/17328">#17328</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17278">#17278</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.3.0">
<title>2.3.0 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.3"/>.</simpara>
<bridgehead id="breaking-2.3.0" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Speed up shard balancer by reusing shard model while moving shards that can no longer be allocated to a node <ulink url="https://github.com/elastic/elasticsearch/pull/16926">#16926</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add per-index setting to limit number of nested fields <ulink url="https://github.com/elastic/elasticsearch/pull/15989">#15989</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14983">#14983</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.3.0" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate lat_lon and precision_step <ulink url="https://github.com/elastic/elasticsearch/pull/17018">#17018</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate geo_point mapping params <ulink url="https://github.com/elastic/elasticsearch/pull/17015">#17015</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery Multicast
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate Discovery Multicast Plugin <ulink url="https://github.com/elastic/elasticsearch/pull/16949">#16949</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add deprecation logging for deprecated queries. <ulink url="https://github.com/elastic/elasticsearch/pull/16901">#16901</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16885">#16885</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="feature-2.3.0" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backport reindex to 2.x <ulink url="https://github.com/elastic/elasticsearch/pull/17060">#17060</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Task Manager
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backport of task management api to 2x <ulink url="https://github.com/elastic/elasticsearch/pull/16959">#16959</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.3.0" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Skip capturing least/most FS info for an FS with no total <ulink url="https://github.com/elastic/elasticsearch/pull/16001">#16001</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15919">#15919</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Speed improvements for BalancedShardsAllocator <ulink url="https://github.com/elastic/elasticsearch/pull/15678">#15678</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6372">#6372</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make TermsQuery considered costly. <ulink url="https://github.com/elastic/elasticsearch/pull/16851">#16851</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Shard state action request logging <ulink url="https://github.com/elastic/elasticsearch/pull/16396">#16396</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Safe cluster state task notifications <ulink url="https://github.com/elastic/elasticsearch/pull/15777">#15777</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove log4j exception hiding <ulink url="https://github.com/elastic/elasticsearch/pull/16834">#16834</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Avoid cloning MessageDigest instances <ulink url="https://github.com/elastic/elasticsearch/pull/16479">#16479</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a hard check to ensure we are running with the expected lucene version <ulink url="https://github.com/elastic/elasticsearch/pull/16305">#16305</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16301">#16301</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Added file name to exceptions when failing to read index state <ulink url="https://github.com/elastic/elasticsearch/pull/16850">#16850</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16713">#16713</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add Exception class name to message in <literal>NotSerializableExceptionWrapper</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/16325">#16325</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade GeoPointField to use Lucene 5.5 PrefixEncoding <ulink url="https://github.com/elastic/elasticsearch/pull/16482">#16482</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cleanup search sub transport actions and collapse o.e.action.search.type package into o.e.action.search <ulink url="https://github.com/elastic/elasticsearch/pull/16758">#16758</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11710">#11710</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
TransportClient: Add exception when using plugin.types, to help migration to addPlugin <ulink url="https://github.com/elastic/elasticsearch/pull/15943">#15943</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15693">#15693</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log suppressed stack traces under DEBUG <ulink url="https://github.com/elastic/elasticsearch/pull/16627">#16627</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12991">#12991</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15329">#15329</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16622">#16622</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add deprecation logging for mapping transform <ulink url="https://github.com/elastic/elasticsearch/pull/16952">#16952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose the reason why a mapping merge is issued. <ulink url="https://github.com/elastic/elasticsearch/pull/16059">#16059</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15989">#15989</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add sub-fields support to <literal>bool</literal> fields. <ulink url="https://github.com/elastic/elasticsearch/pull/15636">#15636</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6587">#6587</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve cross-type dynamic mapping updates. <ulink url="https://github.com/elastic/elasticsearch/pull/15633">#15633</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15568">#15568</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make mapping updates more robust. <ulink url="https://github.com/elastic/elasticsearch/pull/15539">#15539</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add additional fallback to http.publish_port and restrict fallback to transport.publish_port <ulink url="https://github.com/elastic/elasticsearch/pull/16626">#16626</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14535">#14535</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Windows service: Use JAVA_HOME environment variable in registry <ulink url="https://github.com/elastic/elasticsearch/pull/16552">#16552</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13521">#13521</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Default standard output to the journal in systemd <ulink url="https://github.com/elastic/elasticsearch/pull/16159">#16159</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/15315">#15315</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16134">#16134</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use egrep instead of grep -E for Solaris <ulink url="https://github.com/elastic/elasticsearch/pull/15755">#15755</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15628">#15628</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add timeout settings (default to 5 minutes) <ulink url="https://github.com/elastic/elasticsearch/pull/15950">#15950</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14277">#14277</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15080">#15080</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery EC2
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add ap-northeast-2 (seoul) endpoints for EC2 discovery and S3 snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/16167">#16167</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16166">#16166</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Mapper Attachment
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix attachments plugins with docx <ulink url="https://github.com/elastic/elasticsearch/pull/17059">#17059</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16864">#16864</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
More robust handling of CORS HTTP Access Control <ulink url="https://github.com/elastic/elasticsearch/pull/16436">#16436</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Implement helpful interfaces in reindex requests <ulink url="https://github.com/elastic/elasticsearch/pull/17032">#17032</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reindex should timeout if sub-requests timeout <ulink url="https://github.com/elastic/elasticsearch/pull/16962">#16962</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Teach reindex to retry on rejection <ulink url="https://github.com/elastic/elasticsearch/pull/16556">#16556</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16093">#16093</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Logs old script params use to the Deprecation Logger <ulink url="https://github.com/elastic/elasticsearch/pull/16950">#16950</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove suppressAccessChecks permission for Groovy script plugin <ulink url="https://github.com/elastic/elasticsearch/pull/16839">#16839</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16527">#16527</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Class permission for Groovy references <ulink url="https://github.com/elastic/elasticsearch/pull/16660">#16660</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16657">#16657</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Scripting: Allow to get size of array in mustache <ulink url="https://github.com/elastic/elasticsearch/pull/16193">#16193</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added plumbing for compile time script parameters <ulink url="https://github.com/elastic/elasticsearch/pull/16163">#16163</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15464">#15464</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enhancements to the mustache script engine <ulink url="https://github.com/elastic/elasticsearch/pull/15661">#15661</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add deprecation logging for ignore_unmapped parameter <ulink url="https://github.com/elastic/elasticsearch/pull/17002">#17002</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16573">#16573</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add deprecation logging when users use the SCAN search type. <ulink url="https://github.com/elastic/elasticsearch/pull/16980">#16980</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16910">#16910</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log warning if max file descriptors too low <ulink url="https://github.com/elastic/elasticsearch/pull/16506">#16506</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.3.0" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Setting <emphasis>other</emphasis> bucket on empty aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/17264">#17264</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16546">#16546</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Build empty extended stats aggregation if no docs collected for bucket <ulink url="https://github.com/elastic/elasticsearch/pull/16972">#16972</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16812">#16812</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9544">#9544</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Set meta data for pipeline aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/16516">#16516</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16484">#16484</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Filter(s) aggregation should create weights only once. <ulink url="https://github.com/elastic/elasticsearch/pull/15998">#15998</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>missing</literal> on terms aggs work with all execution modes. <ulink url="https://github.com/elastic/elasticsearch/pull/15746">#15746</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14882">#14882</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE in Derivative Pipeline when current bucket value is null <ulink url="https://github.com/elastic/elasticsearch/pull/14745">#14745</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix _aliases filter and null parameters <ulink url="https://github.com/elastic/elasticsearch/pull/16553">#16553</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16547">#16547</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16549">#16549</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check lenient_expand_open after aliases have been resolved <ulink url="https://github.com/elastic/elasticsearch/pull/15882">#15882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13278">#13278</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
IndicesStore checks for <literal>allocated elsewhere</literal> for every shard not alocated on the local node <ulink url="https://github.com/elastic/elasticsearch/pull/17106">#17106</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prevent peer recovery from node with older version <ulink url="https://github.com/elastic/elasticsearch/pull/15775">#15775</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Analysis : Allow string explain param in JSON <ulink url="https://github.com/elastic/elasticsearch/pull/16977">#16977</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16925">#16925</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Analysis : Fix no response from Analyze API without specified index <ulink url="https://github.com/elastic/elasticsearch/pull/15447">#15447</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15148">#15148</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Bulk api: fail deletes when routing is required but not specified <ulink url="https://github.com/elastic/elasticsearch/pull/16675">#16675</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10136">#10136</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16645">#16645</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix column aliases in _cat/indices, _cat/nodes and _cat/shards APIs <ulink url="https://github.com/elastic/elasticsearch/pull/17145">#17145</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17101">#17101</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
fixed propagation of autoGeneratedId on document creation <ulink url="https://github.com/elastic/elasticsearch/pull/16767">#16767</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw exception if content type could not be determined in Update API <ulink url="https://github.com/elastic/elasticsearch/pull/15904">#15904</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15822">#15822</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle closed readers in ShardCoreKeyMap <ulink url="https://github.com/elastic/elasticsearch/pull/16027">#16027</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Index deletes not applied when cluster UUID has changed <ulink url="https://github.com/elastic/elasticsearch/pull/16825">#16825</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11665">#11665</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only fail the relocation target when a replication request on it fails <ulink url="https://github.com/elastic/elasticsearch/pull/15791">#15791</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15790">#15790</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Migrate template settings (add missing byte &amp; time units) <ulink url="https://github.com/elastic/elasticsearch/pull/17095">#17095</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17093">#17093</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make disabled fielddata loading fail earlier. <ulink url="https://github.com/elastic/elasticsearch/pull/16179">#16179</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16135">#16135</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove .geohash suffix from GeoDistanceQuery and GeoDistanceRangeQuery <ulink url="https://github.com/elastic/elasticsearch/pull/15871">#15871</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15179">#15179</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t override originalQuery with request filters <ulink url="https://github.com/elastic/elasticsearch/pull/15793">#15793</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15689">#15689</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Inner Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query and top level inner hit definitions shouldn&#8217;t overwrite each other <ulink url="https://github.com/elastic/elasticsearch/pull/16222">#16222</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16218">#16218</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log uncaught exceptions from scheduled once tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15824">#15824</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15814">#15814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
FunctionScoreQuery should implement two-phase iteration. <ulink url="https://github.com/elastic/elasticsearch/pull/15602">#15602</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix boundary chars in java api <ulink url="https://github.com/elastic/elasticsearch/pull/15795">#15795</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15792">#15792</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add missing index name to indexing slow log <ulink url="https://github.com/elastic/elasticsearch/pull/17026">#17026</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17025">#17025</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ParseFieldMatcher should log when using deprecated settings. <ulink url="https://github.com/elastic/elasticsearch/pull/16988">#16988</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Put mapping operations must update metadata of all types. <ulink url="https://github.com/elastic/elasticsearch/pull/16264">#16264</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16239">#16239</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix serialization of <literal>search_analyzer</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/16255">#16255</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reuse metadata mappers for dynamic updates. <ulink url="https://github.com/elastic/elasticsearch/pull/16023">#16023</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15997">#15997</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix MapperService#searchFilter(&#8230;) <ulink url="https://github.com/elastic/elasticsearch/pull/15923">#15923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15757">#15757</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
MapperService: check index.mapper.dynamic during index creation <ulink url="https://github.com/elastic/elasticsearch/pull/15424">#15424</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15381">#15381</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only accept transport requests after node is fully initialized <ulink url="https://github.com/elastic/elasticsearch/pull/16746">#16746</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16723">#16723</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix waiting for pidfile <ulink url="https://github.com/elastic/elasticsearch/pull/16718">#16718</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16717">#16717</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enable es_include at init <ulink url="https://github.com/elastic/elasticsearch/pull/15173">#15173</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check that parent_type in Has Parent Query has child types <ulink url="https://github.com/elastic/elasticsearch/pull/16923">#16923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16692">#16692</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Has child query forces default similarity <ulink url="https://github.com/elastic/elasticsearch/pull/16611">#16611</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16550">#16550</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4977">#4977</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t replace found fields if map unmapped fields as string is enabled <ulink url="https://github.com/elastic/elasticsearch/pull/16043">#16043</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10500">#10500</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
mpercolate api should serialise start time  <ulink url="https://github.com/elastic/elasticsearch/pull/15938">#15938</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15908">#15908</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calling ensureOpen() on the wrong directory <ulink url="https://github.com/elastic/elasticsearch/pull/16383">#16383</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add setFactory permission to GceDiscoveryPlugin <ulink url="https://github.com/elastic/elasticsearch/pull/16860">#16860</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16485">#16485</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix FunctionScore equals/hashCode to include minScore and friends <ulink url="https://github.com/elastic/elasticsearch/pull/15676">#15676</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove detect_noop from REST spec <ulink url="https://github.com/elastic/elasticsearch/pull/16386">#16386</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make text parsing less lenient. <ulink url="https://github.com/elastic/elasticsearch/pull/15679">#15679</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Try to renew sync ID if <literal>flush=true</literal> on forceMerge <ulink url="https://github.com/elastic/elasticsearch/pull/17108">#17108</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17019">#17019</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
sync translog to disk after recovery from primary <ulink url="https://github.com/elastic/elasticsearch/pull/15832">#15832</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Reindex API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Properly register reindex status <ulink url="https://github.com/elastic/elasticsearch/pull/17125">#17125</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Be much much much careful about context <ulink url="https://github.com/elastic/elasticsearch/pull/17122">#17122</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make search failure cause rest failure <ulink url="https://github.com/elastic/elasticsearch/pull/16889">#16889</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16037">#16037</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check that _value is used in aggregations script before setting value to specialValue <ulink url="https://github.com/elastic/elasticsearch/pull/17091">#17091</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14262">#14262</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add permission to access sun.reflect.MethodAccessorImpl from Groovy scripts <ulink url="https://github.com/elastic/elasticsearch/pull/16540">#16540</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16536">#16536</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes json generation for scriptsort w/ deprecated params <ulink url="https://github.com/elastic/elasticsearch/pull/16261">#16261</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16260">#16260</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Security permissions for Groovy closures <ulink url="https://github.com/elastic/elasticsearch/pull/16196">#16196</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16194">#16194</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/248">#248</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not apply minimum_should_match on auto generated boolean query if the coordination factor is disabled. <ulink url="https://github.com/elastic/elasticsearch/pull/16155">#16155</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not apply minimum-should-match on a boolean query if the coords are disabled <ulink url="https://github.com/elastic/elasticsearch/pull/16078">#16078</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15858">#15858</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix blended terms take 2 <ulink url="https://github.com/elastic/elasticsearch/pull/15894">#15894</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15860">#15860</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
TransportClient should use updated setting for initialization of modules and service <ulink url="https://github.com/elastic/elasticsearch/pull/16095">#16095</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent closing index during snapshot restore <ulink url="https://github.com/elastic/elasticsearch/pull/16933">#16933</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16321">#16321</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add node version check to shard allocation during restore <ulink url="https://github.com/elastic/elasticsearch/pull/16520">#16520</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16519">#16519</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix recovery translog stats totals when recovering from store <ulink url="https://github.com/elastic/elasticsearch/pull/16493">#16493</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15974">#15974</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix calculation of age of pending tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15995">#15995</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15988">#15988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Task Manager
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix TaskId#isSet to return true when id is set and not other way around <ulink url="https://github.com/elastic/elasticsearch/pull/17307">#17307</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t wait for completion of list tasks tasks when wait_for_completion flag is set <ulink url="https://github.com/elastic/elasticsearch/pull/17231">#17231</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Call ensureOpen on Translog#newView() to prevent IllegalStateException <ulink url="https://github.com/elastic/elasticsearch/pull/17191">#17191</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure IndexShard is active during recovery so it gets its fair share of the indexing buffer <ulink url="https://github.com/elastic/elasticsearch/pull/16209">#16209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16206">#16206</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Avoid circular reference in exception <ulink url="https://github.com/elastic/elasticsearch/pull/15952">#15952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15941">#15941</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Initialize translog before scheduling the sync to disk <ulink url="https://github.com/elastic/elasticsearch/pull/15881">#15881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Catch tragic even inside the checkpoint method rather than on the caller side <ulink url="https://github.com/elastic/elasticsearch/pull/15825">#15825</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Never delete translog-N.tlog file when creation fails <ulink url="https://github.com/elastic/elasticsearch/pull/15788">#15788</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Close recovered translog readers if createWriter fails <ulink url="https://github.com/elastic/elasticsearch/pull/15762">#15762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15754">#15754</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Passthrough environment and network settings to tribe client nodes <ulink url="https://github.com/elastic/elasticsearch/pull/16893">#16893</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Tribe node: pass path.conf to inner tribe clients <ulink url="https://github.com/elastic/elasticsearch/pull/16258">#16258</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16253">#16253</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.3.0" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add PathHierarchy type back to path_hierarchy tokenizer for backward compatibility with 1.x <ulink url="https://github.com/elastic/elasticsearch/pull/15785">#15785</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15756">#15756</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Unknown [repository] type [azure] error with 2.2.0 <ulink url="https://github.com/elastic/elasticsearch/pull/16747">#16747</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13779">#13779</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16734">#16734</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t return all indices immediately if count of expressions &gt;1 and first expression is * <ulink url="https://github.com/elastic/elasticsearch/pull/17033">#17033</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17027">#17027</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.3.0" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.3.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to Lucene 5.5.0 official release <ulink url="https://github.com/elastic/elasticsearch/pull/16742">#16742</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene 5.5.0-snapshot-850c6c2 <ulink url="https://github.com/elastic/elasticsearch/pull/16615">#16615</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene 5.5.0-snapshot-4de5f1d <ulink url="https://github.com/elastic/elasticsearch/pull/16400">#16400</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16373">#16373</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16399">#16399</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update lucene to r1725675 <ulink url="https://github.com/elastic/elasticsearch/pull/16114">#16114</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.5.0-snapshot-1721183. <ulink url="https://github.com/elastic/elasticsearch/pull/15575">#15575</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade Azure Storage client to 4.0.0 <ulink url="https://github.com/elastic/elasticsearch/pull/16084">#16084</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12567">#12567</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15080">#15080</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15976">#15976</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade azure SDK to 0.9.3 <ulink url="https://github.com/elastic/elasticsearch/pull/17102">#17102</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/17042">#17042</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/557">#557</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade groovy dependency in lang-groovy module to version 2.4.6 <ulink url="https://github.com/elastic/elasticsearch/pull/16830">#16830</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16527">#16527</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.2.2">
<title>2.2.2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.2.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.2"/>.</simpara>
<bridgehead id="enhancement-2.2.2" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log suppressed stack traces under DEBUG <ulink url="https://github.com/elastic/elasticsearch/pull/16627">#16627</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12991">#12991</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15329">#15329</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16622">#16622</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.2.2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
IndicesStore checks for <literal>allocated elsewhere</literal> for every shard not alocated on the local node <ulink url="https://github.com/elastic/elasticsearch/pull/17106">#17106</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix column aliases in _cat/indices, _cat/nodes and _cat/shards APIs <ulink url="https://github.com/elastic/elasticsearch/pull/17145">#17145</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17101">#17101</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove .geohash suffix from GeoDistanceQuery and GeoDistanceRangeQuery <ulink url="https://github.com/elastic/elasticsearch/pull/15871">#15871</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15179">#15179</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Try to renew sync ID if <literal>flush=true</literal> on forceMerge <ulink url="https://github.com/elastic/elasticsearch/pull/17108">#17108</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17019">#17019</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Call ensureOpen on Translog#newView() to prevent IllegalStateException <ulink url="https://github.com/elastic/elasticsearch/pull/17191">#17191</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.2.1">
<title>2.2.1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.1.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.2"/>.</simpara>
<bridgehead id="enhancement-2.2.1" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Shard state action request logging <ulink url="https://github.com/elastic/elasticsearch/pull/16396">#16396</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Avoid cloning MessageDigest instances <ulink url="https://github.com/elastic/elasticsearch/pull/16479">#16479</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add Exception class name to message in <literal>NotSerializableExceptionWrapper</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/16325">#16325</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add additional fallback to http.publish_port and restrict fallback to transport.publish_port <ulink url="https://github.com/elastic/elasticsearch/pull/16626">#16626</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14535">#14535</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Windows service: Use JAVA_HOME environment variable in registry <ulink url="https://github.com/elastic/elasticsearch/pull/16552">#16552</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13521">#13521</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Class permission for Groovy references <ulink url="https://github.com/elastic/elasticsearch/pull/16660">#16660</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16657">#16657</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log warning if max file descriptors too low <ulink url="https://github.com/elastic/elasticsearch/pull/16506">#16506</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.2.1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Set meta data for pipeline aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/16516">#16516</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16484">#16484</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix _aliases filter and null parameters <ulink url="https://github.com/elastic/elasticsearch/pull/16553">#16553</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16547">#16547</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16549">#16549</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Bulk api: fail deletes when routing is required but not specified <ulink url="https://github.com/elastic/elasticsearch/pull/16675">#16675</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10136">#10136</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16645">#16645</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Inner Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query and top level inner hit definitions shouldn&#8217;t overwrite each other <ulink url="https://github.com/elastic/elasticsearch/pull/16222">#16222</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16218">#16218</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add missing index name to indexing slow log <ulink url="https://github.com/elastic/elasticsearch/pull/17026">#17026</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/17025">#17025</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check that parent_type in Has Parent Query has child types <ulink url="https://github.com/elastic/elasticsearch/pull/16923">#16923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16692">#16692</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Has child query forces default similarity <ulink url="https://github.com/elastic/elasticsearch/pull/16611">#16611</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16550">#16550</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4977">#4977</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t replace found fields if map unmapped fields as string is enabled <ulink url="https://github.com/elastic/elasticsearch/pull/16043">#16043</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10500">#10500</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calling ensureOpen() on the wrong directory <ulink url="https://github.com/elastic/elasticsearch/pull/16383">#16383</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add setFactory permission to GceDiscoveryPlugin <ulink url="https://github.com/elastic/elasticsearch/pull/16860">#16860</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16485">#16485</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use MappedFieldType.termQuery to generate simple_query_string queries <ulink url="https://github.com/elastic/elasticsearch/pull/16686">#16686</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16577">#16577</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove detect_noop from REST spec <ulink url="https://github.com/elastic/elasticsearch/pull/16386">#16386</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add permission to access sun.reflect.MethodAccessorImpl from Groovy scripts <ulink url="https://github.com/elastic/elasticsearch/pull/16540">#16540</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16536">#16536</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add node version check to shard allocation during restore <ulink url="https://github.com/elastic/elasticsearch/pull/16520">#16520</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16519">#16519</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix recovery translog stats totals when recovering from store <ulink url="https://github.com/elastic/elasticsearch/pull/16493">#16493</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15974">#15974</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Passthrough environment and network settings to tribe client nodes <ulink url="https://github.com/elastic/elasticsearch/pull/16893">#16893</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.2.1" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Unknown [repository] type [azure] error with 2.2.0 <ulink url="https://github.com/elastic/elasticsearch/pull/16747">#16747</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13779">#13779</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16734">#16734</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.2.1" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Plugin Repository Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade Azure Storage client to 4.0.0 <ulink url="https://github.com/elastic/elasticsearch/pull/16084">#16084</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12567">#12567</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15080">#15080</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15976">#15976</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.2.0">
<title>2.2.0 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.2"/>.</simpara>
<bridgehead id="breaking-2.2.0" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Change Field stats API response to include both number and string based min and max values <ulink url="https://github.com/elastic/elasticsearch/pull/14674">#14674</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14404">#14404</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Filter classes loaded by scripts <ulink url="https://github.com/elastic/elasticsearch/pull/15262">#15262</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Lock down javascript and python script engines better <ulink url="https://github.com/elastic/elasticsearch/pull/13924">#13924</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.2.0" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate the count api in favour of search with size 0 <ulink url="https://github.com/elastic/elasticsearch/pull/14165">#14165</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13928">#13928</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecates defaultRescoreWindowSize <ulink url="https://github.com/elastic/elasticsearch/pull/13995">#13995</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery Multicast
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate the discovery-multicast plugin <ulink url="https://github.com/elastic/elasticsearch/pull/16371">#16371</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16310">#16310</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16326">#16326</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate the <literal>missing</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/15153">#15153</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14112">#14112</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate NotQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/14203">#14203</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13761">#13761</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate _search/exists in favour of regular _search with size 0 and terminate_after 1 <ulink url="https://github.com/elastic/elasticsearch/pull/13910">#13910</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13682">#13682</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="feature-2.2.0" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add CONTAINS relation to geo_shape query <ulink url="https://github.com/elastic/elasticsearch/pull/14810">#14810</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14713">#14713</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for Lucene 5.4 GeoPoint queries <ulink url="https://github.com/elastic/elasticsearch/pull/14537">#14537</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add GeoPointV2 Field Mapping <ulink url="https://github.com/elastic/elasticsearch/pull/14536">#14536</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow binding to multiple addresses. <ulink url="https://github.com/elastic/elasticsearch/pull/13954">#13954</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13592">#13592</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Analysis Phonetic
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for <literal>daitch_mokotoff</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/14834">#14834</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Repository S3
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for S3 storage class <ulink url="https://github.com/elastic/elasticsearch/pull/13656">#13656</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13655">#13655</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Decentralize plugin security <ulink url="https://github.com/elastic/elasticsearch/pull/14108">#14108</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add query profiler <ulink url="https://github.com/elastic/elasticsearch/pull/14889">#14889</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12974">#12974</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6699">#6699</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.2.0" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support to _aliases endpoint to specify multiple indices and aliases in one action <ulink url="https://github.com/elastic/elasticsearch/pull/15305">#15305</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15186">#15186</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Simplify delayed shard allocation <ulink url="https://github.com/elastic/elasticsearch/pull/14808">#14808</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add cluster-wide setting for total shard limit <ulink url="https://github.com/elastic/elasticsearch/pull/14563">#14563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14456">#14456</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Early terminate high disk watermark checks on single data node cluster <ulink url="https://github.com/elastic/elasticsearch/pull/13882">#13882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9391">#9391</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add detail response support for _analyze API <ulink url="https://github.com/elastic/elasticsearch/pull/11660">#11660</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11076">#11076</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add sync_id to cat shards API <ulink url="https://github.com/elastic/elasticsearch/pull/14712">#14712</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14705">#14705</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add duration field to /_cat/snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/14385">#14385</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add cat API for repositories and snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/14247">#14247</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13919">#13919</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds disk used by indices to _cat/allocation <ulink url="https://github.com/elastic/elasticsearch/pull/13783">#13783</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13529">#13529</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Safe cluster state task notifications <ulink url="https://github.com/elastic/elasticsearch/pull/15777">#15777</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reroute once per batch of shard failures <ulink url="https://github.com/elastic/elasticsearch/pull/15510">#15510</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add callback for publication of new cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/15494">#15494</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15482">#15482</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Split cluster state update tasks into roles <ulink url="https://github.com/elastic/elasticsearch/pull/15159">#15159</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use general cluster state batching mechanism for shard started <ulink url="https://github.com/elastic/elasticsearch/pull/15023">#15023</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14725">#14725</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14899">#14899</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use general cluster state batching mechanism for shard failures <ulink url="https://github.com/elastic/elasticsearch/pull/15016">#15016</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14725">#14725</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14899">#14899</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Set an newly created IndexShard&#8217;s ShardRouting before exposing it to operations <ulink url="https://github.com/elastic/elasticsearch/pull/14918">#14918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10708">#10708</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Uniform exceptions for TransportMasterNodeAction <ulink url="https://github.com/elastic/elasticsearch/pull/14737">#14737</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
If we can&#8217;t get a MAC address for the node, use a dummy one <ulink url="https://github.com/elastic/elasticsearch/pull/15266">#15266</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10099">#10099</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify shard inactive logging <ulink url="https://github.com/elastic/elasticsearch/pull/15259">#15259</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15252">#15252</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify IndexingMemoryController#checkIdle <ulink url="https://github.com/elastic/elasticsearch/pull/15252">#15252</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15251">#15251</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
IndexingMemoryController should not track shard index states <ulink url="https://github.com/elastic/elasticsearch/pull/15251">#15251</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13918">#13918</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15225">#15225</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make PerThreadIDAndVersionLookup per-segment <ulink url="https://github.com/elastic/elasticsearch/pull/14070">#14070</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Verify Checksum once it has been fully written to fail as soon as possible <ulink url="https://github.com/elastic/elasticsearch/pull/13896">#13896</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Discovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t allow nodes with missing custom meta data to join cluster <ulink url="https://github.com/elastic/elasticsearch/pull/15401">#15401</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13445">#13445</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate cause if already contained in shard failures <ulink url="https://github.com/elastic/elasticsearch/pull/14432">#14432</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Give a better exception when running from freebsd jail without enforce_statfs=1 <ulink url="https://github.com/elastic/elasticsearch/pull/14135">#14135</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12018">#12018</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make root_cause of field conflicts more obvious <ulink url="https://github.com/elastic/elasticsearch/pull/13976">#13976</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12839">#12839</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update GeoPoint FieldData for GeoPointV2 <ulink url="https://github.com/elastic/elasticsearch/pull/14345">#14345</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Geo: Fix toString() in GeoDistanceRangeQuery and GeoPolygonQuery <ulink url="https://github.com/elastic/elasticsearch/pull/15026">#15026</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enable GeoPointV2 with backward compatibility testing <ulink url="https://github.com/elastic/elasticsearch/pull/14667">#14667</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10761">#10761</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11159">#11159</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9859">#9859</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor Geo utilities to Lucene 5.4 <ulink url="https://github.com/elastic/elasticsearch/pull/14339">#14339</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add option to disable closing indices <ulink url="https://github.com/elastic/elasticsearch/pull/14169">#14169</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14168">#14168</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Disallow index template pattern to be the same as an alias name <ulink url="https://github.com/elastic/elasticsearch/pull/15184">#15184</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14842">#14842</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Simplify the Text API. <ulink url="https://github.com/elastic/elasticsearch/pull/15511">#15511</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simpler using compressed oops flag representation <ulink url="https://github.com/elastic/elasticsearch/pull/15509">#15509</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15489">#15489</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Info on compressed ordinary object pointers <ulink url="https://github.com/elastic/elasticsearch/pull/15489">#15489</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13187">#13187</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/455">#455</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Explicitly log cluster state update failures <ulink url="https://github.com/elastic/elasticsearch/pull/15428">#15428</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14899">#14899</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15016">#15016</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15023">#15023</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use transport service to handle RetryOnReplicaException to execute replica action on the current node <ulink url="https://github.com/elastic/elasticsearch/pull/15363">#15363</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make IndexShard operation be more explicit about whether they are expected to run on a primary or replica <ulink url="https://github.com/elastic/elasticsearch/pull/15282">#15282</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Avoid trace logging allocations in TransportBroadcastByNodeAction <ulink url="https://github.com/elastic/elasticsearch/pull/15221">#15221</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only trace log shard not available exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/14950">#14950</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14927">#14927</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Transport options should be immutable <ulink url="https://github.com/elastic/elasticsearch/pull/14760">#14760</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix dangling comma in ClusterBlock#toString <ulink url="https://github.com/elastic/elasticsearch/pull/14483">#14483</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve some logging around master election and cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/14481">#14481</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add System#exit(), Runtime#exit() and Runtime#halt() to forbidden APIs <ulink url="https://github.com/elastic/elasticsearch/pull/14473">#14473</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12596">#12596</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify XContent detection. <ulink url="https://github.com/elastic/elasticsearch/pull/14472">#14472</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add threadgroup isolation. <ulink url="https://github.com/elastic/elasticsearch/pull/14353">#14353</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup plugin security <ulink url="https://github.com/elastic/elasticsearch/pull/14311">#14311</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add workaround for JDK-8014008 <ulink url="https://github.com/elastic/elasticsearch/pull/14274">#14274</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor retry logic for TransportMasterNodeAction <ulink url="https://github.com/elastic/elasticsearch/pull/14222">#14222</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove MetaDataSerivce and it&#8217;s semaphores <ulink url="https://github.com/elastic/elasticsearch/pull/14159">#14159</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1296">#1296</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup IndexMetaData <ulink url="https://github.com/elastic/elasticsearch/pull/14119">#14119</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
TransportNodesAction shouldn&#8217;t hold on to cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/13948">#13948</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add SpecialPermission to guard exceptions to security policy. <ulink url="https://github.com/elastic/elasticsearch/pull/13854">#13854</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clean up scripting permissions. <ulink url="https://github.com/elastic/elasticsearch/pull/13844">#13844</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Factor groovy out of core into lang-groovy <ulink url="https://github.com/elastic/elasticsearch/pull/13834">#13834</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13725">#13725</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Factor expressions scripts out to lang-expression plugin <ulink url="https://github.com/elastic/elasticsearch/pull/13726">#13726</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13725">#13725</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
TransportClient: Add exception when using plugin.types, to help migration to addPlugin <ulink url="https://github.com/elastic/elasticsearch/pull/15943">#15943</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15693">#15693</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Align handling of interrupts in BulkProcessor <ulink url="https://github.com/elastic/elasticsearch/pull/15527">#15527</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14833">#14833</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
BulkProcessor backs off exponentially by default <ulink url="https://github.com/elastic/elasticsearch/pull/15513">#15513</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14829">#14829</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add java API for synced flush <ulink url="https://github.com/elastic/elasticsearch/pull/15396">#15396</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12812">#12812</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow to get and set ttl as a time value/string <ulink url="https://github.com/elastic/elasticsearch/pull/15239">#15239</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15047">#15047</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reject refresh usage in bulk items when using and fix NPE when no source <ulink url="https://github.com/elastic/elasticsearch/pull/15082">#15082</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7361">#7361</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
BulkProcessor retries after request handling has been rejected due to a full thread pool <ulink url="https://github.com/elastic/elasticsearch/pull/14829">#14829</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14620">#14620</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add circuit breaker name to logging package <ulink url="https://github.com/elastic/elasticsearch/pull/14661">#14661</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log cluster health status changes <ulink url="https://github.com/elastic/elasticsearch/pull/14557">#14557</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11657">#11657</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Map log-level <emphasis>trace</emphasis> to JDK-Level <emphasis>FINEST</emphasis> <ulink url="https://github.com/elastic/elasticsearch/pull/14234">#14234</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make mapping serialization more robust. <ulink url="https://github.com/elastic/elasticsearch/pull/15480">#15480</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make mappings immutable. <ulink url="https://github.com/elastic/elasticsearch/pull/15313">#15313</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9365">#9365</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make MappedFieldType.checkTypeName part of MappedFieldType.checkCompatibility. <ulink url="https://github.com/elastic/elasticsearch/pull/15245">#15245</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
throw exception if a copy_to is within a multi field <ulink url="https://github.com/elastic/elasticsearch/pull/15213">#15213</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10802">#10802</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14946">#14946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Register field mappers at the node level. <ulink url="https://github.com/elastic/elasticsearch/pull/14896">#14896</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14828">#14828</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
only allow code to bind to the user&#8217;s configured port numbers/ranges <ulink url="https://github.com/elastic/elasticsearch/pull/14549">#14549</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Port of publishAddress should match port of corresponding boundAddress <ulink url="https://github.com/elastic/elasticsearch/pull/14535">#14535</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14503">#14503</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14513">#14513</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14514">#14514</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default standard output to the journal in systemd <ulink url="https://github.com/elastic/elasticsearch/pull/16159">#16159</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/15315">#15315</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16134">#16134</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use egrep instead of grep -E for Solaris <ulink url="https://github.com/elastic/elasticsearch/pull/15755">#15755</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15628">#15628</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
punch thru symlinks when loading plugins/modules <ulink url="https://github.com/elastic/elasticsearch/pull/15311">#15311</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
set ActiveProcessLimit=1 on windows <ulink url="https://github.com/elastic/elasticsearch/pull/15055">#15055</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
set RLIMIT_NPROC = 0 on bsd/os X systems. <ulink url="https://github.com/elastic/elasticsearch/pull/15039">#15039</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Drop ability to execute on Solaris <ulink url="https://github.com/elastic/elasticsearch/pull/14200">#14200</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Packaging: change permissions/ownership of config dir <ulink url="https://github.com/elastic/elasticsearch/pull/14017">#14017</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Release: Fix package repo path to only consist of major version <ulink url="https://github.com/elastic/elasticsearch/pull/13971">#13971</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12493">#12493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Nuke ES_CLASSPATH appending, JarHell fail on empty classpath elements <ulink url="https://github.com/elastic/elasticsearch/pull/13880">#13880</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13812">#13812</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13864">#13864</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Get lang-javascript, lang-python, securemock ready for script refactoring <ulink url="https://github.com/elastic/elasticsearch/pull/13695">#13695</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove some bogus permissions only needed for tests. <ulink url="https://github.com/elastic/elasticsearch/pull/13620">#13620</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove java.lang.reflect.ReflectPermission "suppressAccessChecks" <ulink url="https://github.com/elastic/elasticsearch/pull/13603">#13603</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for proxy authentication for s3 and ec2 <ulink url="https://github.com/elastic/elasticsearch/pull/15352">#15352</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/15268">#15268</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15293">#15293</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add timeout settings (default to 5 minutes) <ulink url="https://github.com/elastic/elasticsearch/pull/15950">#15950</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14277">#14277</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15080">#15080</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for secondary azure storage account <ulink url="https://github.com/elastic/elasticsearch/pull/13779">#13779</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13228">#13228</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adding backoff from retries on GCE errors <ulink url="https://github.com/elastic/elasticsearch/pull/13671">#13671</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13460">#13460</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>_gce_</literal> network host setting <ulink url="https://github.com/elastic/elasticsearch/pull/13612">#13612</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13590">#13590</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13605">#13605</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery EC2
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add ap-northeast-2 (seoul) endpoints for EC2 discovery and S3 snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/16167">#16167</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16166">#16166</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adding US-Gov-West <ulink url="https://github.com/elastic/elasticsearch/pull/14358">#14358</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improved building of disco nodes <ulink url="https://github.com/elastic/elasticsearch/pull/14155">#14155</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Mapper Attachment
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backport mapper-attachments plugin to 2.x <ulink url="https://github.com/elastic/elasticsearch/pull/14902">#14902</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Repository S3
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add aws canned acl <ulink url="https://github.com/elastic/elasticsearch/pull/14297">#14297</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14103">#14103</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Expose http.type setting, and collapse al(most all) modules relating to transport/http <ulink url="https://github.com/elastic/elasticsearch/pull/15434">#15434</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14148">#14148</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ban RuntimePermission("getClassLoader") <ulink url="https://github.com/elastic/elasticsearch/pull/15253">#15253</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add nicer error message when a plugin descriptor is missing <ulink url="https://github.com/elastic/elasticsearch/pull/15200">#15200</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15197">#15197</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t be lenient in PluginService#processModule(Module) <ulink url="https://github.com/elastic/elasticsearch/pull/14306">#14306</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check "plugin already installed" before jar hell check. <ulink url="https://github.com/elastic/elasticsearch/pull/14207">#14207</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14205">#14205</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugin script to set proper plugin bin dir attributes <ulink url="https://github.com/elastic/elasticsearch/pull/14088">#14088</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugin script to set proper plugin config dir attributes <ulink url="https://github.com/elastic/elasticsearch/pull/14048">#14048</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow CIDR notation in query string query <ulink url="https://github.com/elastic/elasticsearch/pull/14773">#14773</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7464">#7464</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make XContentGenerator.writeRaw* safer. <ulink url="https://github.com/elastic/elasticsearch/pull/15358">#15358</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Filter path refactoring <ulink url="https://github.com/elastic/elasticsearch/pull/14390">#14390</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10980">#10980</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11560">#11560</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13344">#13344</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle cancel exceptions on recovery target if the cancel comes from the source <ulink url="https://github.com/elastic/elasticsearch/pull/15309">#15309</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Decouple routing and primary operation logic in TransportReplicationAction <ulink url="https://github.com/elastic/elasticsearch/pull/14852">#14852</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add property permissions so groovy scripts can serialize json <ulink url="https://github.com/elastic/elasticsearch/pull/14500">#14500</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14488">#14488</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove ScriptEngineService.unwrap. <ulink url="https://github.com/elastic/elasticsearch/pull/13958">#13958</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove ScriptEngineService.execute. <ulink url="https://github.com/elastic/elasticsearch/pull/13956">#13956</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Support * wildcard to retrieve stored fields in the <emphasis>fields</emphasis> option <ulink url="https://github.com/elastic/elasticsearch/pull/15119">#15119</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10783">#10783</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14489">#14489</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Caching Weight wrappers should propagate the BulkScorer. <ulink url="https://github.com/elastic/elasticsearch/pull/14317">#14317</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
fix numerical issue in function score query <ulink url="https://github.com/elastic/elasticsearch/pull/14085">#14085</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Support wildcards for getting repositories and snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/15151">#15151</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4758">#4758</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add ignore_unavailable parameter to skip unavailable snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/14471">#14471</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13887">#13887</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add system CPU percent to OS stats <ulink url="https://github.com/elastic/elasticsearch/pull/15302">#15302</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Pull Fields instance once from LeafReader in completion stats <ulink url="https://github.com/elastic/elasticsearch/pull/15090">#15090</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6593">#6593</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add os.allocated_processors stats <ulink url="https://github.com/elastic/elasticsearch/pull/14409">#14409</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13917">#13917</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Top Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Put method addField on TopHitsBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/14597">#14597</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12962">#12962</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check for tragic event on all kinds of exceptions not only ACE and IOException <ulink url="https://github.com/elastic/elasticsearch/pull/15535">#15535</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Tribe nodes should apply cluster state updates in batches <ulink url="https://github.com/elastic/elasticsearch/pull/14993">#14993</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14725">#14725</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14899">#14899</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.2.0" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Filter(s) aggregation should create weights only once. <ulink url="https://github.com/elastic/elasticsearch/pull/15998">#15998</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>missing</literal> on terms aggs work with all execution modes. <ulink url="https://github.com/elastic/elasticsearch/pull/15746">#15746</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14882">#14882</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Run pipeline aggregations for empty buckets added in the Range Aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/15519">#15519</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15471">#15471</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
[Children agg] fix bug that prevented all child docs from being evaluated <ulink url="https://github.com/elastic/elasticsearch/pull/15457">#15457</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Correct typo in class name of StatsAggregator <ulink url="https://github.com/elastic/elasticsearch/pull/15321">#15321</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14730">#14730</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix significant terms reduce for long terms <ulink url="https://github.com/elastic/elasticsearch/pull/14948">#14948</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13522">#13522</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pass extended bounds into HistogramAggregator when creating an unmapped aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/14742">#14742</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14735">#14735</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added correct generic type parameter on ScriptedMetricBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/14018">#14018</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13986">#13986</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check lenient_expand_open after aliases have been resolved <ulink url="https://github.com/elastic/elasticsearch/pull/15882">#15882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13278">#13278</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent peer recovery from node with older version <ulink url="https://github.com/elastic/elasticsearch/pull/15775">#15775</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix calculation of next delay for delayed shard allocation <ulink url="https://github.com/elastic/elasticsearch/pull/14765">#14765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Take ignored unallocated shards into account when making allocation decision <ulink url="https://github.com/elastic/elasticsearch/pull/14678">#14678</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14670">#14670</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only allow rebalance operations to run if all shard store data is available <ulink url="https://github.com/elastic/elasticsearch/pull/14591">#14591</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14387">#14387</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delayed allocation can miss a reroute <ulink url="https://github.com/elastic/elasticsearch/pull/14494">#14494</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14010">#14010</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14011">#14011</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14445">#14445</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check rebalancing constraints when shards are moved from a node they can no longer remain on <ulink url="https://github.com/elastic/elasticsearch/pull/14259">#14259</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14057">#14057</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not release unacquired semaphore <ulink url="https://github.com/elastic/elasticsearch/pull/14909">#14909</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14908">#14908</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Properly set indices and indicesOptions on subrequest made by /_cat/indices <ulink url="https://github.com/elastic/elasticsearch/pull/14360">#14360</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw exception if content type could not be determined in Update API <ulink url="https://github.com/elastic/elasticsearch/pull/15904">#15904</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15822">#15822</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only fail the relocation target when a replication request on it fails <ulink url="https://github.com/elastic/elasticsearch/pull/15791">#15791</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15790">#15790</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Handle shards assigned to nodes that are not in the cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/14586">#14586</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14584">#14584</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Bulk cluster state updates on index deletion <ulink url="https://github.com/elastic/elasticsearch/pull/11258">#11258</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7295">#7295</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
BitSetFilterCache duplicates its content. <ulink url="https://github.com/elastic/elasticsearch/pull/15836">#15836</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15820">#15820</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Limit the max size of bulk and index thread pools to bounded number of processors <ulink url="https://github.com/elastic/elasticsearch/pull/15585">#15585</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15582">#15582</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
AllTermQuery&#8217;s scorer should skip segments that never saw the requested term <ulink url="https://github.com/elastic/elasticsearch/pull/15506">#15506</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Include root-cause exception when we fail to change shard&#8217;s index buffer <ulink url="https://github.com/elastic/elasticsearch/pull/14867">#14867</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restore thread interrupt flag after an InterruptedException <ulink url="https://github.com/elastic/elasticsearch/pull/14799">#14799</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14798">#14798</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use fresh index settings instead of relying on @IndexSettings <ulink url="https://github.com/elastic/elasticsearch/pull/14578">#14578</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14319">#14319</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Record all bytes of the checksum in VerifyingIndexOutput <ulink url="https://github.com/elastic/elasticsearch/pull/13923">#13923</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13848">#13848</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13896">#13896</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
When shard becomes active again, immediately increase its indexing buffer <ulink url="https://github.com/elastic/elasticsearch/pull/13918">#13918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13802">#13802</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Close TokenStream in finally clause <ulink url="https://github.com/elastic/elasticsearch/pull/13870">#13870</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11947">#11947</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Never wrap searcher for internal engine operations <ulink url="https://github.com/elastic/elasticsearch/pull/14071">#14071</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix ensureNodesAreAvailable&#8217;s error message <ulink url="https://github.com/elastic/elasticsearch/pull/14007">#14007</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13957">#13957</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t cache top level field data for fields that don&#8217;t exist <ulink url="https://github.com/elastic/elasticsearch/pull/14693">#14693</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Geo: Allow numeric parameters enclosed in quotes for <emphasis>geohash_grid</emphasis> aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/14440">#14440</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13132">#13132</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix spans extraction to not also include individual terms. <ulink url="https://github.com/elastic/elasticsearch/pull/15516">#15516</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13239">#13239</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15291">#15291</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Field stats: Index constraints should remove indices in the response if the field to evaluate is empty <ulink url="https://github.com/elastic/elasticsearch/pull/14868">#14868</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Field stats: Fix NPE for index constraint on empty index <ulink url="https://github.com/elastic/elasticsearch/pull/14841">#14841</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Field stats: Added <literal>format</literal> option for index constraints <ulink url="https://github.com/elastic/elasticsearch/pull/14823">#14823</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14804">#14804</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restore previous optimize transport action name for bw comp <ulink url="https://github.com/elastic/elasticsearch/pull/14221">#14221</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13778">#13778</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Forbid index name <literal>.</literal> and <literal>..</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13862">#13862</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13858">#13858</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log uncaught exceptions from scheduled once tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15824">#15824</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15814">#15814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure the remaining delay of unassigned shard is updated with every reroute <ulink url="https://github.com/elastic/elasticsearch/pull/14890">#14890</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14808">#14808</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw a meaningful error when loading metadata and an alias and index have the same name <ulink url="https://github.com/elastic/elasticsearch/pull/14842">#14842</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14706">#14706</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
fixup issues with 32-bit jvm <ulink url="https://github.com/elastic/elasticsearch/pull/14609">#14609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Failure to update the cluster state with the recovered state should make sure it will be recovered later <ulink url="https://github.com/elastic/elasticsearch/pull/14485">#14485</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Properly bind ClassSet extensions as singletons <ulink url="https://github.com/elastic/elasticsearch/pull/14232">#14232</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14194">#14194</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Streamline top level reader close listeners and forbid general usage <ulink url="https://github.com/elastic/elasticsearch/pull/14084">#14084</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Gateway: a race condition can prevent the initial cluster state from being recovered <ulink url="https://github.com/elastic/elasticsearch/pull/13997">#13997</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Verify actually written checksum in VerifyingIndexOutput <ulink url="https://github.com/elastic/elasticsearch/pull/13848">#13848</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove all setAccessible in tests and forbid <ulink url="https://github.com/elastic/elasticsearch/pull/13539">#13539</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove easy uses of setAccessible in tests. <ulink url="https://github.com/elastic/elasticsearch/pull/13537">#13537</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ban setAccessible from core code, restore monitoring stats under java 9 <ulink url="https://github.com/elastic/elasticsearch/pull/13531">#13531</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13527">#13527</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Settings in log config file should not overwrite custom parameters <ulink url="https://github.com/elastic/elasticsearch/pull/13934">#13934</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Plugin cli tool should not create empty log files <ulink url="https://github.com/elastic/elasticsearch/pull/13933">#13933</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix MapperService#searchFilter(&#8230;) <ulink url="https://github.com/elastic/elasticsearch/pull/15923">#15923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15757">#15757</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix initial sizing of BytesStreamOutput. <ulink url="https://github.com/elastic/elasticsearch/pull/15864">#15864</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15789">#15789</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
MetaDataMappingService should call MapperService.merge with the original mapping update. <ulink url="https://github.com/elastic/elasticsearch/pull/15508">#15508</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix copy_to when the target is a dynamic object field. <ulink url="https://github.com/elastic/elasticsearch/pull/15385">#15385</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11237">#11237</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only text fields should accept analyzer and term vector settings. <ulink url="https://github.com/elastic/elasticsearch/pull/15308">#15308</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mapper parsers should not check for a <literal>tokenized</literal> property. <ulink url="https://github.com/elastic/elasticsearch/pull/15289">#15289</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Validate that fields are defined only once. <ulink url="https://github.com/elastic/elasticsearch/pull/15243">#15243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15057">#15057</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check mapping compatibility up-front. <ulink url="https://github.com/elastic/elasticsearch/pull/15175">#15175</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15049">#15049</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t treat <emphasis>default</emphasis> as a regular type. <ulink url="https://github.com/elastic/elasticsearch/pull/15156">#15156</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15049">#15049</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t ignore mapping merge failures. <ulink url="https://github.com/elastic/elasticsearch/pull/15144">#15144</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15049">#15049</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Treat mappings at an index-level feature. <ulink url="https://github.com/elastic/elasticsearch/pull/15142">#15142</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Multi field names may not contain dots <ulink url="https://github.com/elastic/elasticsearch/pull/15118">#15118</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14957">#14957</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Mapping: Allows upgrade of indexes with only search_analyzer specified <ulink url="https://github.com/elastic/elasticsearch/pull/14677">#14677</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14383">#14383</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Windows service installation failure <ulink url="https://github.com/elastic/elasticsearch/pull/15549">#15549</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15349">#15349</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
fix command line options for windows bat file <ulink url="https://github.com/elastic/elasticsearch/pull/15320">#15320</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/15284">#15284</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16086">#16086</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Handle system policy correctly <ulink url="https://github.com/elastic/elasticsearch/pull/14704">#14704</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14690">#14690</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Startup script exit status should catch daemonized startup failures <ulink url="https://github.com/elastic/elasticsearch/pull/14170">#14170</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14163">#14163</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Discovery-ec2 plugin should check <literal>discovery.type</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13814">#13814</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13581">#13581</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13809">#13809</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Delete By Query
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Delete-by-Query with Shield <ulink url="https://github.com/elastic/elasticsearch/pull/14658">#14658</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14527">#14527</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete by query to not wrap the inner query into an additional query element <ulink url="https://github.com/elastic/elasticsearch/pull/14302">#14302</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13326">#13326</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Mapper Attachment
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix toXContent() for mapper attachments field <ulink url="https://github.com/elastic/elasticsearch/pull/15110">#15110</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Repository S3
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Hack around aws security hole of accessing sun.security.ssl, s3 repository works on java 9 again <ulink url="https://github.com/elastic/elasticsearch/pull/13538">#13538</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/432">#432</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix plugin list command error message <ulink url="https://github.com/elastic/elasticsearch/pull/14288">#14288</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14287">#14287</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parse Java system properties in plugin.bat <ulink url="https://github.com/elastic/elasticsearch/pull/13989">#13989</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13616">#13616</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
PluginManager: Dont leave leftover files on unsuccessful installs <ulink url="https://github.com/elastic/elasticsearch/pull/12851">#12851</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12749">#12749</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix HTML response during redirection <ulink url="https://github.com/elastic/elasticsearch/pull/11374">#11374</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11370">#11370</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix FunctionScore equals/hashCode to include minScore and friends <ulink url="https://github.com/elastic/elasticsearch/pull/15676">#15676</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Min should match greater than the number of optional clauses should return no result <ulink url="https://github.com/elastic/elasticsearch/pull/15571">#15571</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15521">#15521</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return a better exception message when <literal>regexp</literal> query is used on a numeric field <ulink url="https://github.com/elastic/elasticsearch/pull/14910">#14910</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14782">#14782</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw exception when trying to write map with null keys <ulink url="https://github.com/elastic/elasticsearch/pull/15479">#15479</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14346">#14346</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
XContentFactory.xContentType: allow for possible UTF-8 BOM for JSON XContentType <ulink url="https://github.com/elastic/elasticsearch/pull/14611">#14611</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14442">#14442</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restore support for escaped <emphasis>/</emphasis> as part of document id <ulink url="https://github.com/elastic/elasticsearch/pull/14216">#14216</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13665">#13665</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13691">#13691</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14177">#14177</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing REST spec for <literal>detect_noop</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/14004">#14004</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose nodes operation timeout in REST API <ulink url="https://github.com/elastic/elasticsearch/pull/13981">#13981</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure XContent is consistent across platforms <ulink url="https://github.com/elastic/elasticsearch/pull/13816">#13816</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
sync translog to disk after recovery from primary <ulink url="https://github.com/elastic/elasticsearch/pull/15832">#15832</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
CancellableThreads should also treat ThreadInterruptedException as InterruptedException <ulink url="https://github.com/elastic/elasticsearch/pull/15318">#15318</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Security permissions for Groovy closures <ulink url="https://github.com/elastic/elasticsearch/pull/16196">#16196</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/16194">#16194</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NPE when a segment with an empty cache gets closed. <ulink url="https://github.com/elastic/elasticsearch/pull/15202">#15202</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15043">#15043</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix the quotes in the explain message for a script score function without parameters <ulink url="https://github.com/elastic/elasticsearch/pull/11398">#11398</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
TransportClient should use updated setting for initialization of modules and service <ulink url="https://github.com/elastic/elasticsearch/pull/16095">#16095</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t pull translog from shadow engine <ulink url="https://github.com/elastic/elasticsearch/pull/14000">#14000</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12730">#12730</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Snapshot restore and index creates should keep index settings and cluster blocks in sync <ulink url="https://github.com/elastic/elasticsearch/pull/13931">#13931</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13213">#13213</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Snapshot restore operations throttle more than specified <ulink url="https://github.com/elastic/elasticsearch/pull/13828">#13828</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6018">#6018</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix blob size in writeBlob() method <ulink url="https://github.com/elastic/elasticsearch/pull/13574">#13574</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13434">#13434</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calculation of age of pending tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15995">#15995</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15988">#15988</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
serialize os name, arch and version too <ulink url="https://github.com/elastic/elasticsearch/pull/15454">#15454</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15422">#15422</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add extra validation into <literal>cluster/stats</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/14699">#14699</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7390">#7390</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Omit current* stats for OldShardStats <ulink url="https://github.com/elastic/elasticsearch/pull/13801">#13801</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13386">#13386</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make sure IndexShard is active during recovery so it gets its fair share of the indexing buffer <ulink url="https://github.com/elastic/elasticsearch/pull/16209">#16209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16206">#16206</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Avoid circular reference in exception <ulink url="https://github.com/elastic/elasticsearch/pull/15952">#15952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15941">#15941</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Initialize translog before scheduling the sync to disk <ulink url="https://github.com/elastic/elasticsearch/pull/15881">#15881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Translog base flushes can be disabled after replication relocation or slow recovery <ulink url="https://github.com/elastic/elasticsearch/pull/15830">#15830</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10624">#10624</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15814">#15814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Catch tragic even inside the checkpoint method rather than on the caller side <ulink url="https://github.com/elastic/elasticsearch/pull/15825">#15825</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Never delete translog-N.tlog file when creation fails <ulink url="https://github.com/elastic/elasticsearch/pull/15788">#15788</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Close recovered translog readers if createWriter fails <ulink url="https://github.com/elastic/elasticsearch/pull/15762">#15762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15754">#15754</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail and close translog hard if writing to disk fails <ulink url="https://github.com/elastic/elasticsearch/pull/15420">#15420</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15333">#15333</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent writing to closed channel if translog is already closed <ulink url="https://github.com/elastic/elasticsearch/pull/15012">#15012</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14866">#14866</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t delete temp recovered checkpoint file if it was renamed <ulink url="https://github.com/elastic/elasticsearch/pull/14872">#14872</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14695">#14695</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Translog recovery can repeatedly fail if we run out of disk <ulink url="https://github.com/elastic/elasticsearch/pull/14695">#14695</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Tribe node: pass path.conf to inner tribe clients <ulink url="https://github.com/elastic/elasticsearch/pull/16258">#16258</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16253">#16253</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix tribe node to load config file for internal client nodes <ulink url="https://github.com/elastic/elasticsearch/pull/15300">#15300</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13383">#13383</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14573">#14573</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.2.0" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add PathHierarchy type back to path_hierarchy tokenizer for backward compatibility with 1.x <ulink url="https://github.com/elastic/elasticsearch/pull/15785">#15785</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15756">#15756</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate concrete indices after indices resolution <ulink url="https://github.com/elastic/elasticsearch/pull/14316">#14316</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11258">#11258</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12058">#12058</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Filter cloud azure credentials <ulink url="https://github.com/elastic/elasticsearch/pull/14863">#14863</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13779">#13779</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14843">#14843</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
RangeQueryParser should accept <literal>_name</literal> in inner field <ulink url="https://github.com/elastic/elasticsearch/pull/15394">#15394</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15306">#15306</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.2.0" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.2.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to lucene-5.4.1. <ulink url="https://github.com/elastic/elasticsearch/pull/16160">#16160</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.4.0. <ulink url="https://github.com/elastic/elasticsearch/pull/15477">#15477</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Lucene to 5.4.0-snapshot-1715952 <ulink url="https://github.com/elastic/elasticsearch/pull/14951">#14951</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Lucene to 5.4.0-snapshot-1714615 <ulink url="https://github.com/elastic/elasticsearch/pull/14784">#14784</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.4.0-snapshot-1712973. <ulink url="https://github.com/elastic/elasticsearch/pull/14619">#14619</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
update to lucene-5.4.x-snapshot-1711508 <ulink url="https://github.com/elastic/elasticsearch/pull/14398">#14398</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.4-snapshot-1710880. <ulink url="https://github.com/elastic/elasticsearch/pull/14320">#14320</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.4-snapshot-1708254. <ulink url="https://github.com/elastic/elasticsearch/pull/14074">#14074</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
upgrade lucene to r1702265 <ulink url="https://github.com/elastic/elasticsearch/pull/13439">#13439</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade master to lucene 5.4-snapshot r1701068 <ulink url="https://github.com/elastic/elasticsearch/pull/13324">#13324</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update to spatial4j 0.5 for correct Multi-Geometry <ulink url="https://github.com/elastic/elasticsearch/pull/14269">#14269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9904">#9904</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade Netty to 3.10.5.final <ulink url="https://github.com/elastic/elasticsearch/pull/14105">#14105</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update Azure Service Management API to 0.9.0 <ulink url="https://github.com/elastic/elasticsearch/pull/15232">#15232</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15209">#15209</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery EC2
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to aws 1.10.33 <ulink url="https://github.com/elastic/elasticsearch/pull/14672">#14672</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Lang JS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
upgrade rhino for plugins/lang-javascript <ulink url="https://github.com/elastic/elasticsearch/pull/14466">#14466</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.1.2">
<title>2.1.2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.2.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.1"/>.</simpara>
<bridgehead id="enhancement-2.1.2" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only trace log shard not available exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/14950">#14950</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14927">#14927</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add timeout settings (default to 5 minutes) <ulink url="https://github.com/elastic/elasticsearch/pull/15950">#15950</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14277">#14277</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15080">#15080</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check for tragic event on all kinds of exceptions not only ACE and IOException <ulink url="https://github.com/elastic/elasticsearch/pull/15535">#15535</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.1.2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make <literal>missing</literal> on terms aggs work with all execution modes. <ulink url="https://github.com/elastic/elasticsearch/pull/15746">#15746</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14882">#14882</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Check lenient_expand_open after aliases have been resolved <ulink url="https://github.com/elastic/elasticsearch/pull/15882">#15882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13278">#13278</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent peer recovery from node with older version <ulink url="https://github.com/elastic/elasticsearch/pull/15775">#15775</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only fail the relocation target when a replication request on it fails <ulink url="https://github.com/elastic/elasticsearch/pull/15791">#15791</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15790">#15790</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
BitSetFilterCache duplicates its content. <ulink url="https://github.com/elastic/elasticsearch/pull/15836">#15836</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15820">#15820</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Limit the max size of bulk and index thread pools to bounded number of processors <ulink url="https://github.com/elastic/elasticsearch/pull/15585">#15585</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15582">#15582</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
AllTermQuery&#8217;s scorer should skip segments that never saw the requested term <ulink url="https://github.com/elastic/elasticsearch/pull/15506">#15506</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix spans extraction to not also include individual terms. <ulink url="https://github.com/elastic/elasticsearch/pull/15516">#15516</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13239">#13239</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15291">#15291</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Log uncaught exceptions from scheduled once tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15824">#15824</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15814">#15814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix ConcurrentModificationException from nodes info and nodes stats <ulink url="https://github.com/elastic/elasticsearch/pull/15541">#15541</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15537">#15537</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix MapperService#searchFilter(&#8230;) <ulink url="https://github.com/elastic/elasticsearch/pull/15923">#15923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15757">#15757</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix initial sizing of BytesStreamOutput. <ulink url="https://github.com/elastic/elasticsearch/pull/15864">#15864</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15789">#15789</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Windows service installation failure <ulink url="https://github.com/elastic/elasticsearch/pull/15549">#15549</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15349">#15349</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
fix command line options for windows bat file <ulink url="https://github.com/elastic/elasticsearch/pull/15320">#15320</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/15284">#15284</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/16086">#16086</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix FunctionScore equals/hashCode to include minScore and friends <ulink url="https://github.com/elastic/elasticsearch/pull/15676">#15676</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
sync translog to disk after recovery from primary <ulink url="https://github.com/elastic/elasticsearch/pull/15832">#15832</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calculation of age of pending tasks <ulink url="https://github.com/elastic/elasticsearch/pull/15995">#15995</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15988">#15988</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make sure IndexShard is active during recovery so it gets its fair share of the indexing buffer <ulink url="https://github.com/elastic/elasticsearch/pull/16209">#16209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16206">#16206</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Avoid circular reference in exception <ulink url="https://github.com/elastic/elasticsearch/pull/15952">#15952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15941">#15941</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Initialize translog before scheduling the sync to disk <ulink url="https://github.com/elastic/elasticsearch/pull/15881">#15881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Translog base flushes can be disabled after replication relocation or slow recovery <ulink url="https://github.com/elastic/elasticsearch/pull/15830">#15830</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10624">#10624</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15814">#15814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Catch tragic even inside the checkpoint method rather than on the caller side <ulink url="https://github.com/elastic/elasticsearch/pull/15825">#15825</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Never delete translog-N.tlog file when creation fails <ulink url="https://github.com/elastic/elasticsearch/pull/15788">#15788</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Close recovered translog readers if createWriter fails <ulink url="https://github.com/elastic/elasticsearch/pull/15762">#15762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15754">#15754</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Tribe node: pass path.conf to inner tribe clients <ulink url="https://github.com/elastic/elasticsearch/pull/16258">#16258</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/16253">#16253</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.1.2" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add PathHierarchy type back to path_hierarchy tokenizer for backward compatibility with 1.x <ulink url="https://github.com/elastic/elasticsearch/pull/15785">#15785</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15756">#15756</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.1.1">
<title>2.1.1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.1.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.1"/>.</simpara>
<bridgehead id="enhancement-2.1.1" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
[Children agg] fix bug that prevented all child docs from being evaluated <ulink url="https://github.com/elastic/elasticsearch/pull/15457">#15457</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
If we can&#8217;t get a MAC address for the node, use a dummy one <ulink url="https://github.com/elastic/elasticsearch/pull/15266">#15266</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10099">#10099</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify shard inactive logging <ulink url="https://github.com/elastic/elasticsearch/pull/15259">#15259</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15252">#15252</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify IndexingMemoryController#checkIdle <ulink url="https://github.com/elastic/elasticsearch/pull/15252">#15252</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15251">#15251</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
IndexingMemoryController should not track shard index states <ulink url="https://github.com/elastic/elasticsearch/pull/15251">#15251</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13918">#13918</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/15225">#15225</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Disallow index template pattern to be the same as an alias name <ulink url="https://github.com/elastic/elasticsearch/pull/15184">#15184</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14842">#14842</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
throw exception if a copy_to is within a multi field <ulink url="https://github.com/elastic/elasticsearch/pull/15213">#15213</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10802">#10802</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14946">#14946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Register field mappers at the node level. <ulink url="https://github.com/elastic/elasticsearch/pull/14896">#14896</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14828">#14828</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.1.1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Field stats: Index constraints should remove indices in the response if the field to evaluate is empty <ulink url="https://github.com/elastic/elasticsearch/pull/14868">#14868</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw a meaningful error when loading metadata and an alias and index have the same name <ulink url="https://github.com/elastic/elasticsearch/pull/14842">#14842</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14706">#14706</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Multi field names may not contain dots <ulink url="https://github.com/elastic/elasticsearch/pull/15118">#15118</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14957">#14957</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NPE when a segment with an empty cache gets closed. <ulink url="https://github.com/elastic/elasticsearch/pull/15202">#15202</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15043">#15043</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fail and close translog hard if writing to disk fails <ulink url="https://github.com/elastic/elasticsearch/pull/15420">#15420</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15333">#15333</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent writing to closed channel if translog is already closed <ulink url="https://github.com/elastic/elasticsearch/pull/15012">#15012</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14866">#14866</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t delete temp recovered checkpoint file it was renamed <ulink url="https://github.com/elastic/elasticsearch/pull/14872">#14872</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14695">#14695</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix tribe node to load config file for internal client nodes <ulink url="https://github.com/elastic/elasticsearch/pull/15300">#15300</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13383">#13383</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14573">#14573</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.1.1" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
RangeQueryParser should accept <literal>_name</literal> in inner field <ulink url="https://github.com/elastic/elasticsearch/pull/15394">#15394</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15306">#15306</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.1.0">
<title>2.1.0 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.1"/> for important changes in this release.</simpara>
<bridgehead id="breaking-2.1.0" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default detect_noop to true <ulink url="https://github.com/elastic/elasticsearch/pull/11306">#11306</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11282">#11282</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove the experimental indices.fielddata.cache.expire <ulink url="https://github.com/elastic/elasticsearch/pull/13173">#13173</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10781">#10781</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add Force Merge API, deprecate Optimize API <ulink url="https://github.com/elastic/elasticsearch/pull/13778">#13778</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Forbid changing thread pool types <ulink url="https://github.com/elastic/elasticsearch/pull/14367">#14367</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14294">#14294</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2509">#2509</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2858">#2858</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5152">#5152</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecates defaultRescoreWindowSize <ulink url="https://github.com/elastic/elasticsearch/pull/13995">#13995</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Nested Docs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
If sorting by nested field then the <literal>nested_path</literal> should always be specified <ulink url="https://github.com/elastic/elasticsearch/pull/13429">#13429</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13420">#13420</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Limit the size of the result window to a dynamic property <ulink url="https://github.com/elastic/elasticsearch/pull/13188">#13188</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9311">#9311</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
The queue_size value should be shown as an integer. <ulink url="https://github.com/elastic/elasticsearch/pull/13063">#13063</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10404">#10404</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.1.0" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate the count api in favour of search with size 0 <ulink url="https://github.com/elastic/elasticsearch/pull/14165">#14165</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13928">#13928</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate <literal>score_type</literal> option in favour of the <literal>score_mode</literal> option <ulink url="https://github.com/elastic/elasticsearch/pull/13478">#13478</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate NotQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/14203">#14203</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13761">#13761</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate _search/exists in favour of regular _search with size 0 and terminate_after 1 <ulink url="https://github.com/elastic/elasticsearch/pull/13910">#13910</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13682">#13682</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate the <literal>scan</literal> search type. <ulink url="https://github.com/elastic/elasticsearch/pull/12994">#12994</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12983">#12983</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="feature-2.1.0" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>percentiles_bucket</literal> pipeline aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/13186">#13186</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>stats_bucket</literal> / <literal>extended_stats_bucket</literal> pipeline aggs <ulink url="https://github.com/elastic/elasticsearch/pull/13128">#13128</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Lithuanian analysis <ulink url="https://github.com/elastic/elasticsearch/pull/13244">#13244</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adds geo_centroid metric aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/13846">#13846</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13621">#13621</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.1.0" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add cluster-wide setting for total shard limit <ulink url="https://github.com/elastic/elasticsearch/pull/14563">#14563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14456">#14456</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Early terminate high disk watermark checks on single data node cluster <ulink url="https://github.com/elastic/elasticsearch/pull/13882">#13882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9391">#9391</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Also use PriorityComparator in shard balancer <ulink url="https://github.com/elastic/elasticsearch/pull/13256">#13256</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13249">#13249</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for filtering by publish IP address <ulink url="https://github.com/elastic/elasticsearch/pull/8801">#8801</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add duration field to /_cat/snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/14385">#14385</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add cat API for repositories and snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/14247">#14247</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13919">#13919</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds disk used by indices to _cat/allocation <ulink url="https://github.com/elastic/elasticsearch/pull/13783">#13783</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13529">#13529</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Verify Checksum once it has been fully written to fail as soon as possible <ulink url="https://github.com/elastic/elasticsearch/pull/13896">#13896</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate cause if already contained in shard failures <ulink url="https://github.com/elastic/elasticsearch/pull/14432">#14432</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Give a better exception when running from freebsd jail without enforce_statfs=1 <ulink url="https://github.com/elastic/elasticsearch/pull/14135">#14135</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12018">#12018</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make root_cause of field conflicts more obvious <ulink url="https://github.com/elastic/elasticsearch/pull/13976">#13976</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12839">#12839</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use a dedicated id to serialize EsExceptions instead of it&#8217;s class name. <ulink url="https://github.com/elastic/elasticsearch/pull/13629">#13629</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Validate class before cast. <ulink url="https://github.com/elastic/elasticsearch/pull/12913">#12913</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12842">#12842</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve error message of ClassCastExceptions  <ulink url="https://github.com/elastic/elasticsearch/pull/12821">#12821</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12135">#12135</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Refactor geo_point validate* and normalize* for 2.x <ulink url="https://github.com/elastic/elasticsearch/pull/12742">#12742</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10170">#10170</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12300">#12300</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Limit type name length <ulink url="https://github.com/elastic/elasticsearch/pull/13036">#13036</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13021">#13021</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Accumulate validation errors when validating index templates <ulink url="https://github.com/elastic/elasticsearch/pull/12901">#12901</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12900">#12900</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix dangling comma in ClusterBlock#toString <ulink url="https://github.com/elastic/elasticsearch/pull/14483">#14483</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve some logging around master election and cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/14481">#14481</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add workaround for JDK-8014008 <ulink url="https://github.com/elastic/elasticsearch/pull/14274">#14274</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup IndexMetaData <ulink url="https://github.com/elastic/elasticsearch/pull/14119">#14119</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
More helpful error message on parameter order <ulink url="https://github.com/elastic/elasticsearch/pull/13737">#13737</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup InternalClusterInfoService <ulink url="https://github.com/elastic/elasticsearch/pull/13543">#13543</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove and forbid use of com.google.common.base.Throwables <ulink url="https://github.com/elastic/elasticsearch/pull/13409">#13409</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13224">#13224</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove cyclic dependencies between IndexService and FieldData / BitSet caches <ulink url="https://github.com/elastic/elasticsearch/pull/13381">#13381</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove and forbid use of com.google.common.base.Objects <ulink url="https://github.com/elastic/elasticsearch/pull/13355">#13355</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13224">#13224</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove and forbid use of com.google.common.collect.ImmutableList <ulink url="https://github.com/elastic/elasticsearch/pull/13227">#13227</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13224">#13224</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove and forbid use of com.google.common.collect.Lists <ulink url="https://github.com/elastic/elasticsearch/pull/13170">#13170</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused code from query_string parser and settings <ulink url="https://github.com/elastic/elasticsearch/pull/13098">#13098</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate duplicate logic in RoutingTable all*ShardsGrouped <ulink url="https://github.com/elastic/elasticsearch/pull/13082">#13082</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13081">#13081</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Turn DestructiveOperations.java into a Guice module. <ulink url="https://github.com/elastic/elasticsearch/pull/13046">#13046</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4665">#4665</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove CachedDfSource <ulink url="https://github.com/elastic/elasticsearch/pull/12973">#12973</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12864">#12864</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enable indy (invokedynamic) compile flag for Groovy scripts by default <ulink url="https://github.com/elastic/elasticsearch/pull/8201">#8201</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8184">#8184</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevents users from building a BulkProcessor with a null client <ulink url="https://github.com/elastic/elasticsearch/pull/12497">#12497</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Move logging for the amount of free disk to TRACE <ulink url="https://github.com/elastic/elasticsearch/pull/14403">#14403</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12843">#12843</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Drop ability to execute on Solaris <ulink url="https://github.com/elastic/elasticsearch/pull/14200">#14200</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Nuke ES_CLASSPATH appending, JarHell fail on empty classpath elements <ulink url="https://github.com/elastic/elasticsearch/pull/13880">#13880</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13812">#13812</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13864">#13864</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
improve seccomp syscall filtering <ulink url="https://github.com/elastic/elasticsearch/pull/13829">#13829</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Block process execution with seccomp on linux/amd64 <ulink url="https://github.com/elastic/elasticsearch/pull/13753">#13753</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove JAVA_HOME detection from the debian init script <ulink url="https://github.com/elastic/elasticsearch/pull/13514">#13514</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13403">#13403</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9774">#9774</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Enable S3SignerType <ulink url="https://github.com/elastic/elasticsearch/pull/13360">#13360</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13332">#13332</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>cloud.account</literal> and <literal>cloud.key</literal> settings <ulink url="https://github.com/elastic/elasticsearch/pull/12978">#12978</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12809">#12809</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
cloud-gce plugin should check <literal>discovery.type</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13809">#13809</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13614">#13614</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery EC2
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adding US-Gov-West <ulink url="https://github.com/elastic/elasticsearch/pull/14358">#14358</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improved building of disco nodes <ulink url="https://github.com/elastic/elasticsearch/pull/14155">#14155</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Repository S3
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add aws canned acl <ulink url="https://github.com/elastic/elasticsearch/pull/14297">#14297</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14103">#14103</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t be lenient in PluginService#processModule(Module) <ulink url="https://github.com/elastic/elasticsearch/pull/14306">#14306</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adds a validation for plugins script to check if java is set <ulink url="https://github.com/elastic/elasticsearch/pull/13633">#13633</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13613">#13613</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugins: Removed plugin.types <ulink url="https://github.com/elastic/elasticsearch/pull/13055">#13055</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve java version comparison and explicitly enforce a version format <ulink url="https://github.com/elastic/elasticsearch/pull/13010">#13010</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12441">#12441</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13009">#13009</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Output plugin info only in verbose mode <ulink url="https://github.com/elastic/elasticsearch/pull/12908">#12908</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12907">#12907</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Internal: simplify filtered query conversion to lucene query <ulink url="https://github.com/elastic/elasticsearch/pull/13312">#13312</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13272">#13272</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unsupported <literal>rewrite</literal> from multi_match query builder <ulink url="https://github.com/elastic/elasticsearch/pull/13073">#13073</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13069">#13069</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unsupported <literal>rewrite</literal> option from match query builder <ulink url="https://github.com/elastic/elasticsearch/pull/13069">#13069</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make FunctionScore work on unmapped field with <literal>missing</literal> parameter <ulink url="https://github.com/elastic/elasticsearch/pull/13060">#13060</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10948">#10948</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add property permissions so groovy scripts can serialize json <ulink url="https://github.com/elastic/elasticsearch/pull/14500">#14500</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14488">#14488</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scroll
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Optimize sorted scroll when sorting by <literal>_doc</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/12983">#12983</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
fix numerical issue in function score query <ulink url="https://github.com/elastic/elasticsearch/pull/14085">#14085</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Optimize scrolls for constant-score queries. <ulink url="https://github.com/elastic/elasticsearch/pull/13311">#13311</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Optimize counts on simple queries. <ulink url="https://github.com/elastic/elasticsearch/pull/13037">#13037</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adds template support to _msearch resource <ulink url="https://github.com/elastic/elasticsearch/pull/12414">#12414</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10885">#10885</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Simplify the BlobContainer blob writing interface <ulink url="https://github.com/elastic/elasticsearch/pull/13434">#13434</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>readonly</literal> option for repositories <ulink url="https://github.com/elastic/elasticsearch/pull/13144">#13144</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11753">#11753</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7831">#7831</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add os.allocated_processors stats <ulink url="https://github.com/elastic/elasticsearch/pull/14409">#14409</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13917">#13917</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds stats counter for failed indexing requests <ulink url="https://github.com/elastic/elasticsearch/pull/13130">#13130</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8938">#8938</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.1.0" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Pass extended bounds into HistogramAggregator when creating an unmapped aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/14742">#14742</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14735">#14735</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added correct generic type parameter on ScriptedMetricBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/14018">#14018</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13986">#13986</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pipeline Aggregations at the root of the agg tree are now validated <ulink url="https://github.com/elastic/elasticsearch/pull/13475">#13475</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13179">#13179</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Estimate HyperLogLog bias via k-NN regression <ulink url="https://github.com/elastic/elasticsearch/pull/13243">#13243</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calculation of next delay for delayed shard allocation <ulink url="https://github.com/elastic/elasticsearch/pull/14765">#14765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Take ignored unallocated shards into account when making allocation decision <ulink url="https://github.com/elastic/elasticsearch/pull/14678">#14678</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14670">#14670</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only allow rebalance operations to run if all shard store data is available <ulink url="https://github.com/elastic/elasticsearch/pull/14591">#14591</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14387">#14387</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delayed allocation can miss a reroute <ulink url="https://github.com/elastic/elasticsearch/pull/14494">#14494</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14010">#14010</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14011">#14011</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14445">#14445</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check rebalancing constraints when shards are moved from a node they can no longer remain on <ulink url="https://github.com/elastic/elasticsearch/pull/14259">#14259</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14057">#14057</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Properly set indices and indicesOptions on subrequest made by /_cat/indices <ulink url="https://github.com/elastic/elasticsearch/pull/14360">#14360</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Index name expressions should not be broken up <ulink url="https://github.com/elastic/elasticsearch/pull/13691">#13691</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13665">#13665</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle shards assigned to nodes that are not in the cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/14586">#14586</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14584">#14584</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use fresh index settings instead of relying on @IndexSettings <ulink url="https://github.com/elastic/elasticsearch/pull/14578">#14578</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14319">#14319</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fork Lucene PatternTokenizer to apply LUCENE-6814 (closes #13721) <ulink url="https://github.com/elastic/elasticsearch/pull/14571">#14571</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13721">#13721</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Record all bytes of the checksum in VerifyingIndexOutput <ulink url="https://github.com/elastic/elasticsearch/pull/13923">#13923</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13848">#13848</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13896">#13896</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
When shard becomes active again, immediately increase its indexing buffer <ulink url="https://github.com/elastic/elasticsearch/pull/13918">#13918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13802">#13802</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Close TokenStream in finally clause <ulink url="https://github.com/elastic/elasticsearch/pull/13870">#13870</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11947">#11947</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
LoggingRunnable.run should catch and log all errors, not just Exception? <ulink url="https://github.com/elastic/elasticsearch/pull/13718">#13718</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13487">#13487</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix ensureNodesAreAvailable&#8217;s error message <ulink url="https://github.com/elastic/elasticsearch/pull/14007">#14007</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13957">#13957</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t cache top level field data for fields that don&#8217;t exist <ulink url="https://github.com/elastic/elasticsearch/pull/14693">#14693</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Geo: Allow numeric parameters enclosed in quotes for <emphasis>geohash_grid</emphasis> aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/14440">#14440</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13132">#13132</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Resync Geopoint hashCode/equals method <ulink url="https://github.com/elastic/elasticsearch/pull/14124">#14124</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14083">#14083</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix GeoPointFieldMapper to index geohash at correct precision. <ulink url="https://github.com/elastic/elasticsearch/pull/13649">#13649</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12467">#12467</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Field stats: Fix NPE for index constraint on empty index <ulink url="https://github.com/elastic/elasticsearch/pull/14841">#14841</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Field stats: Added <literal>format</literal> option for index constraints <ulink url="https://github.com/elastic/elasticsearch/pull/14823">#14823</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14804">#14804</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restore previous optimize transport action name for bw comp <ulink url="https://github.com/elastic/elasticsearch/pull/14221">#14221</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13778">#13778</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Forbid index name <literal>.</literal> and <literal>..</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13862">#13862</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13858">#13858</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Validate settings specified in index templates at template creation time <ulink url="https://github.com/elastic/elasticsearch/pull/12892">#12892</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12865">#12865</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
fix <literal>mvn verify</literal> on jigsaw with 2.1 <ulink url="https://github.com/elastic/elasticsearch/pull/14750">#14750</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
fixup issues with 32-bit jvm <ulink url="https://github.com/elastic/elasticsearch/pull/14609">#14609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Failure to update the cluster state with the recovered state should make sure it will be recovered later <ulink url="https://github.com/elastic/elasticsearch/pull/14485">#14485</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Gateway: a race condition can prevent the initial cluster state from being recovered <ulink url="https://github.com/elastic/elasticsearch/pull/13997">#13997</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Verify actually written checksum in VerifyingIndexOutput <ulink url="https://github.com/elastic/elasticsearch/pull/13848">#13848</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
An inactive shard is activated by triggered synced flush <ulink url="https://github.com/elastic/elasticsearch/pull/13802">#13802</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t log multi-megabyte guice exceptions. <ulink url="https://github.com/elastic/elasticsearch/pull/13782">#13782</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Moving system property setting to before it can be used <ulink url="https://github.com/elastic/elasticsearch/pull/13660">#13660</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13658">#13658</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make _type use doc values <ulink url="https://github.com/elastic/elasticsearch/pull/14783">#14783</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14781">#14781</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Mapping: Allows upgrade of indexes with only search_analyzer specified <ulink url="https://github.com/elastic/elasticsearch/pull/14677">#14677</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14383">#14383</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle system policy correctly <ulink url="https://github.com/elastic/elasticsearch/pull/14704">#14704</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14690">#14690</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Startup script exit status should catch daemonized startup failures <ulink url="https://github.com/elastic/elasticsearch/pull/14170">#14170</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14163">#14163</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t let ubuntu try to install its crazy jayatana agent. <ulink url="https://github.com/elastic/elasticsearch/pull/13813">#13813</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13785">#13785</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove unnecessary usage of extra index searchers <ulink url="https://github.com/elastic/elasticsearch/pull/12864">#12864</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Delete By Query
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Delete-by-Query with Shield <ulink url="https://github.com/elastic/elasticsearch/pull/14658">#14658</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14527">#14527</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete by query to not wrap the inner query into an additional query element <ulink url="https://github.com/elastic/elasticsearch/pull/14302">#14302</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13326">#13326</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix plugin list command error message <ulink url="https://github.com/elastic/elasticsearch/pull/14288">#14288</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14287">#14287</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix HTML response during redirection <ulink url="https://github.com/elastic/elasticsearch/pull/11374">#11374</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11370">#11370</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
XContentFactory.xContentType: allow for possible UTF-8 BOM for JSON XContentType <ulink url="https://github.com/elastic/elasticsearch/pull/14611">#14611</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14442">#14442</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
RestUtils.decodeQueryString ignores the URI fragment when parsing a query string <ulink url="https://github.com/elastic/elasticsearch/pull/13365">#13365</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13320">#13320</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix the quotes in the explain message for a script score function without parameters <ulink url="https://github.com/elastic/elasticsearch/pull/11398">#11398</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
ByteSizeValue.equals should normalize units <ulink url="https://github.com/elastic/elasticsearch/pull/13784">#13784</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Snapshot restore and index creates should keep index settings and cluster blocks in sync <ulink url="https://github.com/elastic/elasticsearch/pull/13931">#13931</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13213">#13213</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix blob size in writeBlob() method <ulink url="https://github.com/elastic/elasticsearch/pull/13574">#13574</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13434">#13434</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add extra validation into <literal>cluster/stats</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/14699">#14699</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7390">#7390</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Omit current* stats for OldShardStats <ulink url="https://github.com/elastic/elasticsearch/pull/13801">#13801</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13386">#13386</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Translog recovery can repeatedly fail if we run out of disk <ulink url="https://github.com/elastic/elasticsearch/pull/14695">#14695</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Pending operations in the translog prevent shard from being marked as inactive <ulink url="https://github.com/elastic/elasticsearch/pull/13759">#13759</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13707">#13707</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.1.0" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate concrete indices after indices resolution <ulink url="https://github.com/elastic/elasticsearch/pull/14316">#14316</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11258">#11258</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12058">#12058</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.1.0" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.1.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade Lucene to 5.3.1 <ulink url="https://github.com/elastic/elasticsearch/pull/14669">#14669</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.3.0. <ulink url="https://github.com/elastic/elasticsearch/pull/13239">#13239</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update to spatial4j 0.5 for correct Multi-Geometry <ulink url="https://github.com/elastic/elasticsearch/pull/14269">#14269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9904">#9904</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update to Jackson 2.6.2 <ulink url="https://github.com/elastic/elasticsearch/pull/13344">#13344</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10980">#10980</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/207">#207</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/213">#213</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update AWS SDK version to 1.10.19 <ulink url="https://github.com/elastic/elasticsearch/pull/13655">#13655</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13656">#13656</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Discovery EC2
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to aws 1.10.33 <ulink url="https://github.com/elastic/elasticsearch/pull/14672">#14672</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.2">
<title>2.0.2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.2.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.0"/>.</simpara>
<bridgehead id="bug-2.0.2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
[Children agg] fix bug that prevented all child docs from being evaluated <ulink url="https://github.com/elastic/elasticsearch/pull/15457">#15457</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Field stats: Index constraints should remove indices in the response if the field to evaluate is empty <ulink url="https://github.com/elastic/elasticsearch/pull/14868">#14868</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Field stats: Fix NPE for index constraint on empty index <ulink url="https://github.com/elastic/elasticsearch/pull/14841">#14841</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw a meaningful error when loading metadata and an alias and index have the same name <ulink url="https://github.com/elastic/elasticsearch/pull/14842">#14842</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14706">#14706</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Multi field names may not contain dots <ulink url="https://github.com/elastic/elasticsearch/pull/15118">#15118</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14957">#14957</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fail and close translog hard if writing to disk fails <ulink url="https://github.com/elastic/elasticsearch/pull/15420">#15420</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/15333">#15333</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent writing to closed channel if translog is already closed <ulink url="https://github.com/elastic/elasticsearch/pull/15012">#15012</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14866">#14866</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t delete temp recovered checkpoint file it was renamed <ulink url="https://github.com/elastic/elasticsearch/pull/14872">#14872</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14695">#14695</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.1">
<title>2.0.1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.1.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.0"/>.</simpara>
<bridgehead id="bug-2.0.1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Pass extended bounds into HistogramAggregator when creating an unmapped aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/14742">#14742</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14735">#14735</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix calculation of next delay for delayed shard allocation <ulink url="https://github.com/elastic/elasticsearch/pull/14765">#14765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Take ignored unallocated shards into account when making allocation decision <ulink url="https://github.com/elastic/elasticsearch/pull/14678">#14678</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14670">#14670</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only allow rebalance operations to run if all shard store data is available <ulink url="https://github.com/elastic/elasticsearch/pull/14591">#14591</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14387">#14387</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delayed allocation can miss a reroute <ulink url="https://github.com/elastic/elasticsearch/pull/14494">#14494</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/14010">#14010</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14011">#14011</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14445">#14445</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Properly set indices and indicesOptions on subrequest made by /_cat/indices <ulink url="https://github.com/elastic/elasticsearch/pull/14360">#14360</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Handle shards assigned to nodes that are not in the cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/14586">#14586</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14584">#14584</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fork Lucene PatternTokenizer to apply LUCENE-6814 (closes #13721) <ulink url="https://github.com/elastic/elasticsearch/pull/14571">#14571</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13721">#13721</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t cache top level field data for fields that don&#8217;t exist <ulink url="https://github.com/elastic/elasticsearch/pull/14693">#14693</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Field stats: Added <literal>format</literal> option for index constraints <ulink url="https://github.com/elastic/elasticsearch/pull/14823">#14823</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14804">#14804</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mapping: Allows upgrade of indexes with only search_analyzer specified <ulink url="https://github.com/elastic/elasticsearch/pull/14677">#14677</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14383">#14383</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Delete By Query
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix Delete-by-Query with Shield <ulink url="https://github.com/elastic/elasticsearch/pull/14658">#14658</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14527">#14527</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete by query to not wrap the inner query into an additional query element <ulink url="https://github.com/elastic/elasticsearch/pull/14302">#14302</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13326">#13326</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use plugin name from plugin&#8217;s properties file rather than plugin&#8217;s class <ulink url="https://github.com/elastic/elasticsearch/pull/14479">#14479</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14357">#14357</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix plugin list command error message <ulink url="https://github.com/elastic/elasticsearch/pull/14288">#14288</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14287">#14287</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix HTML response during redirection <ulink url="https://github.com/elastic/elasticsearch/pull/11374">#11374</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11370">#11370</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
XContentFactory.xContentType: allow for possible UTF-8 BOM for JSON XContentType <ulink url="https://github.com/elastic/elasticsearch/pull/14611">#14611</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14442">#14442</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Backport #8201 to 2.0 and disable by default <ulink url="https://github.com/elastic/elasticsearch/pull/14283">#14283</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14273">#14273</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Omit current* stats for OldShardStats <ulink url="https://github.com/elastic/elasticsearch/pull/13801">#13801</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13386">#13386</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Translog recovery can repeatedly fail if we run out of disk <ulink url="https://github.com/elastic/elasticsearch/pull/14695">#14695</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.0.1" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate concrete indices after indices resolution <ulink url="https://github.com/elastic/elasticsearch/pull/14316">#14316</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11258">#11258</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12058">#12058</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.0">
<title>2.0.0 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></title>
<simpara>Also see <xref linkend="breaking-changes-2.0"/>.</simpara>
<bridgehead id="breaking-2.0.0" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove option to configure custom config file via CONF_FILE or -Des.default.conf <ulink url="https://github.com/elastic/elasticsearch/pull/13772">#13772</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12712">#12712</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12954">#12954</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13715">#13715</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5329">#5329</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.0.0" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate <literal>index.analysis.analyzer.default_index</literal> in favor of <literal>index.analysis.analyzer.default</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/14027">#14027</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11861">#11861</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.0.0" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make PerThreadIDAndVersionLookup per-segment <ulink url="https://github.com/elastic/elasticsearch/pull/14070">#14070</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Packaging: change permissions/ownership of config dir <ulink url="https://github.com/elastic/elasticsearch/pull/14017">#14017</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Release: Fix package repo path to only consist of major version <ulink url="https://github.com/elastic/elasticsearch/pull/13971">#13971</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12493">#12493</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>_gce_</literal> network host setting <ulink url="https://github.com/elastic/elasticsearch/pull/13612">#13612</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13590">#13590</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13605">#13605</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
check "plugin already installed" before jar hell check. <ulink url="https://github.com/elastic/elasticsearch/pull/14207">#14207</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14205">#14205</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugin script to set proper plugin bin dir attributes <ulink url="https://github.com/elastic/elasticsearch/pull/14088">#14088</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugin script to set proper plugin config dir attributes <ulink url="https://github.com/elastic/elasticsearch/pull/14048">#14048</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11016">#11016</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
TransportNodesAction shouldn&#8217;t hold on to cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/13948">#13948</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.0.0" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Send response for update request when it timed out <ulink url="https://github.com/elastic/elasticsearch/pull/13101">#13101</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Never wrap searcher for internal engine operations <ulink url="https://github.com/elastic/elasticsearch/pull/14071">#14071</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add GeoPoint in StreamInput/StreamOutput <ulink url="https://github.com/elastic/elasticsearch/pull/13632">#13632</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13340">#13340</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Properly bind ClassSet extensions as singletons <ulink url="https://github.com/elastic/elasticsearch/pull/14232">#14232</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/14194">#14194</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Streamline top level reader close listeners and forbid general usage <ulink url="https://github.com/elastic/elasticsearch/pull/14084">#14084</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Settings in log config file should not overwrite custom parameters <ulink url="https://github.com/elastic/elasticsearch/pull/13934">#13934</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Plugin cli tool should not create empty log files <ulink url="https://github.com/elastic/elasticsearch/pull/13933">#13933</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mappings: Enforce metadata fields are not passed in documents <ulink url="https://github.com/elastic/elasticsearch/pull/14003">#14003</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11074">#11074</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13740">#13740</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/3517">#3517</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Discovery-ec2 plugin should check <literal>discovery.type</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13814">#13814</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13581">#13581</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13809">#13809</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Parse Java system properties in plugin.bat <ulink url="https://github.com/elastic/elasticsearch/pull/13989">#13989</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13616">#13616</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
PluginManager: Dont leave leftover files on unsuccessful installs <ulink url="https://github.com/elastic/elasticsearch/pull/12851">#12851</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12749">#12749</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Restore support for escaped <emphasis>/</emphasis> as part of document id <ulink url="https://github.com/elastic/elasticsearch/pull/14216">#14216</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13665">#13665</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13691">#13691</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/14177">#14177</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing REST spec for <literal>detect_noop</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/14004">#14004</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose nodes operation timeout in REST API <ulink url="https://github.com/elastic/elasticsearch/pull/13981">#13981</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure XContent is consistent across platforms <ulink url="https://github.com/elastic/elasticsearch/pull/13816">#13816</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t pull translog from shadow engine <ulink url="https://github.com/elastic/elasticsearch/pull/14000">#14000</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12730">#12730</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Snapshot restore operations throttle more than specified <ulink url="https://github.com/elastic/elasticsearch/pull/13828">#13828</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6018">#6018</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.0.0" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade Netty to 3.10.5.final <ulink url="https://github.com/elastic/elasticsearch/pull/14105">#14105</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.0-rc1">
<title>2.0.0-rc1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-rc1.asciidoc">Edit me</ulink></title>
<bridgehead id="enhancement-2.0.0-rc1" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-rc1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make ElasticsearchException ids for 2.0 consistent with master <ulink url="https://github.com/elastic/elasticsearch/pull/13805">#13805</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use a dedicated id to serialize EsExceptions instead of it&#8217;s class name. <ulink url="https://github.com/elastic/elasticsearch/pull/13629">#13629</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Expose points_only option through geo_shape field mapper <ulink url="https://github.com/elastic/elasticsearch/pull/12893">#12893</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12856">#12856</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
More helpful error message on parameter order <ulink url="https://github.com/elastic/elasticsearch/pull/13737">#13737</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Expose all addresses that the transports are bound to <ulink url="https://github.com/elastic/elasticsearch/pull/13586">#13586</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12942">#12942</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Nuke ES_CLASSPATH appending, JarHell fail on empty classpath elements <ulink url="https://github.com/elastic/elasticsearch/pull/13880">#13880</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13812">#13812</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13864">#13864</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Enable SSL for Azure blob storage  <ulink url="https://github.com/elastic/elasticsearch/pull/13573">#13573</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
cloud-gce plugin should check <literal>discovery.type</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13809">#13809</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13614">#13614</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adds a validation for plugins script to check if java is set <ulink url="https://github.com/elastic/elasticsearch/pull/13633">#13633</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13613">#13613</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove index.buffer_size setting <ulink url="https://github.com/elastic/elasticsearch/pull/13563">#13563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13548">#13548</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.0.0-rc1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-rc1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Index name expressions should not be broken up <ulink url="https://github.com/elastic/elasticsearch/pull/13691">#13691</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13665">#13665</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
LoggingRunnable.run should catch and log all errors, not just Exception? <ulink url="https://github.com/elastic/elasticsearch/pull/13718">#13718</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13487">#13487</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve IndexingMemoryController a bit <ulink url="https://github.com/elastic/elasticsearch/pull/13548">#13548</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13487">#13487</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent losing stacktraces when exceptions occur <ulink url="https://github.com/elastic/elasticsearch/pull/13587">#13587</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix GeoPointFieldMapper to index geohash at correct precision. <ulink url="https://github.com/elastic/elasticsearch/pull/13649">#13649</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12467">#12467</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Date math index names should work too when an index doesn&#8217;t exist <ulink url="https://github.com/elastic/elasticsearch/pull/13570">#13570</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
IndexNameExpressionResolver should not ignore any wildcards <ulink url="https://github.com/elastic/elasticsearch/pull/13384">#13384</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13334">#13334</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
An inactive shard is activated by triggered synced flush <ulink url="https://github.com/elastic/elasticsearch/pull/13802">#13802</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t log multi-megabyte guice exceptions. <ulink url="https://github.com/elastic/elasticsearch/pull/13782">#13782</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Moving system property setting to before it can be used <ulink url="https://github.com/elastic/elasticsearch/pull/13660">#13660</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13658">#13658</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t let ubuntu try to install its crazy jayatana agent. <ulink url="https://github.com/elastic/elasticsearch/pull/13813">#13813</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13785">#13785</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove unused java opts/es java opts from plugin manager call <ulink url="https://github.com/elastic/elasticsearch/pull/12801">#12801</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12479">#12479</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
ByteSizeValue.equals should normalize units <ulink url="https://github.com/elastic/elasticsearch/pull/13784">#13784</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Pending operations in the translog prevent shard from being marked as inactive <ulink url="https://github.com/elastic/elasticsearch/pull/13759">#13759</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13707">#13707</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Increment tribe node version on updates <ulink url="https://github.com/elastic/elasticsearch/pull/13566">#13566</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.0-beta2">
<title>2.0.0-beta2 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></title>
<bridgehead id="breaking-2.0.0-beta2" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default _cat verbose to false <ulink url="https://github.com/elastic/elasticsearch/pull/13180">#13180</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13156">#13156</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove usage of tuple as a method parameter <ulink url="https://github.com/elastic/elasticsearch/pull/13135">#13135</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10787">#10787</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rename position_offset_gap to position_increment_gap <ulink url="https://github.com/elastic/elasticsearch/pull/13056">#13056</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12562">#12562</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Default position_offset_gap to 100 <ulink url="https://github.com/elastic/elasticsearch/pull/12544">#12544</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7268">#7268</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove environment from transport client <ulink url="https://github.com/elastic/elasticsearch/pull/13383">#13383</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13155">#13155</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.0.0-beta2" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Refactor geo_point validate_* and normalize_* for 1.7 <ulink url="https://github.com/elastic/elasticsearch/pull/12300">#12300</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query DSL: deprecate _name and boost in short variants of queries <ulink url="https://github.com/elastic/elasticsearch/pull/12966">#12966</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11744">#11744</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.0.0-beta2" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Manual synchronization when iterating over listeners in InternalClusterInfoService <ulink url="https://github.com/elastic/elasticsearch/pull/13270">#13270</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3">#3</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make mlockall configuration easier. <ulink url="https://github.com/elastic/elasticsearch/pull/13057">#13057</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
add default impl for resolveIndex() <ulink url="https://github.com/elastic/elasticsearch/pull/13218">#13218</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed the <literal>operation_threaded</literal> option. <ulink url="https://github.com/elastic/elasticsearch/pull/13119">#13119</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12395">#12395</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove SpawnModules <ulink url="https://github.com/elastic/elasticsearch/pull/13034">#13034</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12783">#12783</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Refactor ignore_malformed and coerce GeoPointFieldType to Builder <ulink url="https://github.com/elastic/elasticsearch/pull/13289">#13289</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13285">#13285</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove broadcast address check. <ulink url="https://github.com/elastic/elasticsearch/pull/13328">#13328</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13327">#13327</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Convert upgrade action to broadcast by node <ulink url="https://github.com/elastic/elasticsearch/pull/13205">#13205</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13204">#13204</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add mechanism for transporting shard-level actions by node <ulink url="https://github.com/elastic/elasticsearch/pull/12944">#12944</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7990">#7990</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Replace HTTP urls with HTTPS in PluginManager <ulink url="https://github.com/elastic/elasticsearch/pull/12824">#12824</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12748">#12748</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add favicon <ulink url="https://github.com/elastic/elasticsearch/pull/13054">#13054</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Stop o.e.c.s.Settings from leaking Guava dependency <ulink url="https://github.com/elastic/elasticsearch/pull/13517">#13517</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13224">#13224</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Sort thread pools by name in Nodes Stats <ulink url="https://github.com/elastic/elasticsearch/pull/13121">#13121</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose shards data and state path via ShardStats <ulink url="https://github.com/elastic/elasticsearch/pull/13118">#13118</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13106">#13106</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Warmers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Warmers delete _all should not throw exception when no warmers <ulink url="https://github.com/elastic/elasticsearch/pull/13058">#13058</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8991">#8991</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.0.0-beta2" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
GeoDistance Aggregation now prints field name when it finds an unexpected token. <ulink url="https://github.com/elastic/elasticsearch/pull/13033">#13033</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12391">#12391</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Take relocating shard into consideration during awareness allocation <ulink url="https://github.com/elastic/elasticsearch/pull/13512">#13512</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12551">#12551</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Take Shard data path into account in DiskThresholdDecider <ulink url="https://github.com/elastic/elasticsearch/pull/13195">#13195</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13106">#13106</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expand ClusterInfo to provide min / max disk usage for allocation decider <ulink url="https://github.com/elastic/elasticsearch/pull/13163">#13163</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13106">#13106</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Take initializing shards into consideration during awareness allocation <ulink url="https://github.com/elastic/elasticsearch/pull/12551">#12551</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12522">#12522</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Engine: refresh before translog commit <ulink url="https://github.com/elastic/elasticsearch/pull/13414">#13414</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13379">#13379</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix exception handling for unavailable shards in broadcast replication action <ulink url="https://github.com/elastic/elasticsearch/pull/13341">#13341</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13068">#13068</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Call <literal>beforeIndexShardCreated</literal> listener earlier in <literal>createShard</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/13153">#13153</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Detect duplicate settings keys on startup <ulink url="https://github.com/elastic/elasticsearch/pull/13086">#13086</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13079">#13079</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t check if directory is present to prevent races <ulink url="https://github.com/elastic/elasticsearch/pull/13049">#13049</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Engine: Let AlreadyClosedException and EngineClosedExceptionBubble up <ulink url="https://github.com/elastic/elasticsearch/pull/13380">#13380</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13266">#13266</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Inner Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Protected against large size option <ulink url="https://github.com/elastic/elasticsearch/pull/13416">#13416</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13394">#13394</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add listeners for postIndex, postCreate, and postDelete <ulink url="https://github.com/elastic/elasticsearch/pull/13203">#13203</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13202">#13202</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make refresh a replicated action <ulink url="https://github.com/elastic/elasticsearch/pull/13068">#13068</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12600">#12600</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9421">#9421</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pass down the EngineConfig to IndexSearcherWrapper <ulink url="https://github.com/elastic/elasticsearch/pull/12883">#12883</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Split the _parent field mapping&#8217;s field type into two field types <ulink url="https://github.com/elastic/elasticsearch/pull/13399">#13399</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13169">#13169</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix numerous checks for equality and compatibility in mapper field types <ulink url="https://github.com/elastic/elasticsearch/pull/13206">#13206</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13112">#13112</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8871">#8871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix doc parser to still pre/post process metadata fields on disabled type <ulink url="https://github.com/elastic/elasticsearch/pull/13137">#13137</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13017">#13017</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix document parsing to properly ignore entire type when disabled <ulink url="https://github.com/elastic/elasticsearch/pull/13085">#13085</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13017">#13017</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>update_all_types</literal> missing from REST spec and tests [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12840">#12840</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Nested Docs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Nested query should only use bitset cache for parent filter <ulink url="https://github.com/elastic/elasticsearch/pull/13087">#13087</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve situation when network.host is set to wildcard (e.g. 0.0.0.0) <ulink url="https://github.com/elastic/elasticsearch/pull/13299">#13299</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13274">#13274</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix service.bat start/stop issues <ulink url="https://github.com/elastic/elasticsearch/pull/13398">#13398</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13247">#13247</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13401">#13401</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t surround -Xloggc log filename with quotes <ulink url="https://github.com/elastic/elasticsearch/pull/13296">#13296</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13277">#13277</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing null check in ESPolicy. <ulink url="https://github.com/elastic/elasticsearch/pull/13232">#13232</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
More portable extraction of short hostname <ulink url="https://github.com/elastic/elasticsearch/pull/13109">#13109</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13107">#13107</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
EC2/Azure discovery plugins must declare their UnicastHostsProvider <ulink url="https://github.com/elastic/elasticsearch/pull/13501">#13501</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13492">#13492</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Installing plugin without checksums ends up downloading from github <ulink url="https://github.com/elastic/elasticsearch/pull/13197">#13197</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13196">#13196</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
<literal>span_containing</literal> and <literal>span_within</literal> override default boost coming from lucene <ulink url="https://github.com/elastic/elasticsearch/pull/13339">#13339</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13272">#13272</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>simple_query_string</literal> overrides boost coming from lucene <ulink url="https://github.com/elastic/elasticsearch/pull/13331">#13331</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13272">#13272</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Query DSL: match_phrase_prefix to take boost into account <ulink url="https://github.com/elastic/elasticsearch/pull/13142">#13142</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13129">#13129</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Failed to properly ack translog ops during wait on mapping changes <ulink url="https://github.com/elastic/elasticsearch/pull/13535">#13535</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Propagate Headers and Context through to ScriptService <ulink url="https://github.com/elastic/elasticsearch/pull/12982">#12982</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12891">#12891</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow reads on shards that are in POST_RECOVERY <ulink url="https://github.com/elastic/elasticsearch/pull/13246">#13246</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/13068">#13068</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9421">#9421</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix <literal>discovery.zen.join_timeout</literal> default value logic <ulink url="https://github.com/elastic/elasticsearch/pull/13162">#13162</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow deleting closed indices with shadow replicas <ulink url="https://github.com/elastic/elasticsearch/pull/13309">#13309</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13297">#13297</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Snapshot restore request should accept indices options <ulink url="https://github.com/elastic/elasticsearch/pull/13357">#13357</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10744">#10744</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13335">#13335</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove the <literal>network</literal> option from nodes info/stats [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12889">#12889</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.0.0-beta2" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta2.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update joda-time to 2.8.2 <ulink url="https://github.com/elastic/elasticsearch/pull/13092">#13092</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12859">#12859</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update AWS SDK to 1.10.12 <ulink url="https://github.com/elastic/elasticsearch/pull/13090">#13090</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update AWS SDK to 1.10.10  <ulink url="https://github.com/elastic/elasticsearch/pull/12859">#12859</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
<chapter id="release-notes-2.0.0-beta1">
<title>2.0.0-beta1 Release Notes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></title>
<bridgehead id="breaking-2.0.0-beta1" renderas="sect2">Breaking changes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Removed unused factor parameter in DateHistogramBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/12850">#12850</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6490">#6490</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregation: Removed Old Script Java API from metrics aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/12236">#12236</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change the default <literal>min_doc_count</literal> to 0 on histograms. <ulink url="https://github.com/elastic/elasticsearch/pull/10904">#10904</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Speed up include/exclude in terms aggregations with regexps, using Lucene regular expressions <ulink url="https://github.com/elastic/elasticsearch/pull/10418">#10418</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7526">#7526</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9848">#9848</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clean up time zone options for <literal>date_histogram</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9637">#9637</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9062">#9062</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>offset</literal> to date_histogram, replacing <literal>pre_offsest</literal> and <literal>post_offset</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9597">#9597</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9062">#9062</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Facets: Removal from master. <ulink url="https://github.com/elastic/elasticsearch/pull/7337">#7337</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Changed the respnose structure of the percentiles aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6079">#6079</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5870">#5870</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw exception if <literal>index</literal> is null or missing when creating an alias <ulink url="https://github.com/elastic/elasticsearch/pull/8240">#8240</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7863">#7863</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7976">#7976</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default delayed allocation timeout to 1m from 0 <ulink url="https://github.com/elastic/elasticsearch/pull/12166">#12166</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove old 0.90 shard allocator <ulink url="https://github.com/elastic/elasticsearch/pull/10889">#10889</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enable DiskThresholdDecider by default, change default limits to 85/90% <ulink url="https://github.com/elastic/elasticsearch/pull/6204">#6204</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6200">#6200</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6201">#6201</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add multi-valued text support to the analyzer API <ulink url="https://github.com/elastic/elasticsearch/pull/10847">#10847</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3023">#3023</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Term positions in analyze API should start at 1, not 0 <ulink url="https://github.com/elastic/elasticsearch/pull/10771">#10771</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improvements to StemmerTokenFilter <ulink url="https://github.com/elastic/elasticsearch/pull/6452">#6452</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove Bulk UDP  <ulink url="https://github.com/elastic/elasticsearch/pull/7595">#7595</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Filtered out non data-nodes in relevant cat api <ulink url="https://github.com/elastic/elasticsearch/pull/9287">#9287</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Default _cat APIs to verbose <ulink url="https://github.com/elastic/elasticsearch/pull/8927">#8927</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8922">#8922</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove core delete-by-query implementation <ulink url="https://github.com/elastic/elasticsearch/pull/10859">#10859</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10067">#10067</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>async</literal> replication <ulink url="https://github.com/elastic/elasticsearch/pull/10171">#10171</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10114">#10114</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove async replication from the docs and REST spec <ulink url="https://github.com/elastic/elasticsearch/pull/10162">#10162</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10114">#10114</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete api: remove broadcast delete if routing is missing when required <ulink url="https://github.com/elastic/elasticsearch/pull/10136">#10136</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9123">#9123</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Version types <literal>EXTERNAL</literal> &amp; <literal>EXTERNAL_GTE</literal> test for version equality in read operation &amp; disallow them in the Update API <ulink url="https://github.com/elastic/elasticsearch/pull/5929">#5929</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5661">#5661</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5663">#5663</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make ordinals start at 0. <ulink url="https://github.com/elastic/elasticsearch/pull/5946">#5946</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5871">#5871</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Circuit Breakers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add HierarchyCircuitBreakerService <ulink url="https://github.com/elastic/elasticsearch/pull/6739">#6739</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6129">#6129</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove <literal>_shutdown</literal> API <ulink url="https://github.com/elastic/elasticsearch/pull/10831">#10831</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cluster State API: Remove index template filtering <ulink url="https://github.com/elastic/elasticsearch/pull/6020">#6020</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4954">#4954</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove MergeScheduler pluggability <ulink url="https://github.com/elastic/elasticsearch/pull/11585">#11585</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t allow indices containing too-old segments to be opened <ulink url="https://github.com/elastic/elasticsearch/pull/11072">#11072</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10215">#10215</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11095">#11095</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove Restart API and remove Node#stop() <ulink url="https://github.com/elastic/elasticsearch/pull/9921">#9921</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9841">#9841</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove component settings from AbstractComponent <ulink url="https://github.com/elastic/elasticsearch/pull/9919">#9919</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor settings filtering, adding regex support <ulink url="https://github.com/elastic/elasticsearch/pull/9748">#9748</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6295">#6295</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cut over to Path API for file deletion <ulink url="https://github.com/elastic/elasticsearch/pull/8366">#8366</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Switch to murmurhash3 to route documents to shards. <ulink url="https://github.com/elastic/elasticsearch/pull/7954">#7954</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Resiliency: Throw exception if the JVM will corrupt data. <ulink url="https://github.com/elastic/elasticsearch/pull/7580">#7580</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove deprecated gateways <ulink url="https://github.com/elastic/elasticsearch/pull/5520">#5520</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5422">#5422</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Discovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default to unicast discovery, with default host list of 127.0.0.1, [::1] <ulink url="https://github.com/elastic/elasticsearch/pull/12999">#12999</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12993">#12993</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove full flush / FlushType.NEW_WRITER <ulink url="https://github.com/elastic/elasticsearch/pull/9559">#9559</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Generify Index and Shard exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/12023">#12023</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Streamline use of IndexClosedException introduced with #6475 <ulink url="https://github.com/elastic/elasticsearch/pull/6990">#6990</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6475">#6475</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6988">#6988</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Thread pool rejection status code should be 429 <ulink url="https://github.com/elastic/elasticsearch/pull/6629">#6629</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6627">#6627</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fielddata: Remove soft/resident caches. <ulink url="https://github.com/elastic/elasticsearch/pull/7443">#7443</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Wildcard field names in highlighting should only return fields that can be highlighted <ulink url="https://github.com/elastic/elasticsearch/pull/11364">#11364</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9881">#9881</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove XPostingsHighlighter in favour of Lucene&#8217;s PostingsHighlighter <ulink url="https://github.com/elastic/elasticsearch/pull/11077">#11077</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10625">#10625</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>require_field_match</literal> now defaults to <literal>true</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11067">#11067</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10627">#10627</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Change behaviour of indices segments api to allow no indices <ulink url="https://github.com/elastic/elasticsearch/pull/9219">#9219</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5856">#5856</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
REST API: Removed support for aliases as part of index settings <ulink url="https://github.com/elastic/elasticsearch/pull/5545">#5545</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove file based index templates <ulink url="https://github.com/elastic/elasticsearch/pull/11052">#11052</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10870">#10870</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
GET templates doesn&#8217;t honor the <literal>flat_settings</literal> parameter. <ulink url="https://github.com/elastic/elasticsearch/pull/6672">#6672</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6671">#6671</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Flatten SearchService and clean up build-in registration <ulink url="https://github.com/elastic/elasticsearch/pull/12807">#12807</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12783">#12783</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate shard level abstractions <ulink url="https://github.com/elastic/elasticsearch/pull/11847">#11847</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Bake in TieredMergePolicy <ulink url="https://github.com/elastic/elasticsearch/pull/11588">#11588</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Translog interface <ulink url="https://github.com/elastic/elasticsearch/pull/10988">#10988</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove InternalNode class and use Node directly <ulink url="https://github.com/elastic/elasticsearch/pull/9844">#9844</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove OperationRouting abstraction <ulink url="https://github.com/elastic/elasticsearch/pull/9085">#9085</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Drop support for state written pre 0.90 <ulink url="https://github.com/elastic/elasticsearch/pull/8850">#8850</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove some more bwc code <ulink url="https://github.com/elastic/elasticsearch/pull/8778">#8778</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove optional original indices <ulink url="https://github.com/elastic/elasticsearch/pull/8777">#8777</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7406">#7406</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove runtime version checks <ulink url="https://github.com/elastic/elasticsearch/pull/8768">#8768</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove NoneGateway, NoneGatewayAllocator, &amp; NoneGatewayModule <ulink url="https://github.com/elastic/elasticsearch/pull/8537">#8537</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify reading / writing from and to BlobContainer <ulink url="https://github.com/elastic/elasticsearch/pull/7551">#7551</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor guice startup <ulink url="https://github.com/elastic/elasticsearch/pull/7289">#7289</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed filters execution order and fix potential concurrency issue in filter chains <ulink url="https://github.com/elastic/elasticsearch/pull/7023">#7023</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7019">#7019</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7021">#7021</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make transport action name available in TransportAction base class <ulink url="https://github.com/elastic/elasticsearch/pull/6860">#6860</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup Rest Response <ulink url="https://github.com/elastic/elasticsearch/pull/5612">#5612</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>Releasable</literal> in favor of <literal>Closeable</literal>  [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5423">#5423</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Java api: remove execution from TermsQueryBuilder as it has no effect <ulink url="https://github.com/elastic/elasticsearch/pull/12884">#12884</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enhancement/terms lookup fixes <ulink url="https://github.com/elastic/elasticsearch/pull/12870">#12870</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Centralize admin implementations and action execution <ulink url="https://github.com/elastic/elasticsearch/pull/10955">#10955</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Automatically thread client based action listeners <ulink url="https://github.com/elastic/elasticsearch/pull/10940">#10940</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove redundant BytesQueryBuilder in favour of using WrapperQueryBuilder internally <ulink url="https://github.com/elastic/elasticsearch/pull/10919">#10919</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Clean up response API for Aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/9221">#9221</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
QueryBuilders cleanup (add and deprecate) <ulink url="https://github.com/elastic/elasticsearch/pull/8667">#8667</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8721">#8721</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove operationThreaded setter from ExplainRequestBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/7186">#7186</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unnecessary intermediate interfaces <ulink url="https://github.com/elastic/elasticsearch/pull/6517">#6517</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4355">#4355</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify IndicesOptions constants <ulink url="https://github.com/elastic/elasticsearch/pull/6068">#6068</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6059">#6059</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove operation threading from broadcast actions <ulink url="https://github.com/elastic/elasticsearch/pull/6044">#6044</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove search operation threading option <ulink url="https://github.com/elastic/elasticsearch/pull/6042">#6042</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make Create/Update/Delete classes less mutable <ulink url="https://github.com/elastic/elasticsearch/pull/5939">#5939</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5917">#5917</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Truncate log messages at 10,000 characters by default <ulink url="https://github.com/elastic/elasticsearch/pull/11050">#11050</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Disallow type names to start with dots for new indices except for .percolator <ulink url="https://github.com/elastic/elasticsearch/pull/12561">#12561</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12560">#12560</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove ability to configure _index <ulink url="https://github.com/elastic/elasticsearch/pull/12356">#12356</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12027">#12027</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12329">#12329</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enforce field names do not contain dot <ulink url="https://github.com/elastic/elasticsearch/pull/12068">#12068</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restrict fields with the same name in different types to have the same core settings <ulink url="https://github.com/elastic/elasticsearch/pull/11812">#11812</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8871">#8871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lockdown <literal>_timestamp</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/11794">#11794</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6730">#6730</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove the <literal>compress</literal>/<literal>compress_threshold</literal> options of the BinaryFieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/11280">#11280</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove ability to set the value of meta fields inside <literal>_source</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11074">#11074</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11051">#11051</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove file based default mappings <ulink url="https://github.com/elastic/elasticsearch/pull/10870">#10870</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10620">#10620</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Validate dynamic mappings updates on the master node. <ulink url="https://github.com/elastic/elasticsearch/pull/10634">#10634</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8650">#8650</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8688">#8688</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove delete mapping API <ulink url="https://github.com/elastic/elasticsearch/pull/10231">#10231</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8877">#8877</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_ttl</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9914">#9914</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_size</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9913">#9913</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_field_names</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9912">#9912</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>_boost</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9897">#9897</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8875">#8875</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_routing</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9895">#9895</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_index</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9870">#9870</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_type</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9869">#9869</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_id</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9842">#9842</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lock down <literal>_uid</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9836">#9836</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8143">#8143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove the ability to have custom per-field postings and doc values formats. <ulink url="https://github.com/elastic/elasticsearch/pull/9741">#9741</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8746">#8746</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove support for new indexes using <literal>path</literal> setting in object/nested fields or <literal>index_name</literal> in any field <ulink url="https://github.com/elastic/elasticsearch/pull/9570">#9570</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6677">#6677</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove type prefix support from field names in queries <ulink url="https://github.com/elastic/elasticsearch/pull/9492">#9492</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8872">#8872</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>index_analyzer</literal> setting to simplify analyzer logic <ulink url="https://github.com/elastic/elasticsearch/pull/9451">#9451</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9371">#9371</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove type level default analyzers <ulink url="https://github.com/elastic/elasticsearch/pull/9430">#9430</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8874">#8874</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9365">#9365</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>_analyzer</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/9381">#9381</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9279">#9279</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove fieldSearchAnalyzer and fieldSearchQuoteAnalyzer from MapperService. <ulink url="https://github.com/elastic/elasticsearch/pull/9262">#9262</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>allow_type_wrapper</literal> setting <ulink url="https://github.com/elastic/elasticsearch/pull/9185">#9185</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add doc values support to boolean fields. <ulink url="https://github.com/elastic/elasticsearch/pull/7961">#7961</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4678">#4678</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7851">#7851</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unsupported <literal>postings_format</literal> / <literal>doc_values_format</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7604">#7604</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7238">#7238</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7566">#7566</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Mappings: Update mapping on master in async manner <ulink url="https://github.com/elastic/elasticsearch/pull/6648">#6648</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
The binary field shouldn&#8217;t be stored by default, because it is already available in the _source <ulink url="https://github.com/elastic/elasticsearch/pull/4957">#4957</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
More Like This
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove <literal>percent_terms_to_match</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11030">#11030</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the MLT API <ulink url="https://github.com/elastic/elasticsearch/pull/11003">#11003</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10736">#10736</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
NOT CLASSIFIED
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rivers removal. <ulink url="https://github.com/elastic/elasticsearch/pull/11568">#11568</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Move multicast discovery to a plugin <ulink url="https://github.com/elastic/elasticsearch/pull/13027">#13027</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12993">#12993</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12999">#12999</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/13019">#13019</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ban java serialization <ulink url="https://github.com/elastic/elasticsearch/pull/11910">#11910</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Default to binding to loopback address <ulink url="https://github.com/elastic/elasticsearch/pull/11483">#11483</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11300">#11300</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7077">#7077</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unsafe options <ulink url="https://github.com/elastic/elasticsearch/pull/10360">#10360</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove references to the thrift and memcached transport plugins <ulink url="https://github.com/elastic/elasticsearch/pull/10169">#10169</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10166">#10166</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove Environment.homeFile() <ulink url="https://github.com/elastic/elasticsearch/pull/12351">#12351</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Startup: Remove getopt parsing in shell script, use java CLITool <ulink url="https://github.com/elastic/elasticsearch/pull/12165">#12165</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove the <literal>top_children</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/11028">#11028</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11022">#11022</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactoring parent/child to improve memory consumption and query execution. <ulink url="https://github.com/elastic/elasticsearch/pull/6511">#6511</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10135">#10135</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10485">#10485</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6107">#6107</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8134">#8134</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Simplify Plugin API for constructing modules <ulink url="https://github.com/elastic/elasticsearch/pull/12952">#12952</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use <emphasis>name</emphasis> from plugin descriptor file to determine plugin name <ulink url="https://github.com/elastic/elasticsearch/pull/12775">#12775</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12715">#12715</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
make java.version mandatory for jvm plugins <ulink url="https://github.com/elastic/elasticsearch/pull/12424">#12424</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adapt pluginmanager to the new world <ulink url="https://github.com/elastic/elasticsearch/pull/12408">#12408</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor pluginservice <ulink url="https://github.com/elastic/elasticsearch/pull/12367">#12367</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11917">#11917</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
CLITool: Port PluginManager to use CLITool <ulink url="https://github.com/elastic/elasticsearch/pull/12290">#12290</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
One single (global) way to register custom query parsers <ulink url="https://github.com/elastic/elasticsearch/pull/11481">#11481</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t overwrite plugin configuration when removing/upgrading plugins <ulink url="https://github.com/elastic/elasticsearch/pull/7890">#7890</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5064">#5064</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t allow fuzziness specified as a % and require edits [0,2] instead <ulink url="https://github.com/elastic/elasticsearch/pull/12229">#12229</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10638">#10638</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove filter parsers. <ulink url="https://github.com/elastic/elasticsearch/pull/10985">#10985</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Deprecate the <literal>limit</literal> filter. <ulink url="https://github.com/elastic/elasticsearch/pull/10532">#10532</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>fuzzy_like_this</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/10391">#10391</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function Score: Refactor RandomScoreFunction to be consistent, and return values in range [0.0, 1.0] <ulink url="https://github.com/elastic/elasticsearch/pull/7446">#7446</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6907">#6907</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>numeric_range</literal> filter <ulink url="https://github.com/elastic/elasticsearch/pull/7242">#7242</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4034">#4034</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7108">#7108</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>custom_score</literal> and <literal>custom_boost_factor</literal> queries <ulink url="https://github.com/elastic/elasticsearch/pull/5076">#5076</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cluster state: return <literal>routing_nodes</literal> only when requested through specific flag <ulink url="https://github.com/elastic/elasticsearch/pull/10486">#10486</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10412">#10412</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove jsonp support and associated tests <ulink url="https://github.com/elastic/elasticsearch/pull/9242">#9242</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9108">#9108</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>status</literal> code from main action <literal>/</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/8865">#8865</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add all meta fields to the top level json document in search response <ulink url="https://github.com/elastic/elasticsearch/pull/8131">#8131</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Security: Disable JSONP by default <ulink url="https://github.com/elastic/elasticsearch/pull/6795">#6795</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed Index Status API <ulink url="https://github.com/elastic/elasticsearch/pull/6062">#6062</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4854">#4854</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Decouple recoveries from engine flush <ulink url="https://github.com/elastic/elasticsearch/pull/10624">#10624</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
RecoveryState clean up <ulink url="https://github.com/elastic/elasticsearch/pull/9811">#9811</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6644">#6644</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove deprecated script APIs <ulink url="https://github.com/elastic/elasticsearch/pull/11619">#11619</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add script type and script name to error messages <ulink url="https://github.com/elastic/elasticsearch/pull/11449">#11449</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6653">#6653</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added a new script construct <ulink url="https://github.com/elastic/elasticsearch/pull/10649">#10649</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove deprecated methods from ScriptService <ulink url="https://github.com/elastic/elasticsearch/pull/10476">#10476</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove support for <literal>script.disable_dynamic</literal> setting <ulink url="https://github.com/elastic/elasticsearch/pull/10286">#10286</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10116">#10116</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup ScriptService &amp; friends in preparation for #6418 <ulink url="https://github.com/elastic/elasticsearch/pull/9992">#9992</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6418">#6418</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removed deprecated script parameter names <ulink url="https://github.com/elastic/elasticsearch/pull/9815">#9815</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable dynamic Groovy scripting by marking Groovy as not sandboxed [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/9655">#9655</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Created a parameter parser to standardise script options <ulink url="https://github.com/elastic/elasticsearch/pull/7977">#7977</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Script with <literal>_score</literal>: remove dependency of DocLookup and scorer <ulink url="https://github.com/elastic/elasticsearch/pull/7819">#7819</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7043">#7043</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7487">#7487</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove MVEL as a built-in scripting language <ulink url="https://github.com/elastic/elasticsearch/pull/6610">#6610</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Switch to Groovy as the default scripting language <ulink url="https://github.com/elastic/elasticsearch/pull/6571">#6571</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6233">#6233</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Disable dynamic scripting by default <ulink url="https://github.com/elastic/elasticsearch/pull/5943">#5943</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5853">#5853</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cut over to the Lucene filter cache <ulink url="https://github.com/elastic/elasticsearch/pull/10897">#10897</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove terms filter lookup cache. <ulink url="https://github.com/elastic/elasticsearch/pull/9056">#9056</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix script fields to be returned as a multivalued field when they produce a list <ulink url="https://github.com/elastic/elasticsearch/pull/8592">#8592</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3015">#3015</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove partial fields <ulink url="https://github.com/elastic/elasticsearch/pull/8133">#8133</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only return aggregations on the first page with scroll and forbidden with scan <ulink url="https://github.com/elastic/elasticsearch/pull/7497">#7497</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1642">#1642</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not permit multiple settings files <ulink url="https://github.com/elastic/elasticsearch/pull/13043">#13043</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13042">#13042</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
change CORS allow origin default to allow no origins <ulink url="https://github.com/elastic/elasticsearch/pull/11890">#11890</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11169">#11169</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Require units for time and byte-sized settings, take 2 <ulink url="https://github.com/elastic/elasticsearch/pull/11437">#11437</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10888">#10888</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7616">#7616</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7633">#7633</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>mapping.date.round_ceil</literal> setting for date math parsing <ulink url="https://github.com/elastic/elasticsearch/pull/8889">#8889</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8556">#8556</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8598">#8598</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add a <literal>index.query.parse.allow_unmapped_fields</literal> setting that fails if queries refer to unmapped fields. <ulink url="https://github.com/elastic/elasticsearch/pull/6928">#6928</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6664">#6664</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change default filter cache to 10% and circuit breaker to 60% <ulink url="https://github.com/elastic/elasticsearch/pull/5990">#5990</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove the <literal>node.enable_custom_paths</literal> setting <ulink url="https://github.com/elastic/elasticsearch/pull/12837">#12837</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12776">#12776</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>path.shared_data</literal>, change <literal>index.data_path</literal> to be relative <ulink url="https://github.com/elastic/elasticsearch/pull/11065">#11065</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Url repository should respect repo.path for file urls <ulink url="https://github.com/elastic/elasticsearch/pull/11687">#11687</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix FSRepository location configuration <ulink url="https://github.com/elastic/elasticsearch/pull/11157">#11157</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10828">#10828</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11068">#11068</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove obsolete <literal>expand_wildcards_open</literal> and  <literal>expand_wildcards_close</literal> options <ulink url="https://github.com/elastic/elasticsearch/pull/10744">#10744</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10743">#10743</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6097">#6097</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Automatic verification of all files that are being snapshotted with Snapshot/Restore <ulink url="https://github.com/elastic/elasticsearch/pull/7159">#7159</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5593">#5593</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add Partial snapshot state <ulink url="https://github.com/elastic/elasticsearch/pull/5793">#5793</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5792">#5792</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove network stats &amp; info <ulink url="https://github.com/elastic/elasticsearch/pull/12054">#12054</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update fs stats <ulink url="https://github.com/elastic/elasticsearch/pull/12053">#12053</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update OS stats <ulink url="https://github.com/elastic/elasticsearch/pull/12049">#12049</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update process stats <ulink url="https://github.com/elastic/elasticsearch/pull/12043">#12043</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove sigar completely <ulink url="https://github.com/elastic/elasticsearch/pull/12010">#12010</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replacing sigar <ulink url="https://github.com/elastic/elasticsearch/pull/11995">#11995</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11034">#11034</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removed <literal>id_cache</literal> from stats and cat apis. <ulink url="https://github.com/elastic/elasticsearch/pull/11183">#11183</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5269">#5269</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup JVM info and stats <ulink url="https://github.com/elastic/elasticsearch/pull/10553">#10553</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add human readable <literal>start_time</literal> and <literal>refresh_interval</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/5544">#5544</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5280">#5280</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Migrating NodesInfo API to use plugins instead of singular plugin <ulink url="https://github.com/elastic/elasticsearch/pull/5072">#5072</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Store
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Simplify IndexStore and friends <ulink url="https://github.com/elastic/elasticsearch/pull/10773">#10773</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>memory</literal>/ <literal>ram</literal> store <ulink url="https://github.com/elastic/elasticsearch/pull/8536">#8536</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the in memory buffer Lucene store/directory [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4994">#4994</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Term Vectors
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
More consistent naming for term vector[s] <ulink url="https://github.com/elastic/elasticsearch/pull/8484">#8484</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="deprecation-2.0.0-beta1" renderas="sect2">Deprecations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove non-default fielddata formats. <ulink url="https://github.com/elastic/elasticsearch/pull/11669">#11669</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate <literal>validate_*</literal> and <literal>normalize_*</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10248">#10248</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10170">#10170</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
NOT CLASSIFIED
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deprecate rivers <ulink url="https://github.com/elastic/elasticsearch/pull/10503">#10503</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Warning in documentation for deprecation of rivers <ulink url="https://github.com/elastic/elasticsearch/pull/10423">#10423</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10345">#10345</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove <literal>index.fail_on_merge_failure</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10088">#10088</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10084">#10084</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove dangling indices settings, always import it <ulink url="https://github.com/elastic/elasticsearch/pull/10016">#10016</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="feature-2.0.0-beta1" renderas="sect2">New features<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add HDRHistogram as an option in percentiles and percentile_ranks aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/12362">#12362</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8324">#8324</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Adds other bucket to filters aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11948">#11948</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11289">#11289</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Pipeline Aggregation to filter buckets based on a script <ulink url="https://github.com/elastic/elasticsearch/pull/11941">#11941</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adds cumulative sum aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11825">#11825</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow users to perform simple arithmetic operations on histogram aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/11601">#11601</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11029">#11029</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: add serial differencing pipeline aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11196">#11196</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10190">#10190</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add Holt-Winters to moving_avg aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11043">#11043</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make it possible to configure missing values. <ulink url="https://github.com/elastic/elasticsearch/pull/11042">#11042</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5324">#5324</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adding Sum Bucket Aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11013">#11013</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11007">#11007</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adding Average Bucket Aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11010">#11010</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11006">#11006</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
min_bucket aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/10900">#10900</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9999">#9999</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pipeline aggregations: Ability to perform computations on aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/10568">#10568</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10000">#10000</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10002">#10002</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9293">#9293</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9876">#9876</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sampler aggregation  <ulink url="https://github.com/elastic/elasticsearch/pull/10221">#10221</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8108">#8108</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>PercentageScore</literal> heuristic for significant_terms <ulink url="https://github.com/elastic/elasticsearch/pull/9747">#9747</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9720">#9720</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return the sum of the doc counts of other buckets in terms aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/8213">#8213</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant terms: add scriptable significance heuristic <ulink url="https://github.com/elastic/elasticsearch/pull/7850">#7850</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Scriptable Metrics Aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/7075">#7075</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5923">#5923</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added pre and post offset to histogram aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6980">#6980</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6605">#6605</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added Filters aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6974">#6974</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6118">#6118</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6119">#6119</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add children aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6936">#6936</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant Terms: Add google normalized distance and chi square  <ulink url="https://github.com/elastic/elasticsearch/pull/6858">#6858</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Infrastructure for changing easily the significance terms heuristic <ulink url="https://github.com/elastic/elasticsearch/pull/6561">#6561</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added percentile rank aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6432">#6432</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6386">#6386</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deferred aggregations prevent combinatorial explosion  <ulink url="https://github.com/elastic/elasticsearch/pull/6128">#6128</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support bounding box aggregation on geo_shape/geo_point data types. [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5634">#5634</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add reverse nested aggregation  [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5485">#5485</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cardinality aggregation [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5426">#5426</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Percentiles aggregation [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5323">#5323</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant_terms aggregation  <ulink url="https://github.com/elastic/elasticsearch/pull/5146">#5146</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add preserve original token option to ASCIIFolding <ulink url="https://github.com/elastic/elasticsearch/pull/5115">#5115</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4931">#4931</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add script support to value_count aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/5007">#5007</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5001">#5001</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cancel replica recovery on another sync option copy found <ulink url="https://github.com/elastic/elasticsearch/pull/12421">#12421</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Optional Delayed Allocation on Node leave <ulink url="https://github.com/elastic/elasticsearch/pull/11712">#11712</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>keep_types</literal> for filtering by token type <ulink url="https://github.com/elastic/elasticsearch/pull/7120">#7120</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add uppercase token filter <ulink url="https://github.com/elastic/elasticsearch/pull/5539">#5539</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add _cat/nodeattrs API <ulink url="https://github.com/elastic/elasticsearch/pull/12534">#12534</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8000">#8000</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add wildcard support for header names <ulink url="https://github.com/elastic/elasticsearch/pull/11367">#11367</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10811">#10811</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Show open and closed indices in _cat/indices <ulink url="https://github.com/elastic/elasticsearch/pull/7936">#7936</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7907">#7907</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add /_cat/fielddata to display fielddata usage <ulink url="https://github.com/elastic/elasticsearch/pull/6086">#6086</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4593">#4593</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add _cat/plugins endpoint [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4824">#4824</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add _cat/segments [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4711">#4711</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update API: Add support for scripted upserts. <ulink url="https://github.com/elastic/elasticsearch/pull/7144">#7144</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update API - allow scripted upserts [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7143">#7143</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update API: Detect noop updates when using doc <ulink url="https://github.com/elastic/elasticsearch/pull/6862">#6862</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6822">#6822</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Introducing VersionType.FORCE &amp; VersionType.EXTERNAL_GTE <ulink url="https://github.com/elastic/elasticsearch/pull/4993">#4993</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2946">#2946</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4213">#4213</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query Cache: Support shard level query response caching <ulink url="https://github.com/elastic/elasticsearch/pull/7161">#7161</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Circuit Breakers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow setting individual breakers to "noop" breakers <ulink url="https://github.com/elastic/elasticsearch/pull/8135">#8135</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add NoopCircuitBreaker used in NoneCircuitBreakerService <ulink url="https://github.com/elastic/elasticsearch/pull/8063">#8063</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Expose auto-IO-throttle from Lucene&#8217;s ConcurrentMergeScheduler <ulink url="https://github.com/elastic/elasticsearch/pull/9243">#9243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9133">#9133</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Switch auto-generated IDs to Flake IDs from random UUIDs <ulink url="https://github.com/elastic/elasticsearch/pull/7531">#7531</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5941">#5941</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6004">#6004</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Added epoch date formats to configure parsing of unix dates <ulink url="https://github.com/elastic/elasticsearch/pull/11453">#11453</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10971">#10971</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5328">#5328</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add date math support in index names <ulink url="https://github.com/elastic/elasticsearch/pull/12209">#12209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12059">#12059</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added GET Index API <ulink url="https://github.com/elastic/elasticsearch/pull/7234">#7234</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4069">#4069</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Force single-segment merges [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5243">#5243</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Create index to support aliases [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4920">#4920</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add Recovery API. <ulink url="https://github.com/elastic/elasticsearch/pull/4802">#4802</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4637">#4637</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Made template filtering generic and extensible <ulink url="https://github.com/elastic/elasticsearch/pull/7454">#7454</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7459">#7459</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added support for aliases to index templates <ulink url="https://github.com/elastic/elasticsearch/pull/5180">#5180</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/1825">#1825</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2739">#2739</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Indexed Scripts/Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow search templates stored in an index to be retrieved and used at search time <ulink url="https://github.com/elastic/elasticsearch/pull/5921">#5921</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5484">#5484</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5637">#5637</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Added an option to add arbitrary headers to the client requests <ulink url="https://github.com/elastic/elasticsearch/pull/7127">#7127</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improved Suggest Client API <ulink url="https://github.com/elastic/elasticsearch/pull/7507">#7507</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7435">#7435</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Infra for deprecation logging <ulink url="https://github.com/elastic/elasticsearch/pull/11285">#11285</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11033">#11033</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Infra for deprecation logging <ulink url="https://github.com/elastic/elasticsearch/pull/11033">#11033</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add ability to specify a SizeBasedTriggeringPolicy for log configuration <ulink url="https://github.com/elastic/elasticsearch/pull/10373">#10373</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10371">#10371</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Bring back <literal>numeric_resolution</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10420">#10420</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10072">#10072</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add new <literal>default</literal> option for timestamp field <ulink url="https://github.com/elastic/elasticsearch/pull/7036">#7036</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4718">#4718</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add transform to document before index. <ulink url="https://github.com/elastic/elasticsearch/pull/6599">#6599</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6566">#6566</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add doc values for binary field <ulink url="https://github.com/elastic/elasticsearch/pull/5669">#5669</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
More Like This
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add an <literal>unlike</literal> parameter <ulink url="https://github.com/elastic/elasticsearch/pull/8674">#8674</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for artificial documents in MLT query <ulink url="https://github.com/elastic/elasticsearch/pull/7725">#7725</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Enable percolation of nested documents <ulink url="https://github.com/elastic/elasticsearch/pull/5082">#5082</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Delete By Query
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add delete-by-query plugin <ulink url="https://github.com/elastic/elasticsearch/pull/11516">#11516</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
add list parse methods to XContentParser <ulink url="https://github.com/elastic/elasticsearch/pull/10455">#10455</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Migration advisory plugin  [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/10214">#10214</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query DSL: Add <literal>filter</literal> clauses to <literal>bool</literal> queries. <ulink url="https://github.com/elastic/elasticsearch/pull/11142">#11142</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add span within/containing queries. <ulink url="https://github.com/elastic/elasticsearch/pull/10913">#10913</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add time_zone setting for query_string <ulink url="https://github.com/elastic/elasticsearch/pull/8164">#8164</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7880">#7880</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>format</literal> support for date range filter and queries <ulink url="https://github.com/elastic/elasticsearch/pull/7821">#7821</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7189">#7189</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>min_score</literal> parameter to function score query to only match docs above this threshold <ulink url="https://github.com/elastic/elasticsearch/pull/7814">#7814</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6952">#6952</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Function score multi values <ulink url="https://github.com/elastic/elasticsearch/pull/5940">#5940</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3960">#3960</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add the <literal>field_value_factor</literal> function to the function_score query <ulink url="https://github.com/elastic/elasticsearch/pull/5519">#5519</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added <literal>cross_fields</literal> type to multi_match query <ulink url="https://github.com/elastic/elasticsearch/pull/5005">#5005</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2959">#2959</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow for executing queries based on pre-defined templates [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4879">#4879</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
API: Add response filtering with <literal>filter_path</literal> parameter <ulink url="https://github.com/elastic/elasticsearch/pull/10980">#10980</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7401">#7401</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Render REST errors in a structural way <ulink url="https://github.com/elastic/elasticsearch/pull/10643">#10643</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3303">#3303</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add CBOR data format support <ulink url="https://github.com/elastic/elasticsearch/pull/5509">#5509</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4860">#4860</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add basic recovery prioritization to GatewayAllocator <ulink url="https://github.com/elastic/elasticsearch/pull/11975">#11975</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11787">#11787</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move index sealing terminology to synced flush <ulink url="https://github.com/elastic/elasticsearch/pull/11336">#11336</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10032">#10032</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11179">#11179</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11251">#11251</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Seal indices for faster recovery  <ulink url="https://github.com/elastic/elasticsearch/pull/11179">#11179</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10032">#10032</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add Multi-Valued Field Methods to Expressions <ulink url="https://github.com/elastic/elasticsearch/pull/11105">#11105</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for fine-grained settings <ulink url="https://github.com/elastic/elasticsearch/pull/10116">#10116</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10274">#10274</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6418">#6418</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add script engine for Lucene expressions <ulink url="https://github.com/elastic/elasticsearch/pull/6819">#6819</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6818">#6818</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add Groovy as a scripting language, add groovy sandboxing <ulink url="https://github.com/elastic/elasticsearch/pull/6233">#6233</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add Groovy as a scripting language, switching default from Mvel &#8594; Groovy <ulink url="https://github.com/elastic/elasticsearch/pull/6106">#6106</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Validate API: provide more verbose explanation <ulink url="https://github.com/elastic/elasticsearch/pull/10147">#10147</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/1412">#1412</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/88247">#88247</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add inner hits to nested and parent/child queries <ulink url="https://github.com/elastic/elasticsearch/pull/8153">#8153</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/3022">#3022</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/3152">#3152</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sorting: Allow _geo_distance to handle many to many geo point distance <ulink url="https://github.com/elastic/elasticsearch/pull/7097">#7097</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3926">#3926</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add search-exists API to check if any matching documents exist for a given query <ulink url="https://github.com/elastic/elasticsearch/pull/7026">#7026</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6995">#6995</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add an option to early terminate document collection when searching/counting <ulink url="https://github.com/elastic/elasticsearch/pull/6885">#6885</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6876">#6876</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sequential rescores [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4748">#4748</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Search Templates: Adds API endpoint to render search templates as a response <ulink url="https://github.com/elastic/elasticsearch/pull/11570">#11570</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6821">#6821</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add ability to prompt for selected settings on startup <ulink url="https://github.com/elastic/elasticsearch/pull/10918">#10918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10838">#10838</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>bootstrap.mlockall</literal> for Windows (VirtualLock) <ulink url="https://github.com/elastic/elasticsearch/pull/10887">#10887</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8480">#8480</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9186">#9186</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9923">#9923</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>checksum</literal> option for <literal>index.shard.check_on_startup</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9183">#9183</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow shards on shared filesystems to be recovered on any node <ulink url="https://github.com/elastic/elasticsearch/pull/10960">#10960</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10932">#10932</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Shadow replicas on shared filesystems <ulink url="https://github.com/elastic/elasticsearch/pull/9727">#9727</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8976">#8976</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add script compilation stats <ulink url="https://github.com/elastic/elasticsearch/pull/12733">#12733</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12673">#12673</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add OS name to _nodes and _cluster/nodes <ulink url="https://github.com/elastic/elasticsearch/pull/11807">#11807</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add an API to locate unrecovered shards and their state <ulink url="https://github.com/elastic/elasticsearch/pull/11545">#11545</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10952">#10952</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cluster Health: Add wait time for pending task and recovery percentage <ulink url="https://github.com/elastic/elasticsearch/pull/11393">#11393</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10805">#10805</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add field stats api <ulink url="https://github.com/elastic/elasticsearch/pull/10523">#10523</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Store
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add index.data_path setting <ulink url="https://github.com/elastic/elasticsearch/pull/9033">#9033</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8819">#8819</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8976">#8976</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>best_compression</literal> option for indices <ulink url="https://github.com/elastic/elasticsearch/pull/8863">#8863</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Suggesters
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Phrase Suggester: Add option to filter out phrase suggestions <ulink url="https://github.com/elastic/elasticsearch/pull/6773">#6773</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3482">#3482</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ContextSuggester <ulink url="https://github.com/elastic/elasticsearch/pull/4044">#4044</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3959">#3959</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Term Vectors
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Return term vectors as part of the search response <ulink url="https://github.com/elastic/elasticsearch/pull/10729">#10729</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10823">#10823</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support terms filtering <ulink url="https://github.com/elastic/elasticsearch/pull/9561">#9561</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Top Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add top_hits aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6124">#6124</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Upgrade API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add API to upgrade old Lucene indices to the latest version <ulink url="https://github.com/elastic/elasticsearch/pull/7922">#7922</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7884">#7884</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="enhancement-2.0.0-beta1" renderas="sect2">Enhancements<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make ValueParser.DateMath aware of timezone setting <ulink url="https://github.com/elastic/elasticsearch/pull/12886">#12886</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12278">#12278</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix setting timezone on default DateTime formatter <ulink url="https://github.com/elastic/elasticsearch/pull/12581">#12581</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12531">#12531</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Add better validation of moving_avg model settings <ulink url="https://github.com/elastic/elasticsearch/pull/12280">#12280</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Adds a new GapPolicy - NONE <ulink url="https://github.com/elastic/elasticsearch/pull/11951">#11951</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Makes ValueFormat and ValueFormatter never null <ulink url="https://github.com/elastic/elasticsearch/pull/11943">#11943</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10594">#10594</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add cost minimizer to tune <literal>moving_avg</literal> parameters <ulink url="https://github.com/elastic/elasticsearch/pull/11881">#11881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: moving_avg model parser should accept any numeric <ulink url="https://github.com/elastic/elasticsearch/pull/11778">#11778</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11487">#11487</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Renaming reducers to Pipeline Aggregators <ulink url="https://github.com/elastic/elasticsearch/pull/11275">#11275</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve <literal>include</literal>/<literal>exclude</literal> clause list speed and scalability <ulink url="https://github.com/elastic/elasticsearch/pull/11188">#11188</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11176">#11176</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove pointless term frequency lookups. <ulink url="https://github.com/elastic/elasticsearch/pull/11094">#11094</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11093">#11093</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rename Moving Average models to their "common" names <ulink url="https://github.com/elastic/elasticsearch/pull/10964">#10964</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Derivative Aggregation x-axis units normalisation <ulink url="https://github.com/elastic/elasticsearch/pull/10898">#10898</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added context for significant_terms scoring <ulink url="https://github.com/elastic/elasticsearch/pull/10633">#10633</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10613">#10613</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removed aggregations from ReduceContext <ulink url="https://github.com/elastic/elasticsearch/pull/10509">#10509</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Format bucket key_as_string in <literal>date_histogram</literal> according to <literal>time_zone</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9744">#9744</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9710">#9710</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor aggregations to use lucene5-style collectors. <ulink url="https://github.com/elastic/elasticsearch/pull/9544">#9544</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6477">#6477</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9098">#9098</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>offset</literal> option to histogram aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/9505">#9505</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9417">#9417</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify histogram implementations <ulink url="https://github.com/elastic/elasticsearch/pull/9446">#9446</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Internal simplifications. <ulink url="https://github.com/elastic/elasticsearch/pull/9097">#9097</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Numeric metric aggregations are now formattable <ulink url="https://github.com/elastic/elasticsearch/pull/9032">#9032</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6812">#6812</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds methods to get to/from as Strings for Range Aggs <ulink url="https://github.com/elastic/elasticsearch/pull/9026">#9026</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9003">#9003</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Made the <literal>nested</literal>, <literal>reverse_nested</literal> and <literal>children</literal> aggs ignore unmapped nested fields or unmapped child / parent types. <ulink url="https://github.com/elastic/elasticsearch/pull/8808">#8808</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8760">#8760</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not sort histogram buckets on shards. <ulink url="https://github.com/elastic/elasticsearch/pull/8797">#8797</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>size</literal> property parsing inconsistent <ulink url="https://github.com/elastic/elasticsearch/pull/8645">#8645</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6061">#6061</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not take deleted documents into account in aggregations filters. <ulink url="https://github.com/elastic/elasticsearch/pull/8540">#8540</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added getProperty method to Aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/8421">#8421</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Meta data support with each aggregation request/response <ulink url="https://github.com/elastic/elasticsearch/pull/8279">#8279</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6465">#6465</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Buckets can now be serialized outside of an Aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/8113">#8113</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8110">#8110</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support for arrays of numeric values in include/exclude clauses <ulink url="https://github.com/elastic/elasticsearch/pull/7727">#7727</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7714">#7714</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add ability to sort on multiple criteria <ulink url="https://github.com/elastic/elasticsearch/pull/7662">#7662</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6917">#6917</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7588">#7588</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Encapsulate AggregationBuilder name and make getter public <ulink url="https://github.com/elastic/elasticsearch/pull/7425">#7425</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Merge LongTermsAggregator and DoubleTermsAggregator. <ulink url="https://github.com/elastic/elasticsearch/pull/7279">#7279</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the logic to optionally sort/dedup values on the fly. <ulink url="https://github.com/elastic/elasticsearch/pull/7276">#7276</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make the list of buckets for terms and histogram returned as a java.util.List. <ulink url="https://github.com/elastic/elasticsearch/pull/7275">#7275</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Stops direct subclassing of InternalNumericMetricsAggregation <ulink url="https://github.com/elastic/elasticsearch/pull/7058">#7058</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better JSON output scoping <ulink url="https://github.com/elastic/elasticsearch/pull/6985">#6985</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7004">#7004</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Better heuristic for setting default <literal>shard_size</literal> in terms aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6960">#6960</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6857">#6857</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added an option to show the upper bound of the error for the terms aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6778">#6778</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6696">#6696</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Extend allowed characters in aggregation name [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6702">#6702</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Moved BucketsAggregator#docCounts field to IntArray <ulink url="https://github.com/elastic/elasticsearch/pull/6529">#6529</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
GlobalOrdinalsStringTermsAggregator is inefficient for high-cardinality fields [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6518">#6518</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>ordinals</literal> execution hint. <ulink url="https://github.com/elastic/elasticsearch/pull/6499">#6499</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Delegation of nextReader calls <ulink url="https://github.com/elastic/elasticsearch/pull/6477">#6477</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>shard_min_doc_count</literal> parameter to terms aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/6143">#6143</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5998">#5998</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6041">#6041</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>shard_min_doc_count</literal> parameter for significant terms similar to <literal>shard_size</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/6041">#6041</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>include</literal>/<literal>exclude</literal> support to global ordinals based terms and significant terms aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/6000">#6000</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Lower the initial sizing of sub aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/5994">#5994</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve the way sub-aggregations are collected. <ulink url="https://github.com/elastic/elasticsearch/pull/5975">#5975</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add global ordinal based implementations for significant terms aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/5970">#5970</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use collectExistingBucket() if a bucket already exists <ulink url="https://github.com/elastic/elasticsearch/pull/5955">#5955</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant_terms agg: added option for a backgroundFilter  <ulink url="https://github.com/elastic/elasticsearch/pull/5944">#5944</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve terms aggregation to perform the segment ordinal to global ordinal lookup post segment collection <ulink url="https://github.com/elastic/elasticsearch/pull/5895">#5895</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove abstraction in the percentiles aggregation. <ulink url="https://github.com/elastic/elasticsearch/pull/5859">#5859</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Instantiate facets/aggregations during the QUERY phase. <ulink url="https://github.com/elastic/elasticsearch/pull/5821">#5821</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregation cleanup <ulink url="https://github.com/elastic/elasticsearch/pull/5699">#5699</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations cleanup <ulink url="https://github.com/elastic/elasticsearch/pull/5614">#5614</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor common code for unmapped aggregators into <literal>NonCollectingAggregator</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/5528">#5528</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant_terms agg only creates term frequency cache when necessary  <ulink url="https://github.com/elastic/elasticsearch/pull/5459">#5459</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5450">#5450</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added <literal>extended_bounds</literal> support for date_/histogram aggs <ulink url="https://github.com/elastic/elasticsearch/pull/5444">#5444</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5224">#5224</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make aggregations CacheRecycler-free. <ulink url="https://github.com/elastic/elasticsearch/pull/5419">#5419</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4929">#4929</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added support for sorting buckets based on sub aggregation down the current hierarchy <ulink url="https://github.com/elastic/elasticsearch/pull/5340">#5340</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5253">#5253</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Terms aggs: only use ordinals on low-cardinality fields by default. <ulink url="https://github.com/elastic/elasticsearch/pull/5304">#5304</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5303">#5303</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rest API needs to be consistent across all multi-bucket aggs [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4926">#4926</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
cleanup of aggregations api <ulink url="https://github.com/elastic/elasticsearch/pull/4894">#4894</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4922">#4922</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t require fields in alias filters to exist in the mapping <ulink url="https://github.com/elastic/elasticsearch/pull/12150">#12150</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Parse aliases at search time and never cache parsed alias filters <ulink url="https://github.com/elastic/elasticsearch/pull/11930">#11930</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10485">#10485</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>expectedShardSize</literal> to ShardRouting and use it in path.data allocation <ulink url="https://github.com/elastic/elasticsearch/pull/12947">#12947</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11271">#11271</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make RoutingNodes read-only by default <ulink url="https://github.com/elastic/elasticsearch/pull/12690">#12690</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Avoid extra reroutes of delayed shards in RoutingService <ulink url="https://github.com/elastic/elasticsearch/pull/12678">#12678</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12456">#12456</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12515">#12515</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12532">#12532</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reroute shards when a node goes under disk watermarks <ulink url="https://github.com/elastic/elasticsearch/pull/12452">#12452</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12422">#12422</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
No need to find replica copy when index is created <ulink url="https://github.com/elastic/elasticsearch/pull/12435">#12435</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adapt IndicesClusterStateService to use allocation ids <ulink url="https://github.com/elastic/elasticsearch/pull/12397">#12397</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12242">#12242</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12387">#12387</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify handling of ignored unassigned shards <ulink url="https://github.com/elastic/elasticsearch/pull/12339">#12339</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Initial Refactor Gateway Allocator <ulink url="https://github.com/elastic/elasticsearch/pull/12335">#12335</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use recently added allocation ids for shard started/failed <ulink url="https://github.com/elastic/elasticsearch/pull/12299">#12299</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12242">#12242</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unique allocation id <ulink url="https://github.com/elastic/elasticsearch/pull/12242">#12242</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow shards to be allocated if leftover shard from different index exists <ulink url="https://github.com/elastic/elasticsearch/pull/12237">#12237</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10677">#10677</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify assignToNode to only do initializing <ulink url="https://github.com/elastic/elasticsearch/pull/12235">#12235</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify ShardRouting and centralize move to unassigned <ulink url="https://github.com/elastic/elasticsearch/pull/11634">#11634</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
When using <literal>recover_on_any_node</literal> on shared filesystem, respect Deciders <ulink url="https://github.com/elastic/elasticsearch/pull/11168">#11168</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Async fetch of shard started and store during allocation <ulink url="https://github.com/elastic/elasticsearch/pull/11101">#11101</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9502">#9502</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Verify shards index UUID when fetching started shards <ulink url="https://github.com/elastic/elasticsearch/pull/10200">#10200</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Early terminate if the cluster can&#8217;t be rebalanced <ulink url="https://github.com/elastic/elasticsearch/pull/9162">#9162</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Speed-up disk-threshold decider <ulink url="https://github.com/elastic/elasticsearch/pull/8803">#8803</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6372">#6372</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
DiskThresholdDecider#remain(&#8230;) should take shards relocating away into account <ulink url="https://github.com/elastic/elasticsearch/pull/8659">#8659</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8538">#8538</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Take percentage watermarks into account for reroute listener <ulink url="https://github.com/elastic/elasticsearch/pull/8382">#8382</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8367">#8367</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8368">#8368</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reroute shards automatically when high disk watermark is exceeded <ulink url="https://github.com/elastic/elasticsearch/pull/8270">#8270</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8146">#8146</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add rebalance enabled allocation decider <ulink url="https://github.com/elastic/elasticsearch/pull/8190">#8190</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7288">#7288</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add option to take currently relocating shards' sizes into account <ulink url="https://github.com/elastic/elasticsearch/pull/7785">#7785</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6168">#6168</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7753">#7753</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow primaries that have never been allocated to be allocated if under the low watermark <ulink url="https://github.com/elastic/elasticsearch/pull/6209">#6209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6196">#6196</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add explanations for all AllocationDeciders <ulink url="https://github.com/elastic/elasticsearch/pull/4934">#4934</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2483">#2483</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4380">#4380</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make shard balancing deterministic if weights are identical <ulink url="https://github.com/elastic/elasticsearch/pull/4866">#4866</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Document and test custom analyzer <literal>position_offset_gap</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10934">#10934</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1812">#1812</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose Latvian analyzer <ulink url="https://github.com/elastic/elasticsearch/pull/7542">#7542</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve Hunspell error messages <ulink url="https://github.com/elastic/elasticsearch/pull/6850">#6850</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Share numeric date analyzer instances between mappings <ulink url="https://github.com/elastic/elasticsearch/pull/6843">#6843</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add missing pre built analysis components <ulink url="https://github.com/elastic/elasticsearch/pull/6770">#6770</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
PatternAnalyzer should use PatternTokenFilter instead [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6717">#6717</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
More resource efficient analysis wrapping usage <ulink url="https://github.com/elastic/elasticsearch/pull/6714">#6714</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add additional Analyzers, Tokenizers, and TokenFilters from Lucene <ulink url="https://github.com/elastic/elasticsearch/pull/6693">#6693</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5935">#5935</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use non analyzed token stream optimization everywhere <ulink url="https://github.com/elastic/elasticsearch/pull/6001">#6001</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for char filters in the analyze API <ulink url="https://github.com/elastic/elasticsearch/pull/5148">#5148</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for retrieving fields in bulk updates <ulink url="https://github.com/elastic/elasticsearch/pull/12114">#12114</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11527">#11527</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add scroll stats to cat API <ulink url="https://github.com/elastic/elasticsearch/pull/12331">#12331</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12330">#12330</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add option to <literal>_cat/indices</literal> to return index creation date #11524 <ulink url="https://github.com/elastic/elasticsearch/pull/11688">#11688</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11524">#11524</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add node id to _cat apis <ulink url="https://github.com/elastic/elasticsearch/pull/10246">#10246</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10226">#10226</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Mark shadow replicas with <emphasis>s</emphasis> in _cat/shards output <ulink url="https://github.com/elastic/elasticsearch/pull/10023">#10023</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9772">#9772</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add total index memory in <literal>_cat/indices</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7824">#7824</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7008">#7008</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add file descriptor details to cat/nodes <ulink url="https://github.com/elastic/elasticsearch/pull/7655">#7655</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7652">#7652</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add configured thread pool sizes to _cat/thread_pool [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5366">#5366</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added thread pool cat api <ulink url="https://github.com/elastic/elasticsearch/pull/4906">#4906</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4907">#4907</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
RestTable.renderValue() doesn&#8217;t know about tera and peta [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4871">#4871</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clean up cat headers <ulink url="https://github.com/elastic/elasticsearch/pull/4853">#4853</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4852">#4852</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow GET access to _all field (return value was always null before) <ulink url="https://github.com/elastic/elasticsearch/pull/6924">#6924</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove backward compatibility layer introduced in #6149 <ulink url="https://github.com/elastic/elasticsearch/pull/6229">#6229</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6149">#6149</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Provide more context variables in update scripts <ulink url="https://github.com/elastic/elasticsearch/pull/5724">#5724</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/1607">#1607</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2230">#2230</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2231">#2231</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Left over from the <literal>query_cache</literal> to <literal>request_cache</literal> rename <ulink url="https://github.com/elastic/elasticsearch/pull/12478">#12478</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename caches. <ulink url="https://github.com/elastic/elasticsearch/pull/11893">#11893</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11569">#11569</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Give the filter cache a smaller maximum number of cached filters. <ulink url="https://github.com/elastic/elasticsearch/pull/11833">#11833</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the query parser cache. <ulink url="https://github.com/elastic/elasticsearch/pull/10856">#10856</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t use the fixed bitset filter cache for child nested level filters, but the regular filter cache instead <ulink url="https://github.com/elastic/elasticsearch/pull/9740">#9740</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8810">#8810</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use a smaller expected size when serializing query results <ulink url="https://github.com/elastic/elasticsearch/pull/9485">#9485</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use correct number of bytes in query cache accounting <ulink url="https://github.com/elastic/elasticsearch/pull/9479">#9479</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use a 1024 byte minimum weight for filter cache entries <ulink url="https://github.com/elastic/elasticsearch/pull/8304">#8304</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8249">#8249</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8268">#8268</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Immediately remove filter cache entries on cache clear <ulink url="https://github.com/elastic/elasticsearch/pull/8289">#8289</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8285">#8285</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add hit and miss count to Query Cache <ulink url="https://github.com/elastic/elasticsearch/pull/7355">#7355</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Warmer (search) to support query cache <ulink url="https://github.com/elastic/elasticsearch/pull/7326">#7326</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a request level flag to control Query Cache <ulink url="https://github.com/elastic/elasticsearch/pull/7167">#7167</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a periodic cleanup thread for IndexFieldCache caches <ulink url="https://github.com/elastic/elasticsearch/pull/7015">#7015</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7010">#7010</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Circuit Breakers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for registering custom circuit breaker <ulink url="https://github.com/elastic/elasticsearch/pull/8795">#8795</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Circuit Breakers: Log if CircuitBreaker is tripping <ulink url="https://github.com/elastic/elasticsearch/pull/8050">#8050</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Include name of the field that caused a circuit break in the log and exception message <ulink url="https://github.com/elastic/elasticsearch/pull/5841">#5841</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5718">#5718</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Increase RamAccountingTermsEnum flush size from 1mb to 5mb <ulink url="https://github.com/elastic/elasticsearch/pull/5335">#5335</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add circuit breaker for parent/child id cache <ulink url="https://github.com/elastic/elasticsearch/pull/5325">#5325</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5325">#5325</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add circuit breaker functionality to parent/child id field data cache [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5276">#5276</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove double call to elect primaries <ulink url="https://github.com/elastic/elasticsearch/pull/12147">#12147</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename MetaData.uuid &#8594; MetaData.clusterUUID and IndexMetaData.uuid&#8594; IndexMetaData.indexUUID <ulink url="https://github.com/elastic/elasticsearch/pull/11914">#11914</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11831">#11831</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add MetaData.uuid to ClusterState.toXContent <ulink url="https://github.com/elastic/elasticsearch/pull/11832">#11832</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove scheduled routing <ulink url="https://github.com/elastic/elasticsearch/pull/11776">#11776</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reset registeredNextDelaySetting on reroute <ulink url="https://github.com/elastic/elasticsearch/pull/11759">#11759</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add Unassigned meta data <ulink url="https://github.com/elastic/elasticsearch/pull/11653">#11653</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove deprecated METADATA cluster block level <ulink url="https://github.com/elastic/elasticsearch/pull/10779">#10779</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9203">#9203</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>routing_nodes</literal> an independent metric option in cluster state api <ulink url="https://github.com/elastic/elasticsearch/pull/10412">#10412</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10352">#10352</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for cluster state diffs <ulink url="https://github.com/elastic/elasticsearch/pull/10212">#10212</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add METADATA_READ and METADATA_WRITE blocks <ulink url="https://github.com/elastic/elasticsearch/pull/9203">#9203</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10521">#10521</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10522">#10522</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2833">#2833</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/3703">#3703</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5855">#5855</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5876">#5876</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8102">#8102</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t mark cluster health as timed out if desired state is reached <ulink url="https://github.com/elastic/elasticsearch/pull/8683">#8683</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add missing cluster blocks handling for master operations <ulink url="https://github.com/elastic/elasticsearch/pull/7763">#7763</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7740">#7740</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Master election should demotes nodes which try to join the cluster for the first time <ulink url="https://github.com/elastic/elasticsearch/pull/7558">#7558</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7493">#7493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not use a background thread to disconnect node which are removed from the ClusterState <ulink url="https://github.com/elastic/elasticsearch/pull/7543">#7543</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactored ClusterStateUpdateTask protection against execution on a non master <ulink url="https://github.com/elastic/elasticsearch/pull/7511">#7511</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7493">#7493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unneeded cluster state serialization during cluster join <ulink url="https://github.com/elastic/elasticsearch/pull/6949">#6949</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Resend failed shard messages when receiving a cluster state still referring to the failed shards <ulink url="https://github.com/elastic/elasticsearch/pull/6881">#6881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Send shard exists requests if shard exists locally but is not allocated to the node <ulink url="https://github.com/elastic/elasticsearch/pull/6870">#6870</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t attempt to start or fail shard if no master node can be found <ulink url="https://github.com/elastic/elasticsearch/pull/6841">#6841</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve handling of failed primary replica handling <ulink url="https://github.com/elastic/elasticsearch/pull/6825">#6825</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6808">#6808</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add local node to cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/6811">#6811</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
During relocation, process pending mapping update in phase 2 <ulink url="https://github.com/elastic/elasticsearch/pull/6762">#6762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6648">#6648</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve pending api to include current executing class <ulink url="https://github.com/elastic/elasticsearch/pull/6744">#6744</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Start Master|Node fault detection pinging immediately during discovery <ulink url="https://github.com/elastic/elasticsearch/pull/6706">#6706</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6480">#6480</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clean shard bulk mapping update to only use type name <ulink url="https://github.com/elastic/elasticsearch/pull/6695">#6695</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure <literal>index.version.created</literal> is consistent <ulink url="https://github.com/elastic/elasticsearch/pull/6660">#6660</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactored AckedClusterStateUpdateTask &amp; co. to remove code repetitions in subclasses <ulink url="https://github.com/elastic/elasticsearch/pull/6559">#6559</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wait till node is part of cluster state for join process <ulink url="https://github.com/elastic/elasticsearch/pull/6480">#6480</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not use versions to optimize cluster state copying for a first update from a new master <ulink url="https://github.com/elastic/elasticsearch/pull/6466">#6466</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve cluster update settings api <ulink url="https://github.com/elastic/elasticsearch/pull/6244">#6244</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
When sending shard start/failed message due to a cluster state change, use the master indicated in the new state rather than current <ulink url="https://github.com/elastic/elasticsearch/pull/6189">#6189</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Raise node disconnected even if the transport is stopped <ulink url="https://github.com/elastic/elasticsearch/pull/5918">#5918</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Moved the updateMappingOnMaster logic into a single place. <ulink url="https://github.com/elastic/elasticsearch/pull/5850">#5850</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5798">#5798</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
A new ClusterStateStatus to indicate cluster state life cycles <ulink url="https://github.com/elastic/elasticsearch/pull/5741">#5741</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Optimize multiple cluster state processing on receiving nodes [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5139">#5139</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduced a new IMMEDIATE priority - higher than URGENT <ulink url="https://github.com/elastic/elasticsearch/pull/5098">#5098</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5062">#5062</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Bulk process of shard started/failed should not execute on already processed events [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5061">#5061</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve jvmcheck error failure <ulink url="https://github.com/elastic/elasticsearch/pull/12696">#12696</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use explict flag if index should be created on engine creation <ulink url="https://github.com/elastic/elasticsearch/pull/12671">#12671</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move Streams.copyTo(String|Bytes)FromClasspath() into StreamsUtils <ulink url="https://github.com/elastic/elasticsearch/pull/12598">#12598</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve toString on EsThreadPoolExecutor <ulink url="https://github.com/elastic/elasticsearch/pull/12535">#12535</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9732">#9732</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Carry over shard exception failure to master node <ulink url="https://github.com/elastic/elasticsearch/pull/12263">#12263</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow IBM J9 2.8+ in version check <ulink url="https://github.com/elastic/elasticsearch/pull/11850">#11850</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use System.nanoTime for ThreadPool&#8217;s estimated time, since it&#8217;s less likely to go backwards <ulink url="https://github.com/elastic/elasticsearch/pull/11626">#11626</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup MergeScheduler infrastrucutre <ulink url="https://github.com/elastic/elasticsearch/pull/11602">#11602</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reduce shard inactivity timeout to 5m <ulink url="https://github.com/elastic/elasticsearch/pull/11479">#11479</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11179">#11179</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11336">#11336</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail shard if search execution uncovers corruption <ulink url="https://github.com/elastic/elasticsearch/pull/11440">#11440</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11419">#11419</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Acquire IndexWriter&#8217;s <literal>write.lock</literal> lock before shard deletion <ulink url="https://github.com/elastic/elasticsearch/pull/11127">#11127</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11097">#11097</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ban PathUtils.get (for now, until we fix the two remaining issues) <ulink url="https://github.com/elastic/elasticsearch/pull/11069">#11069</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11065">#11065</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11068">#11068</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor SSD/FileStore logic out of NodeEnvironment <ulink url="https://github.com/elastic/elasticsearch/pull/10755">#10755</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10717">#10717</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor TransportShardReplicationOperationAction <ulink url="https://github.com/elastic/elasticsearch/pull/10749">#10749</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10032">#10032</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make getFileStore a bit more defensive <ulink url="https://github.com/elastic/elasticsearch/pull/10696">#10696</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ref count write operations on IndexShard <ulink url="https://github.com/elastic/elasticsearch/pull/10610">#10610</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename START phase into VERIFY_INDEX <ulink url="https://github.com/elastic/elasticsearch/pull/10570">#10570</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refresh if many deletes in a row use up too much version map RAM <ulink url="https://github.com/elastic/elasticsearch/pull/10312">#10312</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7052">#7052</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add before/afterIndexShardDelete callbacks to index lifecycle <ulink url="https://github.com/elastic/elasticsearch/pull/10173">#10173</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move GatewayShardsState logic into IndexShard <ulink url="https://github.com/elastic/elasticsearch/pull/10093">#10093</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t rethrow already handled merge exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/10083">#10083</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NodeEnv should lock all shards for an index <ulink url="https://github.com/elastic/elasticsearch/pull/9799">#9799</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Retry if shard deletes fail due to IOExceptions <ulink url="https://github.com/elastic/elasticsearch/pull/9784">#9784</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only do a single listAll from FileSwitchDir <ulink url="https://github.com/elastic/elasticsearch/pull/9666">#9666</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6636">#6636</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate index / shard deletion in IndicesService <ulink url="https://github.com/elastic/elasticsearch/pull/9605">#9605</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Increase default xlog flush size from 200mb to 512 mb <ulink url="https://github.com/elastic/elasticsearch/pull/9341">#9341</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9265">#9265</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pass through all exceptions in IndicesLifecycleListeners <ulink url="https://github.com/elastic/elasticsearch/pull/9330">#9330</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Pass index settings to IndicesLifecycle#beforeIndexCreated and #afterIndexShardClosed <ulink url="https://github.com/elastic/elasticsearch/pull/9245">#9245</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Delete shard content under lock <ulink url="https://github.com/elastic/elasticsearch/pull/9083">#9083</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8608">#8608</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9009">#9009</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove IndexEngine <ulink url="https://github.com/elastic/elasticsearch/pull/8955">#8955</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Gateway abstraction <ulink url="https://github.com/elastic/elasticsearch/pull/8954">#8954</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use Lucene&#8217;s defaults for compound file format <ulink url="https://github.com/elastic/elasticsearch/pull/8934">#8934</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8919">#8919</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove explicit .cleanUp() on cache clear <ulink url="https://github.com/elastic/elasticsearch/pull/8924">#8924</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup LocalGatewayShardsState <ulink url="https://github.com/elastic/elasticsearch/pull/8852">#8852</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Let Lucene kick off merges normally <ulink url="https://github.com/elastic/elasticsearch/pull/8643">#8643</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cut over MetaDataStateFormat to Path API in Gateway <ulink url="https://github.com/elastic/elasticsearch/pull/8609">#8609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure shards are deleted under lock on close <ulink url="https://github.com/elastic/elasticsearch/pull/8579">#8579</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add before/after indexDeleted callbacks to IndicesLifecycle <ulink url="https://github.com/elastic/elasticsearch/pull/8569">#8569</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8551">#8551</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Free pending search contexts if index is closed <ulink url="https://github.com/elastic/elasticsearch/pull/8551">#8551</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ban all usage of Future#cancel(true) <ulink url="https://github.com/elastic/elasticsearch/pull/8494">#8494</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Set bloom default to false even when Directory doesn&#8217;t have a codecService <ulink url="https://github.com/elastic/elasticsearch/pull/8442">#8442</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduce shard level locks to prevent concurrent shard modifications <ulink url="https://github.com/elastic/elasticsearch/pull/8436">#8436</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Observe cluster state on health request <ulink url="https://github.com/elastic/elasticsearch/pull/8350">#8350</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove usage of Directory#fileExists <ulink url="https://github.com/elastic/elasticsearch/pull/8233">#8233</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduce a RefCounted interface and basic impl <ulink url="https://github.com/elastic/elasticsearch/pull/8210">#8210</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use 1 instead of 0 as filler version value for nested docs <ulink url="https://github.com/elastic/elasticsearch/pull/8145">#8145</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add cluster and index state checksums <ulink url="https://github.com/elastic/elasticsearch/pull/8010">#8010</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7586">#7586</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Resiliency: Perform write consistency check just before writing on the primary shard <ulink url="https://github.com/elastic/elasticsearch/pull/7873">#7873</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add ActionRunnable support to ThreadPool to simplify async operation on bounded threadpools <ulink url="https://github.com/elastic/elasticsearch/pull/7765">#7765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change the default cache filter impl from FixedBitSet to WAH8DocIdSet <ulink url="https://github.com/elastic/elasticsearch/pull/7577">#7577</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6280">#6280</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7037">#7037</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Verify checksums on merge <ulink url="https://github.com/elastic/elasticsearch/pull/7360">#7360</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change numeric data types to use SORTED_NUMERIC docvalues type <ulink url="https://github.com/elastic/elasticsearch/pull/6967">#6967</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable loading of bloom filters by default <ulink url="https://github.com/elastic/elasticsearch/pull/6959">#6959</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6298">#6298</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6349">#6349</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t close/reopen IndexWriter when changing RAM buffer size <ulink url="https://github.com/elastic/elasticsearch/pull/6856">#6856</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t acquire dirtyLock on autoid for create <ulink url="https://github.com/elastic/elasticsearch/pull/6584">#6584</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reuse Lucene&#8217;s TermsEnum for faster _uid/version lookup during indexing <ulink url="https://github.com/elastic/elasticsearch/pull/6298">#6298</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6212">#6212</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Entirely cut over to TopDocs#merge for merging shard docs in the reduce phase  <ulink url="https://github.com/elastic/elasticsearch/pull/6197">#6197</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t use AllTokenStream if no fields were boosted [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6187">#6187</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove SerialMergeScheduler [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6120">#6120</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throttling incoming indexing when Lucene merges fall behind [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6066">#6066</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use Lucene built-in checksumming  [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5924">#5924</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t lookup version for auto generated id and create <ulink url="https://github.com/elastic/elasticsearch/pull/5917">#5917</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use Lucene&#8217;s defaults for CMS settings <ulink url="https://github.com/elastic/elasticsearch/pull/5912">#5912</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5882">#5882</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change default merge throttling to 50MB / sec <ulink url="https://github.com/elastic/elasticsearch/pull/5902">#5902</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t lookup version for auto generated id and create <ulink url="https://github.com/elastic/elasticsearch/pull/5785">#5785</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prevent fsync from creating 0-byte files <ulink url="https://github.com/elastic/elasticsearch/pull/5746">#5746</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move to use serial merge schedule by default <ulink url="https://github.com/elastic/elasticsearch/pull/5447">#5447</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Force merges to not happen when indexing a doc / flush <ulink url="https://github.com/elastic/elasticsearch/pull/5319">#5319</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reuse pages more agressively in BigArrays. <ulink url="https://github.com/elastic/elasticsearch/pull/5300">#5300</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5299">#5299</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Default date formats to use underscores via PUT <ulink url="https://github.com/elastic/elasticsearch/pull/12509">#12509</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12429">#12429</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow for backwards compatibility for unix timestamp in pre 2.x indices <ulink url="https://github.com/elastic/elasticsearch/pull/11515">#11515</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10971">#10971</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow for negative unix timestamps <ulink url="https://github.com/elastic/elasticsearch/pull/11482">#11482</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11478">#11478</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11692">#11692</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
More strict parsing of ISO dates <ulink url="https://github.com/elastic/elasticsearch/pull/6227">#6227</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6158">#6158</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Discovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Wait on incoming joins before electing local node as master <ulink url="https://github.com/elastic/elasticsearch/pull/12161">#12161</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t join master nodes or accept join requests of old and too new nodes <ulink url="https://github.com/elastic/elasticsearch/pull/11972">#11972</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11924">#11924</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent over allocation for multicast ping request <ulink url="https://github.com/elastic/elasticsearch/pull/10896">#10896</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Unicast Ping should close temporary connections after returning ping results <ulink url="https://github.com/elastic/elasticsearch/pull/10849">#10849</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prevent stale master nodes from sharing dated cluster states to nodes that have moved to a different master node <ulink url="https://github.com/elastic/elasticsearch/pull/9632">#9632</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Publishing timeout to log at WARN and indicate pending nodes <ulink url="https://github.com/elastic/elasticsearch/pull/9551">#9551</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Concurrent node failures can cause unneeded cluster state publishing <ulink url="https://github.com/elastic/elasticsearch/pull/8933">#8933</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8804">#8804</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Client: Only fetch the node info during node sampling <ulink url="https://github.com/elastic/elasticsearch/pull/8685">#8685</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t wait joinThread when stopping <ulink url="https://github.com/elastic/elasticsearch/pull/8359">#8359</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8327">#8327</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve handling of multicast binding exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/8243">#8243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8225">#8225</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify discovery node initialization if version is unknown <ulink url="https://github.com/elastic/elasticsearch/pull/8055">#8055</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8051">#8051</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove MasterFaultDetection.Listener.notListedOnMaster <ulink url="https://github.com/elastic/elasticsearch/pull/7995">#7995</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only accept unicast pings once started <ulink url="https://github.com/elastic/elasticsearch/pull/7950">#7950</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a finalize round to multicast pinging <ulink url="https://github.com/elastic/elasticsearch/pull/7924">#7924</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
During discovery, master fault detection should fall back to cluster state thread upon error <ulink url="https://github.com/elastic/elasticsearch/pull/7908">#7908</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7834">#7834</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Close ping handler&#8217;s executor service properly <ulink url="https://github.com/elastic/elasticsearch/pull/7903">#7903</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NodesFD: simplify concurrency control to fully rely on a single map <ulink url="https://github.com/elastic/elasticsearch/pull/7889">#7889</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
During discovery, remove any local state and use clusterService.state instead <ulink url="https://github.com/elastic/elasticsearch/pull/7834">#7834</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update ZenDiscovery fields via the cluster service update task. <ulink url="https://github.com/elastic/elasticsearch/pull/7790">#7790</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Give a unique id to each ping response  <ulink url="https://github.com/elastic/elasticsearch/pull/7769">#7769</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
UnicastZenPing don&#8217;t rename configure host name <ulink url="https://github.com/elastic/elasticsearch/pull/7747">#7747</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7719">#7719</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Node join requests should be handled at lower priority than master election <ulink url="https://github.com/elastic/elasticsearch/pull/7733">#7733</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Not all master election related cluster state update task use Priority.IMMEDIATE <ulink url="https://github.com/elastic/elasticsearch/pull/7718">#7718</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Accumulated improvements to ZenDiscovery <ulink url="https://github.com/elastic/elasticsearch/pull/7493">#7493</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2488">#2488</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
UnicastZenPing should also ping last known discoNodes <ulink url="https://github.com/elastic/elasticsearch/pull/7336">#7336</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
With unicast discovery, only disconnect from temporary connected nodes <ulink url="https://github.com/elastic/elasticsearch/pull/6966">#6966</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
During discovery, verify connect when sending a rejoin cluster request <ulink url="https://github.com/elastic/elasticsearch/pull/6779">#6779</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Have a dedicated join timeout that is higher than ping.timeout for join <ulink url="https://github.com/elastic/elasticsearch/pull/6342">#6342</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Unicast discovery enhancement <ulink url="https://github.com/elastic/elasticsearch/pull/5508">#5508</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Pre sync flush cleanups <ulink url="https://github.com/elastic/elasticsearch/pull/11252">#11252</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove flushNeeded in favor of IW#hasUncommittedChanges() <ulink url="https://github.com/elastic/elasticsearch/pull/11225">#11225</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the ability to flush without flushing the translog <ulink url="https://github.com/elastic/elasticsearch/pull/11193">#11193</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make SearchFactory static class in InternalEngine <ulink url="https://github.com/elastic/elasticsearch/pull/11154">#11154</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move back to single EngineConfig <ulink url="https://github.com/elastic/elasticsearch/pull/10586">#10586</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10584">#10584</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove reflection call to waitForMerges <ulink url="https://github.com/elastic/elasticsearch/pull/10102">#10102</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Always fail engine on corruption <ulink url="https://github.com/elastic/elasticsearch/pull/10092">#10092</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move InternalEngine.segmentStats() into abstract Engine <ulink url="https://github.com/elastic/elasticsearch/pull/9728">#9728</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9727">#9727</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move more methods into abstract Engine <ulink url="https://github.com/elastic/elasticsearch/pull/9717">#9717</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move as much as possible into abstract Engine <ulink url="https://github.com/elastic/elasticsearch/pull/9678">#9678</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Factor out settings updates from Engine <ulink url="https://github.com/elastic/elasticsearch/pull/9625">#9625</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Close Engine immediately if a tragic event strikes. <ulink url="https://github.com/elastic/elasticsearch/pull/9616">#9616</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9517">#9517</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor InternalEngine into abstract Engine and classes <ulink url="https://github.com/elastic/elasticsearch/pull/9585">#9585</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove FlushType and make resources final in InternalEngine <ulink url="https://github.com/elastic/elasticsearch/pull/9565">#9565</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove dirty flag and force boolean for refresh <ulink url="https://github.com/elastic/elasticsearch/pull/9484">#9484</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify Engine construction and ref counting <ulink url="https://github.com/elastic/elasticsearch/pull/9211">#9211</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fold engine into IndexShard <ulink url="https://github.com/elastic/elasticsearch/pull/9181">#9181</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t acquire Engine&#8217;s readLock in segmentsStats <ulink url="https://github.com/elastic/elasticsearch/pull/8910">#8910</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8905">#8905</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove engine related command classes <ulink url="https://github.com/elastic/elasticsearch/pull/8900">#8900</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow InternalEngine to be stopped and started <ulink url="https://github.com/elastic/elasticsearch/pull/8784">#8784</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8720">#8720</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Flush IndexWriter to disk  on close and shutdown <ulink url="https://github.com/elastic/elasticsearch/pull/7563">#7563</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure close is called under lock in the case of an engine failure <ulink url="https://github.com/elastic/elasticsearch/pull/5800">#5800</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fail the engine/shard when refresh failed <ulink url="https://github.com/elastic/elasticsearch/pull/5633">#5633</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve startup exceptions (especially file permissions etc) <ulink url="https://github.com/elastic/elasticsearch/pull/13050">#13050</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix formatting of startup/configuration errors <ulink url="https://github.com/elastic/elasticsearch/pull/13029">#13029</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add serialization support for InterruptedException <ulink url="https://github.com/elastic/elasticsearch/pull/12981">#12981</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Include stacktrace in rendered exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/12260">#12260</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12239">#12239</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Render structured exceptions in mget / mpercolate <ulink url="https://github.com/elastic/elasticsearch/pull/12240">#12240</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add index name to the upgrade exception <ulink url="https://github.com/elastic/elasticsearch/pull/12213">#12213</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Promote headers to first class citizens on exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/12006">#12006</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Parameterized exception messages <ulink url="https://github.com/elastic/elasticsearch/pull/11981">#11981</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Carry on rest status if exceptions are not serializable <ulink url="https://github.com/elastic/elasticsearch/pull/11973">#11973</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Render strucutred exception in multi search <ulink url="https://github.com/elastic/elasticsearch/pull/11849">#11849</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reduce the size of the XContent parsing exception <ulink url="https://github.com/elastic/elasticsearch/pull/11642">#11642</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove ElasticsearchIAE and ElasticsearchISE <ulink url="https://github.com/elastic/elasticsearch/pull/10862">#10862</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10794">#10794</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve exception handling in transport local execution <ulink url="https://github.com/elastic/elasticsearch/pull/10554">#10554</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix typo when primary is not available to index a document (UnavailableShardsException) <ulink url="https://github.com/elastic/elasticsearch/pull/10140">#10140</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change IndexPrimaryShardNotAllocatedException from 409 to 500 <ulink url="https://github.com/elastic/elasticsearch/pull/7987">#7987</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7632">#7632</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Nest original exception while creating NoShardAvailableActionException <ulink url="https://github.com/elastic/elasticsearch/pull/7757">#7757</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7756">#7756</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve exception from Store.failIfCorrupted <ulink url="https://github.com/elastic/elasticsearch/pull/7695">#7695</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7596">#7596</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Introduced a new elasticsearch exception family that can hold headers <ulink url="https://github.com/elastic/elasticsearch/pull/7269">#7269</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better message for invalid internal transport message format <ulink url="https://github.com/elastic/elasticsearch/pull/6916">#6916</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function Score: Add missing whitespace in error message when throwing exception <ulink url="https://github.com/elastic/elasticsearch/pull/6155">#6155</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Consult field info before fetching field data <ulink url="https://github.com/elastic/elasticsearch/pull/12403">#12403</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the dependecy on IndexFielddataService from MapperService. <ulink url="https://github.com/elastic/elasticsearch/pull/12371">#12371</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enable doc values by default, when appropriate <ulink url="https://github.com/elastic/elasticsearch/pull/10209">#10209</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8312">#8312</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change threshold value of fielddata.filter.frequency.max/min <ulink url="https://github.com/elastic/elasticsearch/pull/9522">#9522</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9327">#9327</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fielddata: Remove custom comparators and use Lucene&#8217;s instead <ulink url="https://github.com/elastic/elasticsearch/pull/6981">#6981</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5980">#5980</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Switch fielddata to use Lucene doc values APIs. <ulink url="https://github.com/elastic/elasticsearch/pull/6908">#6908</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make BytesValues.WithOrdinals more similar to Lucene&#8217;s SortedSetDocValues <ulink url="https://github.com/elastic/elasticsearch/pull/6524">#6524</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t expose hashes in Fielddata anymore. <ulink url="https://github.com/elastic/elasticsearch/pull/6500">#6500</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a dedicated field data type for the _index field mapper. <ulink url="https://github.com/elastic/elasticsearch/pull/6073">#6073</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5848">#5848</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Provide meaningful error message if field has no fielddata type <ulink url="https://github.com/elastic/elasticsearch/pull/5979">#5979</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5930">#5930</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use segment ordinals as global ordinals if possible <ulink url="https://github.com/elastic/elasticsearch/pull/5873">#5873</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5854">#5854</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make use of global ordinals in parent/child queries <ulink url="https://github.com/elastic/elasticsearch/pull/5846">#5846</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added a AppendingDeltaPackedLongBuffer-based storage format to single value field data <ulink url="https://github.com/elastic/elasticsearch/pull/5706">#5706</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove AtomicFieldData.isValuesOrdered. <ulink url="https://github.com/elastic/elasticsearch/pull/5688">#5688</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add global ordinals <ulink url="https://github.com/elastic/elasticsearch/pull/5672">#5672</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Moved the decision to load p/c fielddata eagerly to a better place. <ulink url="https://github.com/elastic/elasticsearch/pull/5569">#5569</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update ShapeBuilder and GeoPolygonQueryParser to accept non-closed GeoJSON <ulink url="https://github.com/elastic/elasticsearch/pull/11161">#11161</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11131">#11131</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove local Lucene Spatial package <ulink url="https://github.com/elastic/elasticsearch/pull/10966">#10966</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add merge conflicts to GeoShapeFieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/10533">#10533</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10513">#10513</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10514">#10514</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Coordinates can contain more than two elements (x,y) in GeoJSON parser. <ulink url="https://github.com/elastic/elasticsearch/pull/9542">#9542</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9540">#9540</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Revert "[GEO] Update GeoPolygonFilter to handle ambiguous polygons" <ulink url="https://github.com/elastic/elasticsearch/pull/9463">#9463</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5968">#5968</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9304">#9304</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9339">#9339</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9462">#9462</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update GeoPolygonFilter to handle polygons crossing the dateline <ulink url="https://github.com/elastic/elasticsearch/pull/9339">#9339</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5968">#5968</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8672">#8672</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9304">#9304</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
GeoPolygonFilter not properly handling dateline and pole crossing <ulink url="https://github.com/elastic/elasticsearch/pull/9171">#9171</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5968">#5968</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removing unnecessary orientation enumerators <ulink url="https://github.com/elastic/elasticsearch/pull/9036">#9036</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8978">#8978</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9035">#9035</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add optional left/right parameter to GeoJSON <ulink url="https://github.com/elastic/elasticsearch/pull/8978">#8978</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8764">#8764</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Feature/Fix for OGC compliant polygons failing with ambiguity <ulink url="https://github.com/elastic/elasticsearch/pull/8762">#8762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8672">#8672</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes BoundingBox across complete longitudinal range <ulink url="https://github.com/elastic/elasticsearch/pull/7340">#7340</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5218">#5218</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds support for GeoJSON GeometryCollection <ulink url="https://github.com/elastic/elasticsearch/pull/7123">#7123</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2796">#2796</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added caching support to geohash_filter <ulink url="https://github.com/elastic/elasticsearch/pull/6478">#6478</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow to parse lat/lon as strings and coerce them <ulink url="https://github.com/elastic/elasticsearch/pull/5626">#5626</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve error detection in geo_filter parsing <ulink url="https://github.com/elastic/elasticsearch/pull/5371">#5371</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5370">#5370</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve geo distance accuracy [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5192">#5192</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for distances in nautical miles <ulink url="https://github.com/elastic/elasticsearch/pull/5088">#5088</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5085">#5085</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Highlighting: keep track of the original query only in HighlighterContext <ulink url="https://github.com/elastic/elasticsearch/pull/11317">#11317</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make the HighlightQuery class public <ulink url="https://github.com/elastic/elasticsearch/pull/6446">#6446</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Highlight fields in request order <ulink url="https://github.com/elastic/elasticsearch/pull/6178">#6178</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4649">#4649</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Show human readable Elasticsearch version that created index and date when index was created <ulink url="https://github.com/elastic/elasticsearch/pull/11509">#11509</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11484">#11484</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add check to MetaData#concreteIndices to prevent NPE <ulink url="https://github.com/elastic/elasticsearch/pull/10342">#10342</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10339">#10339</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Set maximum index name length to 255 bytes <ulink url="https://github.com/elastic/elasticsearch/pull/8158">#8158</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8079">#8079</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>wait_if_ongoing</literal> option to _flush requests <ulink url="https://github.com/elastic/elasticsearch/pull/6996">#6996</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Unified MetaData#concreteIndices methods into a single method that accepts indices (or aliases) and indices options <ulink url="https://github.com/elastic/elasticsearch/pull/6169">#6169</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix detection of unsupported fields with validate API <ulink url="https://github.com/elastic/elasticsearch/pull/5782">#5782</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5685">#5685</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Provide template usage information on index creation <ulink url="https://github.com/elastic/elasticsearch/pull/8646">#8646</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7421">#7421</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unified PUT/POST behaviour in relation to create parameter <ulink url="https://github.com/elastic/elasticsearch/pull/6429">#6429</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Indexed Scripts/Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Indexed scripts/templates: return response body when script is not found <ulink url="https://github.com/elastic/elasticsearch/pull/10396">#10396</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7325">#7325</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure headers are handed over to internal requests and streamline versioning support <ulink url="https://github.com/elastic/elasticsearch/pull/7569">#7569</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use preference("_local") on get calls. <ulink url="https://github.com/elastic/elasticsearch/pull/7477">#7477</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Indexed Scripts/Templates: Return error message on 404 <ulink url="https://github.com/elastic/elasticsearch/pull/7335">#7335</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7325">#7325</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Inner Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Nested parent field should be resolved based on the parent inner hit definition <ulink url="https://github.com/elastic/elasticsearch/pull/9251">#9251</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8153">#8153</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added another more compact syntax for inner hits. <ulink url="https://github.com/elastic/elasticsearch/pull/8770">#8770</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Cleanup bootstrap package. <ulink url="https://github.com/elastic/elasticsearch/pull/13053">#13053</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13044">#13044</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Drop commons-lang dependency <ulink url="https://github.com/elastic/elasticsearch/pull/12972">#12972</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Flatten IndicesModule and add tests <ulink url="https://github.com/elastic/elasticsearch/pull/12921">#12921</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12783">#12783</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Flatten ClusterModule and add more tests <ulink url="https://github.com/elastic/elasticsearch/pull/12916">#12916</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12783">#12783</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow a plugin to supply its own query cache implementation <ulink url="https://github.com/elastic/elasticsearch/pull/12881">#12881</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Environment.resolveConfig <ulink url="https://github.com/elastic/elasticsearch/pull/12872">#12872</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove ClassLoader from Settings <ulink url="https://github.com/elastic/elasticsearch/pull/12868">#12868</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Transport: allow to de-serialize arbitrary objects given their name <ulink url="https://github.com/elastic/elasticsearch/pull/12571">#12571</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add RealtimeRequest marker interface to group realtime operations together <ulink url="https://github.com/elastic/elasticsearch/pull/12537">#12537</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Forbid Files.isHidden. <ulink url="https://github.com/elastic/elasticsearch/pull/12484">#12484</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12465">#12465</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused QueryParseContext argument in MappedFieldType#rangeQuery() <ulink url="https://github.com/elastic/elasticsearch/pull/12417">#12417</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify Replica Allocator <ulink url="https://github.com/elastic/elasticsearch/pull/12401">#12401</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replace primaryPostAllocated flag and use UnassignedInfo <ulink url="https://github.com/elastic/elasticsearch/pull/12374">#12374</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add the ability to wrap an index searcher. <ulink url="https://github.com/elastic/elasticsearch/pull/12364">#12364</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup TransportSingleShardAction and TransportInstanceSingleOperationAction <ulink url="https://github.com/elastic/elasticsearch/pull/12361">#12361</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove TransportSingleCustomOperationAction in favour of TransportSingleShardAction <ulink url="https://github.com/elastic/elasticsearch/pull/12350">#12350</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
updated the elasticsearch versioning format <ulink url="https://github.com/elastic/elasticsearch/pull/12210">#12210</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup the data structures used in MetaData class for alias and index lookups <ulink url="https://github.com/elastic/elasticsearch/pull/12202">#12202</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make 2.0.0.beta1-SNAPSHOT the current version. <ulink url="https://github.com/elastic/elasticsearch/pull/12151">#12151</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12148">#12148</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove mapper references from Engines <ulink url="https://github.com/elastic/elasticsearch/pull/12130">#12130</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup ShardRoutingState uses and hide implementation details of ClusterInfo <ulink url="https://github.com/elastic/elasticsearch/pull/12126">#12126</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate ShardRouting construction <ulink url="https://github.com/elastic/elasticsearch/pull/12125">#12125</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change JarHell to operate on Path instead of URL <ulink url="https://github.com/elastic/elasticsearch/pull/12109">#12109</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor MetaData to split off the concrete index name logic to a dedicated service <ulink url="https://github.com/elastic/elasticsearch/pull/12058">#12058</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
really ban exitVM with security policy <ulink url="https://github.com/elastic/elasticsearch/pull/11982">#11982</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cut over to writeable for TransportAddress <ulink url="https://github.com/elastic/elasticsearch/pull/11949">#11949</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Internal: make sure ParseField is always used in combination with parse flags <ulink url="https://github.com/elastic/elasticsearch/pull/11859">#11859</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove XContentParser.map[Ordered]AndClose(). <ulink url="https://github.com/elastic/elasticsearch/pull/11846">#11846</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove reroute with no reassign <ulink url="https://github.com/elastic/elasticsearch/pull/11804">#11804</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use abstract runnable in scheduled ping <ulink url="https://github.com/elastic/elasticsearch/pull/11795">#11795</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mark store as corrupted instead of deleting state file on engine failure <ulink url="https://github.com/elastic/elasticsearch/pull/11769">#11769</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add DateTime ctors without timezone to forbidden APIs <ulink url="https://github.com/elastic/elasticsearch/pull/11743">#11743</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fold ShardGetService creation away from Guice  into IndexShard <ulink url="https://github.com/elastic/elasticsearch/pull/11606">#11606</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Create ShardSuggestService/Metrics manually outside of guice <ulink url="https://github.com/elastic/elasticsearch/pull/11605">#11605</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Minimize the usage of guava classes in interfaces, return types, arguments <ulink url="https://github.com/elastic/elasticsearch/pull/11501">#11501</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make CompressedXContent.equals fast again. <ulink url="https://github.com/elastic/elasticsearch/pull/11428">#11428</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11247">#11247</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate shard level modules without logic into IndexShardModule <ulink url="https://github.com/elastic/elasticsearch/pull/11416">#11416</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Serialization: Remove old version checks <ulink url="https://github.com/elastic/elasticsearch/pull/11397">#11397</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Catch UnsatisfiedLinkError on JNA load <ulink url="https://github.com/elastic/elasticsearch/pull/11385">#11385</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Deduplicate field names returned by simpleMatchToFullName &amp; simpleMatchToIndexNames in FieldMappersLookup <ulink url="https://github.com/elastic/elasticsearch/pull/11377">#11377</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10916">#10916</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rename TransportShardReplicationOperationAction to TransportReplicationAction <ulink url="https://github.com/elastic/elasticsearch/pull/11332">#11332</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Absorb ImmutableSettings into Settings <ulink url="https://github.com/elastic/elasticsearch/pull/11321">#11321</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7633">#7633</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make some sec mgr / bootup classes package private and final. <ulink url="https://github.com/elastic/elasticsearch/pull/11312">#11312</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Tighten up our compression framework. <ulink url="https://github.com/elastic/elasticsearch/pull/11279">#11279</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Uid#createTypeUids to accept a collection of ids rather than a list <ulink url="https://github.com/elastic/elasticsearch/pull/11263">#11263</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove need for generics in ContextAndHeaderHolder <ulink url="https://github.com/elastic/elasticsearch/pull/11222">#11222</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove dependency on hppc:esoteric. <ulink url="https://github.com/elastic/elasticsearch/pull/11144">#11144</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve path mgmt on init, better error messages, symlink support <ulink url="https://github.com/elastic/elasticsearch/pull/11106">#11106</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure JNA is fully loaded when its available, but don&#8217;t fail its not <ulink url="https://github.com/elastic/elasticsearch/pull/10989">#10989</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Transport: read/writeGenericValue to support BytesRef <ulink url="https://github.com/elastic/elasticsearch/pull/10878">#10878</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Preconditions class <ulink url="https://github.com/elastic/elasticsearch/pull/10873">#10873</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove index/indices replication infra code <ulink url="https://github.com/elastic/elasticsearch/pull/10861">#10861</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wait forever (or one day) for indices to close <ulink url="https://github.com/elastic/elasticsearch/pull/10833">#10833</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10680">#10680</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reduce code duplication in TransportIndexAction/TransportShardBulkAction. <ulink url="https://github.com/elastic/elasticsearch/pull/10819">#10819</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t create a new BigArrays instance for every call of <literal>withCircuitBreaking</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10800">#10800</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10798">#10798</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change BigArrays to not extend AbstractComponent <ulink url="https://github.com/elastic/elasticsearch/pull/10798">#10798</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use Tuple only as return value in Bootstrap <ulink url="https://github.com/elastic/elasticsearch/pull/10784">#10784</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
CommitStats doesn&#8217;t need to allow for null values in commit user data <ulink url="https://github.com/elastic/elasticsearch/pull/10774">#10774</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10687">#10687</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent injection of unannotated dynamic settings <ulink url="https://github.com/elastic/elasticsearch/pull/10763">#10763</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10614">#10614</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor and cleanup transport request handling <ulink url="https://github.com/elastic/elasticsearch/pull/10730">#10730</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>fairness</literal> option to KeyedLock. <ulink url="https://github.com/elastic/elasticsearch/pull/10703">#10703</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup local code transport execution <ulink url="https://github.com/elastic/elasticsearch/pull/10582">#10582</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make APIs work per-segment like Lucene&#8217;s Collector. <ulink url="https://github.com/elastic/elasticsearch/pull/10389">#10389</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Transport: shortcut local execution <ulink url="https://github.com/elastic/elasticsearch/pull/10350">#10350</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10247">#10247</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix string comparisons <ulink url="https://github.com/elastic/elasticsearch/pull/10204">#10204</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unsafe field in BytesStreamInput <ulink url="https://github.com/elastic/elasticsearch/pull/10157">#10157</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make assert less strict to ensure local node is not null <ulink url="https://github.com/elastic/elasticsearch/pull/10076">#10076</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use provided cluster state for indices service validations <ulink url="https://github.com/elastic/elasticsearch/pull/10014">#10014</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix Java 8 _ variable warning <ulink url="https://github.com/elastic/elasticsearch/pull/10013">#10013</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Stop passing default cluster name to cluster state read operations <ulink url="https://github.com/elastic/elasticsearch/pull/9888">#9888</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add missing @Override annotations. <ulink url="https://github.com/elastic/elasticsearch/pull/9832">#9832</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Some more simple fs cleanups. <ulink url="https://github.com/elastic/elasticsearch/pull/9827">#9827</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix errors reported by error-prone <ulink url="https://github.com/elastic/elasticsearch/pull/9817">#9817</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove redundant fs metadata ops. <ulink url="https://github.com/elastic/elasticsearch/pull/9807">#9807</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed <emphasis>Master</emphasis> from names.txt <ulink url="https://github.com/elastic/elasticsearch/pull/9698">#9698</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9687">#9687</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove XCollector. <ulink url="https://github.com/elastic/elasticsearch/pull/9677">#9677</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduce TimedPrioritizedRunnable base class to all commands that go into InternalClusterService.updateTasksExecutor <ulink url="https://github.com/elastic/elasticsearch/pull/9671">#9671</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8077">#8077</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9354">#9354</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Search: Reuse Lucene&#8217;s MultiCollector. <ulink url="https://github.com/elastic/elasticsearch/pull/9549">#9549</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>beforeIndexAddedToCluster</literal> callback <ulink url="https://github.com/elastic/elasticsearch/pull/9514">#9514</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove HandlesStreamInput/Output <ulink url="https://github.com/elastic/elasticsearch/pull/9486">#9486</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add AliasesRequest interface to mark requests that manage aliases <ulink url="https://github.com/elastic/elasticsearch/pull/9460">#9460</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
ClusterInfoService should wipe local cache upon unknown exceptions <ulink url="https://github.com/elastic/elasticsearch/pull/9449">#9449</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix shard state tranport action names <ulink url="https://github.com/elastic/elasticsearch/pull/9440">#9440</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7105">#7105</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Minor hygiene, Removed Redundant inheritance <ulink url="https://github.com/elastic/elasticsearch/pull/9427">#9427</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clean up memory reuse a bit. <ulink url="https://github.com/elastic/elasticsearch/pull/9272">#9272</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove includeExisting flag from adding ObjectMapper and FieldMapper listeners <ulink url="https://github.com/elastic/elasticsearch/pull/9184">#9184</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reduce the size of the search thread pool. <ulink url="https://github.com/elastic/elasticsearch/pull/9165">#9165</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9135">#9135</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Assert that we do not call blocking code from transport threads <ulink url="https://github.com/elastic/elasticsearch/pull/9164">#9164</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove reduced stack size and use JVM default instead <ulink url="https://github.com/elastic/elasticsearch/pull/9158">#9158</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9135">#9135</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove IndexCloseListener &amp; Store.OnCloseListener <ulink url="https://github.com/elastic/elasticsearch/pull/9009">#9009</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8436">#8436</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8608">#8608</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove circular dependency between IndicesService and IndicesStore <ulink url="https://github.com/elastic/elasticsearch/pull/8918">#8918</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove some Internal* abstractions <ulink url="https://github.com/elastic/elasticsearch/pull/8904">#8904</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove action names bwc layer <ulink url="https://github.com/elastic/elasticsearch/pull/8758">#8758</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7105">#7105</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add File.java to forbidden APIs <ulink url="https://github.com/elastic/elasticsearch/pull/8666">#8666</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Inverse DocIdSets' heuristic to find out fast DocIdSets. <ulink url="https://github.com/elastic/elasticsearch/pull/8380">#8380</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Temporarily ban buggy IOUtils methods with forbidden <ulink url="https://github.com/elastic/elasticsearch/pull/8375">#8375</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor shard recovery from anonymous class to ShardRecoveryHandler <ulink url="https://github.com/elastic/elasticsearch/pull/8363">#8363</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make indexQueryParserService available from ParseContext <ulink url="https://github.com/elastic/elasticsearch/pull/8252">#8252</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8248">#8248</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow to configure custom thread pools <ulink url="https://github.com/elastic/elasticsearch/pull/8247">#8247</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose concurrency_level setting on all caches <ulink url="https://github.com/elastic/elasticsearch/pull/8112">#8112</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7836">#7836</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Resiliency: Be more conservative if index.version.created is not set <ulink url="https://github.com/elastic/elasticsearch/pull/8018">#8018</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Split internal fetch request used within scroll and search <ulink url="https://github.com/elastic/elasticsearch/pull/7870">#7870</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6933">#6933</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7319">#7319</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7856">#7856</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Never send requests after transport service is stopped <ulink url="https://github.com/elastic/elasticsearch/pull/7862">#7862</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Split internal free context request used after scroll and search <ulink url="https://github.com/elastic/elasticsearch/pull/7856">#7856</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6933">#6933</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7319">#7319</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clarify when a shard search request gets created to be only used locally <ulink url="https://github.com/elastic/elasticsearch/pull/7855">#7855</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a listener thread pool <ulink url="https://github.com/elastic/elasticsearch/pull/7837">#7837</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused ForceSyncDirectory <ulink url="https://github.com/elastic/elasticsearch/pull/7804">#7804</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Force execution of delete index requests <ulink url="https://github.com/elastic/elasticsearch/pull/7799">#7799</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check if from + size don&#8217;t cause overflow and fail with a better error <ulink url="https://github.com/elastic/elasticsearch/pull/7778">#7778</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7774">#7774</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that internally generated percolate request re-uses the original headers and request context <ulink url="https://github.com/elastic/elasticsearch/pull/7767">#7767</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that update internal requests share the same original headers and request context <ulink url="https://github.com/elastic/elasticsearch/pull/7766">#7766</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that all delete mapping internal requests share the same original headers and context <ulink url="https://github.com/elastic/elasticsearch/pull/7736">#7736</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added scrollId/s setters to the different scroll requests/responses <ulink url="https://github.com/elastic/elasticsearch/pull/7722">#7722</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that original headers are used when executing search as part of put warmer <ulink url="https://github.com/elastic/elasticsearch/pull/7711">#7711</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor copy headers mechanism to not require a client factory <ulink url="https://github.com/elastic/elasticsearch/pull/7675">#7675</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7594">#7594</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
In thread pools, use DirectExecutor instead of deprecated API <ulink url="https://github.com/elastic/elasticsearch/pull/7636">#7636</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change LZFCompressedStreamOutput to use buffer recycler when allocating encoder <ulink url="https://github.com/elastic/elasticsearch/pull/7613">#7613</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduced a transient context to the rest request <ulink url="https://github.com/elastic/elasticsearch/pull/7610">#7610</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor copy headers mechanism in REST API <ulink url="https://github.com/elastic/elasticsearch/pull/7594">#7594</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6513">#6513</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Deduplicate useful headers that get copied from REST to transport layer <ulink url="https://github.com/elastic/elasticsearch/pull/7590">#7590</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove DocSetCache. <ulink url="https://github.com/elastic/elasticsearch/pull/7582">#7582</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Extract a common base class for (Master|Nodes)FaultDetection <ulink url="https://github.com/elastic/elasticsearch/pull/7512">#7512</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7493">#7493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removing useless methods and method parameters from ObjectMapper.java and TypeParsers.java <ulink url="https://github.com/elastic/elasticsearch/pull/7474">#7474</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7271">#7271</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Extended ActionFilter to also enable filtering the response side <ulink url="https://github.com/elastic/elasticsearch/pull/7465">#7465</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed ConcurrentHashMapV8 <ulink url="https://github.com/elastic/elasticsearch/pull/7392">#7392</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6400">#6400</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7296">#7296</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move index templates api back to indices category and make put template and create index implement IndicesRequest <ulink url="https://github.com/elastic/elasticsearch/pull/7378">#7378</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that multi_search request hands over its context and headers to its corresponding search requests <ulink url="https://github.com/elastic/elasticsearch/pull/7374">#7374</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that multi_percolate request hands over its context and headers to its corresponding shard requests <ulink url="https://github.com/elastic/elasticsearch/pull/7371">#7371</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clarify XContentParser/Builder interface for binary vs. utf8 values <ulink url="https://github.com/elastic/elasticsearch/pull/7367">#7367</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove CacheRecycler. <ulink url="https://github.com/elastic/elasticsearch/pull/7366">#7366</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Get request while percolating existing documents to keep around headers and context of the original percolate request <ulink url="https://github.com/elastic/elasticsearch/pull/7333">#7333</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Auto create index to keep around headers and context of the request that caused it <ulink url="https://github.com/elastic/elasticsearch/pull/7331">#7331</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Switch to fixed thread pool by default for management threads <ulink url="https://github.com/elastic/elasticsearch/pull/7320">#7320</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7318">#7318</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that all shard level requests hold the original indices <ulink url="https://github.com/elastic/elasticsearch/pull/7319">#7319</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactored TransportMessage context <ulink url="https://github.com/elastic/elasticsearch/pull/7303">#7303</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Made it possible to disable the main transport handler in TransportShardSingleOperationAction <ulink url="https://github.com/elastic/elasticsearch/pull/7285">#7285</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adjusted BroadcastShardOperationResponse subclasses visibility <ulink url="https://github.com/elastic/elasticsearch/pull/7255">#7255</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add some @Nullable annotations and fix related compilation warnings. <ulink url="https://github.com/elastic/elasticsearch/pull/7251">#7251</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adjusted visibility for BroadcastShardOperationRequest subclasses and their constructors <ulink url="https://github.com/elastic/elasticsearch/pull/7235">#7235</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Changed every single index operation to not replace the index within the original request <ulink url="https://github.com/elastic/elasticsearch/pull/7223">#7223</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adjusted TermVectorRequest serialization to not serialize and de-serialize the index twice <ulink url="https://github.com/elastic/elasticsearch/pull/7221">#7221</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactored TransportSingleCustomOperationAction, subclasses and requests <ulink url="https://github.com/elastic/elasticsearch/pull/7214">#7214</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed needless serialization code from TransportIndexReplicationAction and corresponding request object <ulink url="https://github.com/elastic/elasticsearch/pull/7211">#7211</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added transient header support for TransportMessage <ulink url="https://github.com/elastic/elasticsearch/pull/7187">#7187</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check for null references that may be returned due to concurrent changes or inconsistent cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/7181">#7181</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better categorization for transport actions <ulink url="https://github.com/elastic/elasticsearch/pull/7105">#7105</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added a cli infrastructure <ulink url="https://github.com/elastic/elasticsearch/pull/7094">#7094</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduced the notion of a FixedBitSetFilter that guarantees to produce a FixedBitSet <ulink url="https://github.com/elastic/elasticsearch/pull/7037">#7037</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7031">#7031</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove use of recycled set in filters eviction <ulink url="https://github.com/elastic/elasticsearch/pull/7012">#7012</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor TransportActions <ulink url="https://github.com/elastic/elasticsearch/pull/6989">#6989</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose the indices names in every action relates to if applicable <ulink url="https://github.com/elastic/elasticsearch/pull/6933">#6933</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename FieldMapper.termsFilter to fieldDataTermsFilter. <ulink url="https://github.com/elastic/elasticsearch/pull/6888">#6888</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make XContentBuilder Releasable <ulink url="https://github.com/elastic/elasticsearch/pull/6869">#6869</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove (mostly) unused <emphasis>failure</emphasis> member from ShardSearchFailure. <ulink url="https://github.com/elastic/elasticsearch/pull/6861">#6861</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6837">#6837</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use KeyedLock in IndexFieldDataService <ulink url="https://github.com/elastic/elasticsearch/pull/6855">#6855</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup of the transport request/response messages <ulink url="https://github.com/elastic/elasticsearch/pull/6834">#6834</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t replace indices within ActionRequest and check blocks against concrete indices <ulink url="https://github.com/elastic/elasticsearch/pull/6777">#6777</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/1">#1</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2">#2</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Separate parsing implementation from setter in SearchParseElement <ulink url="https://github.com/elastic/elasticsearch/pull/6758">#6758</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3602">#3602</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove intern calls on FieldMapper#Names for better performance <ulink url="https://github.com/elastic/elasticsearch/pull/6747">#6747</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable explicit GC by default <ulink url="https://github.com/elastic/elasticsearch/pull/6637">#6637</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure we don&#8217;t reuse arrays when sending an error back <ulink url="https://github.com/elastic/elasticsearch/pull/6631">#6631</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wrap RateLimiter rather than copy RateLimitedIndexOutput <ulink url="https://github.com/elastic/elasticsearch/pull/6625">#6625</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Re-shade MVEL as a dependency <ulink url="https://github.com/elastic/elasticsearch/pull/6570">#6570</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Copy the headers from REST requests to the corresponding TransportRequest(s) <ulink url="https://github.com/elastic/elasticsearch/pull/6513">#6513</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6464">#6464</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Better default size for global index &#8594; alias map <ulink url="https://github.com/elastic/elasticsearch/pull/6504">#6504</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use ConcurrentHashMapV8 for lower memory overhead <ulink url="https://github.com/elastic/elasticsearch/pull/6400">#6400</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Made base64 decode parsing to detect more errors <ulink url="https://github.com/elastic/elasticsearch/pull/6348">#6348</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6334">#6334</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change the default type of the page recycler to CONCURRENT instead of SOFT_CONCURRENT. <ulink url="https://github.com/elastic/elasticsearch/pull/6320">#6320</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Some minor cleanups <ulink url="https://github.com/elastic/elasticsearch/pull/6210">#6210</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove SoftReferences from StreamInput/StreamOutput <ulink url="https://github.com/elastic/elasticsearch/pull/6208">#6208</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use t-digest as a dependency. <ulink url="https://github.com/elastic/elasticsearch/pull/6142">#6142</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for Byte and BytesRef to the XContentBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/6127">#6127</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused dump infra <ulink url="https://github.com/elastic/elasticsearch/pull/6060">#6060</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Made it mandatory to specify IndicesOptions when calling MetaData#concreteIndices <ulink url="https://github.com/elastic/elasticsearch/pull/6059">#6059</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Limit the number of bytes that can be allocated to process requests. <ulink url="https://github.com/elastic/elasticsearch/pull/6050">#6050</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix code typo in FieldSortBuilder.java <ulink url="https://github.com/elastic/elasticsearch/pull/5937">#5937</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improved bloom filter hashing <ulink url="https://github.com/elastic/elasticsearch/pull/5901">#5901</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Field data diet. <ulink url="https://github.com/elastic/elasticsearch/pull/5874">#5874</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup FileSystemUtils <ulink url="https://github.com/elastic/elasticsearch/pull/5806">#5806</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make writePrimitive*() and readPrimitive*() methods public. <ulink url="https://github.com/elastic/elasticsearch/pull/5710">#5710</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
LongHash add/key not consistent [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5693">#5693</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Releasable bytes output + use in transport / translog <ulink url="https://github.com/elastic/elasticsearch/pull/5691">#5691</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make Releasable extend AutoCloseable. <ulink url="https://github.com/elastic/elasticsearch/pull/5689">#5689</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replaces usage of <literal>StringBuffer</literal> with <literal>StringBuilder</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/5606">#5606</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5605">#5605</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Internally manipulate the terms execution hint as an enum instead of a String. <ulink url="https://github.com/elastic/elasticsearch/pull/5530">#5530</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Let ByteArray/BigByteArray.get() indicate whether a byte[] was materialized. <ulink url="https://github.com/elastic/elasticsearch/pull/5529">#5529</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
BytesReference.Helper should never materialize a byte[] array. <ulink url="https://github.com/elastic/elasticsearch/pull/5517">#5517</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clean the query parse context after usage <ulink url="https://github.com/elastic/elasticsearch/pull/5475">#5475</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
BytesReference usage to properly work when hasArray is not available <ulink url="https://github.com/elastic/elasticsearch/pull/5455">#5455</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
MulticastChannel returned wrong channel in shared mode <ulink url="https://github.com/elastic/elasticsearch/pull/5441">#5441</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
New class PagedBytesReference: BytesReference over pages <ulink url="https://github.com/elastic/elasticsearch/pull/5427">#5427</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5420">#5420</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rewrite BytesStreamOutput on top of BigArrays/ByteArray. <ulink url="https://github.com/elastic/elasticsearch/pull/5331">#5331</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5159">#5159</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add tracking of allocated arrays. <ulink url="https://github.com/elastic/elasticsearch/pull/5264">#5264</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove thread local recycler <ulink url="https://github.com/elastic/elasticsearch/pull/5254">#5254</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Recycler: better lifecycle control for pooled instances <ulink url="https://github.com/elastic/elasticsearch/pull/5217">#5217</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5214">#5214</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove useless URL instantiation <ulink url="https://github.com/elastic/elasticsearch/pull/5206">#5206</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Variable renamings to reduce unnecessary variable naming diversity <ulink url="https://github.com/elastic/elasticsearch/pull/5075">#5075</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add RamUsageEstimator#sizeOf(Object) to forbidden APIs <ulink url="https://github.com/elastic/elasticsearch/pull/4975">#4975</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove redundant version checks in transport serialisation <ulink url="https://github.com/elastic/elasticsearch/pull/4731">#4731</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
PrefixQueryParser takes a String as value like its Builder <ulink url="https://github.com/elastic/elasticsearch/pull/12204">#12204</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12032">#12032</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix FuzzyQuery to properly handle Object, number, dates or String.  <ulink url="https://github.com/elastic/elasticsearch/pull/12020">#12020</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11865">#11865</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Treat path object as a simple value instead of Iterable in XContentBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/11903">#11903</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11771">#11771</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
IdsQueryBuilder: Allow to add a list in addition to array <ulink url="https://github.com/elastic/elasticsearch/pull/11409">#11409</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5089">#5089</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix typed parameters in IndexRequestBuilder and CreateIndexRequestBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/11382">#11382</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10825">#10825</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify SearchResponse and BroadcastOperationResponse code around shards header <ulink url="https://github.com/elastic/elasticsearch/pull/11064">#11064</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove duplicated buildAsBytes and corresponding toString methods <ulink url="https://github.com/elastic/elasticsearch/pull/11063">#11063</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove duplicated consistency level and replication type setters <ulink url="https://github.com/elastic/elasticsearch/pull/10188">#10188</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Package private getters to become public if there have corresponding public setters <ulink url="https://github.com/elastic/elasticsearch/pull/9273">#9273</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add internal liveness action to transport client <ulink url="https://github.com/elastic/elasticsearch/pull/8763">#8763</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added utility method <ulink url="https://github.com/elastic/elasticsearch/pull/8594">#8594</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enabled overriding the request headers in the clients <ulink url="https://github.com/elastic/elasticsearch/pull/8258">#8258</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adding setters or making them public in ActionRequests <ulink url="https://github.com/elastic/elasticsearch/pull/8123">#8123</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8122">#8122</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add indices setter to IndicesRequest interface <ulink url="https://github.com/elastic/elasticsearch/pull/7734">#7734</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mark transport client as such when instantiating <ulink url="https://github.com/elastic/elasticsearch/pull/7552">#7552</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow nullable queryBuilder in FilteredQueryBuilder to match rest api <ulink url="https://github.com/elastic/elasticsearch/pull/7398">#7398</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7365">#7365</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Some PercolateRequest "setters" allow for method chaining, some don&#8217;t [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7294">#7294</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw IllegalStateException if you try to .addMapping for same type more than once <ulink url="https://github.com/elastic/elasticsearch/pull/7243">#7243</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7231">#7231</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
XContentBuilder.map(Map) method modified to use a wildcard for value&#8217;s type. <ulink url="https://github.com/elastic/elasticsearch/pull/7212">#7212</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add suggestRequest to Requests and fix broken javadocs in client <ulink url="https://github.com/elastic/elasticsearch/pull/7207">#7207</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7206">#7206</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add index, type and id to ExplainResponse <ulink url="https://github.com/elastic/elasticsearch/pull/7201">#7201</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a blocking variant of close() method to BulkProcessor <ulink url="https://github.com/elastic/elasticsearch/pull/6586">#6586</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4158">#4158</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6314">#6314</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Client intermediate interfaces removal follow-up <ulink url="https://github.com/elastic/elasticsearch/pull/6563">#6563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6517">#6517</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
TransportClient: Improve logging, fix minor issue <ulink url="https://github.com/elastic/elasticsearch/pull/6376">#6376</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>flush</literal> method for BulkProcessor class. <ulink url="https://github.com/elastic/elasticsearch/pull/5575">#5575</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5570">#5570</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add BoolFilterBuilder#hasClauses to be consitent with BoolQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/5476">#5476</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5472">#5472</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow iteration over MultiGetRequest#Item instances <ulink url="https://github.com/elastic/elasticsearch/pull/5470">#5470</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3061">#3061</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Java API does not have a way to set global highlighting settings [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5281">#5281</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Adds a setting to control source output in indexing slowlog <ulink url="https://github.com/elastic/elasticsearch/pull/12806">#12806</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4485">#4485</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add more debugging information to the Awareness Decider <ulink url="https://github.com/elastic/elasticsearch/pull/12490">#12490</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12431">#12431</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add shadow indicator when using shadow replicas <ulink url="https://github.com/elastic/elasticsearch/pull/12399">#12399</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log warn message if leftover shard is detected <ulink url="https://github.com/elastic/elasticsearch/pull/11826">#11826</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add -XX:+PrintGCDateStamps when using GC Logs <ulink url="https://github.com/elastic/elasticsearch/pull/11735">#11735</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11733">#11733</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ClusterStateObserver should log on trace on timeout <ulink url="https://github.com/elastic/elasticsearch/pull/11722">#11722</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better error messages when mlockall fails <ulink url="https://github.com/elastic/elasticsearch/pull/11433">#11433</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Display low disk watermark to be consistent with documentation <ulink url="https://github.com/elastic/elasticsearch/pull/11313">#11313</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10588">#10588</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add logging for failed TTL purges <ulink url="https://github.com/elastic/elasticsearch/pull/11302">#11302</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11019">#11019</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add index name to log statements when settings update fails <ulink url="https://github.com/elastic/elasticsearch/pull/11124">#11124</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add logging of slow cluster state tasks <ulink url="https://github.com/elastic/elasticsearch/pull/10907">#10907</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10874">#10874</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Logging: add the ability to specify an alternate logging configuration location <ulink url="https://github.com/elastic/elasticsearch/pull/10852">#10852</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2044">#2044</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7395">#7395</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Log sending translog operation batches to nodes <ulink url="https://github.com/elastic/elasticsearch/pull/10544">#10544</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log only a summary line of filesystem detail for all path.data on node startup <ulink url="https://github.com/elastic/elasticsearch/pull/10527">#10527</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10502">#10502</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add INFO logging saying whether each path.data is on an SSD <ulink url="https://github.com/elastic/elasticsearch/pull/10502">#10502</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use static logger name in Engine.java <ulink url="https://github.com/elastic/elasticsearch/pull/10497">#10497</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Miscellaneous additional logging and cleanups <ulink url="https://github.com/elastic/elasticsearch/pull/10376">#10376</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix logging a RoutingNode object, log an object with a good .toString instead <ulink url="https://github.com/elastic/elasticsearch/pull/9863">#9863</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Logging: improve logging messages added in #9562 <ulink url="https://github.com/elastic/elasticsearch/pull/9603">#9603</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9562">#9562</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change logging to warning to match pattern <ulink url="https://github.com/elastic/elasticsearch/pull/9593">#9593</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add logging around gateway shard allocation <ulink url="https://github.com/elastic/elasticsearch/pull/9562">#9562</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added a simple request tracer, logging incoming and outgoing Transport requests <ulink url="https://github.com/elastic/elasticsearch/pull/9286">#9286</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log when upgrade API starts and stops <ulink url="https://github.com/elastic/elasticsearch/pull/9229">#9229</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9227">#9227</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reduce apache (cloud-aws) logging when rootLogger is DEBUG <ulink url="https://github.com/elastic/elasticsearch/pull/8856">#8856</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log byte and doc size for slow merges <ulink url="https://github.com/elastic/elasticsearch/pull/8855">#8855</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8853">#8853</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Separately log file deletions <ulink url="https://github.com/elastic/elasticsearch/pull/8662">#8662</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8603">#8603</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clarify index removal log message <ulink url="https://github.com/elastic/elasticsearch/pull/8641">#8641</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add log4j-extras dependency <ulink url="https://github.com/elastic/elasticsearch/pull/8464">#8464</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7927">#7927</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Log how long IW.rollback took, and when MockFSDir starts its check index <ulink url="https://github.com/elastic/elasticsearch/pull/8388">#8388</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change log level for mpercolate <ulink url="https://github.com/elastic/elasticsearch/pull/8306">#8306</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Suppress long mapping logging during mapping updates (unless in TRACE) <ulink url="https://github.com/elastic/elasticsearch/pull/7949">#7949</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add log4j-extras dependency <ulink url="https://github.com/elastic/elasticsearch/pull/7947">#7947</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7927">#7927</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Boostrap: Log startup exception to console if needed and to file as error <ulink url="https://github.com/elastic/elasticsearch/pull/6581">#6581</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Log script change/add and removal at INFO level <ulink url="https://github.com/elastic/elasticsearch/pull/6104">#6104</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Include thread name when logging IndexWriter&#8217;s infoStream messages <ulink url="https://github.com/elastic/elasticsearch/pull/5973">#5973</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Tie in IndexWriter&#8217;s infoStream output to "lucene.iw" logger with level=TRACE <ulink url="https://github.com/elastic/elasticsearch/pull/5934">#5934</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5891">#5891</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Be less verbose logging ClusterInfoUpdateJob failures <ulink url="https://github.com/elastic/elasticsearch/pull/5222">#5222</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Togglable stacktrace display <ulink url="https://github.com/elastic/elasticsearch/pull/5187">#5187</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5102">#5102</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5103">#5103</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add EnhancedPatternLayout to logging.yml options <ulink url="https://github.com/elastic/elasticsearch/pull/4991">#4991</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Move the <literal>_size</literal> mapper to a plugin. <ulink url="https://github.com/elastic/elasticsearch/pull/12582">#12582</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove index name from mapping parser <ulink url="https://github.com/elastic/elasticsearch/pull/12352">#12352</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove AbstractFieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/12089">#12089</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Completely move doc values and fielddata settings to field types <ulink url="https://github.com/elastic/elasticsearch/pull/12014">#12014</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move short name access out of field type <ulink url="https://github.com/elastic/elasticsearch/pull/11977">#11977</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename "root" mappers to "metadata" mappers <ulink url="https://github.com/elastic/elasticsearch/pull/11962">#11962</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mappings: Remove close() from Mapper <ulink url="https://github.com/elastic/elasticsearch/pull/11863">#11863</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move merge simulation of fieldtype settings to fieldtype method <ulink url="https://github.com/elastic/elasticsearch/pull/11783">#11783</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8871">#8871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Hide more fieldType access and cleanup null_value merging <ulink url="https://github.com/elastic/elasticsearch/pull/11770">#11770</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11764">#11764</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Replace fieldType access in mappers with getter <ulink url="https://github.com/elastic/elasticsearch/pull/11764">#11764</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove SmartNameObjectMapper <ulink url="https://github.com/elastic/elasticsearch/pull/11686">#11686</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add equals/hashcode to fieldtypes <ulink url="https://github.com/elastic/elasticsearch/pull/11644">#11644</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Shortcut <literal>exists</literal> and <literal>missing</literal> queries when no types/docs exist <ulink url="https://github.com/elastic/elasticsearch/pull/11586">#11586</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove leftover sugar methods from FieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/11565">#11565</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make index level mapping apis use MappedFieldType <ulink url="https://github.com/elastic/elasticsearch/pull/11559">#11559</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move null value handling into MappedFieldType <ulink url="https://github.com/elastic/elasticsearch/pull/11544">#11544</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor core index/query time properties into FieldType <ulink url="https://github.com/elastic/elasticsearch/pull/11422">#11422</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8871">#8871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Validate parsed document does not have trailing garbage that is invalid json <ulink url="https://github.com/elastic/elasticsearch/pull/11414">#11414</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2315">#2315</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove generics from FieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/11292">#11292</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup field name handling <ulink url="https://github.com/elastic/elasticsearch/pull/11272">#11272</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove document parse listener <ulink url="https://github.com/elastic/elasticsearch/pull/11243">#11243</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove SmartNameFieldMappers <ulink url="https://github.com/elastic/elasticsearch/pull/11216">#11216</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make DocumentMapper.refreshSource() private. <ulink url="https://github.com/elastic/elasticsearch/pull/11209">#11209</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make mapping updates atomic wrt document parsing. <ulink url="https://github.com/elastic/elasticsearch/pull/11205">#11205</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove the <literal>ignore_conflicts</literal> option. <ulink url="https://github.com/elastic/elasticsearch/pull/11203">#11203</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add back support for <literal>enabled</literal>/<literal>includes</literal>/<literal>excludes</literal> in <literal>_source</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/11171">#11171</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11116">#11116</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make FieldNameAnalyzer less lenient. <ulink url="https://github.com/elastic/elasticsearch/pull/11141">#11141</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove mapper listeners <ulink url="https://github.com/elastic/elasticsearch/pull/11045">#11045</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove traverse functions from Mapper <ulink url="https://github.com/elastic/elasticsearch/pull/11027">#11027</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate document parsing logic <ulink url="https://github.com/elastic/elasticsearch/pull/10802">#10802</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wait for required mappings to be available on the replica before indexing. <ulink url="https://github.com/elastic/elasticsearch/pull/10786">#10786</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Join MergeResults with MergeContext since they are almost the same <ulink url="https://github.com/elastic/elasticsearch/pull/10765">#10765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restrict murmur3 field type to sane options <ulink url="https://github.com/elastic/elasticsearch/pull/10738">#10738</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10465">#10465</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify dynamic mappings updates. <ulink url="https://github.com/elastic/elasticsearch/pull/10720">#10720</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10593">#10593</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplified mapper lookups <ulink url="https://github.com/elastic/elasticsearch/pull/10705">#10705</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8871">#8871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove dead code after previous refactorings <ulink url="https://github.com/elastic/elasticsearch/pull/10666">#10666</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8877">#8877</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Same code path for dynamic mappings updates and updates coming from the API. <ulink url="https://github.com/elastic/elasticsearch/pull/10593">#10593</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8688">#8688</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9364">#9364</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9851">#9851</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>enabled</literal> flag for <literal>_field_names</literal> to replace disabling through <literal>index:no</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9893">#9893</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix field mappers to always pass through index settings <ulink url="https://github.com/elastic/elasticsearch/pull/9780">#9780</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>ignore_missing</literal> option to <literal>timestamp</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9104">#9104</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8882">#8882</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9049">#9049</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Include currentFieldName into ObjectMapper errors <ulink url="https://github.com/elastic/elasticsearch/pull/9020">#9020</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Store <literal>_timestamp</literal> by default. <ulink url="https://github.com/elastic/elasticsearch/pull/8139">#8139</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better validation of mapping JSON <ulink url="https://github.com/elastic/elasticsearch/pull/7534">#7534</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7205">#7205</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make lookup structures immutable. <ulink url="https://github.com/elastic/elasticsearch/pull/7486">#7486</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Report conflict when merging <literal>_all</literal> field mapping and throw exception when doc_values specified <ulink url="https://github.com/elastic/elasticsearch/pull/7377">#7377</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/777">#777</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enforce non-null settings. <ulink url="https://github.com/elastic/elasticsearch/pull/7032">#7032</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Control whether MapperService docMapper iterator should contain DEFAULT_MAPPING <ulink url="https://github.com/elastic/elasticsearch/pull/6793">#6793</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Call callback on actual mapping processed <ulink url="https://github.com/elastic/elasticsearch/pull/6748">#6748</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve performance for many new fields introduction in mapping <ulink url="https://github.com/elastic/elasticsearch/pull/6707">#6707</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better logic on sending mapping update new type introduction <ulink url="https://github.com/elastic/elasticsearch/pull/6669">#6669</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wait for mapping updates during local recovery <ulink url="https://github.com/elastic/elasticsearch/pull/6666">#6666</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check if root mapping is actually valid <ulink url="https://github.com/elastic/elasticsearch/pull/6093">#6093</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4483">#4483</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5864">#5864</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support empty properties array in mappings <ulink url="https://github.com/elastic/elasticsearch/pull/6006">#6006</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5887">#5887</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update default precision step, modulo tests <ulink url="https://github.com/elastic/elasticsearch/pull/5908">#5908</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5905">#5905</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add lucene LMSimilarity <ulink url="https://github.com/elastic/elasticsearch/pull/5701">#5701</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5697">#5697</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support externalValue() in mappers <ulink url="https://github.com/elastic/elasticsearch/pull/4986">#4986</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Norms disabling on existing fields [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4813">#4813</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
More Like This
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Renamed <literal>ignore_like</literal> to <literal>unlike</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11117">#11117</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Lenient default parameters <ulink url="https://github.com/elastic/elasticsearch/pull/9412">#9412</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove MLT Field Query <ulink url="https://github.com/elastic/elasticsearch/pull/8238">#8238</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for when all fields are deprecated <ulink url="https://github.com/elastic/elasticsearch/pull/8067">#8067</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add versatile <emphasis>like</emphasis> parameter <ulink url="https://github.com/elastic/elasticsearch/pull/8039">#8039</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replace <literal>percent_terms_to_match</literal> with <literal>minimum_should_match</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7898">#7898</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Default to all possible fields for items <ulink url="https://github.com/elastic/elasticsearch/pull/7382">#7382</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Switch to using the multi-termvectors API <ulink url="https://github.com/elastic/elasticsearch/pull/7014">#7014</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fetch text from all possible fields if none are specified <ulink url="https://github.com/elastic/elasticsearch/pull/6740">#6740</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure selection of best terms is indeed O(n) <ulink url="https://github.com/elastic/elasticsearch/pull/6657">#6657</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Create only one MLT query per field for all queried items <ulink url="https://github.com/elastic/elasticsearch/pull/6404">#6404</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add the ability to specify the analyzer used for each Field <ulink url="https://github.com/elastic/elasticsearch/pull/6329">#6329</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added syntax for single item specification. <ulink url="https://github.com/elastic/elasticsearch/pull/6311">#6311</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Values of a multi-value fields are compared at the same level <ulink url="https://github.com/elastic/elasticsearch/pull/6310">#6310</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replaced <literal>exclude</literal> with <literal>include</literal> to avoid double negation <ulink url="https://github.com/elastic/elasticsearch/pull/6248">#6248</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow for both <literal>like_text</literal> and <literal>docs</literal>/<literal>ids</literal> to be specified. <ulink url="https://github.com/elastic/elasticsearch/pull/6246">#6246</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added the ability to include the queried document for More Like This API. <ulink url="https://github.com/elastic/elasticsearch/pull/6067">#6067</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix behavior on default boost factor for More Like This. <ulink url="https://github.com/elastic/elasticsearch/pull/6021">#6021</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added searching for multiple similar documents <ulink url="https://github.com/elastic/elasticsearch/pull/5857">#5857</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4075">#4075</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
NOT CLASSIFIED
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Randomized testing version bump <ulink url="https://github.com/elastic/elasticsearch/pull/7138">#7138</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Jackson 2.4.1.1 [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6789">#6789</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to mvel 2.2.0.Final [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5877">#5877</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Nested Docs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add <literal>min</literal> score mode to <literal>nested</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/11909">#11909</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added nested scope to parse context that keeps track the current nested level during search request parsing <ulink url="https://github.com/elastic/elasticsearch/pull/9692">#9692</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9305">#9305</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix support for named filters/queries inside nested filters. <ulink url="https://github.com/elastic/elasticsearch/pull/6293">#6293</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t print lots of noise on IPv4 only hosts. <ulink url="https://github.com/elastic/elasticsearch/pull/13026">#13026</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove support for address resolving in InetSocketTransportAddress <ulink url="https://github.com/elastic/elasticsearch/pull/13020">#13020</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13014">#13014</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Log network configuration at debug level <ulink url="https://github.com/elastic/elasticsearch/pull/12979">#12979</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use preferIPv6Addresses for sort order, not preferIPv4Stack <ulink url="https://github.com/elastic/elasticsearch/pull/12951">#12951</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure messages are fully read even in case of EOS markers. <ulink url="https://github.com/elastic/elasticsearch/pull/11768">#11768</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11748">#11748</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add profile name to TransportChannel <ulink url="https://github.com/elastic/elasticsearch/pull/11261">#11261</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10483">#10483</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Default value for socket reuse should not be null <ulink url="https://github.com/elastic/elasticsearch/pull/11255">#11255</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make Netty exceptionCaught method protected <ulink url="https://github.com/elastic/elasticsearch/pull/10464">#10464</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove content thread safe from REST layer <ulink url="https://github.com/elastic/elasticsearch/pull/10429">#10429</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add getter for channel in NettyTransportChannel <ulink url="https://github.com/elastic/elasticsearch/pull/10319">#10319</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Schedule transport ping interval <ulink url="https://github.com/elastic/elasticsearch/pull/10189">#10189</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Return useful error message on potential HTTP connect to Transport port <ulink url="https://github.com/elastic/elasticsearch/pull/10108">#10108</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2139">#2139</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change access modifiers to protected in Netty HTTP Transport <ulink url="https://github.com/elastic/elasticsearch/pull/9724">#9724</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add profiles to Netty transport infos <ulink url="https://github.com/elastic/elasticsearch/pull/9134">#9134</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support binding on multiple host/port pairs <ulink url="https://github.com/elastic/elasticsearch/pull/8098">#8098</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Chunk direct buffer usage by networking layer <ulink url="https://github.com/elastic/elasticsearch/pull/7811">#7811</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure channel closing never happens on i/o thread <ulink url="https://github.com/elastic/elasticsearch/pull/7726">#7726</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support "default" for tcpNoDelay and tcpKeepAlive  <ulink url="https://github.com/elastic/elasticsearch/pull/7136">#7136</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7115">#7115</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactoring to make MessageChannelHandler extensible <ulink url="https://github.com/elastic/elasticsearch/pull/6915">#6915</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6889">#6889</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactoring to make Netty MessageChannelHandler extensible <ulink url="https://github.com/elastic/elasticsearch/pull/6889">#6889</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve large bytes request handling by detecting content composite buffer <ulink url="https://github.com/elastic/elasticsearch/pull/6756">#6756</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use loopback when localhost is not resolved <ulink url="https://github.com/elastic/elasticsearch/pull/5719">#5719</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Bats testing: Remove useless systemctl check <ulink url="https://github.com/elastic/elasticsearch/pull/12724">#12724</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12682">#12682</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
improve sanity of securitymanager file permissions <ulink url="https://github.com/elastic/elasticsearch/pull/12609">#12609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Core Lib directory <ulink url="https://github.com/elastic/elasticsearch/pull/12485">#12485</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12010">#12010</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not kill process on service shutdown <ulink url="https://github.com/elastic/elasticsearch/pull/12298">#12298</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11248">#11248</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve JVM Arch Detection <ulink url="https://github.com/elastic/elasticsearch/pull/12274">#12274</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12256">#12256</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
fail plugins on version mismatch <ulink url="https://github.com/elastic/elasticsearch/pull/12221">#12221</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow use of bouncycastle <ulink url="https://github.com/elastic/elasticsearch/pull/12102">#12102</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Give a better exception when a jar contains same classfile twice. <ulink url="https://github.com/elastic/elasticsearch/pull/12093">#12093</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t jarhell check system jars <ulink url="https://github.com/elastic/elasticsearch/pull/11979">#11979</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
detect jar hell before installing a plugin <ulink url="https://github.com/elastic/elasticsearch/pull/11963">#11963</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11946">#11946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
jar hell check should fail, if jars require higher java version <ulink url="https://github.com/elastic/elasticsearch/pull/11936">#11936</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fail startup (and tests) on jar hell <ulink url="https://github.com/elastic/elasticsearch/pull/11932">#11932</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11926">#11926</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Load plugins into classpath in bootstrap <ulink url="https://github.com/elastic/elasticsearch/pull/11918">#11918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11917">#11917</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
steps to remove dangerous security permissions <ulink url="https://github.com/elastic/elasticsearch/pull/11898">#11898</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Packaging: Add LICENSE and NOTICE files for all core dependencies <ulink url="https://github.com/elastic/elasticsearch/pull/11705">#11705</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10684">#10684</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2794">#2794</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Export hostname as environment variable for plugin manager <ulink url="https://github.com/elastic/elasticsearch/pull/11399">#11399</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10902">#10902</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9474">#9474</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use our provided JNA library, versus one installed on the system <ulink url="https://github.com/elastic/elasticsearch/pull/11163">#11163</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unnecessary permissions. <ulink url="https://github.com/elastic/elasticsearch/pull/11132">#11132</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Tighten up script security more <ulink url="https://github.com/elastic/elasticsearch/pull/10999">#10999</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add pid file to Environment <ulink url="https://github.com/elastic/elasticsearch/pull/10986">#10986</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Bail if ES is run as root <ulink url="https://github.com/elastic/elasticsearch/pull/10970">#10970</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove exitVM permissions <ulink url="https://github.com/elastic/elasticsearch/pull/10963">#10963</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove JNI permissions, improve JNI testing. <ulink url="https://github.com/elastic/elasticsearch/pull/10962">#10962</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove shutdownHooks permission <ulink url="https://github.com/elastic/elasticsearch/pull/10953">#10953</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify securitymanager init <ulink url="https://github.com/elastic/elasticsearch/pull/10936">#10936</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Exclude jackson-databind dependency <ulink url="https://github.com/elastic/elasticsearch/pull/10924">#10924</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove reflection permission for sun.management. <ulink url="https://github.com/elastic/elasticsearch/pull/10848">#10848</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10553">#10553</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Security manager cleanups <ulink url="https://github.com/elastic/elasticsearch/pull/10844">#10844</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add common SystemD file for RPM/DEB package <ulink url="https://github.com/elastic/elasticsearch/pull/10725">#10725</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enable securitymanager <ulink url="https://github.com/elastic/elasticsearch/pull/10717">#10717</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove working directory <ulink url="https://github.com/elastic/elasticsearch/pull/10672">#10672</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Standardization of packages structure and install <ulink url="https://github.com/elastic/elasticsearch/pull/10595">#10595</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10330">#10330</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add properties files to configure startup and installation scripts <ulink url="https://github.com/elastic/elasticsearch/pull/10330">#10330</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use direct mapping call in Kernel32Library <ulink url="https://github.com/elastic/elasticsearch/pull/9923">#9923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9802">#9802</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
service.bat file should explicitly use the Windows find command. <ulink url="https://github.com/elastic/elasticsearch/pull/9532">#9532</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
CliTool: Add command to warn on permission/owner change <ulink url="https://github.com/elastic/elasticsearch/pull/9508">#9508</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Export the hostname as environment variable <ulink url="https://github.com/elastic/elasticsearch/pull/9474">#9474</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8470">#8470</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Windows: makes elasticsearch.bat more friendly to automated processes <ulink url="https://github.com/elastic/elasticsearch/pull/9160">#9160</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8913">#8913</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Shutdown: Add support for Ctrl-Close event on Windows platforms to grace&#8230; <ulink url="https://github.com/elastic/elasticsearch/pull/8993">#8993</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Packaging: Add java7/8 java-package paths to init script <ulink url="https://github.com/elastic/elasticsearch/pull/8815">#8815</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7383">#7383</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check if proc file exists before calling sysctl <ulink url="https://github.com/elastic/elasticsearch/pull/8793">#8793</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4978">#4978</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Factor out PID file creation and add tests <ulink url="https://github.com/elastic/elasticsearch/pull/8775">#8775</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8771">#8771</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
deb: add systemd service config for upcoming Jessie <ulink url="https://github.com/elastic/elasticsearch/pull/8765">#8765</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8493">#8493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
bin/elasticsearch: add help, fix endless loop <ulink url="https://github.com/elastic/elasticsearch/pull/8729">#8729</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2168">#2168</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7104">#7104</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow configuration of the GC log file via an environment variable <ulink url="https://github.com/elastic/elasticsearch/pull/8479">#8479</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8471">#8471</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8479">#8479</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Introduce elasticsearch.in.bat (i.e. es.in for Windows) <ulink url="https://github.com/elastic/elasticsearch/pull/8244">#8244</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8237">#8237</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make .zip and .tar.gz release artifacts contain same files <ulink url="https://github.com/elastic/elasticsearch/pull/7578">#7578</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2793">#2793</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add default oracle jdk 7 (x64) path to JDK_DIRS <ulink url="https://github.com/elastic/elasticsearch/pull/7132">#7132</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prevent init script from returning when the service isn&#8217;t actually started <ulink url="https://github.com/elastic/elasticsearch/pull/6909">#6909</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Windows: Modify command window title (windows) <ulink url="https://github.com/elastic/elasticsearch/pull/6752">#6752</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6336">#6336</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove java-6 directories from debian init script <ulink url="https://github.com/elastic/elasticsearch/pull/6350">#6350</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reset locale to C in bin/elasticsearch <ulink url="https://github.com/elastic/elasticsearch/pull/6047">#6047</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove spaces from commented config lines in elasticsearch.yml and logging.yml [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5842">#5842</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use the new command line syntax in the init script <ulink url="https://github.com/elastic/elasticsearch/pull/5033">#5033</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Startup: Add ES_HOME to ES_INCLUDE search path <ulink url="https://github.com/elastic/elasticsearch/pull/4958">#4958</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mark <emphasis>lucene-expression</emphasis> as <emphasis>provided</emphasis> in pom.xml <ulink url="https://github.com/elastic/elasticsearch/pull/4861">#4861</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4858">#4858</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4859">#4859</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move systemd files from /etc to /usr/lib <ulink url="https://github.com/elastic/elasticsearch/pull/4029">#4029</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Enforce _parent field resolution to be strict <ulink url="https://github.com/elastic/elasticsearch/pull/9521">#9521</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9461">#9461</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reduce memory usage in top children query <ulink url="https://github.com/elastic/elasticsearch/pull/8165">#8165</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adding <literal>min</literal> score mode to parent-child queries <ulink url="https://github.com/elastic/elasticsearch/pull/7771">#7771</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7603">#7603</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support <literal>min_children</literal> and <literal>max_children</literal> on <literal>has_child</literal> query/filter [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6019">#6019</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix P/C assertions for rewrite reader <ulink url="https://github.com/elastic/elasticsearch/pull/5731">#5731</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Migrated p/c queries from id cache to field data. <ulink url="https://github.com/elastic/elasticsearch/pull/4878">#4878</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4930">#4930</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t cache percolator query on loading percolators <ulink url="https://github.com/elastic/elasticsearch/pull/12862">#12862</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change <literal>percolator.getTime</literal> &#8594; <literal>percolator.time</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11954">#11954</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
The query parse context should be fetched from the IndexQueryParseService <ulink url="https://github.com/elastic/elasticsearch/pull/11929">#11929</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduce index option named <emphasis>index.percolator.map_unmapped_fields_as_string</emphasis> <ulink url="https://github.com/elastic/elasticsearch/pull/9054">#9054</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9025">#9025</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9053">#9053</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>index.percolator.allow_unmapped_fields</literal> setting. <ulink url="https://github.com/elastic/elasticsearch/pull/8439">#8439</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Percolator should cache index field data instances. <ulink url="https://github.com/elastic/elasticsearch/pull/7081">#7081</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6806">#6806</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reuse IndexFieldData instances between percolator queries <ulink url="https://github.com/elastic/elasticsearch/pull/6845">#6845</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6806">#6806</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add MemoryIndex reuse when percolating doc with nested type <ulink url="https://github.com/elastic/elasticsearch/pull/5332">#5332</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud AWS
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Don&#8217;t show access_key and filter_key in S3 repository settings <ulink url="https://github.com/elastic/elasticsearch/pull/12845">#12845</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11265">#11265</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/184">#184</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for base_path in elasticsearch.yml <ulink url="https://github.com/elastic/elasticsearch/pull/12761">#12761</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Adding retry when checking s3 snapshot repository <ulink url="https://github.com/elastic/elasticsearch/pull/12498">#12498</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12462">#12462</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade AWS dependency to 1.10.0 <ulink url="https://github.com/elastic/elasticsearch/pull/11659">#11659</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud GCE
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update to GCE API v1-rev71-1.20.0 [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12835">#12835</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Lucene SPI support for plugins. <ulink url="https://github.com/elastic/elasticsearch/pull/13051">#13051</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure additionalSettings() do not conflict <ulink url="https://github.com/elastic/elasticsearch/pull/12967">#12967</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Validate checksums for plugins if available <ulink url="https://github.com/elastic/elasticsearch/pull/12888">#12888</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12750">#12750</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose zen ElectMasterService as a Discovery extension point <ulink url="https://github.com/elastic/elasticsearch/pull/12828">#12828</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduce a formal ExtensionPoint class to stream line extensions <ulink url="https://github.com/elastic/elasticsearch/pull/12826">#12826</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Flatten Allocation modules and add back ability to plugin ShardsAllocators <ulink url="https://github.com/elastic/elasticsearch/pull/12818">#12818</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12781">#12781</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Apply additional plugin settings only if settings are not explicit <ulink url="https://github.com/elastic/elasticsearch/pull/12796">#12796</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
PluginManager: Do not try other URLs if specific URL was passed <ulink url="https://github.com/elastic/elasticsearch/pull/12766">#12766</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
PluginManager: Fix elastic.co download URLs, add snapshot ones <ulink url="https://github.com/elastic/elasticsearch/pull/12641">#12641</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12632">#12632</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix plugin script to allow spaces in ES_HOME <ulink url="https://github.com/elastic/elasticsearch/pull/12610">#12610</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12504">#12504</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
PluginManager: Add Support for basic auth <ulink url="https://github.com/elastic/elasticsearch/pull/12445">#12445</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure logging configuration is loaded in plugin manager <ulink url="https://github.com/elastic/elasticsearch/pull/12081">#12081</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12064">#12064</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Simplify Plugin Manager for official plugins <ulink url="https://github.com/elastic/elasticsearch/pull/11805">#11805</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow security rule for advanced SSL configutation <ulink url="https://github.com/elastic/elasticsearch/pull/11751">#11751</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use of default CONF_DIR/CONF_FILE in plugin install <ulink url="https://github.com/elastic/elasticsearch/pull/10721">#10721</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10673">#10673</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7946">#7946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Always send current ES version when downloading plugins <ulink url="https://github.com/elastic/elasticsearch/pull/10131">#10131</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
FileSystemUtils: Only create backup copies if files differ <ulink url="https://github.com/elastic/elasticsearch/pull/9592">#9592</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add executable flag to every file in bin/ after install <ulink url="https://github.com/elastic/elasticsearch/pull/7177">#7177</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Lucene version checker should use <literal>Lucene.parseVersionLenient</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7056">#7056</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Introduced pluggable filter chain to be able to filter transport actions execution <ulink url="https://github.com/elastic/elasticsearch/pull/6921">#6921</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enables plugins to define default logging configuration for their needs. <ulink url="https://github.com/elastic/elasticsearch/pull/6805">#6805</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6802">#6802</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>bin/plugin</literal> tests for missing plugin name when passing <literal>--url</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/6013">#6013</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5976">#5976</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5977">#5977</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check plugin Lucene version <ulink url="https://github.com/elastic/elasticsearch/pull/4984">#4984</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Serving _site plugins do not pick up on index.html for sub directories <ulink url="https://github.com/elastic/elasticsearch/pull/4850">#4850</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4845">#4845</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add version to plugins <ulink url="https://github.com/elastic/elasticsearch/pull/4378">#4378</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2668">#2668</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2784">#2784</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove attemped (not working) support for array in not query parser <ulink url="https://github.com/elastic/elasticsearch/pull/12890">#12890</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
simple query string: remove (not working) support for alternate formats <ulink url="https://github.com/elastic/elasticsearch/pull/12798">#12798</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12794">#12794</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
RegexpQueryParser takes a String as value like its Builder <ulink url="https://github.com/elastic/elasticsearch/pull/12200">#12200</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11896">#11896</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose Lucene&#8217;s new TopTermsBlendedFreqScoringRewrite. <ulink url="https://github.com/elastic/elasticsearch/pull/12129">#12129</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Default fuzzy transpositions to true <ulink url="https://github.com/elastic/elasticsearch/pull/12090">#12090</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9278">#9278</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Special case the <literal>_index</literal> field in queries <ulink url="https://github.com/elastic/elasticsearch/pull/12027">#12027</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3316">#3316</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for query boost to SimpleQueryStringBuilder. <ulink url="https://github.com/elastic/elasticsearch/pull/11696">#11696</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11274">#11274</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change geo filters into queries <ulink url="https://github.com/elastic/elasticsearch/pull/11137">#11137</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make the script filter a query. <ulink url="https://github.com/elastic/elasticsearch/pull/11126">#11126</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function score: Add <literal>default</literal> to <literal>field_value_factor</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/10845">#10845</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10841">#10841</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return positions of parse errors found in JSON <ulink url="https://github.com/elastic/elasticsearch/pull/10837">#10837</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3303">#3303</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enable Lucene ranking behaviour for numeric term queries <ulink url="https://github.com/elastic/elasticsearch/pull/10790">#10790</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10628">#10628</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for <literal>minimum_should_match</literal> to <literal>simple_query_string</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9864">#9864</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6449">#6449</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Raise an exception on an array of values being sent as the factor for a <literal>field_value_factor</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/9246">#9246</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7408">#7408</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
function_score: use query and filter together <ulink url="https://github.com/elastic/elasticsearch/pull/8675">#8675</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8638">#8638</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add option for analyzing wildcard/prefix to simple_query_strinq <ulink url="https://github.com/elastic/elasticsearch/pull/8422">#8422</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/787">#787</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose <literal>max_determinized_states</literal> in regexp query, filter <ulink url="https://github.com/elastic/elasticsearch/pull/8384">#8384</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8357">#8357</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
FunctionScore: RandomScoreFunction now accepts long, as well a strings. <ulink url="https://github.com/elastic/elasticsearch/pull/8311">#8311</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8267">#8267</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Be stricter parsing ids for ids query <ulink url="https://github.com/elastic/elasticsearch/pull/7945">#7945</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7686">#7686</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Function Score: Add optional weight parameter per function <ulink url="https://github.com/elastic/elasticsearch/pull/7137">#7137</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6955">#6955</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add time zone setting for relative date math in range filter/query <ulink url="https://github.com/elastic/elasticsearch/pull/7113">#7113</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3729">#3729</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for the <literal>_name</literal> parameter to the <literal>simple_query_string</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/6979">#6979</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function score parser should throw exception if both <literal>functions:[]</literal> and single <literal>function</literal> given <ulink url="https://github.com/elastic/elasticsearch/pull/5995">#5995</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor SimpleQueryParser settings into separate Settings class, add "lenient" option <ulink url="https://github.com/elastic/elasticsearch/pull/5208">#5208</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5011">#5011</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw parsing exception if terms filter or query has more than one field <ulink url="https://github.com/elastic/elasticsearch/pull/5137">#5137</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5014">#5014</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add "locale" parameter to query_string and simple_query_string <ulink url="https://github.com/elastic/elasticsearch/pull/5131">#5131</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5128">#5128</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for <literal>lowercase_expanded_terms</literal> flag to simple_query_string <ulink url="https://github.com/elastic/elasticsearch/pull/5126">#5126</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5008">#5008</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add fuzzy/slop support to <literal>simple_query_string</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/4985">#4985</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Range filter no cache behaviour for <literal>now</literal> with rounding <ulink url="https://github.com/elastic/elasticsearch/pull/4955">#4955</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4846">#4846</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4947">#4947</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose <literal>dist</literal>/<literal>pre</literal>/<literal>post</literal> options for SpanNotQuery <ulink url="https://github.com/elastic/elasticsearch/pull/4452">#4452</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Suppress rest exceptions by default and log them instead <ulink url="https://github.com/elastic/elasticsearch/pull/12991">#12991</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Create Snapshot: remove _create from POST path to match PUT <ulink url="https://github.com/elastic/elasticsearch/pull/11928">#11928</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11897">#11897</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>rewrite</literal> query parameter to the <literal>indices.validate_query</literal> API spec <ulink url="https://github.com/elastic/elasticsearch/pull/11580">#11580</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10147">#10147</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify query_string parameters parsing <ulink url="https://github.com/elastic/elasticsearch/pull/11057">#11057</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
HttpServer: Support relative plugin paths <ulink url="https://github.com/elastic/elasticsearch/pull/10975">#10975</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10958">#10958</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove global <literal>source</literal> parameter from individual APIs in REST spec <ulink url="https://github.com/elastic/elasticsearch/pull/10863">#10863</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add more utilities for source/body handling in RestAction <ulink url="https://github.com/elastic/elasticsearch/pull/10724">#10724</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add option to only return simple exception messages <ulink url="https://github.com/elastic/elasticsearch/pull/10117">#10117</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better detection of CBOR <ulink url="https://github.com/elastic/elasticsearch/pull/10026">#10026</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7640">#7640</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose <literal>master_timeout</literal> flag on <literal>GET _template</literal> &amp; <literal>HEAD _template</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9688">#9688</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for multi-index query parameters for <literal>_cluster/state</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9295">#9295</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5229">#5229</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>indices_boost</literal> URL param <ulink url="https://github.com/elastic/elasticsearch/pull/9244">#9244</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6281">#6281</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Support JSON request body in scroll, clear scroll, and analyze APIs <ulink url="https://github.com/elastic/elasticsearch/pull/9076">#9076</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5866">#5866</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds parameters to API endpoint cluster put settings specification <ulink url="https://github.com/elastic/elasticsearch/pull/8769">#8769</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added <literal>_shards</literal> header to all write responses. <ulink url="https://github.com/elastic/elasticsearch/pull/7994">#7994</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Changed the root rest endpoint (<emphasis>/</emphasis>) to use cluster service <ulink url="https://github.com/elastic/elasticsearch/pull/7933">#7933</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7899">#7899</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add the cluster name to the "/" endpoint <ulink url="https://github.com/elastic/elasticsearch/pull/7524">#7524</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
A content decompressor that throws a human readable message when <ulink url="https://github.com/elastic/elasticsearch/pull/7241">#7241</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added missing percolate API parameters to the rest spec <ulink url="https://github.com/elastic/elasticsearch/pull/7173">#7173</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add REST API spec for /_search_shards endpoint <ulink url="https://github.com/elastic/elasticsearch/pull/5907">#5907</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rest layer refactoring phase 2 + recycling in http layer <ulink url="https://github.com/elastic/elasticsearch/pull/5708">#5708</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>explain</literal> flag support to the reroute API <ulink url="https://github.com/elastic/elasticsearch/pull/5027">#5027</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2483">#2483</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5169">#5169</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw exception if an additional field was placed inside the "query" body <ulink url="https://github.com/elastic/elasticsearch/pull/4913">#4913</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4895">#4895</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
REST API: Consistent get field mapping response <ulink url="https://github.com/elastic/elasticsearch/pull/4822">#4822</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4738">#4738</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rest API: Ensure 503 signals ==  retry on another node [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4066">#4066</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Reduce cluster update reroutes with async fetch <ulink url="https://github.com/elastic/elasticsearch/pull/11421">#11421</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check if the index can be opened and is not corrupted on state listing <ulink url="https://github.com/elastic/elasticsearch/pull/11269">#11269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11226">#11226</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
No need to send mappings to the master node on phase 2. <ulink url="https://github.com/elastic/elasticsearch/pull/11207">#11207</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow to recover into a folder containing a corrupted shard <ulink url="https://github.com/elastic/elasticsearch/pull/10558">#10558</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Integrate translog recovery into Engine / InternalEngine <ulink url="https://github.com/elastic/elasticsearch/pull/10452">#10452</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only cancel recovery when primary completed relocation <ulink url="https://github.com/elastic/elasticsearch/pull/10218">#10218</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wipe shard state before switching recovered files live <ulink url="https://github.com/elastic/elasticsearch/pull/10179">#10179</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10053">#10053</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Engine: update index buffer size during recovery and allow configuring version map size <ulink url="https://github.com/elastic/elasticsearch/pull/10046">#10046</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6363">#6363</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6667">#6667</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify RecoveryState management to IndexShard and clean up semantics <ulink url="https://github.com/elastic/elasticsearch/pull/9902">#9902</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9503">#9503</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only iterate the files that we recovered from the commit <ulink url="https://github.com/elastic/elasticsearch/pull/9761">#9761</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a timeout to local mapping change check <ulink url="https://github.com/elastic/elasticsearch/pull/9575">#9575</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Node shut down during the last phase of recovery needlessly fails shard [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/9496">#9496</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Flush immediately after a remote recovery finishes (unless there are ongoing ones) <ulink url="https://github.com/elastic/elasticsearch/pull/9439">#9439</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t throttle recovery indexing operations <ulink url="https://github.com/elastic/elasticsearch/pull/9396">#9396</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9394">#9394</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Release store lock before blocking on mapping updates <ulink url="https://github.com/elastic/elasticsearch/pull/9102">#9102</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure shards are identical after recovery <ulink url="https://github.com/elastic/elasticsearch/pull/8723">#8723</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Be more resilient to partial network partitions <ulink url="https://github.com/elastic/elasticsearch/pull/8720">#8720</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw IndexShardClosedException if shard is closed <ulink url="https://github.com/elastic/elasticsearch/pull/8648">#8648</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow to cancel recovery sources when shards are closed <ulink url="https://github.com/elastic/elasticsearch/pull/8555">#8555</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor RecoveryTarget state management <ulink url="https://github.com/elastic/elasticsearch/pull/8092">#8092</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7315">#7315</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7893">#7893</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
During recovery, mark last file chunk to fail fast if payload is truncated <ulink url="https://github.com/elastic/elasticsearch/pull/7830">#7830</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unneeded waits on recovery cancellation <ulink url="https://github.com/elastic/elasticsearch/pull/7717">#7717</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Set a default of 5m to <literal>recover_after_time</literal> when any of the <literal>expected*Nodes</literal> is set <ulink url="https://github.com/elastic/elasticsearch/pull/6742">#6742</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a best effort waiting for ongoing recoveries to cancel on close <ulink url="https://github.com/elastic/elasticsearch/pull/6741">#6741</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cancel recovery if shard on the target node closes during recovery operation <ulink url="https://github.com/elastic/elasticsearch/pull/6645">#6645</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
RecoveryID should not be a per JVM but per Node <ulink url="https://github.com/elastic/elasticsearch/pull/6207">#6207</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Before deleting a local unused shard copy, verify we&#8217;re connected to the node it&#8217;s supposed to be on <ulink url="https://github.com/elastic/elasticsearch/pull/6191">#6191</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change default recovery throttling to 50MB / sec <ulink url="https://github.com/elastic/elasticsearch/pull/5913">#5913</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fail replica shards locally upon failures <ulink url="https://github.com/elastic/elasticsearch/pull/5847">#5847</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5800">#5800</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Allow scripts to expose whether they use the <literal>_score</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/12695">#12695</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add path.scripts directory <ulink url="https://github.com/elastic/elasticsearch/pull/12668">#12668</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Simplify CacheKey used for scripts <ulink url="https://github.com/elastic/elasticsearch/pull/12092">#12092</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow executable expression scripts for aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/11689">#11689</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11596">#11596</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify script and template requests across codebase <ulink url="https://github.com/elastic/elasticsearch/pull/11164">#11164</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10113">#10113</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10810">#10810</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11091">#11091</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Minor TimeZone Fix <ulink url="https://github.com/elastic/elasticsearch/pull/10994">#10994</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Run groovy scripts with no permissions <ulink url="https://github.com/elastic/elasticsearch/pull/10969">#10969</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add Field Methods <ulink url="https://github.com/elastic/elasticsearch/pull/10890">#10890</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove groovy sandbox <ulink url="https://github.com/elastic/elasticsearch/pull/10480">#10480</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10156">#10156</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow plugins to define custom operations that they use scripts for <ulink url="https://github.com/elastic/elasticsearch/pull/10419">#10419</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10347">#10347</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add String to the default whitelisted receivers <ulink url="https://github.com/elastic/elasticsearch/pull/9837">#9837</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8866">#8866</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>script.groovy.sandbox.method_blacklist_patch</literal> truly append-only <ulink url="https://github.com/elastic/elasticsearch/pull/9473">#9473</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make groovy sandbox method blacklist dynamically additive <ulink url="https://github.com/elastic/elasticsearch/pull/9470">#9470</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add explicit error message when script_score script returns NaN <ulink url="https://github.com/elastic/elasticsearch/pull/8750">#8750</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2426">#2426</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add explainable script again <ulink url="https://github.com/elastic/elasticsearch/pull/8665">#8665</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7245">#7245</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8561">#8561</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use groovy-x.y.z-indy jar for better scripting performance <ulink url="https://github.com/elastic/elasticsearch/pull/8183">#8183</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8182">#8182</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add GroovyCollections to the sandbox whitelist <ulink url="https://github.com/elastic/elasticsearch/pull/7250">#7250</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7088">#7088</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7089">#7089</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make ScoreAccessor utility class publicly available for other script engines <ulink url="https://github.com/elastic/elasticsearch/pull/6898">#6898</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6864">#6864</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove setNextScore in SearchScript. <ulink url="https://github.com/elastic/elasticsearch/pull/6864">#6864</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add a transformer to translate constant BigDecimal to double <ulink url="https://github.com/elastic/elasticsearch/pull/6609">#6609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add Groovy sandboxing for GString-based method invocation <ulink url="https://github.com/elastic/elasticsearch/pull/6596">#6596</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix optional default script loading <ulink url="https://github.com/elastic/elasticsearch/pull/6582">#6582</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Exposed _uid, _id and _type fields as stored fields (_fields notation) <ulink url="https://github.com/elastic/elasticsearch/pull/6406">#6406</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Split SearchModule.configure() into separate methods <ulink url="https://github.com/elastic/elasticsearch/pull/12827">#12827</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only compute scores when necessary with FiltersFunctionScoreQuery. <ulink url="https://github.com/elastic/elasticsearch/pull/12707">#12707</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Speed up the <literal>function_score</literal> query when scores are not needed. <ulink url="https://github.com/elastic/elasticsearch/pull/12693">#12693</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make fetch sub phases pluggable <ulink url="https://github.com/elastic/elasticsearch/pull/12400">#12400</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10729">#10729</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add _replica and _replica_first as search preference. <ulink url="https://github.com/elastic/elasticsearch/pull/12244">#12244</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12222">#12222</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add global search timeout setting <ulink url="https://github.com/elastic/elasticsearch/pull/12211">#12211</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12149">#12149</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Term Query: Be more strict during parsing <ulink url="https://github.com/elastic/elasticsearch/pull/12195">#12195</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12184">#12184</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clean up handling of missing values when merging shard results on the coordinating node. <ulink url="https://github.com/elastic/elasticsearch/pull/12127">#12127</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9155">#9155</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Always return metadata in get/search APIs. <ulink url="https://github.com/elastic/elasticsearch/pull/11816">#11816</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8068">#8068</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Search <literal>preference</literal> based on node specification  <ulink url="https://github.com/elastic/elasticsearch/pull/11464">#11464</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5925">#5925</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not specialize TermQuery vs. TermsQuery. <ulink url="https://github.com/elastic/elasticsearch/pull/11308">#11308</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Minor refactor of MultiValueMode removing apply and reduce <ulink url="https://github.com/elastic/elasticsearch/pull/11290">#11290</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make FilteredQuery a forbidden API. <ulink url="https://github.com/elastic/elasticsearch/pull/11224">#11224</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6511">#6511</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Count api to become a shortcut to the search api <ulink url="https://github.com/elastic/elasticsearch/pull/11198">#11198</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9110">#9110</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9117">#9117</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make SCAN faster. <ulink url="https://github.com/elastic/elasticsearch/pull/11180">#11180</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove (dfs_)query_and_fetch from the REST API <ulink url="https://github.com/elastic/elasticsearch/pull/10864">#10864</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9606">#9606</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cut over to IndexSearcher.count. <ulink url="https://github.com/elastic/elasticsearch/pull/10674">#10674</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Single value numeric queries shouldn&#8217;t be handled by NumericRangeQuery <ulink url="https://github.com/elastic/elasticsearch/pull/10648">#10648</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10646">#10646</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Query scoring change for single-value queries on numeric fields <ulink url="https://github.com/elastic/elasticsearch/pull/10631">#10631</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10628">#10628</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused normsField from MatchAllQuery <ulink url="https://github.com/elastic/elasticsearch/pull/10592">#10592</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Replace deprecated filters with equivalent queries. <ulink url="https://github.com/elastic/elasticsearch/pull/10531">#10531</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8960">#8960</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Avoid calling DocIdSets.toSafeBits. <ulink url="https://github.com/elastic/elasticsearch/pull/9546">#9546</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Merge <literal>search_type=count</literal> and <literal>size=0</literal>. <ulink url="https://github.com/elastic/elasticsearch/pull/9296">#9296</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7630">#7630</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parse terms filters on a single term as a term filter. <ulink url="https://github.com/elastic/elasticsearch/pull/9014">#9014</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Close active search contexts on SearchService#close() <ulink url="https://github.com/elastic/elasticsearch/pull/8947">#8947</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8940">#8940</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Surgically removed slow scroll <ulink url="https://github.com/elastic/elasticsearch/pull/8780">#8780</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Filter cache: add a <literal>_cache: auto</literal> option and make it the default. <ulink url="https://github.com/elastic/elasticsearch/pull/8573">#8573</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8449">#8449</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not force the post-filter to be loaded into a BitSet. <ulink url="https://github.com/elastic/elasticsearch/pull/8488">#8488</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reduce memory usage during fetch source sub phase <ulink url="https://github.com/elastic/elasticsearch/pull/8138">#8138</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t let <literal>took</literal> be negative. <ulink url="https://github.com/elastic/elasticsearch/pull/7968">#7968</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Switch to Lucene QueryRescorer <ulink url="https://github.com/elastic/elasticsearch/pull/7707">#7707</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6232">#6232</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use FixedBitSetFilterCache for delete-by-query <ulink url="https://github.com/elastic/elasticsearch/pull/7581">#7581</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7037">#7037</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Speed up string sort with custom missing value <ulink url="https://github.com/elastic/elasticsearch/pull/7005">#7005</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Wrap filter only once in ApplyAcceptedDocsFilter <ulink url="https://github.com/elastic/elasticsearch/pull/6873">#6873</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove Queries#optimizeQuery - already handled in BooleanQuery <ulink url="https://github.com/elastic/elasticsearch/pull/6743">#6743</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve 404 on missing scroll id <ulink url="https://github.com/elastic/elasticsearch/pull/6063">#6063</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6040">#6040</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return missing (404) if a scroll_id is cleared that no longer exists. <ulink url="https://github.com/elastic/elasticsearch/pull/5865">#5865</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5730">#5730</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Speed up <literal>exists</literal> and <literal>missing</literal> filters on high-cardinality fields [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5659">#5659</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Freq terms enum <ulink url="https://github.com/elastic/elasticsearch/pull/5597">#5597</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Capture and set start time in Delete By Query operations <ulink url="https://github.com/elastic/elasticsearch/pull/5540">#5540</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add dedicated /_search/template endpoint for query templates <ulink url="https://github.com/elastic/elasticsearch/pull/5353">#5353</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add failures reason to delete by query response <ulink url="https://github.com/elastic/elasticsearch/pull/5095">#5095</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5093">#5093</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use patched version of ReferenceManager to prevent infinite loop in ReferenceManager#acquire() <ulink url="https://github.com/elastic/elasticsearch/pull/5043">#5043</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve scroll search by using IndexSearcher#searchAfter(&#8230;) <ulink url="https://github.com/elastic/elasticsearch/pull/4968">#4968</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4940">#4940</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Throw Exception for missing settings file <ulink url="https://github.com/elastic/elasticsearch/pull/12833">#12833</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11510">#11510</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove lenient store type parsing <ulink url="https://github.com/elastic/elasticsearch/pull/12735">#12735</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>path.shared_data</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/12729">#12729</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11065">#11065</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12714">#12714</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add node setting to send SegmentInfos debug output to System.out <ulink url="https://github.com/elastic/elasticsearch/pull/11546">#11546</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
ResourceWatcher: Rename settings to prevent watcher clash <ulink url="https://github.com/elastic/elasticsearch/pull/11359">#11359</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11033">#11033</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11175">#11175</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Die cwd die <ulink url="https://github.com/elastic/elasticsearch/pull/10923">#10923</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10877">#10877</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove <literal>cluster.routing.allocation.balance.primary</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9159">#9159</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>http.publish_port</literal> setting to the HTTP module <ulink url="https://github.com/elastic/elasticsearch/pull/8807">#8807</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8137">#8137</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t accept a dynamic update to <literal>min_master_nodes</literal> which is larger then current master node count <ulink url="https://github.com/elastic/elasticsearch/pull/8321">#8321</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Validates bool values in yaml for node settings <ulink url="https://github.com/elastic/elasticsearch/pull/8186">#8186</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8097">#8097</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Security: Disable CORS by default <ulink url="https://github.com/elastic/elasticsearch/pull/7642">#7642</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7151">#7151</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Store index creation time in index metadata <ulink url="https://github.com/elastic/elasticsearch/pull/7218">#7218</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7119">#7119</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>cluster.routing.allocation.allow_rebalance</literal> a dynamic setting <ulink url="https://github.com/elastic/elasticsearch/pull/7095">#7095</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7092">#7092</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Security: Allow to configure CORS allow-credentials header to work via SSL <ulink url="https://github.com/elastic/elasticsearch/pull/7059">#7059</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6380">#6380</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow <literal>index.merge.scheduler.max_thread_count</literal> to be dynamically changed <ulink url="https://github.com/elastic/elasticsearch/pull/6925">#6925</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6882">#6882</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Security: Support regular expressions for CORS allow-origin to match against <ulink url="https://github.com/elastic/elasticsearch/pull/6923">#6923</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5601">#5601</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6891">#6891</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added three frequency levels for resource watching <ulink url="https://github.com/elastic/elasticsearch/pull/6896">#6896</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added more utility methods to Settings <ulink url="https://github.com/elastic/elasticsearch/pull/6840">#6840</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve Settings#get lookup for camel case support <ulink url="https://github.com/elastic/elasticsearch/pull/6765">#6765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Security: Make JSONP responses optional. <ulink url="https://github.com/elastic/elasticsearch/pull/6164">#6164</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow to change concurrent merge scheduling setting dynamically <ulink url="https://github.com/elastic/elasticsearch/pull/6098">#6098</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Trimmed the main <literal>elasticsearch.yml</literal> configuration file <ulink url="https://github.com/elastic/elasticsearch/pull/5861">#5861</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw error when incorrect setting applied to <literal>auto_expand_replicas</literal> [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5752">#5752</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>getAsRatio</literal> to Settings class, allow DiskThresholdDecider to take percentages <ulink url="https://github.com/elastic/elasticsearch/pull/5690">#5690</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Corrected issue with throttle type setting not respected upon updates <ulink url="https://github.com/elastic/elasticsearch/pull/5392">#5392</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Made possible to dynamically update <literal>discovery.zen.publish_timeout</literal> cluster setting <ulink url="https://github.com/elastic/elasticsearch/pull/5068">#5068</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5063">#5063</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Implement retries for ShadowEngine creation <ulink url="https://github.com/elastic/elasticsearch/pull/10688">#10688</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10637">#10637</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow relocating primary shards on shared filesystems without failing the shard [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/10469">#10469</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow primary promotion on shadow replica without failing the shard <ulink url="https://github.com/elastic/elasticsearch/pull/9786">#9786</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for bulk delete operation in snapshot repository <ulink url="https://github.com/elastic/elasticsearch/pull/12587">#12587</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12533">#12533</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Create a directory during repository verification <ulink url="https://github.com/elastic/elasticsearch/pull/12323">#12323</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11611">#11611</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add validation of snapshot FileInfo during parsing <ulink url="https://github.com/elastic/elasticsearch/pull/12108">#12108</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add checksum to snapshot metadata files <ulink url="https://github.com/elastic/elasticsearch/pull/12002">#12002</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11589">#11589</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Snapshot info should contain version of elasticsearch that created the snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/11985">#11985</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11980">#11980</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Extract all shard-level snapshot operation into dedicated SnapshotShardsService <ulink url="https://github.com/elastic/elasticsearch/pull/11756">#11756</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add snapshot name validation logic to all snapshot operations <ulink url="https://github.com/elastic/elasticsearch/pull/11617">#11617</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change metadata file format <ulink url="https://github.com/elastic/elasticsearch/pull/11507">#11507</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for applying setting filters when displaying repository settings <ulink url="https://github.com/elastic/elasticsearch/pull/11270">#11270</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11265">#11265</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check that reading indices is allowed before creating their snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/11133">#11133</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t throw an exception if repositories are unregistered with <literal>*</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/11113">#11113</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve the error message when attempting to snapshot a closed index <ulink url="https://github.com/elastic/elasticsearch/pull/10608">#10608</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10579">#10579</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
AbstractBlobContainer.deleteByPrefix() should not list all blobs <ulink url="https://github.com/elastic/elasticsearch/pull/10366">#10366</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10344">#10344</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Batching of snapshot state updates <ulink url="https://github.com/elastic/elasticsearch/pull/10295">#10295</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expand wildcards in snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/9903">#9903</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6097">#6097</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor how restore cleans up files after snapshot was restored <ulink url="https://github.com/elastic/elasticsearch/pull/9770">#9770</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add ability to retrieve currently running snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/9400">#9400</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7859">#7859</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8782">#8782</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8887">#8887</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add support for changing index settings during restore process <ulink url="https://github.com/elastic/elasticsearch/pull/9285">#9285</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7887">#7887</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Override write(byte[] b, int off, int len) in FilterOutputStream for better performance <ulink url="https://github.com/elastic/elasticsearch/pull/8749">#8749</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8748">#8748</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow custom metadata to specify whether or not it should be in a snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/7901">#7901</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7900">#7900</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add repository validation <ulink url="https://github.com/elastic/elasticsearch/pull/7680">#7680</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7096">#7096</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Write Snapshots directly to the blobstore stream <ulink url="https://github.com/elastic/elasticsearch/pull/7637">#7637</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
It should be possible to restore an index without restoring its aliases [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6457">#6457</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Snapshot/Restore: Add ability to restore partial snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/6368">#6368</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5742">#5742</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Switch to shared thread pool for all snapshot repositories <ulink url="https://github.com/elastic/elasticsearch/pull/6182">#6182</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6181">#6181</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve speed of running snapshot cancelation <ulink url="https://github.com/elastic/elasticsearch/pull/5244">#5244</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5242">#5242</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add ability to get snapshot status for running snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/5123">#5123</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4946">#4946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add throttling to snaphost and restore operations <ulink url="https://github.com/elastic/elasticsearch/pull/4891">#4891</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4855">#4855</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Refactor, remove _node/network and _node/stats/network.  <ulink url="https://github.com/elastic/elasticsearch/pull/12922">#12922</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12889">#12889</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Expose ClassloadingMXBean in Node Stats <ulink url="https://github.com/elastic/elasticsearch/pull/12764">#12764</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12738">#12738</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Count scans in search stats and add metrics for scrolls <ulink url="https://github.com/elastic/elasticsearch/pull/12069">#12069</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9109">#9109</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Field stats: added index_constraint option <ulink url="https://github.com/elastic/elasticsearch/pull/11259">#11259</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11187">#11187</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add CommitStats to supply information about the current commit point <ulink url="https://github.com/elastic/elasticsearch/pull/10687">#10687</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add throttle stats to index stats and recovery stats <ulink url="https://github.com/elastic/elasticsearch/pull/10097">#10097</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Recovery: add total operations to the <literal>_recovery</literal> API <ulink url="https://github.com/elastic/elasticsearch/pull/10042">#10042</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9368">#9368</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add pending tasks count to cluster health <ulink url="https://github.com/elastic/elasticsearch/pull/9877">#9877</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Hot threads should include timestamp and params <ulink url="https://github.com/elastic/elasticsearch/pull/9773">#9773</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added <literal>verbose</literal> option to segments api, with full ram tree as first additional element per segment <ulink url="https://github.com/elastic/elasticsearch/pull/9111">#9111</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>ignore_idle_threads</literal> (default: true) to hot threads <ulink url="https://github.com/elastic/elasticsearch/pull/8985">#8985</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8908">#8908</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add more fine grained memory stats from Lucene segment reader to index stats <ulink url="https://github.com/elastic/elasticsearch/pull/8832">#8832</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add time in index throttle to index stats. <ulink url="https://github.com/elastic/elasticsearch/pull/7896">#7896</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7861">#7861</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>segments.index_writer_max_memory</literal> to stats <ulink url="https://github.com/elastic/elasticsearch/pull/7440">#7440</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6483">#6483</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7438">#7438</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Track the number of times the CircuitBreaker has been tripped <ulink url="https://github.com/elastic/elasticsearch/pull/6134">#6134</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6130">#6130</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove field names in stats url <ulink url="https://github.com/elastic/elasticsearch/pull/6054">#6054</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5671">#5671</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add suggest stats <ulink url="https://github.com/elastic/elasticsearch/pull/5563">#5563</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4032">#4032</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Disable RAM usage estimation on Lucene 3.x segments. <ulink url="https://github.com/elastic/elasticsearch/pull/5202">#5202</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5201">#5201</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Store
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fall back to reading SegmentInfos from Store if reading from commit fails <ulink url="https://github.com/elastic/elasticsearch/pull/11403">#11403</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11361">#11361</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Consolidate directory lock obtain code <ulink url="https://github.com/elastic/elasticsearch/pull/11390">#11390</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Read segment info from latest commit whenever possible <ulink url="https://github.com/elastic/elasticsearch/pull/11361">#11361</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move to one data.path per shard <ulink url="https://github.com/elastic/elasticsearch/pull/10461">#10461</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9498">#9498</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Schedule pending delete if index store delete fails <ulink url="https://github.com/elastic/elasticsearch/pull/9856">#9856</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve safety when deleting files from the store <ulink url="https://github.com/elastic/elasticsearch/pull/9801">#9801</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add simple cache for StoreStats <ulink url="https://github.com/elastic/elasticsearch/pull/9709">#9709</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9683">#9683</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use Directory#fileLength() less during calculating checksums <ulink url="https://github.com/elastic/elasticsearch/pull/9689">#9689</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cache fileLength for fully written files <ulink url="https://github.com/elastic/elasticsearch/pull/9683">#9683</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Populate metadata.writtenBy for pre 1.3 index files. <ulink url="https://github.com/elastic/elasticsearch/pull/9152">#9152</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Expose ShardId via LeafReader rather than Directory API <ulink url="https://github.com/elastic/elasticsearch/pull/8812">#8812</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Synchronize operations that modify file mappings on DistributorDirectory <ulink url="https://github.com/elastic/elasticsearch/pull/8408">#8408</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Drop pre 0.90 compression BWC <ulink url="https://github.com/elastic/elasticsearch/pull/8385">#8385</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use DistributorDirectory only if there are more than one data direcotry <ulink url="https://github.com/elastic/elasticsearch/pull/8383">#8383</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cut over MetaDataStateFormat to NIO Path API <ulink url="https://github.com/elastic/elasticsearch/pull/8297">#8297</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove special file handling from DistributorDirectory <ulink url="https://github.com/elastic/elasticsearch/pull/8276">#8276</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Try to increment store before searcher is acquired <ulink url="https://github.com/elastic/elasticsearch/pull/7792">#7792</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fold two hashFile implemenation into one <ulink url="https://github.com/elastic/elasticsearch/pull/7720">#7720</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Before deleting shard verify that another node holds an active shard instance <ulink url="https://github.com/elastic/elasticsearch/pull/6692">#6692</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make a hybrid directory default using <literal>mmapfs</literal> / <literal>niofs</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/6636">#6636</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Suggesters
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove filter from PhraseSuggester collate <ulink url="https://github.com/elastic/elasticsearch/pull/11195">#11195</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Phrase Suggester Collate Enhancements <ulink url="https://github.com/elastic/elasticsearch/pull/10710">#10710</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9377">#9377</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Collate option in PhraseSuggester should allow returning phrases with no matching docs <ulink url="https://github.com/elastic/elasticsearch/pull/6929">#6929</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6927">#6927</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Speed up phrase suggestion scoring <ulink url="https://github.com/elastic/elasticsearch/pull/5396">#5396</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5395">#5395</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Term Vectors
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only load term statistics if required <ulink url="https://github.com/elastic/elasticsearch/pull/11737">#11737</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Requests are now timed <ulink url="https://github.com/elastic/elasticsearch/pull/9583">#9583</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for shard level caching of term vectors <ulink url="https://github.com/elastic/elasticsearch/pull/8395">#8395</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for distributed frequencies <ulink url="https://github.com/elastic/elasticsearch/pull/8144">#8144</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for realtime term vectors <ulink url="https://github.com/elastic/elasticsearch/pull/7846">#7846</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for custom analyzers in term vectors and MLT query <ulink url="https://github.com/elastic/elasticsearch/pull/7801">#7801</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for artificial documents <ulink url="https://github.com/elastic/elasticsearch/pull/7530">#7530</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support for version and version_type <ulink url="https://github.com/elastic/elasticsearch/pull/7480">#7480</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Return found: false for docs requested between index and refresh <ulink url="https://github.com/elastic/elasticsearch/pull/7124">#7124</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7121">#7121</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds support for wildcards in selected fields <ulink url="https://github.com/elastic/elasticsearch/pull/7061">#7061</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Compute term vectors on the fly if not stored in index <ulink url="https://github.com/elastic/elasticsearch/pull/6567">#6567</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5184">#5184</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Top Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
In top_hits agg, when parent doc is found stop iterating over segments and continue with the next top matching child doc <ulink url="https://github.com/elastic/elasticsearch/pull/6895">#6895</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1843">#1843</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added pagination support to <literal>top_hits</literal> aggregation by adding <literal>from</literal> option <ulink url="https://github.com/elastic/elasticsearch/pull/6312">#6312</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6299">#6299</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make translog file name parsing strict <ulink url="https://github.com/elastic/elasticsearch/pull/11875">#11875</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Some smallish translog cleanups <ulink url="https://github.com/elastic/elasticsearch/pull/11200">#11200</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add translog checkpoints to prevent translog corruption <ulink url="https://github.com/elastic/elasticsearch/pull/11143">#11143</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10933">#10933</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11011">#11011</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make modifying operations durable by default. <ulink url="https://github.com/elastic/elasticsearch/pull/11011">#11011</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10933">#10933</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use buffered translog type also when sync is set to 0 <ulink url="https://github.com/elastic/elasticsearch/pull/10993">#10993</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove useless random translog directory selection <ulink url="https://github.com/elastic/elasticsearch/pull/10589">#10589</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Handle truncated translog gracefully <ulink url="https://github.com/elastic/elasticsearch/pull/9797">#9797</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9699">#9699</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t rename recovery translog in gateway <ulink url="https://github.com/elastic/elasticsearch/pull/9719">#9719</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cut over to Path API <ulink url="https://github.com/elastic/elasticsearch/pull/8611">#8611</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor the Translog.read(Location) method <ulink url="https://github.com/elastic/elasticsearch/pull/7780">#7780</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Write translog opSize twice <ulink url="https://github.com/elastic/elasticsearch/pull/7735">#7735</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused stream <ulink url="https://github.com/elastic/elasticsearch/pull/7683">#7683</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Clean up translog interface <ulink url="https://github.com/elastic/elasticsearch/pull/7564">#7564</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add translog checksums <ulink url="https://github.com/elastic/elasticsearch/pull/7232">#7232</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6554">#6554</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Set default translog <literal>flush_threshold_ops</literal> to unlimited, to flush by byte size by default and not penalize tiny documents <ulink url="https://github.com/elastic/elasticsearch/pull/6783">#6783</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6443">#6443</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use unlimited <literal>flush_threshold_ops</literal> for translog (again) [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6726">#6726</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Raise proper failure if not fully reading translog entry <ulink url="https://github.com/elastic/elasticsearch/pull/6562">#6562</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use unlimited <literal>flush_threshold_ops</literal> for translog <ulink url="https://github.com/elastic/elasticsearch/pull/5900">#5900</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix visibility in buffered translog <ulink url="https://github.com/elastic/elasticsearch/pull/5609">#5609</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use BytesReference to write to translog files <ulink url="https://github.com/elastic/elasticsearch/pull/5463">#5463</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t throttle the translog stage of recovery [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4890">#4890</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Index level blocks, index conflict settings <ulink url="https://github.com/elastic/elasticsearch/pull/5501">#5501</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Upgrade API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Refactor upgrade API to use transport and write minimum compatible version that the index was upgraded to <ulink url="https://github.com/elastic/elasticsearch/pull/11333">#11333</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11072">#11072</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11095">#11095</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add upgrade_only_ancient_segments option to upgrade API <ulink url="https://github.com/elastic/elasticsearch/pull/10540">#10540</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10213">#10213</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove ability to run optimize and upgrade async <ulink url="https://github.com/elastic/elasticsearch/pull/9640">#9640</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9638">#9638</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="bug-2.0.0-beta1" renderas="sect2">Bug fixes<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Aggregations
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Aggregation: Fix AggregationPath.subPath() to not throw ArrayStoreException <ulink url="https://github.com/elastic/elasticsearch/pull/13035">#13035</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw error if cardinality aggregator has sub aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/12989">#12989</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12988">#12988</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Full path validation for pipeline aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/12595">#12595</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12360">#12360</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade HDRHistogram to version 2.1.6. <ulink url="https://github.com/elastic/elasticsearch/pull/12554">#12554</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixes serialization of HDRHistogram in percentiles aggregations <ulink url="https://github.com/elastic/elasticsearch/pull/12505">#12505</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix cidr mask conversion issue for 0.0.0.0/0 and add tests #12005 <ulink url="https://github.com/elastic/elasticsearch/pull/12430">#12430</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12005">#12005</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Adds new script API to ValuesSourceMetricsAggregationBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/12152">#12152</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations: Makes SKIP Gap Policy work correctly for Bucket Script aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/11970">#11970</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>moving_avg</literal> forecasts should not include current point <ulink url="https://github.com/elastic/elasticsearch/pull/11641">#11641</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow aggregations_binary to build and parse <ulink url="https://github.com/elastic/elasticsearch/pull/11473">#11473</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11457">#11457</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix bug where moving_avg prediction keys are appended to previous prediction <ulink url="https://github.com/elastic/elasticsearch/pull/11465">#11465</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11454">#11454</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sibling Pipeline Aggregations can now be nested in SingleBucketAggregations <ulink url="https://github.com/elastic/elasticsearch/pull/11380">#11380</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11379">#11379</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed Moving Average prediction to calculate the correct keys <ulink url="https://github.com/elastic/elasticsearch/pull/11375">#11375</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11369">#11369</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Queries with <literal>size:0</literal> break aggregations that need scores <ulink url="https://github.com/elastic/elasticsearch/pull/11358">#11358</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11119">#11119</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix geo bounds aggregation when longitude is 0 <ulink url="https://github.com/elastic/elasticsearch/pull/11090">#11090</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11085">#11085</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes Infinite values return from geo_bounds with non-zero bucket-ordinals <ulink url="https://github.com/elastic/elasticsearch/pull/10917">#10917</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10804">#10804</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sampler agg could not be used with Terms agg’s order. <ulink url="https://github.com/elastic/elasticsearch/pull/10785">#10785</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10719">#10719</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>_as_string</literal> output to only show when format specified <ulink url="https://github.com/elastic/elasticsearch/pull/10571">#10571</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10284">#10284</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix multi-level breadth-first aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/10411">#10411</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9544">#9544</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9823">#9823</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Be lenient when converting local to utc time in time zone roundings <ulink url="https://github.com/elastic/elasticsearch/pull/10031">#10031</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10025">#10025</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent negative intervals in date_histogram <ulink url="https://github.com/elastic/elasticsearch/pull/9690">#9690</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9634">#9634</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make the nested aggregation call sub aggregators with doc IDs in order <ulink url="https://github.com/elastic/elasticsearch/pull/9548">#9548</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9547">#9547</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove limitation on field access within aggs to the types provided in the search <ulink url="https://github.com/elastic/elasticsearch/pull/9487">#9487</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Validate the aggregation order on unmapped terms in terms agg. <ulink url="https://github.com/elastic/elasticsearch/pull/8952">#8952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8946">#8946</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix date_histogram issues during a timezone DST switch <ulink url="https://github.com/elastic/elasticsearch/pull/8655">#8655</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8339">#8339</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix geohash grid doc counts computation on multi-valued fields <ulink url="https://github.com/elastic/elasticsearch/pull/8574">#8574</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8512">#8512</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parser throws NullPointerException when Filter aggregation clause is empty <ulink url="https://github.com/elastic/elasticsearch/pull/8527">#8527</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8438">#8438</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes scripted metrics aggregation when used as a sub aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/8037">#8037</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8036">#8036</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Makes script params consistent with other APIs in scripted_metric <ulink url="https://github.com/elastic/elasticsearch/pull/7969">#7969</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Significant terms can throw error on index with deleted docs. <ulink url="https://github.com/elastic/elasticsearch/pull/7960">#7960</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7951">#7951</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes resize bug in Geo bounds Aggregator <ulink url="https://github.com/elastic/elasticsearch/pull/7565">#7565</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7556">#7556</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The nested aggregator should iterate over the child doc ids in ascending order. <ulink url="https://github.com/elastic/elasticsearch/pull/7514">#7514</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7505">#7505</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes pre and post offset serialisation for histogram aggs <ulink url="https://github.com/elastic/elasticsearch/pull/7313">#7313</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7312">#7312</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>key_as_string</literal> only shown when format specified in terms agg <ulink url="https://github.com/elastic/elasticsearch/pull/7160">#7160</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7125">#7125</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed value count so it can be used in terms order <ulink url="https://github.com/elastic/elasticsearch/pull/7051">#7051</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7050">#7050</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix infinite loop in the histogram reduce logic. <ulink url="https://github.com/elastic/elasticsearch/pull/7022">#7022</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6965">#6965</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
More lenient type parsing in histo/cardinality aggs <ulink url="https://github.com/elastic/elasticsearch/pull/6948">#6948</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6893">#6893</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed Histogram key_as_string bug <ulink url="https://github.com/elastic/elasticsearch/pull/6830">#6830</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6655">#6655</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix JSON response for significant terms <ulink url="https://github.com/elastic/elasticsearch/pull/6535">#6535</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix reducing of range aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/6484">#6484</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6435">#6435</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix cardinality aggregation when doc values field is empty <ulink url="https://github.com/elastic/elasticsearch/pull/6413">#6413</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed conversion of date field values when using multiple date formats <ulink url="https://github.com/elastic/elasticsearch/pull/6266">#6266</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6239">#6239</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail queries that have two aggregations with the same name. <ulink url="https://github.com/elastic/elasticsearch/pull/6258">#6258</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6255">#6255</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Aggregations parsing is too lenient. <ulink url="https://github.com/elastic/elasticsearch/pull/5837">#5837</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5827">#5827</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix DateHistogramBuilder to use a String pre_offset and post_offset <ulink url="https://github.com/elastic/elasticsearch/pull/5587">#5587</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5586">#5586</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
DateHistogram.Bucket should return the date key in UTC [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5477">#5477</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix cardinality memory-usage considerations. <ulink url="https://github.com/elastic/elasticsearch/pull/5452">#5452</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow scripts to return more than 4 values in aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/5416">#5416</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5414">#5414</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Invoke postCollection on aggregation collectors <ulink url="https://github.com/elastic/elasticsearch/pull/5387">#5387</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed a bug in date_histogram aggregation parsing <ulink url="https://github.com/elastic/elasticsearch/pull/5379">#5379</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5375">#5375</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE/AIOOBE when building a bucket which has not been collected. <ulink url="https://github.com/elastic/elasticsearch/pull/5250">#5250</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5048">#5048</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Changing the sorting for terms aggs, <ulink url="https://github.com/elastic/elasticsearch/pull/5237">#5237</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5236">#5236</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Changed the caching of FieldDataSource in aggs to be based on field name&#8230; <ulink url="https://github.com/elastic/elasticsearch/pull/5205">#5205</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5190">#5190</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
date_histogram against empty index results in ArrayIndexOutOfBoundsException [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5179">#5179</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix BytesRef owning issue in string terms aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/5039">#5039</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5021">#5021</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix hashCode values of aggregations' BytesValues. <ulink url="https://github.com/elastic/elasticsearch/pull/5006">#5006</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5004">#5004</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sorting terms agg by sub-aggegation doesn&#8217;t respect asc/desc when executing on a single shard [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4951">#4951</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed an issue where there are sub aggregations executing on a single shard <ulink url="https://github.com/elastic/elasticsearch/pull/4869">#4869</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4843">#4843</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Aliases
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Take into account <literal>_default_ mapping</literal> in index template when parsing alias filter in index templates. <ulink url="https://github.com/elastic/elasticsearch/pull/8577">#8577</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8473">#8473</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
PUT /_aliases should accept a numeric routing value <ulink url="https://github.com/elastic/elasticsearch/pull/5471">#5471</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5465">#5465</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Allocation
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix messaging about delayed allocation <ulink url="https://github.com/elastic/elasticsearch/pull/12515">#12515</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12456">#12456</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ThrottlingAllocationDecider should not counting relocating shards <ulink url="https://github.com/elastic/elasticsearch/pull/12409">#12409</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Shard Started messages should be matched using an exact match <ulink url="https://github.com/elastic/elasticsearch/pull/11999">#11999</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reroute after node join is processed <ulink url="https://github.com/elastic/elasticsearch/pull/11960">#11960</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11776">#11776</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/11923">#11923</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
GatewayAllocator: reset rerouting flag after error <ulink url="https://github.com/elastic/elasticsearch/pull/11519">#11519</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11421">#11421</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Weight deltas must be absolute deltas <ulink url="https://github.com/elastic/elasticsearch/pull/9149">#9149</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9023">#9023</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix handling of <literal>dangling_timeout</literal> set to 0 and <literal>auto_import_dangled</literal> true <ulink url="https://github.com/elastic/elasticsearch/pull/8257">#8257</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enable ClusterInfoService by default <ulink url="https://github.com/elastic/elasticsearch/pull/8206">#8206</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve handling of failed primary replica handling <ulink url="https://github.com/elastic/elasticsearch/pull/6816">#6816</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6808">#6808</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not ignore ConnectTransportException for shard replication operations <ulink url="https://github.com/elastic/elasticsearch/pull/6813">#6813</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Failed shards could be re-assigned to the same nodes if multiple replicas failed at once <ulink url="https://github.com/elastic/elasticsearch/pull/5725">#5725</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
BalancedShardAllocator makes non-deterministic rebalance decisions [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4867">#4867</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Analysis
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Custom analyzer names and aliases must not start with _ <ulink url="https://github.com/elastic/elasticsearch/pull/11303">#11303</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9596">#9596</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix tokenizer settings in SynonymTokenFilterFactory <ulink url="https://github.com/elastic/elasticsearch/pull/10489">#10489</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
CharArraySet doesn&#8217;t know how to lookup the original string in an ImmutableList. <ulink url="https://github.com/elastic/elasticsearch/pull/6238">#6238</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6237">#6237</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Analyze API: Default analyzer accidentally removed stopwords <ulink url="https://github.com/elastic/elasticsearch/pull/6043">#6043</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5974">#5974</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Bulk
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix: Use correct OpType on Failure in BulkItemResponse <ulink url="https://github.com/elastic/elasticsearch/pull/12060">#12060</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9821">#9821</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow null values in the bulk action/metadata line parameters <ulink url="https://github.com/elastic/elasticsearch/pull/11459">#11459</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11458">#11458</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw exception if unrecognized parameter in bulk action/metadata line <ulink url="https://github.com/elastic/elasticsearch/pull/11331">#11331</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10977">#10977</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>_default_</literal> mapping should be picked up from index template during auto create index from bulk API  <ulink url="https://github.com/elastic/elasticsearch/pull/10762">#10762</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10609">#10609</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Removed duplicate timeout param <ulink url="https://github.com/elastic/elasticsearch/pull/10205">#10205</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Handle failed request when auto create index is disabled <ulink url="https://github.com/elastic/elasticsearch/pull/8163">#8163</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8125">#8125</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Bulk operation can create duplicates on primary relocation <ulink url="https://github.com/elastic/elasticsearch/pull/7729">#7729</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cluster block with auto create index bulk action can cause bulk execution to not return <ulink url="https://github.com/elastic/elasticsearch/pull/7109">#7109</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7086">#7086</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not fail whole request on closed index <ulink url="https://github.com/elastic/elasticsearch/pull/6790">#6790</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6410">#6410</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix return of wrong request type on failed updates <ulink url="https://github.com/elastic/elasticsearch/pull/6646">#6646</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6630">#6630</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Bulk request which try and fail to create multiple indices may never return <ulink url="https://github.com/elastic/elasticsearch/pull/6436">#6436</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix mapping creation on bulk request <ulink url="https://github.com/elastic/elasticsearch/pull/5623">#5623</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure that index specific failures do not affect whole request <ulink url="https://github.com/elastic/elasticsearch/pull/4995">#4995</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4987">#4987</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Failed preparsing does not fail whole bulk request <ulink url="https://github.com/elastic/elasticsearch/pull/4781">#4781</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4745">#4745</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CAT API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
_cat/nodes: Thread null handling through stats and info <ulink url="https://github.com/elastic/elasticsearch/pull/9938">#9938</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6297">#6297</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NullPointerException in cat-recovery API <ulink url="https://github.com/elastic/elasticsearch/pull/6190">#6190</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
_cat/allocation returns -1 as disk.total for clients nodes [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5948">#5948</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
ElasticsearchIllegalStateException when invoking _cat plugins [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5715">#5715</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Node version sometimes empty in _cat/nodes [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5480">#5480</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
<literal>detect_noop</literal> now understands <literal>null</literal> as a valid value <ulink url="https://github.com/elastic/elasticsearch/pull/11210">#11210</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11208">#11208</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The parent option on update request should be used for upsert only. <ulink url="https://github.com/elastic/elasticsearch/pull/9612">#9612</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4538">#4538</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t throw DAEE on replica for create operation; use IW.updateDocument/s instead <ulink url="https://github.com/elastic/elasticsearch/pull/7146">#7146</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7142">#7142</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
MultiGet: Fail when using no routing on an alias to an index that requires routing <ulink url="https://github.com/elastic/elasticsearch/pull/7145">#7145</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add parameter to GET API for checking if generated fields can be retrieved <ulink url="https://github.com/elastic/elasticsearch/pull/6973">#6973</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6676">#6676</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
DocumentMissingException is also thrown on update retries <ulink url="https://github.com/elastic/elasticsearch/pull/6724">#6724</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6355">#6355</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cache
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Store filter cache statistics at the shard level instead of index. <ulink url="https://github.com/elastic/elasticsearch/pull/11886">#11886</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t use bitset cache for children filters. <ulink url="https://github.com/elastic/elasticsearch/pull/10663">#10663</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10629">#10629</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10662">#10662</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove query-cache serialization optimization. <ulink url="https://github.com/elastic/elasticsearch/pull/9500">#9500</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9294">#9294</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Queries are never cached when date math expressions are used (including exact dates) <ulink url="https://github.com/elastic/elasticsearch/pull/9269">#9269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9225">#9225</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change default eager loading behaviour for nested fields and parent/child in bitset cache <ulink url="https://github.com/elastic/elasticsearch/pull/8440">#8440</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t eagerly load NestedDocsFilter in bitset filter cache, because it is never used. <ulink url="https://github.com/elastic/elasticsearch/pull/8414">#8414</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8394">#8394</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed bitset filter cache leftover in nested filter  <ulink url="https://github.com/elastic/elasticsearch/pull/8303">#8303</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleanup non nested filter to not flip the FixedBitSet returned by the wrapped filter. <ulink url="https://github.com/elastic/elasticsearch/pull/8232">#8232</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8227">#8227</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move the child filter over to the fixed bitset cache. <ulink url="https://github.com/elastic/elasticsearch/pull/8171">#8171</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Circuit Breakers
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make "noop" request breaker a non-dynamic setting <ulink url="https://github.com/elastic/elasticsearch/pull/8179">#8179</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only set <literal>breaker</literal> when stats are retrieved <ulink url="https://github.com/elastic/elasticsearch/pull/7721">#7721</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable circuit breaking for BigArrays <ulink url="https://github.com/elastic/elasticsearch/pull/6381">#6381</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6332">#6332</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Percolator doesn&#8217;t reduce CircuitBreaker stats in every case. <ulink url="https://github.com/elastic/elasticsearch/pull/5588">#5588</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible discrepancy in circuit breaker in parent/child <ulink url="https://github.com/elastic/elasticsearch/pull/5526">#5526</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix issue where circuit breaker was always reset to 80% upon startup <ulink url="https://github.com/elastic/elasticsearch/pull/5334">#5334</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NullPointerException in RamAccounntingTermsEnum [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5326">#5326</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Cluster
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Changes in unassigned info and version might not be transferred as part of cluster state diffs <ulink url="https://github.com/elastic/elasticsearch/pull/12387">#12387</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rename cluster state uuid to updateId <ulink url="https://github.com/elastic/elasticsearch/pull/11862">#11862</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11831">#11831</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ClusterHealth shouldn&#8217;t fail with "unexpected failure" if master steps down while waiting for events <ulink url="https://github.com/elastic/elasticsearch/pull/11493">#11493</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Write state also on data nodes if not master eligible <ulink url="https://github.com/elastic/elasticsearch/pull/9952">#9952</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8823">#8823</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
GatewayService should register cluster state listener before checking for current state <ulink url="https://github.com/elastic/elasticsearch/pull/8789">#8789</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Extend refresh-mapping logic to the <literal>_default_</literal> type <ulink url="https://github.com/elastic/elasticsearch/pull/8413">#8413</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4760">#4760</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ClusterHealthAPI does not respect waitForEvents when local flag is set <ulink url="https://github.com/elastic/elasticsearch/pull/7731">#7731</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use node&#8217;s cluster name as a default for an incoming cluster state who misses it <ulink url="https://github.com/elastic/elasticsearch/pull/7414">#7414</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7386">#7386</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use the provided cluster state instead of fetching a new cluster state from cluster service. <ulink url="https://github.com/elastic/elasticsearch/pull/7013">#7013</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
During recovery, only send mapping updates to master if needed <ulink url="https://github.com/elastic/elasticsearch/pull/6772">#6772</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6762">#6762</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Check for index blocks against concrete indices on master operations [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6694">#6694</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Also send Refresh and Flush actions to relocation targets <ulink url="https://github.com/elastic/elasticsearch/pull/6545">#6545</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not execute cluster state changes if current node is no longer master <ulink url="https://github.com/elastic/elasticsearch/pull/6230">#6230</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add cluster name to state <ulink url="https://github.com/elastic/elasticsearch/pull/5624">#5624</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5622">#5622</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
TransportMasterNodeOperationAction: tighter check for postAdded cluster state change <ulink url="https://github.com/elastic/elasticsearch/pull/5548">#5548</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5499">#5499</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove Settings.getAsClass <ulink url="https://github.com/elastic/elasticsearch/pull/12744">#12744</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12643">#12643</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12656">#12656</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ThreadPools: schedule a timeout check after adding command to queue <ulink url="https://github.com/elastic/elasticsearch/pull/12319">#12319</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw LockObtainFailedException exception when we can&#8217;t lock index directory <ulink url="https://github.com/elastic/elasticsearch/pull/12203">#12203</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Only clear open search ctx if the index is delete or closed via API <ulink url="https://github.com/elastic/elasticsearch/pull/12199">#12199</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12116">#12116</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Close lock even if we fail to obtain <ulink url="https://github.com/elastic/elasticsearch/pull/11412">#11412</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Balance new shard allocations more evenly on multiple path.data <ulink url="https://github.com/elastic/elasticsearch/pull/11185">#11185</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11122">#11122</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use System.nanoTime for elapsed time <ulink url="https://github.com/elastic/elasticsearch/pull/11058">#11058</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Increase default rate limiting for snapshot, restore and recovery to 40 MB/sec <ulink url="https://github.com/elastic/elasticsearch/pull/10185">#10185</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6018">#6018</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Also throttle delete by query when merges fall behind <ulink url="https://github.com/elastic/elasticsearch/pull/9986">#9986</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Promptly cleanup updateTask timeout handler <ulink url="https://github.com/elastic/elasticsearch/pull/9621">#9621</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable auto gen id optimization <ulink url="https://github.com/elastic/elasticsearch/pull/9468">#9468</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8788">#8788</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Verify the index state of concrete indices after alias resolution <ulink url="https://github.com/elastic/elasticsearch/pull/9057">#9057</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>ignore_unavailable</literal> shouldn&#8217;t ignore closed indices <ulink url="https://github.com/elastic/elasticsearch/pull/9047">#9047</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7153">#7153</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Hard wire utf-8 encoding, so unicode filenames work <ulink url="https://github.com/elastic/elasticsearch/pull/8847">#8847</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unnecessary index removal on index creation <ulink url="https://github.com/elastic/elasticsearch/pull/8639">#8639</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove _state directory if index has been deleted <ulink url="https://github.com/elastic/elasticsearch/pull/8610">#8610</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Disable bloom filters <ulink url="https://github.com/elastic/elasticsearch/pull/8572">#8572</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8564">#8564</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8571">#8571</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return 0 instead of -1 for unknown/non-exposed ramBytesUsed() <ulink url="https://github.com/elastic/elasticsearch/pull/8291">#8291</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8239">#8239</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t catch FNF/NSF exception when reading metadata <ulink url="https://github.com/elastic/elasticsearch/pull/8207">#8207</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t handle FNF exceptions when reading snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/8086">#8086</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Jackson Smile 2.4.1.1 <ulink url="https://github.com/elastic/elasticsearch/pull/7327">#7327</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/18">#18</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Force refresh when versionMap is using too much RAM <ulink url="https://github.com/elastic/elasticsearch/pull/6443">#6443</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6378">#6378</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use XNativeFSLockFactory instead of the buggy Lucene 4.8.1 version [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6424">#6424</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restore shard routing. <ulink url="https://github.com/elastic/elasticsearch/pull/6393">#6393</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5562">#5562</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6391">#6391</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t report terms as live if all it&#8217;s docs are filtered out <ulink url="https://github.com/elastic/elasticsearch/pull/6221">#6221</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6211">#6211</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ensure pending merges are updated on segment flushes <ulink url="https://github.com/elastic/elasticsearch/pull/5780">#5780</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5779">#5779</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add millisecond parser for dynamic date fields mapped from "yyyy/MM/dd" <ulink url="https://github.com/elastic/elasticsearch/pull/12977">#12977</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12873">#12873</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Query string time zone not working <ulink url="https://github.com/elastic/elasticsearch/pull/10883">#10883</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10477">#10477</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
DateMath: Use time zone when rounding.  <ulink url="https://github.com/elastic/elasticsearch/pull/9885">#9885</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9814">#9814</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Resolve <literal>now</literal> in date ranges in percolator and alias filters at search time instead of parse time <ulink url="https://github.com/elastic/elasticsearch/pull/8534">#8534</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8474">#8474</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Discovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make sure NodeJoinController.ElectionCallback is always called from the update cluster state thread <ulink url="https://github.com/elastic/elasticsearch/pull/12372">#12372</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
ZenDiscovery: #11960 failed to remove eager reroute from node join <ulink url="https://github.com/elastic/elasticsearch/pull/12019">#12019</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Node receiving a cluster state with a wrong master node should reject and throw an error <ulink url="https://github.com/elastic/elasticsearch/pull/9963">#9963</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check index uuid when merging incoming cluster state into the local one <ulink url="https://github.com/elastic/elasticsearch/pull/9541">#9541</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9489">#9489</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only retry join when other node is not (yet) a master <ulink url="https://github.com/elastic/elasticsearch/pull/8972">#8972</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removed unnecessary DiscoveryService reference from LocalDiscovery <ulink url="https://github.com/elastic/elasticsearch/pull/8415">#8415</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8539">#8539</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve the lifecycle management of the join control thread in zen discovery. <ulink url="https://github.com/elastic/elasticsearch/pull/8327">#8327</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
UnicastZenPing - use temporary node ids if can&#8217;t resolve node by it&#8217;s address <ulink url="https://github.com/elastic/elasticsearch/pull/7719">#7719</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Transport client: Don&#8217;t add listed nodes to connected nodes list in sniff mode <ulink url="https://github.com/elastic/elasticsearch/pull/7067">#7067</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6811">#6811</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6829">#6829</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6894">#6894</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Handle ConnectionTransportException during a Master/Node fault detection ping during Discovery <ulink url="https://github.com/elastic/elasticsearch/pull/6686">#6686</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Engine
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix NPE when streaming commit stats <ulink url="https://github.com/elastic/elasticsearch/pull/11266">#11266</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Sync translog before closing engine <ulink url="https://github.com/elastic/elasticsearch/pull/10484">#10484</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixes InternalIndexShard callback handling of failure <ulink url="https://github.com/elastic/elasticsearch/pull/8644">#8644</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5945">#5945</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add current translog ID to commit meta before closing <ulink url="https://github.com/elastic/elasticsearch/pull/8245">#8245</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>index.fail_on_corruption</literal> setting is not updateable <ulink url="https://github.com/elastic/elasticsearch/pull/6941">#6941</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Closing an IndexReader on an already relocated / closed shard can cause memory leaks [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5825">#5825</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Exceptions
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use StartupError to format all exceptions hitting the console <ulink url="https://github.com/elastic/elasticsearch/pull/13041">#13041</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13040">#13040</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve console logging on startup exception <ulink url="https://github.com/elastic/elasticsearch/pull/12976">#12976</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t special-case on ElasticsearchWrapperException in toXContent <ulink url="https://github.com/elastic/elasticsearch/pull/12015">#12015</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11994">#11994</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Implement toXContent on ShardOpertionFailureException <ulink url="https://github.com/elastic/elasticsearch/pull/11155">#11155</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11017">#11017</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove double exception handling that causes false replica failures <ulink url="https://github.com/elastic/elasticsearch/pull/10990">#10990</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixing copy/paste mistake in SearchRequest.extraSource&#8217;s exception message <ulink url="https://github.com/elastic/elasticsearch/pull/8118">#8118</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8117">#8117</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Turn unexpected exceptions when reading segments into CorruptedIndexException <ulink url="https://github.com/elastic/elasticsearch/pull/7693">#7693</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Throw better error if invalid scroll id is used <ulink url="https://github.com/elastic/elasticsearch/pull/5738">#5738</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5730">#5730</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Fielddata
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Reclaim memory from fielddata synchronously when an explicit clear is performed. <ulink url="https://github.com/elastic/elasticsearch/pull/11697">#11697</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11695">#11695</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Load fielddata on behalf of scripts. <ulink url="https://github.com/elastic/elasticsearch/pull/10997">#10997</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix iterator over global ordinals. <ulink url="https://github.com/elastic/elasticsearch/pull/8627">#8627</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8580">#8580</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix FieldDataWeighter generics to accept RamUsage instead of AtomicFieldData <ulink url="https://github.com/elastic/elasticsearch/pull/6262">#6262</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6260">#6260</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Eager fielddata loading not working <ulink url="https://github.com/elastic/elasticsearch/pull/5557">#5557</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Correct ShapeBuilder coordinate parser to ignore values in 3rd+ dimension <ulink url="https://github.com/elastic/elasticsearch/pull/10539">#10539</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10510">#10510</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix hole intersection at tangential coordinate <ulink url="https://github.com/elastic/elasticsearch/pull/10332">#10332</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9511">#9511</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix validate_* merge policy for GeoPointFieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/10165">#10165</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10164">#10164</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Correct bounding box logic for GeometryCollection type <ulink url="https://github.com/elastic/elasticsearch/pull/9550">#9550</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9360">#9360</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw helpful exception for Polygons with holes outside of shell <ulink url="https://github.com/elastic/elasticsearch/pull/9105">#9105</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9071">#9071</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
GIS envelope validation <ulink url="https://github.com/elastic/elasticsearch/pull/9091">#9091</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/2544">#2544</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8672">#8672</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9067">#9067</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9079">#9079</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9080">#9080</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix for NPE enclosed in SearchParseException for a "geo_shape" filter or query <ulink url="https://github.com/elastic/elasticsearch/pull/8785">#8785</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8432">#8432</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix for geohash neighbors when geohash length is even. <ulink url="https://github.com/elastic/elasticsearch/pull/8529">#8529</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8526">#8526</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix geohash grid aggregation on multi-valued fields. <ulink url="https://github.com/elastic/elasticsearch/pull/8513">#8513</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8507">#8507</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix for ArithmeticException[/ by zero] when parsing a polygon <ulink url="https://github.com/elastic/elasticsearch/pull/8475">#8475</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8433">#8433</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove unnecessary code from geo distance builder <ulink url="https://github.com/elastic/elasticsearch/pull/8338">#8338</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix IndexedGeoBoundingBoxFilter to not modify the bits of other filters. <ulink url="https://github.com/elastic/elasticsearch/pull/8325">#8325</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix circle radius calculation <ulink url="https://github.com/elastic/elasticsearch/pull/7338">#7338</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7301">#7301</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improved error handling in geo_distance <ulink url="https://github.com/elastic/elasticsearch/pull/7272">#7272</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7260">#7260</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes computation of geohash neighbours <ulink url="https://github.com/elastic/elasticsearch/pull/7247">#7247</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7226">#7226</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Better error for invalid multipolygon <ulink url="https://github.com/elastic/elasticsearch/pull/7190">#7190</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7126">#7126</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix geo_shapes which intersect dateline <ulink url="https://github.com/elastic/elasticsearch/pull/7188">#7188</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7016">#7016</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes parse error with complex shapes <ulink url="https://github.com/elastic/elasticsearch/pull/6976">#6976</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5773">#5773</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Issue with polygons near date line <ulink url="https://github.com/elastic/elasticsearch/pull/6282">#6282</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6179">#6179</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>optimize_bbox</literal> for geo_distance filters can cause missing results [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6008">#6008</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add exceptions to GeoPointFieldMapper <ulink url="https://github.com/elastic/elasticsearch/pull/5403">#5403</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5390">#5390</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Highlighting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Plain highlighter to use analyzer defined on a document level  <ulink url="https://github.com/elastic/elasticsearch/pull/6267">#6267</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5497">#5497</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Implement BlendedTermQuery#extractTerms to support highlighing. <ulink url="https://github.com/elastic/elasticsearch/pull/5247">#5247</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5246">#5246</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Made SearchContextHighlight.Field class immutable to prevent from unwanted updates <ulink url="https://github.com/elastic/elasticsearch/pull/5223">#5223</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5175">#5175</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Highlighting on a wildcard field name causes the wildcard expression to be returned rather than the actual field name [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5221">#5221</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed multi term queries support in postings highlighter for non top-level queries <ulink url="https://github.com/elastic/elasticsearch/pull/5143">#5143</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4052">#4052</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5127">#5127</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Index APIs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Remove expansion of empty index arguments in RoutingTable <ulink url="https://github.com/elastic/elasticsearch/pull/10148">#10148</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9081">#9081</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix to make GET Index API consistent with docs <ulink url="https://github.com/elastic/elasticsearch/pull/9178">#9178</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9148">#9148</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upsert does not use ttl value <ulink url="https://github.com/elastic/elasticsearch/pull/8715">#8715</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3256">#3256</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix GET index API always running all features <ulink url="https://github.com/elastic/elasticsearch/pull/8392">#8392</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix optimize behavior with <emphasis>force</emphasis> and <emphasis>flush</emphasis> flags. <ulink url="https://github.com/elastic/elasticsearch/pull/7920">#7920</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7886">#7886</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7904">#7904</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed validate query parsing issues <ulink url="https://github.com/elastic/elasticsearch/pull/6114">#6114</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6111">#6111</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6112">#6112</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6116">#6116</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Indexed Scripts/Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix updating templates. <ulink url="https://github.com/elastic/elasticsearch/pull/10526">#10526</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10397">#10397</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ScriptService can deadlock entire nodes if script index is recovering <ulink url="https://github.com/elastic/elasticsearch/pull/8901">#8901</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
GetIndexedScript call can deadlock <ulink url="https://github.com/elastic/elasticsearch/pull/8266">#8266</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make template params take arrays <ulink url="https://github.com/elastic/elasticsearch/pull/8255">#8255</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cleaned up various issues <ulink url="https://github.com/elastic/elasticsearch/pull/7787">#7787</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7559">#7559</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7560">#7560</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7567">#7567</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7568">#7568</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7647">#7647</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change the default <literal>auto_expand</literal> for the <literal>.scripts</literal> index to <literal>0-all</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7502">#7502</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>.script</literal> index template. <ulink url="https://github.com/elastic/elasticsearch/pull/7500">#7500</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Inner Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Reset the <literal>ShardTargetType</literal> after serializing inner hits. <ulink url="https://github.com/elastic/elasticsearch/pull/12261">#12261</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Properly support named queries for both nested and parent child inner hits <ulink url="https://github.com/elastic/elasticsearch/pull/11880">#11880</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10661">#10661</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/10694">#10694</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix multi level parent/child bug <ulink url="https://github.com/elastic/elasticsearch/pull/11199">#11199</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure size=0 works on the inner_hits level. <ulink url="https://github.com/elastic/elasticsearch/pull/10388">#10388</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10358">#10358</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure inner hits also works for nested fields defined in object field <ulink url="https://github.com/elastic/elasticsearch/pull/10353">#10353</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10334">#10334</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix bug where parse error is thrown if a inner filter is used in a nested filter/query. <ulink url="https://github.com/elastic/elasticsearch/pull/10309">#10309</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10308">#10308</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix nested stored field support. <ulink url="https://github.com/elastic/elasticsearch/pull/10235">#10235</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9766">#9766</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t fail if an object is specified as a nested value instead of an array. <ulink url="https://github.com/elastic/elasticsearch/pull/9743">#9743</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9723">#9723</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure inner hits defined on has_parent query resolve hits properly <ulink url="https://github.com/elastic/elasticsearch/pull/9384">#9384</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add plugin modules before (almost all) others <ulink url="https://github.com/elastic/elasticsearch/pull/13061">#13061</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12783">#12783</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Workaround JDK bug 8034057 <ulink url="https://github.com/elastic/elasticsearch/pull/12970">#12970</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix concurrency issue in PrioritizedEsThreadPoolExecutor. <ulink url="https://github.com/elastic/elasticsearch/pull/12599">#12599</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix ShardUtils#getElasticsearchDirectoryReader() <ulink url="https://github.com/elastic/elasticsearch/pull/12594">#12594</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
don&#8217;t represent site plugins with <emphasis>null</emphasis> anymore <ulink url="https://github.com/elastic/elasticsearch/pull/12577">#12577</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
IndicesStore shouldn&#8217;t try to delete index after deleting a shard <ulink url="https://github.com/elastic/elasticsearch/pull/12494">#12494</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12487">#12487</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ShardUtils#getElasticsearchLeafReader() should use FilterLeafReader#getDelegate() instead of FilterLeafReader#unwrap <ulink url="https://github.com/elastic/elasticsearch/pull/12437">#12437</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix serialization of IndexFormatTooNewException and IndexFormatTooOldException <ulink url="https://github.com/elastic/elasticsearch/pull/12277">#12277</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Decode URL.getPath before resolving a real file <ulink url="https://github.com/elastic/elasticsearch/pull/11940">#11940</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix FieldDataTermsFilter.equals. <ulink url="https://github.com/elastic/elasticsearch/pull/11835">#11835</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11779">#11779</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add a null-check for XContentBuilder#field for BigDecimals <ulink url="https://github.com/elastic/elasticsearch/pull/11790">#11790</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11699">#11699</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
AsyncShardFetch can hang if there are new nodes in cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/11615">#11615</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make JNA optional for tests and move classes to bootstrap package <ulink url="https://github.com/elastic/elasticsearch/pull/11378">#11378</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11360">#11360</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Transport: remove support for reading/writing list of strings, use arrays instead <ulink url="https://github.com/elastic/elasticsearch/pull/11276">#11276</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11056">#11056</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix CompressedString.equals. <ulink url="https://github.com/elastic/elasticsearch/pull/11233">#11233</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
ThreadPool: make sure no leaking threads are left behind in case of initialization failure <ulink url="https://github.com/elastic/elasticsearch/pull/11061">#11061</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9107">#9107</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Propagate headers &amp; contexts to sub-requests <ulink url="https://github.com/elastic/elasticsearch/pull/11060">#11060</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10979">#10979</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE in PendingDelete#toString <ulink url="https://github.com/elastic/elasticsearch/pull/11032">#11032</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure that explanation descriptions are not null on serialization <ulink url="https://github.com/elastic/elasticsearch/pull/10689">#10689</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10399">#10399</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible NPE in InternalClusterService$NotifyTimeout, the <literal>future</literal> field is set from a different thread <ulink url="https://github.com/elastic/elasticsearch/pull/10630">#10630</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3">#3</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow ActionListener to be called on the network thread <ulink url="https://github.com/elastic/elasticsearch/pull/10573">#10573</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10402">#10402</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing hashCode method to RecoveryState#File <ulink url="https://github.com/elastic/elasticsearch/pull/10501">#10501</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t try to send a mapping refresh if there is no master <ulink url="https://github.com/elastic/elasticsearch/pull/10311">#10311</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10283">#10283</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix PageCacheRecycler&#8217;s max page size computation. <ulink url="https://github.com/elastic/elasticsearch/pull/10087">#10087</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10077">#10077</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Close all resources if doStart fails <ulink url="https://github.com/elastic/elasticsearch/pull/9898">#9898</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Snapshot status api: make sure headers are handed over to inner nodes request <ulink url="https://github.com/elastic/elasticsearch/pull/9409">#9409</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix equality check of timevalue after serialization <ulink url="https://github.com/elastic/elasticsearch/pull/9218">#9218</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
AdapterActionFuture should not set currentThread().interrupt() <ulink url="https://github.com/elastic/elasticsearch/pull/9141">#9141</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9001">#9001</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
PlainTransportFuture should not set currentThread().interrupt() <ulink url="https://github.com/elastic/elasticsearch/pull/9001">#9001</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
IndexService - synchronize  close to prevent race condition with shard creation <ulink url="https://github.com/elastic/elasticsearch/pull/8557">#8557</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
When corruption strikes, don&#8217;t create exceptions with circular references <ulink url="https://github.com/elastic/elasticsearch/pull/8331">#8331</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
In fixed bitset service fix order where the warmer listener is added. <ulink url="https://github.com/elastic/elasticsearch/pull/8168">#8168</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8140">#8140</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only schedule another refresh if <literal>refresh_interval</literal> is positive <ulink url="https://github.com/elastic/elasticsearch/pull/8087">#8087</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8085">#8085</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix serialization of PendingClusterTask.timeInQueue. <ulink url="https://github.com/elastic/elasticsearch/pull/8077">#8077</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Dangling indices import ignores aliases <ulink url="https://github.com/elastic/elasticsearch/pull/8059">#8059</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix serialization of short[] arays. <ulink url="https://github.com/elastic/elasticsearch/pull/8025">#8025</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7845">#7845</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make close() synchronized during node shutdown <ulink url="https://github.com/elastic/elasticsearch/pull/7885">#7885</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure GroupShardsIterator is consistent across requests, to ensure consistent sorting <ulink url="https://github.com/elastic/elasticsearch/pull/7698">#7698</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix ordering of Regex.simpleMatch() parameters <ulink url="https://github.com/elastic/elasticsearch/pull/7661">#7661</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7651">#7651</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Unify search context cleanup <ulink url="https://github.com/elastic/elasticsearch/pull/7643">#7643</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7625">#7625</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use <literal>SEARCH</literal> threadpool for potentially blocking operations <ulink url="https://github.com/elastic/elasticsearch/pull/7624">#7624</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7623">#7623</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make network interface iteration order consistent <ulink url="https://github.com/elastic/elasticsearch/pull/7494">#7494</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add all unsafe variants of LZF compress library functions to forbidden APIs. <ulink url="https://github.com/elastic/elasticsearch/pull/7468">#7468</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8078">#8078</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Wait until engine is started up when acquiring searcher <ulink url="https://github.com/elastic/elasticsearch/pull/7456">#7456</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7455">#7455</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix discovery.id.seed <ulink url="https://github.com/elastic/elasticsearch/pull/7439">#7439</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7437">#7437</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Made original indices optional for broadcast delete and delete by query shard requests <ulink url="https://github.com/elastic/elasticsearch/pull/7406">#7406</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Force optimize was not passed to shard request <ulink url="https://github.com/elastic/elasticsearch/pull/7405">#7405</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7404">#7404</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed a request headers bug in transport client <ulink url="https://github.com/elastic/elasticsearch/pull/7302">#7302</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix explanation streaming <ulink url="https://github.com/elastic/elasticsearch/pull/7257">#7257</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
VerboseProgress(PrintWriter) does not set the writer <ulink url="https://github.com/elastic/elasticsearch/pull/7254">#7254</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix a very rare case of corruption in compression used for internal cluster communication. <ulink url="https://github.com/elastic/elasticsearch/pull/7210">#7210</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix BytesStreamInput(BytesReference) ctor with nonzero offset <ulink url="https://github.com/elastic/elasticsearch/pull/7197">#7197</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix serialization bug in reroute API <ulink url="https://github.com/elastic/elasticsearch/pull/7135">#7135</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support parsing lucene minor version strings <ulink url="https://github.com/elastic/elasticsearch/pull/7055">#7055</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix connect concurrency, can cause connection nodes to close <ulink url="https://github.com/elastic/elasticsearch/pull/6964">#6964</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Drop UnsafeUtils <ulink url="https://github.com/elastic/elasticsearch/pull/6963">#6963</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6962">#6962</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
When serializing HttpInfo, return null info if service is not started <ulink url="https://github.com/elastic/elasticsearch/pull/6906">#6906</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove indicesLifecycle.Listener from IndexingMemoryController <ulink url="https://github.com/elastic/elasticsearch/pull/6892">#6892</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible NPE during shutdown for requests using timeouts <ulink url="https://github.com/elastic/elasticsearch/pull/6849">#6849</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prevent NPE if engine is closed while version map is checked <ulink url="https://github.com/elastic/elasticsearch/pull/6786">#6786</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
If the node initialisation fails, make sure the node environment is closed correctly <ulink url="https://github.com/elastic/elasticsearch/pull/6715">#6715</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
IndexingMemoryController should only update buffer settings of fully recovered shards <ulink url="https://github.com/elastic/elasticsearch/pull/6667">#6667</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6642">#6642</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible race condition in checksum name generator <ulink url="https://github.com/elastic/elasticsearch/pull/6662">#6662</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow to serialize negative thread pool sizes <ulink url="https://github.com/elastic/elasticsearch/pull/6486">#6486</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5357">#5357</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6325">#6325</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>ignore_unavailable</literal> option should also ignore indices that are closed <ulink url="https://github.com/elastic/elasticsearch/pull/6475">#6475</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6471">#6471</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Guava doesn&#8217;t explicitly remove entries when clearing the entire cache [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6296">#6296</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
MetaData#concreteIndices to throw exception with a single index argument if allowNoIndices == false <ulink url="https://github.com/elastic/elasticsearch/pull/6137">#6137</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restore read/write visibility in PlainShardsIterator. <ulink url="https://github.com/elastic/elasticsearch/pull/6039">#6039</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5561">#5561</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use TransportBulkAction for internal request from IndicesTTLService <ulink url="https://github.com/elastic/elasticsearch/pull/5795">#5795</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5766">#5766</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Take stream position into account when calculating remaining length <ulink url="https://github.com/elastic/elasticsearch/pull/5677">#5677</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5667">#5667</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix some warnings reported by Findbugs. <ulink url="https://github.com/elastic/elasticsearch/pull/5571">#5571</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Assorted fixes for bugs in the PagedBytesReference tests <ulink url="https://github.com/elastic/elasticsearch/pull/5549">#5549</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix for zero-sized content throwing off toChannelBuffer(). <ulink url="https://github.com/elastic/elasticsearch/pull/5543">#5543</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Count latch down if sendsPing throws exception <ulink url="https://github.com/elastic/elasticsearch/pull/5440">#5440</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix yamlBuilder() to return YAML builder instead of SMILE <ulink url="https://github.com/elastic/elasticsearch/pull/5186">#5186</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5185">#5185</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Java API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add missing support for escape to QueryStringQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/13016">#13016</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix PrefixQueryBuilder to support an Object value <ulink url="https://github.com/elastic/elasticsearch/pull/12124">#12124</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12032">#12032</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Properly fix the default regex flag to ALL for RegexpQueryParser and Builder <ulink url="https://github.com/elastic/elasticsearch/pull/12067">#12067</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11896">#11896</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Java api: add missing support for boost to GeoShapeQueryBuilder and TermsQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/11810">#11810</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11744">#11744</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add missing rewrite parameter to FuzzyQueryBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/11139">#11139</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11130">#11130</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ensure netty I/O thread is not blocked in TransportClient <ulink url="https://github.com/elastic/elasticsearch/pull/10644">#10644</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
toString for SearchRequestBuilder and CountRequestBuilder <ulink url="https://github.com/elastic/elasticsearch/pull/9944">#9944</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5555">#5555</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5576">#5576</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added missing module registration in TransportClient for Significant Terms <ulink url="https://github.com/elastic/elasticsearch/pull/7852">#7852</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7840">#7840</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Get indexed script shouldn&#8217;t allow to set the index [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7553">#7553</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add back string op type to IndexRequest <ulink url="https://github.com/elastic/elasticsearch/pull/7387">#7387</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixed the node retry mechanism which could fail without trying all the connected nodes <ulink url="https://github.com/elastic/elasticsearch/pull/6829">#6829</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix source excludes setting if no includes were provided [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6632">#6632</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
BulkRequest#add(Iterable) to support UpdateRequests <ulink url="https://github.com/elastic/elasticsearch/pull/6551">#6551</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make sure afterBulk is always called in BulkProcessor <ulink url="https://github.com/elastic/elasticsearch/pull/6495">#6495</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5038">#5038</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
JsonXContentGenerator#writeRawField produces invalid JSON if raw field is the first field in the json object [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5514">#5514</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix returning incorrect XContentParser <ulink url="https://github.com/elastic/elasticsearch/pull/5510">#5510</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Enforce query instance checking before it wrapper as a filter <ulink url="https://github.com/elastic/elasticsearch/pull/5431">#5431</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
forceSource highlighting field option doesn&#8217;t have any effect when set using the Java API [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5220">#5220</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
BulkProcessor process every n+1 docs instead of n <ulink url="https://github.com/elastic/elasticsearch/pull/4265">#4265</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Logging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use task&#8217;s class name if not a TimedPrioritizeRunnable <ulink url="https://github.com/elastic/elasticsearch/pull/11610">#11610</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix potential NPE in new tracer log if request timeout <ulink url="https://github.com/elastic/elasticsearch/pull/9994">#9994</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9286">#9286</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix example in logging daily rotate configuration <ulink url="https://github.com/elastic/elasticsearch/pull/8550">#8550</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8464">#8464</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix location information for loggers <ulink url="https://github.com/elastic/elasticsearch/pull/8052">#8052</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5130">#5130</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixes Logger class for BackgroundIndexer <ulink url="https://github.com/elastic/elasticsearch/pull/6781">#6781</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix format string for DiskThresholdDecider reroute explanation <ulink url="https://github.com/elastic/elasticsearch/pull/5749">#5749</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Move the <literal>murmur3</literal> field to a plugin and fix defaults. <ulink url="https://github.com/elastic/elasticsearch/pull/12931">#12931</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12874">#12874</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix field type compatiblity check to work when only one previous type exists <ulink url="https://github.com/elastic/elasticsearch/pull/12779">#12779</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12753">#12753</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>numeric_resolution</literal> should only apply to dates provided as numbers. <ulink url="https://github.com/elastic/elasticsearch/pull/11002">#11002</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10995">#10995</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Wait for mappings to be available on the primary before indexing. <ulink url="https://github.com/elastic/elasticsearch/pull/10949">#10949</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>_field_names</literal> to not have doc values <ulink url="https://github.com/elastic/elasticsearch/pull/10893">#10893</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10892">#10892</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Explicitly disallow multi fields from using object or nested fields <ulink url="https://github.com/elastic/elasticsearch/pull/10745">#10745</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Unneccesary mapping refreshes caused by unordered fielddata settings <ulink url="https://github.com/elastic/elasticsearch/pull/10370">#10370</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10318">#10318</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed an equality check in StringFieldMapper. <ulink url="https://github.com/elastic/elasticsearch/pull/10359">#10359</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10357">#10357</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix doc values representation to always serliaze if explicitly set <ulink url="https://github.com/elastic/elasticsearch/pull/10302">#10302</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10297">#10297</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>_field_names</literal> to be disabled on pre 1.3.0 indexes <ulink url="https://github.com/elastic/elasticsearch/pull/10268">#10268</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9893">#9893</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>ignore_malformed</literal> behaviour for ip fields <ulink url="https://github.com/elastic/elasticsearch/pull/10112">#10112</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update dynamic fields in mapping on master even if parsing fails for the rest of the doc <ulink url="https://github.com/elastic/elasticsearch/pull/9874">#9874</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9851">#9851</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw StrictDynamicMappingException exception if <literal>dynamic:strict</literal> and undeclared field value is <literal>null</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/9445">#9445</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9444">#9444</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Using <literal>default:null</literal> for _timestamp field creates a index loss on restart <ulink url="https://github.com/elastic/elasticsearch/pull/9233">#9233</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9104">#9104</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9223">#9223</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Reencode transformed result with same xcontent <ulink url="https://github.com/elastic/elasticsearch/pull/8974">#8974</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8959">#8959</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Serialize doc values settings for _timestamp <ulink url="https://github.com/elastic/elasticsearch/pull/8967">#8967</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8893">#8893</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update cluster state with type mapping also for failed indexing request <ulink url="https://github.com/elastic/elasticsearch/pull/8692">#8692</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8650">#8650</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix conflict when updating mapping with _all disabled <ulink url="https://github.com/elastic/elasticsearch/pull/8426">#8426</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7377">#7377</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8423">#8423</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Generate dynamic mappings for empty strings. <ulink url="https://github.com/elastic/elasticsearch/pull/8329">#8329</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8198">#8198</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw exception if null_value is set to <literal>null</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7978">#7978</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7273">#7273</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Posting a mapping with default analyzer fails <ulink url="https://github.com/elastic/elasticsearch/pull/7902">#7902</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2716">#2716</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add explicit error when PUT mapping API is given an empty request body. <ulink url="https://github.com/elastic/elasticsearch/pull/7618">#7618</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7536">#7536</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Enable merging of properties in the <literal>_timestamp</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/7614">#7614</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5772">#5772</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6958">#6958</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/777">#777</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>index</literal> setting in <literal>_boost</literal> field <ulink url="https://github.com/elastic/elasticsearch/pull/7557">#7557</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Keep parameters in mapping for <literal>_timestamp</literal> and <literal>_size</literal> even if disabled <ulink url="https://github.com/elastic/elasticsearch/pull/7475">#7475</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Report conflict when trying to disable <literal>_ttl</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7316">#7316</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7293">#7293</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/777">#777</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that multi fields are serialized in a consistent order. <ulink url="https://github.com/elastic/elasticsearch/pull/7220">#7220</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7215">#7215</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix dynamic mapping of geo_point fields <ulink url="https://github.com/elastic/elasticsearch/pull/7175">#7175</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6939">#6939</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve IP address validation <ulink url="https://github.com/elastic/elasticsearch/pull/7141">#7141</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7131">#7131</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>copy_to</literal> behavior on nested documents. <ulink url="https://github.com/elastic/elasticsearch/pull/7079">#7079</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6701">#6701</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add multi_field support for Mapper externalValue (plugins) <ulink url="https://github.com/elastic/elasticsearch/pull/6867">#6867</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5402">#5402</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix possibility of losing meta configuration on field mapping update <ulink url="https://github.com/elastic/elasticsearch/pull/6550">#6550</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5053">#5053</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow _version to use <literal>disk</literal> as a doc values format. <ulink url="https://github.com/elastic/elasticsearch/pull/6523">#6523</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Path-based routing doesn&#8217;t work with doc values [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5844">#5844</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
geo_point doesn&#8217;t allow null values as of 1.1.0 [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5680">#5680</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check "store" parameter for binary mapper and check "index_name" for all mappers <ulink url="https://github.com/elastic/elasticsearch/pull/5585">#5585</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5474">#5474</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix dynamic_type in dynamic_template <ulink url="https://github.com/elastic/elasticsearch/pull/5564">#5564</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5256">#5256</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix include_in_all for multi field <ulink url="https://github.com/elastic/elasticsearch/pull/5522">#5522</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5364">#5364</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
merge GeoPoint specific mapping properties <ulink url="https://github.com/elastic/elasticsearch/pull/5506">#5506</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5505">#5505</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Merge <literal>null_value</literal> for boolean field and remove <literal>include_in_all</literal> for boolean field in doc <ulink url="https://github.com/elastic/elasticsearch/pull/5503">#5503</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5502">#5502</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Geo Point Fieldmapper: Allow distance for geohash precision <ulink url="https://github.com/elastic/elasticsearch/pull/5449">#5449</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5448">#5448</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure get field mapping request is executed on node hosting the index <ulink url="https://github.com/elastic/elasticsearch/pull/5225">#5225</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5177">#5177</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added <literal>fields</literal> support to <literal>geo_point</literal> and <literal>completion</literal> field type <ulink url="https://github.com/elastic/elasticsearch/pull/4963">#4963</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
More Like This
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix potentially unpositioned enum [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12066">#12066</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>exclude</literal> with artificial documents <ulink url="https://github.com/elastic/elasticsearch/pull/8679">#8679</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixes many misbehaving user parameters <ulink url="https://github.com/elastic/elasticsearch/pull/8028">#8028</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2914">#2914</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>percent_terms_to_match</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7754">#7754</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove unused <literal>search_query_hint</literal> parameter <ulink url="https://github.com/elastic/elasticsearch/pull/7691">#7691</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
More Like This API would not take into account size and from in request body <ulink url="https://github.com/elastic/elasticsearch/pull/5981">#5981</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
NOT CLASSIFIED
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Rivers might not get started due to missing _meta document [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4864">#4864</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Nested Docs
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Nested agg needs to reset root doc between segments. <ulink url="https://github.com/elastic/elasticsearch/pull/9441">#9441</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9436">#9436</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9437">#9437</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix handling of multiple buckets being emitted for the same parent doc id in nested aggregation <ulink url="https://github.com/elastic/elasticsearch/pull/9346">#9346</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8454">#8454</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9317">#9317</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
In reverse nested aggregation, fix handling of the same child doc id being processed multiple times. <ulink url="https://github.com/elastic/elasticsearch/pull/9345">#9345</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9263">#9263</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9346">#9346</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The parent filter of the nested aggregator isn&#8217;t resolved correctly all the time <ulink url="https://github.com/elastic/elasticsearch/pull/9335">#9335</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9280">#9280</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Change nested agg to execute in doc id order <ulink url="https://github.com/elastic/elasticsearch/pull/8454">#8454</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
If the <literal>_type</literal> field isn&#8217;t indexed nested inner docs must be filtered out. <ulink url="https://github.com/elastic/elasticsearch/pull/7410">#7410</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>nested</literal> aggregator should also resolve and use the parentFilter of the closest <literal>reverse_nested</literal> aggregator. <ulink url="https://github.com/elastic/elasticsearch/pull/7048">#7048</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6994">#6994</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow sorting on nested sub generated field <ulink url="https://github.com/elastic/elasticsearch/pull/6151">#6151</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6150">#6150</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
A nested <literal>nested</literal> aggregation falls outside of its parent <literal>nested</literal> aggregation bounds <ulink url="https://github.com/elastic/elasticsearch/pull/5728">#5728</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Deduplicate addresses from resolver. <ulink url="https://github.com/elastic/elasticsearch/pull/12995">#12995</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Remove usage of <literal>InetAddress#getLocalHost</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/12959">#12959</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix network binding for ipv4/ipv6 <ulink url="https://github.com/elastic/elasticsearch/pull/12942">#12942</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12906">#12906</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12915">#12915</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Transport: Do not make the buffer skip while a stream is open. <ulink url="https://github.com/elastic/elasticsearch/pull/11988">#11988</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Transport: fix racing condition in timeout handling <ulink url="https://github.com/elastic/elasticsearch/pull/10220">#10220</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10187">#10187</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Netty: Add HTTP pipelining support <ulink url="https://github.com/elastic/elasticsearch/pull/8299">#8299</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2665">#2665</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE when initializing an accepted socket in NettyTransport. <ulink url="https://github.com/elastic/elasticsearch/pull/6144">#6144</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Packaging
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix variable substitution for OS&#8217;s using systemd  <ulink url="https://github.com/elastic/elasticsearch/pull/12909">#12909</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix rpm -e removing /etc/elasticsearch <ulink url="https://github.com/elastic/elasticsearch/pull/12785">#12785</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Makes sure all POMs contain a description <ulink url="https://github.com/elastic/elasticsearch/pull/12771">#12771</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12550">#12550</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
use spaces liberally in integration tests and fix space handling <ulink url="https://github.com/elastic/elasticsearch/pull/12710">#12710</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12709">#12709</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
rpm and deb create scripts directory <ulink url="https://github.com/elastic/elasticsearch/pull/12704">#12704</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12702">#12702</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix shaded jar packaging <ulink url="https://github.com/elastic/elasticsearch/pull/12589">#12589</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix Bootstrap to not call System.exit <ulink url="https://github.com/elastic/elasticsearch/pull/12586">#12586</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
elasticsearch (again) adds CWD to classpath [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12580">#12580</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
jsr166e was left out of shaded jar <ulink url="https://github.com/elastic/elasticsearch/pull/12194">#12194</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12193">#12193</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t add CWD to classpath when ES_CLASSPATH isn&#8217;t set. <ulink url="https://github.com/elastic/elasticsearch/pull/12001">#12001</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12000">#12000</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix endless looping if starting fails <ulink url="https://github.com/elastic/elasticsearch/pull/11836">#11836</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Postrm script should not fail <ulink url="https://github.com/elastic/elasticsearch/pull/11678">#11678</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11373">#11373</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Create PID_DIR in init.d script <ulink url="https://github.com/elastic/elasticsearch/pull/11674">#11674</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11594">#11594</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix missing dependencies for RPM/DEB packages <ulink url="https://github.com/elastic/elasticsearch/pull/11664">#11664</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11522">#11522</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update project.name in bin/elasticsearch script <ulink url="https://github.com/elastic/elasticsearch/pull/11348">#11348</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add antlr and asm dependencies <ulink url="https://github.com/elastic/elasticsearch/pull/9696">#9696</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Added quotes to allow spaces in installation path <ulink url="https://github.com/elastic/elasticsearch/pull/8428">#8428</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8441">#8441</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move forbidden api signature files to dev-tools. <ulink url="https://github.com/elastic/elasticsearch/pull/7921">#7921</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7917">#7917</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parsing command line args multiple times throws <literal>AlreadySelectedException</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/7282">#7282</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t remove ancestors on deb removal <ulink url="https://github.com/elastic/elasticsearch/pull/7078">#7078</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5770">#5770</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Shade mustache into org.elasticsearch.common package <ulink url="https://github.com/elastic/elasticsearch/pull/6193">#6193</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6192">#6192</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Export JAVA_HOME in RPM init script <ulink url="https://github.com/elastic/elasticsearch/pull/5434">#5434</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Set permission in debian postinst script correctly <ulink url="https://github.com/elastic/elasticsearch/pull/5158">#5158</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3820">#3820</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
RPMs: Add timeout to shutdown with KILL signal <ulink url="https://github.com/elastic/elasticsearch/pull/4721">#4721</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5020">#5020</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Parent/Child
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Explicitly disabled the query cache <ulink url="https://github.com/elastic/elasticsearch/pull/12955">#12955</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix <literal>_parent.type</literal> validation <ulink url="https://github.com/elastic/elasticsearch/pull/11436">#11436</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix 2 bugs in <literal>children</literal> agg <ulink url="https://github.com/elastic/elasticsearch/pull/10263">#10263</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10158">#10158</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9544">#9544</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9958">#9958</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Post collection the children agg should also invoke that phase on its wrapped child aggs. <ulink url="https://github.com/elastic/elasticsearch/pull/9291">#9291</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9271">#9271</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix concurrency issues of the _parent field data. <ulink url="https://github.com/elastic/elasticsearch/pull/9030">#9030</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8396">#8396</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed p/c filters not being able to be used in alias filters. <ulink url="https://github.com/elastic/elasticsearch/pull/8649">#8649</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5916">#5916</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8628">#8628</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Missing parent routing causes NullPointerException in Bulk API <ulink url="https://github.com/elastic/elasticsearch/pull/8506">#8506</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8365">#8365</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The <literal>children</literal> agg didn&#8217;t take deleted document into account <ulink url="https://github.com/elastic/elasticsearch/pull/8180">#8180</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check if there is a search context, otherwise throw a query parse exception. <ulink url="https://github.com/elastic/elasticsearch/pull/8177">#8177</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8031">#8031</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>has_parent</literal> filter must take parent filter into account when executing the inner query/filter <ulink url="https://github.com/elastic/elasticsearch/pull/8020">#8020</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7362">#7362</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
A <literal>has_child</literal> or other p/c query wrapped in a query filter may emit wrong results <ulink url="https://github.com/elastic/elasticsearch/pull/7685">#7685</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add support for the field data loading option to the <literal>_parent</literal> field. <ulink url="https://github.com/elastic/elasticsearch/pull/7402">#7402</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7394">#7394</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
If _parent field points to a non existing parent type, then skip the has_parent query/filter <ulink url="https://github.com/elastic/elasticsearch/pull/7362">#7362</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7349">#7349</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Disabled parent/child queries in the delete by query api. <ulink url="https://github.com/elastic/elasticsearch/pull/5916">#5916</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5828">#5828</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parse has_child query/filter after child type has been parsed <ulink url="https://github.com/elastic/elasticsearch/pull/5838">#5838</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5783">#5783</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Parent / child queries should work with non-default similarities <ulink url="https://github.com/elastic/elasticsearch/pull/4979">#4979</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4977">#4977</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Percolator
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Support filtering percolator queries by date using <literal>now</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/12215">#12215</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12185">#12185</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE when percolating a document that has a _parent field configured in its mapping <ulink url="https://github.com/elastic/elasticsearch/pull/12214">#12214</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12192">#12192</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Load percolator queries before shard is marked POST_RECOVERY <ulink url="https://github.com/elastic/elasticsearch/pull/11799">#11799</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10722">#10722</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail nicely if <literal>nested</literal> query with <literal>inner_hits</literal> is used in a percolator query <ulink url="https://github.com/elastic/elasticsearch/pull/11793">#11793</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11672">#11672</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent PercolateResponse from serializing negative VLong <ulink url="https://github.com/elastic/elasticsearch/pull/11138">#11138</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix wrong use of currentFieldName outside of a parsing loop <ulink url="https://github.com/elastic/elasticsearch/pull/10307">#10307</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support encoded body as query string param consistently <ulink url="https://github.com/elastic/elasticsearch/pull/9628">#9628</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Take filters from aliases into account <ulink url="https://github.com/elastic/elasticsearch/pull/9590">#9590</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6241">#6241</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fixed bug when using multi percolate api with routing <ulink url="https://github.com/elastic/elasticsearch/pull/9161">#9161</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6214">#6214</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Pass down the types from the delete mapping request to the delete by query request <ulink url="https://github.com/elastic/elasticsearch/pull/7091">#7091</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7087">#7087</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix memory leak when percolating with nested documents <ulink url="https://github.com/elastic/elasticsearch/pull/6578">#6578</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix handling of nested documents <ulink url="https://github.com/elastic/elasticsearch/pull/6544">#6544</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6540">#6540</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Percolator: Fix assertion in percolation with nested docs <ulink url="https://github.com/elastic/elasticsearch/pull/6263">#6263</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add num_of_shards statistic to percolate context <ulink url="https://github.com/elastic/elasticsearch/pull/6123">#6123</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6037">#6037</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The percolator needs to take deleted percolator documents into account. <ulink url="https://github.com/elastic/elasticsearch/pull/5843">#5843</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5840">#5840</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Propagate percolate mapping changes to cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/5776">#5776</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix highlighting in percolate existing doc api <ulink url="https://github.com/elastic/elasticsearch/pull/5108">#5108</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make highlight query also work in the percolate api <ulink url="https://github.com/elastic/elasticsearch/pull/5090">#5090</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Percolator response always returns the <literal>matches</literal> key. <ulink url="https://github.com/elastic/elasticsearch/pull/4882">#4882</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4881">#4881</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Cloud Azure
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Correctly list blobs in Azure Storage to prevent snapshot corruption and do not unnecessarily duplicate Lucene segments in Azure Storage <ulink url="https://github.com/elastic/elasticsearch/pull/12380">#12380</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/51">#51</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/99">#99</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugin Delete By Query
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix number of deleted/missing documents in Delete-By-Query <ulink url="https://github.com/elastic/elasticsearch/pull/11745">#11745</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Plugins
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix automatically generated URLs for official plugins in PluginManager <ulink url="https://github.com/elastic/elasticsearch/pull/12885">#12885</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Skip hidden files <ulink url="https://github.com/elastic/elasticsearch/pull/12465">#12465</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12433">#12433</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
strip elasticsearch- and es- from any plugin name <ulink url="https://github.com/elastic/elasticsearch/pull/12160">#12160</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/12143">#12143</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12158">#12158</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
remove elasticsearch- from name of official plugins <ulink url="https://github.com/elastic/elasticsearch/pull/12158">#12158</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11805">#11805</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/12143">#12143</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix pluginmanager permissions for bin/ scripts <ulink url="https://github.com/elastic/elasticsearch/pull/12157">#12157</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12142">#12142</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only load a plugin once from the classpath <ulink url="https://github.com/elastic/elasticsearch/pull/11301">#11301</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Let HTTPS work correctly <ulink url="https://github.com/elastic/elasticsearch/pull/10983">#10983</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
HTTP: Ensure url path expansion only works inside of plugins <ulink url="https://github.com/elastic/elasticsearch/pull/10815">#10815</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Installation failed when directories are on different file systems <ulink url="https://github.com/elastic/elasticsearch/pull/9011">#9011</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8999">#8999</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
NPE when plugins dir is inaccessible <ulink url="https://github.com/elastic/elasticsearch/pull/8839">#8839</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8837">#8837</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Plugins failed to load since #8666 <ulink url="https://github.com/elastic/elasticsearch/pull/8756">#8756</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Support usage of ES_JAVA_OPTS in plugin commands <ulink url="https://github.com/elastic/elasticsearch/pull/8288">#8288</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix config path extraction from plugin handle <ulink url="https://github.com/elastic/elasticsearch/pull/7935">#7935</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Plugins with only  <literal>bin</literal> and <literal>config</literal> do not install correctly <ulink url="https://github.com/elastic/elasticsearch/pull/7154">#7154</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7152">#7152</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>bin/plugin</literal> removes itself [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6745">#6745</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Removing plugin does not fail when plugin dir is read only <ulink url="https://github.com/elastic/elasticsearch/pull/6735">#6735</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6546">#6546</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix github download link when using specific version <ulink url="https://github.com/elastic/elasticsearch/pull/6321">#6321</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Properly quote $JAVA in bin/plugin <ulink url="https://github.com/elastic/elasticsearch/pull/5765">#5765</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NPE in PluginsService when starting elasticsearch with a wrong user <ulink url="https://github.com/elastic/elasticsearch/pull/5196">#5196</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4186">#4186</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5195">#5195</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrading analysis plugins fails <ulink url="https://github.com/elastic/elasticsearch/pull/5034">#5034</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4936">#4936</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5030">#5030</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query DSL
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Add support for <literal>disable_coord</literal> param to <literal>terms</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/12756">#12756</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12755">#12755</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Do not track named queries that are null <ulink url="https://github.com/elastic/elasticsearch/pull/12691">#12691</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12683">#12683</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>multi_match</literal> query applies boosts too many times. <ulink url="https://github.com/elastic/elasticsearch/pull/12294">#12294</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
QueryString ignores maxDeterminizedStates when creating a WildcardQuery <ulink url="https://github.com/elastic/elasticsearch/pull/12269">#12269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12266">#12266</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Rewrite set twice in WildcardQueryParser [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/12207">#12207</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix RegexpQueryBuilder#maxDeterminizedStates <ulink url="https://github.com/elastic/elasticsearch/pull/12083">#12083</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11896">#11896</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
CommonTermsQuery fix for ignored coordination factor <ulink url="https://github.com/elastic/elasticsearch/pull/11780">#11780</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11730">#11730</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix support for <literal>_name</literal> in some queries <ulink url="https://github.com/elastic/elasticsearch/pull/11694">#11694</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better exception if array passed to <literal>term</literal> query. <ulink url="https://github.com/elastic/elasticsearch/pull/11384">#11384</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11246">#11246</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Query DSL: Fix <literal>bool</literal> parsing. <ulink url="https://github.com/elastic/elasticsearch/pull/11120">#11120</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10985">#10985</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Score value is 0 in _explanation with random_score query [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/10742">#10742</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Avoid NPE during query parsing <ulink url="https://github.com/elastic/elasticsearch/pull/10333">#10333</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function score: Apply <literal>min_score</literal> to sub query score if no function provided <ulink url="https://github.com/elastic/elasticsearch/pull/10326">#10326</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10253">#10253</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
function_score: undo "Remove explanation of query score from functions" <ulink url="https://github.com/elastic/elasticsearch/pull/9826">#9826</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix wrong error messages in MultiMatchQueryParser <ulink url="https://github.com/elastic/elasticsearch/pull/8597">#8597</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
DateMath: Fix semantics of rounding with inclusive/exclusive ranges. <ulink url="https://github.com/elastic/elasticsearch/pull/8556">#8556</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8424">#8424</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Minor fixes to the <literal>match</literal> query <ulink url="https://github.com/elastic/elasticsearch/pull/8352">#8352</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6932">#6932</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make simple_query_string leniency more fine-grained <ulink url="https://github.com/elastic/elasticsearch/pull/8162">#8162</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7967">#7967</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NumberFormatException in Simple Query String Query <ulink url="https://github.com/elastic/elasticsearch/pull/7876">#7876</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7875">#7875</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Empty bool {} should return match_all <ulink url="https://github.com/elastic/elasticsearch/pull/7347">#7347</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7240">#7240</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Function Score: Fix explain distance string <ulink url="https://github.com/elastic/elasticsearch/pull/7248">#7248</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Function Score: Remove explanation of query score from functions <ulink url="https://github.com/elastic/elasticsearch/pull/7245">#7245</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Cache range filter on date field by default <ulink url="https://github.com/elastic/elasticsearch/pull/7122">#7122</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7114">#7114</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Throw exception if function in function score query is null <ulink url="https://github.com/elastic/elasticsearch/pull/6784">#6784</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6292">#6292</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
QueryParser can return null from a query <ulink url="https://github.com/elastic/elasticsearch/pull/6723">#6723</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6722">#6722</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix MatchQueryParser not parsing fuzzy_transpositions <ulink url="https://github.com/elastic/elasticsearch/pull/6300">#6300</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Range/Term query/filter on dates fail to handle numbers properly <ulink url="https://github.com/elastic/elasticsearch/pull/5969">#5969</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fixing questionable PNRG behavior <ulink url="https://github.com/elastic/elasticsearch/pull/5613">#5613</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5454">#5454</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5578">#5578</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add slop to prefix phrase query after parsing query string <ulink url="https://github.com/elastic/elasticsearch/pull/5438">#5438</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5005">#5005</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5437">#5437</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow edit distances &gt; 2 on FuzzyLikeThisQuery <ulink url="https://github.com/elastic/elasticsearch/pull/5374">#5374</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5292">#5292</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use FieldMapper to create the low level term queries in CommonTermQuery <ulink url="https://github.com/elastic/elasticsearch/pull/5273">#5273</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5258">#5258</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <emphasis>exists</emphasis>/<emphasis>missing</emphasis> behave consistently with exists/missing. <ulink url="https://github.com/elastic/elasticsearch/pull/5145">#5145</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5142">#5142</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow specifying nested fields in simple_query_string <ulink url="https://github.com/elastic/elasticsearch/pull/5110">#5110</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5091">#5091</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added exception to match and multi-match queries if passed an invalid type param <ulink url="https://github.com/elastic/elasticsearch/pull/4971">#4971</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4964">#4964</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Filtered query parses _name incorrectly [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4960">#4960</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Never cache a range filter that uses the <literal>now</literal> date expression. <ulink url="https://github.com/elastic/elasticsearch/pull/4828">#4828</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4846">#4846</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Query Refactoring
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Query DSL: don&#8217;t cache type filter in DocumentMapper <ulink url="https://github.com/elastic/elasticsearch/pull/12447">#12447</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
REST
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Return <literal>408 REQUEST_TIMEOUT</literal> if <literal>_cluster/health</literal> times out <ulink url="https://github.com/elastic/elasticsearch/pull/12780">#12780</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
<literal>fielddata_fields</literal> query string parameter was ignored. <ulink url="https://github.com/elastic/elasticsearch/pull/11368">#11368</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11025">#11025</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Update RestRequest.java <ulink url="https://github.com/elastic/elasticsearch/pull/11305">#11305</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Render non-elasticsearch exception as root cause <ulink url="https://github.com/elastic/elasticsearch/pull/10850">#10850</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10836">#10836</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add <literal>fielddata_fields</literal> to the REST spec <ulink url="https://github.com/elastic/elasticsearch/pull/9399">#9399</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4492">#4492</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9398">#9398</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Get field mapping api should honour pretty flag <ulink url="https://github.com/elastic/elasticsearch/pull/8806">#8806</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6552">#6552</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Passing <literal>fielddata_fields</literal> as a non array causes OOM <ulink url="https://github.com/elastic/elasticsearch/pull/8203">#8203</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reroute API response didn&#8217;t filter metadata <ulink url="https://github.com/elastic/elasticsearch/pull/7523">#7523</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7520">#7520</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allows all options for expand_wildcards parameter <ulink url="https://github.com/elastic/elasticsearch/pull/7290">#7290</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7258">#7258</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Added support for empty field arrays in mappings <ulink url="https://github.com/elastic/elasticsearch/pull/7271">#7271</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6133">#6133</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Empty HTTP body returned from _recovery API on empty cluster [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5743">#5743</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Search template: Put source param into template variable <ulink url="https://github.com/elastic/elasticsearch/pull/5598">#5598</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5556">#5556</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible exception in toCamelCase method <ulink url="https://github.com/elastic/elasticsearch/pull/5207">#5207</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Source filtering with wildcards broken when given multiple patterns <ulink url="https://github.com/elastic/elasticsearch/pull/5133">#5133</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5132">#5132</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ignore case when parsing <literal>script_values_sorted|unique</literal> in aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/5010">#5010</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5009">#5009</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
scroll REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4942">#4942</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4941">#4941</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix potential NPE when no source and no body <ulink url="https://github.com/elastic/elasticsearch/pull/4932">#4932</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/4892">#4892</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4900">#4900</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4901">#4901</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4902">#4902</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4903">#4903</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/4924">#4924</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
mtermvectors REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4910">#4910</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4902">#4902</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
percolate REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4909">#4909</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4903">#4903</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
mpercolate REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4908">#4908</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4900">#4900</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
msearch REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4905">#4905</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4901">#4901</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
mget REST API should support source parameter <ulink url="https://github.com/elastic/elasticsearch/pull/4893">#4893</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4892">#4892</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cluster state toXContent serialization only returns needed data <ulink url="https://github.com/elastic/elasticsearch/pull/4889">#4889</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4885">#4885</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Recovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Endless recovery loop with <literal>indices.recovery.file_chunk_size=0Bytes</literal> <ulink url="https://github.com/elastic/elasticsearch/pull/12919">#12919</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Rethrow exception during recovery finalization even if source is not broken <ulink url="https://github.com/elastic/elasticsearch/pull/12667">#12667</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Check for incompatible mappings while upgrading old indices <ulink url="https://github.com/elastic/elasticsearch/pull/12406">#12406</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11857">#11857</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix MapperException detection during translog ops replay <ulink url="https://github.com/elastic/elasticsearch/pull/11583">#11583</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11363">#11363</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix recovered translog ops stat counting when retrying a batch <ulink url="https://github.com/elastic/elasticsearch/pull/11536">#11536</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11363">#11363</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restart recovery upon mapping changes during translog replay <ulink url="https://github.com/elastic/elasticsearch/pull/11363">#11363</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11281">#11281</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add engine failure on recovery finalization corruption back <ulink url="https://github.com/elastic/elasticsearch/pull/11241">#11241</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Decrement reference even if IndexShard#postRecovery barfs <ulink url="https://github.com/elastic/elasticsearch/pull/11201">#11201</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fail recovery if retry recovery if resetRecovery fails <ulink url="https://github.com/elastic/elasticsearch/pull/11149">#11149</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Refactor state format to use incremental state IDs <ulink url="https://github.com/elastic/elasticsearch/pull/10316">#10316</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
RecoveryState.File.toXContent reports file length as recovered bytes <ulink url="https://github.com/elastic/elasticsearch/pull/10310">#10310</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fail shard when index service/mappings fails to instantiate <ulink url="https://github.com/elastic/elasticsearch/pull/10283">#10283</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Gateway: improve assertion at the end of shard recovery <ulink url="https://github.com/elastic/elasticsearch/pull/10028">#10028</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Synchronize RecoveryState.timer methods <ulink url="https://github.com/elastic/elasticsearch/pull/9943">#9943</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t recover from buggy version <ulink url="https://github.com/elastic/elasticsearch/pull/9925">#9925</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7210">#7210</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9922">#9922</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix deadlock problems when API flush and finish recovery happens concurrently <ulink url="https://github.com/elastic/elasticsearch/pull/9648">#9648</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Handle corruptions during recovery finalization <ulink url="https://github.com/elastic/elasticsearch/pull/9619">#9619</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mapping update task back references already closed index shard <ulink url="https://github.com/elastic/elasticsearch/pull/9607">#9607</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update access time of ongoing recoveries <ulink url="https://github.com/elastic/elasticsearch/pull/9506">#9506</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8720">#8720</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Cleaner interrupt handling during cancellation <ulink url="https://github.com/elastic/elasticsearch/pull/9000">#9000</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Harden recovery for old segments <ulink url="https://github.com/elastic/elasticsearch/pull/8399">#8399</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Prefer recovering the state file that uses the latest format. <ulink url="https://github.com/elastic/elasticsearch/pull/8343">#8343</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Change check for finished to a ref count check <ulink url="https://github.com/elastic/elasticsearch/pull/8271">#8271</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8092">#8092</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
RecoveriesCollection.findRecoveryByShard should call recoveryStatus.tryIncRef before accessing fields <ulink url="https://github.com/elastic/elasticsearch/pull/8231">#8231</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8092">#8092</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Mapping check during phase2 should be done in cluster state update task <ulink url="https://github.com/elastic/elasticsearch/pull/7744">#7744</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t update indexShard if it has been removed before <ulink url="https://github.com/elastic/elasticsearch/pull/7509">#7509</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Increment Store refcount on RecoveryTarget <ulink url="https://github.com/elastic/elasticsearch/pull/6844">#6844</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Recovery from local gateway should re-introduce new mappings <ulink url="https://github.com/elastic/elasticsearch/pull/6659">#6659</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Honor time delay when retrying recoveries <ulink url="https://github.com/elastic/elasticsearch/pull/6226">#6226</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not start a recovery process if the primary shard is currently allocated on a node which is not part of the cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/6024">#6024</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Consistently name Groovy scripts with the same content <ulink url="https://github.com/elastic/elasticsearch/pull/12296">#12296</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12212">#12212</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Execute Scripting Engine before searching for inner templates in template query <ulink url="https://github.com/elastic/elasticsearch/pull/11512">#11512</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Allow script language to be null when parsing <ulink url="https://github.com/elastic/elasticsearch/pull/10976">#10976</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10926">#10926</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
File scripts cache key to include language and prevent conflicts <ulink url="https://github.com/elastic/elasticsearch/pull/10033">#10033</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Avoid unnecessary utf8 conversion when creating ScriptDocValues for a string field. <ulink url="https://github.com/elastic/elasticsearch/pull/9557">#9557</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6908">#6908</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Disallow method pointer expressions in Groovy scripting <ulink url="https://github.com/elastic/elasticsearch/pull/9509">#9509</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Make _score in groovy scripts comparable <ulink url="https://github.com/elastic/elasticsearch/pull/9094">#9094</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8828">#8828</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Function score and optional weight : avg score is wrong <ulink url="https://github.com/elastic/elasticsearch/pull/9004">#9004</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8992">#8992</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return new lists on calls to getValues. <ulink url="https://github.com/elastic/elasticsearch/pull/8591">#8591</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8576">#8576</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add score() back to AbstractSearchScript <ulink url="https://github.com/elastic/elasticsearch/pull/8417">#8417</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/8377">#8377</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8416">#8416</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Clear the GroovyClassLoader cache before compiling <ulink url="https://github.com/elastic/elasticsearch/pull/8062">#8062</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7658">#7658</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8073">#8073</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE in ScriptService when script file with no extension is deleted <ulink url="https://github.com/elastic/elasticsearch/pull/7953">#7953</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7689">#7689</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Scripting: Wrap groovy script exceptions in a serializable Exception object <ulink url="https://github.com/elastic/elasticsearch/pull/6628">#6628</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6598">#6598</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove ScriptDocValues.EMPTY. <ulink url="https://github.com/elastic/elasticsearch/pull/5650">#5650</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5646">#5646</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scroll
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Append the shard top docs in such a way to prevent AOOBE <ulink url="https://github.com/elastic/elasticsearch/pull/11978">#11978</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7926">#7926</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Never cache match_all queries. <ulink url="https://github.com/elastic/elasticsearch/pull/13032">#13032</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
_all: Stop NPE querying _all when it doesn&#8217;t exist <ulink url="https://github.com/elastic/elasticsearch/pull/12495">#12495</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12439">#12439</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Free all pending search contexts if index is closed or removed <ulink url="https://github.com/elastic/elasticsearch/pull/12180">#12180</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12116">#12116</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Release search contexts after failed dfs or query phase for dfs queries <ulink url="https://github.com/elastic/elasticsearch/pull/11434">#11434</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11400">#11400</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t truncate TopDocs after rescoring <ulink url="https://github.com/elastic/elasticsearch/pull/11342">#11342</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/11277">#11277</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7707">#7707</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Matched queries: Remove redundant and broken code <ulink url="https://github.com/elastic/elasticsearch/pull/10694">#10694</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10661">#10661</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure that named filters/ queries defined in a wrapped query/filters aren&#8217;t lost <ulink url="https://github.com/elastic/elasticsearch/pull/9166">#9166</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6871">#6871</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix paging on strings sorted in ascending order. <ulink url="https://github.com/elastic/elasticsearch/pull/9157">#9157</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9136">#9136</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Terms filter lookup caching should cache values, not filters. <ulink url="https://github.com/elastic/elasticsearch/pull/9027">#9027</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/1">#1</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/2">#2</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Refactor term analysis for simple_query_string prefix queries <ulink url="https://github.com/elastic/elasticsearch/pull/8435">#8435</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use ConcurrentHashMap in SCAN search to keep track of the reader states. <ulink url="https://github.com/elastic/elasticsearch/pull/7499">#7499</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7478">#7478</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>ignore_unmapped</literal> work for sorting cross-index queries. <ulink url="https://github.com/elastic/elasticsearch/pull/7039">#7039</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2255">#2255</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Query DSL: Improved explanation for match_phrase_prefix <ulink url="https://github.com/elastic/elasticsearch/pull/6767">#6767</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2449">#2449</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
The query_string cache should returned cloned Query instances. <ulink url="https://github.com/elastic/elasticsearch/pull/6733">#6733</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/2542">#2542</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Match query with operator and, cutoff_frequency and stacked tokens <ulink url="https://github.com/elastic/elasticsearch/pull/6573">#6573</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
XFilteredQuery default strategy prefers query first in the deleted docs &#8230; <ulink url="https://github.com/elastic/elasticsearch/pull/6254">#6254</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6247">#6247</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>limit</literal> filter returns wrong results if deleted document are present [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6234">#6234</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use default forceAnalyzeQueryString if no query builder is present <ulink url="https://github.com/elastic/elasticsearch/pull/6217">#6217</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6215">#6215</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Read full message on free context <ulink url="https://github.com/elastic/elasticsearch/pull/6148">#6148</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5730">#5730</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6147">#6147</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Missing scroll id now returns 404 <ulink url="https://github.com/elastic/elasticsearch/pull/6040">#6040</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5729">#5729</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Search might not return on thread pool rejection <ulink url="https://github.com/elastic/elasticsearch/pull/6032">#6032</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4887">#4887</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Scroll api reduce phase fails if shard failures occur <ulink url="https://github.com/elastic/elasticsearch/pull/6022">#6022</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix setting of readerGen in BytesRefOrdValComparator on nested documents. <ulink url="https://github.com/elastic/elasticsearch/pull/5986">#5986</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improved SearchContext.addReleasable. <ulink url="https://github.com/elastic/elasticsearch/pull/5799">#5799</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5703">#5703</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Replace InternalSearchResponse#EMPTY with InternalSearchResponse#empty() <ulink url="https://github.com/elastic/elasticsearch/pull/5775">#5775</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
The clear scroll apis should optionally accepts a scroll_id in the request body. <ulink url="https://github.com/elastic/elasticsearch/pull/5734">#5734</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5726">#5726</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure successful operations are correct if second search phase is fast <ulink url="https://github.com/elastic/elasticsearch/pull/5713">#5713</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not propagate errors from onResult to onFailure. <ulink url="https://github.com/elastic/elasticsearch/pull/5629">#5629</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix IndexShardRoutingTable&#8217;s shard randomization to not throw out-of-bounds exceptions. <ulink url="https://github.com/elastic/elasticsearch/pull/5561">#5561</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5559">#5559</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Convert TermQuery to PrefixQuery if PHRASE_PREFIX is set <ulink url="https://github.com/elastic/elasticsearch/pull/5553">#5553</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5551">#5551</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use patched version of TermsFilter to prevent using wrong cached results <ulink url="https://github.com/elastic/elasticsearch/pull/5393">#5393</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5363">#5363</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix SearchContext occasionally closed prematurely  <ulink url="https://github.com/elastic/elasticsearch/pull/5170">#5170</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5165">#5165</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Exposed shard id related to a failure in delete by query <ulink url="https://github.com/elastic/elasticsearch/pull/5125">#5125</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5095">#5095</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix AndDocIdSet#IteratorBasedIterator to not violate initial doc state <ulink url="https://github.com/elastic/elasticsearch/pull/5070">#5070</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5049">#5049</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Search Templates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix JSON encoding for Mustache templates. <ulink url="https://github.com/elastic/elasticsearch/pull/10820">#10820</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5473">#5473</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ensure internal scope extrators are always operating on a Map <ulink url="https://github.com/elastic/elasticsearch/pull/6326">#6326</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6318">#6318</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix TemplateQueryParser swallows additional parameters <ulink url="https://github.com/elastic/elasticsearch/pull/5933">#5933</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Made template endpoint compatible with search endpoint <ulink url="https://github.com/elastic/elasticsearch/pull/5619">#5619</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5550">#5550</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Settings
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Do not swallow exceptions thrown while parsing settings <ulink url="https://github.com/elastic/elasticsearch/pull/13039">#13039</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/13028">#13028</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add explicit check that we have reached the end of the settings stream when parsing settings <ulink url="https://github.com/elastic/elasticsearch/pull/12451">#12451</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12382">#12382</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Medium Interval time for ResourceWatcher should be 30 seconds <ulink url="https://github.com/elastic/elasticsearch/pull/12423">#12423</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Copy the classloader from the original settings when checking for prompts <ulink url="https://github.com/elastic/elasticsearch/pull/12419">#12419</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12340">#12340</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Replace references to ImmutableSettings with Settings <ulink url="https://github.com/elastic/elasticsearch/pull/11843">#11843</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Do not prompt for node name twice <ulink url="https://github.com/elastic/elasticsearch/pull/11668">#11668</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11564">#11564</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Always normalize root paths during resolution of paths <ulink url="https://github.com/elastic/elasticsearch/pull/11446">#11446</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11426">#11426</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Prevent changing the number of replicas on a closed index <ulink url="https://github.com/elastic/elasticsearch/pull/11410">#11410</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9566">#9566</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Read configuration file with .yaml suffix <ulink url="https://github.com/elastic/elasticsearch/pull/10909">#10909</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9706">#9706</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Validate number_of_shards/_replicas without index setting prefix <ulink url="https://github.com/elastic/elasticsearch/pull/10701">#10701</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10693">#10693</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix handling of IndicesOptions in update settings REST API <ulink url="https://github.com/elastic/elasticsearch/pull/10030">#10030</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Reset TieredMP settings only if the value actually changed <ulink url="https://github.com/elastic/elasticsearch/pull/9497">#9497</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8890">#8890</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
<literal>cluster.routing.allocation.disk.threshold_enabled</literal> accepts wrong values [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/9309">#9309</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure fields are overriden and not merged when using arrays <ulink url="https://github.com/elastic/elasticsearch/pull/8381">#8381</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6887">#6887</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Tab characters in YAML should throw an exception <ulink url="https://github.com/elastic/elasticsearch/pull/8355">#8355</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8259">#8259</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Dynamic changes to <literal>max_merge_count</literal> are now picked up by index throttling <ulink url="https://github.com/elastic/elasticsearch/pull/8136">#8136</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8132">#8132</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Validate create index requests' number of primary/replica shards <ulink url="https://github.com/elastic/elasticsearch/pull/7496">#7496</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7495">#7495</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
LogConfigurator resolveConfig  also reads .rpmnew or .bak files <ulink url="https://github.com/elastic/elasticsearch/pull/7457">#7457</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix bug in PropertyPlaceholder and add unit tests <ulink url="https://github.com/elastic/elasticsearch/pull/6034">#6034</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Shadow Replicas
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fail engine without marking it as corrupt when recovering on SharedFS <ulink url="https://github.com/elastic/elasticsearch/pull/11933">#11933</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11788">#11788</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Snapshot/Restore
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Improve repository verification failure message <ulink url="https://github.com/elastic/elasticsearch/pull/11925">#11925</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11922">#11922</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve logging of repository verification exceptions. <ulink url="https://github.com/elastic/elasticsearch/pull/11763">#11763</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11760">#11760</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Blob store shouldn&#8217;t try deleting the write.lock file at the end of the restore process <ulink url="https://github.com/elastic/elasticsearch/pull/11517">#11517</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Move in-progress snapshot and restore information from custom metadata to custom cluster state part <ulink url="https://github.com/elastic/elasticsearch/pull/11486">#11486</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8102">#8102</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Sync up snapshot shard status on a master restart <ulink url="https://github.com/elastic/elasticsearch/pull/11450">#11450</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11314">#11314</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix cluster state task name for update snapshot task <ulink url="https://github.com/elastic/elasticsearch/pull/11197">#11197</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t reuse source index UUID on restore <ulink url="https://github.com/elastic/elasticsearch/pull/10367">#10367</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Separate repository registration <ulink url="https://github.com/elastic/elasticsearch/pull/10354">#10354</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10351">#10351</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Automatically add "index." prefix to the settings are changed on restore if the prefix is missing <ulink url="https://github.com/elastic/elasticsearch/pull/10269">#10269</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10133">#10133</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete operation should ignore finalizing shards on nodes that no longer exist <ulink url="https://github.com/elastic/elasticsearch/pull/9981">#9981</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9924">#9924</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow deletion of snapshots with corrupted snapshot files <ulink url="https://github.com/elastic/elasticsearch/pull/9569">#9569</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9534">#9534</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Better handling of index deletion during snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/9418">#9418</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9024">#9024</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add validation of restored persistent settings <ulink url="https://github.com/elastic/elasticsearch/pull/9051">#9051</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8830">#8830</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Improve snapshot creation and deletion performance on repositories with large number of snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/8969">#8969</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8958">#8958</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Switch to write once mode for snapshot metadata files <ulink url="https://github.com/elastic/elasticsearch/pull/8782">#8782</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8696">#8696</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restore with <literal>wait_for_completion:true</literal> should wait for succesfully restored shards to get started <ulink url="https://github.com/elastic/elasticsearch/pull/8545">#8545</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8340">#8340</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Keep the last legacy checksums file at the end of restore <ulink url="https://github.com/elastic/elasticsearch/pull/8358">#8358</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8119">#8119</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Restore of indices that are only partially available in the cluster <ulink url="https://github.com/elastic/elasticsearch/pull/8341">#8341</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8224">#8224</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix snapshotting of a single closed index <ulink url="https://github.com/elastic/elasticsearch/pull/8047">#8047</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8046">#8046</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make it possible to delete snapshots with missing metadata file <ulink url="https://github.com/elastic/elasticsearch/pull/7981">#7981</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7980">#7980</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make sure indices cannot be renamed into restored aliases <ulink url="https://github.com/elastic/elasticsearch/pull/7918">#7918</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7915">#7915</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Allow to get metadata from arbitrary commit points <ulink url="https://github.com/elastic/elasticsearch/pull/7376">#7376</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Improve recovery / snapshot restoring file identity handling <ulink url="https://github.com/elastic/elasticsearch/pull/7351">#7351</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE in SnapshotsService on node shutdown <ulink url="https://github.com/elastic/elasticsearch/pull/7322">#7322</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6506">#6506</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail restore if snapshot is corrupted <ulink url="https://github.com/elastic/elasticsearch/pull/6938">#6938</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add ability to snapshot replicating primary shards <ulink url="https://github.com/elastic/elasticsearch/pull/6139">#6139</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5531">#5531</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix for hanging aborted snapshot during node shutdown <ulink url="https://github.com/elastic/elasticsearch/pull/5966">#5966</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5958">#5958</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix snapshot status with empty repository <ulink url="https://github.com/elastic/elasticsearch/pull/5791">#5791</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5790">#5790</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Add retry mechanism to get snapshot method <ulink url="https://github.com/elastic/elasticsearch/pull/5411">#5411</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restore of an existing index using rename doesn&#8217;t completly open the index after restore [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5212">#5212</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Restore process should replace the mapping and settings if index already exists <ulink url="https://github.com/elastic/elasticsearch/pull/5211">#5211</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5210">#5210</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Handle "true"/"false" in snapshot api for "include_global_state" <ulink url="https://github.com/elastic/elasticsearch/pull/4956">#4956</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4949">#4949</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Stats
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Use time with nanosecond resolution calculated at the executing node <ulink url="https://github.com/elastic/elasticsearch/pull/12346">#12346</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12345">#12345</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Failure during the fetch phase of scan should invoke the failed fetch… <ulink url="https://github.com/elastic/elasticsearch/pull/12087">#12087</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12086">#12086</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix wrong reused file bytes in Recovery API reports <ulink url="https://github.com/elastic/elasticsearch/pull/11965">#11965</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11876">#11876</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix RecoveryState timestamps <ulink url="https://github.com/elastic/elasticsearch/pull/11871">#11871</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11870">#11870</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Translog: stats fail to serialize size <ulink url="https://github.com/elastic/elasticsearch/pull/10105">#10105</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Translog: make sure stats&#8217;s op count and size are in sync <ulink url="https://github.com/elastic/elasticsearch/pull/10041">#10041</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix open file descriptors count on Windows <ulink url="https://github.com/elastic/elasticsearch/pull/9397">#9397</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1563">#1563</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Relax restrictions on filesystem size reporting in DiskUsage <ulink url="https://github.com/elastic/elasticsearch/pull/9283">#9283</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/9249">#9249</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/9260">#9260</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix wrong search stats groups in indices API <ulink url="https://github.com/elastic/elasticsearch/pull/8950">#8950</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7644">#7644</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix Bloom filter ram usage calculation <ulink url="https://github.com/elastic/elasticsearch/pull/8584">#8584</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8564">#8564</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Filter indices stats for translog <ulink url="https://github.com/elastic/elasticsearch/pull/8263">#8263</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8262">#8262</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Stats: _status with #shards &gt;&gt; queue capacity failing with BroadcastShardOperationFailedException [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7916">#7916</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update action returns before updating stats for <literal>NONE</literal> operations <ulink url="https://github.com/elastic/elasticsearch/pull/7639">#7639</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NPE in ShardStats when routing entry is not set yet on IndexShard <ulink url="https://github.com/elastic/elasticsearch/pull/7358">#7358</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7356">#7356</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Recovery API should also report ongoing relocation recoveries <ulink url="https://github.com/elastic/elasticsearch/pull/6585">#6585</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Indices stats options <ulink url="https://github.com/elastic/elasticsearch/pull/6390">#6390</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix recovery percentage &gt; 100% <ulink url="https://github.com/elastic/elasticsearch/pull/6138">#6138</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6113">#6113</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Disabled query size estimation in percolator <ulink url="https://github.com/elastic/elasticsearch/pull/5372">#5372</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5339">#5339</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Use num of actual threads if busiestThreads is larger <ulink url="https://github.com/elastic/elasticsearch/pull/4928">#4928</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4927">#4927</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Store
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Ensure we mark store as corrupted if we fail to read the segments info <ulink url="https://github.com/elastic/elasticsearch/pull/11230">#11230</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11226">#11226</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fix NPE when checking for active shards before deletion <ulink url="https://github.com/elastic/elasticsearch/pull/11110">#11110</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10172">#10172</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Shard not deleted after relocation if relocated shard is still in post recovery <ulink url="https://github.com/elastic/elasticsearch/pull/10172">#10172</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10018">#10018</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only ack index store deletion on data nodes <ulink url="https://github.com/elastic/elasticsearch/pull/9672">#9672</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9605">#9605</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Only fail recovery if files are inconsistent <ulink url="https://github.com/elastic/elasticsearch/pull/8779">#8779</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Use Lucene checksums if segment version is &gt;= 4.9.0 <ulink url="https://github.com/elastic/elasticsearch/pull/8599">#8599</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8587">#8587</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Calculate Alder32 Checksums for legacy files in Store#checkIntegrity <ulink url="https://github.com/elastic/elasticsearch/pull/8407">#8407</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Add BWC layer to .si / segments_N hashing to identify segments accurately <ulink url="https://github.com/elastic/elasticsearch/pull/7436">#7436</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/7351">#7351</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7434">#7434</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ignore segments.gen on metadata snapshots <ulink url="https://github.com/elastic/elasticsearch/pull/7379">#7379</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
DistributorDirectory shouldn&#8217;t search for directory when reading existing file <ulink url="https://github.com/elastic/elasticsearch/pull/7323">#7323</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7306">#7306</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Delete unallocated shards under a cluster state task <ulink url="https://github.com/elastic/elasticsearch/pull/6902">#6902</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Searcher might not be closed if store hande can&#8217;t be obtained <ulink url="https://github.com/elastic/elasticsearch/pull/5884">#5884</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Suggesters
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Prevent DirectCandidateGenerator to reuse an unclosed analyzer <ulink url="https://github.com/elastic/elasticsearch/pull/12670">#12670</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Ensure empty string completion inputs are not indexed <ulink url="https://github.com/elastic/elasticsearch/pull/11158">#11158</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10987">#10987</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Ensure collate option in PhraseSuggester only collates on local shard <ulink url="https://github.com/elastic/elasticsearch/pull/11156">#11156</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9377">#9377</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make GeoContext mapping idempotent <ulink url="https://github.com/elastic/elasticsearch/pull/10602">#10602</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/10581">#10581</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/8937">#8937</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Return an HTTP error code when a suggest request failed instead of 200 <ulink url="https://github.com/elastic/elasticsearch/pull/10104">#10104</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix CompletionFieldMapper to correctly parse weight <ulink url="https://github.com/elastic/elasticsearch/pull/8197">#8197</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8090">#8090</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Infinite loop in GeolocationContextMapping [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7433">#7433</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Bugs with encoding multiple levels of geo precision <ulink url="https://github.com/elastic/elasticsearch/pull/7369">#7369</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7368">#7368</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Completion mapping type throws a misleading error on null value <ulink url="https://github.com/elastic/elasticsearch/pull/6926">#6926</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6399">#6399</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Tie-break suggestions by term <ulink url="https://github.com/elastic/elasticsearch/pull/5978">#5978</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix Lucene&#8217;s getFiniteStrings to not consume Java stack <ulink url="https://github.com/elastic/elasticsearch/pull/5927">#5927</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Geo context suggester: Require precision in mapping <ulink url="https://github.com/elastic/elasticsearch/pull/5647">#5647</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5621">#5621</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ContextSuggester: Adding couple of tests to catch more bugs <ulink url="https://github.com/elastic/elasticsearch/pull/5596">#5596</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5525">#5525</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Category type should be called "category" instead of "field" in context suggester <ulink url="https://github.com/elastic/elasticsearch/pull/5469">#5469</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Two bugfixes for the completion format <ulink url="https://github.com/elastic/elasticsearch/pull/4973">#4973</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
marvel.agent Background thread had an uncaught exception: java.lang.NullPointerException [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4970">#4970</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
NullPointerException (NPE) in completion suggester requests [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/4788">#4788</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Term Vectors
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Make sure filter is correctly parsed for multi-term vectors <ulink url="https://github.com/elastic/elasticsearch/pull/12312">#12312</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12311">#12311</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
ShardTermVectorsService calls docFreq() on unpositioned TermsEnum [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/10660">#10660</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Top Hits
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Protected against  <literal>size</literal> and <literal>offset</literal> larger than total number of document in a shard <ulink url="https://github.com/elastic/elasticsearch/pull/12518">#12518</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/12510">#12510</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Inconsistent sorting of top_hits fixed [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/7697">#7697</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Properly support top_hits aggregation in a nested and reverse_nested aggregations. <ulink url="https://github.com/elastic/elasticsearch/pull/7164">#7164</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/3022">#3022</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Make <literal>_source</literal> parsing in <literal>top_hits</literal> aggregation consistent with the search api  <ulink url="https://github.com/elastic/elasticsearch/pull/6997">#6997</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Track scores should be applied properly for <literal>top_hits</literal> aggregation. <ulink url="https://github.com/elastic/elasticsearch/pull/6934">#6934</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Translog
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Ignore EngineClosedException during translog fysnc <ulink url="https://github.com/elastic/elasticsearch/pull/12384">#12384</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Don&#8217;t convert possibly corrupted bytes to UTF-8 <ulink url="https://github.com/elastic/elasticsearch/pull/11911">#11911</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Mark translog as upgraded in the engine even if a legacy generation exists <ulink url="https://github.com/elastic/elasticsearch/pull/11860">#11860</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/11858">#11858</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Fail #snapshot if translog is closed <ulink url="https://github.com/elastic/elasticsearch/pull/10809">#10809</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10807">#10807</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Translog leaks filehandles if it&#8217;s corrupted or truncated <ulink url="https://github.com/elastic/elasticsearch/pull/8372">#8372</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Better support for partial buffer reads/writes in translog infrastructure <ulink url="https://github.com/elastic/elasticsearch/pull/6576">#6576</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6441">#6441</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Lower the translog flush triggers to workaround #6363 [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/6377">#6377</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Tribe Node
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
System properties and configuration settings must not be forwarded to tribe clients <ulink url="https://github.com/elastic/elasticsearch/pull/9721">#9721</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9576">#9576</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Remove closed indices from cluster state <ulink url="https://github.com/elastic/elasticsearch/pull/9334">#9334</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix possible NPE in TribeNodeService <ulink url="https://github.com/elastic/elasticsearch/pull/5645">#5645</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5643">#5643</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Blocking writes on a tribe node creates a "blocks" tribe [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5389">#5389</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Upgrade API
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Fix version check in bytes to upgrade that spans major versions <ulink url="https://github.com/elastic/elasticsearch/pull/9340">#9340</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Fix upgrade logic to check for major version bump. <ulink url="https://github.com/elastic/elasticsearch/pull/8013">#8013</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="regression-2.0.0-beta1" renderas="sect2">Regressions<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
CRUD
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Indexing a document fails when setting <literal>version=0</literal> &amp;  <literal>version_type=external</literal> [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5662">#5662</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Switch back to ConcurrentMergeScheduler as the default [ISSUE] <ulink url="https://github.com/elastic/elasticsearch/pull/5817">#5817</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Discovery
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Restore preference to latest unicast pings describing the same node <ulink url="https://github.com/elastic/elasticsearch/pull/7702">#7702</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5413">#5413</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/7558">#7558</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Internal
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Restore streamInput() performance over PagedBytesReference. <ulink url="https://github.com/elastic/elasticsearch/pull/5589">#5589</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Mapping
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Mapping With a <literal>null</literal> Default Timestamp Causes NullPointerException on Merge <ulink url="https://github.com/elastic/elasticsearch/pull/9205">#9205</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/9204">#9204</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Object and Type parsing: Fix include_in_all in type <ulink url="https://github.com/elastic/elasticsearch/pull/6353">#6353</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/6093">#6093</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/6304">#6304</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Only resolve host if explicitly allowed. <ulink url="https://github.com/elastic/elasticsearch/pull/12986">#12986</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
<bridgehead id="upgrade-2.0.0-beta1" renderas="sect2">Upgrades<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/release-notes/2.0.0-beta1.asciidoc">Edit me</ulink></bridgehead>
<variablelist>
<varlistentry>
<term>
Core
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to Lucene 5.2.1. <ulink url="https://github.com/elastic/elasticsearch/pull/11662">#11662</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 5.2 <ulink url="https://github.com/elastic/elasticsearch/pull/11534">#11534</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Jackson to 2.5.3 <ulink url="https://github.com/elastic/elasticsearch/pull/11307">#11307</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.2.0-snapshot-1681024 <ulink url="https://github.com/elastic/elasticsearch/pull/11296">#11296</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.2.0-snapshot-1680200. <ulink url="https://github.com/elastic/elasticsearch/pull/11218">#11218</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.2.0-snapshot-1678978. <ulink url="https://github.com/elastic/elasticsearch/pull/11125">#11125</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to HPPC 0.7.1 <ulink url="https://github.com/elastic/elasticsearch/pull/11035">#11035</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.2-snapshot-1675363. <ulink url="https://github.com/elastic/elasticsearch/pull/10727">#10727</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/10728">#10728</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 5.2 r1675100 <ulink url="https://github.com/elastic/elasticsearch/pull/10699">#10699</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene-5.2-snapshot-1674183. <ulink url="https://github.com/elastic/elasticsearch/pull/10641">#10641</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 5.2 r1673726 <ulink url="https://github.com/elastic/elasticsearch/pull/10612">#10612</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.2.0-snapshot-1673124. <ulink url="https://github.com/elastic/elasticsearch/pull/10562">#10562</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update forbiddenapis to version 1.8 <ulink url="https://github.com/elastic/elasticsearch/pull/10555">#10555</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.1.0-snapshot-1671894. <ulink url="https://github.com/elastic/elasticsearch/pull/10468">#10468</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update to Lucene 5.1 snapshot r1671277 <ulink url="https://github.com/elastic/elasticsearch/pull/10435">#10435</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Jackson 2.5.1 <ulink url="https://github.com/elastic/elasticsearch/pull/10210">#10210</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Jackson 2.5.1 <ulink url="https://github.com/elastic/elasticsearch/pull/10134">#10134</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene r1662607 <ulink url="https://github.com/elastic/elasticsearch/pull/9915">#9915</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/1">#1</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene r1660560 <ulink url="https://github.com/elastic/elasticsearch/pull/9746">#9746</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene snapshot r1656366 <ulink url="https://github.com/elastic/elasticsearch/pull/9524">#9524</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/8870">#8870</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene r1654549 snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/9402">#9402</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene-5.1.0-snapshot-1652032. <ulink url="https://github.com/elastic/elasticsearch/pull/9318">#9318</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to lucene 5 r1650327 <ulink url="https://github.com/elastic/elasticsearch/pull/9206">#9206</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to current Lucene 5.0.0 snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/8588">#8588</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade master to lucene 5.0 snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/8347">#8347</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Jackson 2.4.2 <ulink url="https://github.com/elastic/elasticsearch/pull/7934">#7934</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7932">#7932</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.10.1 snapshot <ulink url="https://github.com/elastic/elasticsearch/pull/7844">#7844</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7905">#7905</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Guava to 18.0. <ulink url="https://github.com/elastic/elasticsearch/pull/7593">#7593</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/6268">#6268</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.10 <ulink url="https://github.com/elastic/elasticsearch/pull/7584">#7584</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Version bump HPPC to 0.6.0 <ulink url="https://github.com/elastic/elasticsearch/pull/7139">#7139</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade Jackson to 2.4.1 <ulink url="https://github.com/elastic/elasticsearch/pull/6757">#6757</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.9 <ulink url="https://github.com/elastic/elasticsearch/pull/6623">#6623</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Guava 17 <ulink url="https://github.com/elastic/elasticsearch/pull/5953">#5953</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.8.0 <ulink url="https://github.com/elastic/elasticsearch/pull/5932">#5932</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update forbidden-apis to 1.5.1 and remove the relaxed failOnMissingClasses setting, fix typo <ulink url="https://github.com/elastic/elasticsearch/pull/5863">#5863</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.7.2 <ulink url="https://github.com/elastic/elasticsearch/pull/5802">#5802</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update JNA to 4.1.0, properly warn on error, hint at noexec mount <ulink url="https://github.com/elastic/elasticsearch/pull/5636">#5636</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5493">#5493</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.7.1 <ulink url="https://github.com/elastic/elasticsearch/pull/5635">#5635</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update to forbidden-apis 1.4.1 <ulink url="https://github.com/elastic/elasticsearch/pull/5495">#5495</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5492">#5492</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Move master to Java 1.7 <ulink url="https://github.com/elastic/elasticsearch/pull/5268">#5268</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/5267">#5267</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Lucene 4.6.1 <ulink url="https://github.com/elastic/elasticsearch/pull/4898">#4898</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/4897">#4897</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Dates
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update joda-time to v2.7 <ulink url="https://github.com/elastic/elasticsearch/pull/9610">#9610</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Geo
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade to Spatial4j 0.4.1 and JTS 1.13 <ulink url="https://github.com/elastic/elasticsearch/pull/5336">#5336</ulink> (issues: <ulink url="https://github.com/elastic/elasticsearch/issues/5279">#5279</ulink>, <ulink url="https://github.com/elastic/elasticsearch/issues/5286">#5286</ulink>)
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Network
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Update Netty to version 3.10.3.Final <ulink url="https://github.com/elastic/elasticsearch/pull/12310">#12310</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Netty 3.10.3 <ulink url="https://github.com/elastic/elasticsearch/pull/11304">#11304</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade netty to 3.10.0.Final <ulink url="https://github.com/elastic/elasticsearch/pull/9132">#9132</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Apache HttpComponents client 4.3.5 <ulink url="https://github.com/elastic/elasticsearch/pull/7346">#7346</ulink> (issue: <ulink url="https://github.com/elastic/elasticsearch/issues/7342">#7342</ulink>)
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to Netty 3.9.3.Final <ulink url="https://github.com/elastic/elasticsearch/pull/7328">#7328</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Upgrade to netty 3.9.1 <ulink url="https://github.com/elastic/elasticsearch/pull/6331">#6331</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
<varlistentry>
<term>
Scripting
</term>
<listitem>
<itemizedlist>
<listitem>
<simpara>
Upgrade groovy from 2.4.0 to 2.4.4 <ulink url="https://github.com/elastic/elasticsearch/pull/12288">#12288</ulink>
</simpara>
</listitem>
<listitem>
<simpara>
Update Groovy dependency to 2.4.0 <ulink url="https://github.com/elastic/elasticsearch/pull/9520">#9520</ulink>
</simpara>
</listitem>
</itemizedlist>
</listitem>
</varlistentry>
</variablelist>
</chapter>
</part>
<appendix id="redirects" role="exclude">
<title>Deleted pages<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The following pages have moved or been deleted.</simpara>
<section id="cluster-nodes-shutdown" role="exclude">
<title>Nodes shutdown<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_shutdown</literal> API has been removed.  Instead, setup Elasticsearch to run as
a service (see <xref linkend="setup-service"/> or <xref linkend="setup-service-win"/>) or use the <literal>-p</literal>
command line option to <link linkend="setup-installation-pid">write the PID to a file</link>.</simpara>
</section>
<section id="docs-bulk-udp" role="exclude">
<title>Bulk UDP API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The Bulk UDP services has been removed.  Use the standard <xref linkend="docs-bulk"/> instead.</simpara>
</section>
<section id="indices-delete-mapping" role="exclude">
<title>Delete Mapping<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>It is no longer possible to delete the mapping for a type. Instead you should
<link linkend="indices-delete-index">delete the index</link> and recreate it with the new mappings.</simpara>
</section>
<section id="indices-status" role="exclude">
<title>Index Status<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The  index <literal>_status</literal> API has been replaced with the <xref linkend="indices-stats"/> and
<xref linkend="indices-recovery"/> APIs.</simpara>
</section>
<section id="mapping-analyzer-field" role="exclude">
<title><literal>_analyzer</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_analyzer</literal> field in type mappings is no longer supported and will be
automatically removed from mappings when upgrading to 2.x.</simpara>
</section>
<section id="mapping-boost-field" role="exclude">
<title><literal>_boost</literal><ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>_boost</literal> field in type mappings is no longer supported and will be
automatically removed from mappings when upgrading to 2.x.</simpara>
</section>
<section id="mapping-conf-mappings" role="exclude">
<title>Config mappings<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>It is no longer possible to specify mappings in files in the <literal>config</literal>
directory.  Instead, mappings should be created using the API with:</simpara>
<itemizedlist>
<listitem>
<simpara>
<xref linkend="indices-create-index"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-put-mapping"/>
</simpara>
</listitem>
<listitem>
<simpara>
<xref linkend="indices-templates"/>
</simpara>
</listitem>
</itemizedlist>
</section>
<section id="modules-memcached" role="exclude">
<title>memcached<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>memcached</literal> transport is no longer supported.  Instead use the REST
interface over <link linkend="modules-http">HTTP</link> or the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/index.html">Java API</ulink>.</simpara>
</section>
<section id="modules-thrift" role="exclude">
<title>Thrift<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>thrift</literal> transport is no longer supported.  Instead use the REST
interface over <link linkend="modules-http">HTTP</link> or the
<ulink url="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/index.html">Java API</ulink>.</simpara>
<remark> QUERY DSL</remark>
</section>
<section id="query-dsl-queries" role="exclude">
<title>Queries<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Queries and filters have been merged.  Any query clause can now be used as a query
in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-filters" role="exclude">
<title>Filters<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Queries and filters have been merged.  Any query clause can now be used as a query
in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-and-filter" role="exclude">
<title>And Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>and</literal> filter has been replaced by the <xref linkend="query-dsl-and-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-or-filter" role="exclude">
<title>Or Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>or</literal> filter has been replaced by the <xref linkend="query-dsl-or-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-not-filter" role="exclude">
<title>Not Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>not</literal> filter has been replaced by the <xref linkend="query-dsl-not-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-bool-filter" role="exclude">
<title>Bool Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>bool</literal> filter has been replaced by the <xref linkend="query-dsl-bool-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-exists-filter" role="exclude">
<title>Exists Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>exists</literal> filter has been replaced by the <xref linkend="query-dsl-exists-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-missing-filter" role="exclude">
<title>Missing Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>missing</literal> filter has been replaced by the <xref linkend="query-dsl-missing-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geo-bounding-box-filter" role="exclude">
<title>Geo Bounding Box Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_bounding_box</literal> filter has been replaced by the <xref linkend="query-dsl-geo-bounding-box-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geo-distance-filter" role="exclude">
<title>Geo Distance Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_distance</literal> filter has been replaced by the <xref linkend="query-dsl-geo-distance-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geo-distance-range-filter" role="exclude">
<title>Geo Distance Range Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_distance_range</literal> filter has been replaced by the <xref linkend="query-dsl-geo-distance-range-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geo-polygon-filter" role="exclude">
<title>Geo Polygon Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_polygon</literal> filter has been replaced by the <xref linkend="query-dsl-geo-polygon-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geo-shape-filter" role="exclude">
<title>Geo Shape Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geo_shape</literal> filter has been replaced by the <xref linkend="query-dsl-geo-shape-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-geohash-cell-filter" role="exclude">
<title>Geohash Cell Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>geohash_cell</literal> filter has been replaced by the <xref linkend="query-dsl-geohash-cell-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-has-child-filter" role="exclude">
<title>Has Child Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>has_child</literal> filter has been replaced by the <xref linkend="query-dsl-has-child-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-has-parent-filter" role="exclude">
<title>Has Parent Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>has_parent</literal> filter has been replaced by the <xref linkend="query-dsl-has-parent-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-top-children-query" role="exclude">
<title>Top Children Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>top_children</literal> query has been removed. Use the <xref linkend="query-dsl-has-child-query"/> instead.</simpara>
</section>
<section id="query-dsl-ids-filter" role="exclude">
<title>IDs Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>ids</literal> filter has been replaced by the <xref linkend="query-dsl-ids-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-indices-filter" role="exclude">
<title>Indices Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>indices</literal> filter has been replaced by the <xref linkend="query-dsl-indices-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-limit-filter" role="exclude">
<title>Limit Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>limit</literal> filter has been replaced by the <xref linkend="query-dsl-limit-query"/>.
It behaves as a query in &#8220;query context&#8221; and as a filter in &#8220;filter
context&#8221; (see <xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-match-all-filter" role="exclude">
<title>Match All Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>match_all</literal> filter has been replaced by the <xref linkend="query-dsl-match-all-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-nested-filter" role="exclude">
<title>Nested Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>nested</literal> filter has been replaced by the <xref linkend="query-dsl-nested-query"/>.  It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-prefix-filter" role="exclude">
<title>Prefix Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>prefix</literal> filter has been replaced by the <xref linkend="query-dsl-prefix-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-query-filter" role="exclude">
<title>Query Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>query</literal> filter has been removed as queries and filters have been merged (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-range-filter" role="exclude">
<title>Range Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>range</literal> filter has been replaced by the <xref linkend="query-dsl-range-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-regexp-filter" role="exclude">
<title>Regexp Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>regexp</literal> filter has been replaced by the <xref linkend="query-dsl-regexp-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-script-filter" role="exclude">
<title>Script Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>script</literal> filter has been replaced by the <xref linkend="query-dsl-script-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-term-filter" role="exclude">
<title>Term Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>term</literal> filter has been replaced by the <xref linkend="query-dsl-term-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-terms-filter" role="exclude">
<title>Terms Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>terms</literal> filter has been replaced by the <xref linkend="query-dsl-terms-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-type-filter" role="exclude">
<title>Type Filter<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>type</literal> filter has been replaced by the <xref linkend="query-dsl-type-query"/>. It behaves
as a query in &#8220;query context&#8221; and as a filter in &#8220;filter context&#8221; (see
<xref linkend="query-dsl"/>).</simpara>
</section>
<section id="query-dsl-flt-query" role="exclude">
<title>Fuzzy Like This Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>fuzzy_like_this</literal> or <literal>flt</literal> query has been removed.  Instead use
the <link linkend="query-dsl-match-query-fuzziness"><literal>fuzziness</literal></link> parameter with the
<link linkend="query-dsl-match-query"><literal>match</literal> query</link> or the <xref linkend="query-dsl-mlt-query"/>.</simpara>
</section>
<section id="query-dsl-flt-field-query" role="exclude">
<title>Fuzzy Like This Field Query<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The <literal>fuzzy_like_this_field</literal> or <literal>flt_field</literal> query has been removed.  Instead use
the <link linkend="query-dsl-match-query-fuzziness"><literal>fuzziness</literal></link> parameter with the
<link linkend="query-dsl-match-query"><literal>match</literal> query</link> or the <xref linkend="query-dsl-mlt-query"/>.</simpara>
</section>
<section id="search-more-like-this" role="exclude">
<title>More Like This API<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The More Like This API has been removed. Instead, use the <xref linkend="query-dsl-mlt-query"/>.</simpara>
<remark> FACETS</remark>
</section>
<section id="search-facets" role="exclude">
<title>Facets<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Faceted search refers to a way to explore large amounts of data by displaying
summaries about various partitions of the data and later allowing to narrow
the navigation to a specific partition.</simpara>
<simpara>In Elasticsearch, <literal>facets</literal> are also the name of a feature that allowed to
compute these summaries. <literal>facets</literal> have been replaced by
<link linkend="search-aggregations">aggregations</link> in Elasticsearch 1.0, which are a superset
of facets.</simpara>
</section>
<section id="search-facets-filter-facet" role="exclude">
<title>Filter Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-filter-aggregation"><literal>filter</literal> aggregation</link> or
<link linkend="search-aggregations-bucket-filters-aggregation"><literal>filters</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-query-facet" role="exclude">
<title>Query Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-filter-aggregation"><literal>filter</literal> aggregation</link> or
<link linkend="search-aggregations-bucket-filters-aggregation"><literal>filters</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-geo-distance-facet" role="exclude">
<title>Geo Distance Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-geodistance-aggregation"><literal>geo_distance</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-histogram-facet" role="exclude">
<title>Histogram Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-histogram-aggregation"><literal>histogram</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-date-histogram-facet" role="exclude">
<title>Date Histogram Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-datehistogram-aggregation"><literal>date_histogram</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-range-facet" role="exclude">
<title>Range Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-range-aggregation"><literal>range</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-terms-facet" role="exclude">
<title>Terms Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-terms-aggregation"><literal>terms</literal> aggregation</link> instead.</simpara>
</section>
<section id="search-facets-terms-statistical-facet" role="exclude">
<title>Terms Stats Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-bucket-terms-aggregation"><literal>terms</literal> aggregation</link>
with the <link linkend="search-aggregations-metrics-stats-aggregation"><literal>stats</literal> aggregation</link>
or the <link linkend="search-aggregations-metrics-extendedstats-aggregation"><literal>extended_stats</literal> aggregation</link>
instead.</simpara>
</section>
<section id="search-facets-statistical-facet" role="exclude">
<title>Statistical Facet<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use the
<link linkend="search-aggregations-metrics-stats-aggregation"><literal>stats</literal> aggregation</link>
or the <link linkend="search-aggregations-metrics-extendedstats-aggregation"><literal>extended_stats</literal> aggregation</link>  instead.</simpara>
</section>
<section id="search-facets-migrating-to-aggs" role="exclude">
<title>Migrating from facets to aggregations<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>Facets have been removed. Use <xref linkend="search-aggregations"/> instead.</simpara>
<remark> CACHES</remark>
</section>
<section id="shard-query-cache" role="exclude">
<title>Shard request cache<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The shard query cache has been renamed <xref linkend="shard-request-cache"/>.</simpara>
</section>
<section id="filter-cache" role="exclude">
<title>Query cache<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The filter cache has been renamed <xref linkend="query-cache"/>.</simpara>
</section>
<section id="mapping-nested-type" role="exclude">
<title>Nested type<ulink role="edit_me" url="/mnt/docs/docs/.repos/.temp/ex7kJP1Kj0/docs/reference/redirects.asciidoc">Edit me</ulink></title>
<simpara>The docs for the <literal>nested</literal> field datatype have moved to <xref linkend="nested"/>.</simpara>
</section>
</appendix>
</book>
