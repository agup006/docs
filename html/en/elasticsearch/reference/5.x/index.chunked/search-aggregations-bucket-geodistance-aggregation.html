<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Geo Distance Aggregation
        | Elasticsearch Reference [5.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.x]" /><link rel="up" href="search-aggregations-bucket.html" title="Bucket Aggregations" /><link rel="prev" href="search-aggregations-bucket-filters-aggregation.html" title="Filters Aggregation" /><link rel="next" href="search-aggregations-bucket-geohashgrid-aggregation.html" title="GeoHash grid Aggregation" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.x" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.x]
    </a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-link"><a href="search-aggregations-bucket.html">Bucket Aggregations</a></span> » <span class="breadcrumb-node">Geo Distance Aggregation</span></div><div xmlns="" class="navheader"><span class="prev"><a href="search-aggregations-bucket-filters-aggregation.html">
              « 
              Filters Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-geodistance-aggregation"></a>Geo Distance Aggregation<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.x/docs/reference/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket aggregation that works on <code class="literal">geo_point</code> fields and conceptually works very similar to the <a class="link" href="search-aggregations-bucket-range-aggregation.html" title="Range Aggregation">range</a> aggregation. The user can define a point of origin and a set of distance range buckets. The aggregation evaluate the distance of each document value from the origin point and determines the buckets it belongs to based on the ranges (a document belongs to a bucket if the distance between the document and the origin falls within the distance range of the bucket).</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings_around_amsterdam" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "aggregations": {
        "rings" : {
            "buckets": [
                {
                    "key": "*-100.0",
                    "from": 0,
                    "to": 100.0,
                    "doc_count": 3
                },
                {
                    "key": "100.0-300.0",
                    "from": 100.0,
                    "to": 300.0,
                    "doc_count": 1
                },
                {
                    "key": "300.0-*",
                    "from": 300.0,
                    "doc_count": 7
                }
            ]
        }
    }
}</pre></div><p>The specified field must be of type <code class="literal">geo_point</code> (which can only be set explicitly in the mappings). And it can also hold an array of <code class="literal">geo_point</code> fields, in which case all will be taken into account during aggregation. The origin point can accept all formats supported by the <a class="link" href="geo-point.html" title="Geo-point datatype"><code class="literal">geo_point</code> type</a>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Object format: <code class="literal">{ "lat" : 52.3760, "lon" : 4.894 }</code> - this is the safest format as it is the most explicit about the <code class="literal">lat</code> &amp; <code class="literal">lon</code> values
</li><li class="listitem">
String format: <code class="literal">"52.3760, 4.894"</code> - where the first number is the <code class="literal">lat</code> and the second is the <code class="literal">lon</code>
</li><li class="listitem">
Array format: <code class="literal">[4.894, 52.3760]</code> - which is based on the <code class="literal">GeoJson</code> standard and where the first number is the <code class="literal">lon</code> and the second one is the <code class="literal">lat</code>
</li></ul></div><p>By default, the distance unit is <code class="literal">m</code> (metres) but it can also accept: <code class="literal">mi</code> (miles), <code class="literal">in</code> (inches), <code class="literal">yd</code> (yards), <code class="literal">km</code> (kilometers), <code class="literal">cm</code> (centimeters), <code class="literal">mm</code> (millimeters).</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "unit" : "mi", <a id="CO75-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The distances will be computed as miles
</p></td></tr></table></div><p>There are two distance calculation modes: <code class="literal">arc</code> (the default), and <code class="literal">plane</code>. The <code class="literal">arc</code> calculation is the most accurate.
The <code class="literal">plane</code> is the fastest but least accurate. Consider using <code class="literal">plane</code> when your search context is "narrow", and spans
smaller geographical areas (~5km). <code class="literal">plane</code> will return higher error margins for searches across very large areas
(e.g. cross continent search). The distance calculation type can be set using the <code class="literal">distance_type</code> parameter:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "distance_type" : "plane",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="search-aggregations-bucket-filters-aggregation.html">
              « 
              Filters Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation
               »
            </a></span></div></body></html>