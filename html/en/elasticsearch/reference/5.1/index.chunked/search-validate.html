<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Validate API
        | Elasticsearch Reference [5.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.1]" /><link rel="up" href="search.html" title="Search APIs" /><link rel="prev" href="search-count.html" title="Count API" /><link rel="next" href="search-explain.html" title="Explain API" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.1]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Validate API</span></div><div xmlns="" class="navheader"><span class="prev"><a href="search-count.html">
              « 
              Count API</a>
           
        </span><span class="next">
           
          <a href="search-explain.html">Explain API
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-validate"></a>Validate API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/validate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The validate API allows a user to validate a potentially expensive query
without executing it. We’ll use the following test data to explain _validate:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT twitter/tweet/_bulk?refresh
{"index":{"_id":1}}
{"user" : "kimchy", "post_date" : "2009-11-15T14:12:12", "message" : "trying out Elasticsearch"}
{"index":{"_id":2}}
{"user" : "kimchi", "post_date" : "2009-11-15T14:12:13", "message" : "My username is similar to @kimchy!"}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>When sent a valid query:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/_validate/query?q=user:foo</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>The response contains <code class="literal">valid:true</code>:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre></div><h3><a id="_request_parameters_2"></a>Request Parameters<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/search/validate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When executing exists using the query parameter <code class="literal">q</code>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name </th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">df</code></p></td><td align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">lenient</code></p></td><td align="left" valign="top"><p>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div><p>The query may also be sent in the request body:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/tweet/_validate/query
{
  "query" : {
    "bool" : {
      "must" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user" : "kimchy" }
      }
    }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="search-search.html" title="Search">search api</a> works</p></div></div><p>If the query is invalid, <code class="literal">valid</code> will be <code class="literal">false</code>. Here the query is
invalid because Elasticsearch knows the post_date field should be a date
due to dynamic mapping, and <span class="emphasis"><em>foo</em></span> does not correctly parse into a date:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/tweet/_validate/query?q=post_date:foo</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{"valid":false,"_shards":{"total":1,"successful":1,"failed":0}}</pre></div><p>An <code class="literal">explain</code> parameter can be specified to get more detailed information
about why a query failed:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/tweet/_validate/query?q=post_date:foo&amp;explain=true</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>responds with:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "valid" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "failed" : 0
  },
  "explanations" : [ {
    "index" : "twitter",
    "valid" : false,
    "error" : "twitter/IAEc2nIXSSunQA_suI0MLw] QueryShardException[failed to create query:...failed to parse date field [foo]"
  } ]
}</pre></div><p>When the query is valid, the explanation defaults to the string
representation of that query. With <code class="literal">rewrite</code> set to <code class="literal">true</code>, the explanation
is more detailed showing the actual Lucene query that will be executed.</p><p>For Fuzzy Queries:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/tweet/_validate/query?rewrite=true
{
  "query": {
    "match": {
      "user": {
        "query": "kimchy",
        "fuzziness": "auto"
      }
    }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>Response:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "twitter",
         "valid": true,
         "explanation": "+user:kimchy +user:kimchi^0.75 #(ConstantScore(_type:tweet))^0.0"
      }
   ]
}</pre></div><p>For More Like This:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET twitter/tweet/_validate/query?rewrite=true
{
  "query": {
    "more_like_this": {
      "like": {
        "_id": "2"
      },
      "boost_terms": 1
    }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><p>Response:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "twitter",
         "valid": true,
         "explanation": "((user:terminator^3.71334 plot:future^2.763601 plot:human^2.8415773 plot:sarah^3.4193945 plot:kyle^3.8244398 plot:cyborg^3.9177752 plot:connor^4.040236 plot:reese^4.7133346 ... )~6) -ConstantScore(_uid:tweet#2)) #(ConstantScore(_type:tweet))^0.0"
      }
   ]
}</pre></div><div xmlns="" class="caution admon"><div class="icon"><img alt="Caution" src="images/icons/caution.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The request is executed on a single shard only, which is randomly
selected. The detailed explanation of the query may depend on which shard is
being hit, and therefore may vary from one request to another.</p></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="search-count.html">
              « 
              Count API</a>
           
        </span><span class="next">
           
          <a href="search-explain.html">Explain API
               »
            </a></span></div></body></html>