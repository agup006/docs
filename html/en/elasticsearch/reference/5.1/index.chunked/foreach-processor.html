<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Foreach Processor
        | Elasticsearch Reference [5.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.1]" /><link rel="up" href="ingest-processors.html" title="Processors" /><link rel="prev" href="fail-processor.html" title="Fail Processor" /><link rel="next" href="grok-processor.html" title="Grok Processor" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.1]
    </a></span> » <span class="breadcrumb-link"><a href="ingest.html">Ingest Node</a></span> » <span class="breadcrumb-link"><a href="ingest-processors.html">Processors</a></span> » <span class="breadcrumb-node">Foreach Processor</span></div><div xmlns="" class="navheader"><span class="prev"><a href="fail-processor.html">
              « 
              Fail Processor</a>
           
        </span><span class="next">
           
          <a href="grok-processor.html">Grok Processor
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="foreach-processor"></a>Foreach Processor<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/ingest/ingest-node.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><span xmlns="" class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">
This processor may change or be replaced by something else that provides similar functionality. This
processor executes in its own context, which makes it different compared to all other processors and for features like
verbose simulation the subprocessor isn't visible. The reason we still expose this processor, is that it is the only
processor that can operate on an array
</span></span></p><p>Processes elements in an array of unknown length.</p><p>All processors can operate on elements inside an array, but if all elements of an array need to
be processed in the same way, defining a processor for each element becomes cumbersome and tricky
because it is likely that the number of elements in an array is unknown. For this reason the <code class="literal">foreach</code>
processor exists. By specifying the field holding array elements and a processor that
defines what should happen to each element, array fields can easily be preprocessed.</p><p>A processor inside the foreach processor works in the array element context and puts that in the ingest metadata
under the <code class="literal">_ingest._value</code> key. If the array element is a json object it holds all immediate fields of that json object.
and if the nested object is a value is <code class="literal">_ingest._value</code> just holds that value. Note that if a processor prior to the
<code class="literal">foreach</code> processor used <code class="literal">_ingest._value</code> key then the specified value will not be available to the processor inside
the <code class="literal">foreach</code> processor. The <code class="literal">foreach</code> processor does restore the original value, so that value is available to processors
after the <code class="literal">foreach</code> processor.</p><p>Note that any other field from the document are accessible and modifiable like with all other processors. This processor
just puts the current array element being read into <code class="literal">_ingest._value</code> ingest metadata attribute, so that it may be
pre-processed.</p><p>If the <code class="literal">foreach</code> processor fails to process an element inside the array, and no <code class="literal">on_failure</code> processor has been specified,
then it aborts the execution and leaves the array unmodified.</p><div class="table"><a id="foreach-options"></a><p class="title"><strong>Table 19. Foreach Options</strong></p><div class="table-contents"><table summary="Foreach Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top"> Name          </th><th align="left" valign="top"> Required  </th><th align="left" valign="top"> Default  </th><th align="left" valign="top"> Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">field</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The array field</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">processor</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The processor to execute against each field</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Assume the following document:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "values" : ["foo", "bar", "baz"]
}</pre></div><p>When this <code class="literal">foreach</code> processor operates on this sample document:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "foreach" : {
    "field" : "values",
    "processor" : {
      "uppercase" : {
        "field" : "_ingest._value"
      }
    }
  }
}</pre></div><p>Then the document will look like this after preprocessing:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "values" : ["FOO", "BAR", "BAZ"]
}</pre></div><p>Let’s take a look at another example:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "persons" : [
    {
      "id" : "1",
      "name" : "John Doe"
    },
    {
      "id" : "2",
      "name" : "Jane Doe"
    }
  ]
}</pre></div><p>In this case, the <code class="literal">id</code> field needs to be removed,
so the following <code class="literal">foreach</code> processor is used:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "foreach" : {
    "field" : "persons",
    "processor" : {
      "remove" : {
        "field" : "_ingest._value.id"
      }
    }
  }
}</pre></div><p>After preprocessing the result is:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "persons" : [
    {
      "name" : "John Doe"
    },
    {
      "name" : "Jane Doe"
    }
  ]
}</pre></div><p>The wrapped processor can have a <code class="literal">on_failure</code> definition.
For example, the <code class="literal">id</code> field may not exist on all person objects.
Instead of failing the index request, you can use an <code class="literal">on_failure</code>
block to send the document to the <span class="emphasis"><em>failure_index</em></span> index for later inspection:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "foreach" : {
    "field" : "persons",
    "processor" : {
      "remove" : {
        "field" : "_value.id",
        "on_failure" : [
          {
            "set" : {
              "field", "_index",
              "value", "failure_index"
            }
          }
        ]
      }
    }
  }
}</pre></div><p>In this example, if the <code class="literal">remove</code> processor does fail, then
the array elements that have been processed thus far will
be updated.</p><p>Another advanced example can be found in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/plugins/5.1/ingest-attachment-with-arrays.html" target="_top">attachment processor documentation</a>.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="fail-processor.html">
              « 
              Fail Processor</a>
           
        </span><span class="next">
           
          <a href="grok-processor.html">Grok Processor
               »
            </a></span></div></body></html>