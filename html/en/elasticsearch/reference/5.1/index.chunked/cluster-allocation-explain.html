<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Cluster Allocation Explain API
        | Elasticsearch Reference [5.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.1]" /><link rel="up" href="cluster.html" title="Cluster APIs" /><link rel="prev" href="cluster-nodes-hot-threads.html" title="Nodes hot_threads" /><link rel="next" href="query-dsl.html" title="Query DSL" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.1]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster Allocation Explain API</span></div><div xmlns="" class="navheader"><span class="prev"><a href="cluster-nodes-hot-threads.html">
              « 
              Nodes hot_threads</a>
           
        </span><span class="next">
           
          <a href="query-dsl.html">Query DSL
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-allocation-explain"></a>Cluster Allocation Explain API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/cluster/allocation-explain.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The cluster allocation explanation API is designed to assist in answering the
question "why is this shard unassigned?". To explain the allocation (on
unassigned state) of a shard, issue a request like:</p><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content">
The cluster allocation explain API is new and should still be considered experimental. The API may change in ways that are not backwards compatible
</div></div><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/allocation/explain' -d'{
  "index": "myindex",
  "shard": 0,
  "primary": false
}'</pre></div><p>Specify the <code class="literal">index</code> and <code class="literal">shard</code> id of the shard you would like an explanation
for, as well as the <code class="literal">primary</code> flag to indicate whether to explain a primary or
replica shard.</p><p>The response looks like:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "shard" : {
    "index" : "myindex",
    "index_uuid" : "KnW0-zELRs6PK84l0r38ZA",
    "id" : 0,
    "primary" : false
  },
  "assigned" : false,                             <a id="CO138-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
  "shard_state_fetch_pending": false,             <a id="CO138-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span>
  "unassigned_info" : {
    "reason" : "INDEX_CREATED",                   <a id="CO138-3"></a><span xmlns=""><img src="images/icons/callouts/3.png" alt="" /></span>
    "at" : "2016-03-22T20:04:23.620Z"
  },
  "allocation_delay_ms" : 0,                      <a id="CO138-4"></a><span xmlns=""><img src="images/icons/callouts/4.png" alt="" /></span>
  "remaining_delay_ms" : 0,                       <a id="CO138-5"></a><span xmlns=""><img src="images/icons/callouts/5.png" alt="" /></span>
  "nodes" : {
    "V-Spi0AyRZ6ZvKbaI3691w" : {
      "node_name" : "H5dfFeA",
      "node_attributes" : {                       <a id="CO138-6"></a><span xmlns=""><img src="images/icons/callouts/6.png" alt="" /></span>
        "bar" : "baz"
      },
      "store" : {
        "shard_copy" : "NONE"                     <a id="CO138-7"></a><span xmlns=""><img src="images/icons/callouts/7.png" alt="" /></span>
      },
      "final_decision" : "NO",                    <a id="CO138-8"></a><span xmlns=""><img src="images/icons/callouts/8.png" alt="" /></span>
      "final_explanation" : "the shard cannot be assigned because one or more allocation decider returns a 'NO' decision",
      "weight" : 0.06666675,                      <a id="CO138-9"></a><span xmlns=""><img src="images/icons/callouts/9.png" alt="" /></span>
      "decisions" : [ {                           <a id="CO138-10"></a><span xmlns=""><img src="images/icons/callouts/10.png" alt="" /></span>
        "decider" : "filter",
        "decision" : "NO",
        "explanation" : "node does not match index include filters [foo:\"bar\"]"
      } ]
    },
    "Qc6VL8c5RWaw1qXZ0Rg57g" : {
      "node_name" : "bGG90GE",
      "node_attributes" : {
        "bar" : "baz",
        "foo" : "bar"
      },
      "store" : {
        "shard_copy" : "AVAILABLE"
      },
      "final_decision" : "NO",
      "final_explanation" : "the shard cannot be assigned because one or more allocation decider returns a 'NO' decision",
      "weight" : -1.3833332,
      "decisions" : [ {
        "decider" : "same_shard",
        "decision" : "NO",
        "explanation" : "the shard cannot be allocated on the same node id [Qc6VL8c5RWaw1qXZ0Rg57g] on which it already exists"
      } ]
    },
    "PzdyMZGXQdGhqTJHF_hGgA" : {
      "node_name" : "DKDM97B",
      "node_attributes" : { },
      "store" : {
        "shard_copy" : "NONE"
      },
      "final_decision" : "NO",
      "final_explanation" : "the shard cannot be assigned because one or more allocation decider returns a 'NO' decision",
      "weight" : 2.3166666,
      "decisions" : [ {
        "decider" : "filter",
        "decision" : "NO",
        "explanation" : "node does not match index include filters [foo:\"bar\"]"
      } ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Whether the shard is assigned or unassigned
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Whether information about the shard is still being fetched
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-3"><span xmlns=""><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Reason for the shard originally becoming unassigned
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-4"><span xmlns=""><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Configured delay before the shard can be allocated
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-5"><span xmlns=""><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Remaining delay before the shard can be allocated
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-6"><span xmlns=""><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
User-added attributes the node has
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-7"><span xmlns=""><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The shard copy information for this node and error (if applicable)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-8"><span xmlns=""><img src="images/icons/callouts/8.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Final decision and explanation of whether the shard can be allocated to this node
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-9"><span xmlns=""><img src="images/icons/callouts/9.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Weight for how much the allocator would like to allocate the shard to this node
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-10"><span xmlns=""><img src="images/icons/callouts/10.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
List of node decisions factoring into final decision about the shard
</p></td></tr></table></div><p>For a shard that is already assigned, the output looks similar to:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "shard" : {
    "index" : "only-foo",
    "index_uuid" : "KnW0-zELRs6PK84l0r38ZA",
    "id" : 0,
    "primary" : true
  },
  "assigned" : true,
  "assigned_node_id" : "Qc6VL8c5RWaw1qXZ0Rg57g",      <a id="CO139-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
  "shard_state_fetch_pending": false,
  "allocation_delay_ms" : 0,
  "remaining_delay_ms" : 0,
  "nodes" : {
    "V-Spi0AyRZ6ZvKbaI3691w" : {
      "node_name" : "bGG90GE",
      "node_attributes" : {
        "bar" : "baz"
      },
      "store" : {
        "shard_copy" : "NONE"
      },
      "final_decision" : "NO",
      "final_explanation" : "the shard cannot be assigned because one or more allocation decider returns a 'NO' decision",
      "weight" : 1.4499999,
      "decisions" : [ {
        "decider" : "filter",
        "decision" : "NO",
        "explanation" : "node does not match index include filters [foo:\"bar\"]"
      } ]
    },
    "Qc6VL8c5RWaw1qXZ0Rg57g" : {
      "node_name" : "I8hydUG",
      "node_attributes" : {
        "bar" : "baz",
        "foo" : "bar"
      },
      "store" : {
        "shard_copy" : "AVAILABLE"
      },
      "final_decision" : "ALREADY_ASSIGNED",        <a id="CO139-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span>
      "final_explanation" : "the shard is already assigned to this node",
      "weight" : 0.0,
      "decisions" : [ {
        "decider" : "same_shard",
        "decision" : "NO",
        "explanation" : "the shard cannot be allocated on the same node id [Qc6VL8c5RWaw1qXZ0Rg57g] on which it already exists"
      } ]
    },
    "PzdyMZGXQdGhqTJHF_hGgA" : {
      "node_name" : "H5dfFeA",
      "node_attributes" : { },
      "store" : {
        "shard_copy" : "NONE"
      },
      "final_decision" : "NO",
      "final_explanation" : "the shard cannot be assigned because one or more allocation decider returns a 'NO' decision",
      "weight" : 3.6999998,
      "decisions" : [ {
        "decider" : "filter",
        "decision" : "NO",
        "explanation" : "node does not match index include filters [foo:\"bar\"]"
      } ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO139-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Node the shard is currently assigned to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO139-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The decision is "ALREADY_ASSIGNED" because the shard is currently assigned to this node
</p></td></tr></table></div><p>You can also have Elasticsearch explain the allocation of the first unassigned
shard it finds by sending an empty body, such as:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/allocation/explain'</pre></div><p>If you would like to include all decisions that were factored into the final
decision, the <code class="literal">include_yes_decisions</code> parameter will return all decisions:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/allocation/explain?include_yes_decisions=true'</pre></div><p>Additionally, you can return information gathered by the cluster info service
about disk usage and shard sizes by setting the <code class="literal">include_disk_info</code> parameter to
<code class="literal">true</code>:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">$ curl -XGET 'http://localhost:9200/_cluster/allocation/explain?include_disk_info=true'</pre></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="cluster-nodes-hot-threads.html">
              « 
              Nodes hot_threads</a>
           
        </span><span class="next">
           
          <a href="query-dsl.html">Query DSL
               »
            </a></span></div></body></html>