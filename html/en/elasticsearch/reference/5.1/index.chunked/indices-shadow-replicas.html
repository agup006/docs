<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Shadow replica indices
        | Elasticsearch Reference [5.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.1]" /><link rel="up" href="indices.html" title="Indices APIs" /><link rel="prev" href="indices-templates.html" title="Index Templates" /><link rel="next" href="_node_level_settings_related_to_shadow_replicas.html" title="Node level settings related to shadow replicas" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/5.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.1]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Shadow replica indices</span></div><div xmlns="" class="navheader"><span class="prev"><a href="indices-templates.html">
              « 
              Index Templates</a>
           
        </span><span class="next">
           
          <a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-shadow-replicas"></a>Shadow replica indices<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/5.1/docs/reference/indices/shadow-replicas.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>If you would like to use a shared filesystem, you can use the shadow replicas
settings to choose where on disk the data for an index should be kept, as well
as how Elasticsearch should replay operations on all the replica shards of an
index.</p><p>In order to fully utilize the <code class="literal">index.data_path</code> and <code class="literal">index.shadow_replicas</code>
settings, you need to allow Elasticsearch to use the same data directory for
multiple instances by setting <code class="literal">node.add_lock_id_to_custom_path</code> to false in
elasticsearch.yml:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">node.add_lock_id_to_custom_path: false</pre></div><p>You will also need to indicate to the security manager where the custom indices
will be, so that the correct permissions can be applied. You can do this by
setting the <code class="literal">path.shared_data</code> setting in elasticsearch.yml:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">path.shared_data: /opt/data</pre></div><p>This means that Elasticsearch can read and write to files in any subdirectory of
the <code class="literal">path.shared_data</code> setting.</p><p>You can then create an index with a custom data path, where each node will use
this path for the data:</p><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Because shadow replicas do not index the document on replica shards, it’s
possible for the replica’s known mapping to be behind the index’s known mapping
if the latest cluster state has not yet been processed on the node containing
the replica. Because of this, it is highly recommended to use pre-defined
mappings when using shadow replicas.</p></div></div><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">curl -XPUT 'localhost:9200/my_index' -d '
{
    "index" : {
        "number_of_shards" : 1,
        "number_of_replicas" : 4,
        "data_path": "/opt/data/my_index",
        "shadow_replicas": true
    }
}'</pre></div><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">In the above example, the "/opt/data/my_index" path is a shared filesystem that
must be available on every node in the Elasticsearch cluster. You must also
ensure that the Elasticsearch process has the correct permissions to read from
and write to the directory used in the <code class="literal">index.data_path</code> setting.</p></div></div><p>The <code class="literal">data_path</code> does not have to contain the index name, in this case,
"my_index" was used but it could easily also have been "/opt/data/"</p><p>An index that has been created with the <code class="literal">index.shadow_replicas</code> setting set to
"true" will not replicate document operations to any of the replica shards,
instead, it will only continually refresh. Once segments are available on the
filesystem where the shadow replica resides (after an Elasticsearch "flush"), a
regular refresh (governed by the <code class="literal">index.refresh_interval</code>) can be used to make
the new data searchable.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Since documents are only indexed on the primary shard, realtime GET
requests could fail to return a document if executed on the replica shard,
therefore, GET API requests automatically have the <code class="literal">?preference=_primary</code> flag
set if there is no preference flag already set.</p></div></div><p>In order to ensure the data is being synchronized in a fast enough manner, you
may need to tune the flush threshold for the index to a desired number. A flush
is needed to fsync segment files to disk, so they will be visible to all other
replica nodes. Users should test what flush threshold levels they are
comfortable with, as increased flushing can impact indexing performance.</p><p>The Elasticsearch cluster will still detect the loss of a primary shard, and
transform the replica into a primary in this situation. This transformation will
take slightly longer, since no <code class="literal">IndexWriter</code> is maintained for each shadow
replica.</p><p>Below is the list of settings that can be changed using the update
settings API:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.data_path</code> (string)
</span></dt><dd>
    Path to use for the index’s data. Note that by default Elasticsearch will
    append the node ordinal by default to the path to ensure multiple instances
    of Elasticsearch on the same machine do not share a data directory.
</dd><dt><span class="term">
<code class="literal">index.shadow_replicas</code>
</span></dt><dd>
    Boolean value indicating this index should use shadow replicas. Defaults to
    <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">index.shared_filesystem</code>
</span></dt><dd>
    Boolean value indicating this index uses a shared filesystem. Defaults to
    the <code class="literal">true</code> if <code class="literal">index.shadow_replicas</code> is set to true, <code class="literal">false</code> otherwise.
</dd><dt><span class="term">
<code class="literal">index.shared_filesystem.recover_on_any_node</code>
</span></dt><dd>
    Boolean value indicating whether the primary shards for the index should be
    allowed to recover on any node in the cluster. If a node holding a copy of
    the shard is found, recovery prefers that node. Defaults to <code class="literal">false</code>.
</dd></dl></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="indices-templates.html">
              « 
              Index Templates</a>
           
        </span><span class="next">
           
          <a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas
               »
            </a></span></div></body></html>