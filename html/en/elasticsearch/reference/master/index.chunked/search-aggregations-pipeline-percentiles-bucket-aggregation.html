<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Percentiles Bucket Aggregation
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="search-aggregations-pipeline.html" title="Pipeline Aggregations" /><link rel="prev" href="search-aggregations-pipeline-extended-stats-bucket-aggregation.html" title="Extended Stats Bucket Aggregation" /><link rel="next" href="search-aggregations-pipeline-movavg-aggregation.html" title="Moving Average Aggregation" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Docs/Elasticsearch/Reference/master" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-link"><a href="search-aggregations-pipeline.html">Pipeline Aggregations</a></span> » <span class="breadcrumb-node">Percentiles Bucket Aggregation</span></div><div xmlns="" class="navheader"><span class="prev"><a href="search-aggregations-pipeline-extended-stats-bucket-aggregation.html">
              « 
              Extended Stats Bucket Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-pipeline-movavg-aggregation.html">Moving Average Aggregation
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-pipeline-percentiles-bucket-aggregation"></a>Percentiles Bucket Aggregation<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>A sibling pipeline aggregation which calculates percentiles across all bucket of a specified metric in a sibling aggregation.
The specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_syntax_8"></a>Syntax<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A <code class="literal">percentiles_bucket</code> aggregation looks like this in isolation:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "percentiles_bucket": {
        "buckets_path": "the_sum"
    }
}</pre></div><div class="table"><a id="id-1.8.5.47.4.4"></a><p class="title"><strong>Table 8. <code class="literal">sum_bucket</code> Parameters</strong></p><div class="table-contents"><table summary="sum_bucket Parameters" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><tbody><tr><td align="left" valign="top"><p>Parameter Name</p></td><td align="left" valign="top"><p>Description</p></td><td align="left" valign="top"><p>Required</p></td><td align="left" valign="top"><p>Default Value</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">buckets_path</code></p></td><td align="left" valign="top"><p>The path to the buckets we wish to find the sum for (see <a class="xref" href="search-aggregations-pipeline.html#buckets-path-syntax" title="buckets_path Syntaxedit">the section called “<code class="literal">buckets_path</code> Syntax<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/pipeline.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”</a> for more
 details)</p></td><td align="left" valign="top"><p>Required</p></td><td align="left" valign="top"><p></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">gap_policy</code></p></td><td align="left" valign="top"><p>The policy to apply when gaps are found in the data (see <a class="xref" href="search-aggregations-pipeline.html#gap-policy" title="Dealing with gaps in the dataedit">the section called “Dealing with gaps in the data<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/pipeline.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”</a> for more
 details)</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">skip</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">format</code></p></td><td align="left" valign="top"><p>format to apply to the output value of this aggregation</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">null</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">percents</code></p></td><td align="left" valign="top"><p>The list of percentiles to calculate</p></td><td align="left" valign="top"><p>Optional</p></td><td align="left" valign="top"><p><code class="literal">[ 1, 5, 25, 50, 75, 95, 99 ]</code></p></td></tr></tbody></table></div></div><br class="table-break" /><p>The following snippet calculates the sum of all the total monthly <code class="literal">sales</code> buckets:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">POST /sales/_search
{
    "size": 0,
    "aggs" : {
        "sales_per_month" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            },
            "aggs": {
                "sales": {
                    "sum": {
                        "field": "price"
                    }
                }
            }
        },
        "percentiles_monthly_sales": {
            "percentiles_bucket": {
                "buckets_path": "sales_per_month&gt;sales", <a id="CO108-1"></a><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span>
                "percents": [ 25.0, 50.0, 75.0 ] <a id="CO108-2"></a><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span>
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet=":CONSOLE:"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-1"><span xmlns=""><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">buckets_path</code> instructs this percentiles_bucket aggregation that we want to calculate percentiles for
the <code class="literal">sales</code> aggregation in the <code class="literal">sales_per_month</code> date histogram.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO108-2"><span xmlns=""><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">percents</code> specifies which percentiles we wish to calculate, in this case, the 25th, 50th and 75th percentiles.
</p></td></tr></table></div><p>And the following may be the response:</p><div xmlns="" class="pre_wrapper"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
   "took": 11,
   "timed_out": false,
   "_shards": ...,
   "hits": ...,
   "aggregations": {
      "sales_per_month": {
         "buckets": [
            {
               "key_as_string": "2015/01/01 00:00:00",
               "key": 1420070400000,
               "doc_count": 3,
               "sales": {
                  "value": 550.0
               }
            },
            {
               "key_as_string": "2015/02/01 00:00:00",
               "key": 1422748800000,
               "doc_count": 2,
               "sales": {
                  "value": 60.0
               }
            },
            {
               "key_as_string": "2015/03/01 00:00:00",
               "key": 1425168000000,
               "doc_count": 2,
               "sales": {
                  "value": 375.0
               }
            }
         ]
      },
      "percentiles_monthly_sales": {
        "values" : {
            "25.0": 375.0,
            "50.0": 375.0,
            "75.0": 550.0
         }
      }
   }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_percentiles_bucket_implementation"></a>Percentiles_bucket implementation<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/aggregations/pipeline/percentiles-bucket-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Percentile Bucket returns the nearest input data point that is not greater than the requested percentile; it does not
interpolate between data points.</p><p>The percentiles are calculated exactly and is not an approximation (unlike the Percentiles Metric). This means
the implementation maintains an in-memory, sorted list of your data to compute the percentiles, before discarding the
data.  You may run into memory pressure issues if you attempt to calculate percentiles over many millions of
data-points in a single <code class="literal">percentiles_bucket</code>.</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="search-aggregations-pipeline-extended-stats-bucket-aggregation.html">
              « 
              Extended Stats Bucket Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-pipeline-movavg-aggregation.html">Moving Average Aggregation
               »
            </a></span></div></body></html>